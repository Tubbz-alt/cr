<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff application/org.openjdk.jmc.flightrecorder.flameview/src/main/java/org/openjdk/jmc/flightrecorder/flameview/tree/TraceTreeUtils.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TraceNode.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../views/FlameGraphView.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>application/org.openjdk.jmc.flightrecorder.flameview/src/main/java/org/openjdk/jmc/flightrecorder/flameview/tree/TraceTreeUtils.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 67 	}
 68 
 69 	/**
 70 	 * Traces a tree of stack frames from an {@link IItemCollection}.
 71 	 *
 72 	 * @param items
 73 	 *            the events to aggregate the traces from.
 74 	 * @return the root of the resulting tree.
 75 	 */
 76 	public static TraceNode createTree(
 77 		IItemCollection items, FrameSeparator frameSeparator, boolean threadRootAtTop, String rootName) {
 78 		return createTree(new StacktraceModel(threadRootAtTop, frameSeparator, items), rootName);
 79 	}
 80 
 81 	private static void addBranch(TraceNode root, Branch branch) {
 82 		StacktraceFrame firstFrame = branch.getFirstFrame();
 83 		TraceNode currentNode = new TraceNode(format(firstFrame), firstFrame.getItemCount(),
 84 				formatPackageName(firstFrame));
 85 		root.addChild(currentNode);
 86 		for (StacktraceFrame frame : branch.getTailFrames()) {
<span class="line-modified"> 87 			TraceNode newNode = new TraceNode(format(frame), frame.getItemCount(),</span>
<span class="line-removed"> 88 					formatPackageName(frame));</span>
 89 			currentNode.addChild(newNode);
 90 			currentNode = newNode;
 91 		}
 92 		addFork(currentNode, branch.getEndFork());
 93 	}
 94 
 95 	private static void addFork(TraceNode node, Fork fork) {
 96 		for (Branch branch : fork.getBranches()) {
 97 			addBranch(node, branch);
 98 		}
 99 	}
100 
101 	private static String format(StacktraceFrame sFrame) {
102 		IMCFrame frame = sFrame.getFrame();
103 		IMCMethod method = frame.getMethod();
104 		return FormatToolkit.getHumanReadable(method, false, false, true, false, true, false);
105 	}
<span class="line-modified">106 	</span>
107 	private static String formatPackageName(StacktraceFrame sFrame) {
108 		IMCFrame frame = sFrame.getFrame();
109 		IMCMethod method = frame.getMethod();
110 		return FormatToolkit.getPackage(method.getType().getPackage());
111 	}
112 
113 	public static String printTree(TraceNode node) {
114 		StringBuilder builder = new StringBuilder();
115 		builder.append(&quot;=== Tree Printout ===&quot;);
116 		builder.append(System.lineSeparator());
117 		printTree(builder, 0, node);
118 		return builder.toString();
119 	}
120 
121 	private static void printTree(StringBuilder builder, int indentation, TraceNode node) {
122 		builder.append(String.format(&quot;%s%s - %d%n&quot;, indent(indentation), node.getName(), node.getValue()));
123 		for (TraceNode child : node.getChildren()) {
124 			printTree(builder, indentation + 1, child);
125 		}
126 	}
</pre>
</td>
<td>
<hr />
<pre>
 67 	}
 68 
 69 	/**
 70 	 * Traces a tree of stack frames from an {@link IItemCollection}.
 71 	 *
 72 	 * @param items
 73 	 *            the events to aggregate the traces from.
 74 	 * @return the root of the resulting tree.
 75 	 */
 76 	public static TraceNode createTree(
 77 		IItemCollection items, FrameSeparator frameSeparator, boolean threadRootAtTop, String rootName) {
 78 		return createTree(new StacktraceModel(threadRootAtTop, frameSeparator, items), rootName);
 79 	}
 80 
 81 	private static void addBranch(TraceNode root, Branch branch) {
 82 		StacktraceFrame firstFrame = branch.getFirstFrame();
 83 		TraceNode currentNode = new TraceNode(format(firstFrame), firstFrame.getItemCount(),
 84 				formatPackageName(firstFrame));
 85 		root.addChild(currentNode);
 86 		for (StacktraceFrame frame : branch.getTailFrames()) {
<span class="line-modified"> 87 			TraceNode newNode = new TraceNode(format(frame), frame.getItemCount(), formatPackageName(frame));</span>

 88 			currentNode.addChild(newNode);
 89 			currentNode = newNode;
 90 		}
 91 		addFork(currentNode, branch.getEndFork());
 92 	}
 93 
 94 	private static void addFork(TraceNode node, Fork fork) {
 95 		for (Branch branch : fork.getBranches()) {
 96 			addBranch(node, branch);
 97 		}
 98 	}
 99 
100 	private static String format(StacktraceFrame sFrame) {
101 		IMCFrame frame = sFrame.getFrame();
102 		IMCMethod method = frame.getMethod();
103 		return FormatToolkit.getHumanReadable(method, false, false, true, false, true, false);
104 	}
<span class="line-modified">105 </span>
106 	private static String formatPackageName(StacktraceFrame sFrame) {
107 		IMCFrame frame = sFrame.getFrame();
108 		IMCMethod method = frame.getMethod();
109 		return FormatToolkit.getPackage(method.getType().getPackage());
110 	}
111 
112 	public static String printTree(TraceNode node) {
113 		StringBuilder builder = new StringBuilder();
114 		builder.append(&quot;=== Tree Printout ===&quot;);
115 		builder.append(System.lineSeparator());
116 		printTree(builder, 0, node);
117 		return builder.toString();
118 	}
119 
120 	private static void printTree(StringBuilder builder, int indentation, TraceNode node) {
121 		builder.append(String.format(&quot;%s%s - %d%n&quot;, indent(indentation), node.getName(), node.getValue()));
122 		for (TraceNode child : node.getChildren()) {
123 			printTree(builder, indentation + 1, child);
124 		}
125 	}
</pre>
</td>
</tr>
</table>
<center><a href="TraceNode.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="../views/FlameGraphView.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>