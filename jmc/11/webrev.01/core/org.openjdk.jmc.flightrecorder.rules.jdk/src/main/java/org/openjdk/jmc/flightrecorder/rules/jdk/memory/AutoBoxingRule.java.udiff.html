<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff core/org.openjdk.jmc.flightrecorder.rules.jdk/src/main/java/org/openjdk/jmc/flightrecorder/rules/jdk/memory/AutoBoxingRule.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../../org.openjdk.jmc.flightrecorder/src/main/java/org/openjdk/jmc/flightrecorder/jdk/JdkAggregators.java.udiff.html" target="_top">next &gt;</a></center>    <h2>core/org.openjdk.jmc.flightrecorder.rules.jdk/src/main/java/org/openjdk/jmc/flightrecorder/rules/jdk/memory/AutoBoxingRule.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -67,19 +67,19 @@</span>
   * conversion. Looks at top frames and searches for java.lang.BoxType.valueOf.
   */
  // FIXME: Rename class (and message constants) from autoboxing to something more generic?
  public class AutoBoxingRule extends AbstractRule {
  
<span class="udiff-line-modified-removed">- 	private static final String VALUE_OF_METHOD_NAME = &quot;valueOf&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String SHORT = &quot;java.lang.Short&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String LONG = &quot;java.lang.Long&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String INTEGER = &quot;java.lang.Integer&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String FLOAT = &quot;java.lang.Float&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String DOUBLE = &quot;java.lang.Double&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String CHARACTER = &quot;java.lang.Character&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String BYTE = &quot;java.lang.Byte&quot;;</span>
<span class="udiff-line-modified-removed">- 	private static final String BOOLEAN = &quot;java.lang.Boolean&quot;;</span>
<span class="udiff-line-modified-added">+ 	private static final String VALUE_OF_METHOD_NAME = &quot;valueOf&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String SHORT = &quot;java.lang.Short&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String LONG = &quot;java.lang.Long&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String INTEGER = &quot;java.lang.Integer&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String FLOAT = &quot;java.lang.Float&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String DOUBLE = &quot;java.lang.Double&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String CHARACTER = &quot;java.lang.Character&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String BYTE = &quot;java.lang.Byte&quot;; //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 	private static final String BOOLEAN = &quot;java.lang.Boolean&quot;; //$NON-NLS-1$</span>
  
  	private static final IPredicate&lt;IMCMethod&gt; IS_AUTOBOXED_PREDICATE = new IPredicate&lt;IMCMethod&gt;() {
  		@Override
  		public boolean evaluate(IMCMethod method) {
  			String type = method.getType().getFullName();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -140,18 +140,18 @@</span>
  		StacktraceModel model = new StacktraceModel(false, sep, allocationItems);
  		Map&lt;IMCType, IQuantity&gt; allocationSizeByType = new HashMap&lt;&gt;();
  		IQuantity sizeOfAllBoxedAllocations = UnitLookup.BYTE.quantity(0);
  		IQuantity largestAllocatedByType = UnitLookup.BYTE.quantity(0);
  		IMCType largestAllocatedType = null;
<span class="udiff-line-modified-removed">- 		String secondFrameFromMostAllocated = &quot;&quot;;</span>
<span class="udiff-line-modified-added">+ 		String secondFrameFromMostAllocated = &quot;&quot;; //$NON-NLS-1$</span>
  		for (StacktraceFrame stacktraceFrame : model.getRootFork().getFirstFrames()) {
  			IMCMethod method = stacktraceFrame.getFrame().getMethod();
  			if (IS_AUTOBOXED_PREDICATE.evaluate(method)) {
  				SimpleArray&lt;IItem&gt; itemArray = stacktraceFrame.getItems();
  				IQuantity total = UnitLookup.BYTE.quantity(0);
  				for (IItem item : itemArray) {
<span class="udiff-line-modified-removed">- 					total = total.add(RulesToolkit.getValue(item, JdkAttributes.TLAB_SIZE));</span>
<span class="udiff-line-modified-added">+ 					total = total.add(RulesToolkit.getValue(item, JdkAttributes.TOTAL_ALLOCATION_SIZE));</span>
  				}
  				sizeOfAllBoxedAllocations = sizeOfAllBoxedAllocations.add(total);
  				if (total.compareTo(largestAllocatedByType) &gt; 0) {
  					largestAllocatedByType = total;
  					largestAllocatedType = method.getType();
</pre>
<center>&lt; prev <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../../org.openjdk.jmc.flightrecorder/src/main/java/org/openjdk/jmc/flightrecorder/jdk/JdkAggregators.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>