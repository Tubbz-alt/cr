<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff application/tests/org.openjdk.jmc.rjmx.test/src/test/java/org/openjdk/jmc/rjmx/test/synthetic/SyntheticNotificationTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../subscription/internal/ConsoleAttributeInfoManagerTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../triggers/NotificationTriggerAndRuleTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>application/tests/org.openjdk.jmc.rjmx.test/src/test/java/org/openjdk/jmc/rjmx/test/synthetic/SyntheticNotificationTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
120 	@Test
121 	public void testOverloadMetadata() throws InstanceNotFoundException, IntrospectionException,
122 			MalformedObjectNameException, ReflectionException, NullPointerException, IOException {
123 		MBeanInfo info = connection.getMBeanInfo(new ObjectName(&quot;java.lang:type=ClassLoading&quot;));
124 		assertTrue(info.getNotifications().length &gt; 0);
125 		assertTrue(info.getAttributes().length &gt; 0);
126 	}
127 
128 	/**
129 	 * Tests that we can shadow an existing notification.
130 	 */
131 	@Test
132 	public void testShadowMetadata() throws InstanceNotFoundException, IntrospectionException,
133 			MalformedObjectNameException, ReflectionException, NullPointerException, IOException {
134 		Assume.assumeTrue(&quot;FIXME: Shadowing does not work yet!&quot;, false);
135 		MBeanInfo info = connection.getMBeanInfo(new ObjectName(&quot;java.lang:type=Memory&quot;));
136 		assertTrue(info.getNotifications().length &gt; 0);
137 		for (MBeanNotificationInfo notificationInfo : info.getNotifications()) {
138 			if (notificationInfo.getName().equals(&quot;java.management.memory.collection.threshold.exceeded&quot;)) {
139 				assertTrue(&quot;Failed to shadow description&quot;, notificationInfo.getDescription().contains(&quot;shadow&quot;));
<span class="line-modified">140 				assertTrue(&quot;Got the wrong type:&quot; + notificationInfo.getNotifTypes()[0], &quot;int&quot;.equals(notificationInfo</span>
<span class="line-modified">141 						.getNotifTypes()[0]));</span>
142 			} else {
143 				assertTrue(&quot;Should NOT contain shadow!&quot;, !notificationInfo.getDescription().contains(&quot;shadow&quot;));
144 				assertTrue(&quot;Should not be int!&quot;, !&quot;int&quot;.equals(notificationInfo.getNotifTypes()[0]));
145 			}
146 		}
147 	}
148 
149 	@Test
150 	public void testNotificationListener() throws InstanceNotFoundException, MalformedObjectNameException,
151 			NullPointerException, IOException, InterruptedException, ListenerNotFoundException {
152 		Notification notif = null;
153 		SyntheticNotificationListener listener = new SyntheticNotificationListener();
154 		ObjectName testMBean = new ObjectName(&quot;org.openjdk.jmc.test:type=Test&quot;);
155 		connection.addNotificationListener(testMBean, listener, null, null);
156 		synchronized (this) {
157 			this.wait(30000);
158 			notif = listener.getLastNotification();
159 		}
160 		assertTrue(&quot;Never got any notification!&quot;, gotNotification);
161 		assertNotNull(notif);
</pre>
</td>
<td>
<hr />
<pre>
120 	@Test
121 	public void testOverloadMetadata() throws InstanceNotFoundException, IntrospectionException,
122 			MalformedObjectNameException, ReflectionException, NullPointerException, IOException {
123 		MBeanInfo info = connection.getMBeanInfo(new ObjectName(&quot;java.lang:type=ClassLoading&quot;));
124 		assertTrue(info.getNotifications().length &gt; 0);
125 		assertTrue(info.getAttributes().length &gt; 0);
126 	}
127 
128 	/**
129 	 * Tests that we can shadow an existing notification.
130 	 */
131 	@Test
132 	public void testShadowMetadata() throws InstanceNotFoundException, IntrospectionException,
133 			MalformedObjectNameException, ReflectionException, NullPointerException, IOException {
134 		Assume.assumeTrue(&quot;FIXME: Shadowing does not work yet!&quot;, false);
135 		MBeanInfo info = connection.getMBeanInfo(new ObjectName(&quot;java.lang:type=Memory&quot;));
136 		assertTrue(info.getNotifications().length &gt; 0);
137 		for (MBeanNotificationInfo notificationInfo : info.getNotifications()) {
138 			if (notificationInfo.getName().equals(&quot;java.management.memory.collection.threshold.exceeded&quot;)) {
139 				assertTrue(&quot;Failed to shadow description&quot;, notificationInfo.getDescription().contains(&quot;shadow&quot;));
<span class="line-modified">140 				assertTrue(&quot;Got the wrong type:&quot; + notificationInfo.getNotifTypes()[0],</span>
<span class="line-modified">141 						&quot;int&quot;.equals(notificationInfo.getNotifTypes()[0]));</span>
142 			} else {
143 				assertTrue(&quot;Should NOT contain shadow!&quot;, !notificationInfo.getDescription().contains(&quot;shadow&quot;));
144 				assertTrue(&quot;Should not be int!&quot;, !&quot;int&quot;.equals(notificationInfo.getNotifTypes()[0]));
145 			}
146 		}
147 	}
148 
149 	@Test
150 	public void testNotificationListener() throws InstanceNotFoundException, MalformedObjectNameException,
151 			NullPointerException, IOException, InterruptedException, ListenerNotFoundException {
152 		Notification notif = null;
153 		SyntheticNotificationListener listener = new SyntheticNotificationListener();
154 		ObjectName testMBean = new ObjectName(&quot;org.openjdk.jmc.test:type=Test&quot;);
155 		connection.addNotificationListener(testMBean, listener, null, null);
156 		synchronized (this) {
157 			this.wait(30000);
158 			notif = listener.getLastNotification();
159 		}
160 		assertTrue(&quot;Never got any notification!&quot;, gotNotification);
161 		assertNotNull(notif);
</pre>
</td>
</tr>
</table>
<center><a href="../subscription/internal/ConsoleAttributeInfoManagerTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../triggers/NotificationTriggerAndRuleTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>