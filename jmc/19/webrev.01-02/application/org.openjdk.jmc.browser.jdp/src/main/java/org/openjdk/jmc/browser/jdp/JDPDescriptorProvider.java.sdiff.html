<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff application/org.openjdk.jmc.browser.jdp/src/main/java/org/openjdk/jmc/browser/jdp/JDPDescriptorProvider.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>application/org.openjdk.jmc.browser.jdp/src/main/java/org/openjdk/jmc/browser/jdp/JDPDescriptorProvider.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * 
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * The contents of this file are subject to the terms of either the Universal Permissive License
  7  * v 1.0 as shown at http://oss.oracle.com/licenses/upl
  8  *
  9  * or the following license:
 10  *
 11  * Redistribution and use in source and binary forms, with or without modification, are permitted
 12  * provided that the following conditions are met:
 13  * 
 14  * 1. Redistributions of source code must retain the above copyright notice, this list of conditions
 15  * and the following disclaimer.
 16  * 
 17  * 2. Redistributions in binary form must reproduce the above copyright notice, this list of
 18  * conditions and the following disclaimer in the documentation and/or other materials provided with
 19  * the distribution.
 20  * 
 21  * 3. Neither the name of the copyright holder nor the names of its contributors may be used to
 22  * endorse or promote products derived from this software without specific prior written permission.
</pre>
<hr />
<pre>
 72 	/**
 73 	 * Class handling the incoming JDP events.
 74 	 */
 75 	private class JDPDiscoveryListener implements DiscoveryListener {
 76 		private static final String PATH_SEPARATOR = &quot;/&quot;; //$NON-NLS-1$
 77 
 78 		@Override
 79 		public void onDiscovery(DiscoveryEvent event) {
 80 			switch (event.getKind()) {
 81 			case LOST:
 82 				onDescriptorRemoved(event.getDiscoverable().getSessionId());
 83 				break;
 84 			case CHANGED:
 85 			case FOUND:
 86 			default:
 87 				Map&lt;String, String&gt; map = event.getDiscoverable().getPayload();
 88 				String name = map.get(JMXDataKeys.KEY_INSTANCE_NAME);
 89 				String url = map.get(JMXDataKeys.KEY_JMX_SERVICE_URL);
 90 				String commandLine = map.get(JMXDataKeys.KEY_JAVA_COMMAND);
 91 				String pid = map.get(JMXDataKeys.KEY_PID);
<span class="line-modified"> 92 				// NOTE: We would like to have the JVM type and architecture included in the JDP payload. We should probably file an enhancement request on JDK for this.</span>
 93 				JVMDescriptor jvmInfo = new JVMDescriptor(null, JVMType.UNKNOWN, JVMArch.UNKNOWN, commandLine, null,
<span class="line-modified"> 94 						pid == null ? null : Integer.parseInt(pid), false, Connectable.MGMNT_AGENT_STARTED);</span>
 95 				String path = null;
 96 				if (name == null) {
 97 				} else if (name.endsWith(PATH_SEPARATOR)) {
 98 					path = name;
 99 					name = null;
100 				} else {
101 					int index = name.lastIndexOf(&#39;/&#39;);
102 					if (index != -1) {
103 						path = name.substring(0, index);
104 						name = name.substring(index + 1);
105 					}
106 				}
107 				IServerDescriptor sd = IServerDescriptor.create(event.getDiscoverable().getSessionId(), name, jvmInfo);
108 				try {
109 					onDescriptorDetected(sd, path, new JMXServiceURL(url), null);
110 				} catch (Exception e) {
111 					JDPPlugin.getDefault().getLogger().log(Level.SEVERE, &quot;Got broken event from JDP: &quot; + url, e); //$NON-NLS-1$
112 				}
113 			}
114 		}
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2018, 2019, Oracle and/or its affiliates. All rights reserved.</span>
  3  * 
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * The contents of this file are subject to the terms of either the Universal Permissive License
  7  * v 1.0 as shown at http://oss.oracle.com/licenses/upl
  8  *
  9  * or the following license:
 10  *
 11  * Redistribution and use in source and binary forms, with or without modification, are permitted
 12  * provided that the following conditions are met:
 13  * 
 14  * 1. Redistributions of source code must retain the above copyright notice, this list of conditions
 15  * and the following disclaimer.
 16  * 
 17  * 2. Redistributions in binary form must reproduce the above copyright notice, this list of
 18  * conditions and the following disclaimer in the documentation and/or other materials provided with
 19  * the distribution.
 20  * 
 21  * 3. Neither the name of the copyright holder nor the names of its contributors may be used to
 22  * endorse or promote products derived from this software without specific prior written permission.
</pre>
<hr />
<pre>
 72 	/**
 73 	 * Class handling the incoming JDP events.
 74 	 */
 75 	private class JDPDiscoveryListener implements DiscoveryListener {
 76 		private static final String PATH_SEPARATOR = &quot;/&quot;; //$NON-NLS-1$
 77 
 78 		@Override
 79 		public void onDiscovery(DiscoveryEvent event) {
 80 			switch (event.getKind()) {
 81 			case LOST:
 82 				onDescriptorRemoved(event.getDiscoverable().getSessionId());
 83 				break;
 84 			case CHANGED:
 85 			case FOUND:
 86 			default:
 87 				Map&lt;String, String&gt; map = event.getDiscoverable().getPayload();
 88 				String name = map.get(JMXDataKeys.KEY_INSTANCE_NAME);
 89 				String url = map.get(JMXDataKeys.KEY_JMX_SERVICE_URL);
 90 				String commandLine = map.get(JMXDataKeys.KEY_JAVA_COMMAND);
 91 				String pid = map.get(JMXDataKeys.KEY_PID);
<span class="line-modified"> 92 				// NOTE: We would like to have the JVM type, architecture and vendor included in the JDP payload. We should probably file an enhancement request on JDK for this.</span>
 93 				JVMDescriptor jvmInfo = new JVMDescriptor(null, JVMType.UNKNOWN, JVMArch.UNKNOWN, commandLine, null,
<span class="line-modified"> 94 						null, pid == null ? null : Integer.parseInt(pid), false, Connectable.MGMNT_AGENT_STARTED);</span>
 95 				String path = null;
 96 				if (name == null) {
 97 				} else if (name.endsWith(PATH_SEPARATOR)) {
 98 					path = name;
 99 					name = null;
100 				} else {
101 					int index = name.lastIndexOf(&#39;/&#39;);
102 					if (index != -1) {
103 						path = name.substring(0, index);
104 						name = name.substring(index + 1);
105 					}
106 				}
107 				IServerDescriptor sd = IServerDescriptor.create(event.getDiscoverable().getSessionId(), name, jvmInfo);
108 				try {
109 					onDescriptorDetected(sd, path, new JMXServiceURL(url), null);
110 				} catch (Exception e) {
111 					JDPPlugin.getDefault().getLogger().log(Level.SEVERE, &quot;Got broken event from JDP: &quot; + url, e); //$NON-NLS-1$
112 				}
113 			}
114 		}
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>