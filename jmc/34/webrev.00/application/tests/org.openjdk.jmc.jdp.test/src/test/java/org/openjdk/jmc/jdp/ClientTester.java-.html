<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old application/tests/org.openjdk.jmc.jdp.test/src/test/java/org/openjdk/jmc/jdp/ClientTester.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.
  3  * 
  4  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  5  *
  6  * The contents of this file are subject to the terms of either the Universal Permissive License
  7  * v 1.0 as shown at http://oss.oracle.com/licenses/upl
  8  *
  9  * or the following license:
 10  *
 11  * Redistribution and use in source and binary forms, with or without modification, are permitted
 12  * provided that the following conditions are met:
 13  * 
 14  * 1. Redistributions of source code must retain the above copyright notice, this list of conditions
 15  * and the following disclaimer.
 16  * 
 17  * 2. Redistributions in binary form must reproduce the above copyright notice, this list of
 18  * conditions and the following disclaimer in the documentation and/or other materials provided with
 19  * the distribution.
 20  * 
 21  * 3. Neither the name of the copyright holder nor the names of its contributors may be used to
 22  * endorse or promote products derived from this software without specific prior written permission.
 23  * 
 24  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR
 25  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 26  * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 27  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 28  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 29  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 30  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 31  * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 32  */
 33 package org.openjdk.jmc.jdp;
 34 
 35 import java.io.IOException;
 36 import java.io.StringWriter;
 37 import java.net.InetAddress;
 38 import java.net.UnknownHostException;
 39 import java.util.HashMap;
 40 import java.util.Map;
 41 import java.util.Map.Entry;
 42 
 43 import org.openjdk.jmc.jdp.client.DiscoveryEvent;
 44 import org.openjdk.jmc.jdp.client.DiscoveryListener;
 45 import org.openjdk.jmc.jdp.client.JDPClient;
 46 import org.openjdk.jmc.jdp.common.Configuration;
 47 
 48 /**
 49  * Prints whatever JDP packets that are discovered on stdout.
 50  */
 51 @SuppressWarnings(&quot;nls&quot;)
 52 public class ClientTester {
 53 	private static final String MULTICAST_PORT = &quot;-port&quot;;
 54 	private static final String MULTICAST_ADDRESS = &quot;-address&quot;;
 55 
 56 	static class Listener implements DiscoveryListener {
 57 		@Override
 58 		public void onDiscovery(DiscoveryEvent event) {
 59 			System.out.println(String.format(&quot;Event: %s session %s&quot;, event.getKind().toString(),
 60 					event.getDiscoverable().getSessionId()));
 61 			System.out.println(String.format(&quot;Data:%n%s&quot;, printMap(event.getDiscoverable().getPayload())));
 62 		}
 63 
 64 		private String printMap(Map&lt;String, String&gt; map) {
 65 			StringWriter sw = new StringWriter();
 66 			for (Entry&lt;String, String&gt; entry : map.entrySet()) {
 67 				sw.append(String.format(&quot;\t%-26s\t%-20s%n&quot;, entry.getKey(), entry.getValue()));
 68 			}
 69 			return sw.toString();
 70 		}
 71 	}
 72 
 73 	public static void main(String[] args) throws IOException {
 74 		Map&lt;String, String&gt; commands = parseArguments(args);
 75 		JDPClient client = createClient(commands);
 76 		client.addDiscoveryListener(new Listener());
 77 		client.start();
 78 		System.out.println(&quot;Press enter to quit&quot;);
 79 		System.in.read();
 80 		client.stop();
 81 	}
 82 
 83 	private static JDPClient createClient(Map&lt;String, String&gt; commands) throws UnknownHostException {
 84 		int port = Integer.parseInt(commands.get(MULTICAST_PORT));
 85 		InetAddress address = InetAddress.getByName(commands.get(MULTICAST_ADDRESS));
 86 		return new JDPClient(address, port, Configuration.DEFAULT_MAX_HEART_BEAT_TIMEOUT);
 87 	}
 88 
 89 	private static HashMap&lt;String, String&gt; parseArguments(String[] args) {
 90 		HashMap&lt;String, String&gt; commandMap = new HashMap&lt;&gt;();
 91 		commandMap.put(MULTICAST_ADDRESS, Configuration.DEFAULT_MULTICAST_ADDRESS);
 92 		commandMap.put(MULTICAST_PORT, Integer.toString(Configuration.DEFAULT_MULTICAST_PORT));
 93 
 94 		for (int i = 0; i &lt; args.length; i++) {
 95 			if (args[i].startsWith(&quot;-&quot;)) {
 96 				StringBuilder buf = new StringBuilder();
 97 				int j = i + 1;
 98 				while (j &lt; args.length &amp;&amp; !args[j].startsWith(&quot;-&quot;)) {
 99 					buf.append(&quot; &quot;);
100 					buf.append(args[j++]);
101 				}
102 				commandMap.put(args[i], buf.toString().trim());
103 				i = j - 1;
104 			}
105 		}
106 		return commandMap;
107 	}
108 }
    </pre>
  </body>
</html>