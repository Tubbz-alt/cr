<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff application/org.openjdk.jmc.alert/src/main/java/org/openjdk/jmc/alert/AlertDialog.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>application/org.openjdk.jmc.alert/src/main/java/org/openjdk/jmc/alert/AlertDialog.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,253 +1,253 @@</span>
<span class="udiff-line-modified-removed">- /*</span>
<span class="udiff-line-modified-removed">-  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-removed">-  * </span>
<span class="udiff-line-modified-removed">-  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<span class="udiff-line-modified-removed">-  *</span>
<span class="udiff-line-modified-removed">-  * The contents of this file are subject to the terms of either the Universal Permissive License</span>
<span class="udiff-line-modified-removed">-  * v 1.0 as shown at http://oss.oracle.com/licenses/upl</span>
<span class="udiff-line-modified-removed">-  *</span>
<span class="udiff-line-modified-removed">-  * or the following license:</span>
<span class="udiff-line-modified-removed">-  *</span>
<span class="udiff-line-modified-removed">-  * Redistribution and use in source and binary forms, with or without modification, are permitted</span>
<span class="udiff-line-modified-removed">-  * provided that the following conditions are met:</span>
<span class="udiff-line-modified-removed">-  * </span>
<span class="udiff-line-modified-removed">-  * 1. Redistributions of source code must retain the above copyright notice, this list of conditions</span>
<span class="udiff-line-modified-removed">-  * and the following disclaimer.</span>
<span class="udiff-line-modified-removed">-  * </span>
<span class="udiff-line-modified-removed">-  * 2. Redistributions in binary form must reproduce the above copyright notice, this list of</span>
<span class="udiff-line-modified-removed">-  * conditions and the following disclaimer in the documentation and/or other materials provided with</span>
<span class="udiff-line-modified-removed">-  * the distribution.</span>
<span class="udiff-line-modified-removed">-  * </span>
<span class="udiff-line-modified-removed">-  * 3. Neither the name of the copyright holder nor the names of its contributors may be used to</span>
<span class="udiff-line-modified-removed">-  * endorse or promote products derived from this software without specific prior written permission.</span>
<span class="udiff-line-modified-removed">-  * </span>
<span class="udiff-line-modified-removed">-  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR</span>
<span class="udiff-line-modified-removed">-  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND</span>
<span class="udiff-line-modified-removed">-  * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR</span>
<span class="udiff-line-modified-removed">-  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="udiff-line-modified-removed">-  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="udiff-line-modified-removed">-  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span>
<span class="udiff-line-modified-removed">-  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY</span>
<span class="udiff-line-modified-removed">-  * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="udiff-line-modified-removed">-  */</span>
<span class="udiff-line-modified-removed">- package org.openjdk.jmc.alert;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- import java.text.DateFormat;</span>
<span class="udiff-line-modified-removed">- import java.util.ArrayList;</span>
<span class="udiff-line-modified-removed">- import java.util.Comparator;</span>
<span class="udiff-line-modified-removed">- import java.util.List;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- import org.eclipse.jface.dialogs.IDialogConstants;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.jface.dialogs.TitleAreaDialog;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.jface.viewers.ArrayContentProvider;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.jface.viewers.ISelectionChangedListener;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.jface.viewers.IStructuredSelection;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.jface.viewers.SelectionChangedEvent;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.jface.viewers.TableViewer;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.SWT;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.custom.SashForm;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.events.SelectionEvent;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.events.SelectionListener;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.graphics.Color;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.graphics.Image;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.layout.GridData;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.layout.GridLayout;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.widgets.Button;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.widgets.Composite;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.widgets.Control;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.widgets.Display;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.widgets.Shell;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.widgets.Table;</span>
<span class="udiff-line-modified-removed">- import org.eclipse.swt.widgets.Text;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- import org.openjdk.jmc.ui.UIPlugin;</span>
<span class="udiff-line-modified-removed">- import org.openjdk.jmc.ui.column.ColumnBuilder;</span>
<span class="udiff-line-modified-removed">- import org.openjdk.jmc.ui.column.ColumnManager;</span>
<span class="udiff-line-modified-removed">- import org.openjdk.jmc.ui.column.IColumn;</span>
<span class="udiff-line-modified-removed">- import org.openjdk.jmc.ui.misc.DisplayToolkit;</span>
<span class="udiff-line-modified-removed">- import org.openjdk.jmc.ui.misc.TypedLabelProvider;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- public class AlertDialog extends TitleAreaDialog {</span>
<span class="udiff-line-modified-removed">- 	private Button m_clearButton;</span>
<span class="udiff-line-modified-removed">- 	private Text m_text;</span>
<span class="udiff-line-modified-removed">- 	private TableViewer m_viewer;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	@Override</span>
<span class="udiff-line-modified-removed">- 	protected void createButtonsForButtonBar(Composite parent) {</span>
<span class="udiff-line-modified-removed">- 		createPopupButton(parent);</span>
<span class="udiff-line-modified-removed">- 		createClearButton(parent);</span>
<span class="udiff-line-modified-removed">- 		createButton(parent, IDialogConstants.OK_ID, IDialogConstants.CLOSE_LABEL, true);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private void createPopupButton(Composite parent) {</span>
<span class="udiff-line-modified-removed">- 		((GridLayout) parent.getLayout()).numColumns++;</span>
<span class="udiff-line-modified-removed">- 		final Button button = new Button(parent, SWT.CHECK);</span>
<span class="udiff-line-modified-removed">- 		button.setText(Messages.AlertDialog_POP_UP_ON_ALERTS_TEXT);</span>
<span class="udiff-line-modified-removed">- 		button.setSelection(AlertPlugin.getDefault().getPopup());</span>
<span class="udiff-line-modified-removed">- 		button.addSelectionListener(new SelectionListener() {</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 			@Override</span>
<span class="udiff-line-modified-removed">- 			public void widgetDefaultSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-removed">- 				// not used</span>
<span class="udiff-line-modified-removed">- 			}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 			@Override</span>
<span class="udiff-line-modified-removed">- 			public void widgetSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-removed">- 				if (button != null &amp;&amp; !button.isDisposed()) {</span>
<span class="udiff-line-modified-removed">- 					AlertPlugin.getDefault().setPopup(button.getSelection());</span>
<span class="udiff-line-modified-removed">- 				}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 			}</span>
<span class="udiff-line-modified-removed">- 		});</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	protected void createClearButton(Composite parent) {</span>
<span class="udiff-line-modified-removed">- 		m_clearButton = createButton(parent, IDialogConstants.CLIENT_ID, Messages.AlertDialog_CLEAR_ALERTS_TEXT0, true);</span>
<span class="udiff-line-modified-removed">- 		m_clearButton.addSelectionListener(new SelectionListener() {</span>
<span class="udiff-line-modified-removed">- 			@Override</span>
<span class="udiff-line-modified-removed">- 			public void widgetDefaultSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-removed">- 				// not used</span>
<span class="udiff-line-modified-removed">- 			}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 			@Override</span>
<span class="udiff-line-modified-removed">- 			public void widgetSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-removed">- 				AlertPlugin.getDefault().clearNotificationEventLog();</span>
<span class="udiff-line-modified-removed">- 				m_text.setText(&quot;&quot;); //$NON-NLS-1$</span>
<span class="udiff-line-modified-removed">- 				m_viewer.setInput(null);</span>
<span class="udiff-line-modified-removed">- 			}</span>
<span class="udiff-line-modified-removed">- 		});</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private static class AlertLabelProvider extends TypedLabelProvider&lt;AlertObject&gt; {</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		public AlertLabelProvider() {</span>
<span class="udiff-line-modified-removed">- 			super(AlertObject.class);</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		@Override</span>
<span class="udiff-line-modified-removed">- 		protected Color getForegroundTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-removed">- 			return ao.getException() == null ? null : Display.getCurrent().getSystemColor(SWT.COLOR_RED);</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		@Override</span>
<span class="udiff-line-modified-removed">- 		protected Color getBackgroundTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-removed">- 			return ao.getException() == null ? null : Display.getCurrent().getSystemColor(SWT.COLOR_YELLOW);</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private static class DateLabelProvider extends AlertLabelProvider {</span>
<span class="udiff-line-modified-removed">- 		DateFormat df = DateFormat.getDateTimeInstance();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		@Override</span>
<span class="udiff-line-modified-removed">- 		protected String getTextTyped(AlertObject element) {</span>
<span class="udiff-line-modified-removed">- 			return df.format(element.getCreationTime());</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		@Override</span>
<span class="udiff-line-modified-removed">- 		protected Image getImageTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-removed">- 			boolean ex = ao.getException() != null;</span>
<span class="udiff-line-modified-removed">- 			return UIPlugin.getDefault().getImage(ex ? UIPlugin.ICON_ALERT : UIPlugin.ICON_EXCEPTION);</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private static class RuleLabelProvider extends AlertLabelProvider {</span>
<span class="udiff-line-modified-removed">- 		@Override</span>
<span class="udiff-line-modified-removed">- 		protected String getTextTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-removed">- 			return ao.getRule().getRulePath() + &quot;\\&quot; + ao.getRule().getName(); //$NON-NLS-1$</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private static class SourceLabelProvider extends AlertLabelProvider {</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		@Override</span>
<span class="udiff-line-modified-removed">- 		protected String getTextTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-removed">- 			return ao.getSourceName();</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private static class DateComparator implements Comparator&lt;Object&gt; {</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		@Override</span>
<span class="udiff-line-modified-removed">- 		public int compare(Object o1, Object o2) {</span>
<span class="udiff-line-modified-removed">- 			return ((AlertObject) o1).getCreationTime().compareTo(((AlertObject) o2).getCreationTime());</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	public AlertDialog(Shell parentShell) {</span>
<span class="udiff-line-modified-removed">- 		super(parentShell);</span>
<span class="udiff-line-modified-removed">- 		setTitleImage(AlertPlugin.getDefault().getImage(AlertPlugin.IMAGE_ALERT_BANNER));</span>
<span class="udiff-line-modified-removed">- 		setShellStyle(SWT.DIALOG_TRIM | getDefaultOrientation() | SWT.RESIZE | SWT.MAX);</span>
<span class="udiff-line-modified-removed">- 		setBlockOnOpen(false);</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	@Override</span>
<span class="udiff-line-modified-removed">- 	protected Control createContents(Composite parent) {</span>
<span class="udiff-line-modified-removed">- 		getShell().setText(Messages.AlertDialog_DIALOG_TITLE);</span>
<span class="udiff-line-modified-removed">- 		getShell().setImage(UIPlugin.getDefault().getImage(UIPlugin.ICON_ALERT));</span>
<span class="udiff-line-modified-removed">- 		Control contents = super.createContents(parent);</span>
<span class="udiff-line-modified-removed">- 		setTitle(Messages.AlertDialog_DIALOG_TITLE);</span>
<span class="udiff-line-modified-removed">- 		setMessage(Messages.AlertDialog_DIALOG_MESSAGE);</span>
<span class="udiff-line-modified-removed">- 		DisplayToolkit.placeDialogInCenter(getParentShell(), getShell());</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		return contents;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	@Override</span>
<span class="udiff-line-modified-removed">- 	protected Control createDialogArea(Composite parent) {</span>
<span class="udiff-line-modified-removed">- 		Control dialogArea = super.createDialogArea(parent);</span>
<span class="udiff-line-modified-removed">- 		SashForm sash = new SashForm((Composite) dialogArea, SWT.VERTICAL);</span>
<span class="udiff-line-modified-removed">- 		sash.setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, true));</span>
<span class="udiff-line-modified-removed">- 		TableViewer viewer = createViewer(sash);</span>
<span class="udiff-line-modified-removed">- 		viewer.getTable().setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, true));</span>
<span class="udiff-line-modified-removed">- 		m_text = createMessage(sash);</span>
<span class="udiff-line-modified-removed">- 		m_text.setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, false));</span>
<span class="udiff-line-modified-removed">- 		sash.setWeights(new int[] {75, 25});</span>
<span class="udiff-line-modified-removed">- 		sash.setLayout(new GridLayout());</span>
<span class="udiff-line-modified-removed">- 		return dialogArea;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	private Text createMessage(Composite parent) {</span>
<span class="udiff-line-modified-removed">- 		Text text = new Text(parent, SWT.MULTI | SWT.READ_ONLY | SWT.V_SCROLL | SWT.BORDER | SWT.WRAP);</span>
<span class="udiff-line-modified-removed">- 		return text;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	public void select(AlertObject alertObject) {</span>
<span class="udiff-line-modified-removed">- 		m_text.setText(alertObject.getMessage());</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	public TableViewer createViewer(Composite parent) {</span>
<span class="udiff-line-modified-removed">- 		Table table = new Table(parent, SWT.FLAT | SWT.MULTI | SWT.FULL_SELECTION | SWT.BORDER);</span>
<span class="udiff-line-modified-removed">- 		m_viewer = new TableViewer(table);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		List&lt;IColumn&gt; columns = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-modified-removed">- 		columns.add(new ColumnBuilder(Messages.AlertDialog_COLUMN_HEADER_DATE, &quot;date&quot;, new DateLabelProvider()) //$NON-NLS-1$</span>
<span class="udiff-line-modified-removed">- 				.comparator(new DateComparator()).build());</span>
<span class="udiff-line-modified-removed">- 		columns.add(</span>
<span class="udiff-line-modified-removed">- 				new ColumnBuilder(Messages.AlertDialog_COLUMN_HEADER_RULE, &quot;rule&quot;, new RuleLabelProvider()).build()); //$NON-NLS-1$</span>
<span class="udiff-line-modified-removed">- 		columns.add(new ColumnBuilder(Messages.AlertDialog_COLUMN_HEADER_SOURCE, &quot;source&quot;, new SourceLabelProvider()) //$NON-NLS-1$</span>
<span class="udiff-line-modified-removed">- 				.build());</span>
<span class="udiff-line-modified-removed">- 		ColumnManager.build(m_viewer, columns, null);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		m_viewer.addSelectionChangedListener(new ISelectionChangedListener() {</span>
<span class="udiff-line-modified-removed">- 			@Override</span>
<span class="udiff-line-modified-removed">- 			public void selectionChanged(SelectionChangedEvent event) {</span>
<span class="udiff-line-modified-removed">- 				IStructuredSelection ssel = (IStructuredSelection) event.getSelection();</span>
<span class="udiff-line-modified-removed">- 				if (ssel.size() &gt;= 1) {</span>
<span class="udiff-line-modified-removed">- 					select((AlertObject) ssel.getFirstElement());</span>
<span class="udiff-line-modified-removed">- 				}</span>
<span class="udiff-line-modified-removed">- 			}</span>
<span class="udiff-line-modified-removed">- 		});</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 		m_viewer.setContentProvider(ArrayContentProvider.getInstance());</span>
<span class="udiff-line-modified-removed">- 		m_viewer.setInput(AlertPlugin.getDefault().getAlerts());</span>
<span class="udiff-line-modified-removed">- 		return m_viewer;</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- 	public void refreshAlertDialog() {</span>
<span class="udiff-line-modified-removed">- 		if (m_viewer != null &amp;&amp; !m_viewer.getTable().isDisposed()) {</span>
<span class="udiff-line-modified-removed">- 			m_viewer.setInput(AlertPlugin.getDefault().getAlerts());</span>
<span class="udiff-line-modified-removed">- 		}</span>
<span class="udiff-line-modified-removed">- 	}</span>
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-added">+ /*</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * </span>
<span class="udiff-line-modified-added">+  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * The contents of this file are subject to the terms of either the Universal Permissive License</span>
<span class="udiff-line-modified-added">+  * v 1.0 as shown at http://oss.oracle.com/licenses/upl</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * or the following license:</span>
<span class="udiff-line-modified-added">+  *</span>
<span class="udiff-line-modified-added">+  * Redistribution and use in source and binary forms, with or without modification, are permitted</span>
<span class="udiff-line-modified-added">+  * provided that the following conditions are met:</span>
<span class="udiff-line-modified-added">+  * </span>
<span class="udiff-line-modified-added">+  * 1. Redistributions of source code must retain the above copyright notice, this list of conditions</span>
<span class="udiff-line-modified-added">+  * and the following disclaimer.</span>
<span class="udiff-line-modified-added">+  * </span>
<span class="udiff-line-modified-added">+  * 2. Redistributions in binary form must reproduce the above copyright notice, this list of</span>
<span class="udiff-line-modified-added">+  * conditions and the following disclaimer in the documentation and/or other materials provided with</span>
<span class="udiff-line-modified-added">+  * the distribution.</span>
<span class="udiff-line-modified-added">+  * </span>
<span class="udiff-line-modified-added">+  * 3. Neither the name of the copyright holder nor the names of its contributors may be used to</span>
<span class="udiff-line-modified-added">+  * endorse or promote products derived from this software without specific prior written permission.</span>
<span class="udiff-line-modified-added">+  * </span>
<span class="udiff-line-modified-added">+  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR</span>
<span class="udiff-line-modified-added">+  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND</span>
<span class="udiff-line-modified-added">+  * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR</span>
<span class="udiff-line-modified-added">+  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="udiff-line-modified-added">+  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="udiff-line-modified-added">+  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span>
<span class="udiff-line-modified-added">+  * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY</span>
<span class="udiff-line-modified-added">+  * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="udiff-line-modified-added">+  */</span>
<span class="udiff-line-modified-added">+ package org.openjdk.jmc.alert;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ import java.text.DateFormat;</span>
<span class="udiff-line-modified-added">+ import java.util.ArrayList;</span>
<span class="udiff-line-modified-added">+ import java.util.Comparator;</span>
<span class="udiff-line-modified-added">+ import java.util.List;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ import org.eclipse.jface.dialogs.IDialogConstants;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.jface.dialogs.TitleAreaDialog;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.jface.viewers.ArrayContentProvider;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.jface.viewers.ISelectionChangedListener;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.jface.viewers.IStructuredSelection;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.jface.viewers.SelectionChangedEvent;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.jface.viewers.TableViewer;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.SWT;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.custom.SashForm;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.events.SelectionEvent;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.events.SelectionListener;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.graphics.Color;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.graphics.Image;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.layout.GridData;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.layout.GridLayout;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.widgets.Button;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.widgets.Composite;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.widgets.Control;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.widgets.Display;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.widgets.Shell;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.widgets.Table;</span>
<span class="udiff-line-modified-added">+ import org.eclipse.swt.widgets.Text;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ import org.openjdk.jmc.ui.UIPlugin;</span>
<span class="udiff-line-modified-added">+ import org.openjdk.jmc.ui.column.ColumnBuilder;</span>
<span class="udiff-line-modified-added">+ import org.openjdk.jmc.ui.column.ColumnManager;</span>
<span class="udiff-line-modified-added">+ import org.openjdk.jmc.ui.column.IColumn;</span>
<span class="udiff-line-modified-added">+ import org.openjdk.jmc.ui.misc.DisplayToolkit;</span>
<span class="udiff-line-modified-added">+ import org.openjdk.jmc.ui.misc.TypedLabelProvider;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ public class AlertDialog extends TitleAreaDialog {</span>
<span class="udiff-line-modified-added">+ 	private Button m_clearButton;</span>
<span class="udiff-line-modified-added">+ 	private Text m_text;</span>
<span class="udiff-line-modified-added">+ 	private TableViewer m_viewer;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	@Override</span>
<span class="udiff-line-modified-added">+ 	protected void createButtonsForButtonBar(Composite parent) {</span>
<span class="udiff-line-modified-added">+ 		createPopupButton(parent);</span>
<span class="udiff-line-modified-added">+ 		createClearButton(parent);</span>
<span class="udiff-line-modified-added">+ 		createButton(parent, IDialogConstants.OK_ID, IDialogConstants.CLOSE_LABEL, true);</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	private void createPopupButton(Composite parent) {</span>
<span class="udiff-line-modified-added">+ 		((GridLayout) parent.getLayout()).numColumns++;</span>
<span class="udiff-line-modified-added">+ 		final Button button = new Button(parent, SWT.CHECK);</span>
<span class="udiff-line-modified-added">+ 		button.setText(Messages.AlertDialog_POP_UP_ON_ALERTS_TEXT);</span>
<span class="udiff-line-modified-added">+ 		button.setSelection(AlertPlugin.getDefault().getPopup());</span>
<span class="udiff-line-modified-added">+ 		button.addSelectionListener(new SelectionListener() {</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 			@Override</span>
<span class="udiff-line-modified-added">+ 			public void widgetDefaultSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-added">+ 				// not used</span>
<span class="udiff-line-modified-added">+ 			}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 			@Override</span>
<span class="udiff-line-modified-added">+ 			public void widgetSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-added">+ 				if (button != null &amp;&amp; !button.isDisposed()) {</span>
<span class="udiff-line-modified-added">+ 					AlertPlugin.getDefault().setPopup(button.getSelection());</span>
<span class="udiff-line-modified-added">+ 				}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 			}</span>
<span class="udiff-line-modified-added">+ 		});</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	protected void createClearButton(Composite parent) {</span>
<span class="udiff-line-modified-added">+ 		m_clearButton = createButton(parent, IDialogConstants.CLIENT_ID, Messages.AlertDialog_CLEAR_ALERTS_TEXT0, true);</span>
<span class="udiff-line-modified-added">+ 		m_clearButton.addSelectionListener(new SelectionListener() {</span>
<span class="udiff-line-modified-added">+ 			@Override</span>
<span class="udiff-line-modified-added">+ 			public void widgetDefaultSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-added">+ 				// not used</span>
<span class="udiff-line-modified-added">+ 			}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 			@Override</span>
<span class="udiff-line-modified-added">+ 			public void widgetSelected(SelectionEvent e) {</span>
<span class="udiff-line-modified-added">+ 				AlertPlugin.getDefault().clearNotificationEventLog();</span>
<span class="udiff-line-modified-added">+ 				m_text.setText(&quot;&quot;); //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 				m_viewer.setInput(null);</span>
<span class="udiff-line-modified-added">+ 			}</span>
<span class="udiff-line-modified-added">+ 		});</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	private static class AlertLabelProvider extends TypedLabelProvider&lt;AlertObject&gt; {</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		public AlertLabelProvider() {</span>
<span class="udiff-line-modified-added">+ 			super(AlertObject.class);</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		@Override</span>
<span class="udiff-line-modified-added">+ 		protected Color getForegroundTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-added">+ 			return ao.getException() == null ? null : Display.getCurrent().getSystemColor(SWT.COLOR_RED);</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		@Override</span>
<span class="udiff-line-modified-added">+ 		protected Color getBackgroundTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-added">+ 			return ao.getException() == null ? null : Display.getCurrent().getSystemColor(SWT.COLOR_YELLOW);</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	private static class DateLabelProvider extends AlertLabelProvider {</span>
<span class="udiff-line-modified-added">+ 		DateFormat df = DateFormat.getDateTimeInstance();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		@Override</span>
<span class="udiff-line-modified-added">+ 		protected String getTextTyped(AlertObject element) {</span>
<span class="udiff-line-modified-added">+ 			return df.format(element.getCreationTime());</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		@Override</span>
<span class="udiff-line-modified-added">+ 		protected Image getImageTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-added">+ 			boolean ex = ao.getException() != null;</span>
<span class="udiff-line-modified-added">+ 			return UIPlugin.getDefault().getImage(ex ? UIPlugin.ICON_ALERT : UIPlugin.ICON_EXCEPTION);</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	private static class RuleLabelProvider extends AlertLabelProvider {</span>
<span class="udiff-line-modified-added">+ 		@Override</span>
<span class="udiff-line-modified-added">+ 		protected String getTextTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-added">+ 			return ao.getRule().getRulePath() + &quot;\\&quot; + ao.getRule().getName(); //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	private static class SourceLabelProvider extends AlertLabelProvider {</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		@Override</span>
<span class="udiff-line-modified-added">+ 		protected String getTextTyped(AlertObject ao) {</span>
<span class="udiff-line-modified-added">+ 			return ao.getSourceName();</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	private static class DateComparator implements Comparator&lt;Object&gt; {</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		@Override</span>
<span class="udiff-line-modified-added">+ 		public int compare(Object o1, Object o2) {</span>
<span class="udiff-line-modified-added">+ 			return ((AlertObject) o1).getCreationTime().compareTo(((AlertObject) o2).getCreationTime());</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	public AlertDialog(Shell parentShell) {</span>
<span class="udiff-line-modified-added">+ 		super(parentShell);</span>
<span class="udiff-line-modified-added">+ 		setTitleImage(AlertPlugin.getDefault().getImage(AlertPlugin.IMAGE_ALERT_BANNER));</span>
<span class="udiff-line-modified-added">+ 		setShellStyle(SWT.DIALOG_TRIM | getDefaultOrientation() | SWT.RESIZE | SWT.MAX);</span>
<span class="udiff-line-modified-added">+ 		setBlockOnOpen(false);</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	@Override</span>
<span class="udiff-line-modified-added">+ 	protected Control createContents(Composite parent) {</span>
<span class="udiff-line-modified-added">+ 		getShell().setText(Messages.AlertDialog_DIALOG_TITLE);</span>
<span class="udiff-line-modified-added">+ 		getShell().setImage(UIPlugin.getDefault().getImage(UIPlugin.ICON_ALERT));</span>
<span class="udiff-line-modified-added">+ 		Control contents = super.createContents(parent);</span>
<span class="udiff-line-modified-added">+ 		setTitle(Messages.AlertDialog_DIALOG_TITLE);</span>
<span class="udiff-line-modified-added">+ 		setMessage(Messages.AlertDialog_DIALOG_MESSAGE);</span>
<span class="udiff-line-modified-added">+ 		DisplayToolkit.placeDialogInCenter(getParentShell(), getShell());</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		return contents;</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	@Override</span>
<span class="udiff-line-modified-added">+ 	protected Control createDialogArea(Composite parent) {</span>
<span class="udiff-line-modified-added">+ 		Control dialogArea = super.createDialogArea(parent);</span>
<span class="udiff-line-modified-added">+ 		SashForm sash = new SashForm((Composite) dialogArea, SWT.VERTICAL);</span>
<span class="udiff-line-modified-added">+ 		sash.setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, true));</span>
<span class="udiff-line-modified-added">+ 		TableViewer viewer = createViewer(sash);</span>
<span class="udiff-line-modified-added">+ 		viewer.getTable().setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, true));</span>
<span class="udiff-line-modified-added">+ 		m_text = createMessage(sash);</span>
<span class="udiff-line-modified-added">+ 		m_text.setLayoutData(new GridData(SWT.FILL, SWT.FILL, true, false));</span>
<span class="udiff-line-modified-added">+ 		sash.setWeights(new int[] {75, 25});</span>
<span class="udiff-line-modified-added">+ 		sash.setLayout(new GridLayout());</span>
<span class="udiff-line-modified-added">+ 		return dialogArea;</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	private Text createMessage(Composite parent) {</span>
<span class="udiff-line-modified-added">+ 		Text text = new Text(parent, SWT.MULTI | SWT.READ_ONLY | SWT.V_SCROLL | SWT.BORDER | SWT.WRAP);</span>
<span class="udiff-line-modified-added">+ 		return text;</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	public void select(AlertObject alertObject) {</span>
<span class="udiff-line-modified-added">+ 		m_text.setText(alertObject.getMessage());</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	public TableViewer createViewer(Composite parent) {</span>
<span class="udiff-line-modified-added">+ 		Table table = new Table(parent, SWT.FLAT | SWT.MULTI | SWT.FULL_SELECTION | SWT.BORDER);</span>
<span class="udiff-line-modified-added">+ 		m_viewer = new TableViewer(table);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		List&lt;IColumn&gt; columns = new ArrayList&lt;&gt;();</span>
<span class="udiff-line-modified-added">+ 		columns.add(new ColumnBuilder(Messages.AlertDialog_COLUMN_HEADER_DATE, &quot;date&quot;, new DateLabelProvider()) //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 				.comparator(new DateComparator()).build());</span>
<span class="udiff-line-modified-added">+ 		columns.add(</span>
<span class="udiff-line-modified-added">+ 				new ColumnBuilder(Messages.AlertDialog_COLUMN_HEADER_RULE, &quot;rule&quot;, new RuleLabelProvider()).build()); //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 		columns.add(new ColumnBuilder(Messages.AlertDialog_COLUMN_HEADER_SOURCE, &quot;source&quot;, new SourceLabelProvider()) //$NON-NLS-1$</span>
<span class="udiff-line-modified-added">+ 				.build());</span>
<span class="udiff-line-modified-added">+ 		ColumnManager.build(m_viewer, columns, null);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		m_viewer.addSelectionChangedListener(new ISelectionChangedListener() {</span>
<span class="udiff-line-modified-added">+ 			@Override</span>
<span class="udiff-line-modified-added">+ 			public void selectionChanged(SelectionChangedEvent event) {</span>
<span class="udiff-line-modified-added">+ 				IStructuredSelection ssel = (IStructuredSelection) event.getSelection();</span>
<span class="udiff-line-modified-added">+ 				if (ssel.size() &gt;= 1) {</span>
<span class="udiff-line-modified-added">+ 					select((AlertObject) ssel.getFirstElement());</span>
<span class="udiff-line-modified-added">+ 				}</span>
<span class="udiff-line-modified-added">+ 			}</span>
<span class="udiff-line-modified-added">+ 		});</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 		m_viewer.setContentProvider(ArrayContentProvider.getInstance());</span>
<span class="udiff-line-modified-added">+ 		m_viewer.setInput(AlertPlugin.getDefault().getAlerts());</span>
<span class="udiff-line-modified-added">+ 		return m_viewer;</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ 	public void refreshAlertDialog() {</span>
<span class="udiff-line-modified-added">+ 		if (m_viewer != null &amp;&amp; !m_viewer.getTable().isDisposed()) {</span>
<span class="udiff-line-modified-added">+ 			m_viewer.setInput(AlertPlugin.getDefault().getAlerts());</span>
<span class="udiff-line-modified-added">+ 		}</span>
<span class="udiff-line-modified-added">+ 	}</span>
<span class="udiff-line-modified-added">+ }</span>
</pre>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>