<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff application/org.openjdk.jmc.flightrecorder.controlpanel.ui/src/main/java/org/openjdk/jmc/flightrecorder/controlpanel/ui/model/EventConfiguration.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../jobs/UpdateRecordingJob.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="PrivateStorageDelegate.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>application/org.openjdk.jmc.flightrecorder.controlpanel.ui/src/main/java/org/openjdk/jmc/flightrecorder/controlpanel/ui/model/EventConfiguration.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 95 import org.openjdk.jmc.rjmx.services.jfr.IEventTypeInfo;
 96 import org.xml.sax.InputSource;
 97 import org.xml.sax.SAXException;
 98 
 99 /**
100  * Class that holds a JFR event configuration.
101  */
102 // FIXME: Make two different subclasses of this, V1 and V2?
103 public final class EventConfiguration implements IEventConfiguration {
104 
105 	private XMLModel xmlModel;
106 	private final IConfigurationStorageDelegate storageDelegate;
107 	private final SchemaVersion version;
108 	/**
109 	 * NOTE: This may be null. It is only non-null for working copies.
110 	 */
111 	private final IEventConfiguration original;
112 
113 	public static void validate(InputStream xmlStream, String streamName, SchemaVersion version)
114 			throws ParseException, IOException {
<span class="line-modified">115 		InputStream schemaStream = version.createSchemaStream();</span>
<span class="line-modified">116 		if (schemaStream != null) {</span>
<span class="line-removed">117 			try {</span>
118 				SchemaFactory schemaFactory = SchemaFactory.newInstance(&quot;http://www.w3.org/2001/XMLSchema&quot;); //$NON-NLS-1$
119 				XMLModel.validate(xmlStream, streamName, schemaFactory.newSchema(new StreamSource(schemaStream)));
<span class="line-modified">120 			} catch (SAXException e) {</span>
<span class="line-modified">121 				throw new IOException(&quot;Trouble parsing schema for version &quot; + version, e); //$NON-NLS-1$</span>
<span class="line-removed">122 			} finally {</span>
<span class="line-removed">123 				IOToolkit.closeSilently(schemaStream);</span>
124 			}
<span class="line-modified">125 		} else {</span>
<span class="line-modified">126 			throw new IOException(&quot;Could not locate schema for version &quot; + version); //$NON-NLS-1$</span>
127 		}
128 	}
129 
130 	public static IEventConfiguration createEmpty(IConfigurationStorageDelegate delegate, SchemaVersion version) {
131 		Map&lt;String, String&gt; attributes = Collections.singletonMap(JFCGrammar.ATTRIBUTE_VERSION.getName(),
132 				version.attributeValue());
133 		XMLModel model = XMLModel.createEmpty(JFCXMLValidator.getValidator(), attributes);
134 		IEventConfiguration config = new EventConfiguration(model, delegate, null);
135 		config.setName(Messages.RECORDING_TEMPLATE_NEW_NAME);
136 		return config;
137 	}
138 
139 	public static XMLModel createModel(String xmlText) throws ParseException, IOException {
140 		return XMLModel.create(new InputSource(new StringReader(xmlText)), JFCXMLValidator.getValidator());
141 	}
142 
143 	public static XMLModel createModel(File file) throws FileNotFoundException, IOException, ParseException {
<span class="line-modified">144 		return createModel(new FileInputStream(file));</span>


145 	}
146 
147 	public static XMLModel createModel(InputStream inStream) throws IOException, ParseException {
148 		XMLModel model;
149 		try {
150 			model = XMLModel.create(new InputSource(inStream), JFCXMLValidator.getValidator());
151 		} finally {
152 			IOToolkit.closeSilently(inStream);
153 		}
154 		return model;
155 	}
156 
157 	public EventConfiguration(XMLModel xml) {
158 		this(xml, VolatileStorageDelegate.getWorkingCopyDelegate(), null);
159 	}
160 
161 	public EventConfiguration(IConfigurationStorageDelegate delegate) throws IOException, ParseException {
162 		this(createModel(delegate.getContents()), delegate, null);
163 	}
164 
</pre>
</td>
<td>
<hr />
<pre>
 95 import org.openjdk.jmc.rjmx.services.jfr.IEventTypeInfo;
 96 import org.xml.sax.InputSource;
 97 import org.xml.sax.SAXException;
 98 
 99 /**
100  * Class that holds a JFR event configuration.
101  */
102 // FIXME: Make two different subclasses of this, V1 and V2?
103 public final class EventConfiguration implements IEventConfiguration {
104 
105 	private XMLModel xmlModel;
106 	private final IConfigurationStorageDelegate storageDelegate;
107 	private final SchemaVersion version;
108 	/**
109 	 * NOTE: This may be null. It is only non-null for working copies.
110 	 */
111 	private final IEventConfiguration original;
112 
113 	public static void validate(InputStream xmlStream, String streamName, SchemaVersion version)
114 			throws ParseException, IOException {
<span class="line-modified">115 		try (InputStream schemaStream = version.createSchemaStream()) {</span>
<span class="line-modified">116 			if (schemaStream != null) {</span>

117 				SchemaFactory schemaFactory = SchemaFactory.newInstance(&quot;http://www.w3.org/2001/XMLSchema&quot;); //$NON-NLS-1$
118 				XMLModel.validate(xmlStream, streamName, schemaFactory.newSchema(new StreamSource(schemaStream)));
<span class="line-modified">119 			} else {</span>
<span class="line-modified">120 				throw new IOException(&quot;Could not locate schema for version &quot; + version); //$NON-NLS-1$</span>


121 			}
<span class="line-modified">122 		} catch (SAXException e) {</span>
<span class="line-modified">123 			throw new IOException(&quot;Trouble parsing schema for version &quot; + version, e); //$NON-NLS-1$</span>
124 		}
125 	}
126 
127 	public static IEventConfiguration createEmpty(IConfigurationStorageDelegate delegate, SchemaVersion version) {
128 		Map&lt;String, String&gt; attributes = Collections.singletonMap(JFCGrammar.ATTRIBUTE_VERSION.getName(),
129 				version.attributeValue());
130 		XMLModel model = XMLModel.createEmpty(JFCXMLValidator.getValidator(), attributes);
131 		IEventConfiguration config = new EventConfiguration(model, delegate, null);
132 		config.setName(Messages.RECORDING_TEMPLATE_NEW_NAME);
133 		return config;
134 	}
135 
136 	public static XMLModel createModel(String xmlText) throws ParseException, IOException {
137 		return XMLModel.create(new InputSource(new StringReader(xmlText)), JFCXMLValidator.getValidator());
138 	}
139 
140 	public static XMLModel createModel(File file) throws FileNotFoundException, IOException, ParseException {
<span class="line-modified">141 		try (FileInputStream fis = new FileInputStream(file)) {</span>
<span class="line-added">142 			return createModel(fis);</span>
<span class="line-added">143 		}</span>
144 	}
145 
146 	public static XMLModel createModel(InputStream inStream) throws IOException, ParseException {
147 		XMLModel model;
148 		try {
149 			model = XMLModel.create(new InputSource(inStream), JFCXMLValidator.getValidator());
150 		} finally {
151 			IOToolkit.closeSilently(inStream);
152 		}
153 		return model;
154 	}
155 
156 	public EventConfiguration(XMLModel xml) {
157 		this(xml, VolatileStorageDelegate.getWorkingCopyDelegate(), null);
158 	}
159 
160 	public EventConfiguration(IConfigurationStorageDelegate delegate) throws IOException, ParseException {
161 		this(createModel(delegate.getContents()), delegate, null);
162 	}
163 
</pre>
</td>
</tr>
</table>
<center><a href="../jobs/UpdateRecordingJob.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="PrivateStorageDelegate.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>