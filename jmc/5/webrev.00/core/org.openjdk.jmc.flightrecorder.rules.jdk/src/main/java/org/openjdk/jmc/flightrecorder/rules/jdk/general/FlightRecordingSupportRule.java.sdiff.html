<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff core/org.openjdk.jmc.flightrecorder.rules.jdk/src/main/java/org/openjdk/jmc/flightrecorder/rules/jdk/general/FlightRecordingSupportRule.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DuplicateFlagsRule.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../latency/JavaBlockingRule.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>core/org.openjdk.jmc.flightrecorder.rules.jdk/src/main/java/org/openjdk/jmc/flightrecorder/rules/jdk/general/FlightRecordingSupportRule.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 62 
 63 	private static final String RESULT_ID = &quot;FlightRecordingSupport&quot;; //$NON-NLS-1$
 64 
 65 	// JavaVersionSupport defines JDK_7_U_40 as U 12, instead of explicitly using U12 where warranted.
 66 	// So, for now we define our own, real U_40.
 67 	private static final JavaVersion JDK_7_U_40 = new JavaVersion(7, 0, 40);
 68 
 69 	private Result getResult(IItemCollection items, IPreferenceValueProvider valueProvider) {
 70 		EventAvailability eventAvailability = RulesToolkit.getEventAvailability(items, JdkTypeIDs.VM_INFO);
 71 		if (eventAvailability != EventAvailability.AVAILABLE) {
 72 			return RulesToolkit.getEventAvailabilityResult(this, items, eventAvailability, JdkTypeIDs.VM_INFO);
 73 		}
 74 
 75 		Result versionResult = getVersionResult(items);
 76 		Result timeConversionResult = getTimeConversionResult(items);
 77 
 78 		double versionScore = versionResult.getScore();
 79 		double timeConversionScore = timeConversionResult.getScore();
 80 
 81 		if (versionScore &gt; 0 || timeConversionScore &gt; 0) {
<span class="line-modified"> 82 			return versionResult.getScore() &gt; timeConversionResult.getScore() ? versionResult : timeConversionResult;			</span>
 83 		}
 84 		// If no rule reported a warning or error, return the rule with the lowest score,
 85 		// meaning it was NotApplicable, Failed or Ignored.
 86 		return versionScore &lt; timeConversionScore ? versionResult : timeConversionResult;
 87 	}
 88 
 89 	@Override
 90 	public RunnableFuture&lt;Result&gt; evaluate(final IItemCollection items, final IPreferenceValueProvider valueProvider) {
 91 		FutureTask&lt;Result&gt; evaluationTask = new FutureTask&lt;&gt;(new Callable&lt;Result&gt;() {
 92 			@Override
 93 			public Result call() throws Exception {
 94 				return getResult(items, valueProvider);
 95 			}
 96 		});
 97 		return evaluationTask;
 98 	}
 99 
100 	@Override
101 	public Collection&lt;TypedPreference&lt;?&gt;&gt; getConfigurationAttributes() {
102 		return Collections.emptyList();
</pre>
<hr />
<pre>
105 	@Override
106 	public String getId() {
107 		return RESULT_ID;
108 	}
109 
110 	@Override
111 	public String getName() {
112 		return Messages.getString(Messages.FlightRecordingSupportRule_RULE_NAME);
113 	}
114 
115 	@Override
116 	public String getTopic() {
117 		return JfrRuleTopics.JVM_INFORMATION_TOPIC;
118 	}
119 
120 	private Result getVersionResult(String versionString) {
121 		JavaVersion usedVersion = RulesToolkit.getJavaVersion(versionString);
122 
123 		if (usedVersion == null) {
124 			return RulesToolkit.getNotApplicableResult(this,
<span class="line-modified">125                     Messages.getString(Messages.General_TEXT_COULD_NOT_DETERMINE_JAVA_VERSION));</span>
126 		}
127 
128 		if (!usedVersion.isGreaterOrEqualThan(JDK_7_U_40)) {
129 			return new Result(this, 100,
130 					Messages.getString(Messages.FlightRecordingSupportRule_UNSUPPORTED_TEXT_WARN_SHORT),
131 					MessageFormat.format(
132 							Messages.getString(Messages.FlightRecordingSupportRule_UNSUPPORTED_TEXT_WARN_LONG),
133 							versionString));
134 		}
135 
136 		if (usedVersion.isEarlyAccess()) {
137 			return new Result(this, 80, Messages.getString(Messages.FlightRecordingSupportRule_EA_TEXT_WARN_SHORT),
138 					MessageFormat.format(Messages.getString(Messages.FlightRecordingSupportRule_EA_TEXT_WARN_LONG),
139 							versionString));
140 		}
141 
142 		return new Result(this, 0, Messages.getString(Messages.FlightRecordingSupportRule_TEXT_OK));
143 	}
144 
145 	private Result getVersionResult(IItemCollection items) {
</pre>
</td>
<td>
<hr />
<pre>
 62 
 63 	private static final String RESULT_ID = &quot;FlightRecordingSupport&quot;; //$NON-NLS-1$
 64 
 65 	// JavaVersionSupport defines JDK_7_U_40 as U 12, instead of explicitly using U12 where warranted.
 66 	// So, for now we define our own, real U_40.
 67 	private static final JavaVersion JDK_7_U_40 = new JavaVersion(7, 0, 40);
 68 
 69 	private Result getResult(IItemCollection items, IPreferenceValueProvider valueProvider) {
 70 		EventAvailability eventAvailability = RulesToolkit.getEventAvailability(items, JdkTypeIDs.VM_INFO);
 71 		if (eventAvailability != EventAvailability.AVAILABLE) {
 72 			return RulesToolkit.getEventAvailabilityResult(this, items, eventAvailability, JdkTypeIDs.VM_INFO);
 73 		}
 74 
 75 		Result versionResult = getVersionResult(items);
 76 		Result timeConversionResult = getTimeConversionResult(items);
 77 
 78 		double versionScore = versionResult.getScore();
 79 		double timeConversionScore = timeConversionResult.getScore();
 80 
 81 		if (versionScore &gt; 0 || timeConversionScore &gt; 0) {
<span class="line-modified"> 82 			return versionResult.getScore() &gt; timeConversionResult.getScore() ? versionResult : timeConversionResult;</span>
 83 		}
 84 		// If no rule reported a warning or error, return the rule with the lowest score,
 85 		// meaning it was NotApplicable, Failed or Ignored.
 86 		return versionScore &lt; timeConversionScore ? versionResult : timeConversionResult;
 87 	}
 88 
 89 	@Override
 90 	public RunnableFuture&lt;Result&gt; evaluate(final IItemCollection items, final IPreferenceValueProvider valueProvider) {
 91 		FutureTask&lt;Result&gt; evaluationTask = new FutureTask&lt;&gt;(new Callable&lt;Result&gt;() {
 92 			@Override
 93 			public Result call() throws Exception {
 94 				return getResult(items, valueProvider);
 95 			}
 96 		});
 97 		return evaluationTask;
 98 	}
 99 
100 	@Override
101 	public Collection&lt;TypedPreference&lt;?&gt;&gt; getConfigurationAttributes() {
102 		return Collections.emptyList();
</pre>
<hr />
<pre>
105 	@Override
106 	public String getId() {
107 		return RESULT_ID;
108 	}
109 
110 	@Override
111 	public String getName() {
112 		return Messages.getString(Messages.FlightRecordingSupportRule_RULE_NAME);
113 	}
114 
115 	@Override
116 	public String getTopic() {
117 		return JfrRuleTopics.JVM_INFORMATION_TOPIC;
118 	}
119 
120 	private Result getVersionResult(String versionString) {
121 		JavaVersion usedVersion = RulesToolkit.getJavaVersion(versionString);
122 
123 		if (usedVersion == null) {
124 			return RulesToolkit.getNotApplicableResult(this,
<span class="line-modified">125 					Messages.getString(Messages.General_TEXT_COULD_NOT_DETERMINE_JAVA_VERSION));</span>
126 		}
127 
128 		if (!usedVersion.isGreaterOrEqualThan(JDK_7_U_40)) {
129 			return new Result(this, 100,
130 					Messages.getString(Messages.FlightRecordingSupportRule_UNSUPPORTED_TEXT_WARN_SHORT),
131 					MessageFormat.format(
132 							Messages.getString(Messages.FlightRecordingSupportRule_UNSUPPORTED_TEXT_WARN_LONG),
133 							versionString));
134 		}
135 
136 		if (usedVersion.isEarlyAccess()) {
137 			return new Result(this, 80, Messages.getString(Messages.FlightRecordingSupportRule_EA_TEXT_WARN_SHORT),
138 					MessageFormat.format(Messages.getString(Messages.FlightRecordingSupportRule_EA_TEXT_WARN_LONG),
139 							versionString));
140 		}
141 
142 		return new Result(this, 0, Messages.getString(Messages.FlightRecordingSupportRule_TEXT_OK));
143 	}
144 
145 	private Result getVersionResult(IItemCollection items) {
</pre>
</td>
</tr>
</table>
<center><a href="DuplicateFlagsRule.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> <a href="../latency/JavaBlockingRule.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>