<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/test/java/org/openjdk/skara/vcs/RepositoryTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>vcs/src/test/java/org/openjdk/skara/vcs/RepositoryTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 294 
 295             var patches = diff.patches();
 296             assertEquals(1, patches.size());
 297 
 298             var patch = patches.get(0).asTextualPatch();
 299             assertTrue(patch.status().isAdded());
 300 
 301             assertTrue(patch.source().path().isEmpty());
 302             assertTrue(patch.source().type().isEmpty());
 303 
 304             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
 305             assertTrue(patch.target().type().get().isRegularNonExecutable());
 306 
 307             var hunks = patch.hunks();
 308             assertEquals(1, hunks.size());
 309 
 310             var hunk = hunks.get(0);
 311             assertEquals(new Range(0, 0), hunk.source().range());
 312             assertEquals(new Range(1, 1), hunk.target().range());
 313 
<span class="line-modified"> 314             assertEquals(List.of(), hunk.source().lines());</span>
 315             assertLinesEquals(List.of(&quot;Hello, readme!&quot;), hunk.target().lines());
 316         }
 317     }
 318 
 319     static void assertLinesEquals(List&lt;String&gt; expected, List&lt;String&gt; actual) {
 320         var newLine = System.lineSeparator();
 321         var suffix = newLine.endsWith(&quot;\n&quot;)
 322                 ? newLine.substring(0, newLine.length() - 1) // drop trailing &#39;\n&#39; (keeping any &#39;\r&#39;)
 323                 : newLine;
 324         assertEquals(expected.stream().map(l -&gt; l + suffix).collect(Collectors.toList()), actual);
 325     }
 326 
 327     @ParameterizedTest
 328     @EnumSource(VCS.class)
 329     void testCommitListingWithMultipleCommits(VCS vcs) throws IOException {
 330         try (var dir = new TemporaryDirectory()) {
 331             var r = Repository.init(dir.path(), vcs);
 332 
 333             var readme = dir.path().resolve(&quot;README&quot;);
 334             Files.write(readme, List.of(&quot;Hello, readme!&quot;));
</pre>
<hr />
<pre>
 370             assertEquals(0, diff.modified());
 371             assertEquals(1, diff.added());
 372 
 373             var patches = diff.patches();
 374             assertEquals(1, patches.size());
 375 
 376             var patch = patches.get(0).asTextualPatch();
 377             assertTrue(patch.status().isModified());
 378             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
 379             assertTrue(patch.source().type().get().isRegularNonExecutable());
 380             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
 381             assertTrue(patch.target().type().get().isRegularNonExecutable());
 382 
 383             var hunks = patch.hunks();
 384             assertEquals(1, hunks.size());
 385 
 386             var hunk = hunks.get(0);
 387             assertEquals(new Range(2, 0), hunk.source().range());
 388             assertEquals(new Range(2, 1), hunk.target().range());
 389 
<span class="line-modified"> 390             assertEquals(List.of(), hunk.source().lines());</span>
 391             assertLinesEquals(List.of(&quot;Another line&quot;), hunk.target().lines());
 392         }
 393     }
 394 
 395     @ParameterizedTest
 396     @EnumSource(VCS.class)
 397     void testSquashDeletes(VCS vcs) throws IOException {
 398         try (var dir = new TemporaryDirectory()) {
 399             var r = Repository.init(dir.path(), vcs);
 400 
 401             var file1 = dir.path().resolve(&quot;file1.txt&quot;);
 402             Files.write(file1, List.of(&quot;Hello, file 1!&quot;));
 403             var file2 = dir.path().resolve(&quot;file2.txt&quot;);
 404             Files.write(file2, List.of(&quot;Hello, file 2!&quot;));
 405             var file3 = dir.path().resolve(&quot;file3.txt&quot;);
 406             Files.write(file3, List.of(&quot;Hello, file 3!&quot;));
 407 
 408             r.add(file1, file2, file3);
 409             var hash1 = r.commit(&quot;Add files&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
 410 
</pre>
<hr />
<pre>
 502             assertEquals(0, diff.modified());
 503             assertEquals(2, diff.added());
 504 
 505             var patches = diff.patches();
 506             assertEquals(1, patches.size());
 507 
 508             var patch = patches.get(0).asTextualPatch();
 509             assertTrue(patch.status().isModified());
 510             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
 511             assertTrue(patch.source().type().get().isRegularNonExecutable());
 512             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
 513             assertTrue(patch.target().type().get().isRegularNonExecutable());
 514 
 515             var hunks = patch.hunks();
 516             assertEquals(1, hunks.size());
 517 
 518             var hunk = hunks.get(0);
 519             assertEquals(new Range(2, 0), hunk.source().range());
 520             assertEquals(new Range(2, 2), hunk.target().range());
 521 
<span class="line-modified"> 522             assertEquals(List.of(), hunk.source().lines());</span>
 523             assertLinesEquals(List.of(&quot;Another line&quot;, &quot;A final line&quot;), hunk.target().lines());
 524         }
 525     }
 526 
 527     @ParameterizedTest
 528     @EnumSource(VCS.class)
 529     void testMergeBase(VCS vcs) throws IOException {
 530         try (var dir = new TemporaryDirectory()) {
 531             var r = Repository.init(dir.path(), vcs);
 532 
 533             var readme = dir.path().resolve(&quot;README&quot;);
 534             Files.write(readme, List.of(&quot;Hello, readme!&quot;));
 535 
 536             r.add(readme);
 537             var hash1 = r.commit(&quot;Add README&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
 538 
 539             Files.write(readme, List.of(&quot;Another line&quot;), WRITE, APPEND);
 540             r.add(readme);
 541             var hash2 = r.commit(&quot;Modify README&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
 542 
</pre>
<hr />
<pre>
1056             var patches = diff.patches();
1057             assertEquals(1, patches.size());
1058 
1059             var patch = patches.get(0).asTextualPatch();
1060             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
1061             assertTrue(patch.target().path().isEmpty());
1062             assertTrue(patch.source().type().get().isRegularNonExecutable());
1063             assertTrue(patch.target().type().isEmpty());
1064             assertTrue(patch.status().isDeleted());
1065 
1066             var hunks = patch.hunks();
1067             assertEquals(1, hunks.size());
1068 
1069             var hunk = hunks.get(0);
1070             assertEquals(1, hunk.source().range().start());
1071             assertEquals(1, hunk.source().range().count());
1072             assertLinesEquals(List.of(&quot;Hello, world!&quot;), hunk.source().lines());
1073 
1074             assertEquals(0, hunk.target().range().start());
1075             assertEquals(0, hunk.target().range().count());
<span class="line-modified">1076             assertEquals(List.of(), hunk.target().lines());</span>
1077 
1078             assertEquals(0, hunk.added());
1079             assertEquals(1, hunk.removed());
1080             assertEquals(0, hunk.modified());
1081         }
1082     }
1083 
1084     @ParameterizedTest
1085     @EnumSource(VCS.class)
1086     void testDiffWithAddition(VCS vcs) throws IOException {
1087         try (var dir = new TemporaryDirectory()) {
1088             var r = Repository.init(dir.path(), vcs);
1089 
1090             var readme = dir.path().resolve(&quot;README&quot;);
1091             Files.write(readme, List.of(&quot;Hello, world!&quot;));
1092 
1093             r.add(readme);
1094             var first = r.commit(&quot;Added README&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
1095 
1096             var building = dir.path().resolve(&quot;BUILDING&quot;);
</pre>
<hr />
<pre>
1101             var diff = r.diff(first, second);
1102             assertEquals(first, diff.from());
1103             assertEquals(second, diff.to());
1104 
1105             var patches = diff.patches();
1106             assertEquals(1, patches.size());
1107 
1108             var patch = patches.get(0).asTextualPatch();
1109             assertTrue(patch.source().path().isEmpty());
1110             assertEquals(Path.of(&quot;BUILDING&quot;), patch.target().path().get());
1111             assertTrue(patch.source().type().isEmpty());
1112             assertTrue(patch.target().type().get().isRegularNonExecutable());
1113             assertTrue(patch.status().isAdded());
1114 
1115             var hunks = patch.hunks();
1116             assertEquals(1, hunks.size());
1117 
1118             var hunk = hunks.get(0);
1119             assertEquals(0, hunk.source().range().start());
1120             assertEquals(0, hunk.source().range().count());
<span class="line-modified">1121             assertEquals(List.of(), hunk.source().lines());</span>
1122 
1123             assertEquals(1, hunk.target().range().start());
1124             assertEquals(1, hunk.target().range().count());
1125             assertLinesEquals(List.of(&quot;make&quot;), hunk.target().lines());
1126 
1127             assertEquals(1, hunk.added());
1128             assertEquals(0, hunk.removed());
1129             assertEquals(0, hunk.modified());
1130         }
1131     }
1132 
1133     @ParameterizedTest
1134     @EnumSource(VCS.class)
1135     void testDiffWithWorkingDir(VCS vcs) throws IOException {
1136         try (var dir = new TemporaryDirectory()) {
1137             var r = Repository.init(dir.path(), vcs);
1138 
1139             var readme = dir.path().resolve(&quot;README&quot;);
1140             Files.write(readme, List.of(&quot;Hello, world!&quot;));
1141 
</pre>
<hr />
<pre>
1147 
1148             assertEquals(first, diff.from());
1149             assertNull(diff.to());
1150 
1151             var patches = diff.patches();
1152             assertEquals(1, patches.size());
1153 
1154             var patch = patches.get(0).asTextualPatch();
1155             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
1156             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
1157             assertTrue(patch.source().type().get().isRegularNonExecutable());
1158             assertTrue(patch.target().type().get().isRegularNonExecutable());
1159             assertTrue(patch.status().isModified());
1160 
1161             var hunks = patch.hunks();
1162             assertEquals(1, hunks.size());
1163 
1164             var hunk = hunks.get(0);
1165             assertEquals(2, hunk.source().range().start());
1166             assertEquals(0, hunk.source().range().count());
<span class="line-modified">1167             assertEquals(List.of(), hunk.source().lines());</span>
1168 
1169             assertEquals(2, hunk.target().range().start());
1170             assertEquals(1, hunk.target().range().count());
1171             assertLinesEquals(List.of(&quot;One more line&quot;), hunk.target().lines());
1172 
1173             assertEquals(1, hunk.added());
1174             assertEquals(0, hunk.removed());
1175             assertEquals(0, hunk.modified());
1176         }
1177     }
1178 
1179     @ParameterizedTest
1180     @EnumSource(VCS.class)
1181     void testCommitMetadata(VCS vcs) throws IOException {
1182         try (var dir = new TemporaryDirectory()) {
1183             var r = Repository.init(dir.path(), vcs);
1184 
1185             var readme = dir.path().resolve(&quot;README&quot;);
1186             Files.write(readme, List.of(&quot;Hello, world!&quot;));
1187             r.add(readme);
</pre>
<hr />
<pre>
1293 
1294             var parents = new HashSet&lt;&gt;(merge.parents());
1295             assertEquals(2, parents.size());
1296             assertTrue(parents.contains(second));
1297             assertTrue(parents.contains(third));
1298 
1299             var diffs = merge.parentDiffs();
1300             assertEquals(2, diffs.size());
1301 
1302             var secondDiff = diffs.stream().filter(d -&gt; d.from().equals(second)).findFirst().get();
1303             assertEquals(merge.hash(), secondDiff.to());
1304             assertEquals(1, secondDiff.patches().size());
1305             var secondPatch = secondDiff.patches().get(0).asTextualPatch();
1306 
1307             assertEquals(Path.of(&quot;README&quot;), secondPatch.source().path().get());
1308             assertEquals(Path.of(&quot;README&quot;), secondPatch.target().path().get());
1309             assertTrue(secondPatch.status().isModified());
1310             assertEquals(1, secondPatch.hunks().size());
1311 
1312             var secondHunk = secondPatch.hunks().get(0);
<span class="line-modified">1313             assertEquals(List.of(), secondHunk.source().lines());</span>
1314             assertLinesEquals(List.of(&quot;One last line&quot;), secondHunk.target().lines());
1315 
1316             assertEquals(3, secondHunk.source().range().start());
1317             assertEquals(0, secondHunk.source().range().count());
1318             assertEquals(3, secondHunk.target().range().start());
1319             assertEquals(1, secondHunk.target().range().count());
1320 
1321             var thirdDiff = diffs.stream().filter(d -&gt; d.from().equals(third)).findFirst().get();
1322             assertEquals(merge.hash(), thirdDiff.to());
1323             assertEquals(1, thirdDiff.patches().size());
1324             var thirdPatch = thirdDiff.patches().get(0).asTextualPatch();
1325 
1326             assertEquals(Path.of(&quot;README&quot;), thirdPatch.source().path().get());
1327             assertEquals(Path.of(&quot;README&quot;), thirdPatch.target().path().get());
1328             assertTrue(thirdPatch.status().isModified());
1329             assertEquals(1, thirdPatch.hunks().size());
1330 
1331             var thirdHunk = thirdPatch.hunks().get(0);
<span class="line-modified">1332             assertEquals(List.of(), thirdHunk.source().lines());</span>
1333             assertLinesEquals(List.of(&quot;One more line&quot;, &quot;One last line&quot;), thirdHunk.target().lines());
1334 
1335             assertEquals(2, thirdHunk.source().range().start());
1336             assertEquals(0, thirdHunk.source().range().count());
1337             assertEquals(2, thirdHunk.target().range().start());
1338             assertEquals(2, thirdHunk.target().range().count());
1339         }
1340     }
1341 
1342     @ParameterizedTest
1343     @EnumSource(VCS.class)
1344     void testDefaultBranch(VCS vcs) throws IOException {
1345         try (var dir = new TemporaryDirectory()) {
1346             var r = Repository.init(dir.path(), vcs);
1347             var expected = vcs == VCS.GIT ? &quot;master&quot; : &quot;default&quot;;
1348             assertEquals(expected, r.defaultBranch().name());
1349         }
1350     }
1351 
1352     @ParameterizedTest
</pre>
</td>
<td>
<hr />
<pre>
 294 
 295             var patches = diff.patches();
 296             assertEquals(1, patches.size());
 297 
 298             var patch = patches.get(0).asTextualPatch();
 299             assertTrue(patch.status().isAdded());
 300 
 301             assertTrue(patch.source().path().isEmpty());
 302             assertTrue(patch.source().type().isEmpty());
 303 
 304             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
 305             assertTrue(patch.target().type().get().isRegularNonExecutable());
 306 
 307             var hunks = patch.hunks();
 308             assertEquals(1, hunks.size());
 309 
 310             var hunk = hunks.get(0);
 311             assertEquals(new Range(0, 0), hunk.source().range());
 312             assertEquals(new Range(1, 1), hunk.target().range());
 313 
<span class="line-modified"> 314             assertLinesEquals(List.of(), hunk.source().lines());</span>
 315             assertLinesEquals(List.of(&quot;Hello, readme!&quot;), hunk.target().lines());
 316         }
 317     }
 318 
 319     static void assertLinesEquals(List&lt;String&gt; expected, List&lt;String&gt; actual) {
 320         var newLine = System.lineSeparator();
 321         var suffix = newLine.endsWith(&quot;\n&quot;)
 322                 ? newLine.substring(0, newLine.length() - 1) // drop trailing &#39;\n&#39; (keeping any &#39;\r&#39;)
 323                 : newLine;
 324         assertEquals(expected.stream().map(l -&gt; l + suffix).collect(Collectors.toList()), actual);
 325     }
 326 
 327     @ParameterizedTest
 328     @EnumSource(VCS.class)
 329     void testCommitListingWithMultipleCommits(VCS vcs) throws IOException {
 330         try (var dir = new TemporaryDirectory()) {
 331             var r = Repository.init(dir.path(), vcs);
 332 
 333             var readme = dir.path().resolve(&quot;README&quot;);
 334             Files.write(readme, List.of(&quot;Hello, readme!&quot;));
</pre>
<hr />
<pre>
 370             assertEquals(0, diff.modified());
 371             assertEquals(1, diff.added());
 372 
 373             var patches = diff.patches();
 374             assertEquals(1, patches.size());
 375 
 376             var patch = patches.get(0).asTextualPatch();
 377             assertTrue(patch.status().isModified());
 378             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
 379             assertTrue(patch.source().type().get().isRegularNonExecutable());
 380             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
 381             assertTrue(patch.target().type().get().isRegularNonExecutable());
 382 
 383             var hunks = patch.hunks();
 384             assertEquals(1, hunks.size());
 385 
 386             var hunk = hunks.get(0);
 387             assertEquals(new Range(2, 0), hunk.source().range());
 388             assertEquals(new Range(2, 1), hunk.target().range());
 389 
<span class="line-modified"> 390             assertLinesEquals(List.of(), hunk.source().lines());</span>
 391             assertLinesEquals(List.of(&quot;Another line&quot;), hunk.target().lines());
 392         }
 393     }
 394 
 395     @ParameterizedTest
 396     @EnumSource(VCS.class)
 397     void testSquashDeletes(VCS vcs) throws IOException {
 398         try (var dir = new TemporaryDirectory()) {
 399             var r = Repository.init(dir.path(), vcs);
 400 
 401             var file1 = dir.path().resolve(&quot;file1.txt&quot;);
 402             Files.write(file1, List.of(&quot;Hello, file 1!&quot;));
 403             var file2 = dir.path().resolve(&quot;file2.txt&quot;);
 404             Files.write(file2, List.of(&quot;Hello, file 2!&quot;));
 405             var file3 = dir.path().resolve(&quot;file3.txt&quot;);
 406             Files.write(file3, List.of(&quot;Hello, file 3!&quot;));
 407 
 408             r.add(file1, file2, file3);
 409             var hash1 = r.commit(&quot;Add files&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
 410 
</pre>
<hr />
<pre>
 502             assertEquals(0, diff.modified());
 503             assertEquals(2, diff.added());
 504 
 505             var patches = diff.patches();
 506             assertEquals(1, patches.size());
 507 
 508             var patch = patches.get(0).asTextualPatch();
 509             assertTrue(patch.status().isModified());
 510             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
 511             assertTrue(patch.source().type().get().isRegularNonExecutable());
 512             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
 513             assertTrue(patch.target().type().get().isRegularNonExecutable());
 514 
 515             var hunks = patch.hunks();
 516             assertEquals(1, hunks.size());
 517 
 518             var hunk = hunks.get(0);
 519             assertEquals(new Range(2, 0), hunk.source().range());
 520             assertEquals(new Range(2, 2), hunk.target().range());
 521 
<span class="line-modified"> 522             assertLinesEquals(List.of(), hunk.source().lines());</span>
 523             assertLinesEquals(List.of(&quot;Another line&quot;, &quot;A final line&quot;), hunk.target().lines());
 524         }
 525     }
 526 
 527     @ParameterizedTest
 528     @EnumSource(VCS.class)
 529     void testMergeBase(VCS vcs) throws IOException {
 530         try (var dir = new TemporaryDirectory()) {
 531             var r = Repository.init(dir.path(), vcs);
 532 
 533             var readme = dir.path().resolve(&quot;README&quot;);
 534             Files.write(readme, List.of(&quot;Hello, readme!&quot;));
 535 
 536             r.add(readme);
 537             var hash1 = r.commit(&quot;Add README&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
 538 
 539             Files.write(readme, List.of(&quot;Another line&quot;), WRITE, APPEND);
 540             r.add(readme);
 541             var hash2 = r.commit(&quot;Modify README&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
 542 
</pre>
<hr />
<pre>
1056             var patches = diff.patches();
1057             assertEquals(1, patches.size());
1058 
1059             var patch = patches.get(0).asTextualPatch();
1060             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
1061             assertTrue(patch.target().path().isEmpty());
1062             assertTrue(patch.source().type().get().isRegularNonExecutable());
1063             assertTrue(patch.target().type().isEmpty());
1064             assertTrue(patch.status().isDeleted());
1065 
1066             var hunks = patch.hunks();
1067             assertEquals(1, hunks.size());
1068 
1069             var hunk = hunks.get(0);
1070             assertEquals(1, hunk.source().range().start());
1071             assertEquals(1, hunk.source().range().count());
1072             assertLinesEquals(List.of(&quot;Hello, world!&quot;), hunk.source().lines());
1073 
1074             assertEquals(0, hunk.target().range().start());
1075             assertEquals(0, hunk.target().range().count());
<span class="line-modified">1076             assertLinesEquals(List.of(), hunk.target().lines());</span>
1077 
1078             assertEquals(0, hunk.added());
1079             assertEquals(1, hunk.removed());
1080             assertEquals(0, hunk.modified());
1081         }
1082     }
1083 
1084     @ParameterizedTest
1085     @EnumSource(VCS.class)
1086     void testDiffWithAddition(VCS vcs) throws IOException {
1087         try (var dir = new TemporaryDirectory()) {
1088             var r = Repository.init(dir.path(), vcs);
1089 
1090             var readme = dir.path().resolve(&quot;README&quot;);
1091             Files.write(readme, List.of(&quot;Hello, world!&quot;));
1092 
1093             r.add(readme);
1094             var first = r.commit(&quot;Added README&quot;, &quot;duke&quot;, &quot;duke@openjdk.java.net&quot;);
1095 
1096             var building = dir.path().resolve(&quot;BUILDING&quot;);
</pre>
<hr />
<pre>
1101             var diff = r.diff(first, second);
1102             assertEquals(first, diff.from());
1103             assertEquals(second, diff.to());
1104 
1105             var patches = diff.patches();
1106             assertEquals(1, patches.size());
1107 
1108             var patch = patches.get(0).asTextualPatch();
1109             assertTrue(patch.source().path().isEmpty());
1110             assertEquals(Path.of(&quot;BUILDING&quot;), patch.target().path().get());
1111             assertTrue(patch.source().type().isEmpty());
1112             assertTrue(patch.target().type().get().isRegularNonExecutable());
1113             assertTrue(patch.status().isAdded());
1114 
1115             var hunks = patch.hunks();
1116             assertEquals(1, hunks.size());
1117 
1118             var hunk = hunks.get(0);
1119             assertEquals(0, hunk.source().range().start());
1120             assertEquals(0, hunk.source().range().count());
<span class="line-modified">1121             assertLinesEquals(List.of(), hunk.source().lines());</span>
1122 
1123             assertEquals(1, hunk.target().range().start());
1124             assertEquals(1, hunk.target().range().count());
1125             assertLinesEquals(List.of(&quot;make&quot;), hunk.target().lines());
1126 
1127             assertEquals(1, hunk.added());
1128             assertEquals(0, hunk.removed());
1129             assertEquals(0, hunk.modified());
1130         }
1131     }
1132 
1133     @ParameterizedTest
1134     @EnumSource(VCS.class)
1135     void testDiffWithWorkingDir(VCS vcs) throws IOException {
1136         try (var dir = new TemporaryDirectory()) {
1137             var r = Repository.init(dir.path(), vcs);
1138 
1139             var readme = dir.path().resolve(&quot;README&quot;);
1140             Files.write(readme, List.of(&quot;Hello, world!&quot;));
1141 
</pre>
<hr />
<pre>
1147 
1148             assertEquals(first, diff.from());
1149             assertNull(diff.to());
1150 
1151             var patches = diff.patches();
1152             assertEquals(1, patches.size());
1153 
1154             var patch = patches.get(0).asTextualPatch();
1155             assertEquals(Path.of(&quot;README&quot;), patch.source().path().get());
1156             assertEquals(Path.of(&quot;README&quot;), patch.target().path().get());
1157             assertTrue(patch.source().type().get().isRegularNonExecutable());
1158             assertTrue(patch.target().type().get().isRegularNonExecutable());
1159             assertTrue(patch.status().isModified());
1160 
1161             var hunks = patch.hunks();
1162             assertEquals(1, hunks.size());
1163 
1164             var hunk = hunks.get(0);
1165             assertEquals(2, hunk.source().range().start());
1166             assertEquals(0, hunk.source().range().count());
<span class="line-modified">1167             assertLinesEquals(List.of(), hunk.source().lines());</span>
1168 
1169             assertEquals(2, hunk.target().range().start());
1170             assertEquals(1, hunk.target().range().count());
1171             assertLinesEquals(List.of(&quot;One more line&quot;), hunk.target().lines());
1172 
1173             assertEquals(1, hunk.added());
1174             assertEquals(0, hunk.removed());
1175             assertEquals(0, hunk.modified());
1176         }
1177     }
1178 
1179     @ParameterizedTest
1180     @EnumSource(VCS.class)
1181     void testCommitMetadata(VCS vcs) throws IOException {
1182         try (var dir = new TemporaryDirectory()) {
1183             var r = Repository.init(dir.path(), vcs);
1184 
1185             var readme = dir.path().resolve(&quot;README&quot;);
1186             Files.write(readme, List.of(&quot;Hello, world!&quot;));
1187             r.add(readme);
</pre>
<hr />
<pre>
1293 
1294             var parents = new HashSet&lt;&gt;(merge.parents());
1295             assertEquals(2, parents.size());
1296             assertTrue(parents.contains(second));
1297             assertTrue(parents.contains(third));
1298 
1299             var diffs = merge.parentDiffs();
1300             assertEquals(2, diffs.size());
1301 
1302             var secondDiff = diffs.stream().filter(d -&gt; d.from().equals(second)).findFirst().get();
1303             assertEquals(merge.hash(), secondDiff.to());
1304             assertEquals(1, secondDiff.patches().size());
1305             var secondPatch = secondDiff.patches().get(0).asTextualPatch();
1306 
1307             assertEquals(Path.of(&quot;README&quot;), secondPatch.source().path().get());
1308             assertEquals(Path.of(&quot;README&quot;), secondPatch.target().path().get());
1309             assertTrue(secondPatch.status().isModified());
1310             assertEquals(1, secondPatch.hunks().size());
1311 
1312             var secondHunk = secondPatch.hunks().get(0);
<span class="line-modified">1313             assertLinesEquals(List.of(), secondHunk.source().lines());</span>
1314             assertLinesEquals(List.of(&quot;One last line&quot;), secondHunk.target().lines());
1315 
1316             assertEquals(3, secondHunk.source().range().start());
1317             assertEquals(0, secondHunk.source().range().count());
1318             assertEquals(3, secondHunk.target().range().start());
1319             assertEquals(1, secondHunk.target().range().count());
1320 
1321             var thirdDiff = diffs.stream().filter(d -&gt; d.from().equals(third)).findFirst().get();
1322             assertEquals(merge.hash(), thirdDiff.to());
1323             assertEquals(1, thirdDiff.patches().size());
1324             var thirdPatch = thirdDiff.patches().get(0).asTextualPatch();
1325 
1326             assertEquals(Path.of(&quot;README&quot;), thirdPatch.source().path().get());
1327             assertEquals(Path.of(&quot;README&quot;), thirdPatch.target().path().get());
1328             assertTrue(thirdPatch.status().isModified());
1329             assertEquals(1, thirdPatch.hunks().size());
1330 
1331             var thirdHunk = thirdPatch.hunks().get(0);
<span class="line-modified">1332             assertLinesEquals(List.of(), thirdHunk.source().lines());</span>
1333             assertLinesEquals(List.of(&quot;One more line&quot;, &quot;One last line&quot;), thirdHunk.target().lines());
1334 
1335             assertEquals(2, thirdHunk.source().range().start());
1336             assertEquals(0, thirdHunk.source().range().count());
1337             assertEquals(2, thirdHunk.target().range().start());
1338             assertEquals(2, thirdHunk.target().range().count());
1339         }
1340     }
1341 
1342     @ParameterizedTest
1343     @EnumSource(VCS.class)
1344     void testDefaultBranch(VCS vcs) throws IOException {
1345         try (var dir = new TemporaryDirectory()) {
1346             var r = Repository.init(dir.path(), vcs);
1347             var expected = vcs == VCS.GIT ? &quot;master&quot; : &quot;default&quot;;
1348             assertEquals(expected, r.defaultBranch().name());
1349         }
1350     }
1351 
1352     @ParameterizedTest
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>