<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ArchiveWorkItem.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ArchiveItem.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="WebrevNotification.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ArchiveWorkItem.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
296             // Review comments
297             var reviews = pr.reviews();
298             for (var review : reviews) {
299                 if (ignoreComment(review.reviewer(), review.body().orElse(&quot;&quot;))) {
300                     continue;
301                 }
302                 archiver.addReview(review);
303             }
304 
305             // File specific comments
306             var reviewComments = pr.reviewComments();
307             for (var reviewComment : reviewComments) {
308                 if (ignoreComment(reviewComment.author(), reviewComment.body())) {
309                     continue;
310                 }
311                 archiver.addReviewComment(reviewComment);
312             }
313 
314             var webrevGenerator = bot.webrevStorage().generator(pr, localRepo, webrevPath);
315             var newMails = archiver.generateNewEmails(sentMails, localRepo, bot.issueTracker(), jbs.toUpperCase(), webrevGenerator,
<span class="line-modified">316                                                       (uri, index, isFull) -&gt; updateWebrevComment(comments, index, uri, null),</span>
317                                                       user -&gt; getAuthorAddress(census, user),
318                                                       user -&gt; getAuthorUserName(census, user),
319                                                       user -&gt; getAuthorRole(census, user));
320             if (newMails.isEmpty()) {
321                 return;
322             }
323 
324             // Push all new mails to the archive repository
325             newMails.forEach(reviewArchiveList::post);
326             pushMbox(archiveRepo, &quot;Adding comments for PR &quot; + bot.codeRepo().name() + &quot;/&quot; + pr.id());
327 
328             // Finally post all new mails to the actual list
329             for (var newMail : newMails) {
330                 var filteredHeaders = newMail.headers().stream()
331                                              .filter(header -&gt; !header.startsWith(&quot;PR-&quot;))
332                                              .collect(Collectors.toMap(Function.identity(),
333                                                                        newMail::headerValue));
334                 var filteredEmail = Email.from(newMail)
335                                          .replaceHeaders(filteredHeaders)
336                                          .headers(bot.headers())
</pre>
</td>
<td>
<hr />
<pre>
296             // Review comments
297             var reviews = pr.reviews();
298             for (var review : reviews) {
299                 if (ignoreComment(review.reviewer(), review.body().orElse(&quot;&quot;))) {
300                     continue;
301                 }
302                 archiver.addReview(review);
303             }
304 
305             // File specific comments
306             var reviewComments = pr.reviewComments();
307             for (var reviewComment : reviewComments) {
308                 if (ignoreComment(reviewComment.author(), reviewComment.body())) {
309                     continue;
310                 }
311                 archiver.addReviewComment(reviewComment);
312             }
313 
314             var webrevGenerator = bot.webrevStorage().generator(pr, localRepo, webrevPath);
315             var newMails = archiver.generateNewEmails(sentMails, localRepo, bot.issueTracker(), jbs.toUpperCase(), webrevGenerator,
<span class="line-modified">316                                                       (index, full, inc) -&gt; updateWebrevComment(comments, index, full, inc),</span>
317                                                       user -&gt; getAuthorAddress(census, user),
318                                                       user -&gt; getAuthorUserName(census, user),
319                                                       user -&gt; getAuthorRole(census, user));
320             if (newMails.isEmpty()) {
321                 return;
322             }
323 
324             // Push all new mails to the archive repository
325             newMails.forEach(reviewArchiveList::post);
326             pushMbox(archiveRepo, &quot;Adding comments for PR &quot; + bot.codeRepo().name() + &quot;/&quot; + pr.id());
327 
328             // Finally post all new mails to the actual list
329             for (var newMail : newMails) {
330                 var filteredHeaders = newMail.headers().stream()
331                                              .filter(header -&gt; !header.startsWith(&quot;PR-&quot;))
332                                              .collect(Collectors.toMap(Function.identity(),
333                                                                        newMail::headerValue));
334                 var filteredEmail = Email.from(newMail)
335                                          .replaceHeaders(filteredHeaders)
336                                          .headers(bot.headers())
</pre>
</td>
</tr>
</table>
<center><a href="ArchiveItem.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="WebrevNotification.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>