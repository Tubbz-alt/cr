<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff webrev/src/main/java/org/openjdk/skara/webrev/HunkCoalescer.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../vcs/src/main/java/org/openjdk/skara/vcs/Range.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>webrev/src/main/java/org/openjdk/skara/webrev/HunkCoalescer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 172,18 ***</span>
          destEnd = Math.min(destEnd, destContent.size() + 1);
  
          var sourceCount = sourceEnd - sourceStart;
          var destCount = destEnd - destStart;
  
<span class="line-removed">-         // For some reason git wants the start to be +1 when no lines have changed</span>
<span class="line-removed">-         if (sourceCount == numContextLines * 2) {</span>
<span class="line-removed">-             sourceStart++;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         if (destCount == numContextLines * 2) {</span>
<span class="line-removed">-             destStart++;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
          return new Header(new Range(sourceStart, sourceCount),
                            new Range(destStart, destCount));
      }
  
      private Context createContextBeforeGroup(Header header, Hunk first) {
<span class="line-new-header">--- 172,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 187,20 ***</span>
      }
  
      private Context createContextBeforeGroup(Header header, Hunk first) {
          var sourceContextBeforeStart = header.source().start();
          var sourceContextBeforeEnd = first.source().range().start();
<span class="line-removed">-         if (first.source().range().count() == 0) {</span>
<span class="line-removed">-             sourceContextBeforeEnd++;</span>
<span class="line-removed">-         }</span>
          var sourceBeforeContextCount = sourceContextBeforeEnd - sourceContextBeforeStart;
  
          var destContextBeforeStart = header.target().start();
          var destContextBeforeEnd = first.target().range().start();
<span class="line-removed">-         if (first.target().range().count() == 0) {</span>
<span class="line-removed">-             destContextBeforeEnd++;</span>
<span class="line-removed">-         }</span>
          var destBeforeContextCount = destContextBeforeEnd - destContextBeforeStart;
  
          var beforeContextCount = Math.min(destBeforeContextCount, sourceBeforeContextCount);
          assert beforeContextCount &lt;= numContextLines;
  
<span class="line-new-header">--- 178,14 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 248,19 ***</span>
  
          return added;
      }
  
      private Context createContextAfterHunk(Hunk hunk, Hunk nextNonEmptySourceHunk, Hunk nextNonEmptyTargetHunk) {
<span class="line-removed">-         boolean isOneRangeEmpty = hunk.source().range().count() == 0 ||</span>
<span class="line-removed">-                                   hunk.target().range().count() == 0;</span>
<span class="line-removed">- </span>
          var sourceAfterContextStart = hunk.source().range().end();
          var sourceAfterContextEnd = hunk.source().range().end() + numContextLines;
<span class="line-removed">-         if (hunk.source().range().count() == 0) {</span>
<span class="line-removed">-             sourceAfterContextStart++;</span>
<span class="line-removed">-             sourceAfterContextEnd++;</span>
<span class="line-removed">-         }</span>
          sourceAfterContextEnd = Math.min(sourceAfterContextEnd, sourceContent.size() + 1);
          if (nextNonEmptySourceHunk != null) {
              var nextNonEmptySourceHunkStart = nextNonEmptySourceHunk.source().range().start();
              sourceAfterContextEnd = Math.min(sourceAfterContextEnd, nextNonEmptySourceHunkStart);
          }
<span class="line-new-header">--- 233,12 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 266,14 ***</span>
          }
          var sourceAfterContextCount = sourceAfterContextEnd - sourceAfterContextStart;
  
          var destAfterContextStart = hunk.target().range().end();
          var destAfterContextEnd = hunk.target().range().end() + numContextLines;
<span class="line-removed">-         if (hunk.target().range().count() == 0) {</span>
<span class="line-removed">-             destAfterContextStart++;</span>
<span class="line-removed">-             destAfterContextEnd++;</span>
<span class="line-removed">-         }</span>
          destAfterContextEnd = Math.min(destAfterContextEnd, destContent.size() + 1);
          if (nextNonEmptyTargetHunk != null) {
              var nextNonEmptyTargetHunkStart = nextNonEmptyTargetHunk.target().range().start();
              destAfterContextEnd = Math.min(destAfterContextEnd, nextNonEmptyTargetHunkStart);
          }
<span class="line-new-header">--- 245,10 ---</span>
</pre>
<center><a href="../../../../../../../../vcs/src/main/java/org/openjdk/skara/vcs/Range.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>