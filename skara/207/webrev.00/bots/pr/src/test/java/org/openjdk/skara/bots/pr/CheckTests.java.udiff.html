<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff bots/pr/src/test/java/org/openjdk/skara/bots/pr/CheckTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/pr/Veto.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="CommandTests.java.udiff.html" target="_top">next &gt;</a></center>    <h2>bots/pr/src/test/java/org/openjdk/skara/bots/pr/CheckTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -42,53 +42,53 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check succeeded
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
  
              // The PR should now be ready for review
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;ready&quot;));</span>
  
              // Approve it as another user
<span class="udiff-line-modified-removed">-             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The check should now be successful
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
  
              // The PR should not be flagged as ready for review, at it is already reviewed
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;ready&quot;));</span>
          }
      }
  
      @Test
      void whitespaceIssue(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,68 +97,68 @@</span>
  
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo, &quot;A line with a trailing whitespace   &quot;);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The PR should not be flagged as ready for review
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
  
              // Approve it as another user
<span class="udiff-line-modified-removed">-             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check failed
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.FAILURE, check.status());
  
              // The PR should not still not be flagged as ready for review
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
  
              // Remove the trailing whitespace in a new commit
              editHash = CheckableRepository.replaceAndCommit(localRepo, &quot;A line without a trailing whitespace&quot;);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
  
              // Make sure that the push registered
<span class="udiff-line-modified-removed">-             var lastHeadHash = pr.getHeadHash();</span>
<span class="udiff-line-modified-added">+             var lastHeadHash = pr.headHash();</span>
              var refreshCount = 0;
              do {
<span class="udiff-line-modified-removed">-                 pr = author.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+                 pr = author.pullRequest(pr.id());</span>
                  if (refreshCount++ &gt; 100) {
                      fail(&quot;The PR did not update after the new push&quot;);
                  }
<span class="udiff-line-modified-removed">-             } while (pr.getHeadHash().equals(lastHeadHash));</span>
<span class="udiff-line-modified-added">+             } while (pr.headHash().equals(lastHeadHash));</span>
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The PR should not be flagged as ready for review, at it is already reviewed
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
  
              // The check should now be successful
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -171,80 +171,80 @@</span>
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
              var commenter = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(commenter.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(commenter.host().currentUser().id());</span>
  
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var authorPr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Let the status bot inspect the PR
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             assertFalse(authorPr.getBody().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(authorPr.body().contains(&quot;Approvers&quot;));</span>
  
              // Approve it
<span class="udiff-line-modified-removed">-             var reviewerPr = reviewer.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-added">+             var reviewerPr = reviewer.pullRequest(authorPr.id());</span>
              reviewerPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Refresh the PR and check that it has been approved
<span class="udiff-line-modified-removed">-             authorPr = author.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-removed">-             assertTrue(authorPr.getBody().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-added">+             authorPr = author.pullRequest(authorPr.id());</span>
<span class="udiff-line-modified-added">+             assertTrue(authorPr.body().contains(&quot;Approvers&quot;));</span>
  
              // Update the file after approval
              editHash = CheckableRepository.appendAndCommit(localRepo, &quot;Now I&#39;ve gone and changed it&quot;);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
  
              // Make sure that the push registered
<span class="udiff-line-modified-removed">-             var lastHeadHash = authorPr.getHeadHash();</span>
<span class="udiff-line-modified-added">+             var lastHeadHash = authorPr.headHash();</span>
              var refreshCount = 0;
              do {
<span class="udiff-line-modified-removed">-                 authorPr = author.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-added">+                 authorPr = author.pullRequest(authorPr.id());</span>
                  if (refreshCount++ &gt; 100) {
                      fail(&quot;The PR did not update after the new push&quot;);
                  }
<span class="udiff-line-modified-removed">-             } while (authorPr.getHeadHash().equals(lastHeadHash));</span>
<span class="udiff-line-modified-added">+             } while (authorPr.headHash().equals(lastHeadHash));</span>
  
              // Check that the review is flagged as stale
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             authorPr = author.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-removed">-             assertTrue(authorPr.getBody().contains(&quot;Note&quot;));</span>
<span class="udiff-line-modified-added">+             authorPr = author.pullRequest(authorPr.id());</span>
<span class="udiff-line-modified-added">+             assertTrue(authorPr.body().contains(&quot;Note&quot;));</span>
  
              // Now we can approve it again
              reviewerPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Refresh the PR and check that it has been approved (once) and is no longer stale
<span class="udiff-line-modified-removed">-             authorPr = author.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-removed">-             assertTrue(authorPr.getBody().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-removed">-             assertEquals(1, authorPr.getBody().split(&quot;Generated Reviewer&quot;, -1).length - 1);</span>
<span class="udiff-line-modified-removed">-             assertTrue(authorPr.getReviews().size() &gt;= 1);</span>
<span class="udiff-line-modified-removed">-             assertFalse(authorPr.getBody().contains(&quot;Note&quot;));</span>
<span class="udiff-line-modified-added">+             authorPr = author.pullRequest(authorPr.id());</span>
<span class="udiff-line-modified-added">+             assertTrue(authorPr.body().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-added">+             assertEquals(1, authorPr.body().split(&quot;Generated Reviewer&quot;, -1).length - 1);</span>
<span class="udiff-line-modified-added">+             assertTrue(authorPr.reviews().size() &gt;= 1);</span>
<span class="udiff-line-modified-added">+             assertFalse(authorPr.body().contains(&quot;Note&quot;));</span>
  
              // Add a review with disapproval
<span class="udiff-line-modified-removed">-             var commenterPr = commenter.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-added">+             var commenterPr = commenter.pullRequest(authorPr.id());</span>
              commenterPr.addReview(Review.Verdict.DISAPPROVED, &quot;Disapproved&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Refresh the PR and check that it still only approved once (but two reviews) and is no longer stale
<span class="udiff-line-modified-removed">-             authorPr = author.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-removed">-             assertTrue(authorPr.getBody().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-removed">-             assertEquals(1, authorPr.getBody().split(&quot;Generated Reviewer&quot;, -1).length - 1);</span>
<span class="udiff-line-modified-removed">-             assertTrue(authorPr.getReviews().size() &gt;= 2);</span>
<span class="udiff-line-modified-removed">-             assertFalse(authorPr.getBody().contains(&quot;Note&quot;));</span>
<span class="udiff-line-modified-added">+             authorPr = author.pullRequest(authorPr.id());</span>
<span class="udiff-line-modified-added">+             assertTrue(authorPr.body().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-added">+             assertEquals(1, authorPr.body().split(&quot;Generated Reviewer&quot;, -1).length - 1);</span>
<span class="udiff-line-modified-added">+             assertTrue(authorPr.reviews().size() &gt;= 2);</span>
<span class="udiff-line-modified-added">+             assertFalse(authorPr.body().contains(&quot;Note&quot;));</span>
          }
      }
  
      @Test
      void selfReview(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -252,38 +252,38 @@</span>
               var tempFolder = new TemporaryDirectory()) {
  
              var author = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addReviewer(author.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(author.host().currentUser().id());</span>
  
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var authorPr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Let the status bot inspect the PR
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             assertFalse(authorPr.getBody().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(authorPr.body().contains(&quot;Approvers&quot;));</span>
  
              // Approve it
              authorPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Refresh the PR and check that it has been approved
<span class="udiff-line-modified-removed">-             authorPr = author.getPullRequest(authorPr.getId());</span>
<span class="udiff-line-modified-removed">-             assertTrue(authorPr.getBody().contains(&quot;Approvers&quot;));</span>
<span class="udiff-line-modified-added">+             authorPr = author.pullRequest(authorPr.id());</span>
<span class="udiff-line-modified-added">+             assertTrue(authorPr.body().contains(&quot;Approvers&quot;));</span>
  
              // Verify that the check failed
<span class="udiff-line-modified-removed">-             var checks = authorPr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = authorPr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.FAILURE, check.status());
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -294,50 +294,50 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make two changes with different authors
              CheckableRepository.appendAndCommit(localRepo, &quot;First edit&quot;, &quot;Edit by number 1&quot;,
                                                  &quot;number1&quot;, &quot;number1@none.none&quot;);
              var editHash = CheckableRepository.appendAndCommit(localRepo, &quot;Second edit&quot;, &quot;Edit by number 2&quot;,
                                                                 &quot;number2&quot;, &quot;number2@none.none&quot;);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check failed
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.FAILURE, check.status());
  
              // Approve it as another user
<span class="udiff-line-modified-removed">-             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The check should still be failing
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.FAILURE, check.status());
  
              // The PR should not be flagged as ready for review, as multiple committers is a problem
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
          }
      }
  
      @Test
      void updatedContentFailsCheck(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -345,76 +345,76 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check passed
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
  
              // The PR should now be ready for review
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;ready&quot;));</span>
  
              // Approve it as another user
<span class="udiff-line-modified-removed">-             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The check should now be successful
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
  
              // The PR should not be flagged as ready for review, at it is already reviewed
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;ready&quot;));</span>
  
              var addedHash = CheckableRepository.appendAndCommit(localRepo, &quot;trailing whitespace   &quot;);
<span class="udiff-line-modified-removed">-             localRepo.push(addedHash, author.getUrl(), &quot;edit&quot;);</span>
<span class="udiff-line-modified-added">+             localRepo.push(addedHash, author.url(), &quot;edit&quot;);</span>
  
              // Make sure that the push registered
<span class="udiff-line-modified-removed">-             var lastHeadHash = pr.getHeadHash();</span>
<span class="udiff-line-modified-added">+             var lastHeadHash = pr.headHash();</span>
              var refreshCount = 0;
              do {
<span class="udiff-line-modified-removed">-                 pr = author.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+                 pr = author.pullRequest(pr.id());</span>
                  if (refreshCount++ &gt; 100) {
                      fail(&quot;The PR did not update after the new push&quot;);
                  }
<span class="udiff-line-modified-removed">-             } while (pr.getHeadHash().equals(lastHeadHash));</span>
<span class="udiff-line-modified-added">+             } while (pr.headHash().equals(lastHeadHash));</span>
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The PR is now neither ready for review nor integration
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;ready&quot;));</span>
  
              // The check should now be failing
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(addedHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(addedHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.FAILURE, check.status());
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -428,59 +428,59 @@</span>
  
              // This test is only relevant on hosts not supporting proper review comment bodies
              assumeTrue(!author.host().supportsReviewBody());
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             var comments = pr.getComments();</span>
<span class="udiff-line-modified-added">+             var comments = pr.comments();</span>
              var commentCount = comments.size();
  
              // Approve it as another user
<span class="udiff-line-modified-removed">-             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // There should now be two additional comments
<span class="udiff-line-modified-removed">-             comments = pr.getComments();</span>
<span class="udiff-line-modified-added">+             comments = pr.comments();</span>
              assertEquals(commentCount + 2, comments.size());
              var comment = comments.get(commentCount);
<span class="udiff-line-modified-removed">-             assertTrue(comment.body().contains(reviewer.host().getCurrentUserDetails().userName()));</span>
<span class="udiff-line-modified-added">+             assertTrue(comment.body().contains(reviewer.host().currentUser().userName()));</span>
              assertTrue(comment.body().contains(&quot;approved&quot;));
  
              // Drop the review
              approvalPr.addReview(Review.Verdict.NONE, &quot;Unreviewed&quot;);
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // There should now be yet another comment
<span class="udiff-line-modified-removed">-             comments = pr.getComments();</span>
<span class="udiff-line-modified-added">+             comments = pr.comments();</span>
              assertEquals(commentCount + 3, comments.size());
              comment = comments.get(commentCount + 2);
<span class="udiff-line-modified-removed">-             assertTrue(comment.body().contains(reviewer.host().getCurrentUserDetails().userName()));</span>
<span class="udiff-line-modified-added">+             assertTrue(comment.body().contains(reviewer.host().currentUser().userName()));</span>
              assertTrue(comment.body().contains(&quot;comment&quot;));
  
              // No changes should not generate additional comments
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             comments = pr.getComments();</span>
<span class="udiff-line-modified-added">+             comments = pr.comments();</span>
              assertEquals(commentCount + 3, comments.size());
          }
      }
  
      @Test
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -490,27 +490,27 @@</span>
               var pushedFolder = new TemporaryDirectory()) {
  
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addCommitter(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(integrator.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addCommitter(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(integrator.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="udiff-line-modified-removed">-             var approvalPr = integrator.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var approvalPr = integrator.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Get all messages up to date
              TestBotRunner.runPeriodicItems(mergeBot);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -518,17 +518,17 @@</span>
              localRepo.checkout(masterHash, true);
              var unrelated = localRepo.root().resolve(&quot;unrelated.txt&quot;);
              Files.writeString(unrelated, &quot;Hello&quot;);
              localRepo.add(unrelated);
              var unrelatedHash = localRepo.commit(&quot;Unrelated&quot;, &quot;X&quot;, &quot;x@y.z&quot;);
<span class="udiff-line-modified-removed">-             localRepo.push(unrelatedHash, author.getUrl(), &quot;master&quot;);</span>
<span class="udiff-line-modified-added">+             localRepo.push(unrelatedHash, author.url(), &quot;master&quot;);</span>
  
              // Let the bot see the changes
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an ok message
<span class="udiff-line-modified-removed">-             var updated = pr.getComments().stream()</span>
<span class="udiff-line-modified-added">+             var updated = pr.comments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;there has been 1 commit&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;please merge&quot;))
                              .count();
              assertEquals(1, updated);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -541,70 +541,70 @@</span>
               var pushedFolder = new TemporaryDirectory()) {
  
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addCommitter(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(integrator.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addCommitter(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(integrator.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="udiff-line-modified-removed">-             var approvalPr = integrator.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var approvalPr = integrator.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Get all messages up to date
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Push something conflicting to master
              localRepo.checkout(masterHash, true);
              var conflictingHash = CheckableRepository.appendAndCommit(localRepo, &quot;This looks like a conflict&quot;);
<span class="udiff-line-modified-removed">-             localRepo.push(conflictingHash, author.getUrl(), &quot;master&quot;);</span>
<span class="udiff-line-modified-added">+             localRepo.push(conflictingHash, author.url(), &quot;master&quot;);</span>
  
              // Let the bot see the changes
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with that there is a conflict
<span class="udiff-line-modified-removed">-             var updated = pr.getComments().stream()</span>
<span class="udiff-line-modified-added">+             var updated = pr.comments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;there has been 1 commit&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;cannot be rebased automatically&quot;))
                              .count();
              assertEquals(1, updated);
  
              // The PR should be flagged as outdated
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;outdated&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;outdated&quot;));</span>
  
              // But it should still pass jcheck
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
  
              // Restore the master branch
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Let the bot see the changes
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should no longer detect a conflict
<span class="udiff-line-modified-removed">-             updated = pr.getComments().stream()</span>
<span class="udiff-line-modified-removed">-                             .filter(comment -&gt; comment.body().contains(&quot;change can now be integrated&quot;))</span>
<span class="udiff-line-modified-removed">-                             .count();</span>
<span class="udiff-line-modified-added">+             updated = pr.comments().stream()</span>
<span class="udiff-line-modified-added">+                         .filter(comment -&gt; comment.body().contains(&quot;change can now be integrated&quot;))</span>
<span class="udiff-line-modified-added">+                         .count();</span>
              assertEquals(1, updated);
  
              // The PR should not be flagged as outdated
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;outdated&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;outdated&quot;));</span>
          }
      }
  
      @Test
      void blockingLabel(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -612,48 +612,48 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;, Map.of(), Map.of(),
                                                Map.of(&quot;block&quot;, &quot;Test Blocker&quot;), Set.of(), Map.of());
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
              pr.addLabel(&quot;block&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check failed
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.FAILURE, check.status());
              assertTrue(check.summary().orElseThrow().contains(&quot;Test Blocker&quot;));
  
              // The PR should not yet be ready for review
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;block&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;block&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;ready&quot;));</span>
  
              // Check the status again
              pr.removeLabel(&quot;block&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The PR should now be ready for review
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;ready&quot;));</span>
          }
      }
  
      @Test
      void missingReadyLabel(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -661,41 +661,41 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;, Map.of(), Map.of(),
                                                Map.of(), Set.of(&quot;good-to-go&quot;), Map.of());
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that no checks have been run
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(0, checks.size());
  
              // The PR should not yet be ready for review
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
  
              // Check the status again
              pr.addLabel(&quot;good-to-go&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The PR should now be ready for review
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;rfr&quot;));</span>
          }
      }
  
      @Test
      void missingReadyComment(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -703,42 +703,42 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;, Map.of(), Map.of(),
<span class="udiff-line-modified-removed">-                                               Map.of(), Set.of(), Map.of(reviewer.host().getCurrentUserDetails().userName(), Pattern.compile(&quot;proceed&quot;)));</span>
<span class="udiff-line-modified-added">+                                               Map.of(), Set.of(), Map.of(reviewer.host().currentUser().userName(), Pattern.compile(&quot;proceed&quot;)));</span>
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that no checks have been run
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(0, checks.size());
  
              // The PR should not yet be ready for review
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
  
              // Check the status again
<span class="udiff-line-modified-removed">-             var reviewerPr = reviewer.getPullRequest(pr.getId());</span>
<span class="udiff-line-modified-added">+             var reviewerPr = reviewer.pullRequest(pr.id());</span>
              reviewerPr.addComment(&quot;proceed&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The PR should now be ready for review
<span class="udiff-line-modified-removed">-             assertTrue(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.labels().contains(&quot;rfr&quot;));</span>
          }
      }
  
      @Test
      void issueIssue(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -746,31 +746,31 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;, Map.of(), Map.of(),
                                                Map.of(), Set.of(), Map.of());
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType(), Path.of(&quot;appendable.txt&quot;),</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType(), Path.of(&quot;appendable.txt&quot;),</span>
                                                       Set.of(&quot;issues&quot;));
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check failed
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.FAILURE, check.status());
  
              // Add an issue to the title
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -778,11 +778,11 @@</span>
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The check should now be successful
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -794,81 +794,81 @@</span>
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
              var issues = credentials.getIssueProject();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;, Map.of(), Map.of(),
                                                Map.of(), Set.of(), Map.of(), issues);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType(), Path.of(&quot;appendable.txt&quot;),</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType(), Path.of(&quot;appendable.txt&quot;),</span>
                                                       Set.of(&quot;issues&quot;));
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              var issue1 = issues.createIssue(&quot;My first issue&quot;, List.of(&quot;Hello&quot;));
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-removed">-             var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, issue1.getId() + &quot;: This is a pull request&quot;);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, issue1.id() + &quot;: This is a pull request&quot;);</span>
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The check should be successful
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
  
              // And the body should contain the issue title
<span class="udiff-line-modified-removed">-             assertTrue(pr.getBody().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.body().contains(&quot;My first issue&quot;));</span>
  
              // Change the issue
              var issue2 = issues.createIssue(&quot;My second issue&quot;, List.of(&quot;Body&quot;));
<span class="udiff-line-modified-removed">-             pr.setTitle(issue2.getId() + &quot;: This is a pull request&quot;);</span>
<span class="udiff-line-modified-added">+             pr.setTitle(issue2.id() + &quot;: This is a pull request&quot;);</span>
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
  
              // The body should contain the updated issue title
<span class="udiff-line-modified-removed">-             assertFalse(pr.getBody().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-removed">-             assertTrue(pr.getBody().contains(&quot;My second issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.body().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.body().contains(&quot;My second issue&quot;));</span>
  
              // Use an invalid issue key
<span class="udiff-line-modified-removed">-             var issueKey = issue1.getId().replace(&quot;TEST&quot;, &quot;BADPROJECT&quot;);</span>
<span class="udiff-line-modified-added">+             var issueKey = issue1.id().replace(&quot;TEST&quot;, &quot;BADPROJECT&quot;);</span>
              pr.setTitle(issueKey + &quot;: This is a pull request&quot;);
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             assertFalse(pr.getBody().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getBody().contains(&quot;My second issue&quot;));</span>
<span class="udiff-line-modified-removed">-             assertTrue(pr.getBody().contains(&quot;Failed to retrieve&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.body().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.body().contains(&quot;My second issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.body().contains(&quot;Failed to retrieve&quot;));</span>
  
              // Now drop the issue key
<span class="udiff-line-modified-removed">-             issueKey = issue1.getId().replace(&quot;TEST-&quot;, &quot;&quot;);</span>
<span class="udiff-line-modified-added">+             issueKey = issue1.id().replace(&quot;TEST-&quot;, &quot;&quot;);</span>
              pr.setTitle(issueKey + &quot;: This is a pull request&quot;);
  
              // The body should now contain the updated issue title
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             assertTrue(pr.getBody().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getBody().contains(&quot;My second issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.body().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.body().contains(&quot;My second issue&quot;));</span>
  
              // Now enter an invalid issue id
              pr.setTitle(&quot;2384848: This is a pull request&quot;);
  
              // Check the status again
              TestBotRunner.runPeriodicItems(checkBot);
<span class="udiff-line-modified-removed">-             assertFalse(pr.getBody().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getBody().contains(&quot;My second issue&quot;));</span>
<span class="udiff-line-modified-removed">-             assertTrue(pr.getBody().contains(&quot;Failed to retrieve&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.body().contains(&quot;My first issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.body().contains(&quot;My second issue&quot;));</span>
<span class="udiff-line-modified-added">+             assertTrue(pr.body().contains(&quot;Failed to retrieve&quot;));</span>
  
              // The check should still be successful though
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -878,42 +878,42 @@</span>
          try (var credentials = new HostCredentials(testInfo);
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Verify no checks exists
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(0, checks.size());
  
              // Create a check that is running
              var original = CheckBuilder.create(&quot;jcheck&quot;, editHash)
                                         .title(&quot;jcheck title&quot;)
                                         .summary(&quot;jcheck summary&quot;)
                                         .build();
              pr.createCheck(original);
  
              // Verify check is created
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var retrieved = checks.get(&quot;jcheck&quot;);
              assertEquals(&quot;jcheck title&quot;, retrieved.title().get());
              assertEquals(&quot;jcheck summary&quot;, retrieved.summary().get());
              assertEquals(CheckStatus.IN_PROGRESS, retrieved.status());
  
              // Cancel the check
              var cancelled = CheckBuilder.from(retrieved).cancel().build();
              pr.updateCheck(cancelled);
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              retrieved = checks.get(&quot;jcheck&quot;);
              assertEquals(&quot;jcheck title&quot;, retrieved.title().get());
              assertEquals(&quot;jcheck summary&quot;, retrieved.summary().get());
              assertEquals(CheckStatus.CANCELLED, retrieved.status());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -926,47 +926,47 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Enable a new check in the target branch
              localRepo.checkout(masterHash, true);
<span class="udiff-line-modified-removed">-             CheckableRepository.init(tempFolder.path(), author.getRepositoryType(), Path.of(&quot;appendable.txt&quot;),</span>
<span class="udiff-line-modified-added">+             CheckableRepository.init(tempFolder.path(), author.repositoryType(), Path.of(&quot;appendable.txt&quot;),</span>
                                       Set.of(&quot;author&quot;, &quot;reviewers&quot;, &quot;whitespace&quot;, &quot;issues&quot;));
              var headHash = localRepo.resolve(&quot;HEAD&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(headHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(headHash, author.url(), &quot;master&quot;, true);</span>
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check failed
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertTrue(check.summary().orElseThrow().contains(&quot;commit message does not reference any issue&quot;));
              assertEquals(CheckStatus.FAILURE, check.status());
  
              // Adjust the title to conform and check the status again
              pr.setTitle(&quot;12345: This is a pull request&quot;);
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check passed
<span class="udiff-line-modified-removed">-             checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -977,35 +977,35 @@</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="udiff-line-modified-removed">-                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="udiff-line-modified-removed">-                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
<span class="udiff-line-modified-added">+                                            .addAuthor(author.host().currentUser().id())</span>
<span class="udiff-line-modified-added">+                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var checkBot = new PullRequestBot(author, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="udiff-line-modified-removed">-             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
<span class="udiff-line-modified-added">+             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
<span class="udiff-line-modified-removed">-             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="udiff-line-modified-removed">-             localRepo.push(editHash, author.getUrl(), &quot;refs/heads/edit&quot;, true);</span>
<span class="udiff-line-modified-added">+             localRepo.push(editHash, author.url(), &quot;refs/heads/edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;,
                                                     &quot;This is a pull request&quot;, true);
  
              // Check the status
              TestBotRunner.runPeriodicItems(checkBot);
  
              // Verify that the check succeeded
<span class="udiff-line-modified-removed">-             var checks = pr.getChecks(editHash);</span>
<span class="udiff-line-modified-added">+             var checks = pr.checks(editHash);</span>
              assertEquals(1, checks.size());
              var check = checks.get(&quot;jcheck&quot;);
              assertEquals(CheckStatus.SUCCESS, check.status());
  
              // The PR should still not be ready for review as it is a draft
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-removed">-             assertFalse(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;rfr&quot;));</span>
<span class="udiff-line-modified-added">+             assertFalse(pr.labels().contains(&quot;ready&quot;));</span>
          }
      }
  }
</pre>
<center><a href="../../../../../../../main/java/org/openjdk/skara/bots/pr/Veto.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="CommandTests.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>