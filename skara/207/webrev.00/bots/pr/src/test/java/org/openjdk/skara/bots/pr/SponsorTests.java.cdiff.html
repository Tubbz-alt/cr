<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff bots/pr/src/test/java/org/openjdk/skara/bots/pr/SponsorTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PullRequestAsserts.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SummaryTests.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>bots/pr/src/test/java/org/openjdk/skara/bots/pr/SponsorTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 41,64 ***</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
              if (isAuthor) {
<span class="line-modified">!                 censusBuilder.addAuthor(author.host().getCurrentUserDetails().id());</span>
              }
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Issue a merge command without being a Committer
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply that a sponsor is required
<span class="line-modified">!             var sponsor = pr.getComments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;sponsor&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;your change&quot;))
                              .count();
              assertEquals(1, sponsor);
  
              // The bot should not have pushed the commit
<span class="line-modified">!             var notPushed = pr.getComments().stream()</span>
                                .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                                .count();
              assertEquals(0, notPushed);
  
              // Reviewer now agrees to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.getPullRequest(pr.getId());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should have pushed the commit
<span class="line-modified">!             var pushed = pr.getComments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .count();
              assertEquals(1, pushed);
  
              // The change should now be present on the master branch
<span class="line-modified">!             var pushedRepo = Repository.materialize(pushedFolder.path(), author.getUrl(), &quot;master&quot;);</span>
              var headHash = pushedRepo.resolve(&quot;HEAD&quot;).orElseThrow();
              var headCommit = pushedRepo.commits(headHash.hex() + &quot;^..&quot; + headHash.hex()).asList().get(0);
  
              if (isAuthor) {
                  assertEquals(&quot;Generated Author 2&quot;, headCommit.author().name());
<span class="line-new-header">--- 41,64 ---</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().currentUser().id());</span>
              if (isAuthor) {
<span class="line-modified">!                 censusBuilder.addAuthor(author.host().currentUser().id());</span>
              }
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Issue a merge command without being a Committer
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply that a sponsor is required
<span class="line-modified">!             var sponsor = pr.comments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;sponsor&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;your change&quot;))
                              .count();
              assertEquals(1, sponsor);
  
              // The bot should not have pushed the commit
<span class="line-modified">!             var notPushed = pr.comments().stream()</span>
                                .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                                .count();
              assertEquals(0, notPushed);
  
              // Reviewer now agrees to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.pullRequest(pr.id());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should have pushed the commit
<span class="line-modified">!             var pushed = pr.comments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .count();
              assertEquals(1, pushed);
  
              // The change should now be present on the master branch
<span class="line-modified">!             var pushedRepo = Repository.materialize(pushedFolder.path(), author.url(), &quot;master&quot;);</span>
              var headHash = pushedRepo.resolve(&quot;HEAD&quot;).orElseThrow();
              var headCommit = pushedRepo.commits(headHash.hex() + &quot;^..&quot; + headHash.hex()).asList().get(0);
  
              if (isAuthor) {
                  assertEquals(&quot;Generated Author 2&quot;, headCommit.author().name());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 108,13 ***</span>
                  assertEquals(&quot;ta@none.none&quot;, headCommit.author().email());
              }
  
              assertEquals(&quot;Generated Reviewer 1&quot;, headCommit.committer().name());
              assertEquals(&quot;integrationreviewer1@openjdk.java.net&quot;, headCommit.committer().email());
<span class="line-modified">!             assertTrue(pr.getLabels().contains(&quot;integrated&quot;));</span>
<span class="line-modified">!             assertFalse(pr.getLabels().contains(&quot;ready&quot;));</span>
<span class="line-modified">!             assertFalse(pr.getLabels().contains(&quot;sponsor&quot;));</span>
          }
      }
  
      @Test
      void sponsorNonAuthor(TestInfo testInfo) throws IOException {
<span class="line-new-header">--- 108,13 ---</span>
                  assertEquals(&quot;ta@none.none&quot;, headCommit.author().email());
              }
  
              assertEquals(&quot;Generated Reviewer 1&quot;, headCommit.committer().name());
              assertEquals(&quot;integrationreviewer1@openjdk.java.net&quot;, headCommit.committer().email());
<span class="line-modified">!             assertTrue(pr.labels().contains(&quot;integrated&quot;));</span>
<span class="line-modified">!             assertFalse(pr.labels().contains(&quot;ready&quot;));</span>
<span class="line-modified">!             assertFalse(pr.labels().contains(&quot;sponsor&quot;));</span>
          }
      }
  
      @Test
      void sponsorNonAuthor(TestInfo testInfo) throws IOException {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 132,30 ***</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addCommitter(author.host().getCurrentUserDetails().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Issue an invalid command
              pr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;does not need sponsoring&quot;))
                            .count();
              assertEquals(1, error);
          }
      }
<span class="line-new-header">--- 132,30 ---</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addCommitter(author.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Issue an invalid command
              pr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;does not need sponsoring&quot;))
                            .count();
              assertEquals(1, error);
          }
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 166,30 ***</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addAuthor(author.host().getCurrentUserDetails().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Issue an invalid command
              pr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;Committers&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;are allowed to sponsor&quot;))
                            .count();
              assertEquals(1, error);
          }
<span class="line-new-header">--- 166,30 ---</span>
               var tempFolder = new TemporaryDirectory()) {
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addAuthor(author.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Issue an invalid command
              pr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;Committers&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;are allowed to sponsor&quot;))
                            .count();
              assertEquals(1, error);
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 202,31 ***</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Reviewer now tries to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.getPullRequest(pr.getId());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;before the integration can be sponsored&quot;))
                            .count();
              assertEquals(1, error);
          }
      }
<span class="line-new-header">--- 202,31 ---</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Reviewer now tries to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.pullRequest(pr.id());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;before the integration can be sponsored&quot;))
                            .count();
              assertEquals(1, error);
          }
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 238,84 ***</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Flag it as ready for integration
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Bot should have replied
<span class="line-modified">!             var ready = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;now ready to be sponsored&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;at version &quot; + editHash.hex()))
                            .count();
              assertEquals(1, ready);
<span class="line-modified">!             assertTrue(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // Push another change
              var updateHash = CheckableRepository.appendAndCommit(localRepo,&quot;Yet more stuff&quot;);
<span class="line-modified">!             localRepo.push(updateHash, author.getUrl(), &quot;edit&quot;);</span>
  
              // Make sure that the push registered
<span class="line-modified">!             var lastHeadHash = pr.getHeadHash();</span>
              var refreshCount = 0;
              do {
<span class="line-modified">!                 pr = author.getPullRequest(pr.getId());</span>
                  if (refreshCount++ &gt; 100) {
                      fail(&quot;The PR did not update after the new push&quot;);
                  }
<span class="line-modified">!             } while (pr.getHeadHash().equals(lastHeadHash));</span>
  
              // The label should have been dropped
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // Reviewer now tries to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.getPullRequest(pr.getId());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;The PR has been updated since the change&quot;))
                            .count();
              assertEquals(1, error);
  
              // Flag it as ready for integration again
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertTrue(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // It should now be possible to sponsor
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // The bot should have pushed the commit
<span class="line-modified">!             var pushed = pr.getComments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .count();
              assertEquals(1, pushed);
          }
      }
<span class="line-new-header">--- 238,84 ---</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Flag it as ready for integration
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Bot should have replied
<span class="line-modified">!             var ready = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;now ready to be sponsored&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;at version &quot; + editHash.hex()))
                            .count();
              assertEquals(1, ready);
<span class="line-modified">!             assertTrue(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // Push another change
              var updateHash = CheckableRepository.appendAndCommit(localRepo,&quot;Yet more stuff&quot;);
<span class="line-modified">!             localRepo.push(updateHash, author.url(), &quot;edit&quot;);</span>
  
              // Make sure that the push registered
<span class="line-modified">!             var lastHeadHash = pr.headHash();</span>
              var refreshCount = 0;
              do {
<span class="line-modified">!                 pr = author.pullRequest(pr.id());</span>
                  if (refreshCount++ &gt; 100) {
                      fail(&quot;The PR did not update after the new push&quot;);
                  }
<span class="line-modified">!             } while (pr.headHash().equals(lastHeadHash));</span>
  
              // The label should have been dropped
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // Reviewer now tries to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.pullRequest(pr.id());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;The PR has been updated since the change&quot;))
                            .count();
              assertEquals(1, error);
  
              // Flag it as ready for integration again
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertTrue(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // It should now be possible to sponsor
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // The bot should have pushed the commit
<span class="line-modified">!             var pushed = pr.comments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .count();
              assertEquals(1, pushed);
          }
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 328,63 ***</span>
  
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addAuthor(author.host().getCurrentUserDetails().id())</span>
<span class="line-modified">!                                            .addReviewer(integrator.host().getCurrentUserDetails().id())</span>
<span class="line-modified">!                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = integrator.getPullRequest(pr.getId());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Push something unrelated to master
              localRepo.checkout(masterHash, true);
              var unrelated = localRepo.root().resolve(&quot;unrelated.txt&quot;);
              Files.writeString(unrelated, &quot;Hello&quot;);
              localRepo.add(unrelated);
              var unrelatedHash = localRepo.commit(&quot;Unrelated&quot;, &quot;X&quot;, &quot;x@y.z&quot;);
<span class="line-modified">!             localRepo.push(unrelatedHash, author.getUrl(), &quot;master&quot;);</span>
  
              // Issue a merge command without being a Committer
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply that a sponsor is required
<span class="line-modified">!             var sponsor = pr.getComments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;sponsor&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;your change&quot;))
                              .count();
              assertEquals(1, sponsor);
  
              // Reviewer now agrees to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.getPullRequest(pr.getId());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an ok message
<span class="line-modified">!             var pushed = pr.getComments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .filter(comment -&gt; comment.body().contains(&quot;commit was automatically rebased without conflicts&quot;))
                             .count();
              assertEquals(1, pushed);
  
              // The change should now be present on the master branch
<span class="line-modified">!             var pushedRepo = Repository.materialize(pushedFolder.path(), author.getUrl(), &quot;master&quot;);</span>
              assertTrue(CheckableRepository.hasBeenEdited(pushedRepo));
          }
      }
  
      @Test
<span class="line-new-header">--- 328,63 ---</span>
  
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addAuthor(author.host().currentUser().id())</span>
<span class="line-modified">!                                            .addReviewer(integrator.host().currentUser().id())</span>
<span class="line-modified">!                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = integrator.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Push something unrelated to master
              localRepo.checkout(masterHash, true);
              var unrelated = localRepo.root().resolve(&quot;unrelated.txt&quot;);
              Files.writeString(unrelated, &quot;Hello&quot;);
              localRepo.add(unrelated);
              var unrelatedHash = localRepo.commit(&quot;Unrelated&quot;, &quot;X&quot;, &quot;x@y.z&quot;);
<span class="line-modified">!             localRepo.push(unrelatedHash, author.url(), &quot;master&quot;);</span>
  
              // Issue a merge command without being a Committer
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply that a sponsor is required
<span class="line-modified">!             var sponsor = pr.comments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;sponsor&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;your change&quot;))
                              .count();
              assertEquals(1, sponsor);
  
              // Reviewer now agrees to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.pullRequest(pr.id());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an ok message
<span class="line-modified">!             var pushed = pr.comments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .filter(comment -&gt; comment.body().contains(&quot;commit was automatically rebased without conflicts&quot;))
                             .count();
              assertEquals(1, pushed);
  
              // The change should now be present on the master branch
<span class="line-modified">!             var pushedRepo = Repository.materialize(pushedFolder.path(), author.url(), &quot;master&quot;);</span>
              assertTrue(CheckableRepository.hasBeenEdited(pushedRepo));
          }
      }
  
      @Test
</pre>
<hr />
<pre>
<span class="line-old-header">*** 394,74 ***</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().getCurrentUserDetails().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Flag it as ready for integration
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Bot should have replied
<span class="line-modified">!             var ready = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;now ready to be sponsored&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;at version &quot; + editHash.hex()))
                            .count();
              assertEquals(1, ready);
<span class="line-modified">!             assertTrue(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // The reviewer now changes their mind
              approvalPr.addReview(Review.Verdict.DISAPPROVED, &quot;No wait, disapproved&quot;);
  
              // The label should have been dropped
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // Reviewer now tries to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.getPullRequest(pr.getId());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;merge request cannot be fulfilled at this time&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;failed the final jcheck&quot;))
                            .count();
              assertEquals(1, error);
  
              // Make it ready for integration again
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Sorry, wrong button&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertTrue(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // It should now be possible to sponsor
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.getLabels().contains(&quot;sponsor&quot;));</span>
  
              // The bot should have pushed the commit
<span class="line-modified">!             var pushed = pr.getComments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .count();
              assertEquals(1, pushed);
          }
      }
<span class="line-new-header">--- 394,74 ---</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Flag it as ready for integration
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Bot should have replied
<span class="line-modified">!             var ready = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;now ready to be sponsored&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;at version &quot; + editHash.hex()))
                            .count();
              assertEquals(1, ready);
<span class="line-modified">!             assertTrue(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // The reviewer now changes their mind
              approvalPr.addReview(Review.Verdict.DISAPPROVED, &quot;No wait, disapproved&quot;);
  
              // The label should have been dropped
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // Reviewer now tries to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.pullRequest(pr.id());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;merge request cannot be fulfilled at this time&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;failed the final jcheck&quot;))
                            .count();
              assertEquals(1, error);
  
              // Make it ready for integration again
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Sorry, wrong button&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertTrue(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // It should now be possible to sponsor
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
<span class="line-modified">!             assertFalse(pr.labels().contains(&quot;sponsor&quot;));</span>
  
              // The bot should have pushed the commit
<span class="line-modified">!             var pushed = pr.comments().stream()</span>
                             .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                             .count();
              assertEquals(1, pushed);
          }
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 473,61 ***</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().getCurrentUserDetails().id())</span>
<span class="line-modified">!                                            .addAuthor(author.host().getCurrentUserDetails().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.getRepositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.getUrl(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.getPullRequest(pr.getId());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Issue a merge command without being a Committer
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply that a sponsor is required
<span class="line-modified">!             var sponsor = pr.getComments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;sponsor&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;your change&quot;))
                              .count();
              assertEquals(1, sponsor);
  
              // The bot should not have pushed the commit
<span class="line-modified">!             var notPushed = pr.getComments().stream()</span>
                                .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                                .count();
              assertEquals(0, notPushed);
  
              // Push something conflicting to master
              localRepo.checkout(masterHash, true);
              var conflictingHash = CheckableRepository.appendAndCommit(localRepo, &quot;This looks like a conflict&quot;);
<span class="line-modified">!             localRepo.push(conflictingHash, author.getUrl(), &quot;master&quot;);</span>
  
              // Reviewer now agrees to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.getPullRequest(pr.getId());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.getComments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;It was not possible to rebase your changes automatically.&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;Please merge `master`&quot;))
                            .count();
              assertEquals(1, error);
          }
<span class="line-new-header">--- 473,61 ---</span>
              var author = credentials.getHostedRepository();
              var integrator = credentials.getHostedRepository();
              var reviewer = credentials.getHostedRepository();
  
              var censusBuilder = credentials.getCensusBuilder()
<span class="line-modified">!                                            .addReviewer(reviewer.host().currentUser().id())</span>
<span class="line-modified">!                                            .addAuthor(author.host().currentUser().id());</span>
              var mergeBot = new PullRequestBot(integrator, censusBuilder.build(), &quot;master&quot;);
  
              // Populate the projects repository
<span class="line-modified">!             var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());</span>
              var masterHash = localRepo.resolve(&quot;master&quot;).orElseThrow();
              assertFalse(CheckableRepository.hasBeenEdited(localRepo));
<span class="line-modified">!             localRepo.push(masterHash, author.url(), &quot;master&quot;, true);</span>
  
              // Make a change with a corresponding PR
              var editHash = CheckableRepository.appendAndCommit(localRepo);
<span class="line-modified">!             localRepo.push(editHash, author.url(), &quot;edit&quot;, true);</span>
              var pr = credentials.createPullRequest(author, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
  
              // Approve it as another user
<span class="line-modified">!             var approvalPr = reviewer.pullRequest(pr.id());</span>
              approvalPr.addReview(Review.Verdict.APPROVED, &quot;Approved&quot;);
  
              // Let the bot see it
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // Issue a merge command without being a Committer
              pr.addComment(&quot;/integrate&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply that a sponsor is required
<span class="line-modified">!             var sponsor = pr.comments().stream()</span>
                              .filter(comment -&gt; comment.body().contains(&quot;sponsor&quot;))
                              .filter(comment -&gt; comment.body().contains(&quot;your change&quot;))
                              .count();
              assertEquals(1, sponsor);
  
              // The bot should not have pushed the commit
<span class="line-modified">!             var notPushed = pr.comments().stream()</span>
                                .filter(comment -&gt; comment.body().contains(&quot;Pushed as commit&quot;))
                                .count();
              assertEquals(0, notPushed);
  
              // Push something conflicting to master
              localRepo.checkout(masterHash, true);
              var conflictingHash = CheckableRepository.appendAndCommit(localRepo, &quot;This looks like a conflict&quot;);
<span class="line-modified">!             localRepo.push(conflictingHash, author.url(), &quot;master&quot;);</span>
  
              // Reviewer now agrees to sponsor
<span class="line-modified">!             var reviewerPr = reviewer.pullRequest(pr.id());</span>
              reviewerPr.addComment(&quot;/sponsor&quot;);
              TestBotRunner.runPeriodicItems(mergeBot);
  
              // The bot should reply with an error message
<span class="line-modified">!             var error = pr.comments().stream()</span>
                            .filter(comment -&gt; comment.body().contains(&quot;It was not possible to rebase your changes automatically.&quot;))
                            .filter(comment -&gt; comment.body().contains(&quot;Please merge `master`&quot;))
                            .count();
              assertEquals(1, error);
          }
</pre>
<center><a href="PullRequestAsserts.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SummaryTests.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>