<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff host/src/main/java/org/openjdk/skara/host/github/GitHubPullRequest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="GitHubHost.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="GitHubRepository.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>host/src/main/java/org/openjdk/skara/host/github/GitHubPullRequest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 21,11 ***</span>
   * questions.
   */
  package org.openjdk.skara.host.github;
  
  import org.openjdk.skara.host.*;
<span class="line-modified">! import org.openjdk.skara.host.network.*;</span>
  import org.openjdk.skara.json.*;
  import org.openjdk.skara.vcs.Hash;
  
  import java.net.URI;
  import java.time.*;
<span class="line-new-header">--- 21,11 ---</span>
   * questions.
   */
  package org.openjdk.skara.host.github;
  
  import org.openjdk.skara.host.*;
<span class="line-modified">! import org.openjdk.skara.network.*;</span>
  import org.openjdk.skara.json.*;
  import org.openjdk.skara.vcs.Hash;
  
  import java.net.URI;
  import java.time.*;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 57,21 ***</span>
      public IssueProject project() {
          return repository;
      }
  
      @Override
<span class="line-modified">!     public String getId() {</span>
          return json.get(&quot;number&quot;).toString();
      }
  
      @Override
<span class="line-modified">!     public HostUserDetails getAuthor() {</span>
          return host.parseUserField(json);
      }
  
      @Override
<span class="line-modified">!     public List&lt;Review&gt; getReviews() {</span>
          var reviews = request.get(&quot;pulls/&quot; + json.get(&quot;number&quot;).toString() + &quot;/reviews&quot;).execute().stream()
                               .map(JSONValue::asObject)
                               .filter(obj -&gt; !(obj.get(&quot;state&quot;).asString().equals(&quot;COMMENTED&quot;) &amp;&amp; obj.get(&quot;body&quot;).asString().isEmpty()))
                               .map(obj -&gt; {
                                   var reviewer = host.parseUserField(obj);
<span class="line-new-header">--- 57,21 ---</span>
      public IssueProject project() {
          return repository;
      }
  
      @Override
<span class="line-modified">!     public String id() {</span>
          return json.get(&quot;number&quot;).toString();
      }
  
      @Override
<span class="line-modified">!     public HostUser author() {</span>
          return host.parseUserField(json);
      }
  
      @Override
<span class="line-modified">!     public List&lt;Review&gt; reviews() {</span>
          var reviews = request.get(&quot;pulls/&quot; + json.get(&quot;number&quot;).toString() + &quot;/reviews&quot;).execute().stream()
                               .map(JSONValue::asObject)
                               .filter(obj -&gt; !(obj.get(&quot;state&quot;).asString().equals(&quot;COMMENTED&quot;) &amp;&amp; obj.get(&quot;body&quot;).asString().isEmpty()))
                               .map(obj -&gt; {
                                   var reviewer = host.parseUserField(obj);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 165,11 ***</span>
                  .execute();
          return parseReviewComment(parent, response.asObject(), diff);
      }
  
      @Override
<span class="line-modified">!     public List&lt;ReviewComment&gt; getReviewComments() {</span>
          var rawDiff = request.get(&quot;pulls/&quot; + json.get(&quot;number&quot;).toString())
                            .header(&quot;Accept&quot;, &quot;application/vnd.github.v3.diff&quot;)
                            .executeUnparsed();
          var diff = PositionMapper.parse(rawDiff);
  
<span class="line-new-header">--- 165,11 ---</span>
                  .execute();
          return parseReviewComment(parent, response.asObject(), diff);
      }
  
      @Override
<span class="line-modified">!     public List&lt;ReviewComment&gt; reviewComments() {</span>
          var rawDiff = request.get(&quot;pulls/&quot; + json.get(&quot;number&quot;).toString())
                            .header(&quot;Accept&quot;, &quot;application/vnd.github.v3.diff&quot;)
                            .executeUnparsed();
          var diff = PositionMapper.parse(rawDiff);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 191,41 ***</span>
  
          return ret;
      }
  
      @Override
<span class="line-modified">!     public Hash getHeadHash() {</span>
          return new Hash(json.get(&quot;head&quot;).get(&quot;sha&quot;).asString());
      }
  
      @Override
<span class="line-modified">!     public String getSourceRef() {</span>
<span class="line-modified">!         return &quot;pull/&quot; + getId() + &quot;/head&quot;;</span>
      }
  
      @Override
<span class="line-modified">!     public String getTargetRef() {</span>
          return json.get(&quot;base&quot;).get(&quot;ref&quot;).asString();
      }
  
      @Override
<span class="line-modified">!     public Hash getTargetHash() {</span>
<span class="line-modified">!         return repository.getBranchHash(getTargetRef());</span>
      }
  
      @Override
<span class="line-modified">!     public String getTitle() {</span>
          return json.get(&quot;title&quot;).asString();
      }
  
      @Override
      public void setTitle(String title) {
          throw new RuntimeException(&quot;not implemented yet&quot;);
      }
  
      @Override
<span class="line-modified">!     public String getBody() {</span>
          var body = json.get(&quot;body&quot;).asString();
          if (body == null) {
              body = &quot;&quot;;
          }
          return body;
<span class="line-new-header">--- 191,41 ---</span>
  
          return ret;
      }
  
      @Override
<span class="line-modified">!     public Hash headHash() {</span>
          return new Hash(json.get(&quot;head&quot;).get(&quot;sha&quot;).asString());
      }
  
      @Override
<span class="line-modified">!     public String sourceRef() {</span>
<span class="line-modified">!         return &quot;pull/&quot; + id() + &quot;/head&quot;;</span>
      }
  
      @Override
<span class="line-modified">!     public String targetRef() {</span>
          return json.get(&quot;base&quot;).get(&quot;ref&quot;).asString();
      }
  
      @Override
<span class="line-modified">!     public Hash targetHash() {</span>
<span class="line-modified">!         return repository.branchHash(targetRef());</span>
      }
  
      @Override
<span class="line-modified">!     public String title() {</span>
          return json.get(&quot;title&quot;).asString();
      }
  
      @Override
      public void setTitle(String title) {
          throw new RuntimeException(&quot;not implemented yet&quot;);
      }
  
      @Override
<span class="line-modified">!     public String body() {</span>
          var body = json.get(&quot;body&quot;).asString();
          if (body == null) {
              body = &quot;&quot;;
          }
          return body;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 246,11 ***</span>
                                ZonedDateTime.parse(comment.get(&quot;updated_at&quot;).asString()));
          return ret;
      }
  
      @Override
<span class="line-modified">!     public List&lt;Comment&gt; getComments() {</span>
          return request.get(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/comments&quot;).execute().stream()
                  .map(this::parseComment)
                  .collect(Collectors.toList());
      }
  
<span class="line-new-header">--- 246,11 ---</span>
                                ZonedDateTime.parse(comment.get(&quot;updated_at&quot;).asString()));
          return ret;
      }
  
      @Override
<span class="line-modified">!     public List&lt;Comment&gt; comments() {</span>
          return request.get(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/comments&quot;).execute().stream()
                  .map(this::parseComment)
                  .collect(Collectors.toList());
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 269,21 ***</span>
                  .execute();
          return parseComment(comment);
      }
  
      @Override
<span class="line-modified">!     public ZonedDateTime getCreated() {</span>
          return ZonedDateTime.parse(json.get(&quot;created_at&quot;).asString());
      }
  
      @Override
<span class="line-modified">!     public ZonedDateTime getUpdated() {</span>
          return ZonedDateTime.parse(json.get(&quot;updated_at&quot;).asString());
      }
  
      @Override
<span class="line-modified">!     public Map&lt;String, Check&gt; getChecks(Hash hash) {</span>
          var checks = request.get(&quot;commits/&quot; + hash.hex() + &quot;/check-runs&quot;).execute();
  
          return checks.get(&quot;check_runs&quot;).stream()
                  .collect(Collectors.toMap(c -&gt; c.get(&quot;name&quot;).asString(),
                          c -&gt; {
<span class="line-new-header">--- 269,21 ---</span>
                  .execute();
          return parseComment(comment);
      }
  
      @Override
<span class="line-modified">!     public ZonedDateTime createdAt() {</span>
          return ZonedDateTime.parse(json.get(&quot;created_at&quot;).asString());
      }
  
      @Override
<span class="line-modified">!     public ZonedDateTime updatedAt() {</span>
          return ZonedDateTime.parse(json.get(&quot;updated_at&quot;).asString());
      }
  
      @Override
<span class="line-modified">!     public Map&lt;String, Check&gt; checks(Hash hash) {</span>
          var checks = request.get(&quot;commits/&quot; + hash.hex() + &quot;/check-runs&quot;).execute();
  
          return checks.get(&quot;check_runs&quot;).stream()
                  .collect(Collectors.toMap(c -&gt; c.get(&quot;name&quot;).asString(),
                          c -&gt; {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 388,17 ***</span>
  
          request.post(&quot;check-runs&quot;).body(completedQuery).execute();
      }
  
      @Override
<span class="line-modified">!     public URI getChangeUrl() {</span>
<span class="line-modified">!         return URIBuilder.base(getWebUrl()).appendPath(&quot;/files&quot;).build();</span>
      }
  
      @Override
<span class="line-modified">!     public URI getChangeUrl(Hash base) {</span>
<span class="line-modified">!         return URIBuilder.base(getWebUrl()).appendPath(&quot;/files/&quot; + base.abbreviate() + &quot;..&quot; + getHeadHash().abbreviate()).build();</span>
      }
  
      @Override
      public boolean isDraft() {
          return json.get(&quot;draft&quot;).asBoolean();
<span class="line-new-header">--- 388,17 ---</span>
  
          request.post(&quot;check-runs&quot;).body(completedQuery).execute();
      }
  
      @Override
<span class="line-modified">!     public URI changeUrl() {</span>
<span class="line-modified">!         return URIBuilder.base(webUrl()).appendPath(&quot;/files&quot;).build();</span>
      }
  
      @Override
<span class="line-modified">!     public URI changeUrl(Hash base) {</span>
<span class="line-modified">!         return URIBuilder.base(webUrl()).appendPath(&quot;/files/&quot; + base.abbreviate() + &quot;..&quot; + headHash().abbreviate()).build();</span>
      }
  
      @Override
      public boolean isDraft() {
          return json.get(&quot;draft&quot;).asBoolean();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 431,40 ***</span>
                 })
                 .execute();
      }
  
      @Override
<span class="line-modified">!     public List&lt;String&gt; getLabels() {</span>
          return request.get(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels&quot;).execute().stream()
                        .map(JSONValue::asObject)
                        .map(obj -&gt; obj.get(&quot;name&quot;).asString())
                        .sorted()
                        .collect(Collectors.toList());
      }
  
      @Override
<span class="line-modified">!     public URI getWebUrl() {</span>
          var host = (GitHubHost)repository.host();
<span class="line-modified">!         var endpoint = &quot;/&quot; + repository.getName() + &quot;/pull/&quot; + getId();</span>
          return host.getWebURI(endpoint);
      }
  
      @Override
      public String toString() {
<span class="line-modified">!         return &quot;GitHubPullRequest #&quot; + getId() + &quot; by &quot; + getAuthor();</span>
      }
  
      @Override
<span class="line-modified">!     public List&lt;HostUserDetails&gt; getAssignees() {</span>
          return json.get(&quot;assignees&quot;).asArray()
                                      .stream()
                                      .map(host::parseUserObject)
                                      .collect(Collectors.toList());
      }
  
      @Override
<span class="line-modified">!     public void setAssignees(List&lt;HostUserDetails&gt; assignees) {</span>
          var assignee_ids = JSON.array();
          for (var assignee : assignees) {
              assignee_ids.add(assignee.userName());
          }
          var param = JSON.object().put(&quot;assignees&quot;, assignee_ids);
<span class="line-new-header">--- 431,40 ---</span>
                 })
                 .execute();
      }
  
      @Override
<span class="line-modified">!     public List&lt;String&gt; labels() {</span>
          return request.get(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels&quot;).execute().stream()
                        .map(JSONValue::asObject)
                        .map(obj -&gt; obj.get(&quot;name&quot;).asString())
                        .sorted()
                        .collect(Collectors.toList());
      }
  
      @Override
<span class="line-modified">!     public URI webUrl() {</span>
          var host = (GitHubHost)repository.host();
<span class="line-modified">!         var endpoint = &quot;/&quot; + repository.name() + &quot;/pull/&quot; + id();</span>
          return host.getWebURI(endpoint);
      }
  
      @Override
      public String toString() {
<span class="line-modified">!         return &quot;GitHubPullRequest #&quot; + id() + &quot; by &quot; + author();</span>
      }
  
      @Override
<span class="line-modified">!     public List&lt;HostUser&gt; assignees() {</span>
          return json.get(&quot;assignees&quot;).asArray()
                                      .stream()
                                      .map(host::parseUserObject)
                                      .collect(Collectors.toList());
      }
  
      @Override
<span class="line-modified">!     public void setAssignees(List&lt;HostUser&gt; assignees) {</span>
          var assignee_ids = JSON.array();
          for (var assignee : assignees) {
              assignee_ids.add(assignee.userName());
          }
          var param = JSON.object().put(&quot;assignees&quot;, assignee_ids);
</pre>
<center><a href="GitHubHost.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="GitHubRepository.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>