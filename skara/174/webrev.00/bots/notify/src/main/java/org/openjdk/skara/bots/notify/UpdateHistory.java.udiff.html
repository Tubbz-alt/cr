<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff bots/notify/src/main/java/org/openjdk/skara/bots/notify/UpdateHistory.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JNotifyBot.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/notify/UpdateHistoryTests.java.udiff.html" target="_top">next &gt;</a></center>    <h2>bots/notify/src/main/java/org/openjdk/skara/bots/notify/UpdateHistory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -42,15 +42,15 @@</span>
                        .map(line -&gt; line.split(&quot; &quot;))
                        .map(entry -&gt; new ResolvedBranch(new Branch(entry[0]), new Hash(entry[1])))
                        .collect(Collectors.toSet());
      }
  
<span class="udiff-line-modified-removed">-     private String serializeBranches(ResolvedBranch added, Set&lt;ResolvedBranch&gt; existing) {</span>
<span class="udiff-line-modified-added">+     private String serializeBranches(Collection&lt;ResolvedBranch&gt; added, Set&lt;ResolvedBranch&gt; existing) {</span>
          var updatedBranches = existing.stream()
<span class="udiff-line-modified-removed">-                 .collect(Collectors.toMap(ResolvedBranch::branch,</span>
<span class="udiff-line-modified-removed">-                                           ResolvedBranch::hash));</span>
<span class="udiff-line-modified-removed">-         updatedBranches.put(added.branch(), added.hash());</span>
<span class="udiff-line-modified-added">+                                       .collect(Collectors.toMap(ResolvedBranch::branch,</span>
<span class="udiff-line-modified-added">+                                                                 ResolvedBranch::hash));</span>
<span class="udiff-line-modified-added">+         added.forEach(a -&gt; updatedBranches.put(a.branch(), a.hash()));</span>
          return updatedBranches.entrySet().stream()
                                .map(entry -&gt; entry.getKey().toString() + &quot; &quot; + entry.getValue().toString())
                                .sorted()
                                .collect(Collectors.joining(&quot;\n&quot;));
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -59,13 +59,13 @@</span>
          return current.lines()
                        .map(Tag::new)
                        .collect(Collectors.toSet());
      }
  
<span class="udiff-line-modified-removed">-     private String serializeTags(Tag added, Set&lt;Tag&gt; existing) {</span>
<span class="udiff-line-modified-added">+     private String serializeTags(Collection&lt;Tag&gt; added, Set&lt;Tag&gt; existing) {</span>
          return Stream.concat(existing.stream(),
<span class="udiff-line-modified-removed">-                              Stream.of(added))</span>
<span class="udiff-line-modified-added">+                              added.stream())</span>
                       .map(Tag::toString)
                       .sorted()
                       .collect(Collectors.joining(&quot;\n&quot;));
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -95,16 +95,16 @@</span>
  
      static UpdateHistory create(StorageBuilder&lt;Tag&gt; tagStorageBuilder, Path tagLocation, StorageBuilder&lt;ResolvedBranch&gt; branchStorageBuilder, Path branchLocation) {
          return new UpdateHistory(tagStorageBuilder, tagLocation, branchStorageBuilder, branchLocation);
      }
  
<span class="udiff-line-modified-removed">-     void addTag(Tag tag) {</span>
<span class="udiff-line-modified-removed">-         tagStorage.put(tag);</span>
<span class="udiff-line-modified-added">+     void addTags(Collection&lt;Tag&gt; addedTags) {</span>
<span class="udiff-line-modified-added">+         tagStorage.put(addedTags);</span>
          var newTags = currentTags();
  
<span class="udiff-line-modified-removed">-         if (tags != null) {</span>
<span class="udiff-line-modified-removed">-             for (var existingTag : tags) {</span>
<span class="udiff-line-modified-added">+         if (addedTags != null) {</span>
<span class="udiff-line-modified-added">+             for (var existingTag : addedTags) {</span>
                  if (!newTags.contains(existingTag)) {
                      throw new RuntimeException(&quot;Tag &#39;&quot; + existingTag + &quot;&#39; has been removed&quot;);
                  }
              }
          }
</pre>
<center><a href="JNotifyBot.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/notify/UpdateHistoryTests.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>