<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../forge/src/main/java/org/openjdk/skara/forge/github/GitHubPullRequest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
356         }
357 
358         var userName = contributor != null ? contributor.username() : review.reviewer().userName() + &quot;@&quot; + censusInstance.namespace().name();
359         var userRole = contributor != null ? projectRole(contributor) : &quot;no OpenJDK username&quot;;
360         var replyBody = ArchiveMessages.reviewVerdictBody(review.body().orElse(&quot;&quot;), review.verdict(), userName, userRole);
361 
362         addReplyCommon(parent, review.reviewer(), subject, replyBody, id);
363     }
364 
365     void addReviewComment(ReviewComment reviewComment) {
366         var id = getMessageId(reviewComment);
367         if (existingIds.containsKey(getStableMessageId(id))) {
368             return;
369         }
370 
371         var parent = parentForReviewComment(reviewComment);
372         var body = new StringBuilder();
373 
374         // Add some context to the first post
375         if (reviewComment.parent().isEmpty()) {
<span class="line-removed">376             var contents = prInstance.pr().repository().fileContents(reviewComment.path(), reviewComment.hash().hex()).lines().collect(Collectors.toList());</span>
<span class="line-removed">377 </span>
378             body.append(reviewComment.path()).append(&quot; line &quot;).append(reviewComment.line()).append(&quot;:\n\n&quot;);
<span class="line-modified">379             for (int i = Math.max(0, reviewComment.line() - 2); i &lt; Math.min(contents.size(), reviewComment.line() + 1); ++i) {</span>
<span class="line-modified">380                 body.append(&quot;&gt; &quot;).append(i + 1).append(&quot;: &quot;).append(contents.get(i)).append(&quot;\n&quot;);</span>






381             }
<span class="line-removed">382             body.append(&quot;\n&quot;);</span>
383         }
384         body.append(reviewComment.body());
385 
386         addReplyCommon(parent, reviewComment.author(), parent.subject(), body.toString(), id);
387     }
388 
389     List&lt;Email&gt; generatedEmails() {
390         var finalEmails = new ArrayList&lt;Email&gt;();
391         for (var email : generated) {
392             for (var approvalId : approvalIds) {
393                 var collapsed = email.hasHeader(&quot;PR-Collapsed-IDs&quot;) ? email.headerValue(&quot;PR-Collapsed-IDs&quot;) + &quot; &quot; : &quot;&quot;;
394                 if (email.id().equals(approvalId) || collapsed.contains(getStableMessageId(approvalId))) {
395                     email = Email.reparent(topEmail(), email)
396                                  .subject(&quot;Re: [Approved] &quot; + &quot;RFR: &quot; + prInstance.pr().title())
397                                  .build();
398                     break;
399                 }
400             }
401             finalEmails.add(email);
402         }
</pre>
</td>
<td>
<hr />
<pre>
356         }
357 
358         var userName = contributor != null ? contributor.username() : review.reviewer().userName() + &quot;@&quot; + censusInstance.namespace().name();
359         var userRole = contributor != null ? projectRole(contributor) : &quot;no OpenJDK username&quot;;
360         var replyBody = ArchiveMessages.reviewVerdictBody(review.body().orElse(&quot;&quot;), review.verdict(), userName, userRole);
361 
362         addReplyCommon(parent, review.reviewer(), subject, replyBody, id);
363     }
364 
365     void addReviewComment(ReviewComment reviewComment) {
366         var id = getMessageId(reviewComment);
367         if (existingIds.containsKey(getStableMessageId(id))) {
368             return;
369         }
370 
371         var parent = parentForReviewComment(reviewComment);
372         var body = new StringBuilder();
373 
374         // Add some context to the first post
375         if (reviewComment.parent().isEmpty()) {


376             body.append(reviewComment.path()).append(&quot; line &quot;).append(reviewComment.line()).append(&quot;:\n\n&quot;);
<span class="line-modified">377             try {</span>
<span class="line-modified">378                 var contents = prInstance.pr().repository().fileContents(reviewComment.path(), reviewComment.hash().hex()).lines().collect(Collectors.toList());</span>
<span class="line-added">379                 for (int i = Math.max(0, reviewComment.line() - 2); i &lt; Math.min(contents.size(), reviewComment.line() + 1); ++i) {</span>
<span class="line-added">380                     body.append(&quot;&gt; &quot;).append(i + 1).append(&quot;: &quot;).append(contents.get(i)).append(&quot;\n&quot;);</span>
<span class="line-added">381                 }</span>
<span class="line-added">382                 body.append(&quot;\n&quot;);</span>
<span class="line-added">383             } catch (RuntimeException e) {</span>
<span class="line-added">384                 body.append(&quot;&gt; (failed to retrieve contents of file, check the PR for context)\n&quot;);</span>
385             }

386         }
387         body.append(reviewComment.body());
388 
389         addReplyCommon(parent, reviewComment.author(), parent.subject(), body.toString(), id);
390     }
391 
392     List&lt;Email&gt; generatedEmails() {
393         var finalEmails = new ArrayList&lt;Email&gt;();
394         for (var email : generated) {
395             for (var approvalId : approvalIds) {
396                 var collapsed = email.hasHeader(&quot;PR-Collapsed-IDs&quot;) ? email.headerValue(&quot;PR-Collapsed-IDs&quot;) + &quot; &quot; : &quot;&quot;;
397                 if (email.id().equals(approvalId) || collapsed.contains(getStableMessageId(approvalId))) {
398                     email = Email.reparent(topEmail(), email)
399                                  .subject(&quot;Re: [Approved] &quot; + &quot;RFR: &quot; + prInstance.pr().title())
400                                  .build();
401                     break;
402                 }
403             }
404             finalEmails.add(email);
405         }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../../forge/src/main/java/org/openjdk/skara/forge/github/GitHubPullRequest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>