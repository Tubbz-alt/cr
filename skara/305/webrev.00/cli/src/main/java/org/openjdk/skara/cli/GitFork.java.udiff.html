<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff cli/src/main/java/org/openjdk/skara/cli/GitFork.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>cli/src/main/java/org/openjdk/skara/cli/GitFork.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -55,10 +55,41 @@</span>
          } catch (InterruptedException e) {
              // do nothing
          }
      }
  
<span class="udiff-line-added">+     private static String getOption(String name, String subsection, Arguments arguments) {</span>
<span class="udiff-line-added">+         if (arguments.contains(name)) {</span>
<span class="udiff-line-added">+             return arguments.get(name).asString();</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (subsection != null &amp;&amp; !subsection.isEmpty()) {</span>
<span class="udiff-line-added">+             var subsectionSpecific = gitConfig(&quot;fork.&quot; + subsection + &quot;.&quot; + name);</span>
<span class="udiff-line-added">+             if (subsectionSpecific != null) {</span>
<span class="udiff-line-added">+                 return subsectionSpecific;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         return gitConfig(&quot;fork.&quot; + name);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private static boolean getSwitch(String name, String subsection, Arguments arguments) {</span>
<span class="udiff-line-added">+         if (arguments.contains(name)) {</span>
<span class="udiff-line-added">+             return true;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (subsection != null &amp;&amp; !subsection.isEmpty()) {</span>
<span class="udiff-line-added">+             var subsectionSpecific = gitConfig(&quot;fork.&quot; + subsection + &quot;.&quot; + name);</span>
<span class="udiff-line-added">+             if (subsectionSpecific != null) {</span>
<span class="udiff-line-added">+                 return subsectionSpecific.toLowerCase().equals(&quot;true&quot;);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         var sectionSpecific = gitConfig(&quot;fork.&quot; + name);</span>
<span class="udiff-line-added">+         return sectionSpecific != null &amp;&amp; sectionSpecific.toLowerCase().equals(&quot;true&quot;);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      private static String gitConfig(String key) {
          try {
              var pb = new ProcessBuilder(&quot;git&quot;, &quot;config&quot;, key);
              pb.redirectOutput(ProcessBuilder.Redirect.PIPE);
              pb.redirectError(ProcessBuilder.Redirect.DISCARD);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -68,11 +99,11 @@</span>
              var res = p.waitFor();
              if (res != 0) {
                  return null;
              }
  
<span class="udiff-line-modified-removed">-             return output.replace(&quot;\n&quot;, &quot;&quot;);</span>
<span class="udiff-line-modified-added">+             return output == null ? null : output.replace(&quot;\n&quot;, &quot;&quot;);</span>
          } catch (InterruptedException e) {
              return null;
          } catch (IOException e) {
              return null;
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -187,23 +218,15 @@</span>
              Logging.setup(level);
          }
  
          HttpProxy.setup();
  
<span class="udiff-line-modified-removed">-         boolean useSSH = arguments.contains(&quot;ssh&quot;);</span>
<span class="udiff-line-removed">-         if (!useSSH) {</span>
<span class="udiff-line-removed">-             var config = gitConfig(&quot;fork.ssh&quot;);</span>
<span class="udiff-line-removed">-             useSSH = config != null &amp;&amp; config.toLowerCase().equals(&quot;true&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         boolean useHTTPS = arguments.contains(&quot;https&quot;);</span>
<span class="udiff-line-removed">-         if (!useHTTPS) {</span>
<span class="udiff-line-removed">-             var config = gitConfig(&quot;fork.https&quot;);</span>
<span class="udiff-line-removed">-             useHTTPS = config != null &amp;&amp; config.toLowerCase().equals(&quot;true&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         var subsection = arguments.at(0).isPresent() ? arguments.at(0).asString() : null;</span>
  
<span class="udiff-line-modified-removed">-         var hostname = arguments.get(&quot;host&quot;).orString(() -&gt; gitConfig(&quot;fork.host&quot;));</span>
<span class="udiff-line-modified-added">+         boolean useSSH = getSwitch(&quot;ssh&quot;, subsection, arguments);</span>
<span class="udiff-line-added">+         boolean useHTTPS = getSwitch(&quot;https&quot;, subsection, arguments);</span>
<span class="udiff-line-added">+         var hostname = getOption(&quot;host&quot;, subsection, arguments);</span>
  
          URI uri = null;
          if (arguments.at(0).isPresent()) {
              var arg = arguments.at(0).asString();
              if (hostname != null) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -225,11 +248,11 @@</span>
              exit(&quot;error: not a valid URI: &quot; + uri);
          }
  
          var webURI = Remote.toWebURI(uri.toString());
          var token = isMercurial ? System.getenv(&quot;HG_TOKEN&quot;) : System.getenv(&quot;GIT_TOKEN&quot;);
<span class="udiff-line-modified-removed">-         var username = arguments.get(&quot;username&quot;).orString(() -&gt; gitConfig(&quot;fork.username&quot;));</span>
<span class="udiff-line-modified-added">+         var username = getOption(&quot;username&quot;, subsection, arguments);</span>
          var credentials = GitCredentials.fill(webURI.getHost(), webURI.getPath(), username, token, webURI.getScheme());
  
          if (credentials.password() == null) {
              exit(&quot;error: no personal access token found, use git-credentials or the environment variable GIT_TOKEN&quot;);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -254,25 +277,13 @@</span>
          var forkWebUrl = fork.webUrl();
          if (isMercurial) {
              forkWebUrl = URI.create(&quot;git+&quot; + forkWebUrl.toString());
          }
  
<span class="udiff-line-modified-removed">-         boolean noClone = arguments.contains(&quot;no-clone&quot;);</span>
<span class="udiff-line-modified-removed">-         if (!noClone) {</span>
<span class="udiff-line-modified-removed">-             var config = gitConfig(&quot;fork.no-clone&quot;);</span>
<span class="udiff-line-removed">-             noClone = config != null &amp;&amp; config.toLowerCase().equals(&quot;true&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         boolean noRemote = arguments.contains(&quot;no-remote&quot;);</span>
<span class="udiff-line-removed">-         if (!noRemote) {</span>
<span class="udiff-line-removed">-             var config = gitConfig(&quot;fork.no-remote&quot;);</span>
<span class="udiff-line-removed">-             noRemote = config != null &amp;&amp; config.toLowerCase().equals(&quot;true&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         boolean shouldSync = arguments.contains(&quot;sync&quot;);</span>
<span class="udiff-line-removed">-         if (!shouldSync) {</span>
<span class="udiff-line-removed">-             var config = gitConfig(&quot;fork.sync&quot;);</span>
<span class="udiff-line-removed">-             shouldSync = config != null &amp;&amp; config.toLowerCase().equals(&quot;true&quot;);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         boolean noClone = getSwitch(&quot;no-clone&quot;, subsection, arguments);</span>
<span class="udiff-line-modified-added">+         boolean noRemote = getSwitch(&quot;no-remote&quot;, subsection, arguments);</span>
<span class="udiff-line-modified-added">+         boolean shouldSync = getSwitch(&quot;sync&quot;, subsection, arguments);</span>
          if (noClone || !arguments.at(0).isPresent()) {
              if (!arguments.at(0).isPresent()) {
                  var cwd = Path.of(&quot;&quot;).toAbsolutePath();
                  var repo = Repository.get(cwd).orElseGet(die(&quot;error: no git repository found at &quot; + cwd));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -294,16 +305,16 @@</span>
                          GitSync.sync(repo, new String[]{&quot;--from&quot;, &quot;origin&quot;, &quot;--to&quot;, &quot;fork&quot;});
                      }
                  }
              }
          } else {
<span class="udiff-line-modified-removed">-             var reference = arguments.get(&quot;reference&quot;).orString(() -&gt; gitConfig(&quot;fork.reference&quot;));</span>
<span class="udiff-line-modified-added">+             var reference = getOption(&quot;reference&quot;, subsection, arguments);</span>
              if (reference != null &amp;&amp; reference.startsWith(&quot;~&quot; + File.separator)) {
                  reference = System.getProperty(&quot;user.home&quot;) + reference.substring(1);
              }
<span class="udiff-line-modified-removed">-             var depth = arguments.get(&quot;depth&quot;).orString(() -&gt; gitConfig(&quot;fork.depth&quot;));</span>
<span class="udiff-line-modified-removed">-             var shallowSince = arguments.get(&quot;shallow-since&quot;).orString(() -&gt; gitConfig(&quot;fork.shallow-since&quot;));</span>
<span class="udiff-line-modified-added">+             var depth = getOption(&quot;depth&quot;, subsection, arguments);</span>
<span class="udiff-line-modified-added">+             var shallowSince = getOption(&quot;shallow-since&quot;, subsection, arguments);</span>
  
              URI cloneURI = null;
              if (hostname != null) {
                  if (useSSH) {
                      cloneURI = URI.create(&quot;ssh://git@&quot; + forkWebUrl.getHost() + forkWebUrl.getPath() + &quot;.git&quot;);
</pre>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>