<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/main/java/org/openjdk/skara/vcs/hg/HgRepository.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../git/GitRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>vcs/src/main/java/org/openjdk/skara/vcs/hg/HgRepository.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
623     }
624 
625     @Override
626     public Optional&lt;byte[]&gt; show(Path path, Hash hash) throws IOException {
627         var output = Files.createTempFile(&quot;hg-cat-rev-&quot; + hash.abbreviate(), &quot;.bin&quot;);
628         try (var p = capture(&quot;hg&quot;, &quot;cat&quot;, &quot;--output=&quot; + output, &quot;--rev=&quot; + hash.hex(), path.toString())) {
629             var res = p.await();
630             if (res.status() == 0 &amp;&amp; Files.exists(output)) {
631                 var bytes = Files.readAllBytes(output);
632                 Files.delete(output);
633                 return Optional.of(bytes);
634             }
635 
636             if (Files.exists(output)) {
637                 Files.delete(output);
638             }
639             return Optional.empty();
640         }
641     }
642 







643     @Override
644     public Diff diff(Hash from) throws IOException {
645         return diff(from, null);
646     }
647 
648     @Override
649     public Diff diff(Hash from, Hash to) throws IOException {
650         var ext = Files.createTempFile(&quot;ext&quot;, &quot;.py&quot;);
651         copyResource(EXT_PY, ext);
652 
653         var cmd = new ArrayList&lt;&gt;(List.of(&quot;hg&quot;, &quot;--config&quot;, &quot;extensions.diff-git-raw=&quot; + ext.toAbsolutePath(),
654                                                 &quot;diff-git-raw&quot;, from.hex()));
655         if (to != null) {
656             cmd.add(to.hex());
657         }
658 
659         var p = start(cmd);
660         try {
661             var patches = UnifiedDiffParser.parseGitRaw(p.getInputStream());
662             await(p);
</pre>
</td>
<td>
<hr />
<pre>
623     }
624 
625     @Override
626     public Optional&lt;byte[]&gt; show(Path path, Hash hash) throws IOException {
627         var output = Files.createTempFile(&quot;hg-cat-rev-&quot; + hash.abbreviate(), &quot;.bin&quot;);
628         try (var p = capture(&quot;hg&quot;, &quot;cat&quot;, &quot;--output=&quot; + output, &quot;--rev=&quot; + hash.hex(), path.toString())) {
629             var res = p.await();
630             if (res.status() == 0 &amp;&amp; Files.exists(output)) {
631                 var bytes = Files.readAllBytes(output);
632                 Files.delete(output);
633                 return Optional.of(bytes);
634             }
635 
636             if (Files.exists(output)) {
637                 Files.delete(output);
638             }
639             return Optional.empty();
640         }
641     }
642 
<span class="line-added">643     @Override</span>
<span class="line-added">644     public void revert(Hash parent) throws IOException {</span>
<span class="line-added">645         try (var p = capture(&quot;hg&quot;, &quot;revert&quot;, &quot;--no-backup&quot;, &quot;--all&quot;, &quot;--rev&quot;, parent.hex())) {</span>
<span class="line-added">646             await(p);</span>
<span class="line-added">647         }</span>
<span class="line-added">648     }</span>
<span class="line-added">649 </span>
650     @Override
651     public Diff diff(Hash from) throws IOException {
652         return diff(from, null);
653     }
654 
655     @Override
656     public Diff diff(Hash from, Hash to) throws IOException {
657         var ext = Files.createTempFile(&quot;ext&quot;, &quot;.py&quot;);
658         copyResource(EXT_PY, ext);
659 
660         var cmd = new ArrayList&lt;&gt;(List.of(&quot;hg&quot;, &quot;--config&quot;, &quot;extensions.diff-git-raw=&quot; + ext.toAbsolutePath(),
661                                                 &quot;diff-git-raw&quot;, from.hex()));
662         if (to != null) {
663             cmd.add(to.hex());
664         }
665 
666         var p = start(cmd);
667         try {
668             var patches = UnifiedDiffParser.parseGitRaw(p.getInputStream());
669             await(p);
</pre>
</td>
</tr>
</table>
<center><a href="../git/GitRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>