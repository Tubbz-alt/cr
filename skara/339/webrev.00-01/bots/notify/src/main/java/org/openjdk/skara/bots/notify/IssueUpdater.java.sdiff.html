<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/notify/src/main/java/org/openjdk/skara/bots/notify/IssueUpdater.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="RepositoryWorkItem.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/notify/src/main/java/org/openjdk/skara/bots/notify/IssueUpdater.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 52         this.commitLink = commitLink;
 53         this.commitIcon = commitIcon;
 54         this.setFixVersion = setFixVersion;
 55         this.fixVersion = fixVersion;
 56     }
 57 
 58     @Override
 59     public void handleCommits(HostedRepository repository, Repository localRepository, List&lt;Commit&gt; commits, Branch branch) {
 60         for (var commit : commits) {
 61             var commitNotification = CommitFormatters.toTextBrief(repository, commit);
 62             var commitMessage = CommitMessageParsers.v1.parse(commit);
 63             for (var commitIssue : commitMessage.issues()) {
 64                 var optionalIssue = issueProject.issue(commitIssue.id());
 65                 if (optionalIssue.isEmpty()) {
 66                     log.severe(&quot;Cannot update issue &quot; + commitIssue.id() + &quot; with commit &quot; + commit.hash().abbreviate()
 67                                        + &quot; - issue not found in issue project&quot;);
 68                     continue;
 69                 }
 70                 var issue = optionalIssue.get();
 71                 var existingComments = issue.comments();

 72                 var alreadyPostedComment = existingComments.stream()
 73                                                            .filter(comment -&gt; comment.author().equals(issueProject.issueTracker().currentUser()))
<span class="line-modified"> 74                                                            .anyMatch(comment -&gt; comment.body().contains(commit.hash().abbreviate()));</span>
 75                 if (!alreadyPostedComment) {
 76                     issue.addComment(commitNotification);
 77                 }
 78                 issue.setState(Issue.State.RESOLVED);
 79 
 80                 if (commitLink) {
 81                     var linkBuilder = Link.create(repository.webUrl(commit.hash()), &quot;Commit&quot;)
 82                                           .summary(repository.name() + &quot;/&quot; + commit.hash().abbreviate());
 83                     if (commitIcon != null) {
 84                         linkBuilder.iconTitle(&quot;Commit&quot;);
 85                         linkBuilder.iconUrl(commitIcon);
 86                     }
 87                     issue.addLink(linkBuilder.build());
 88                 }
 89 
 90                 if (setFixVersion) {
 91                     var requestedVersion = fixVersion;
 92                     if (requestedVersion == null) {
 93                         try {
 94                             var conf = localRepository.lines(Path.of(&quot;.jcheck/conf&quot;), commit.hash());
</pre>
</td>
<td>
<hr />
<pre>
 52         this.commitLink = commitLink;
 53         this.commitIcon = commitIcon;
 54         this.setFixVersion = setFixVersion;
 55         this.fixVersion = fixVersion;
 56     }
 57 
 58     @Override
 59     public void handleCommits(HostedRepository repository, Repository localRepository, List&lt;Commit&gt; commits, Branch branch) {
 60         for (var commit : commits) {
 61             var commitNotification = CommitFormatters.toTextBrief(repository, commit);
 62             var commitMessage = CommitMessageParsers.v1.parse(commit);
 63             for (var commitIssue : commitMessage.issues()) {
 64                 var optionalIssue = issueProject.issue(commitIssue.id());
 65                 if (optionalIssue.isEmpty()) {
 66                     log.severe(&quot;Cannot update issue &quot; + commitIssue.id() + &quot; with commit &quot; + commit.hash().abbreviate()
 67                                        + &quot; - issue not found in issue project&quot;);
 68                     continue;
 69                 }
 70                 var issue = optionalIssue.get();
 71                 var existingComments = issue.comments();
<span class="line-added"> 72                 var hashUrl = repository.webUrl(commit.hash()).toString();</span>
 73                 var alreadyPostedComment = existingComments.stream()
 74                                                            .filter(comment -&gt; comment.author().equals(issueProject.issueTracker().currentUser()))
<span class="line-modified"> 75                                                            .anyMatch(comment -&gt; comment.body().contains(hashUrl));</span>
 76                 if (!alreadyPostedComment) {
 77                     issue.addComment(commitNotification);
 78                 }
 79                 issue.setState(Issue.State.RESOLVED);
 80 
 81                 if (commitLink) {
 82                     var linkBuilder = Link.create(repository.webUrl(commit.hash()), &quot;Commit&quot;)
 83                                           .summary(repository.name() + &quot;/&quot; + commit.hash().abbreviate());
 84                     if (commitIcon != null) {
 85                         linkBuilder.iconTitle(&quot;Commit&quot;);
 86                         linkBuilder.iconUrl(commitIcon);
 87                     }
 88                     issue.addLink(linkBuilder.build());
 89                 }
 90 
 91                 if (setFixVersion) {
 92                     var requestedVersion = fixVersion;
 93                     if (requestedVersion == null) {
 94                         try {
 95                             var conf = localRepository.lines(Path.of(&quot;.jcheck/conf&quot;), commit.hash());
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="RepositoryWorkItem.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>