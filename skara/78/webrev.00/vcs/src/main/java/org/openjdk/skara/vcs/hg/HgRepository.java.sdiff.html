<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/main/java/org/openjdk/skara/vcs/hg/HgRepository.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../git/GitRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>vcs/src/main/java/org/openjdk/skara/vcs/hg/HgRepository.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
638             }
639             return Optional.empty();
640         }
641     }
642 
643     @Override
644     public List&lt;FileEntry&gt; files(Hash hash, List&lt;Path&gt; paths) throws IOException {
645         var ext = Files.createTempFile(&quot;ext&quot;, &quot;.py&quot;);
646         copyResource(EXT_PY, ext);
647 
648         var include = new HashSet&lt;&gt;(paths);
649 
650         try (var p = capture(&quot;hg&quot;, &quot;--config&quot;, &quot;extensions.ls-tree=&quot; + ext, &quot;ls-tree&quot;, hash.hex())) {
651             var res = await(p);
652             var entries = new ArrayList&lt;FileEntry&gt;();
653             for (var line : res.stdout()) {
654                 var parts = line.split(&quot;\t&quot;);
655                 var metadata = parts[0].split(&quot; &quot;);
656                 var path = Path.of(parts[1]);
657                 if (include.isEmpty() || include.contains(path)) {
<span class="line-modified">658                     var entry = new FileEntry(FileType.fromOctal(metadata[0]),</span>

659                                               new Hash(metadata[2]),
660                                               path);
661                     entries.add(entry);
662                 }
663             }
664             return entries;
665         }
666     }
667 











668     @Override
669     public void revert(Hash parent) throws IOException {
670         try (var p = capture(&quot;hg&quot;, &quot;revert&quot;, &quot;--no-backup&quot;, &quot;--all&quot;, &quot;--rev&quot;, parent.hex())) {
671             await(p);
672         }
673     }
674 
675     @Override
676     public Diff diff(Hash from) throws IOException {
677         return diff(from, null);
678     }
679 
680     @Override
681     public Diff diff(Hash from, Hash to) throws IOException {
682         var ext = Files.createTempFile(&quot;ext&quot;, &quot;.py&quot;);
683         copyResource(EXT_PY, ext);
684 
685         var cmd = new ArrayList&lt;&gt;(List.of(&quot;hg&quot;, &quot;--config&quot;, &quot;extensions.diff-git-raw=&quot; + ext.toAbsolutePath(),
686                                                 &quot;diff-git-raw&quot;, from.hex()));
687         if (to != null) {
</pre>
</td>
<td>
<hr />
<pre>
638             }
639             return Optional.empty();
640         }
641     }
642 
643     @Override
644     public List&lt;FileEntry&gt; files(Hash hash, List&lt;Path&gt; paths) throws IOException {
645         var ext = Files.createTempFile(&quot;ext&quot;, &quot;.py&quot;);
646         copyResource(EXT_PY, ext);
647 
648         var include = new HashSet&lt;&gt;(paths);
649 
650         try (var p = capture(&quot;hg&quot;, &quot;--config&quot;, &quot;extensions.ls-tree=&quot; + ext, &quot;ls-tree&quot;, hash.hex())) {
651             var res = await(p);
652             var entries = new ArrayList&lt;FileEntry&gt;();
653             for (var line : res.stdout()) {
654                 var parts = line.split(&quot;\t&quot;);
655                 var metadata = parts[0].split(&quot; &quot;);
656                 var path = Path.of(parts[1]);
657                 if (include.isEmpty() || include.contains(path)) {
<span class="line-modified">658                     var entry = new FileEntry(hash,</span>
<span class="line-added">659                                               FileType.fromOctal(metadata[0]),</span>
660                                               new Hash(metadata[2]),
661                                               path);
662                     entries.add(entry);
663                 }
664             }
665             return entries;
666         }
667     }
668 
<span class="line-added">669     @Override</span>
<span class="line-added">670     public boolean dump(FileEntry entry, Path to) throws IOException {</span>
<span class="line-added">671         var output = to.toAbsolutePath();</span>
<span class="line-added">672         try (var p = capture(&quot;hg&quot;, &quot;cat&quot;, &quot;--output=&quot; + output.toString(),</span>
<span class="line-added">673                                           &quot;--rev=&quot; + entry.commit(),</span>
<span class="line-added">674                                           entry.path().toString())) {</span>
<span class="line-added">675             var res = await(p);</span>
<span class="line-added">676             return Files.exists(output);</span>
<span class="line-added">677         }</span>
<span class="line-added">678     }</span>
<span class="line-added">679 </span>
680     @Override
681     public void revert(Hash parent) throws IOException {
682         try (var p = capture(&quot;hg&quot;, &quot;revert&quot;, &quot;--no-backup&quot;, &quot;--all&quot;, &quot;--rev&quot;, parent.hex())) {
683             await(p);
684         }
685     }
686 
687     @Override
688     public Diff diff(Hash from) throws IOException {
689         return diff(from, null);
690     }
691 
692     @Override
693     public Diff diff(Hash from, Hash to) throws IOException {
694         var ext = Files.createTempFile(&quot;ext&quot;, &quot;.py&quot;);
695         copyResource(EXT_PY, ext);
696 
697         var cmd = new ArrayList&lt;&gt;(List.of(&quot;hg&quot;, &quot;--config&quot;, &quot;extensions.diff-git-raw=&quot; + ext.toAbsolutePath(),
698                                                 &quot;diff-git-raw&quot;, from.hex()));
699         if (to != null) {
</pre>
</td>
</tr>
</table>
<center><a href="../git/GitRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>