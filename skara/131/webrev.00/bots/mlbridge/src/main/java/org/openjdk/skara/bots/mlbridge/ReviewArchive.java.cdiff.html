<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 181,25 ***</span>
                           .build();
          generated.add(email);
          generatedIds.put(getStableMessageId(id), email);
      }
  
<span class="line-modified">!     private String latestHeadSubject() {</span>
          try {
              var latestCommit = prInstance.localRepo().lookup(prInstance.headHash()).orElseThrow(RuntimeException::new);
<span class="line-modified">!             var firstLine = latestCommit.message().size() &gt; 0 ? latestCommit.message().get(0) : prInstance.pr().getTitle();</span>
<span class="line-removed">-             return String.format(&quot;Re: %02d: %s&quot;, revisionCount(), firstLine);</span>
          } catch (IOException e) {
              throw new UncheckedIOException(e);
          }
      }
  
      void addFull(URI webrev) {
          var body = ArchiveMessages.composeRebaseComment(prInstance, webrev);
          var id = getMessageId(prInstance.headHash());
          var parent = topEmail();
<span class="line-modified">!         var email = Email.reply(parent, latestHeadSubject(), body)</span>
                           .sender(sender)
                           .author(getAuthorAddress(prInstance.pr().getAuthor()))
                           .recipient(parent.author())
                           .id(id)
                           .header(&quot;PR-Head-Hash&quot;, prInstance.headHash().hex())
<span class="line-new-header">--- 181,24 ---</span>
                           .build();
          generated.add(email);
          generatedIds.put(getStableMessageId(id), email);
      }
  
<span class="line-modified">!     private String latestHeadPrefix() {</span>
          try {
              var latestCommit = prInstance.localRepo().lookup(prInstance.headHash()).orElseThrow(RuntimeException::new);
<span class="line-modified">!             return String.format(&quot;[Rev %02d]&quot;, revisionCount());</span>
          } catch (IOException e) {
              throw new UncheckedIOException(e);
          }
      }
  
      void addFull(URI webrev) {
          var body = ArchiveMessages.composeRebaseComment(prInstance, webrev);
          var id = getMessageId(prInstance.headHash());
          var parent = topEmail();
<span class="line-modified">!         var email = Email.reply(parent, &quot;Re: &quot; + latestHeadPrefix() + &quot;: RFR: &quot; + prInstance.pr().getTitle(), body)</span>
                           .sender(sender)
                           .author(getAuthorAddress(prInstance.pr().getAuthor()))
                           .recipient(parent.author())
                           .id(id)
                           .header(&quot;PR-Head-Hash&quot;, prInstance.headHash().hex())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 212,11 ***</span>
  
      void addIncremental(URI fullWebrev, URI incrementalWebrev) {
          var body = ArchiveMessages.composeIncrementalComment(latestHead(), prInstance, fullWebrev, incrementalWebrev);
          var id = getMessageId(prInstance.headHash());
          var parent = topEmail();
<span class="line-modified">!         var email = Email.reply(parent, latestHeadSubject(), body)</span>
                           .sender(sender)
                           .author(getAuthorAddress(prInstance.pr().getAuthor()))
                           .recipient(parent.author())
                           .id(id)
                           .header(&quot;PR-Head-Hash&quot;, prInstance.headHash().hex())
<span class="line-new-header">--- 211,11 ---</span>
  
      void addIncremental(URI fullWebrev, URI incrementalWebrev) {
          var body = ArchiveMessages.composeIncrementalComment(latestHead(), prInstance, fullWebrev, incrementalWebrev);
          var id = getMessageId(prInstance.headHash());
          var parent = topEmail();
<span class="line-modified">!         var email = Email.reply(parent, &quot;Re: &quot; + latestHeadPrefix() + &quot;: RFR: &quot; + prInstance.pr().getTitle(), body)</span>
                           .sender(sender)
                           .author(getAuthorAddress(prInstance.pr().getAuthor()))
                           .recipient(parent.author())
                           .id(id)
                           .header(&quot;PR-Head-Hash&quot;, prInstance.headHash().hex())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 337,11 ***</span>
          var subject = parent.subject();
  
          // Approvals by Reviewers get special treatment - post these as top-level comments
          if (review.verdict() == Review.Verdict.APPROVED &amp;&amp; isReviewer) {
              parent = topEmail();
<span class="line-modified">!             subject = &quot;Approved and Reviewed by &quot; + contributor.username();</span>
          }
  
          var userName = contributor != null ? contributor.username() : review.reviewer().userName() + &quot;@&quot; + censusInstance.namespace().name();
          var userRole = contributor != null ? projectRole(contributor) : &quot;none&quot;;
          var replyBody = ArchiveMessages.reviewCommentBody(review.body().orElse(&quot;&quot;), review.verdict(), userName, userRole);
<span class="line-new-header">--- 336,11 ---</span>
          var subject = parent.subject();
  
          // Approvals by Reviewers get special treatment - post these as top-level comments
          if (review.verdict() == Review.Verdict.APPROVED &amp;&amp; isReviewer) {
              parent = topEmail();
<span class="line-modified">!             subject = &quot;Re: [Approved]: &quot; + &quot;RFR: &quot; + prInstance.pr().getTitle();</span>
          }
  
          var userName = contributor != null ? contributor.username() : review.reviewer().userName() + &quot;@&quot; + censusInstance.namespace().name();
          var userRole = contributor != null ? projectRole(contributor) : &quot;none&quot;;
          var replyBody = ArchiveMessages.reviewCommentBody(review.body().orElse(&quot;&quot;), review.verdict(), userName, userRole);
</pre>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>