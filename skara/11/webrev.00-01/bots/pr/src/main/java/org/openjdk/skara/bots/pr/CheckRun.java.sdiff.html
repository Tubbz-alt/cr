<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/pr/src/main/java/org/openjdk/skara/bots/pr/CheckRun.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../mlbridge/src/test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ReviewTracker.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/pr/src/main/java/org/openjdk/skara/bots/pr/CheckRun.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
301                 return &quot;changes are approved&quot;;
302             case DISAPPROVED:
303                 return &quot;more changes needed&quot;;
304             case NONE:
305                 return &quot;comment added&quot;;
306             default:
307                 throw new RuntimeException(&quot;Unknown verdict: &quot; + verdict);
308         }
309     }
310 
311     private void updateReviewedMessages(List&lt;Comment&gt; comments, List&lt;Review&gt; reviews) {
312         var reviewTracker = new ReviewTracker(comments, reviews);
313 
314         for (var added : reviewTracker.newReviews().entrySet()) {
315             var body = added.getValue() + &quot;\n&quot; +
316                     &quot;This PR has been reviewed by &quot; +
317                     formatReviewer(added.getKey().reviewer()) + &quot; - &quot; +
318                     verdictToString(added.getKey().verdict()) + &quot;.&quot;;
319             pr.addComment(body);
320         }
<span class="line-removed">321 </span>
<span class="line-removed">322         for (var updated : reviewTracker.updatedReviews().entrySet()) {</span>
<span class="line-removed">323             var body = updated.getValue() + &quot;\n&quot; +</span>
<span class="line-removed">324                     &quot;The PR review by &quot; + formatReviewer(updated.getKey().reviewer()) +</span>
<span class="line-removed">325                     &quot; has been updated - &quot; + verdictToString(updated.getKey().verdict()) + &quot;.&quot;;</span>
<span class="line-removed">326             pr.addComment(body);</span>
<span class="line-removed">327         }</span>
<span class="line-removed">328 </span>
<span class="line-removed">329         for (var removed : reviewTracker.removedReviews().entrySet()) {</span>
<span class="line-removed">330             var user = pr.repository().host().getUserDetails(removed.getKey());</span>
<span class="line-removed">331             var body = removed.getValue() + &quot;\n&quot; +</span>
<span class="line-removed">332                     &quot;This PR is no longer reviewed by &quot; +</span>
<span class="line-removed">333                     formatReviewer(user) + &quot;.&quot;;</span>
<span class="line-removed">334             pr.addComment(body);</span>
<span class="line-removed">335         }</span>
336     }
337 
338     private Optional&lt;Comment&gt; findComment(List&lt;Comment&gt; comments, String marker) {
339         var self = pr.repository().host().getCurrentUserDetails();
340         return comments.stream()
341                        .filter(comment -&gt; comment.author().equals(self))
342                        .filter(comment -&gt; comment.body().contains(marker))
343                        .findAny();
344     }
345 
346     private String getMergeReadyComment(String commitMessage, List&lt;Review&gt; reviews, boolean rebasePossible) {
347         var message = new StringBuilder();
348         message.append(&quot;@&quot;);
349         message.append(pr.getAuthor().userName());
350         message.append(&quot; This change can now be integrated. The commit message will be:\n&quot;);
351         message.append(&quot;```\n&quot;);
352         message.append(commitMessage);
353         message.append(&quot;\n```\n&quot;);
354 
355         message.append(&quot;- If you would like to add a summary, use the `/summary` command.\n&quot;);
</pre>
</td>
<td>
<hr />
<pre>
301                 return &quot;changes are approved&quot;;
302             case DISAPPROVED:
303                 return &quot;more changes needed&quot;;
304             case NONE:
305                 return &quot;comment added&quot;;
306             default:
307                 throw new RuntimeException(&quot;Unknown verdict: &quot; + verdict);
308         }
309     }
310 
311     private void updateReviewedMessages(List&lt;Comment&gt; comments, List&lt;Review&gt; reviews) {
312         var reviewTracker = new ReviewTracker(comments, reviews);
313 
314         for (var added : reviewTracker.newReviews().entrySet()) {
315             var body = added.getValue() + &quot;\n&quot; +
316                     &quot;This PR has been reviewed by &quot; +
317                     formatReviewer(added.getKey().reviewer()) + &quot; - &quot; +
318                     verdictToString(added.getKey().verdict()) + &quot;.&quot;;
319             pr.addComment(body);
320         }















321     }
322 
323     private Optional&lt;Comment&gt; findComment(List&lt;Comment&gt; comments, String marker) {
324         var self = pr.repository().host().getCurrentUserDetails();
325         return comments.stream()
326                        .filter(comment -&gt; comment.author().equals(self))
327                        .filter(comment -&gt; comment.body().contains(marker))
328                        .findAny();
329     }
330 
331     private String getMergeReadyComment(String commitMessage, List&lt;Review&gt; reviews, boolean rebasePossible) {
332         var message = new StringBuilder();
333         message.append(&quot;@&quot;);
334         message.append(pr.getAuthor().userName());
335         message.append(&quot; This change can now be integrated. The commit message will be:\n&quot;);
336         message.append(&quot;```\n&quot;);
337         message.append(commitMessage);
338         message.append(&quot;\n```\n&quot;);
339 
340         message.append(&quot;- If you would like to add a summary, use the `/summary` command.\n&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../../mlbridge/src/test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="ReviewTracker.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>