<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/mlbridge/src/test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../pr/src/main/java/org/openjdk/skara/bots/pr/CheckRun.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
748             // Make a change with a corresponding PR
749             var editHash = CheckableRepository.appendAndCommit(localRepo);
750             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);
751             var pr = credentials.createPullRequest(archive, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
752             pr.addLabel(&quot;rfr&quot;);
753             pr.setBody(&quot;This is now ready&quot;);
754 
755             // Run an archive pass
756             TestBotRunner.runPeriodicItems(mlBot);
757 
758             // First unapprove it
759             var reviewedPr = credentials.getHostedRepository().getPullRequest(pr.getId());
760             reviewedPr.addReview(Review.Verdict.DISAPPROVED, &quot;Reason 1&quot;);
761             TestBotRunner.runPeriodicItems(mlBot);
762             TestBotRunner.runPeriodicItems(mlBot);
763             TestBotRunner.runPeriodicItems(mlBot);
764 
765             // The archive should contain a note
766             Repository.materialize(archiveFolder.path(), archive.getUrl(), &quot;master&quot;);
767             assertEquals(1, archiveContainsCount(archiveFolder.path(), &quot;This PR has been reviewed.*more changes are needed&quot;));
<span class="line-removed">768             assertEquals(1, archiveContainsCount(archiveFolder.path(), &quot;Reason 1&quot;));</span>
769 
770             // Then approve it
771             reviewedPr.addReview(Review.Verdict.APPROVED, &quot;Reason 2&quot;);
772             TestBotRunner.runPeriodicItems(mlBot);
773             TestBotRunner.runPeriodicItems(mlBot);
774             TestBotRunner.runPeriodicItems(mlBot);
775 
776             // The archive should contain another note
777             Repository.materialize(archiveFolder.path(), archive.getUrl(), &quot;master&quot;);
778             assertEquals(1, archiveContainsCount(archiveFolder.path(), &quot;This PR.*approved&quot;));
<span class="line-removed">779             assertEquals(1, archiveContainsCount(archiveFolder.path(), &quot;Reason 2&quot;));</span>
780 
781             // Yet another change
782             reviewedPr.addReview(Review.Verdict.DISAPPROVED, &quot;Reason 3&quot;);
783             TestBotRunner.runPeriodicItems(mlBot);
784             TestBotRunner.runPeriodicItems(mlBot);
785             TestBotRunner.runPeriodicItems(mlBot);
786 
787             // The archive should contain another note
788             Repository.materialize(archiveFolder.path(), archive.getUrl(), &quot;master&quot;);
789             assertEquals(2, archiveContainsCount(archiveFolder.path(), &quot;This PR.*more changes&quot;));
<span class="line-removed">790             assertEquals(1, archiveContainsCount(archiveFolder.path(), &quot;Reason 3&quot;));</span>
791         }
792     }
793 }
</pre>
</td>
<td>
<hr />
<pre>
748             // Make a change with a corresponding PR
749             var editHash = CheckableRepository.appendAndCommit(localRepo);
750             localRepo.push(editHash, author.getUrl(), &quot;edit&quot;, true);
751             var pr = credentials.createPullRequest(archive, &quot;master&quot;, &quot;edit&quot;, &quot;This is a pull request&quot;);
752             pr.addLabel(&quot;rfr&quot;);
753             pr.setBody(&quot;This is now ready&quot;);
754 
755             // Run an archive pass
756             TestBotRunner.runPeriodicItems(mlBot);
757 
758             // First unapprove it
759             var reviewedPr = credentials.getHostedRepository().getPullRequest(pr.getId());
760             reviewedPr.addReview(Review.Verdict.DISAPPROVED, &quot;Reason 1&quot;);
761             TestBotRunner.runPeriodicItems(mlBot);
762             TestBotRunner.runPeriodicItems(mlBot);
763             TestBotRunner.runPeriodicItems(mlBot);
764 
765             // The archive should contain a note
766             Repository.materialize(archiveFolder.path(), archive.getUrl(), &quot;master&quot;);
767             assertEquals(1, archiveContainsCount(archiveFolder.path(), &quot;This PR has been reviewed.*more changes are needed&quot;));

768 
769             // Then approve it
770             reviewedPr.addReview(Review.Verdict.APPROVED, &quot;Reason 2&quot;);
771             TestBotRunner.runPeriodicItems(mlBot);
772             TestBotRunner.runPeriodicItems(mlBot);
773             TestBotRunner.runPeriodicItems(mlBot);
774 
775             // The archive should contain another note
776             Repository.materialize(archiveFolder.path(), archive.getUrl(), &quot;master&quot;);
777             assertEquals(1, archiveContainsCount(archiveFolder.path(), &quot;This PR.*approved&quot;));

778 
779             // Yet another change
780             reviewedPr.addReview(Review.Verdict.DISAPPROVED, &quot;Reason 3&quot;);
781             TestBotRunner.runPeriodicItems(mlBot);
782             TestBotRunner.runPeriodicItems(mlBot);
783             TestBotRunner.runPeriodicItems(mlBot);
784 
785             // The archive should contain another note
786             Repository.materialize(archiveFolder.path(), archive.getUrl(), &quot;master&quot;);
787             assertEquals(2, archiveContainsCount(archiveFolder.path(), &quot;This PR.*more changes&quot;));

788         }
789     }
790 }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../pr/src/main/java/org/openjdk/skara/bots/pr/CheckRun.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>