<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff forge/src/main/java/org/openjdk/skara/forge/github/GitHubPullRequest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>forge/src/main/java/org/openjdk/skara/forge/github/GitHubPullRequest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 26 import org.openjdk.skara.host.HostUser;
 27 import org.openjdk.skara.issuetracker.*;
 28 import org.openjdk.skara.json.*;
 29 import org.openjdk.skara.network.*;
 30 import org.openjdk.skara.vcs.Hash;
 31 
 32 import java.net.URI;
 33 import java.time.*;
 34 import java.time.format.DateTimeFormatter;
 35 import java.util.*;
 36 import java.util.logging.Logger;
 37 import java.util.stream.Collectors;
 38 
 39 public class GitHubPullRequest implements PullRequest {
 40     private final JSONValue json;
 41     private final RestRequest request;
 42     private final GitHubHost host;
 43     private final GitHubRepository repository;
 44     private final Logger log = Logger.getLogger(&quot;org.openjdk.skara.host&quot;);
 45 


 46     GitHubPullRequest(GitHubRepository repository, JSONValue jsonValue, RestRequest request) {
 47         this.host = (GitHubHost)repository.forge();
 48         this.repository = repository;
 49         this.request = request;
 50         this.json = jsonValue;






 51     }
 52 
 53     @Override
 54     public HostedRepository repository() {
 55         return repository;
 56     }
 57 
 58     @Override
 59     public IssueProject project() {
 60         return null;
 61     }
 62 
 63     @Override
 64     public String id() {
 65         return json.get(&quot;number&quot;).toString();
 66     }
 67 
 68     @Override
 69     public HostUser author() {
 70         return host.parseUserField(json);
</pre>
<hr />
<pre>
410 
411     @Override
412     public URI changeUrl(Hash base) {
413         return URIBuilder.base(webUrl()).appendPath(&quot;/files/&quot; + base.abbreviate() + &quot;..&quot; + headHash().abbreviate()).build();
414     }
415 
416     @Override
417     public boolean isDraft() {
418         return json.get(&quot;draft&quot;).asBoolean();
419     }
420 
421     @Override
422     public void setState(State state) {
423         request.patch(&quot;pulls/&quot; + json.get(&quot;number&quot;).toString())
424                .body(&quot;state&quot;, state != State.OPEN ? &quot;closed&quot; : &quot;open&quot;)
425                .execute();
426     }
427 
428     @Override
429     public void addLabel(String label) {

430         var query = JSON.object().put(&quot;labels&quot;, JSON.array().add(label));
431         request.post(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels&quot;)
432                .body(query)
433                .execute();
434     }
435 
436     @Override
437     public void removeLabel(String label) {

438         request.delete(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels/&quot; + label)
439                .onError(r -&gt; {
440                    // The GitHub API explicitly states that 404 is the response for deleting labels currently not set
441                    if (r.statusCode() == 404) {
442                        return JSONValue.fromNull();
443                    }
444                    throw new RuntimeException(&quot;Invalid response&quot;);
445                })
446                .execute();
447     }
448 
449     @Override
450     public List&lt;String&gt; labels() {
<span class="line-modified">451         return request.get(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels&quot;).execute().stream()</span>
<span class="line-modified">452                       .map(JSONValue::asObject)</span>
<span class="line-modified">453                       .map(obj -&gt; obj.get(&quot;name&quot;).asString())</span>
<span class="line-modified">454                       .sorted()</span>
<span class="line-modified">455                       .collect(Collectors.toList());</span>



456     }
457 
458     @Override
459     public URI webUrl() {
460         var host = (GitHubHost)repository.forge();
461         var endpoint = &quot;/&quot; + repository.name() + &quot;/pull/&quot; + id();
462         return host.getWebURI(endpoint);
463     }
464 
465     @Override
466     public String toString() {
467         return &quot;GitHubPullRequest #&quot; + id() + &quot; by &quot; + author();
468     }
469 
470     @Override
471     public List&lt;HostUser&gt; assignees() {
472         return json.get(&quot;assignees&quot;).asArray()
473                                     .stream()
474                                     .map(host::parseUserObject)
475                                     .collect(Collectors.toList());
</pre>
</td>
<td>
<hr />
<pre>
 26 import org.openjdk.skara.host.HostUser;
 27 import org.openjdk.skara.issuetracker.*;
 28 import org.openjdk.skara.json.*;
 29 import org.openjdk.skara.network.*;
 30 import org.openjdk.skara.vcs.Hash;
 31 
 32 import java.net.URI;
 33 import java.time.*;
 34 import java.time.format.DateTimeFormatter;
 35 import java.util.*;
 36 import java.util.logging.Logger;
 37 import java.util.stream.Collectors;
 38 
 39 public class GitHubPullRequest implements PullRequest {
 40     private final JSONValue json;
 41     private final RestRequest request;
 42     private final GitHubHost host;
 43     private final GitHubRepository repository;
 44     private final Logger log = Logger.getLogger(&quot;org.openjdk.skara.host&quot;);
 45 
<span class="line-added"> 46     private List&lt;String&gt; labels = null;</span>
<span class="line-added"> 47 </span>
 48     GitHubPullRequest(GitHubRepository repository, JSONValue jsonValue, RestRequest request) {
 49         this.host = (GitHubHost)repository.forge();
 50         this.repository = repository;
 51         this.request = request;
 52         this.json = jsonValue;
<span class="line-added"> 53 </span>
<span class="line-added"> 54         labels = json.get(&quot;labels&quot;)</span>
<span class="line-added"> 55                      .stream()</span>
<span class="line-added"> 56                      .map(v -&gt; v.get(&quot;name&quot;).asString())</span>
<span class="line-added"> 57                      .sorted()</span>
<span class="line-added"> 58                      .collect(Collectors.toList());</span>
 59     }
 60 
 61     @Override
 62     public HostedRepository repository() {
 63         return repository;
 64     }
 65 
 66     @Override
 67     public IssueProject project() {
 68         return null;
 69     }
 70 
 71     @Override
 72     public String id() {
 73         return json.get(&quot;number&quot;).toString();
 74     }
 75 
 76     @Override
 77     public HostUser author() {
 78         return host.parseUserField(json);
</pre>
<hr />
<pre>
418 
419     @Override
420     public URI changeUrl(Hash base) {
421         return URIBuilder.base(webUrl()).appendPath(&quot;/files/&quot; + base.abbreviate() + &quot;..&quot; + headHash().abbreviate()).build();
422     }
423 
424     @Override
425     public boolean isDraft() {
426         return json.get(&quot;draft&quot;).asBoolean();
427     }
428 
429     @Override
430     public void setState(State state) {
431         request.patch(&quot;pulls/&quot; + json.get(&quot;number&quot;).toString())
432                .body(&quot;state&quot;, state != State.OPEN ? &quot;closed&quot; : &quot;open&quot;)
433                .execute();
434     }
435 
436     @Override
437     public void addLabel(String label) {
<span class="line-added">438         labels = null;</span>
439         var query = JSON.object().put(&quot;labels&quot;, JSON.array().add(label));
440         request.post(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels&quot;)
441                .body(query)
442                .execute();
443     }
444 
445     @Override
446     public void removeLabel(String label) {
<span class="line-added">447         labels = null;</span>
448         request.delete(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels/&quot; + label)
449                .onError(r -&gt; {
450                    // The GitHub API explicitly states that 404 is the response for deleting labels currently not set
451                    if (r.statusCode() == 404) {
452                        return JSONValue.fromNull();
453                    }
454                    throw new RuntimeException(&quot;Invalid response&quot;);
455                })
456                .execute();
457     }
458 
459     @Override
460     public List&lt;String&gt; labels() {
<span class="line-modified">461         if (labels == null) {</span>
<span class="line-modified">462             labels = request.get(&quot;issues/&quot; + json.get(&quot;number&quot;).toString() + &quot;/labels&quot;).execute().stream()</span>
<span class="line-modified">463                             .map(JSONValue::asObject)</span>
<span class="line-modified">464                             .map(obj -&gt; obj.get(&quot;name&quot;).asString())</span>
<span class="line-modified">465                             .sorted()</span>
<span class="line-added">466                             .collect(Collectors.toList());</span>
<span class="line-added">467         }</span>
<span class="line-added">468         return labels;</span>
469     }
470 
471     @Override
472     public URI webUrl() {
473         var host = (GitHubHost)repository.forge();
474         var endpoint = &quot;/&quot; + repository.name() + &quot;/pull/&quot; + id();
475         return host.getWebURI(endpoint);
476     }
477 
478     @Override
479     public String toString() {
480         return &quot;GitHubPullRequest #&quot; + id() + &quot; by &quot; + author();
481     }
482 
483     @Override
484     public List&lt;HostUser&gt; assignees() {
485         return json.get(&quot;assignees&quot;).asArray()
486                                     .stream()
487                                     .map(host::parseUserObject)
488                                     .collect(Collectors.toList());
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>