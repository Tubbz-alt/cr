<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff bots/notify/src/main/java/org/openjdk/skara/bots/notify/MailingListUpdater.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JsonUpdater.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="UpdateConsumer.java.udiff.html" target="_top">next &gt;</a></center>    <h2>bots/notify/src/main/java/org/openjdk/skara/bots/notify/MailingListUpdater.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -75,21 +75,30 @@</span>
          } else {
              return &quot;= &quot; + patch.target().path().orElseThrow();
          }
      }
  
<span class="udiff-line-modified-removed">-     private String commitToText(HostedRepository repository, Commit commit) {</span>
<span class="udiff-line-modified-added">+     private String commitToTextBrief(HostedRepository repository, Commit commit) {</span>
          var writer = new StringWriter();
          var printer = new PrintWriter(writer);
  
          printer.println(&quot;Changeset: &quot; + commit.hash().abbreviate());
          printer.println(&quot;Author:    &quot; + commit.author().name() + &quot; &lt;&quot; + commit.author().email() + &quot;&gt;&quot;);
          if (!commit.author().equals(commit.committer())) {
              printer.println(&quot;Committer: &quot; + commit.committer().name() + &quot; &lt;&quot; + commit.committer().email() + &quot;&gt;&quot;);
          }
          printer.println(&quot;Date:      &quot; + commit.date().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss +0000&quot;)));
          printer.println(&quot;URL:       &quot; + repository.webUrl(commit.hash()));
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         return writer.toString();</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     private String commitToText(HostedRepository repository, Commit commit) {</span>
<span class="udiff-line-added">+         var writer = new StringWriter();</span>
<span class="udiff-line-added">+         var printer = new PrintWriter(writer);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         printer.print(commitToTextBrief(repository, commit));</span>
          printer.println();
          printer.println(String.join(&quot;\n&quot;, commit.message()));
          printer.println();
  
          for (var diff : commit.parentDiffs()) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -103,14 +112,12 @@</span>
  
      private String tagAnnotationToText(HostedRepository repository, Tag.Annotated annotation) {
          var writer = new StringWriter();
          var printer = new PrintWriter(writer);
  
<span class="udiff-line-modified-removed">-         printer.println(&quot;Changeset: &quot; + annotation.target().abbreviate());</span>
<span class="udiff-line-removed">-         printer.println(&quot;Author:    &quot; + annotation.author().name() + &quot; &lt;&quot; + annotation.author().email() + &quot;&gt;&quot;);</span>
<span class="udiff-line-modified-added">+         printer.println(&quot;Tagged by: &quot; + annotation.author().name() + &quot; &lt;&quot; + annotation.author().email() + &quot;&gt;&quot;);</span>
          printer.println(&quot;Date:      &quot; + annotation.date().format(DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss +0000&quot;)));
<span class="udiff-line-removed">-         printer.println(&quot;URL:       &quot; + repository.webUrl(annotation.target()));</span>
          printer.println();
          printer.print(String.join(&quot;\n&quot;, annotation.message()));
  
          return writer.toString();
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -246,53 +253,74 @@</span>
                  break;
          }
      }
  
      @Override
<span class="udiff-line-modified-removed">-     public void handleAnnotatedTagCommits(HostedRepository repository, List&lt;Commit&gt; commits, Tag tag, Tag.Annotated annotation) {</span>
<span class="udiff-line-modified-added">+     public void handleOpenJDKTagCommits(HostedRepository repository, List&lt;Commit&gt; commits, OpenJDKTag tag, Tag.Annotated annotation) {</span>
          if (mode == Mode.PR_ONLY) {
              return;
          }
          var writer = new StringWriter();
          var printer = new PrintWriter(writer);
  
<span class="udiff-line-added">+         var taggedCommit = commits.get(commits.size() - 1);</span>
          if (annotation != null) {
              printer.println(tagAnnotationToText(repository, annotation));
          }
<span class="udiff-line-added">+         printer.println(commitToTextBrief(repository, taggedCommit));</span>
  
<span class="udiff-line-modified-removed">-         var openjdkTag = OpenJDKTag.create(tag);</span>
<span class="udiff-line-modified-removed">-         if (openjdkTag.isPresent()) {</span>
<span class="udiff-line-modified-removed">-             printer.println(&quot;The following commits are included in &quot; + tag);</span>
<span class="udiff-line-modified-removed">-             printer.println(&quot;========================================================&quot;);</span>
<span class="udiff-line-modified-removed">-             for (var commit : commits) {</span>
<span class="udiff-line-modified-removed">-                 printer.print(commit.hash().abbreviate());</span>
<span class="udiff-line-removed">-                 if (commit.message().size() &gt; 0) {</span>
<span class="udiff-line-removed">-                     printer.print(&quot;: &quot; + commit.message().get(0));</span>
<span class="udiff-line-removed">-                 }</span>
<span class="udiff-line-removed">-                 printer.println();</span>
<span class="udiff-line-modified-added">+         printer.println(&quot;The following commits are included in &quot; + tag.tag());</span>
<span class="udiff-line-modified-added">+         printer.println(&quot;========================================================&quot;);</span>
<span class="udiff-line-modified-added">+         for (var commit : commits) {</span>
<span class="udiff-line-modified-added">+             printer.print(commit.hash().abbreviate());</span>
<span class="udiff-line-modified-added">+             if (commit.message().size() &gt; 0) {</span>
<span class="udiff-line-modified-added">+                 printer.print(&quot;: &quot; + commit.message().get(0));</span>
              }
<span class="udiff-line-added">+             printer.println();</span>
          }
  
<span class="udiff-line-modified-removed">-         var tagCommit = commits.get(commits.size() - 1);</span>
<span class="udiff-line-removed">-         var subject = tagToSubject(repository, tagCommit.hash(), tag);</span>
<span class="udiff-line-modified-added">+         var subject = tagToSubject(repository, taggedCommit.hash(), tag.tag());</span>
          var email = Email.create(subject, writer.toString())
                           .sender(sender)
                           .recipient(recipient)
                           .headers(headers);
  
          if (annotation != null) {
              email.author(annotationToAuthor(annotation));
          } else {
<span class="udiff-line-modified-removed">-             email.author(commitToAuthor(tagCommit));</span>
<span class="udiff-line-modified-added">+             email.author(commitToAuthor(taggedCommit));</span>
          }
  
          list.post(email.build());
      }
  
      @Override
<span class="udiff-line-modified-removed">-     public void handleTagCommits(HostedRepository repository, List&lt;Commit&gt; commits, Tag tag) {</span>
<span class="udiff-line-modified-removed">-         handleAnnotatedTagCommits(repository, commits, tag, null);</span>
<span class="udiff-line-modified-added">+     public void handleTagCommit(HostedRepository repository, Commit commit, Tag tag, Tag.Annotated annotation) {</span>
<span class="udiff-line-modified-added">+         if (mode == Mode.PR_ONLY) {</span>
<span class="udiff-line-added">+             return;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         var writer = new StringWriter();</span>
<span class="udiff-line-added">+         var printer = new PrintWriter(writer);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (annotation != null) {</span>
<span class="udiff-line-added">+             printer.println(tagAnnotationToText(repository, annotation));</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         printer.println(commitToTextBrief(repository, commit));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         var subject = tagToSubject(repository, commit.hash(), tag);</span>
<span class="udiff-line-added">+         var email = Email.create(subject, writer.toString())</span>
<span class="udiff-line-added">+                          .sender(sender)</span>
<span class="udiff-line-added">+                          .recipient(recipient)</span>
<span class="udiff-line-added">+                          .headers(headers);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (annotation != null) {</span>
<span class="udiff-line-added">+             email.author(annotationToAuthor(annotation));</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             email.author(commitToAuthor(commit));</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         list.post(email.build());</span>
      }
  
      private String newBranchSubject(HostedRepository repository, List&lt;Commit&gt; commits, Branch parent, Branch branch) {
          var subject = new StringBuilder();
          subject.append(repository.repositoryType().shortName());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -316,11 +344,11 @@</span>
      public void handleNewBranch(HostedRepository repository, List&lt;Commit&gt; commits, Branch parent, Branch branch) {
          var writer = new StringWriter();
          var printer = new PrintWriter(writer);
  
          if (commits.size() &gt; 0) {
<span class="udiff-line-modified-removed">-             printer.println(&quot;The following commits are unique to the &quot; + branch.name() + &quot; branch&quot;);</span>
<span class="udiff-line-modified-added">+             printer.println(&quot;The following commits are unique to the &quot; + branch.name() + &quot; branch:&quot;);</span>
              printer.println(&quot;========================================================&quot;);
              for (var commit : commits) {
                  printer.print(commit.hash().abbreviate());
                  if (commit.message().size() &gt; 0) {
                      printer.print(&quot;: &quot; + commit.message().get(0));
</pre>
<center><a href="JsonUpdater.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="UpdateConsumer.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>