<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/main/java/org/openjdk/skara/vcs/git/GitRepository.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../Repository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../hg/HgRepository.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>vcs/src/main/java/org/openjdk/skara/vcs/git/GitRepository.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
290     }
291 
292     @Override
293     public Repository reinitialize() throws IOException {
294         Files.walk(dir)
295              .map(Path::toFile)
296              .sorted(Comparator.reverseOrder())
297              .forEach(File::delete);
298 
299         return init();
300     }
301 
302     @Override
303     public Hash fetch(URI uri, String refspec) throws IOException {
304         try (var p = capture(&quot;git&quot;, &quot;fetch&quot;, &quot;--tags&quot;, uri.toString(), refspec)) {
305             await(p);
306             return resolve(&quot;FETCH_HEAD&quot;).get();
307         }
308     }
309 







310     private void checkout(String ref, boolean force) throws IOException {
311         var cmd = new ArrayList&lt;String&gt;();
312         cmd.addAll(List.of(&quot;git&quot;, &quot;-c&quot;, &quot;advice.detachedHead=false&quot;, &quot;checkout&quot;));
313         if (force) {
314             cmd.add(&quot;--force&quot;);
315         }
316         cmd.add(ref);
317         try (var p = capture(cmd)) {
318             await(p);
319         }
320     }
321 
322     @Override
323     public void checkout(Hash h, boolean force) throws IOException {
324         checkout(h.hex(), force);
325     }
326 
327     @Override
328     public void checkout(Branch b, boolean force) throws IOException {
329         checkout(b.name(), force);
</pre>
<hr />
<pre>
423         var cmd = new ArrayList&lt;&gt;(List.of(&quot;git&quot;, &quot;add&quot;));
424         for (var path : paths) {
425             cmd.add(path.toString());
426         }
427         try (var p = capture(cmd)) {
428             await(p);
429         }
430     }
431 
432     @Override
433     public void remove(Path... paths) throws IOException {
434         var cmd = new ArrayList&lt;&gt;(List.of(&quot;git&quot;, &quot;rm&quot;));
435         for (var path : paths) {
436             cmd.add(path.toString());
437         }
438         try (var p = capture(cmd)) {
439             await(p);
440         }
441     }
442 







443     @Override
444     public Hash commit(String message, String authorName, String authorEmail)  throws IOException {
445         return commit(message, authorName, authorEmail, null);
446     }
447 
448     @Override
449     public Hash commit(String message, String authorName, String authorEmail, Instant authorDate)  throws IOException {
450         return commit(message, authorName, authorEmail, authorDate, authorName, authorEmail, authorDate);
451     }
452 
453     @Override
454     public Hash commit(String message,
455                        String authorName,
456                        String authorEmail,
457                        String committerName,
458                        String committerEmail) throws IOException {
459         return commit(message, authorName, authorEmail, null, committerName, committerEmail, null);
460     }
461 
462     @Override
</pre>
<hr />
<pre>
829     public Optional&lt;String&gt; upstreamFor(Branch b) throws IOException {
830         try (var p = capture(&quot;git&quot;, &quot;for-each-ref&quot;, &quot;--format=%(upstream:short)&quot;, &quot;refs/heads/&quot; + b.name())) {
831             var lines = await(p).stdout();
832             return lines.size() == 1 &amp;&amp; !lines.get(0).isEmpty()? Optional.of(lines.get(0)) : Optional.empty();
833         }
834     }
835 
836     public static Repository clone(URI from, Path to, boolean isBare) throws IOException {
837         var cmd = new ArrayList&lt;String&gt;();
838         cmd.addAll(List.of(&quot;git&quot;, &quot;clone&quot;));
839         if (isBare) {
840             cmd.add(&quot;--bare&quot;);
841         }
842         cmd.addAll(List.of(from.toString(), to.toString()));
843         try (var p = capture(Path.of(&quot;&quot;).toAbsolutePath(), cmd)) {
844             await(p);
845         }
846         return new GitRepository(to);
847     }
848 








849     @Override
850     public void pull() throws IOException {
<span class="line-modified">851         pull(&quot;origin&quot;, &quot;master&quot;);</span>
852     }
853 
854     @Override
855     public void pull(String remote) throws IOException {
<span class="line-modified">856         pull(remote, &quot;master&quot;);</span>
857     }
858 
859 
860     @Override
861     public void pull(String remote, String refspec) throws IOException {
<span class="line-modified">862         try (var p = capture(&quot;git&quot;, &quot;pull&quot;, remote, refspec)) {</span>









863             await(p);
864         }
865     }
866 }
</pre>
</td>
<td>
<hr />
<pre>
290     }
291 
292     @Override
293     public Repository reinitialize() throws IOException {
294         Files.walk(dir)
295              .map(Path::toFile)
296              .sorted(Comparator.reverseOrder())
297              .forEach(File::delete);
298 
299         return init();
300     }
301 
302     @Override
303     public Hash fetch(URI uri, String refspec) throws IOException {
304         try (var p = capture(&quot;git&quot;, &quot;fetch&quot;, &quot;--tags&quot;, uri.toString(), refspec)) {
305             await(p);
306             return resolve(&quot;FETCH_HEAD&quot;).get();
307         }
308     }
309 
<span class="line-added">310     @Override</span>
<span class="line-added">311     public void fetchAll() throws IOException {</span>
<span class="line-added">312         try (var p = capture(&quot;git&quot;, &quot;fetch&quot;, &quot;--tags&quot;, &quot;--prune&quot;, &quot;--prune-tags&quot;, &quot;--all&quot;)) {</span>
<span class="line-added">313             await(p);</span>
<span class="line-added">314         }</span>
<span class="line-added">315     }</span>
<span class="line-added">316 </span>
317     private void checkout(String ref, boolean force) throws IOException {
318         var cmd = new ArrayList&lt;String&gt;();
319         cmd.addAll(List.of(&quot;git&quot;, &quot;-c&quot;, &quot;advice.detachedHead=false&quot;, &quot;checkout&quot;));
320         if (force) {
321             cmd.add(&quot;--force&quot;);
322         }
323         cmd.add(ref);
324         try (var p = capture(cmd)) {
325             await(p);
326         }
327     }
328 
329     @Override
330     public void checkout(Hash h, boolean force) throws IOException {
331         checkout(h.hex(), force);
332     }
333 
334     @Override
335     public void checkout(Branch b, boolean force) throws IOException {
336         checkout(b.name(), force);
</pre>
<hr />
<pre>
430         var cmd = new ArrayList&lt;&gt;(List.of(&quot;git&quot;, &quot;add&quot;));
431         for (var path : paths) {
432             cmd.add(path.toString());
433         }
434         try (var p = capture(cmd)) {
435             await(p);
436         }
437     }
438 
439     @Override
440     public void remove(Path... paths) throws IOException {
441         var cmd = new ArrayList&lt;&gt;(List.of(&quot;git&quot;, &quot;rm&quot;));
442         for (var path : paths) {
443             cmd.add(path.toString());
444         }
445         try (var p = capture(cmd)) {
446             await(p);
447         }
448     }
449 
<span class="line-added">450     @Override</span>
<span class="line-added">451     public void delete(Branch b) throws IOException {</span>
<span class="line-added">452         try (var p = capture(&quot;git&quot;, &quot;branch&quot;, &quot;-D&quot;, b.name())) {</span>
<span class="line-added">453             await(p);</span>
<span class="line-added">454         }</span>
<span class="line-added">455     }</span>
<span class="line-added">456 </span>
457     @Override
458     public Hash commit(String message, String authorName, String authorEmail)  throws IOException {
459         return commit(message, authorName, authorEmail, null);
460     }
461 
462     @Override
463     public Hash commit(String message, String authorName, String authorEmail, Instant authorDate)  throws IOException {
464         return commit(message, authorName, authorEmail, authorDate, authorName, authorEmail, authorDate);
465     }
466 
467     @Override
468     public Hash commit(String message,
469                        String authorName,
470                        String authorEmail,
471                        String committerName,
472                        String committerEmail) throws IOException {
473         return commit(message, authorName, authorEmail, null, committerName, committerEmail, null);
474     }
475 
476     @Override
</pre>
<hr />
<pre>
843     public Optional&lt;String&gt; upstreamFor(Branch b) throws IOException {
844         try (var p = capture(&quot;git&quot;, &quot;for-each-ref&quot;, &quot;--format=%(upstream:short)&quot;, &quot;refs/heads/&quot; + b.name())) {
845             var lines = await(p).stdout();
846             return lines.size() == 1 &amp;&amp; !lines.get(0).isEmpty()? Optional.of(lines.get(0)) : Optional.empty();
847         }
848     }
849 
850     public static Repository clone(URI from, Path to, boolean isBare) throws IOException {
851         var cmd = new ArrayList&lt;String&gt;();
852         cmd.addAll(List.of(&quot;git&quot;, &quot;clone&quot;));
853         if (isBare) {
854             cmd.add(&quot;--bare&quot;);
855         }
856         cmd.addAll(List.of(from.toString(), to.toString()));
857         try (var p = capture(Path.of(&quot;&quot;).toAbsolutePath(), cmd)) {
858             await(p);
859         }
860         return new GitRepository(to);
861     }
862 
<span class="line-added">863     public static Repository mirror(URI from, Path to) throws IOException {</span>
<span class="line-added">864         var cwd = Path.of(&quot;&quot;).toAbsolutePath();</span>
<span class="line-added">865         try (var p = capture(cwd, &quot;git&quot;, &quot;clone&quot;, &quot;--mirror&quot;, from.toString(), to.toString())) {</span>
<span class="line-added">866             await(p);</span>
<span class="line-added">867         }</span>
<span class="line-added">868         return new GitRepository(to);</span>
<span class="line-added">869     }</span>
<span class="line-added">870 </span>
871     @Override
872     public void pull() throws IOException {
<span class="line-modified">873         pull(null, null);</span>
874     }
875 
876     @Override
877     public void pull(String remote) throws IOException {
<span class="line-modified">878         pull(remote, null);</span>
879     }
880 
881 
882     @Override
883     public void pull(String remote, String refspec) throws IOException {
<span class="line-modified">884         var cmd = new ArrayList&lt;String&gt;();</span>
<span class="line-added">885         cmd.add(&quot;git&quot;);</span>
<span class="line-added">886         cmd.add(&quot;pull&quot;);</span>
<span class="line-added">887         if (remote != null) {</span>
<span class="line-added">888             cmd.add(remote);</span>
<span class="line-added">889         }</span>
<span class="line-added">890         if (refspec != null) {</span>
<span class="line-added">891             cmd.add(refspec);</span>
<span class="line-added">892         }</span>
<span class="line-added">893         try (var p = capture(cmd)) {</span>
894             await(p);
895         }
896     }
897 }
</pre>
</td>
</tr>
</table>
<center><a href="../Repository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../hg/HgRepository.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>