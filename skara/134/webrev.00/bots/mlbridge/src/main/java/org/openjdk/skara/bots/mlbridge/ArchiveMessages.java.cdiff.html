<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ArchiveMessages.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ArchiveMessages.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,9 ***</span>
  package org.openjdk.skara.bots.mlbridge;
  
  import org.openjdk.skara.email.Email;
<span class="line-modified">! import org.openjdk.skara.host.Review;</span>
  import org.openjdk.skara.vcs.*;
  
  import java.net.URI;
  import java.time.format.DateTimeFormatter;
  import java.util.Arrays;
<span class="line-new-header">--- 1,9 ---</span>
  package org.openjdk.skara.bots.mlbridge;
  
  import org.openjdk.skara.email.Email;
<span class="line-modified">! import org.openjdk.skara.host.*;</span>
  import org.openjdk.skara.vcs.*;
  
  import java.net.URI;
  import java.time.format.DateTimeFormatter;
  import java.util.Arrays;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 110,28 ***</span>
  
      private static String composeReplyFooter(PullRequestInstance prInstance) {
          return &quot;PR: &quot; + prInstance.pr().getWebUrl();
      }
  
      static String composeReply(Email parent, String body, PullRequestInstance prInstance) {
          return &quot;On &quot; + parent.date().format(DateTimeFormatter.RFC_1123_DATE_TIME) + &quot;, &quot; + parent.author().toString() + &quot; wrote:\n&quot; +
                  &quot;\n&quot; +
<span class="line-modified">!                 quoteBody(parent.body()) +</span>
                  &quot;\n\n&quot; +
                  filterComments(body) +
                  &quot;\n\n&quot; +
                  composeReplyFooter(prInstance);
      }
  
      static String composeCombinedReply(Email parent, String body, PullRequestInstance prInstance) {
<span class="line-modified">!         var parentFooter = ArchiveMessages.composeReplyFooter(prInstance);</span>
<span class="line-removed">-         var filteredParentBody = parent.body().substring(0, parent.body().length() - parentFooter.length()).strip();</span>
<span class="line-removed">-         return filteredParentBody +</span>
                  &quot;\n\n&quot; +
                  filterComments(body) +
                  &quot;\n\n&quot; +
<span class="line-modified">!                 parentFooter;</span>
      }
  
      static String reviewCommentBody(String body, Review.Verdict verdict, String user, String role) {
          var result = new StringBuilder(filterComments(body));
          if (verdict != Review.Verdict.NONE) {
<span class="line-new-header">--- 110,36 ---</span>
  
      private static String composeReplyFooter(PullRequestInstance prInstance) {
          return &quot;PR: &quot; + prInstance.pr().getWebUrl();
      }
  
<span class="line-added">+     private static String filterParentBody(Email parent, PullRequestInstance prInstance) {</span>
<span class="line-added">+         var parentFooter = ArchiveMessages.composeReplyFooter(prInstance);</span>
<span class="line-added">+         var filteredParentBody = parent.body().strip();</span>
<span class="line-added">+         if (filteredParentBody.endsWith(parentFooter)) {</span>
<span class="line-added">+             return filteredParentBody.substring(0, filteredParentBody.length() - parentFooter.length()).strip();</span>
<span class="line-added">+         } else {</span>
<span class="line-added">+             return filteredParentBody;</span>
<span class="line-added">+         }</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      static String composeReply(Email parent, String body, PullRequestInstance prInstance) {
          return &quot;On &quot; + parent.date().format(DateTimeFormatter.RFC_1123_DATE_TIME) + &quot;, &quot; + parent.author().toString() + &quot; wrote:\n&quot; +
                  &quot;\n&quot; +
<span class="line-modified">!                 quoteBody(filterParentBody(parent, prInstance)) +</span>
                  &quot;\n\n&quot; +
                  filterComments(body) +
                  &quot;\n\n&quot; +
                  composeReplyFooter(prInstance);
      }
  
      static String composeCombinedReply(Email parent, String body, PullRequestInstance prInstance) {
<span class="line-modified">!         return filterParentBody(parent, prInstance) +</span>
                  &quot;\n\n&quot; +
                  filterComments(body) +
                  &quot;\n\n&quot; +
<span class="line-modified">!                 composeReplyFooter(prInstance);</span>
      }
  
      static String reviewCommentBody(String body, Review.Verdict verdict, String user, String role) {
          var result = new StringBuilder(filterComments(body));
          if (verdict != Review.Verdict.NONE) {
</pre>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>