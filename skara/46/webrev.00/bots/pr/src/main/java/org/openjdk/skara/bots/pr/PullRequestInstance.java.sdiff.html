<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/pr/src/main/java/org/openjdk/skara/bots/pr/PullRequestInstance.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CommandWorkItem.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/pr/src/main/java/org/openjdk/skara/bots/pr/PullRequestInstance.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 56      * @param allReviews
 57      * @return
 58      */
 59     static List&lt;Review&gt; filterActiveReviews(List&lt;Review&gt; allReviews) {
 60         var reviewPerUser = new LinkedHashMap&lt;HostUserDetails, Review&gt;();
 61         for (var review : allReviews) {
 62             reviewPerUser.put(review.reviewer(), review);
 63         }
 64         return new ArrayList&lt;&gt;(reviewPerUser.values());
 65     }
 66 
 67     private String commitMessage(List&lt;Review&gt; activeReviews, Namespace namespace, boolean isMerge) throws IOException {
 68         var reviewers = activeReviews.stream()
 69                           .filter(review -&gt; review.verdict() == Review.Verdict.APPROVED)
 70                           .map(review -&gt; review.reviewer().id())
 71                           .map(namespace::get)
 72                           .filter(Objects::nonNull)
 73                           .map(Contributor::username)
 74                           .collect(Collectors.toList());
 75 

 76         var additionalContributors = Contributors.contributors(pr.repository().host().getCurrentUserDetails(),
<span class="line-modified"> 77                                                                pr.getComments()).stream()</span>
 78                                                  .map(email -&gt; Author.fromString(email.toString()))
 79                                                  .collect(Collectors.toList());
 80 


 81         var commitMessage = CommitMessage.title(isMerge ? &quot;Merge&quot; : pr.getTitle())
 82                                          .contributors(additionalContributors)
 83                                          .reviewers(reviewers);


 84         return String.join(&quot;\n&quot;, commitMessage.format(CommitMessageFormatters.v1));
 85     }
 86 
 87     private Hash commitSquashed(List&lt;Review&gt; activeReviews, Namespace namespace, String censusDomain, String sponsorId) throws IOException {
 88         localRepo.checkout(baseHash, true);
 89         localRepo.squash(headHash);
 90 
 91         Author committer;
 92         Author author;
 93         var contributor = namespace.get(pr.getAuthor().id());
 94 
 95         if (contributor == null) {
 96             // Use the information contained in the head commit - jcheck has verified that it contains sane values
 97             var headCommit = localRepo.commits(headHash.hex() + &quot;^..&quot; + headHash.hex()).asList().get(0);
 98             author = headCommit.author();
 99         } else {
100             author = new Author(contributor.fullName().orElseThrow(), contributor.username() + &quot;@&quot; + censusDomain);
101         }
102 
103         if (sponsorId != null) {
</pre>
</td>
<td>
<hr />
<pre>
 56      * @param allReviews
 57      * @return
 58      */
 59     static List&lt;Review&gt; filterActiveReviews(List&lt;Review&gt; allReviews) {
 60         var reviewPerUser = new LinkedHashMap&lt;HostUserDetails, Review&gt;();
 61         for (var review : allReviews) {
 62             reviewPerUser.put(review.reviewer(), review);
 63         }
 64         return new ArrayList&lt;&gt;(reviewPerUser.values());
 65     }
 66 
 67     private String commitMessage(List&lt;Review&gt; activeReviews, Namespace namespace, boolean isMerge) throws IOException {
 68         var reviewers = activeReviews.stream()
 69                           .filter(review -&gt; review.verdict() == Review.Verdict.APPROVED)
 70                           .map(review -&gt; review.reviewer().id())
 71                           .map(namespace::get)
 72                           .filter(Objects::nonNull)
 73                           .map(Contributor::username)
 74                           .collect(Collectors.toList());
 75 
<span class="line-added"> 76         var comments = pr.getComments();</span>
 77         var additionalContributors = Contributors.contributors(pr.repository().host().getCurrentUserDetails(),
<span class="line-modified"> 78                                                                comments).stream()</span>
 79                                                  .map(email -&gt; Author.fromString(email.toString()))
 80                                                  .collect(Collectors.toList());
 81 
<span class="line-added"> 82         var summary = Summary.summary(pr.repository().host().getCurrentUserDetails(), comments);</span>
<span class="line-added"> 83 </span>
 84         var commitMessage = CommitMessage.title(isMerge ? &quot;Merge&quot; : pr.getTitle())
 85                                          .contributors(additionalContributors)
 86                                          .reviewers(reviewers);
<span class="line-added"> 87         summary.ifPresent(commitMessage::summary);</span>
<span class="line-added"> 88 </span>
 89         return String.join(&quot;\n&quot;, commitMessage.format(CommitMessageFormatters.v1));
 90     }
 91 
 92     private Hash commitSquashed(List&lt;Review&gt; activeReviews, Namespace namespace, String censusDomain, String sponsorId) throws IOException {
 93         localRepo.checkout(baseHash, true);
 94         localRepo.squash(headHash);
 95 
 96         Author committer;
 97         Author author;
 98         var contributor = namespace.get(pr.getAuthor().id());
 99 
100         if (contributor == null) {
101             // Use the information contained in the head commit - jcheck has verified that it contains sane values
102             var headCommit = localRepo.commits(headHash.hex() + &quot;^..&quot; + headHash.hex()).asList().get(0);
103             author = headCommit.author();
104         } else {
105             author = new Author(contributor.fullName().orElseThrow(), contributor.username() + &quot;@&quot; + censusDomain);
106         }
107 
108         if (sponsorId != null) {
</pre>
</td>
</tr>
</table>
<center><a href="CommandWorkItem.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>