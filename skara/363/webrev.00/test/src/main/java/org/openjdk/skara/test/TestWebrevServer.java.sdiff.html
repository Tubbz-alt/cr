<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff test/src/main/java/org/openjdk/skara/test/TestWebrevServer.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/WebrevStorage.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>test/src/main/java/org/openjdk/skara/test/TestWebrevServer.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
24 
25 import com.sun.net.httpserver.*;
26 import org.openjdk.skara.network.URIBuilder;
27 
28 import java.io.*;
29 import java.net.*;
30 import java.nio.charset.StandardCharsets;
31 
32 public class TestWebrevServer implements AutoCloseable {
33     private final HttpServer httpServer;
34     private boolean checked = false;
35     private boolean redirectFollowed = true;
36 
37     private class Handler implements HttpHandler {
38         @Override
39         public void handle(HttpExchange exchange) throws IOException {
40             checked = true;
41             var response = &quot;ok!&quot;;
42             var responseBytes = response.getBytes(StandardCharsets.UTF_8);
43             if (!exchange.getRequestURI().toString().contains(&quot;final=true&quot;)) {
<span class="line-modified">44                 exchange.getResponseHeaders().add(&quot;Location&quot;, exchange.getRequestURI().toString() + &quot;&amp;final=true&quot;);</span>
45                 exchange.sendResponseHeaders(302, responseBytes.length);
46             } else {
47                 redirectFollowed = true;
48                 exchange.sendResponseHeaders(200, responseBytes.length);
49             }
50             OutputStream outputStream = exchange.getResponseBody();
51             outputStream.write(responseBytes);
52             outputStream.close();
53         }
54     }
55 
56     public TestWebrevServer() throws IOException {
57         InetSocketAddress address = new InetSocketAddress(InetAddress.getLoopbackAddress(), 0);
58         httpServer = HttpServer.create(address, 0);
59         httpServer.createContext(&quot;/webrevs&quot;, new Handler());
60         httpServer.setExecutor(null);
61         httpServer.start();
62     }
63 
64     public URI uri() {
</pre>
</td>
<td>
<hr />
<pre>
24 
25 import com.sun.net.httpserver.*;
26 import org.openjdk.skara.network.URIBuilder;
27 
28 import java.io.*;
29 import java.net.*;
30 import java.nio.charset.StandardCharsets;
31 
32 public class TestWebrevServer implements AutoCloseable {
33     private final HttpServer httpServer;
34     private boolean checked = false;
35     private boolean redirectFollowed = true;
36 
37     private class Handler implements HttpHandler {
38         @Override
39         public void handle(HttpExchange exchange) throws IOException {
40             checked = true;
41             var response = &quot;ok!&quot;;
42             var responseBytes = response.getBytes(StandardCharsets.UTF_8);
43             if (!exchange.getRequestURI().toString().contains(&quot;final=true&quot;)) {
<span class="line-modified">44                 exchange.getResponseHeaders().add(&quot;Location&quot;, uri() + &quot;&amp;final=true&quot;);</span>
45                 exchange.sendResponseHeaders(302, responseBytes.length);
46             } else {
47                 redirectFollowed = true;
48                 exchange.sendResponseHeaders(200, responseBytes.length);
49             }
50             OutputStream outputStream = exchange.getResponseBody();
51             outputStream.write(responseBytes);
52             outputStream.close();
53         }
54     }
55 
56     public TestWebrevServer() throws IOException {
57         InetSocketAddress address = new InetSocketAddress(InetAddress.getLoopbackAddress(), 0);
58         httpServer = HttpServer.create(address, 0);
59         httpServer.createContext(&quot;/webrevs&quot;, new Handler());
60         httpServer.setExecutor(null);
61         httpServer.start();
62     }
63 
64     public URI uri() {
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/WebrevStorage.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>