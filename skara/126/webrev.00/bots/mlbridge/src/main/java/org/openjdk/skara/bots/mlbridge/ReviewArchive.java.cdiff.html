<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/ReviewArchive.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 187,11 ***</span>
  
      private String latestHeadSubject() {
          try {
              var latestCommit = prInstance.localRepo().lookup(prInstance.headHash()).orElseThrow(RuntimeException::new);
              var firstLine = latestCommit.message().size() &gt; 0 ? latestCommit.message().get(0) : prInstance.pr().getTitle();
<span class="line-modified">!             return String.format(&quot;%02d: %s&quot;, revisionCount(), firstLine);</span>
          } catch (IOException e) {
              throw new UncheckedIOException(e);
          }
      }
  
<span class="line-new-header">--- 187,11 ---</span>
  
      private String latestHeadSubject() {
          try {
              var latestCommit = prInstance.localRepo().lookup(prInstance.headHash()).orElseThrow(RuntimeException::new);
              var firstLine = latestCommit.message().size() &gt; 0 ? latestCommit.message().get(0) : prInstance.pr().getTitle();
<span class="line-modified">!             return String.format(&quot;Re: %02d: %s&quot;, revisionCount(), firstLine);</span>
          } catch (IOException e) {
              throw new UncheckedIOException(e);
          }
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 259,10 ***</span>
<span class="line-new-header">--- 259,13 ---</span>
      private void addReplyCommon(Email parent, HostUserDetails author, String subject, String body, EmailAddress id) {
          var references = parent.id().toString();
          if (parent.hasHeader(&quot;References&quot;)) {
              references = parent.headerValue(&quot;References&quot;) + &quot; &quot; + references;
          }
<span class="line-added">+         if (!subject.startsWith(&quot;Re: &quot;)) {</span>
<span class="line-added">+             subject = &quot;Re: &quot; + subject;</span>
<span class="line-added">+         }</span>
  
          // Collapse self-replies and replies-to-same that have been created in this run
          var collapsable = findCollapsable(parent, author);
          if (collapsable.isPresent()) {
              // Drop the parent
</pre>
<hr />
<pre>
<span class="line-old-header">*** 274,10 ***</span>
<span class="line-new-header">--- 277,11 ---</span>
              collapsed += getStableMessageId(parentEmail.id());
  
              var reply = ArchiveMessages.composeCombinedReply(parentEmail, body, prInstance);
              var email = Email.from(parentEmail)
                               .body(reply)
<span class="line-added">+                              .subject(subject)</span>
                               .id(id)
                               .header(&quot;PR-Collapsed-IDs&quot;, collapsed)
                               .header(&quot;PR-Sequence&quot;, Integer.toString(existing.size() + generated.size()))
                               .build();
              generated.add(email);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 331,11 ***</span>
              if (!existingIds.containsKey(getStableMessageId(id))) {
                  var parent = topCommentForHash(review.hash());
                  var userName = contributor != null ? contributor.username() : review.reviewer().userName() + &quot;@&quot; + censusInstance.namespace().name();
                  var userRole = contributor != null ? projectRole(contributor, censusInstance) : &quot;none&quot;;
                  var replyBody = ArchiveMessages.reviewCommentBody(review.body().get(), review.verdict(), userName, userRole);
<span class="line-modified">!                 addReplyCommon(parent, review.reviewer(), &quot;Re: RFR: &quot; + prInstance.pr().getTitle(), replyBody, id);</span>
              }
          }
  
          if (contributor != null) {
              var isReviewer = censusInstance.project().isReviewer(contributor.username(), censusInstance.configuration().census().version());
<span class="line-new-header">--- 335,11 ---</span>
              if (!existingIds.containsKey(getStableMessageId(id))) {
                  var parent = topCommentForHash(review.hash());
                  var userName = contributor != null ? contributor.username() : review.reviewer().userName() + &quot;@&quot; + censusInstance.namespace().name();
                  var userRole = contributor != null ? projectRole(contributor, censusInstance) : &quot;none&quot;;
                  var replyBody = ArchiveMessages.reviewCommentBody(review.body().get(), review.verdict(), userName, userRole);
<span class="line-modified">!                 addReplyCommon(parent, review.reviewer(), parent.subject(), replyBody, id);</span>
              }
          }
  
          if (contributor != null) {
              var isReviewer = censusInstance.project().isReviewer(contributor.username(), censusInstance.configuration().census().version());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 369,11 ***</span>
              }
              body.append(&quot;\n&quot;);
          }
          body.append(reviewComment.body());
  
<span class="line-modified">!         addReplyCommon(parent, reviewComment.author(), &quot;Re: RFR: &quot; + prInstance.pr().getTitle(), body.toString(), id);</span>
      }
  
      List&lt;Email&gt; generatedEmails() {
          return generated;
      }
<span class="line-new-header">--- 373,11 ---</span>
              }
              body.append(&quot;\n&quot;);
          }
          body.append(reviewComment.body());
  
<span class="line-modified">!         addReplyCommon(parent, reviewComment.author(), parent.subject(), body.toString(), id);</span>
      }
  
      List&lt;Email&gt; generatedEmails() {
          return generated;
      }
</pre>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/mlbridge/MailingListBridgeBotTests.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>