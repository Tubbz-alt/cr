<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff cli/src/main/java/org/openjdk/skara/cli/GitPr.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>cli/src/main/java/org/openjdk/skara/cli/GitPr.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 43,10 ***</span>
<span class="line-new-header">--- 43,13 ---</span>
  import java.util.logging.Level;
  import java.util.stream.Collectors;
  
  public class GitPr {
      private static final StandardOpenOption APPEND = StandardOpenOption.APPEND;
<span class="line-added">+     private static final Pattern ISSUE_ID_PATTERN = Pattern.compile(&quot;([A-Za-z][A-Za-z0-9]+)?-([0-9]+)&quot;);</span>
<span class="line-added">+     private static final Pattern ISSUE_MARKDOWN_PATTERN =</span>
<span class="line-added">+         Pattern.compile(&quot;^\\[([A-Z]+-[0-9]+)\\]\\(https:\\/\\/bugs.openjdk.java.net\\/browse\\/[A-Z]+-[0-9]+\\): .*$&quot;);</span>
  
      private static void exit(String fmt, Object...args) {
          System.err.println(String.format(fmt, args));
          System.exit(1);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 133,10 ***</span>
<span class="line-new-header">--- 136,37 ---</span>
          var parts = issue.id().split(&quot;-&quot;);
          var id = parts.length == 2 ? parts[1] : issue.id();
          return id + &quot;: &quot; + issue.title();
      }
  
<span class="line-added">+     private static List&lt;String&gt; issuesFromPullRequest(PullRequest pr) {</span>
<span class="line-added">+         var issueTitleIndex = -1;</span>
<span class="line-added">+         var lines = pr.body().split(&quot;\n&quot;);</span>
<span class="line-added">+         for (var i = 0; i &lt; lines.length; i++) {</span>
<span class="line-added">+             if (lines[i].startsWith(&quot;## Issue&quot;)) {</span>
<span class="line-added">+                 issueTitleIndex = i;</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         if (issueTitleIndex == -1) {</span>
<span class="line-added">+             return List.of();</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         var issues = new ArrayList&lt;String&gt;();</span>
<span class="line-added">+         for (var i = issueTitleIndex + 1; i &lt; lines.length; i++) {</span>
<span class="line-added">+             var m = ISSUE_MARKDOWN_PATTERN.matcher(lines[i]);</span>
<span class="line-added">+             if (m.matches()) {</span>
<span class="line-added">+                 issues.add(m.group(1));</span>
<span class="line-added">+             } else {</span>
<span class="line-added">+                 break;</span>
<span class="line-added">+             }</span>
<span class="line-added">+         }</span>
<span class="line-added">+ </span>
<span class="line-added">+         return issues;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      private static String jbsProjectFromJcheckConf(Repository repo) throws IOException {
          var conf = JCheckConfiguration.from(repo, repo.resolve(&quot;master&quot;).orElseThrow(() -&gt;
              new IOException(&quot;Could not resolve &#39;master&#39; branch&quot;)
          ));
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 158,12 ***</span>
      private static Optional&lt;Issue&gt; getIssue(Branch b, String project) throws IOException {
          return getIssue(b.name(), project);
      }
  
      private static Optional&lt;Issue&gt; getIssue(String s, String project) throws IOException {
<span class="line-modified">!         var issueIdPattern = Pattern.compile(&quot;([A-Za-z][A-Za-z0-9]+)?-([0-9]+)&quot;);</span>
<span class="line-removed">-         var m = issueIdPattern.matcher(s);</span>
          if (m.matches()) {
              var id = m.group(2);
              if (project == null) {
                  project = m.group(1);
              }
<span class="line-new-header">--- 188,11 ---</span>
      private static Optional&lt;Issue&gt; getIssue(Branch b, String project) throws IOException {
          return getIssue(b.name(), project);
      }
  
      private static Optional&lt;Issue&gt; getIssue(String s, String project) throws IOException {
<span class="line-modified">!         var m = ISSUE_ID_PATTERN.matcher(s);</span>
          if (m.matches()) {
              var id = m.group(2);
              if (project == null) {
                  project = m.group(1);
              }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 374,10 ***</span>
<span class="line-new-header">--- 403,15 ---</span>
              Option.shortcut(&quot;&quot;)
                    .fullname(&quot;labels&quot;)
                    .describe(&quot;LIST&quot;)
                    .helptext(&quot;Comma separated list of labels&quot;)
                    .optional(),
<span class="line-added">+             Option.shortcut(&quot;&quot;)</span>
<span class="line-added">+                   .fullname(&quot;issues&quot;)</span>
<span class="line-added">+                   .describe(&quot;LIST&quot;)</span>
<span class="line-added">+                   .helptext(&quot;Comma separated list of issues&quot;)</span>
<span class="line-added">+                   .optional(),</span>
              Option.shortcut(&quot;&quot;)
                    .fullname(&quot;columns&quot;)
                    .describe(&quot;id,title,author,assignees,labels&quot;)
                    .helptext(&quot;Comma separated list of columns to show&quot;)
                    .optional(),
</pre>
<hr />
<pre>
<span class="line-old-header">*** 929,10 ***</span>
<span class="line-new-header">--- 963,11 ---</span>
              var ids = new ArrayList&lt;String&gt;();
              var titles = new ArrayList&lt;String&gt;();
              var authors = new ArrayList&lt;String&gt;();
              var assignees = new ArrayList&lt;String&gt;();
              var labels = new ArrayList&lt;String&gt;();
<span class="line-added">+             var issues = new ArrayList&lt;String&gt;();</span>
  
              var authorsOption = getOption(&quot;authors&quot;, &quot;list&quot;, arguments);
              var filterAuthors = authorsOption == null ?
                  Set.of() :
                  new HashSet&lt;&gt;(Arrays.asList(authorsOption.split(&quot;,&quot;)));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 945,16 ***</span>
              var labelsOption = getOption(&quot;labels&quot;, &quot;list&quot;, arguments);
              var filterLabels = labelsOption == null ?
                  Set.of() :
                  Arrays.asList(labelsOption.split(&quot;,&quot;));
  
<span class="line-modified">!             var defaultColumns = List.of(&quot;id&quot;, &quot;title&quot;, &quot;authors&quot;, &quot;assignees&quot;, &quot;labels&quot;);</span>
              var columnValues = Map.of(defaultColumns.get(0), ids,
                                        defaultColumns.get(1), titles,
                                        defaultColumns.get(2), authors,
                                        defaultColumns.get(3), assignees,
<span class="line-modified">!                                       defaultColumns.get(4), labels);</span>
              var columnsOption = getOption(&quot;columns&quot;, &quot;list&quot;, arguments);
              var columns = columnsOption == null ?
                  defaultColumns :
                  Arrays.asList(columnsOption.split(&quot;,&quot;));
              if (columns != defaultColumns) {
<span class="line-new-header">--- 980,22 ---</span>
              var labelsOption = getOption(&quot;labels&quot;, &quot;list&quot;, arguments);
              var filterLabels = labelsOption == null ?
                  Set.of() :
                  Arrays.asList(labelsOption.split(&quot;,&quot;));
  
<span class="line-modified">!             var issuesOption = getOption(&quot;issues&quot;, &quot;list&quot;, arguments);</span>
<span class="line-added">+             var filterIssues = issuesOption == null ?</span>
<span class="line-added">+                 Set.of() :</span>
<span class="line-added">+                 Arrays.asList(issuesOption.split(&quot;,&quot;));</span>
<span class="line-added">+ </span>
<span class="line-added">+             var defaultColumns = List.of(&quot;id&quot;, &quot;title&quot;, &quot;authors&quot;, &quot;assignees&quot;, &quot;labels&quot;, &quot;issues&quot;);</span>
              var columnValues = Map.of(defaultColumns.get(0), ids,
                                        defaultColumns.get(1), titles,
                                        defaultColumns.get(2), authors,
                                        defaultColumns.get(3), assignees,
<span class="line-modified">!                                       defaultColumns.get(4), labels,</span>
<span class="line-added">+                                       defaultColumns.get(5), issues);</span>
              var columnsOption = getOption(&quot;columns&quot;, &quot;list&quot;, arguments);
              var columns = columnsOption == null ?
                  defaultColumns :
                  Arrays.asList(columnsOption.split(&quot;,&quot;));
              if (columns != defaultColumns) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 983,15 ***</span>
<span class="line-new-header">--- 1024,22 ---</span>
                  var prLabels = new HashSet&lt;&gt;(pr.labels());
                  if (!filterLabels.isEmpty() &amp;&amp; !filterLabels.stream().anyMatch(prLabels::contains)) {
                      continue;
                  }
  
<span class="line-added">+                 var prIssues = new HashSet&lt;&gt;(issuesFromPullRequest(pr));</span>
<span class="line-added">+                 if (!filterIssues.isEmpty() &amp;&amp; !filterIssues.stream().anyMatch(prIssues::contains)) {</span>
<span class="line-added">+                     continue;</span>
<span class="line-added">+                 }</span>
<span class="line-added">+ </span>
<span class="line-added">+ </span>
                  ids.add(pr.id());
                  titles.add(pr.title());
                  authors.add(prAuthor);
                  assignees.add(String.join(&quot;,&quot;, prAssignees));
                  labels.add(String.join(&quot;,&quot;, prLabels));
<span class="line-added">+                 issues.add(String.join(&quot;,&quot;, prIssues));</span>
              }
  
  
              String fmt = &quot;&quot;;
              for (var column : columns.subList(0, columns.size() - 1)) {
</pre>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>