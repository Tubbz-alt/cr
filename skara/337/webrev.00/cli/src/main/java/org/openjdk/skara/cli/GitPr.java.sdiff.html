<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff cli/src/main/java/org/openjdk/skara/cli/GitPr.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>cli/src/main/java/org/openjdk/skara/cli/GitPr.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  28 import org.openjdk.skara.issuetracker.IssueTracker;
  29 import org.openjdk.skara.issuetracker.Issue;
  30 import org.openjdk.skara.jcheck.JCheckConfiguration;
  31 import org.openjdk.skara.proxy.HttpProxy;
  32 import org.openjdk.skara.vcs.*;
  33 import org.openjdk.skara.vcs.openjdk.CommitMessageParsers;
  34 
  35 import java.io.IOException;
  36 import java.net.URI;
  37 import java.nio.charset.StandardCharsets;
  38 import java.nio.file.*;
  39 import java.util.*;
  40 import java.util.regex.Pattern;
  41 import java.util.concurrent.TimeUnit;
  42 import java.util.function.Supplier;
  43 import java.util.logging.Level;
  44 import java.util.stream.Collectors;
  45 
  46 public class GitPr {
  47     private static final StandardOpenOption APPEND = StandardOpenOption.APPEND;



  48 
  49     private static void exit(String fmt, Object...args) {
  50         System.err.println(String.format(fmt, args));
  51         System.exit(1);
  52     }
  53 
  54     private static &lt;T&gt; Supplier&lt;T&gt; die(String fmt, Object... args) {
  55         return () -&gt; {
  56             exit(fmt, args);
  57             return null;
  58         };
  59     }
  60 
  61     private static String gitConfig(String key) {
  62         try {
  63             var pb = new ProcessBuilder(&quot;git&quot;, &quot;config&quot;, key);
  64             pb.redirectOutput(ProcessBuilder.Redirect.PIPE);
  65             pb.redirectError(ProcessBuilder.Redirect.DISCARD);
  66             var p = pb.start();
  67 
</pre>
<hr />
<pre>
 118         return sectionSpecific != null &amp;&amp; sectionSpecific.toLowerCase().equals(&quot;true&quot;);
 119     }
 120 
 121     private static String rightPad(String s, int length) {
 122         return String.format(&quot;%-&quot; + length + &quot;s&quot;, s);
 123     }
 124 
 125     private static void appendPaddedHTMLComment(Path file, String line) throws IOException {
 126         var end = &quot; --&gt;&quot;;
 127         var pad = 79 - end.length();
 128         var newLine = &quot;\n&quot;;
 129         Files.writeString(file, rightPad(&quot;&lt;!-- &quot; + line, pad) + end + newLine, StandardOpenOption.APPEND);
 130     }
 131 
 132     private static String format(Issue issue) {
 133         var parts = issue.id().split(&quot;-&quot;);
 134         var id = parts.length == 2 ? parts[1] : issue.id();
 135         return id + &quot;: &quot; + issue.title();
 136     }
 137 



























 138     private static String jbsProjectFromJcheckConf(Repository repo) throws IOException {
 139         var conf = JCheckConfiguration.from(repo, repo.resolve(&quot;master&quot;).orElseThrow(() -&gt;
 140             new IOException(&quot;Could not resolve &#39;master&#39; branch&quot;)
 141         ));
 142 
 143         return conf.general().jbs();
 144     }
 145 
 146     private static Optional&lt;Issue&gt; getIssue(Commit commit, String project) throws IOException {
 147         var message = CommitMessageParsers.v1.parse(commit.message());
 148         var issues = message.issues();
 149         if (issues.isEmpty()) {
 150             return getIssue(message.title(), project);
 151         } else if (issues.size() == 1) {
 152             var issue = issues.get(0);
 153             return getIssue(issue.id(), project);
 154         }
 155         return Optional.empty();
 156     }
 157 
 158     private static Optional&lt;Issue&gt; getIssue(Branch b, String project) throws IOException {
 159         return getIssue(b.name(), project);
 160     }
 161 
 162     private static Optional&lt;Issue&gt; getIssue(String s, String project) throws IOException {
<span class="line-modified"> 163         var issueIdPattern = Pattern.compile(&quot;([A-Za-z][A-Za-z0-9]+)?-([0-9]+)&quot;);</span>
<span class="line-removed"> 164         var m = issueIdPattern.matcher(s);</span>
 165         if (m.matches()) {
 166             var id = m.group(2);
 167             if (project == null) {
 168                 project = m.group(1);
 169             }
 170             var issueTracker = IssueTracker.from(&quot;jira&quot;, URI.create(&quot;https://bugs.openjdk.java.net&quot;));
 171             return issueTracker.project(project).issue(id);
 172         }
 173 
 174         return Optional.empty();
 175     }
 176 
 177     private static void await(Process p) throws IOException {
 178         try {
 179             var res = p.waitFor();
 180             if (res != 0) {
 181                 throw new IOException(&quot;Unexpected exit code &quot; + res);
 182             }
 183         } catch (InterruptedException e) {
 184             throw new IOException(e);
</pre>
<hr />
<pre>
 359             Option.shortcut(&quot;b&quot;)
 360                   .fullname(&quot;branch&quot;)
 361                   .describe(&quot;NAME&quot;)
 362                   .helptext(&quot;Name of target branch, defaults to &#39;master&#39;&quot;)
 363                   .optional(),
 364             Option.shortcut(&quot;&quot;)
 365                   .fullname(&quot;authors&quot;)
 366                   .describe(&quot;LIST&quot;)
 367                   .helptext(&quot;Comma separated list of authors&quot;)
 368                   .optional(),
 369             Option.shortcut(&quot;&quot;)
 370                   .fullname(&quot;assignees&quot;)
 371                   .describe(&quot;LIST&quot;)
 372                   .helptext(&quot;Comma separated list of assignees&quot;)
 373                   .optional(),
 374             Option.shortcut(&quot;&quot;)
 375                   .fullname(&quot;labels&quot;)
 376                   .describe(&quot;LIST&quot;)
 377                   .helptext(&quot;Comma separated list of labels&quot;)
 378                   .optional(),





 379             Option.shortcut(&quot;&quot;)
 380                   .fullname(&quot;columns&quot;)
 381                   .describe(&quot;id,title,author,assignees,labels&quot;)
 382                   .helptext(&quot;Comma separated list of columns to show&quot;)
 383                   .optional(),
 384             Switch.shortcut(&quot;&quot;)
 385                   .fullname(&quot;no-decoration&quot;)
 386                   .helptext(&quot;Hide any decorations when listing PRs&quot;)
 387                   .optional(),
 388             Switch.shortcut(&quot;&quot;)
 389                   .fullname(&quot;ignore-workspace&quot;)
 390                   .helptext(&quot;Ignore local changes in worktree and staging area when creating pull request&quot;)
 391                   .optional(),
 392             Switch.shortcut(&quot;&quot;)
 393                   .fullname(&quot;ignore-local-commits&quot;)
 394                   .helptext(&quot;Ignore local commits not pushed when creating pull request&quot;)
 395                   .optional(),
 396             Switch.shortcut(&quot;&quot;)
 397                   .fullname(&quot;publish&quot;)
 398                   .helptext(&quot;Publish the local branch before creating the pull request&quot;)
</pre>
<hr />
<pre>
 914 
 915             var pr = getPullRequest(uri, repo, host, id);
 916 
 917             if (action.equals(&quot;integrate&quot;)) {
 918                 pr.addComment(&quot;/integrate&quot;);
 919             } else if (action.equals(&quot;test&quot;)) {
 920                 pr.addComment(&quot;/test&quot;);
 921             } else if (action.equals(&quot;approve&quot;)) {
 922                 pr.addReview(Review.Verdict.APPROVED, &quot;Looks good!&quot;);
 923             } else {
 924                 throw new IllegalStateException(&quot;unexpected action: &quot; + action);
 925             }
 926         } else if (action.equals(&quot;list&quot;)) {
 927             var remoteRepo = getHostedRepositoryFor(uri, repo, host);
 928             var prs = remoteRepo.pullRequests();
 929             var ids = new ArrayList&lt;String&gt;();
 930             var titles = new ArrayList&lt;String&gt;();
 931             var authors = new ArrayList&lt;String&gt;();
 932             var assignees = new ArrayList&lt;String&gt;();
 933             var labels = new ArrayList&lt;String&gt;();

 934 
 935             var authorsOption = getOption(&quot;authors&quot;, &quot;list&quot;, arguments);
 936             var filterAuthors = authorsOption == null ?
 937                 Set.of() :
 938                 new HashSet&lt;&gt;(Arrays.asList(authorsOption.split(&quot;,&quot;)));
 939 
 940             var assigneesOption = getOption(&quot;assignees&quot;, &quot;list&quot;, arguments);
 941             var filterAssignees = assigneesOption == null ?
 942                 Set.of() :
 943                 Arrays.asList(assigneesOption.split(&quot;,&quot;));
 944 
 945             var labelsOption = getOption(&quot;labels&quot;, &quot;list&quot;, arguments);
 946             var filterLabels = labelsOption == null ?
 947                 Set.of() :
 948                 Arrays.asList(labelsOption.split(&quot;,&quot;));
 949 
<span class="line-modified"> 950             var defaultColumns = List.of(&quot;id&quot;, &quot;title&quot;, &quot;authors&quot;, &quot;assignees&quot;, &quot;labels&quot;);</span>





 951             var columnValues = Map.of(defaultColumns.get(0), ids,
 952                                       defaultColumns.get(1), titles,
 953                                       defaultColumns.get(2), authors,
 954                                       defaultColumns.get(3), assignees,
<span class="line-modified"> 955                                       defaultColumns.get(4), labels);</span>

 956             var columnsOption = getOption(&quot;columns&quot;, &quot;list&quot;, arguments);
 957             var columns = columnsOption == null ?
 958                 defaultColumns :
 959                 Arrays.asList(columnsOption.split(&quot;,&quot;));
 960             if (columns != defaultColumns) {
 961                 for (var column : columns) {
 962                     if (!defaultColumns.contains(column)) {
 963                         System.err.println(&quot;error: unknown column: &quot; + column);
 964                         System.err.println(&quot;       available columns are: &quot; + String.join(&quot;,&quot;, defaultColumns));
 965                         System.exit(1);
 966                     }
 967                 }
 968             }
 969 
 970             for (var pr : prs) {
 971                 var prAuthor = pr.author().userName();
 972                 if (!filterAuthors.isEmpty() &amp;&amp; !filterAuthors.contains(prAuthor)) {
 973                     continue;
 974                 }
 975 
 976                 var prAssignees = pr.assignees().stream()
 977                                     .map(HostUser::userName)
 978                                     .collect(Collectors.toSet());
 979                 if (!filterAssignees.isEmpty() &amp;&amp; !filterAssignees.stream().anyMatch(prAssignees::contains)) {
 980                     continue;
 981                 }
 982 
 983                 var prLabels = new HashSet&lt;&gt;(pr.labels());
 984                 if (!filterLabels.isEmpty() &amp;&amp; !filterLabels.stream().anyMatch(prLabels::contains)) {
 985                     continue;
 986                 }
 987 






 988                 ids.add(pr.id());
 989                 titles.add(pr.title());
 990                 authors.add(prAuthor);
 991                 assignees.add(String.join(&quot;,&quot;, prAssignees));
 992                 labels.add(String.join(&quot;,&quot;, prLabels));

 993             }
 994 
 995 
 996             String fmt = &quot;&quot;;
 997             for (var column : columns.subList(0, columns.size() - 1)) {
 998                 var values = columnValues.get(column);
 999                 var n = Math.max(column.length(), longest(values));
1000                 fmt += &quot;%-&quot; + n + &quot;s\t&quot;;
1001             }
1002             fmt += &quot;%s\n&quot;;
1003 
1004             var noDecoration = getSwitch(&quot;no-decoration&quot;, &quot;list&quot;, arguments);
1005             if (!ids.isEmpty() &amp;&amp; !noDecoration) {
1006                 var upperCase = columns.stream()
1007                                        .map(String::toUpperCase)
1008                                        .collect(Collectors.toList());
1009                 System.out.format(fmt, (Object[]) upperCase.toArray(new String[0]));
1010             }
1011             for (var i = 0; i &lt; ids.size(); i++) {
1012                 final int n = i;
</pre>
</td>
<td>
<hr />
<pre>
  28 import org.openjdk.skara.issuetracker.IssueTracker;
  29 import org.openjdk.skara.issuetracker.Issue;
  30 import org.openjdk.skara.jcheck.JCheckConfiguration;
  31 import org.openjdk.skara.proxy.HttpProxy;
  32 import org.openjdk.skara.vcs.*;
  33 import org.openjdk.skara.vcs.openjdk.CommitMessageParsers;
  34 
  35 import java.io.IOException;
  36 import java.net.URI;
  37 import java.nio.charset.StandardCharsets;
  38 import java.nio.file.*;
  39 import java.util.*;
  40 import java.util.regex.Pattern;
  41 import java.util.concurrent.TimeUnit;
  42 import java.util.function.Supplier;
  43 import java.util.logging.Level;
  44 import java.util.stream.Collectors;
  45 
  46 public class GitPr {
  47     private static final StandardOpenOption APPEND = StandardOpenOption.APPEND;
<span class="line-added">  48     private static final Pattern ISSUE_ID_PATTERN = Pattern.compile(&quot;([A-Za-z][A-Za-z0-9]+)?-([0-9]+)&quot;);</span>
<span class="line-added">  49     private static final Pattern ISSUE_MARKDOWN_PATTERN =</span>
<span class="line-added">  50         Pattern.compile(&quot;^\\[([A-Z]+-[0-9]+)\\]\\(https:\\/\\/bugs.openjdk.java.net\\/browse\\/[A-Z]+-[0-9]+\\): .*$&quot;);</span>
  51 
  52     private static void exit(String fmt, Object...args) {
  53         System.err.println(String.format(fmt, args));
  54         System.exit(1);
  55     }
  56 
  57     private static &lt;T&gt; Supplier&lt;T&gt; die(String fmt, Object... args) {
  58         return () -&gt; {
  59             exit(fmt, args);
  60             return null;
  61         };
  62     }
  63 
  64     private static String gitConfig(String key) {
  65         try {
  66             var pb = new ProcessBuilder(&quot;git&quot;, &quot;config&quot;, key);
  67             pb.redirectOutput(ProcessBuilder.Redirect.PIPE);
  68             pb.redirectError(ProcessBuilder.Redirect.DISCARD);
  69             var p = pb.start();
  70 
</pre>
<hr />
<pre>
 121         return sectionSpecific != null &amp;&amp; sectionSpecific.toLowerCase().equals(&quot;true&quot;);
 122     }
 123 
 124     private static String rightPad(String s, int length) {
 125         return String.format(&quot;%-&quot; + length + &quot;s&quot;, s);
 126     }
 127 
 128     private static void appendPaddedHTMLComment(Path file, String line) throws IOException {
 129         var end = &quot; --&gt;&quot;;
 130         var pad = 79 - end.length();
 131         var newLine = &quot;\n&quot;;
 132         Files.writeString(file, rightPad(&quot;&lt;!-- &quot; + line, pad) + end + newLine, StandardOpenOption.APPEND);
 133     }
 134 
 135     private static String format(Issue issue) {
 136         var parts = issue.id().split(&quot;-&quot;);
 137         var id = parts.length == 2 ? parts[1] : issue.id();
 138         return id + &quot;: &quot; + issue.title();
 139     }
 140 
<span class="line-added"> 141     private static List&lt;String&gt; issuesFromPullRequest(PullRequest pr) {</span>
<span class="line-added"> 142         var issueTitleIndex = -1;</span>
<span class="line-added"> 143         var lines = pr.body().split(&quot;\n&quot;);</span>
<span class="line-added"> 144         for (var i = 0; i &lt; lines.length; i++) {</span>
<span class="line-added"> 145             if (lines[i].startsWith(&quot;## Issue&quot;)) {</span>
<span class="line-added"> 146                 issueTitleIndex = i;</span>
<span class="line-added"> 147                 break;</span>
<span class="line-added"> 148             }</span>
<span class="line-added"> 149         }</span>
<span class="line-added"> 150 </span>
<span class="line-added"> 151         if (issueTitleIndex == -1) {</span>
<span class="line-added"> 152             return List.of();</span>
<span class="line-added"> 153         }</span>
<span class="line-added"> 154 </span>
<span class="line-added"> 155         var issues = new ArrayList&lt;String&gt;();</span>
<span class="line-added"> 156         for (var i = issueTitleIndex + 1; i &lt; lines.length; i++) {</span>
<span class="line-added"> 157             var m = ISSUE_MARKDOWN_PATTERN.matcher(lines[i]);</span>
<span class="line-added"> 158             if (m.matches()) {</span>
<span class="line-added"> 159                 issues.add(m.group(1));</span>
<span class="line-added"> 160             } else {</span>
<span class="line-added"> 161                 break;</span>
<span class="line-added"> 162             }</span>
<span class="line-added"> 163         }</span>
<span class="line-added"> 164 </span>
<span class="line-added"> 165         return issues;</span>
<span class="line-added"> 166     }</span>
<span class="line-added"> 167 </span>
 168     private static String jbsProjectFromJcheckConf(Repository repo) throws IOException {
 169         var conf = JCheckConfiguration.from(repo, repo.resolve(&quot;master&quot;).orElseThrow(() -&gt;
 170             new IOException(&quot;Could not resolve &#39;master&#39; branch&quot;)
 171         ));
 172 
 173         return conf.general().jbs();
 174     }
 175 
 176     private static Optional&lt;Issue&gt; getIssue(Commit commit, String project) throws IOException {
 177         var message = CommitMessageParsers.v1.parse(commit.message());
 178         var issues = message.issues();
 179         if (issues.isEmpty()) {
 180             return getIssue(message.title(), project);
 181         } else if (issues.size() == 1) {
 182             var issue = issues.get(0);
 183             return getIssue(issue.id(), project);
 184         }
 185         return Optional.empty();
 186     }
 187 
 188     private static Optional&lt;Issue&gt; getIssue(Branch b, String project) throws IOException {
 189         return getIssue(b.name(), project);
 190     }
 191 
 192     private static Optional&lt;Issue&gt; getIssue(String s, String project) throws IOException {
<span class="line-modified"> 193         var m = ISSUE_ID_PATTERN.matcher(s);</span>

 194         if (m.matches()) {
 195             var id = m.group(2);
 196             if (project == null) {
 197                 project = m.group(1);
 198             }
 199             var issueTracker = IssueTracker.from(&quot;jira&quot;, URI.create(&quot;https://bugs.openjdk.java.net&quot;));
 200             return issueTracker.project(project).issue(id);
 201         }
 202 
 203         return Optional.empty();
 204     }
 205 
 206     private static void await(Process p) throws IOException {
 207         try {
 208             var res = p.waitFor();
 209             if (res != 0) {
 210                 throw new IOException(&quot;Unexpected exit code &quot; + res);
 211             }
 212         } catch (InterruptedException e) {
 213             throw new IOException(e);
</pre>
<hr />
<pre>
 388             Option.shortcut(&quot;b&quot;)
 389                   .fullname(&quot;branch&quot;)
 390                   .describe(&quot;NAME&quot;)
 391                   .helptext(&quot;Name of target branch, defaults to &#39;master&#39;&quot;)
 392                   .optional(),
 393             Option.shortcut(&quot;&quot;)
 394                   .fullname(&quot;authors&quot;)
 395                   .describe(&quot;LIST&quot;)
 396                   .helptext(&quot;Comma separated list of authors&quot;)
 397                   .optional(),
 398             Option.shortcut(&quot;&quot;)
 399                   .fullname(&quot;assignees&quot;)
 400                   .describe(&quot;LIST&quot;)
 401                   .helptext(&quot;Comma separated list of assignees&quot;)
 402                   .optional(),
 403             Option.shortcut(&quot;&quot;)
 404                   .fullname(&quot;labels&quot;)
 405                   .describe(&quot;LIST&quot;)
 406                   .helptext(&quot;Comma separated list of labels&quot;)
 407                   .optional(),
<span class="line-added"> 408             Option.shortcut(&quot;&quot;)</span>
<span class="line-added"> 409                   .fullname(&quot;issues&quot;)</span>
<span class="line-added"> 410                   .describe(&quot;LIST&quot;)</span>
<span class="line-added"> 411                   .helptext(&quot;Comma separated list of issues&quot;)</span>
<span class="line-added"> 412                   .optional(),</span>
 413             Option.shortcut(&quot;&quot;)
 414                   .fullname(&quot;columns&quot;)
 415                   .describe(&quot;id,title,author,assignees,labels&quot;)
 416                   .helptext(&quot;Comma separated list of columns to show&quot;)
 417                   .optional(),
 418             Switch.shortcut(&quot;&quot;)
 419                   .fullname(&quot;no-decoration&quot;)
 420                   .helptext(&quot;Hide any decorations when listing PRs&quot;)
 421                   .optional(),
 422             Switch.shortcut(&quot;&quot;)
 423                   .fullname(&quot;ignore-workspace&quot;)
 424                   .helptext(&quot;Ignore local changes in worktree and staging area when creating pull request&quot;)
 425                   .optional(),
 426             Switch.shortcut(&quot;&quot;)
 427                   .fullname(&quot;ignore-local-commits&quot;)
 428                   .helptext(&quot;Ignore local commits not pushed when creating pull request&quot;)
 429                   .optional(),
 430             Switch.shortcut(&quot;&quot;)
 431                   .fullname(&quot;publish&quot;)
 432                   .helptext(&quot;Publish the local branch before creating the pull request&quot;)
</pre>
<hr />
<pre>
 948 
 949             var pr = getPullRequest(uri, repo, host, id);
 950 
 951             if (action.equals(&quot;integrate&quot;)) {
 952                 pr.addComment(&quot;/integrate&quot;);
 953             } else if (action.equals(&quot;test&quot;)) {
 954                 pr.addComment(&quot;/test&quot;);
 955             } else if (action.equals(&quot;approve&quot;)) {
 956                 pr.addReview(Review.Verdict.APPROVED, &quot;Looks good!&quot;);
 957             } else {
 958                 throw new IllegalStateException(&quot;unexpected action: &quot; + action);
 959             }
 960         } else if (action.equals(&quot;list&quot;)) {
 961             var remoteRepo = getHostedRepositoryFor(uri, repo, host);
 962             var prs = remoteRepo.pullRequests();
 963             var ids = new ArrayList&lt;String&gt;();
 964             var titles = new ArrayList&lt;String&gt;();
 965             var authors = new ArrayList&lt;String&gt;();
 966             var assignees = new ArrayList&lt;String&gt;();
 967             var labels = new ArrayList&lt;String&gt;();
<span class="line-added"> 968             var issues = new ArrayList&lt;String&gt;();</span>
 969 
 970             var authorsOption = getOption(&quot;authors&quot;, &quot;list&quot;, arguments);
 971             var filterAuthors = authorsOption == null ?
 972                 Set.of() :
 973                 new HashSet&lt;&gt;(Arrays.asList(authorsOption.split(&quot;,&quot;)));
 974 
 975             var assigneesOption = getOption(&quot;assignees&quot;, &quot;list&quot;, arguments);
 976             var filterAssignees = assigneesOption == null ?
 977                 Set.of() :
 978                 Arrays.asList(assigneesOption.split(&quot;,&quot;));
 979 
 980             var labelsOption = getOption(&quot;labels&quot;, &quot;list&quot;, arguments);
 981             var filterLabels = labelsOption == null ?
 982                 Set.of() :
 983                 Arrays.asList(labelsOption.split(&quot;,&quot;));
 984 
<span class="line-modified"> 985             var issuesOption = getOption(&quot;issues&quot;, &quot;list&quot;, arguments);</span>
<span class="line-added"> 986             var filterIssues = issuesOption == null ?</span>
<span class="line-added"> 987                 Set.of() :</span>
<span class="line-added"> 988                 Arrays.asList(issuesOption.split(&quot;,&quot;));</span>
<span class="line-added"> 989 </span>
<span class="line-added"> 990             var defaultColumns = List.of(&quot;id&quot;, &quot;title&quot;, &quot;authors&quot;, &quot;assignees&quot;, &quot;labels&quot;, &quot;issues&quot;);</span>
 991             var columnValues = Map.of(defaultColumns.get(0), ids,
 992                                       defaultColumns.get(1), titles,
 993                                       defaultColumns.get(2), authors,
 994                                       defaultColumns.get(3), assignees,
<span class="line-modified"> 995                                       defaultColumns.get(4), labels,</span>
<span class="line-added"> 996                                       defaultColumns.get(5), issues);</span>
 997             var columnsOption = getOption(&quot;columns&quot;, &quot;list&quot;, arguments);
 998             var columns = columnsOption == null ?
 999                 defaultColumns :
1000                 Arrays.asList(columnsOption.split(&quot;,&quot;));
1001             if (columns != defaultColumns) {
1002                 for (var column : columns) {
1003                     if (!defaultColumns.contains(column)) {
1004                         System.err.println(&quot;error: unknown column: &quot; + column);
1005                         System.err.println(&quot;       available columns are: &quot; + String.join(&quot;,&quot;, defaultColumns));
1006                         System.exit(1);
1007                     }
1008                 }
1009             }
1010 
1011             for (var pr : prs) {
1012                 var prAuthor = pr.author().userName();
1013                 if (!filterAuthors.isEmpty() &amp;&amp; !filterAuthors.contains(prAuthor)) {
1014                     continue;
1015                 }
1016 
1017                 var prAssignees = pr.assignees().stream()
1018                                     .map(HostUser::userName)
1019                                     .collect(Collectors.toSet());
1020                 if (!filterAssignees.isEmpty() &amp;&amp; !filterAssignees.stream().anyMatch(prAssignees::contains)) {
1021                     continue;
1022                 }
1023 
1024                 var prLabels = new HashSet&lt;&gt;(pr.labels());
1025                 if (!filterLabels.isEmpty() &amp;&amp; !filterLabels.stream().anyMatch(prLabels::contains)) {
1026                     continue;
1027                 }
1028 
<span class="line-added">1029                 var prIssues = new HashSet&lt;&gt;(issuesFromPullRequest(pr));</span>
<span class="line-added">1030                 if (!filterIssues.isEmpty() &amp;&amp; !filterIssues.stream().anyMatch(prIssues::contains)) {</span>
<span class="line-added">1031                     continue;</span>
<span class="line-added">1032                 }</span>
<span class="line-added">1033 </span>
<span class="line-added">1034 </span>
1035                 ids.add(pr.id());
1036                 titles.add(pr.title());
1037                 authors.add(prAuthor);
1038                 assignees.add(String.join(&quot;,&quot;, prAssignees));
1039                 labels.add(String.join(&quot;,&quot;, prLabels));
<span class="line-added">1040                 issues.add(String.join(&quot;,&quot;, prIssues));</span>
1041             }
1042 
1043 
1044             String fmt = &quot;&quot;;
1045             for (var column : columns.subList(0, columns.size() - 1)) {
1046                 var values = columnValues.get(column);
1047                 var n = Math.max(column.length(), longest(values));
1048                 fmt += &quot;%-&quot; + n + &quot;s\t&quot;;
1049             }
1050             fmt += &quot;%s\n&quot;;
1051 
1052             var noDecoration = getSwitch(&quot;no-decoration&quot;, &quot;list&quot;, arguments);
1053             if (!ids.isEmpty() &amp;&amp; !noDecoration) {
1054                 var upperCase = columns.stream()
1055                                        .map(String::toUpperCase)
1056                                        .collect(Collectors.toList());
1057                 System.out.format(fmt, (Object[]) upperCase.toArray(new String[0]));
1058             }
1059             for (var i = 0; i &lt; ids.size(); i++) {
1060                 final int n = i;
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>