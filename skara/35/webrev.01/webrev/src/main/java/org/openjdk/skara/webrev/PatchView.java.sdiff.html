<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff webrev/src/main/java/org/openjdk/skara/webrev/PatchView.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AddedPatchView.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RemovedPatchView.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>webrev/src/main/java/org/openjdk/skara/webrev/PatchView.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 39     public PatchView(Path out, Path file, TextualPatch patch, List&lt;String&gt; sourceContent, List&lt;String&gt; destContent) {
 40         this.out = out;
 41         this.file = file;
 42         this.patch = patch;
 43         this.sourceContent = sourceContent;
 44         this.destContent = destContent;
 45     }
 46 
 47     private void writeLine(Writer w, String prepend, Line line) throws IOException {
 48         w.write(prepend);
 49         w.write(line.text());
 50         w.write(&quot;\n&quot;);
 51     }
 52 
 53     public void render(Writer w) throws IOException {
 54         var patchFile = out.resolve(file.toString() + &quot;.patch&quot;);
 55         Files.createDirectories(patchFile.getParent());
 56 
 57         try (var fw = Files.newBufferedWriter(patchFile)) {
 58             fw.write(&quot;diff a/&quot;);
<span class="line-modified"> 59             fw.write(patch.source().path().get().toString());</span>
 60             fw.write(&quot; b/&quot;);
<span class="line-modified"> 61             fw.write(patch.target().path().get().toString());</span>
 62             fw.write(&quot;\n&quot;);
 63             fw.write(&quot;--- a/&quot;);
<span class="line-modified"> 64             fw.write(patch.source().path().get().toString());</span>
 65             fw.write(&quot;\n&quot;);
 66             fw.write(&quot;+++ b/&quot;);
<span class="line-modified"> 67             fw.write(patch.target().path().get().toString());</span>
 68             fw.write(&quot;\n&quot;);
 69 
 70             var coalescer = new HunkCoalescer(NUM_CONTEXT_LINES, sourceContent, destContent);
 71             for (var group : coalescer.coalesce(patch.hunks())) {
 72                 var sourceRange = group.header().source();
 73                 var destRange = group.header().target();
 74 
 75                 fw.write(&quot;@@ -&quot;);
 76                 fw.write(String.valueOf(sourceRange.start()));
 77                 fw.write(&quot;,&quot;);
 78                 fw.write(String.valueOf(sourceRange.count()));
 79                 fw.write(&quot; +&quot;);
 80                 fw.write(String.valueOf(destRange.start()));
 81                 fw.write(&quot;,&quot;);
 82                 fw.write(String.valueOf(destRange.count()));
 83                 fw.write(&quot; @@\n&quot;);
 84 
 85                 for (var line : group.contextBefore().sourceLines()) {
 86                     writeLine(fw, &quot; &quot;, line);
 87                 }
</pre>
</td>
<td>
<hr />
<pre>
 39     public PatchView(Path out, Path file, TextualPatch patch, List&lt;String&gt; sourceContent, List&lt;String&gt; destContent) {
 40         this.out = out;
 41         this.file = file;
 42         this.patch = patch;
 43         this.sourceContent = sourceContent;
 44         this.destContent = destContent;
 45     }
 46 
 47     private void writeLine(Writer w, String prepend, Line line) throws IOException {
 48         w.write(prepend);
 49         w.write(line.text());
 50         w.write(&quot;\n&quot;);
 51     }
 52 
 53     public void render(Writer w) throws IOException {
 54         var patchFile = out.resolve(file.toString() + &quot;.patch&quot;);
 55         Files.createDirectories(patchFile.getParent());
 56 
 57         try (var fw = Files.newBufferedWriter(patchFile)) {
 58             fw.write(&quot;diff a/&quot;);
<span class="line-modified"> 59             fw.write(ViewUtils.pathWithUnixSeps(patch.source().path().get()));</span>
 60             fw.write(&quot; b/&quot;);
<span class="line-modified"> 61             fw.write(ViewUtils.pathWithUnixSeps(patch.target().path().get()));</span>
 62             fw.write(&quot;\n&quot;);
 63             fw.write(&quot;--- a/&quot;);
<span class="line-modified"> 64             fw.write(ViewUtils.pathWithUnixSeps(patch.source().path().get()));</span>
 65             fw.write(&quot;\n&quot;);
 66             fw.write(&quot;+++ b/&quot;);
<span class="line-modified"> 67             fw.write(ViewUtils.pathWithUnixSeps(patch.target().path().get()));</span>
 68             fw.write(&quot;\n&quot;);
 69 
 70             var coalescer = new HunkCoalescer(NUM_CONTEXT_LINES, sourceContent, destContent);
 71             for (var group : coalescer.coalesce(patch.hunks())) {
 72                 var sourceRange = group.header().source();
 73                 var destRange = group.header().target();
 74 
 75                 fw.write(&quot;@@ -&quot;);
 76                 fw.write(String.valueOf(sourceRange.start()));
 77                 fw.write(&quot;,&quot;);
 78                 fw.write(String.valueOf(sourceRange.count()));
 79                 fw.write(&quot; +&quot;);
 80                 fw.write(String.valueOf(destRange.start()));
 81                 fw.write(&quot;,&quot;);
 82                 fw.write(String.valueOf(destRange.count()));
 83                 fw.write(&quot; @@\n&quot;);
 84 
 85                 for (var line : group.contextBefore().sourceLines()) {
 86                     writeLine(fw, &quot; &quot;, line);
 87                 }
</pre>
</td>
</tr>
</table>
<center><a href="AddedPatchView.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RemovedPatchView.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>