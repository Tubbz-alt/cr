<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/pr/src/main/java/org/openjdk/skara/bots/pr/CheckRun.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SponsorCommand.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/pr/src/main/java/org/openjdk/skara/bots/pr/CheckRun.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
475             }
476 
477             var commit = prInstance.localRepo().lookup(localHash).orElseThrow();
478             var commitMessage = String.join(&quot;\n&quot;, commit.message());
479             var readyForIntegration = visitor.getMessages().isEmpty() &amp;&amp; additionalErrors.isEmpty();
480             updateMergeReadyComment(readyForIntegration, commitMessage, comments, activeReviews, rebasePossible);
481             if (readyForIntegration) {
482                 newLabels.add(&quot;ready&quot;);
483             } else {
484                 newLabels.remove(&quot;ready&quot;);
485             }
486             if (!rebasePossible) {
487                 newLabels.add(&quot;outdated&quot;);
488             } else {
489                 newLabels.remove(&quot;outdated&quot;);
490             }
491 
492             // Ensure that the ready for sponsor label is up to date
493             newLabels.remove(&quot;sponsor&quot;);
494             var readyHash = ReadyForSponsorTracker.latestReadyForSponsor(pr.repository().host().getCurrentUserDetails(), comments);
<span class="line-modified">495             if (readyHash.isPresent()) {</span>
496                 var acceptedHash = readyHash.get();
497                 if (pr.getHeadHash().equals(acceptedHash)) {
498                     newLabels.add(&quot;sponsor&quot;);
499                 }
500             }
501 
502             // Calculate current metadata to avoid unnecessary future checks
503             var metadata = workItem.getMetadata(pr.getTitle(), updatedBody, pr.getComments(), activeReviews, newLabels, censusInstance, pr.getTargetHash());
504             checkBuilder.metadata(metadata);
505         } catch (Exception e) {
506             log.throwing(&quot;CommitChecker&quot;, &quot;checkStatus&quot;, e);
507             newLabels.remove(&quot;ready&quot;);
508             var metadata = workItem.getMetadata(pr.getTitle(), pr.getBody(), pr.getComments(), activeReviews, newLabels, censusInstance, pr.getTargetHash());
509             checkBuilder.metadata(metadata);
510             checkBuilder.title(&quot;Exception occurred during jcheck&quot;);
511             checkBuilder.summary(e.getMessage());
512             checkBuilder.complete(false);
513         }
514         var check = checkBuilder.build();
515         pr.updateCheck(check);
</pre>
</td>
<td>
<hr />
<pre>
475             }
476 
477             var commit = prInstance.localRepo().lookup(localHash).orElseThrow();
478             var commitMessage = String.join(&quot;\n&quot;, commit.message());
479             var readyForIntegration = visitor.getMessages().isEmpty() &amp;&amp; additionalErrors.isEmpty();
480             updateMergeReadyComment(readyForIntegration, commitMessage, comments, activeReviews, rebasePossible);
481             if (readyForIntegration) {
482                 newLabels.add(&quot;ready&quot;);
483             } else {
484                 newLabels.remove(&quot;ready&quot;);
485             }
486             if (!rebasePossible) {
487                 newLabels.add(&quot;outdated&quot;);
488             } else {
489                 newLabels.remove(&quot;outdated&quot;);
490             }
491 
492             // Ensure that the ready for sponsor label is up to date
493             newLabels.remove(&quot;sponsor&quot;);
494             var readyHash = ReadyForSponsorTracker.latestReadyForSponsor(pr.repository().host().getCurrentUserDetails(), comments);
<span class="line-modified">495             if (readyHash.isPresent() &amp;&amp; readyForIntegration) {</span>
496                 var acceptedHash = readyHash.get();
497                 if (pr.getHeadHash().equals(acceptedHash)) {
498                     newLabels.add(&quot;sponsor&quot;);
499                 }
500             }
501 
502             // Calculate current metadata to avoid unnecessary future checks
503             var metadata = workItem.getMetadata(pr.getTitle(), updatedBody, pr.getComments(), activeReviews, newLabels, censusInstance, pr.getTargetHash());
504             checkBuilder.metadata(metadata);
505         } catch (Exception e) {
506             log.throwing(&quot;CommitChecker&quot;, &quot;checkStatus&quot;, e);
507             newLabels.remove(&quot;ready&quot;);
508             var metadata = workItem.getMetadata(pr.getTitle(), pr.getBody(), pr.getComments(), activeReviews, newLabels, censusInstance, pr.getTargetHash());
509             checkBuilder.metadata(metadata);
510             checkBuilder.title(&quot;Exception occurred during jcheck&quot;);
511             checkBuilder.summary(e.getMessage());
512             checkBuilder.complete(false);
513         }
514         var check = checkBuilder.build();
515         pr.updateCheck(check);
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="SponsorCommand.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>