<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/main/java/org/openjdk/skara/vcs/openjdk/convert/GitToHgConverter.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../../gradlew.bat.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>vcs/src/main/java/org/openjdk/skara/vcs/openjdk/convert/GitToHgConverter.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package org.openjdk.skara.vcs.openjdk.convert;
 24 
 25 import org.openjdk.skara.vcs.*;
 26 import org.openjdk.skara.vcs.openjdk.*;
 27 import java.io.IOException;
 28 import java.nio.file.*;
 29 import java.nio.charset.StandardCharsets;
 30 import java.net.URI;

 31 import java.util.*;
 32 import java.util.stream.Collectors;
 33 import java.util.logging.Logger;
 34 
 35 public class GitToHgConverter implements Converter {
 36     private final Logger log = Logger.getLogger(&quot;org.openjdk.skara.vcs.openjdk.convert&quot;);
 37 
 38     private String convertMessage(CommitMessage message, Author author, Author committer) {
 39         var sb = new StringBuilder();
 40         sb.append(message.title());
 41         sb.append(&quot;\n&quot;);
 42 
 43         var summaries = message.summaries();
 44         if (!summaries.isEmpty()) {
 45             sb.append(&quot;Summary: &quot;);
 46             sb.append(String.join(&quot; &quot;, summaries));
 47             sb.append(&quot;\n&quot;);
 48         }
 49 
 50         var reviewers = message.reviewers();
</pre>
<hr />
<pre>
121                 hgRepo.move(entry.source().path().orElseThrow(), entry.target().path().orElseThrow());
122                 toDump.add(entry.target().path().orElseThrow());
123             } else if (status.isCopied()) {
124                 hgRepo.copy(entry.source().path().orElseThrow(), entry.target().path().orElseThrow());
125                 toDump.add(entry.target().path().orElseThrow());
126             } else if (status.isModified() || status.isAdded()) {
127                 var targetPath = entry.target().path().orElseThrow();
128                 toDump.add(targetPath);
129                 if (status.isAdded()) {
130                     toAdd.add(targetPath);
131                 }
132             } else {
133                 throw new IOException(&quot;Unexpected status: &quot; + status.toString());
134             }
135         }
136 
137         if (toDump.size() &gt; 0) {
138             for (var file : gitRepo.files(to, toDump)) {
139                 var hgPath = hgRoot.resolve(file.path());
140                 gitRepo.dump(file, hgPath);
<span class="line-modified">141                 Files.setPosixFilePermissions(hgPath, file.type().permissions().orElseThrow());</span>


142             }
143         }
144 
145         if (toAdd.size() &gt; 0) {
146             hgRepo.add(toAdd);
147         }
148 
149         if (toRemove.size() &gt; 0) {
150             hgRepo.remove(toRemove);
151         }
152     }
153 
154     private boolean changesHgTags(Commit c) {
155         for (var diff : c.parentDiffs()) {
156             for (var patch : diff.patches()) {
157                 var status = patch.status();
158                 if ((status.isModified() || status.isAdded()) &amp;&amp;
159                     patch.target().path().orElseThrow().toString().equals(&quot;.hgtags&quot;)) {
160                     return true;
161                 }
</pre>
</td>
<td>
<hr />
<pre>
 11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 12  * version 2 for more details (a copy is included in the LICENSE file that
 13  * accompanied this code).
 14  *
 15  * You should have received a copy of the GNU General Public License version
 16  * 2 along with this work; if not, write to the Free Software Foundation,
 17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 18  *
 19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 20  * or visit www.oracle.com if you need additional information or have any
 21  * questions.
 22  */
 23 package org.openjdk.skara.vcs.openjdk.convert;
 24 
 25 import org.openjdk.skara.vcs.*;
 26 import org.openjdk.skara.vcs.openjdk.*;
 27 import java.io.IOException;
 28 import java.nio.file.*;
 29 import java.nio.charset.StandardCharsets;
 30 import java.net.URI;
<span class="line-added"> 31 import java.nio.file.attribute.PosixFilePermissions;</span>
 32 import java.util.*;
 33 import java.util.stream.Collectors;
 34 import java.util.logging.Logger;
 35 
 36 public class GitToHgConverter implements Converter {
 37     private final Logger log = Logger.getLogger(&quot;org.openjdk.skara.vcs.openjdk.convert&quot;);
 38 
 39     private String convertMessage(CommitMessage message, Author author, Author committer) {
 40         var sb = new StringBuilder();
 41         sb.append(message.title());
 42         sb.append(&quot;\n&quot;);
 43 
 44         var summaries = message.summaries();
 45         if (!summaries.isEmpty()) {
 46             sb.append(&quot;Summary: &quot;);
 47             sb.append(String.join(&quot; &quot;, summaries));
 48             sb.append(&quot;\n&quot;);
 49         }
 50 
 51         var reviewers = message.reviewers();
</pre>
<hr />
<pre>
122                 hgRepo.move(entry.source().path().orElseThrow(), entry.target().path().orElseThrow());
123                 toDump.add(entry.target().path().orElseThrow());
124             } else if (status.isCopied()) {
125                 hgRepo.copy(entry.source().path().orElseThrow(), entry.target().path().orElseThrow());
126                 toDump.add(entry.target().path().orElseThrow());
127             } else if (status.isModified() || status.isAdded()) {
128                 var targetPath = entry.target().path().orElseThrow();
129                 toDump.add(targetPath);
130                 if (status.isAdded()) {
131                     toAdd.add(targetPath);
132                 }
133             } else {
134                 throw new IOException(&quot;Unexpected status: &quot; + status.toString());
135             }
136         }
137 
138         if (toDump.size() &gt; 0) {
139             for (var file : gitRepo.files(to, toDump)) {
140                 var hgPath = hgRoot.resolve(file.path());
141                 gitRepo.dump(file, hgPath);
<span class="line-modified">142                 if (hgPath.getFileSystem().supportedFileAttributeViews().contains(&quot;posix&quot;)) {</span>
<span class="line-added">143                     Files.setPosixFilePermissions(hgPath, file.type().permissions().orElseThrow());</span>
<span class="line-added">144                 }</span>
145             }
146         }
147 
148         if (toAdd.size() &gt; 0) {
149             hgRepo.add(toAdd);
150         }
151 
152         if (toRemove.size() &gt; 0) {
153             hgRepo.remove(toRemove);
154         }
155     }
156 
157     private boolean changesHgTags(Commit c) {
158         for (var diff : c.parentDiffs()) {
159             for (var patch : diff.patches()) {
160                 var status = patch.status();
161                 if ((status.isModified() || status.isAdded()) &amp;&amp;
162                     patch.target().path().orElseThrow().toString().equals(&quot;.hgtags&quot;)) {
163                     return true;
164                 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../../../gradlew.bat.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../test/java/org/openjdk/skara/vcs/RepositoryTests.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>