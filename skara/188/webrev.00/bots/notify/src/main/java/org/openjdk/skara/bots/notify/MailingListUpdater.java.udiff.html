<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff bots/notify/src/main/java/org/openjdk/skara/bots/notify/MailingListUpdater.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JNotifyBotFactory.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/notify/UpdaterTests.java.udiff.html" target="_top">next &gt;</a></center>    <h2>bots/notify/src/main/java/org/openjdk/skara/bots/notify/MailingListUpdater.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -95,10 +95,15 @@</span>
          }
  
          return writer.toString();
      }
  
<span class="udiff-line-added">+     private EmailAddress commitsToSender(List&lt;Commit&gt; commits) {</span>
<span class="udiff-line-added">+         var commit = commits.get(commits.size() - 1);</span>
<span class="udiff-line-added">+         return EmailAddress.from(commit.committer().name(), commit.committer().email());</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      private String commitsToSubject(HostedRepository repository, List&lt;Commit&gt; commits, Branch branch) {
          var subject = new StringBuilder();
          subject.append(repository.getRepositoryType().shortName());
          subject.append(&quot;: &quot;);
          subject.append(repository.getName());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -143,13 +148,14 @@</span>
                  log.warning(&quot;Pull request &quot; + prLink + &quot; found in &quot; + rfrCandidates.size() + &quot; RFR threads - expected 1&quot;);
                  ret.add(commit);
                  continue;
              }
              var rfr = rfrCandidates.get(0);
<span class="udiff-line-added">+             var author = sender != null ? sender : commitsToSender(commits);</span>
              var body = commitToText(repository, commit);
              var email = Email.reply(rfr, &quot;Re: [Integrated] &quot; + rfr.subject(), body)
<span class="udiff-line-modified-removed">-                              .author(sender)</span>
<span class="udiff-line-modified-added">+                              .author(author)</span>
                               .recipient(recipient)
                               .headers(headers)
                               .build();
              list.post(email);
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -168,11 +174,13 @@</span>
          for (var commit : commits) {
              printer.println(commitToText(repository, commit));
          }
  
          var subject = commitsToSubject(repository, commits, branch);
<span class="udiff-line-modified-removed">-         var email = Email.create(sender, subject, writer.toString())</span>
<span class="udiff-line-modified-added">+         var author = sender != null ? sender : commitsToSender(commits);</span>
<span class="udiff-line-added">+         var email = Email.create(subject, writer.toString())</span>
<span class="udiff-line-added">+                          .author(author)</span>
                           .recipient(recipient)
                           .headers(headers)
                           .build();
  
          list.post(email);
</pre>
<center><a href="JNotifyBotFactory.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/java/org/openjdk/skara/bots/notify/UpdaterTests.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>