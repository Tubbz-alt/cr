<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff issuetracker/src/main/java/org/openjdk/skara/issuetracker/jira/JiraIssue.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>issuetracker/src/main/java/org/openjdk/skara/issuetracker/jira/JiraIssue.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
122     }
123 
124     @Override
125     public Comment updateComment(String id, String body) {
126         var json = request.put(&quot;/comment/&quot; + id)
127                           .body(&quot;body&quot;, body)
128                           .execute();
129         return parseComment(json);
130     }
131 
132     @Override
133     public ZonedDateTime createdAt() {
134         return ZonedDateTime.parse(json.get(&quot;fields&quot;).get(&quot;created&quot;).asString(), dateFormat);
135     }
136 
137     @Override
138     public ZonedDateTime updatedAt() {
139         return ZonedDateTime.parse(json.get(&quot;fields&quot;).get(&quot;updated&quot;).asString(), dateFormat);
140     }
141 
<span class="line-removed">142     private String stateName(State state) {</span>
<span class="line-removed">143         switch (state) {</span>
<span class="line-removed">144             case OPEN:</span>
<span class="line-removed">145                 return &quot;Open&quot;;</span>
<span class="line-removed">146             case RESOLVED:</span>
<span class="line-removed">147                 return &quot;Resolved&quot;;</span>
<span class="line-removed">148             case CLOSED:</span>
<span class="line-removed">149                 return &quot;Closed&quot;;</span>
<span class="line-removed">150             default:</span>
<span class="line-removed">151                 throw new IllegalStateException(&quot;Unknown state &quot; + state);</span>
<span class="line-removed">152         }</span>
<span class="line-removed">153     }</span>
<span class="line-removed">154 </span>
155     private Map&lt;String, String&gt; availableTransitions() {
156         var transitions = request.get(&quot;/transitions&quot;).execute();
157         return transitions.get(&quot;transitions&quot;).stream()
158                           .collect(Collectors.toMap(v -&gt; v.get(&quot;to&quot;).get(&quot;name&quot;).asString(),
159                                                     v -&gt; v.get(&quot;id&quot;).asString()));
160     }
161 
162     private void performTransition(String id) {
163         var query = JSON.object()
164                         .put(&quot;transition&quot;, JSON.object()
165                                                .put(&quot;id&quot;, id));
166         request.post(&quot;/transitions&quot;)
167                .body(query)
168                .execute();
169     }
170 
171     @Override
172     public void setState(State state) {
173         var availableTransitions = availableTransitions();
174 
</pre>
<hr />
<pre>
188             }
189             performTransition(availableTransitions.get(&quot;Resolved&quot;));
190         } else if (state == State.CLOSED) {
191             if (!availableTransitions.containsKey(&quot;Closed&quot;)) {
192                 if (availableTransitions.containsKey(&quot;Resolved&quot;)) {
193                     performTransition(availableTransitions.get(&quot;Resolved&quot;));
194                     availableTransitions = availableTransitions();
195                     if (!availableTransitions.containsKey(&quot;Closed&quot;)) {
196                         throw new RuntimeException(&quot;Cannot transition to Closed after Resolved&quot;);
197                     }
198                 } else {
199                     throw new RuntimeException(&quot;Cannot transition to Closed&quot;);
200                 }
201                 performTransition(availableTransitions.get(&quot;Closed&quot;));
202             }
203         } else if (state == State.OPEN) {
204             if (!availableTransitions.containsKey(&quot;Open&quot;)) {
205                 throw new RuntimeException(&quot;Cannot transition to Open&quot;);
206             }
207             performTransition(availableTransitions.get(&quot;Open&quot;));


208         }
209     }
210 
211     @Override
212     public void addLabel(String label) {
213         var query = JSON.object()
214                         .put(&quot;update&quot;, JSON.object()
215                                            .put(&quot;labels&quot;, JSON.array().add(JSON.object()
216                                                                                .put(&quot;add&quot;, label))));
217         request.put(&quot;&quot;).body(query).execute();
218     }
219 
220     @Override
221     public void removeLabel(String label) {
222         var query = JSON.object()
223                         .put(&quot;update&quot;, JSON.object()
224                                            .put(&quot;labels&quot;, JSON.array().add(JSON.object()
225                                                                                .put(&quot;remove&quot;, label))));
226         request.put(&quot;&quot;).body(query).execute();
227     }
</pre>
</td>
<td>
<hr />
<pre>
122     }
123 
124     @Override
125     public Comment updateComment(String id, String body) {
126         var json = request.put(&quot;/comment/&quot; + id)
127                           .body(&quot;body&quot;, body)
128                           .execute();
129         return parseComment(json);
130     }
131 
132     @Override
133     public ZonedDateTime createdAt() {
134         return ZonedDateTime.parse(json.get(&quot;fields&quot;).get(&quot;created&quot;).asString(), dateFormat);
135     }
136 
137     @Override
138     public ZonedDateTime updatedAt() {
139         return ZonedDateTime.parse(json.get(&quot;fields&quot;).get(&quot;updated&quot;).asString(), dateFormat);
140     }
141 













142     private Map&lt;String, String&gt; availableTransitions() {
143         var transitions = request.get(&quot;/transitions&quot;).execute();
144         return transitions.get(&quot;transitions&quot;).stream()
145                           .collect(Collectors.toMap(v -&gt; v.get(&quot;to&quot;).get(&quot;name&quot;).asString(),
146                                                     v -&gt; v.get(&quot;id&quot;).asString()));
147     }
148 
149     private void performTransition(String id) {
150         var query = JSON.object()
151                         .put(&quot;transition&quot;, JSON.object()
152                                                .put(&quot;id&quot;, id));
153         request.post(&quot;/transitions&quot;)
154                .body(query)
155                .execute();
156     }
157 
158     @Override
159     public void setState(State state) {
160         var availableTransitions = availableTransitions();
161 
</pre>
<hr />
<pre>
175             }
176             performTransition(availableTransitions.get(&quot;Resolved&quot;));
177         } else if (state == State.CLOSED) {
178             if (!availableTransitions.containsKey(&quot;Closed&quot;)) {
179                 if (availableTransitions.containsKey(&quot;Resolved&quot;)) {
180                     performTransition(availableTransitions.get(&quot;Resolved&quot;));
181                     availableTransitions = availableTransitions();
182                     if (!availableTransitions.containsKey(&quot;Closed&quot;)) {
183                         throw new RuntimeException(&quot;Cannot transition to Closed after Resolved&quot;);
184                     }
185                 } else {
186                     throw new RuntimeException(&quot;Cannot transition to Closed&quot;);
187                 }
188                 performTransition(availableTransitions.get(&quot;Closed&quot;));
189             }
190         } else if (state == State.OPEN) {
191             if (!availableTransitions.containsKey(&quot;Open&quot;)) {
192                 throw new RuntimeException(&quot;Cannot transition to Open&quot;);
193             }
194             performTransition(availableTransitions.get(&quot;Open&quot;));
<span class="line-added">195         } else {</span>
<span class="line-added">196             throw new IllegalStateException(&quot;Unknown state &quot; + state);</span>
197         }
198     }
199 
200     @Override
201     public void addLabel(String label) {
202         var query = JSON.object()
203                         .put(&quot;update&quot;, JSON.object()
204                                            .put(&quot;labels&quot;, JSON.array().add(JSON.object()
205                                                                                .put(&quot;add&quot;, label))));
206         request.put(&quot;&quot;).body(query).execute();
207     }
208 
209     @Override
210     public void removeLabel(String label) {
211         var query = JSON.object()
212                         .put(&quot;update&quot;, JSON.object()
213                                            .put(&quot;labels&quot;, JSON.array().add(JSON.object()
214                                                                                .put(&quot;remove&quot;, label))));
215         request.put(&quot;&quot;).body(query).execute();
216     }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>