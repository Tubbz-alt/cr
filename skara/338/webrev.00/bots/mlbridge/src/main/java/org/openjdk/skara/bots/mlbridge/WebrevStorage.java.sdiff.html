<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/WebrevStorage.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ArchiveMessages.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../tester/src/test/java/org/openjdk/skara/bots/tester/InMemoryPullRequest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>bots/mlbridge/src/main/java/org/openjdk/skara/bots/mlbridge/WebrevStorage.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 43     private final EmailAddress author;
 44 
 45     WebrevStorage(HostedRepository storage, String ref, Path baseFolder, URI baseUri, EmailAddress author) {
 46         this.baseFolder = baseFolder;
 47         this.baseUri = baseUri;
 48         this.storage = storage;
 49         storageRef = ref;
 50         this.author = author;
 51     }
 52 
 53     private void generate(PullRequest pr, Repository localRepository, Path folder, Hash base, Hash head) throws IOException {
 54         Files.createDirectories(folder);
 55         Webrev.repository(localRepository).output(folder)
 56               .generate(base, head);
 57     }
 58 
 59     private String generatePlaceholder(PullRequest pr, Hash base, Hash head) {
 60         return &quot;This file was too large to be included in the published webrev, and has been replaced with &quot; +
 61                 &quot;this placeholder message. It is possible to generate the original content locally by &quot; +
 62                 &quot;following these instructions:\n\n&quot; +
<span class="line-modified"> 63                 &quot;  $ git fetch &quot; + pr.repository().webUrl() + &quot; &quot; + pr.sourceRef() + &quot;\n&quot; +</span>
 64                 &quot;  $ git checkout &quot; + head.hex() + &quot;\n&quot; +
 65                 &quot;  $ git webrev -r &quot; + base.hex() + &quot;\n&quot;;
 66     }
 67 
 68     private void replaceContent(Path file, String placeholder) {
 69         try {
 70             if (file.getFileName().toString().endsWith(&quot;.html&quot;)) {
 71                 var existing = Files.readString(file);
 72                 var headerEnd = existing.indexOf(&quot;&lt;pre&gt;&quot;);
 73                 var footerStart = existing.lastIndexOf(&quot;&lt;/pre&gt;&quot;);
 74                 if ((headerEnd &gt; 0) &amp;&amp; (footerStart &gt; 0)) {
 75                     var header = existing.substring(0, headerEnd + 5);
 76                     var footer = existing.substring(footerStart);
 77                     Files.writeString(file, header + placeholder + footer);
 78                     return;
 79                 }
 80             }
 81             Files.writeString(file, placeholder);
 82         } catch (IOException e) {
 83             throw new RuntimeException(&quot;Failed to replace large file with placeholder&quot;);
</pre>
</td>
<td>
<hr />
<pre>
 43     private final EmailAddress author;
 44 
 45     WebrevStorage(HostedRepository storage, String ref, Path baseFolder, URI baseUri, EmailAddress author) {
 46         this.baseFolder = baseFolder;
 47         this.baseUri = baseUri;
 48         this.storage = storage;
 49         storageRef = ref;
 50         this.author = author;
 51     }
 52 
 53     private void generate(PullRequest pr, Repository localRepository, Path folder, Hash base, Hash head) throws IOException {
 54         Files.createDirectories(folder);
 55         Webrev.repository(localRepository).output(folder)
 56               .generate(base, head);
 57     }
 58 
 59     private String generatePlaceholder(PullRequest pr, Hash base, Hash head) {
 60         return &quot;This file was too large to be included in the published webrev, and has been replaced with &quot; +
 61                 &quot;this placeholder message. It is possible to generate the original content locally by &quot; +
 62                 &quot;following these instructions:\n\n&quot; +
<span class="line-modified"> 63                 &quot;  $ git fetch &quot; + pr.repository().webUrl() + &quot; &quot; + pr.fetchRef() + &quot;\n&quot; +</span>
 64                 &quot;  $ git checkout &quot; + head.hex() + &quot;\n&quot; +
 65                 &quot;  $ git webrev -r &quot; + base.hex() + &quot;\n&quot;;
 66     }
 67 
 68     private void replaceContent(Path file, String placeholder) {
 69         try {
 70             if (file.getFileName().toString().endsWith(&quot;.html&quot;)) {
 71                 var existing = Files.readString(file);
 72                 var headerEnd = existing.indexOf(&quot;&lt;pre&gt;&quot;);
 73                 var footerStart = existing.lastIndexOf(&quot;&lt;/pre&gt;&quot;);
 74                 if ((headerEnd &gt; 0) &amp;&amp; (footerStart &gt; 0)) {
 75                     var header = existing.substring(0, headerEnd + 5);
 76                     var footer = existing.substring(footerStart);
 77                     Files.writeString(file, header + placeholder + footer);
 78                     return;
 79                 }
 80             }
 81             Files.writeString(file, placeholder);
 82         } catch (IOException e) {
 83             throw new RuntimeException(&quot;Failed to replace large file with placeholder&quot;);
</pre>
</td>
</tr>
</table>
<center><a href="ArchiveMessages.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../tester/src/test/java/org/openjdk/skara/bots/tester/InMemoryPullRequest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>