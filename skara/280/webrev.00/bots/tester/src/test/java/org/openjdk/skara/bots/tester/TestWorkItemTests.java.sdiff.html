<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff bots/tester/src/test/java/org/openjdk/skara/bots/tester/TestWorkItemTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InMemoryPullRequest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>bots/tester/src/test/java/org/openjdk/skara/bots/tester/TestWorkItemTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
487             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
488             var defaultJobs = List.of(&quot;tier1&quot;);
489             var name = &quot;test&quot;;
490             var storage = tmp.path().resolve(&quot;storage&quot;);
491             var scratch = tmp.path().resolve(&quot;storage&quot;);
492 
493             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
494             var host = new InMemoryHost();
495             host.currentUserDetails = bot;
496             host.groups = Map.of(approvers, Set.of());
497 
498             var repo = new InMemoryHostedRepository();
499             repo.host = host;
500             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
501             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
502             repo.id = 1337L;
503 
504             var pr = new InMemoryPullRequest();
505             pr.repository = repo;
506             pr.id = &quot;17&quot;;
<span class="line-removed">507             pr.targetRef = &quot;master&quot;;</span>
508 
509             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
510             pr.author = duke;
511             pr.headHash = head;
512 
513             var now = ZonedDateTime.now();
514             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
515             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
516 
517             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
518 
519             item.run(scratch);
520 
521             var comments = pr.comments();
522             assertEquals(2, comments.size());
523             assertEquals(comment, comments.get(0));
524             var secondComment = comments.get(1);
525             assertEquals(bot, secondComment.author());
526 
527             var lines = secondComment.body().split(&quot;\n&quot;);
</pre>
<hr />
<pre>
596             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
597             var defaultJobs = List.of(&quot;tier1&quot;);
598             var name = &quot;test&quot;;
599             var storage = tmp.path().resolve(&quot;storage&quot;);
600             var scratch = tmp.path().resolve(&quot;storage&quot;);
601 
602             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
603             var host = new InMemoryHost();
604             host.currentUserDetails = bot;
605             host.groups = Map.of(approvers, Set.of());
606 
607             var repo = new InMemoryHostedRepository();
608             repo.host = host;
609             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
610             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
611             repo.id = 1337L;
612 
613             var pr = new InMemoryPullRequest();
614             pr.repository = repo;
615             pr.id = &quot;17&quot;;
<span class="line-modified">616             pr.targetRef = &quot;master&quot;;</span>
617 
618             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
619             pr.author = duke;
<span class="line-removed">620             pr.headHash = head;</span>
621 
622             var now = ZonedDateTime.now();
623             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
624             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
625 
626             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
627 
628             item.run(scratch);
629 
630             var comments = pr.comments();
631             assertEquals(2, comments.size());
632             assertEquals(comment, comments.get(0));
633             var secondComment = comments.get(1);
634             assertEquals(bot, secondComment.author());
635 
636             var lines = secondComment.body().split(&quot;\n&quot;);
637             assertEquals(&quot;&lt;!-- TEST PENDING --&gt;&quot;, lines[0]);
638             assertEquals(&quot;&lt;!-- &quot; + head.hex() + &quot; --&gt;&quot;, lines[1]);
639             assertEquals(&quot;&lt;!-- tier1 --&gt;&quot;, lines[2]);
640             assertEquals(&quot;@duke you need to get approval to run the tests in tier1 for commits up until &quot; + head.abbreviate(),
</pre>
<hr />
<pre>
722             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
723             var defaultJobs = List.of(&quot;tier1&quot;);
724             var name = &quot;test&quot;;
725             var storage = tmp.path().resolve(&quot;storage&quot;);
726             var scratch = tmp.path().resolve(&quot;storage&quot;);
727 
728             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
729             var host = new InMemoryHost();
730             host.currentUserDetails = bot;
731             host.groups = Map.of(approvers, Set.of());
732 
733             var repo = new InMemoryHostedRepository();
734             repo.host = host;
735             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
736             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
737             repo.id = 1337L;
738 
739             var pr = new InMemoryPullRequest();
740             pr.repository = repo;
741             pr.id = &quot;17&quot;;
<span class="line-modified">742             pr.targetRef = &quot;master&quot;;</span>
743 
744             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
745             pr.author = duke;
<span class="line-removed">746             pr.headHash = head;</span>
747 
748             var now = ZonedDateTime.now();
749             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
750             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
751 
752             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
753 
754             item.run(scratch);
755 
756             var comments = pr.comments();
757             assertEquals(2, comments.size());
758             assertEquals(comment, comments.get(0));
759             var secondComment = comments.get(1);
760             assertEquals(bot, secondComment.author());
761 
762             var lines = secondComment.body().split(&quot;\n&quot;);
763             assertEquals(&quot;&lt;!-- TEST PENDING --&gt;&quot;, lines[0]);
764             assertEquals(&quot;&lt;!-- &quot; + head.hex() + &quot; --&gt;&quot;, lines[1]);
765             assertEquals(&quot;&lt;!-- tier1 --&gt;&quot;, lines[2]);
766             assertEquals(&quot;@duke you need to get approval to run the tests in tier1 for commits up until &quot; + head.abbreviate(),
</pre>
<hr />
<pre>
811             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
812             var defaultJobs = List.of(&quot;tier1&quot;);
813             var name = &quot;test&quot;;
814             var storage = tmp.path().resolve(&quot;storage&quot;);
815             var scratch = tmp.path().resolve(&quot;storage&quot;);
816 
817             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
818             var host = new InMemoryHost();
819             host.currentUserDetails = bot;
820             host.groups = Map.of(approvers, Set.of());
821 
822             var repo = new InMemoryHostedRepository();
823             repo.host = host;
824             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
825             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
826             repo.id = 1337L;
827 
828             var pr = new InMemoryPullRequest();
829             pr.repository = repo;
830             pr.id = &quot;17&quot;;
<span class="line-modified">831             pr.targetRef = &quot;master&quot;;</span>
832 
833             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
834             pr.author = duke;
<span class="line-removed">835             pr.headHash = head;</span>
836 
837             var now = ZonedDateTime.now();
838             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
839             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
840 
841             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
842 
843             item.run(scratch);
844 
845             var comments = pr.comments();
846             assertEquals(2, comments.size());
847             assertEquals(comment, comments.get(0));
848             var secondComment = comments.get(1);
849             assertEquals(bot, secondComment.author());
850 
851             var lines = secondComment.body().split(&quot;\n&quot;);
852             assertEquals(&quot;&lt;!-- TEST PENDING --&gt;&quot;, lines[0]);
853             assertEquals(&quot;&lt;!-- &quot; + head.hex() + &quot; --&gt;&quot;, lines[1]);
854             assertEquals(&quot;&lt;!-- tier1 --&gt;&quot;, lines[2]);
855             assertEquals(&quot;@duke you need to get approval to run the tests in tier1 for commits up until &quot; + head.abbreviate(),
</pre>
</td>
<td>
<hr />
<pre>
487             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
488             var defaultJobs = List.of(&quot;tier1&quot;);
489             var name = &quot;test&quot;;
490             var storage = tmp.path().resolve(&quot;storage&quot;);
491             var scratch = tmp.path().resolve(&quot;storage&quot;);
492 
493             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
494             var host = new InMemoryHost();
495             host.currentUserDetails = bot;
496             host.groups = Map.of(approvers, Set.of());
497 
498             var repo = new InMemoryHostedRepository();
499             repo.host = host;
500             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
501             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
502             repo.id = 1337L;
503 
504             var pr = new InMemoryPullRequest();
505             pr.repository = repo;
506             pr.id = &quot;17&quot;;

507 
508             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
509             pr.author = duke;
510             pr.headHash = head;
511 
512             var now = ZonedDateTime.now();
513             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
514             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
515 
516             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
517 
518             item.run(scratch);
519 
520             var comments = pr.comments();
521             assertEquals(2, comments.size());
522             assertEquals(comment, comments.get(0));
523             var secondComment = comments.get(1);
524             assertEquals(bot, secondComment.author());
525 
526             var lines = secondComment.body().split(&quot;\n&quot;);
</pre>
<hr />
<pre>
595             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
596             var defaultJobs = List.of(&quot;tier1&quot;);
597             var name = &quot;test&quot;;
598             var storage = tmp.path().resolve(&quot;storage&quot;);
599             var scratch = tmp.path().resolve(&quot;storage&quot;);
600 
601             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
602             var host = new InMemoryHost();
603             host.currentUserDetails = bot;
604             host.groups = Map.of(approvers, Set.of());
605 
606             var repo = new InMemoryHostedRepository();
607             repo.host = host;
608             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
609             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
610             repo.id = 1337L;
611 
612             var pr = new InMemoryPullRequest();
613             pr.repository = repo;
614             pr.id = &quot;17&quot;;
<span class="line-modified">615             pr.headHash = head;</span>
616 
617             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
618             pr.author = duke;

619 
620             var now = ZonedDateTime.now();
621             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
622             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
623 
624             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
625 
626             item.run(scratch);
627 
628             var comments = pr.comments();
629             assertEquals(2, comments.size());
630             assertEquals(comment, comments.get(0));
631             var secondComment = comments.get(1);
632             assertEquals(bot, secondComment.author());
633 
634             var lines = secondComment.body().split(&quot;\n&quot;);
635             assertEquals(&quot;&lt;!-- TEST PENDING --&gt;&quot;, lines[0]);
636             assertEquals(&quot;&lt;!-- &quot; + head.hex() + &quot; --&gt;&quot;, lines[1]);
637             assertEquals(&quot;&lt;!-- tier1 --&gt;&quot;, lines[2]);
638             assertEquals(&quot;@duke you need to get approval to run the tests in tier1 for commits up until &quot; + head.abbreviate(),
</pre>
<hr />
<pre>
720             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
721             var defaultJobs = List.of(&quot;tier1&quot;);
722             var name = &quot;test&quot;;
723             var storage = tmp.path().resolve(&quot;storage&quot;);
724             var scratch = tmp.path().resolve(&quot;storage&quot;);
725 
726             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
727             var host = new InMemoryHost();
728             host.currentUserDetails = bot;
729             host.groups = Map.of(approvers, Set.of());
730 
731             var repo = new InMemoryHostedRepository();
732             repo.host = host;
733             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
734             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
735             repo.id = 1337L;
736 
737             var pr = new InMemoryPullRequest();
738             pr.repository = repo;
739             pr.id = &quot;17&quot;;
<span class="line-modified">740             pr.headHash = head;</span>
741 
742             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
743             pr.author = duke;

744 
745             var now = ZonedDateTime.now();
746             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
747             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
748 
749             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
750 
751             item.run(scratch);
752 
753             var comments = pr.comments();
754             assertEquals(2, comments.size());
755             assertEquals(comment, comments.get(0));
756             var secondComment = comments.get(1);
757             assertEquals(bot, secondComment.author());
758 
759             var lines = secondComment.body().split(&quot;\n&quot;);
760             assertEquals(&quot;&lt;!-- TEST PENDING --&gt;&quot;, lines[0]);
761             assertEquals(&quot;&lt;!-- &quot; + head.hex() + &quot; --&gt;&quot;, lines[1]);
762             assertEquals(&quot;&lt;!-- tier1 --&gt;&quot;, lines[2]);
763             assertEquals(&quot;@duke you need to get approval to run the tests in tier1 for commits up until &quot; + head.abbreviate(),
</pre>
<hr />
<pre>
808             var available = List.of(&quot;tier1&quot;, &quot;tier2&quot;, &quot;tier3&quot;);
809             var defaultJobs = List.of(&quot;tier1&quot;);
810             var name = &quot;test&quot;;
811             var storage = tmp.path().resolve(&quot;storage&quot;);
812             var scratch = tmp.path().resolve(&quot;storage&quot;);
813 
814             var bot = new HostUser(1, &quot;bot&quot;, &quot;openjdk [bot]&quot;);
815             var host = new InMemoryHost();
816             host.currentUserDetails = bot;
817             host.groups = Map.of(approvers, Set.of());
818 
819             var repo = new InMemoryHostedRepository();
820             repo.host = host;
821             repo.webUrl = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
822             repo.url = URI.create(&quot;file://&quot; + localRepoDir.toAbsolutePath());
823             repo.id = 1337L;
824 
825             var pr = new InMemoryPullRequest();
826             pr.repository = repo;
827             pr.id = &quot;17&quot;;
<span class="line-modified">828             pr.headHash = head;</span>
829 
830             var duke = new HostUser(0, &quot;duke&quot;, &quot;Duke&quot;);
831             pr.author = duke;

832 
833             var now = ZonedDateTime.now();
834             var comment = new Comment(&quot;0&quot;, &quot;/test tier1&quot;, duke, now, now);
835             pr.comments = new ArrayList&lt;&gt;(List.of(comment));
836 
837             var item = new TestWorkItem(ci, approvers, available, defaultJobs, name, storage, pr);
838 
839             item.run(scratch);
840 
841             var comments = pr.comments();
842             assertEquals(2, comments.size());
843             assertEquals(comment, comments.get(0));
844             var secondComment = comments.get(1);
845             assertEquals(bot, secondComment.author());
846 
847             var lines = secondComment.body().split(&quot;\n&quot;);
848             assertEquals(&quot;&lt;!-- TEST PENDING --&gt;&quot;, lines[0]);
849             assertEquals(&quot;&lt;!-- &quot; + head.hex() + &quot; --&gt;&quot;, lines[1]);
850             assertEquals(&quot;&lt;!-- tier1 --&gt;&quot;, lines[2]);
851             assertEquals(&quot;@duke you need to get approval to run the tests in tier1 for commits up until &quot; + head.abbreviate(),
</pre>
</td>
</tr>
</table>
<center><a href="InMemoryPullRequest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>