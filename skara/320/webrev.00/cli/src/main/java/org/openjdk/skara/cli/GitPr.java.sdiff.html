<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff cli/src/main/java/org/openjdk/skara/cli/GitPr.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>cli/src/main/java/org/openjdk/skara/cli/GitPr.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
303                   .helptext(&quot;Comma separated list of assignees&quot;)
304                   .optional(),
305             Option.shortcut(&quot;&quot;)
306                   .fullname(&quot;labels&quot;)
307                   .describe(&quot;LIST&quot;)
308                   .helptext(&quot;Comma separated list of labels&quot;)
309                   .optional(),
310             Option.shortcut(&quot;&quot;)
311                   .fullname(&quot;columns&quot;)
312                   .describe(&quot;id,title,author,assignees,labels&quot;)
313                   .helptext(&quot;Comma separated list of columns to show&quot;)
314                   .optional(),
315             Switch.shortcut(&quot;&quot;)
316                   .fullname(&quot;no-decoration&quot;)
317                   .helptext(&quot;Hide any decorations when listing PRs&quot;)
318                   .optional(),
319             Switch.shortcut(&quot;&quot;)
320                   .fullname(&quot;ignore-workspace&quot;)
321                   .helptext(&quot;Ignore local changes in worktree and staging area when creating pull request&quot;)
322                   .optional(),




323             Switch.shortcut(&quot;&quot;)
324                   .fullname(&quot;publish&quot;)
325                   .helptext(&quot;Publish the local branch before creating the pull request&quot;)
326                   .optional(),
327             Switch.shortcut(&quot;&quot;)
328                   .fullname(&quot;no-token&quot;)
329                   .helptext(&quot;Do not use a personal access token (PAT). Only works for read-only operations.&quot;)
330                   .optional(),
331             Switch.shortcut(&quot;&quot;)
332                   .fullname(&quot;mercurial&quot;)
333                   .helptext(&quot;Force use of Mercurial (hg)&quot;)
334                   .optional(),
335             Switch.shortcut(&quot;&quot;)
336                   .fullname(&quot;verbose&quot;)
337                   .helptext(&quot;Turn on verbose output&quot;)
338                   .optional(),
339             Switch.shortcut(&quot;&quot;)
340                   .fullname(&quot;debug&quot;)
341                   .helptext(&quot;Turn on debugging output&quot;)
342                   .optional(),
</pre>
<hr />
<pre>
646                 } else {
647                     System.err.println(&quot;error: there is no remote branch for the local branch &#39;&quot; + currentBranch.name() + &quot;&#39;&quot;);
648                     System.err.println(&quot;&quot;);
649                     System.err.println(&quot;A remote branch must be present at &quot; + remotePullPath + &quot; to create a pull request&quot;);
650                     System.err.println(&quot;To create a remote branch and push the commits for your local branch, run:&quot;);
651                     System.err.println(&quot;&quot;);
652                     System.err.println(&quot;    git publish&quot;);
653                     System.err.println(&quot;&quot;);
654                     System.err.println(&quot;If you created the remote branch from another client, you must update this repository.&quot;);
655                     System.err.println(&quot;To update remote information for this repository, run:&quot;);
656                     System.err.println(&quot;&quot;);
657                     System.err.println(&quot;    git fetch &quot; + remote);
658                     System.err.println(&quot;    git branch --set-upstream &quot; + currentBranch + &quot; &quot; + remote + &quot;/&quot; + currentBranch);
659                     System.err.println(&quot;&quot;);
660                     System.exit(1);
661                 }
662             }
663 
664             var upstreamRefName = upstream.get().substring(remote.length() + 1);
665             repo.fetch(uri, upstreamRefName);
<span class="line-modified">666             var branchCommits = repo.commits(upstream.get() + &quot;..&quot; + currentBranch.name()).asList();</span>
<span class="line-modified">667             if (!branchCommits.isEmpty()) {</span>
<span class="line-modified">668                 System.err.println(&quot;error: there are local commits on branch &#39;&quot; + currentBranch.name() + &quot;&#39; not present in the remote repository &quot; + remotePullPath);</span>
<span class="line-modified">669                 System.err.println(&quot;&quot;);</span>
<span class="line-modified">670                 System.err.println(&quot;All commits must be present in the remote repository to be part of the pull request&quot;);</span>
<span class="line-modified">671                 System.err.println(&quot;The following commits are not present in the remote repository:&quot;);</span>
<span class="line-modified">672                 System.err.println(&quot;&quot;);</span>
<span class="line-modified">673                 for (var commit : branchCommits) {</span>
<span class="line-modified">674                     System.err.println(&quot;- &quot; + commit.hash().abbreviate() + &quot;: &quot; + commit.message().get(0));</span>














675                 }
<span class="line-removed">676                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">677                 System.err.println(&quot;To push the above local commits to the remote repository, run:&quot;);</span>
<span class="line-removed">678                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">679                 System.err.println(&quot;    git push &quot; + remote + &quot; &quot; + currentBranch.name());</span>
<span class="line-removed">680                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">681                 System.exit(1);</span>
682             }
683 
684             var targetBranch = arguments.get(&quot;branch&quot;).orString(&quot;master&quot;);
<span class="line-modified">685             var commits = repo.commits(targetBranch + &quot;..&quot; + currentBranch.name()).asList();</span>
686             if (commits.isEmpty()) {
687                 System.err.println(&quot;error: no difference between branches &quot; + targetBranch + &quot; and &quot; + currentBranch.name());
688                 System.err.println(&quot;       Cannot create an empty pull request, have you committed?&quot;);
689                 System.exit(1);
690             }
691 
692             var remoteRepo = host.repository(projectName(uri)).orElseThrow(() -&gt;
693                     new IOException(&quot;Could not find repository at &quot; + uri.toString())
694             );
695             if (token == null) {
696                 GitCredentials.approve(credentials);
697             }
698             var parentRepo = remoteRepo.parent().orElseThrow(() -&gt;
699                     new IOException(&quot;error: remote repository &quot; + remotePullPath + &quot; is not a fork of any repository&quot;));
700 
701             var project = jbsProjectFromJcheckConf(repo);
702             var issue = getIssue(currentBranch, project);
703             var file = Files.createTempFile(&quot;PULL_REQUEST_&quot;, &quot;.txt&quot;);
704             if (issue.isPresent()) {
705                 Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);
</pre>
</td>
<td>
<hr />
<pre>
303                   .helptext(&quot;Comma separated list of assignees&quot;)
304                   .optional(),
305             Option.shortcut(&quot;&quot;)
306                   .fullname(&quot;labels&quot;)
307                   .describe(&quot;LIST&quot;)
308                   .helptext(&quot;Comma separated list of labels&quot;)
309                   .optional(),
310             Option.shortcut(&quot;&quot;)
311                   .fullname(&quot;columns&quot;)
312                   .describe(&quot;id,title,author,assignees,labels&quot;)
313                   .helptext(&quot;Comma separated list of columns to show&quot;)
314                   .optional(),
315             Switch.shortcut(&quot;&quot;)
316                   .fullname(&quot;no-decoration&quot;)
317                   .helptext(&quot;Hide any decorations when listing PRs&quot;)
318                   .optional(),
319             Switch.shortcut(&quot;&quot;)
320                   .fullname(&quot;ignore-workspace&quot;)
321                   .helptext(&quot;Ignore local changes in worktree and staging area when creating pull request&quot;)
322                   .optional(),
<span class="line-added">323             Switch.shortcut(&quot;&quot;)</span>
<span class="line-added">324                   .fullname(&quot;ignore-local-commits&quot;)</span>
<span class="line-added">325                   .helptext(&quot;Ignore local commits not pushed when creating pull request&quot;)</span>
<span class="line-added">326                   .optional(),</span>
327             Switch.shortcut(&quot;&quot;)
328                   .fullname(&quot;publish&quot;)
329                   .helptext(&quot;Publish the local branch before creating the pull request&quot;)
330                   .optional(),
331             Switch.shortcut(&quot;&quot;)
332                   .fullname(&quot;no-token&quot;)
333                   .helptext(&quot;Do not use a personal access token (PAT). Only works for read-only operations.&quot;)
334                   .optional(),
335             Switch.shortcut(&quot;&quot;)
336                   .fullname(&quot;mercurial&quot;)
337                   .helptext(&quot;Force use of Mercurial (hg)&quot;)
338                   .optional(),
339             Switch.shortcut(&quot;&quot;)
340                   .fullname(&quot;verbose&quot;)
341                   .helptext(&quot;Turn on verbose output&quot;)
342                   .optional(),
343             Switch.shortcut(&quot;&quot;)
344                   .fullname(&quot;debug&quot;)
345                   .helptext(&quot;Turn on debugging output&quot;)
346                   .optional(),
</pre>
<hr />
<pre>
650                 } else {
651                     System.err.println(&quot;error: there is no remote branch for the local branch &#39;&quot; + currentBranch.name() + &quot;&#39;&quot;);
652                     System.err.println(&quot;&quot;);
653                     System.err.println(&quot;A remote branch must be present at &quot; + remotePullPath + &quot; to create a pull request&quot;);
654                     System.err.println(&quot;To create a remote branch and push the commits for your local branch, run:&quot;);
655                     System.err.println(&quot;&quot;);
656                     System.err.println(&quot;    git publish&quot;);
657                     System.err.println(&quot;&quot;);
658                     System.err.println(&quot;If you created the remote branch from another client, you must update this repository.&quot;);
659                     System.err.println(&quot;To update remote information for this repository, run:&quot;);
660                     System.err.println(&quot;&quot;);
661                     System.err.println(&quot;    git fetch &quot; + remote);
662                     System.err.println(&quot;    git branch --set-upstream &quot; + currentBranch + &quot; &quot; + remote + &quot;/&quot; + currentBranch);
663                     System.err.println(&quot;&quot;);
664                     System.exit(1);
665                 }
666             }
667 
668             var upstreamRefName = upstream.get().substring(remote.length() + 1);
669             repo.fetch(uri, upstreamRefName);
<span class="line-modified">670 </span>
<span class="line-modified">671             var shouldIgnoreLocalCommits = arguments.contains(&quot;ignore-local-commits&quot;);</span>
<span class="line-modified">672             if (!shouldIgnoreLocalCommits) {</span>
<span class="line-modified">673                 var lines = repo.config(&quot;pr.ignore-local-commits&quot;);</span>
<span class="line-modified">674                 shouldIgnoreLocalCommits = lines.size() == 1 &amp;&amp; lines.get(0).toLowerCase().equals(&quot;true&quot;);</span>
<span class="line-modified">675             }</span>
<span class="line-modified">676             if (!shouldIgnoreLocalCommits) {</span>
<span class="line-modified">677                 var branchCommits = repo.commits(upstream.get() + &quot;..&quot; + currentBranch.name()).asList();</span>
<span class="line-modified">678                 if (!branchCommits.isEmpty()) {</span>
<span class="line-added">679                     System.err.println(&quot;error: there are local commits on branch &#39;&quot; + currentBranch.name() + &quot;&#39; not present in the remote repository &quot; + remotePullPath);</span>
<span class="line-added">680                     System.err.println(&quot;&quot;);</span>
<span class="line-added">681                     System.err.println(&quot;All commits must be present in the remote repository to be part of the pull request&quot;);</span>
<span class="line-added">682                     System.err.println(&quot;The following commits are not present in the remote repository:&quot;);</span>
<span class="line-added">683                     System.err.println(&quot;&quot;);</span>
<span class="line-added">684                     for (var commit : branchCommits) {</span>
<span class="line-added">685                         System.err.println(&quot;- &quot; + commit.hash().abbreviate() + &quot;: &quot; + commit.message().get(0));</span>
<span class="line-added">686                     }</span>
<span class="line-added">687                     System.err.println(&quot;&quot;);</span>
<span class="line-added">688                     System.err.println(&quot;To push the above local commits to the remote repository, run:&quot;);</span>
<span class="line-added">689                     System.err.println(&quot;&quot;);</span>
<span class="line-added">690                     System.err.println(&quot;    git push &quot; + remote + &quot; &quot; + currentBranch.name());</span>
<span class="line-added">691                     System.err.println(&quot;&quot;);</span>
<span class="line-added">692                     System.exit(1);</span>
693                 }






694             }
695 
696             var targetBranch = arguments.get(&quot;branch&quot;).orString(&quot;master&quot;);
<span class="line-modified">697             var commits = repo.commits(targetBranch + &quot;..&quot; + upstream.get()).asList();</span>
698             if (commits.isEmpty()) {
699                 System.err.println(&quot;error: no difference between branches &quot; + targetBranch + &quot; and &quot; + currentBranch.name());
700                 System.err.println(&quot;       Cannot create an empty pull request, have you committed?&quot;);
701                 System.exit(1);
702             }
703 
704             var remoteRepo = host.repository(projectName(uri)).orElseThrow(() -&gt;
705                     new IOException(&quot;Could not find repository at &quot; + uri.toString())
706             );
707             if (token == null) {
708                 GitCredentials.approve(credentials);
709             }
710             var parentRepo = remoteRepo.parent().orElseThrow(() -&gt;
711                     new IOException(&quot;error: remote repository &quot; + remotePullPath + &quot; is not a fork of any repository&quot;));
712 
713             var project = jbsProjectFromJcheckConf(repo);
714             var issue = getIssue(currentBranch, project);
715             var file = Files.createTempFile(&quot;PULL_REQUEST_&quot;, &quot;.txt&quot;);
716             if (issue.isPresent()) {
717                 Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>