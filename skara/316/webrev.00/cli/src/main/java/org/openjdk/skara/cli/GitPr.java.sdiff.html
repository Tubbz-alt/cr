<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff cli/src/main/java/org/openjdk/skara/cli/GitPr.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>cli/src/main/java/org/openjdk/skara/cli/GitPr.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
299                   .optional(),
300             Option.shortcut(&quot;&quot;)
301                   .fullname(&quot;assignees&quot;)
302                   .describe(&quot;LIST&quot;)
303                   .helptext(&quot;Comma separated list of assignees&quot;)
304                   .optional(),
305             Option.shortcut(&quot;&quot;)
306                   .fullname(&quot;labels&quot;)
307                   .describe(&quot;LIST&quot;)
308                   .helptext(&quot;Comma separated list of labels&quot;)
309                   .optional(),
310             Option.shortcut(&quot;&quot;)
311                   .fullname(&quot;columns&quot;)
312                   .describe(&quot;id,title,author,assignees,labels&quot;)
313                   .helptext(&quot;Comma separated list of columns to show&quot;)
314                   .optional(),
315             Switch.shortcut(&quot;&quot;)
316                   .fullname(&quot;no-decoration&quot;)
317                   .helptext(&quot;Hide any decorations when listing PRs&quot;)
318                   .optional(),




319             Switch.shortcut(&quot;&quot;)
320                   .fullname(&quot;no-token&quot;)
321                   .helptext(&quot;Do not use a personal access token (PAT). Only works for read-only operations.&quot;)
322                   .optional(),
323             Switch.shortcut(&quot;&quot;)
324                   .fullname(&quot;mercurial&quot;)
325                   .helptext(&quot;Force use of Mercurial (hg)&quot;)
326                   .optional(),
327             Switch.shortcut(&quot;&quot;)
328                   .fullname(&quot;verbose&quot;)
329                   .helptext(&quot;Turn on verbose output&quot;)
330                   .optional(),
331             Switch.shortcut(&quot;&quot;)
332                   .fullname(&quot;debug&quot;)
333                   .helptext(&quot;Turn on debugging output&quot;)
334                   .optional(),
335             Switch.shortcut(&quot;&quot;)
336                   .fullname(&quot;version&quot;)
337                   .helptext(&quot;Print the version of this tool&quot;)
338                   .optional());
</pre>
<hr />
<pre>
579                 Files.deleteIfExists(file);
580 
581                 System.exit(0);
582             }
583             var currentBranch = repo.currentBranch().orElseGet(() -&gt; {
584                     System.err.println(&quot;error: the repository is in a detached HEAD state&quot;);
585                     System.exit(1);
586                     return null;
587             });
588             if (currentBranch.equals(repo.defaultBranch())) {
589                 System.err.println(&quot;error: you should not create pull requests from the &#39;master&#39; branch&quot;);
590                 System.err.println(&quot;&quot;);
591                 System.err.println(&quot;To create a local branch for your changes and restore the &#39;master&#39; branch, run:&quot;);
592                 System.err.println(&quot;&quot;);
593                 System.err.println(&quot;    git checkout -b NAME-FOR-YOUR-LOCAL-BRANCH&quot;);
594                 System.err.println(&quot;    git branch --force master origin/master&quot;);
595                 System.err.println(&quot;&quot;);
596                 System.exit(1);
597             }
598 





























599             var upstream = repo.upstreamFor(currentBranch);
600             if (upstream.isEmpty()) {
601                 System.err.println(&quot;error: there is no remote branch for the local branch &#39;&quot; + currentBranch.name() + &quot;&#39;&quot;);
602                 System.err.println(&quot;&quot;);
603                 System.err.println(&quot;A remote branch must be present at &quot; + remotePullPath + &quot; to create a pull request&quot;);
604                 System.err.println(&quot;To create a remote branch and push the commits for your local branch, run:&quot;);
605                 System.err.println(&quot;&quot;);
606                 System.err.println(&quot;    git publish&quot;);
607                 System.err.println(&quot;&quot;);
608                 System.err.println(&quot;If you created the remote branch from another client, you must update this repository.&quot;);
609                 System.err.println(&quot;To update remote information for this repository, run:&quot;);
610                 System.err.println(&quot;&quot;);
611                 System.err.println(&quot;    git fetch &quot; + remote);
612                 System.err.println(&quot;    git branch --set-upstream &quot; + currentBranch + &quot; &quot; + remote + &quot;/&quot; + currentBranch);
613                 System.err.println(&quot;&quot;);
614                 System.exit(1);
615             }
616 
617             var upstreamRefName = upstream.get().substring(remote.length() + 1);
618             repo.fetch(uri, upstreamRefName);
</pre>
<hr />
<pre>
625                 System.err.println(&quot;&quot;);
626                 for (var commit : branchCommits) {
627                     System.err.println(&quot;- &quot; + commit.hash().abbreviate() + &quot;: &quot; + commit.message().get(0));
628                 }
629                 System.err.println(&quot;&quot;);
630                 System.err.println(&quot;To push the above local commits to the remote repository, run:&quot;);
631                 System.err.println(&quot;&quot;);
632                 System.err.println(&quot;    git push &quot; + remote + &quot; &quot; + currentBranch.name());
633                 System.err.println(&quot;&quot;);
634                 System.exit(1);
635             }
636 
637             var targetBranch = arguments.get(&quot;branch&quot;).orString(&quot;master&quot;);
638             var commits = repo.commits(targetBranch + &quot;..&quot; + currentBranch.name()).asList();
639             if (commits.isEmpty()) {
640                 System.err.println(&quot;error: no difference between branches &quot; + targetBranch + &quot; and &quot; + currentBranch.name());
641                 System.err.println(&quot;       Cannot create an empty pull request, have you committed?&quot;);
642                 System.exit(1);
643             }
644 
<span class="line-removed">645             var diff = repo.diff(repo.head());</span>
<span class="line-removed">646             if (!diff.patches().isEmpty()) {</span>
<span class="line-removed">647                 System.err.println(&quot;error: there are uncommitted changes in your working tree:&quot;);</span>
<span class="line-removed">648                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">649                 for (var patch : diff.patches()) {</span>
<span class="line-removed">650                     var path = patch.target().path().isPresent() ?</span>
<span class="line-removed">651                         patch.target().path().get() : patch.source().path().get();</span>
<span class="line-removed">652                     System.err.println(&quot;    &quot; + patch.status().toString() + &quot; &quot; + path.toString());</span>
<span class="line-removed">653                 }</span>
<span class="line-removed">654                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">655                 System.err.println(&quot;If these changes are meant to be part of the pull request, run:&quot;);</span>
<span class="line-removed">656                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">657                 System.err.println(&quot;    git commit -am &#39;Forgot to add some changes&#39;&quot;);</span>
<span class="line-removed">658                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">659                 System.err.println(&quot;If these changes are *not* meant to be part of the pull request, run:&quot;);</span>
<span class="line-removed">660                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">661                 System.err.println(&quot;    git stash&quot;);</span>
<span class="line-removed">662                 System.err.println(&quot;&quot;);</span>
<span class="line-removed">663                 System.err.println(&quot;(You can later restore the changes by running: git stash pop)&quot;);</span>
<span class="line-removed">664                 System.exit(1);</span>
<span class="line-removed">665             }</span>
<span class="line-removed">666 </span>
667             var remoteRepo = host.repository(projectName(uri)).orElseThrow(() -&gt;
668                     new IOException(&quot;Could not find repository at &quot; + uri.toString())
669             );
670             if (token == null) {
671                 GitCredentials.approve(credentials);
672             }
673             var parentRepo = remoteRepo.parent().orElseThrow(() -&gt;
674                     new IOException(&quot;error: remote repository &quot; + remotePullPath + &quot; is not a fork of any repository&quot;));
675 
676             var project = jbsProjectFromJcheckConf(repo);
677             var issue = getIssue(currentBranch, project);
678             var file = Files.createTempFile(&quot;PULL_REQUEST_&quot;, &quot;.txt&quot;);
679             if (issue.isPresent()) {
680                 Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);
681             } else if (commits.size() == 1) {
682                 var commit = commits.get(0);
683                 issue = getIssue(commit, project);
684                 if (issue.isPresent()) {
685                     Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);
686                 } else {
</pre>
</td>
<td>
<hr />
<pre>
299                   .optional(),
300             Option.shortcut(&quot;&quot;)
301                   .fullname(&quot;assignees&quot;)
302                   .describe(&quot;LIST&quot;)
303                   .helptext(&quot;Comma separated list of assignees&quot;)
304                   .optional(),
305             Option.shortcut(&quot;&quot;)
306                   .fullname(&quot;labels&quot;)
307                   .describe(&quot;LIST&quot;)
308                   .helptext(&quot;Comma separated list of labels&quot;)
309                   .optional(),
310             Option.shortcut(&quot;&quot;)
311                   .fullname(&quot;columns&quot;)
312                   .describe(&quot;id,title,author,assignees,labels&quot;)
313                   .helptext(&quot;Comma separated list of columns to show&quot;)
314                   .optional(),
315             Switch.shortcut(&quot;&quot;)
316                   .fullname(&quot;no-decoration&quot;)
317                   .helptext(&quot;Hide any decorations when listing PRs&quot;)
318                   .optional(),
<span class="line-added">319             Switch.shortcut(&quot;&quot;)</span>
<span class="line-added">320                   .fullname(&quot;ignore-workspace&quot;)</span>
<span class="line-added">321                   .helptext(&quot;Ignore local changes in worktree and staging area when creating pull request&quot;)</span>
<span class="line-added">322                   .optional(),</span>
323             Switch.shortcut(&quot;&quot;)
324                   .fullname(&quot;no-token&quot;)
325                   .helptext(&quot;Do not use a personal access token (PAT). Only works for read-only operations.&quot;)
326                   .optional(),
327             Switch.shortcut(&quot;&quot;)
328                   .fullname(&quot;mercurial&quot;)
329                   .helptext(&quot;Force use of Mercurial (hg)&quot;)
330                   .optional(),
331             Switch.shortcut(&quot;&quot;)
332                   .fullname(&quot;verbose&quot;)
333                   .helptext(&quot;Turn on verbose output&quot;)
334                   .optional(),
335             Switch.shortcut(&quot;&quot;)
336                   .fullname(&quot;debug&quot;)
337                   .helptext(&quot;Turn on debugging output&quot;)
338                   .optional(),
339             Switch.shortcut(&quot;&quot;)
340                   .fullname(&quot;version&quot;)
341                   .helptext(&quot;Print the version of this tool&quot;)
342                   .optional());
</pre>
<hr />
<pre>
583                 Files.deleteIfExists(file);
584 
585                 System.exit(0);
586             }
587             var currentBranch = repo.currentBranch().orElseGet(() -&gt; {
588                     System.err.println(&quot;error: the repository is in a detached HEAD state&quot;);
589                     System.exit(1);
590                     return null;
591             });
592             if (currentBranch.equals(repo.defaultBranch())) {
593                 System.err.println(&quot;error: you should not create pull requests from the &#39;master&#39; branch&quot;);
594                 System.err.println(&quot;&quot;);
595                 System.err.println(&quot;To create a local branch for your changes and restore the &#39;master&#39; branch, run:&quot;);
596                 System.err.println(&quot;&quot;);
597                 System.err.println(&quot;    git checkout -b NAME-FOR-YOUR-LOCAL-BRANCH&quot;);
598                 System.err.println(&quot;    git branch --force master origin/master&quot;);
599                 System.err.println(&quot;&quot;);
600                 System.exit(1);
601             }
602 
<span class="line-added">603             var ignoreWorkspace = arguments.contains(&quot;ignore-workspace&quot;);</span>
<span class="line-added">604             if (!ignoreWorkspace) {</span>
<span class="line-added">605                 var lines = repo.config(&quot;pr.ignore-workspace&quot;);</span>
<span class="line-added">606                 ignoreWorkspace = lines.size() == 1 &amp;&amp; lines.get(0).equals(&quot;true&quot;);</span>
<span class="line-added">607             }</span>
<span class="line-added">608             if (!ignoreWorkspace) {</span>
<span class="line-added">609                 var diff = repo.diff(repo.head());</span>
<span class="line-added">610                 if (!diff.patches().isEmpty()) {</span>
<span class="line-added">611                     System.err.println(&quot;error: there are uncommitted changes in your working tree:&quot;);</span>
<span class="line-added">612                     System.err.println(&quot;&quot;);</span>
<span class="line-added">613                     for (var patch : diff.patches()) {</span>
<span class="line-added">614                         var path = patch.target().path().isPresent() ?</span>
<span class="line-added">615                             patch.target().path().get() : patch.source().path().get();</span>
<span class="line-added">616                         System.err.println(&quot;    &quot; + patch.status().toString() + &quot; &quot; + path.toString());</span>
<span class="line-added">617                     }</span>
<span class="line-added">618                     System.err.println(&quot;&quot;);</span>
<span class="line-added">619                     System.err.println(&quot;If these changes are meant to be part of the pull request, run:&quot;);</span>
<span class="line-added">620                     System.err.println(&quot;&quot;);</span>
<span class="line-added">621                     System.err.println(&quot;    git commit -am &#39;Forgot to add some changes&#39;&quot;);</span>
<span class="line-added">622                     System.err.println(&quot;&quot;);</span>
<span class="line-added">623                     System.err.println(&quot;If these changes are *not* meant to be part of the pull request, run:&quot;);</span>
<span class="line-added">624                     System.err.println(&quot;&quot;);</span>
<span class="line-added">625                     System.err.println(&quot;    git stash&quot;);</span>
<span class="line-added">626                     System.err.println(&quot;&quot;);</span>
<span class="line-added">627                     System.err.println(&quot;(You can later restore the changes by running: git stash pop)&quot;);</span>
<span class="line-added">628                     System.exit(1);</span>
<span class="line-added">629                 }</span>
<span class="line-added">630             }</span>
<span class="line-added">631 </span>
632             var upstream = repo.upstreamFor(currentBranch);
633             if (upstream.isEmpty()) {
634                 System.err.println(&quot;error: there is no remote branch for the local branch &#39;&quot; + currentBranch.name() + &quot;&#39;&quot;);
635                 System.err.println(&quot;&quot;);
636                 System.err.println(&quot;A remote branch must be present at &quot; + remotePullPath + &quot; to create a pull request&quot;);
637                 System.err.println(&quot;To create a remote branch and push the commits for your local branch, run:&quot;);
638                 System.err.println(&quot;&quot;);
639                 System.err.println(&quot;    git publish&quot;);
640                 System.err.println(&quot;&quot;);
641                 System.err.println(&quot;If you created the remote branch from another client, you must update this repository.&quot;);
642                 System.err.println(&quot;To update remote information for this repository, run:&quot;);
643                 System.err.println(&quot;&quot;);
644                 System.err.println(&quot;    git fetch &quot; + remote);
645                 System.err.println(&quot;    git branch --set-upstream &quot; + currentBranch + &quot; &quot; + remote + &quot;/&quot; + currentBranch);
646                 System.err.println(&quot;&quot;);
647                 System.exit(1);
648             }
649 
650             var upstreamRefName = upstream.get().substring(remote.length() + 1);
651             repo.fetch(uri, upstreamRefName);
</pre>
<hr />
<pre>
658                 System.err.println(&quot;&quot;);
659                 for (var commit : branchCommits) {
660                     System.err.println(&quot;- &quot; + commit.hash().abbreviate() + &quot;: &quot; + commit.message().get(0));
661                 }
662                 System.err.println(&quot;&quot;);
663                 System.err.println(&quot;To push the above local commits to the remote repository, run:&quot;);
664                 System.err.println(&quot;&quot;);
665                 System.err.println(&quot;    git push &quot; + remote + &quot; &quot; + currentBranch.name());
666                 System.err.println(&quot;&quot;);
667                 System.exit(1);
668             }
669 
670             var targetBranch = arguments.get(&quot;branch&quot;).orString(&quot;master&quot;);
671             var commits = repo.commits(targetBranch + &quot;..&quot; + currentBranch.name()).asList();
672             if (commits.isEmpty()) {
673                 System.err.println(&quot;error: no difference between branches &quot; + targetBranch + &quot; and &quot; + currentBranch.name());
674                 System.err.println(&quot;       Cannot create an empty pull request, have you committed?&quot;);
675                 System.exit(1);
676             }
677 






















678             var remoteRepo = host.repository(projectName(uri)).orElseThrow(() -&gt;
679                     new IOException(&quot;Could not find repository at &quot; + uri.toString())
680             );
681             if (token == null) {
682                 GitCredentials.approve(credentials);
683             }
684             var parentRepo = remoteRepo.parent().orElseThrow(() -&gt;
685                     new IOException(&quot;error: remote repository &quot; + remotePullPath + &quot; is not a fork of any repository&quot;));
686 
687             var project = jbsProjectFromJcheckConf(repo);
688             var issue = getIssue(currentBranch, project);
689             var file = Files.createTempFile(&quot;PULL_REQUEST_&quot;, &quot;.txt&quot;);
690             if (issue.isPresent()) {
691                 Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);
692             } else if (commits.size() == 1) {
693                 var commit = commits.get(0);
694                 issue = getIssue(commit, project);
695                 if (issue.isPresent()) {
696                     Files.writeString(file, format(issue.get()) + &quot;\n\n&quot;);
697                 } else {
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>