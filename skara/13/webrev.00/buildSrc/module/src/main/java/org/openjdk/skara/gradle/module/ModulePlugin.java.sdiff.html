<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff buildSrc/module/src/main/java/org/openjdk/skara/gradle/module/ModulePlugin.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>buildSrc/module/src/main/java/org/openjdk/skara/gradle/module/ModulePlugin.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 33 import org.gradle.api.tasks.testing.Test;
 34 import org.gradle.api.plugins.JavaPluginConvention;
 35 
 36 import java.util.List;
 37 import java.util.ArrayList;
 38 import java.util.Map;
 39 import java.util.stream.Collectors;
 40 import java.io.File;
 41 
 42 public class ModulePlugin implements Plugin&lt;Project&gt; {
 43     public void apply(Project project) {
 44         project.apply(Map.of(&quot;plugin&quot;, &quot;java-library&quot;));
 45         var extension = project.getExtensions().create(&quot;module&quot;, ModuleExtension.class, project);
 46 
 47         project.afterEvaluate(p -&gt; {
 48             for (var task : project.getTasksByName(&quot;compileJava&quot;, false)) {
 49                 if (task instanceof JavaCompile) {
 50                     var compileJavaTask = (JavaCompile) task;
 51                     compileJavaTask.doFirst(t -&gt; {
 52                         var classpath = compileJavaTask.getClasspath().getAsPath();
<span class="line-modified"> 53                         compileJavaTask.getOptions().setCompilerArgs(List.of(&quot;--module-path&quot;, classpath));</span>
 54                         compileJavaTask.setClasspath(project.files());
 55                     });
 56                 }
 57             }
 58 
 59             for (var task : project.getTasksByName(&quot;compileTestJava&quot;, false)) {
 60                 if (task instanceof JavaCompile) {
 61                     var compileTestJavaTask = (JavaCompile) task;
 62                     compileTestJavaTask.doFirst(t -&gt; {
 63                         var maybeModuleName = extension.getName().get();
 64                         if (maybeModuleName == null) {
 65                             throw new GradleException(&quot;project &quot; + p.getName() + &quot; has not set ext.moduleName&quot;);
 66                         }
 67                         var moduleName = maybeModuleName.toString();
 68                         var testSourceSet = project.getConvention().getPlugin(JavaPluginConvention.class).getSourceSets().getByName(&quot;test&quot;);
 69                         var testSourceDirs = testSourceSet.getAllJava().getSrcDirs().stream().map(File::toString).collect(Collectors.joining(&quot;:&quot;));
 70                         var classpath = compileTestJavaTask.getClasspath().getAsPath();
 71 
 72                         var opts = new ArrayList&lt;String&gt;(compileTestJavaTask.getOptions().getCompilerArgs());
 73                         opts.addAll(List.of(
</pre>
</td>
<td>
<hr />
<pre>
 33 import org.gradle.api.tasks.testing.Test;
 34 import org.gradle.api.plugins.JavaPluginConvention;
 35 
 36 import java.util.List;
 37 import java.util.ArrayList;
 38 import java.util.Map;
 39 import java.util.stream.Collectors;
 40 import java.io.File;
 41 
 42 public class ModulePlugin implements Plugin&lt;Project&gt; {
 43     public void apply(Project project) {
 44         project.apply(Map.of(&quot;plugin&quot;, &quot;java-library&quot;));
 45         var extension = project.getExtensions().create(&quot;module&quot;, ModuleExtension.class, project);
 46 
 47         project.afterEvaluate(p -&gt; {
 48             for (var task : project.getTasksByName(&quot;compileJava&quot;, false)) {
 49                 if (task instanceof JavaCompile) {
 50                     var compileJavaTask = (JavaCompile) task;
 51                     compileJavaTask.doFirst(t -&gt; {
 52                         var classpath = compileJavaTask.getClasspath().getAsPath();
<span class="line-modified"> 53                         compileJavaTask.getOptions().getCompilerArgs().addAll(List.of(&quot;--module-path&quot;, classpath));</span>
 54                         compileJavaTask.setClasspath(project.files());
 55                     });
 56                 }
 57             }
 58 
 59             for (var task : project.getTasksByName(&quot;compileTestJava&quot;, false)) {
 60                 if (task instanceof JavaCompile) {
 61                     var compileTestJavaTask = (JavaCompile) task;
 62                     compileTestJavaTask.doFirst(t -&gt; {
 63                         var maybeModuleName = extension.getName().get();
 64                         if (maybeModuleName == null) {
 65                             throw new GradleException(&quot;project &quot; + p.getName() + &quot; has not set ext.moduleName&quot;);
 66                         }
 67                         var moduleName = maybeModuleName.toString();
 68                         var testSourceSet = project.getConvention().getPlugin(JavaPluginConvention.class).getSourceSets().getByName(&quot;test&quot;);
 69                         var testSourceDirs = testSourceSet.getAllJava().getSrcDirs().stream().map(File::toString).collect(Collectors.joining(&quot;:&quot;));
 70                         var classpath = compileTestJavaTask.getClasspath().getAsPath();
 71 
 72                         var opts = new ArrayList&lt;String&gt;(compileTestJavaTask.getOptions().getCompilerArgs());
 73                         opts.addAll(List.of(
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>