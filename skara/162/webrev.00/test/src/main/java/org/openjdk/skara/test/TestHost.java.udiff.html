<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff test/src/main/java/org/openjdk/skara/test/TestHost.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="HostCredentials.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TestHostedRepository.java.udiff.html" target="_top">next &gt;</a></center>    <h2>test/src/main/java/org/openjdk/skara/test/TestHost.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -36,12 +36,14 @@</span>
      private HostData data;
  
      private static class HostData {
          final List&lt;HostUserDetails&gt; users = new ArrayList&lt;&gt;();
          final Map&lt;String, Repository&gt; repositories = new HashMap&lt;&gt;();
<span class="udiff-line-added">+         final Map&lt;String, IssueProject&gt; issueProjects = new HashMap&lt;&gt;();</span>
          final Set&lt;TemporaryDirectory&gt; folders = new HashSet&lt;&gt;();
          private final Map&lt;String, TestPullRequest&gt; pullRequests = new HashMap&lt;&gt;();
<span class="udiff-line-added">+         private final Map&lt;String, TestIssue&gt; issues = new HashMap&lt;&gt;();</span>
      }
  
      private Repository createLocalRepository() {
          var folder = new TemporaryDirectory();
          data.folders.add(folder);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -93,10 +95,24 @@</span>
              data.repositories.put(name, localRepository);
          }
          return new TestHostedRepository(this, name, localRepository);
      }
  
<span class="udiff-line-added">+     @Override</span>
<span class="udiff-line-added">+     public IssueProject getIssueProject(String name) {</span>
<span class="udiff-line-added">+         if (data.issueProjects.containsKey(name)) {</span>
<span class="udiff-line-added">+             return data.issueProjects.get(name);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             if (data.issueProjects.size() &gt; 0) {</span>
<span class="udiff-line-added">+                 throw new RuntimeException(&quot;A test host can only manage a single issue project&quot;);</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             var issueProject = new TestIssueProject(this, name);</span>
<span class="udiff-line-added">+             data.issueProjects.put(name, issueProject);</span>
<span class="udiff-line-added">+             return issueProject;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      @Override
      public HostUserDetails getUserDetails(String username) {
          return data.users.stream()
                      .filter(user -&gt; user.userName().equals(username))
                      .findAny()
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -136,6 +152,26 @@</span>
                                  .sorted(Comparator.comparing(Map.Entry::getKey))
                                  .map(pr -&gt; getPullRequest(repository, pr.getKey()))
                                  .filter(TestPullRequest::isOpen)
                                  .collect(Collectors.toList());
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     TestIssue createIssue(TestIssueProject issueProject, String title, List&lt;String&gt; body) {</span>
<span class="udiff-line-added">+         var id = String.valueOf(data.issues.size() + 1);</span>
<span class="udiff-line-added">+         var issue = TestIssue.createNew(issueProject, id, title, body);</span>
<span class="udiff-line-added">+         data.issues.put(id ,issue);</span>
<span class="udiff-line-added">+         return issue;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     TestIssue getIssue(TestIssueProject issueProject, String id) {</span>
<span class="udiff-line-added">+         var original = data.issues.get(id);</span>
<span class="udiff-line-added">+         return TestIssue.createFrom(issueProject, original);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     List&lt;TestIssue&gt; getIssues(TestIssueProject issueProject) {</span>
<span class="udiff-line-added">+         return data.issues.entrySet().stream()</span>
<span class="udiff-line-added">+                           .sorted(Comparator.comparing(Map.Entry::getKey))</span>
<span class="udiff-line-added">+                           .map(issue -&gt; getIssue(issueProject, issue.getKey()))</span>
<span class="udiff-line-added">+                           .filter(TestIssue::isOpen)</span>
<span class="udiff-line-added">+                           .collect(Collectors.toList());</span>
<span class="udiff-line-added">+     }</span>
  }
</pre>
<center><a href="HostCredentials.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="TestHostedRepository.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>