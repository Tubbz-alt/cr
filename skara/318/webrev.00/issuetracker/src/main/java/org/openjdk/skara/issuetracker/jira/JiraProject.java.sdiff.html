<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff issuetracker/src/main/java/org/openjdk/skara/issuetracker/jira/JiraProject.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JiraIssueTrackerFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../test/src/main/java/org/openjdk/skara/test/HostCredentials.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>issuetracker/src/main/java/org/openjdk/skara/issuetracker/jira/JiraProject.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 62         for (var type : project().get(&quot;components&quot;).asArray()) {
 63             ret.put(type.get(&quot;name&quot;).asString(), type.get(&quot;id&quot;).asString());
 64         }
 65         return ret;
 66     }
 67 
 68     private String projectId() {
 69         return project().get(&quot;id&quot;).asString();
 70     }
 71 
 72     private String defaultIssueType() {
 73         return issueTypes().values().stream()
 74                            .min(Comparator.naturalOrder()).orElseThrow();
 75     }
 76 
 77     private String defaultComponent() {
 78         return components().values().stream()
 79                            .min(Comparator.naturalOrder()).orElseThrow();
 80     }
 81 




 82     @Override
 83     public IssueTracker issueTracker() {
 84         return jiraHost;
 85     }
 86 
 87     @Override
 88     public URI webUrl() {
 89         return URIBuilder.base(jiraHost.getUri()).setPath(&quot;/projects/&quot; + projectName).build();
 90     }
 91 
 92     @Override
 93     public Issue createIssue(String title, List&lt;String&gt; body) {
<span class="line-modified"> 94         var query = JSON.object()</span>
<span class="line-modified"> 95                         .put(&quot;fields&quot;, JSON.object()</span>
<span class="line-modified"> 96                                            .put(&quot;project&quot;, JSON.object()</span>
<span class="line-modified"> 97                                                                .put(&quot;id&quot;, projectId()))</span>
<span class="line-modified"> 98                                            .put(&quot;issuetype&quot;, JSON.object()</span>
<span class="line-modified"> 99                                                                  .put(&quot;id&quot;, defaultIssueType()))</span>
<span class="line-modified">100                                            .put(&quot;components&quot;, JSON.array()</span>
<span class="line-modified">101                                                                   .add(JSON.object().put(&quot;id&quot;, defaultComponent())))</span>
<span class="line-modified">102                                            .put(&quot;summary&quot;, title)</span>
<span class="line-modified">103                                            .put(&quot;description&quot;, String.join(&quot;\n&quot;, body)));</span>
<span class="line-modified">104 </span>



105         var data = request.post(&quot;issue&quot;)
106                           .body(query)
107                           .execute();
108 
109         return issue(data.get(&quot;key&quot;).asString()).orElseThrow();
110     }
111 
112     @Override
113     public Optional&lt;Issue&gt; issue(String id) {
114         if (id.indexOf(&#39;-&#39;) &lt; 0) {
115             id = projectName.toUpperCase() + &quot;-&quot; + id;
116         }
117         var issueRequest = request.restrict(&quot;issue/&quot; + id);
118         var issue = issueRequest.get(&quot;&quot;)
119                            .onError(r -&gt; r.statusCode() &lt; 500 ? JSON.object().put(&quot;NOT_FOUND&quot;, true) : null)
120                            .execute();
121         if (issue == null) {
122             throw new RuntimeException(&quot;Server error when trying to fetch issue &quot; + id);
123         }
124         if (!issue.contains(&quot;NOT_FOUND&quot;)) {
</pre>
</td>
<td>
<hr />
<pre>
 62         for (var type : project().get(&quot;components&quot;).asArray()) {
 63             ret.put(type.get(&quot;name&quot;).asString(), type.get(&quot;id&quot;).asString());
 64         }
 65         return ret;
 66     }
 67 
 68     private String projectId() {
 69         return project().get(&quot;id&quot;).asString();
 70     }
 71 
 72     private String defaultIssueType() {
 73         return issueTypes().values().stream()
 74                            .min(Comparator.naturalOrder()).orElseThrow();
 75     }
 76 
 77     private String defaultComponent() {
 78         return components().values().stream()
 79                            .min(Comparator.naturalOrder()).orElseThrow();
 80     }
 81 
<span class="line-added"> 82     JiraHost jiraHost() {</span>
<span class="line-added"> 83         return jiraHost;</span>
<span class="line-added"> 84     }</span>
<span class="line-added"> 85 </span>
 86     @Override
 87     public IssueTracker issueTracker() {
 88         return jiraHost;
 89     }
 90 
 91     @Override
 92     public URI webUrl() {
 93         return URIBuilder.base(jiraHost.getUri()).setPath(&quot;/projects/&quot; + projectName).build();
 94     }
 95 
 96     @Override
 97     public Issue createIssue(String title, List&lt;String&gt; body) {
<span class="line-modified"> 98         var query = JSON.object();</span>
<span class="line-modified"> 99         var fields = JSON.object()</span>
<span class="line-modified">100                          .put(&quot;project&quot;, JSON.object()</span>
<span class="line-modified">101                                              .put(&quot;id&quot;, projectId()))</span>
<span class="line-modified">102                          .put(&quot;issuetype&quot;, JSON.object()</span>
<span class="line-modified">103                                                .put(&quot;id&quot;, defaultIssueType()))</span>
<span class="line-modified">104                          .put(&quot;components&quot;, JSON.array()</span>
<span class="line-modified">105                                                 .add(JSON.object().put(&quot;id&quot;, defaultComponent())))</span>
<span class="line-modified">106                          .put(&quot;summary&quot;, title)</span>
<span class="line-modified">107                          .put(&quot;description&quot;, String.join(&quot;\n&quot;, body));</span>
<span class="line-modified">108         query.put(&quot;fields&quot;, fields);</span>
<span class="line-added">109 </span>
<span class="line-added">110         jiraHost.securityLevel().ifPresent(securityLevel -&gt; fields.put(&quot;security&quot;, JSON.object()</span>
<span class="line-added">111                                                                                        .put(&quot;id&quot;, securityLevel)));</span>
112         var data = request.post(&quot;issue&quot;)
113                           .body(query)
114                           .execute();
115 
116         return issue(data.get(&quot;key&quot;).asString()).orElseThrow();
117     }
118 
119     @Override
120     public Optional&lt;Issue&gt; issue(String id) {
121         if (id.indexOf(&#39;-&#39;) &lt; 0) {
122             id = projectName.toUpperCase() + &quot;-&quot; + id;
123         }
124         var issueRequest = request.restrict(&quot;issue/&quot; + id);
125         var issue = issueRequest.get(&quot;&quot;)
126                            .onError(r -&gt; r.statusCode() &lt; 500 ? JSON.object().put(&quot;NOT_FOUND&quot;, true) : null)
127                            .execute();
128         if (issue == null) {
129             throw new RuntimeException(&quot;Server error when trying to fetch issue &quot; + id);
130         }
131         if (!issue.contains(&quot;NOT_FOUND&quot;)) {
</pre>
</td>
</tr>
</table>
<center><a href="JiraIssueTrackerFactory.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../../../test/src/main/java/org/openjdk/skara/test/HostCredentials.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>