<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff vcs/src/test/java/org/openjdk/skara/vcs/RepositoryTests.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../main/java/org/openjdk/skara/vcs/hg/HgRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>vcs/src/test/java/org/openjdk/skara/vcs/RepositoryTests.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 package org.openjdk.skara.vcs;
  24 
  25 import org.junit.jupiter.api.Assumptions;
  26 import org.openjdk.skara.test.TemporaryDirectory;
  27 
  28 import org.junit.jupiter.api.Test;
  29 import org.junit.jupiter.params.ParameterizedTest;
  30 import org.junit.jupiter.params.provider.EnumSource;
  31 
  32 import java.io.IOException;
  33 import java.net.URI;
  34 import java.nio.file.*;
  35 import java.nio.file.attribute.*;

  36 import java.util.*;
  37 import java.util.stream.Collectors;
  38 
  39 import static java.nio.file.StandardOpenOption.*;
  40 import static org.junit.jupiter.api.Assertions.*;
  41 import static org.junit.jupiter.api.Assumptions.assumeTrue;
  42 
  43 public class RepositoryTests {
  44 
  45     @ParameterizedTest
  46     @EnumSource(VCS.class)
  47     void testExistsOnMissingDirectory(VCS vcs) throws IOException {
  48         var d = Paths.get(&quot;/&quot;, &quot;this&quot;, &quot;path&quot;, &quot;does&quot;, &quot;not&quot;, &quot;exist&quot;);
  49         var r = Repository.get(d);
  50         assertTrue(r.isEmpty());
  51     }
  52 
  53     @ParameterizedTest
  54     @EnumSource(VCS.class)
  55     void testExistsOnEmptyDirectory(VCS vcs) throws IOException {
</pre>
<hr />
<pre>
1877         try (var dir = new TemporaryDirectory()) {
1878             var submodule = Repository.init(dir.path().resolve(&quot;submodule&quot;), vcs);
1879             var readme = submodule.root().resolve(&quot;README&quot;);
1880             Files.writeString(readme, &quot;Hello\n&quot;);
1881             submodule.add(readme);
1882             var head = submodule.commit(&quot;Added README&quot;, &quot;duke&quot;, &quot;duke@openjdk.org&quot;);
1883 
1884             var repo = Repository.init(dir.path().resolve(&quot;repo&quot;), vcs);
1885             var pullPath = submodule.root().toAbsolutePath().toString();
1886             repo.addSubmodule(pullPath, Path.of(&quot;sub&quot;));
1887             repo.commit(&quot;Added submodule&quot;, &quot;duke&quot;, &quot;duke@openjdk.org&quot;);
1888 
1889             var submodules = repo.submodules();
1890             assertEquals(1, submodules.size());
1891             var module = submodules.get(0);
1892             assertEquals(Path.of(&quot;sub&quot;), module.path());
1893             assertEquals(head, module.hash());
1894             assertEquals(pullPath, module.pullPath());
1895         }
1896     }

















































1897 }
</pre>
</td>
<td>
<hr />
<pre>
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 package org.openjdk.skara.vcs;
  24 
  25 import org.junit.jupiter.api.Assumptions;
  26 import org.openjdk.skara.test.TemporaryDirectory;
  27 
  28 import org.junit.jupiter.api.Test;
  29 import org.junit.jupiter.params.ParameterizedTest;
  30 import org.junit.jupiter.params.provider.EnumSource;
  31 
  32 import java.io.IOException;
  33 import java.net.URI;
  34 import java.nio.file.*;
  35 import java.nio.file.attribute.*;
<span class="line-added">  36 import java.time.ZonedDateTime;</span>
  37 import java.util.*;
  38 import java.util.stream.Collectors;
  39 
  40 import static java.nio.file.StandardOpenOption.*;
  41 import static org.junit.jupiter.api.Assertions.*;
  42 import static org.junit.jupiter.api.Assumptions.assumeTrue;
  43 
  44 public class RepositoryTests {
  45 
  46     @ParameterizedTest
  47     @EnumSource(VCS.class)
  48     void testExistsOnMissingDirectory(VCS vcs) throws IOException {
  49         var d = Paths.get(&quot;/&quot;, &quot;this&quot;, &quot;path&quot;, &quot;does&quot;, &quot;not&quot;, &quot;exist&quot;);
  50         var r = Repository.get(d);
  51         assertTrue(r.isEmpty());
  52     }
  53 
  54     @ParameterizedTest
  55     @EnumSource(VCS.class)
  56     void testExistsOnEmptyDirectory(VCS vcs) throws IOException {
</pre>
<hr />
<pre>
1878         try (var dir = new TemporaryDirectory()) {
1879             var submodule = Repository.init(dir.path().resolve(&quot;submodule&quot;), vcs);
1880             var readme = submodule.root().resolve(&quot;README&quot;);
1881             Files.writeString(readme, &quot;Hello\n&quot;);
1882             submodule.add(readme);
1883             var head = submodule.commit(&quot;Added README&quot;, &quot;duke&quot;, &quot;duke@openjdk.org&quot;);
1884 
1885             var repo = Repository.init(dir.path().resolve(&quot;repo&quot;), vcs);
1886             var pullPath = submodule.root().toAbsolutePath().toString();
1887             repo.addSubmodule(pullPath, Path.of(&quot;sub&quot;));
1888             repo.commit(&quot;Added submodule&quot;, &quot;duke&quot;, &quot;duke@openjdk.org&quot;);
1889 
1890             var submodules = repo.submodules();
1891             assertEquals(1, submodules.size());
1892             var module = submodules.get(0);
1893             assertEquals(Path.of(&quot;sub&quot;), module.path());
1894             assertEquals(head, module.hash());
1895             assertEquals(pullPath, module.pullPath());
1896         }
1897     }
<span class="line-added">1898 </span>
<span class="line-added">1899     @ParameterizedTest</span>
<span class="line-added">1900     @EnumSource(VCS.class)</span>
<span class="line-added">1901     void testAnnotateTag(VCS vcs) throws IOException {</span>
<span class="line-added">1902         try (var dir = new TemporaryDirectory()) {</span>
<span class="line-added">1903             var repo = Repository.init(dir.path(), vcs);</span>
<span class="line-added">1904             var readme = repo.root().resolve(&quot;README&quot;);</span>
<span class="line-added">1905             var now = ZonedDateTime.now();</span>
<span class="line-added">1906             Files.writeString(readme, &quot;Hello\n&quot;);</span>
<span class="line-added">1907             repo.add(readme);</span>
<span class="line-added">1908             var head = repo.commit(&quot;Added README&quot;, &quot;duke&quot;, &quot;duke@openjdk.org&quot;);</span>
<span class="line-added">1909             var tag = repo.tag(head, &quot;1.0&quot;, &quot;Added tag 1.0 for HEAD\n&quot;, &quot;duke&quot;, &quot;duke@openjdk.org&quot;);</span>
<span class="line-added">1910             var annotated = repo.annotate(tag).get();</span>
<span class="line-added">1911 </span>
<span class="line-added">1912             assertEquals(&quot;1.0&quot;, annotated.name());</span>
<span class="line-added">1913             assertEquals(head, annotated.target());</span>
<span class="line-added">1914             assertEquals(new Author(&quot;duke&quot;, &quot;duke@openjdk.org&quot;), annotated.author());</span>
<span class="line-added">1915             assertEquals(now.getYear(), annotated.date().getYear());</span>
<span class="line-added">1916             assertEquals(now.getMonth(), annotated.date().getMonth());</span>
<span class="line-added">1917             assertEquals(now.getDayOfYear(), annotated.date().getDayOfYear());</span>
<span class="line-added">1918             assertEquals(now.getHour(), annotated.date().getHour());</span>
<span class="line-added">1919             assertEquals(now.getOffset(), annotated.date().getOffset());</span>
<span class="line-added">1920             assertEquals(&quot;Added tag 1.0 for HEAD\n&quot;, annotated.message());</span>
<span class="line-added">1921         }</span>
<span class="line-added">1922     }</span>
<span class="line-added">1923 </span>
<span class="line-added">1924     @ParameterizedTest</span>
<span class="line-added">1925     @EnumSource(VCS.class)</span>
<span class="line-added">1926     void testAnnotateTagOnMissingTag(VCS vcs) throws IOException {</span>
<span class="line-added">1927         try (var dir = new TemporaryDirectory()) {</span>
<span class="line-added">1928             var repo = Repository.init(dir.path(), vcs);</span>
<span class="line-added">1929             var readme = repo.root().resolve(&quot;README&quot;);</span>
<span class="line-added">1930             var now = ZonedDateTime.now();</span>
<span class="line-added">1931             Files.writeString(readme, &quot;Hello\n&quot;);</span>
<span class="line-added">1932             repo.add(readme);</span>
<span class="line-added">1933             var head = repo.commit(&quot;Added README&quot;, &quot;duke&quot;, &quot;duke@openjdk.org&quot;);</span>
<span class="line-added">1934 </span>
<span class="line-added">1935             assertEquals(Optional.empty(), repo.annotate(new Tag(&quot;unknown&quot;)));</span>
<span class="line-added">1936         }</span>
<span class="line-added">1937     }</span>
<span class="line-added">1938 </span>
<span class="line-added">1939     @ParameterizedTest</span>
<span class="line-added">1940     @EnumSource(VCS.class)</span>
<span class="line-added">1941     void testAnnotateTagOnEmptyRepo(VCS vcs) throws IOException {</span>
<span class="line-added">1942         try (var dir = new TemporaryDirectory()) {</span>
<span class="line-added">1943             var repo = Repository.init(dir.path(), vcs);</span>
<span class="line-added">1944             assertEquals(Optional.empty(), repo.annotate(new Tag(&quot;unknown&quot;)));</span>
<span class="line-added">1945         }</span>
<span class="line-added">1946     }</span>
1947 }
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../main/java/org/openjdk/skara/vcs/hg/HgRepository.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>