<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gspawn-win32.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gspawn-win32-helper.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gspawn.c.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gspawn-win32.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -65,21 +65,21 @@</span>
  #ifdef G_SPAWN_WIN32_DEBUG
    static int debug = 1;
    #define SETUP_DEBUG() /* empty */
  #else
    static int debug = -1;
<span class="udiff-line-modified-removed">-   #define SETUP_DEBUG()                 \</span>
<span class="udiff-line-modified-removed">-     G_STMT_START                    \</span>
<span class="udiff-line-modified-removed">-       {                         \</span>
<span class="udiff-line-modified-removed">-     if (debug == -1)                \</span>
<span class="udiff-line-modified-removed">-       {                     \</span>
<span class="udiff-line-modified-removed">-         if (getenv (&quot;G_SPAWN_WIN32_DEBUG&quot;) != NULL) \</span>
<span class="udiff-line-modified-removed">-           debug = 1;                \</span>
<span class="udiff-line-modified-removed">-         else                    \</span>
<span class="udiff-line-modified-removed">-           debug = 0;                \</span>
<span class="udiff-line-modified-removed">-       }                     \</span>
<span class="udiff-line-modified-removed">-       }                         \</span>
<span class="udiff-line-modified-added">+   #define SETUP_DEBUG()         \</span>
<span class="udiff-line-modified-added">+     G_STMT_START          \</span>
<span class="udiff-line-modified-added">+       {             \</span>
<span class="udiff-line-modified-added">+   if (debug == -1)        \</span>
<span class="udiff-line-modified-added">+     {           \</span>
<span class="udiff-line-modified-added">+       if (getenv (&quot;G_SPAWN_WIN32_DEBUG&quot;) != NULL) \</span>
<span class="udiff-line-modified-added">+         debug = 1;        \</span>
<span class="udiff-line-modified-added">+       else          \</span>
<span class="udiff-line-modified-added">+         debug = 0;        \</span>
<span class="udiff-line-modified-added">+     }           \</span>
<span class="udiff-line-modified-added">+       }             \</span>
      G_STMT_END
  #endif
  #endif
  
  enum
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -103,18 +103,18 @@</span>
    ARG_PROGRAM,
    ARG_COUNT = ARG_PROGRAM
  };
  
  static int
<span class="udiff-line-modified-removed">- dup_noninherited (int fd,</span>
<span class="udiff-line-modified-removed">-           int mode)</span>
<span class="udiff-line-modified-added">+ reopen_noninherited (int fd,</span>
<span class="udiff-line-modified-added">+          int mode)</span>
  {
    HANDLE filehandle;
  
    DuplicateHandle (GetCurrentProcess (), (LPHANDLE) _get_osfhandle (fd),
<span class="udiff-line-modified-removed">-            GetCurrentProcess (), &amp;filehandle,</span>
<span class="udiff-line-modified-removed">-            0, FALSE, DUPLICATE_SAME_ACCESS);</span>
<span class="udiff-line-modified-added">+        GetCurrentProcess (), &amp;filehandle,</span>
<span class="udiff-line-modified-added">+        0, FALSE, DUPLICATE_SAME_ACCESS);</span>
    close (fd);
    return _open_osfhandle ((gintptr) filehandle, mode | _O_NOINHERIT);
  }
  
  #ifndef GSPAWN_HELPER
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -123,67 +123,78 @@</span>
  #define HELPER_PROCESS &quot;gspawn-win64-helper&quot;
  #else
  #define HELPER_PROCESS &quot;gspawn-win32-helper&quot;
  #endif
  
<span class="udiff-line-added">+ /* This logic has a copy for wchar_t in gspawn-win32-helper.c, protect_wargv() */</span>
  static gchar *
  protect_argv_string (const gchar *string)
  {
    const gchar *p = string;
    gchar *retval, *q;
    gint len = 0;
<span class="udiff-line-added">+   gint pre_bslash = 0;</span>
    gboolean need_dblquotes = FALSE;
    while (*p)
      {
        if (*p == &#39; &#39; || *p == &#39;\t&#39;)
<span class="udiff-line-modified-removed">-     need_dblquotes = TRUE;</span>
<span class="udiff-line-modified-removed">-       else if (*p == &#39;&quot;&#39;)</span>
<span class="udiff-line-modified-removed">-     len++;</span>
<span class="udiff-line-modified-removed">-       else if (*p == &#39;\\&#39;)</span>
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       const gchar *pp = p;</span>
<span class="udiff-line-removed">-       while (*pp &amp;&amp; *pp == &#39;\\&#39;)</span>
<span class="udiff-line-removed">-         pp++;</span>
<span class="udiff-line-removed">-       if (*pp == &#39;&quot;&#39;)</span>
<span class="udiff-line-removed">-         len++;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-       len++;</span>
<span class="udiff-line-modified-added">+   need_dblquotes = TRUE;</span>
<span class="udiff-line-modified-added">+       /* estimate max len, assuming that all escapable chracters will be escaped */</span>
<span class="udiff-line-modified-added">+       if (*p == &#39;&quot;&#39; || *p == &#39;\\&#39;)</span>
<span class="udiff-line-modified-added">+   len += 2;</span>
<span class="udiff-line-modified-added">+       else</span>
<span class="udiff-line-modified-added">+   len += 1;</span>
        p++;
      }
  
    q = retval = g_malloc (len + need_dblquotes*2 + 1);
    p = string;
  
    if (need_dblquotes)
      *q++ = &#39;&quot;&#39;;
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-added">+   /* Only quotes and backslashes preceeding quotes are escaped:</span>
<span class="udiff-line-added">+    * see &quot;Parsing C Command-Line Arguments&quot; at</span>
<span class="udiff-line-added">+    * https://docs.microsoft.com/en-us/cpp/c-language/parsing-c-command-line-arguments</span>
<span class="udiff-line-added">+    */</span>
    while (*p)
      {
        if (*p == &#39;&quot;&#39;)
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+     /* Add backslash for escaping quote itself */</span>
      *q++ = &#39;\\&#39;;
<span class="udiff-line-modified-removed">-       else if (*p == &#39;\\&#39;)</span>
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       const gchar *pp = p;</span>
<span class="udiff-line-modified-removed">-       while (*pp &amp;&amp; *pp == &#39;\\&#39;)</span>
<span class="udiff-line-modified-removed">-         pp++;</span>
<span class="udiff-line-modified-removed">-       if (*pp == &#39;&quot;&#39;)</span>
<span class="udiff-line-modified-removed">-         *q++ = &#39;\\&#39;;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+     /* Add backslash for every preceeding backslash for escaping it */</span>
<span class="udiff-line-modified-added">+     for (;pre_bslash &gt; 0; --pre_bslash)</span>
<span class="udiff-line-modified-added">+       *q++ = &#39;\\&#39;;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+       /* Count length of continuous sequence of preceeding backslashes. */</span>
<span class="udiff-line-modified-added">+       if (*p == &#39;\\&#39;)</span>
<span class="udiff-line-modified-added">+   ++pre_bslash;</span>
<span class="udiff-line-added">+       else</span>
<span class="udiff-line-added">+   pre_bslash = 0;</span>
<span class="udiff-line-added">+ </span>
        *q++ = *p;
        p++;
      }
  
    if (need_dblquotes)
<span class="udiff-line-modified-removed">-     *q++ = &#39;&quot;&#39;;</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-added">+       /* Add backslash for every preceeding backslash for escaping it,</span>
<span class="udiff-line-added">+        * do NOT escape quote itself.</span>
<span class="udiff-line-added">+        */</span>
<span class="udiff-line-added">+       for (;pre_bslash &gt; 0; --pre_bslash)</span>
<span class="udiff-line-added">+   *q++ = &#39;\\&#39;;</span>
<span class="udiff-line-added">+       *q++ = &#39;&quot;&#39;;</span>
<span class="udiff-line-added">+     }</span>
    *q++ = &#39;\0&#39;;
  
    return retval;
  }
  
  static gint
  protect_argv (gchar  **argv,
<span class="udiff-line-modified-removed">-           gchar ***new_argv)</span>
<span class="udiff-line-modified-added">+         gchar ***new_argv)</span>
  {
    gint i;
    gint argc = 0;
  
    while (argv[argc])
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -194,11 +205,11 @@</span>
     * reconstructed correctly in the C runtime startup code.  Note that
     * the unquoting algorithm in the C runtime is really weird, and
     * rather different than what Unix shells do. See stdargv.c in the C
     * runtime sources (in the Platform SDK, in src/crt).
     *
<span class="udiff-line-modified-removed">-    * Note that an new_argv[0] constructed by this function should</span>
<span class="udiff-line-modified-added">+    * Note that a new_argv[0] constructed by this function should</span>
     * *not* be passed as the filename argument to a spawn* or exec*
     * family function. That argument should be the real file name
     * without any quoting.
     */
    for (i = 0; i &lt; argc; i++)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -212,28 +223,28 @@</span>
  G_DEFINE_QUARK (g-exec-error-quark, g_spawn_error)
  G_DEFINE_QUARK (g-spawn-exit-error-quark, g_spawn_exit_error)
  
  gboolean
  g_spawn_async (const gchar          *working_directory,
<span class="udiff-line-modified-removed">-             gchar               **argv,</span>
<span class="udiff-line-modified-removed">-             gchar               **envp,</span>
<span class="udiff-line-modified-removed">-             GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-             GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-             gpointer              user_data,</span>
<span class="udiff-line-modified-removed">-             GPid                 *child_handle,</span>
<span class="udiff-line-modified-removed">-             GError              **error)</span>
<span class="udiff-line-modified-added">+                gchar               **argv,</span>
<span class="udiff-line-modified-added">+                gchar               **envp,</span>
<span class="udiff-line-modified-added">+                GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+                GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+                gpointer              user_data,</span>
<span class="udiff-line-modified-added">+                GPid                 *child_handle,</span>
<span class="udiff-line-modified-added">+                GError              **error)</span>
  {
    g_return_val_if_fail (argv != NULL, FALSE);
  
    return g_spawn_async_with_pipes (working_directory,
<span class="udiff-line-modified-removed">-                     argv, envp,</span>
<span class="udiff-line-modified-removed">-                     flags,</span>
<span class="udiff-line-modified-removed">-                     child_setup,</span>
<span class="udiff-line-modified-removed">-                     user_data,</span>
<span class="udiff-line-modified-removed">-                     child_handle,</span>
<span class="udiff-line-modified-removed">-                     NULL, NULL, NULL,</span>
<span class="udiff-line-modified-removed">-                     error);</span>
<span class="udiff-line-modified-added">+                                    argv, envp,</span>
<span class="udiff-line-modified-added">+                                    flags,</span>
<span class="udiff-line-modified-added">+                                    child_setup,</span>
<span class="udiff-line-modified-added">+                                    user_data,</span>
<span class="udiff-line-modified-added">+                                    child_handle,</span>
<span class="udiff-line-modified-added">+                                    NULL, NULL, NULL,</span>
<span class="udiff-line-modified-added">+                                    error);</span>
  }
  
  /* Avoids a danger in threaded situations (calling close()
   * on a file descriptor twice, and another thread has
   * re-opened it since the first close)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -308,31 +319,31 @@</span>
  /* The helper process writes a status report back to us, through a
   * pipe, consisting of two ints.
   */
  static gboolean
  read_helper_report (int      fd,
<span class="udiff-line-modified-removed">-             gintptr  report[2],</span>
<span class="udiff-line-modified-removed">-             GError **error)</span>
<span class="udiff-line-modified-added">+         gintptr  report[2],</span>
<span class="udiff-line-modified-added">+         GError **error)</span>
  {
    gint bytes = 0;
  
    while (bytes &lt; sizeof(gintptr)*2)
      {
        gint chunk;
        int errsv;
  
        if (debug)
<span class="udiff-line-modified-removed">-     g_print (&quot;%s:read_helper_report: read %&quot; G_GSIZE_FORMAT &quot;...\n&quot;,</span>
<span class="udiff-line-modified-removed">-          __FILE__,</span>
<span class="udiff-line-modified-removed">-          sizeof(gintptr)*2 - bytes);</span>
<span class="udiff-line-modified-added">+   g_print (&quot;%s:read_helper_report: read %&quot; G_GSIZE_FORMAT &quot;...\n&quot;,</span>
<span class="udiff-line-modified-added">+      __FILE__,</span>
<span class="udiff-line-modified-added">+      sizeof(gintptr)*2 - bytes);</span>
  
        chunk = read (fd, ((gchar*)report) + bytes,
<span class="udiff-line-modified-removed">-             sizeof(gintptr)*2 - bytes);</span>
<span class="udiff-line-modified-added">+         sizeof(gintptr)*2 - bytes);</span>
        errsv = errno;
  
        if (debug)
<span class="udiff-line-modified-removed">-     g_print (&quot;...got %d bytes\n&quot;, chunk);</span>
<span class="udiff-line-modified-added">+   g_print (&quot;...got %d bytes\n&quot;, chunk);</span>
  
        if (chunk &lt; 0)
          {
            /* Some weird shit happened, bail out */
            g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -340,43 +351,43 @@</span>
                         g_strerror (errsv));
  
            return FALSE;
          }
        else if (chunk == 0)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,</span>
<span class="udiff-line-modified-removed">-                _(&quot;Failed to read from child pipe (%s)&quot;),</span>
<span class="udiff-line-modified-removed">-                &quot;EOF&quot;);</span>
<span class="udiff-line-modified-removed">-       break; /* EOF */</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,</span>
<span class="udiff-line-modified-added">+            _(&quot;Failed to read from child pipe (%s)&quot;),</span>
<span class="udiff-line-modified-added">+            &quot;EOF&quot;);</span>
<span class="udiff-line-modified-added">+     break; /* EOF */</span>
<span class="udiff-line-modified-added">+   }</span>
        else
<span class="udiff-line-modified-removed">-     bytes += chunk;</span>
<span class="udiff-line-modified-added">+   bytes += chunk;</span>
      }
  
    if (bytes &lt; sizeof(gintptr)*2)
      return FALSE;
  
    return TRUE;
  }
  
  static void
  set_child_error (gintptr      report[2],
<span class="udiff-line-modified-removed">-          const gchar *working_directory,</span>
<span class="udiff-line-modified-removed">-          GError     **error)</span>
<span class="udiff-line-modified-added">+      const gchar *working_directory,</span>
<span class="udiff-line-modified-added">+      GError     **error)</span>
  {
    switch (report[0])
      {
      case CHILD_CHDIR_FAILED:
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_CHDIR,
<span class="udiff-line-modified-removed">-            _(&quot;Failed to change to directory &#39;%s&#39; (%s)&quot;),</span>
<span class="udiff-line-modified-removed">-            working_directory,</span>
<span class="udiff-line-modified-removed">-            g_strerror (report[1]));</span>
<span class="udiff-line-modified-added">+        _(&quot;Failed to change to directory &#39;%s&#39; (%s)&quot;),</span>
<span class="udiff-line-modified-added">+        working_directory,</span>
<span class="udiff-line-modified-added">+        g_strerror (report[1]));</span>
        break;
      case CHILD_SPAWN_FAILED:
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,
<span class="udiff-line-modified-removed">-            _(&quot;Failed to execute child process (%s)&quot;),</span>
<span class="udiff-line-modified-removed">-            g_strerror (report[1]));</span>
<span class="udiff-line-modified-added">+        _(&quot;Failed to execute child process (%s)&quot;),</span>
<span class="udiff-line-modified-added">+        g_strerror (report[1]));</span>
        break;
      case CHILD_SPAWN_NOENT:
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_NOENT,
                     _(&quot;Failed to execute child process (%s)&quot;),
                     g_strerror (report[1]));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -386,54 +397,54 @@</span>
      }
  }
  
  static gboolean
  utf8_charv_to_wcharv (char     **utf8_charv,
<span class="udiff-line-modified-removed">-               wchar_t ***wcharv,</span>
<span class="udiff-line-modified-removed">-               int       *error_index,</span>
<span class="udiff-line-modified-removed">-               GError   **error)</span>
<span class="udiff-line-modified-added">+           wchar_t ***wcharv,</span>
<span class="udiff-line-modified-added">+           int       *error_index,</span>
<span class="udiff-line-modified-added">+           GError   **error)</span>
  {
    wchar_t **retval = NULL;
  
    *wcharv = NULL;
    if (utf8_charv != NULL)
      {
        int n = 0, i;
  
        while (utf8_charv[n])
<span class="udiff-line-modified-removed">-     n++;</span>
<span class="udiff-line-modified-added">+   n++;</span>
        retval = g_new (wchar_t *, n + 1);
  
        for (i = 0; i &lt; n; i++)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       retval[i] = g_utf8_to_utf16 (utf8_charv[i], -1, NULL, NULL, error);</span>
<span class="udiff-line-modified-removed">-       if (retval[i] == NULL)</span>
<span class="udiff-line-modified-removed">-         {</span>
<span class="udiff-line-modified-removed">-           if (error_index)</span>
<span class="udiff-line-modified-removed">-         *error_index = i;</span>
<span class="udiff-line-modified-removed">-           while (i)</span>
<span class="udiff-line-modified-removed">-         g_free (retval[--i]);</span>
<span class="udiff-line-modified-removed">-           g_free (retval);</span>
<span class="udiff-line-modified-removed">-           return FALSE;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     retval[i] = g_utf8_to_utf16 (utf8_charv[i], -1, NULL, NULL, error);</span>
<span class="udiff-line-modified-added">+     if (retval[i] == NULL)</span>
<span class="udiff-line-modified-added">+       {</span>
<span class="udiff-line-modified-added">+         if (error_index)</span>
<span class="udiff-line-modified-added">+     *error_index = i;</span>
<span class="udiff-line-modified-added">+         while (i)</span>
<span class="udiff-line-modified-added">+     g_free (retval[--i]);</span>
<span class="udiff-line-modified-added">+         g_free (retval);</span>
<span class="udiff-line-modified-added">+         return FALSE;</span>
<span class="udiff-line-modified-added">+       }</span>
<span class="udiff-line-modified-added">+   }</span>
  
        retval[n] = NULL;
      }
    *wcharv = retval;
    return TRUE;
  }
  
  static gboolean
  do_spawn_directly (gint                 *exit_status,
<span class="udiff-line-modified-removed">-            gboolean      do_return_handle,</span>
<span class="udiff-line-modified-removed">-                    GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-                    gchar               **argv,</span>
<span class="udiff-line-modified-removed">-                    char                **envp,</span>
<span class="udiff-line-modified-removed">-                    char                **protected_argv,</span>
<span class="udiff-line-modified-removed">-                    GPid                 *child_handle,</span>
<span class="udiff-line-modified-removed">-                    GError              **error)</span>
<span class="udiff-line-modified-added">+        gboolean    do_return_handle,</span>
<span class="udiff-line-modified-added">+        GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+        gchar               **argv,</span>
<span class="udiff-line-modified-added">+        char                **envp,</span>
<span class="udiff-line-modified-added">+        char                **protected_argv,</span>
<span class="udiff-line-modified-added">+        GPid                 *child_handle,</span>
<span class="udiff-line-modified-added">+        GError              **error)</span>
  {
    const int mode = (exit_status == NULL) ? P_NOWAIT : P_WAIT;
    char **new_argv;
    gintptr rc = -1;
    int errsv;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -445,33 +456,33 @@</span>
  
    wargv0 = g_utf8_to_utf16 (argv[0], -1, NULL, NULL, &amp;conv_error);
    if (wargv0 == NULL)
      {
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,
<span class="udiff-line-modified-removed">-            _(&quot;Invalid program name: %s&quot;),</span>
<span class="udiff-line-modified-removed">-            conv_error-&gt;message);</span>
<span class="udiff-line-modified-added">+        _(&quot;Invalid program name: %s&quot;),</span>
<span class="udiff-line-modified-added">+        conv_error-&gt;message);</span>
        g_error_free (conv_error);
  
        return FALSE;
      }
  
    if (!utf8_charv_to_wcharv (new_argv, &amp;wargv, &amp;conv_error_index, &amp;conv_error))
      {
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,
<span class="udiff-line-modified-removed">-            _(&quot;Invalid string in argument vector at %d: %s&quot;),</span>
<span class="udiff-line-modified-removed">-            conv_error_index, conv_error-&gt;message);</span>
<span class="udiff-line-modified-added">+        _(&quot;Invalid string in argument vector at %d: %s&quot;),</span>
<span class="udiff-line-modified-added">+        conv_error_index, conv_error-&gt;message);</span>
        g_error_free (conv_error);
        g_free (wargv0);
  
        return FALSE;
      }
  
    if (!utf8_charv_to_wcharv (envp, &amp;wenvp, NULL, &amp;conv_error))
      {
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,
<span class="udiff-line-modified-removed">-            _(&quot;Invalid string in environment: %s&quot;),</span>
<span class="udiff-line-modified-removed">-            conv_error-&gt;message);</span>
<span class="udiff-line-modified-added">+        _(&quot;Invalid string in environment: %s&quot;),</span>
<span class="udiff-line-modified-added">+        conv_error-&gt;message);</span>
        g_error_free (conv_error);
        g_free (wargv0);
        g_strfreev ((gchar **) wargv);
  
        return FALSE;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -495,46 +506,46 @@</span>
    g_strfreev ((gchar **) wenvp);
  
    if (rc == -1 &amp;&amp; errsv != 0)
      {
        g_set_error (error, G_SPAWN_ERROR, _g_spawn_exec_err_to_g_error (errsv),
<span class="udiff-line-modified-removed">-                    _(&quot;Failed to execute child process (%s)&quot;),</span>
<span class="udiff-line-modified-removed">-            g_strerror (errsv));</span>
<span class="udiff-line-modified-added">+        _(&quot;Failed to execute child process (%s)&quot;),</span>
<span class="udiff-line-modified-added">+        g_strerror (errsv));</span>
        return FALSE;
      }
  
    if (exit_status == NULL)
      {
        if (child_handle &amp;&amp; do_return_handle)
<span class="udiff-line-modified-removed">-     *child_handle = (GPid) rc;</span>
<span class="udiff-line-modified-added">+   *child_handle = (GPid) rc;</span>
        else
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       CloseHandle ((HANDLE) rc);</span>
<span class="udiff-line-modified-removed">-       if (child_handle)</span>
<span class="udiff-line-modified-removed">-         *child_handle = 0;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     CloseHandle ((HANDLE) rc);</span>
<span class="udiff-line-modified-added">+     if (child_handle)</span>
<span class="udiff-line-modified-added">+       *child_handle = 0;</span>
<span class="udiff-line-modified-added">+   }</span>
      }
    else
      *exit_status = rc;
  
    return TRUE;
  }
  
  static gboolean
  do_spawn_with_fds (gint                 *exit_status,
<span class="udiff-line-modified-removed">-            gboolean        do_return_handle,</span>
<span class="udiff-line-modified-removed">-                    const gchar          *working_directory,</span>
<span class="udiff-line-modified-removed">-                    gchar               **argv,</span>
<span class="udiff-line-modified-removed">-                    char                **envp,</span>
<span class="udiff-line-modified-removed">-                    GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-                    GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-                    GPid                 *child_handle,</span>
<span class="udiff-line-modified-removed">-            gint                  stdin_fd,</span>
<span class="udiff-line-modified-removed">-            gint                  stdout_fd,</span>
<span class="udiff-line-modified-removed">-            gint                  stderr_fd,</span>
<span class="udiff-line-modified-removed">-            gint       *err_report,</span>
<span class="udiff-line-modified-removed">-                    GError              **error)</span>
<span class="udiff-line-modified-added">+        gboolean      do_return_handle,</span>
<span class="udiff-line-modified-added">+        const gchar          *working_directory,</span>
<span class="udiff-line-modified-added">+        gchar               **argv,</span>
<span class="udiff-line-modified-added">+        char                **envp,</span>
<span class="udiff-line-modified-added">+        GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+        GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+        GPid                 *child_handle,</span>
<span class="udiff-line-modified-added">+        gint                  stdin_fd,</span>
<span class="udiff-line-modified-added">+        gint                  stdout_fd,</span>
<span class="udiff-line-modified-added">+        gint                  stderr_fd,</span>
<span class="udiff-line-modified-added">+        gint     *err_report,</span>
<span class="udiff-line-modified-added">+        GError              **error)</span>
  {
    char **protected_argv;
    char args[ARG_COUNT][10];
    char **new_argv;
    int i;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -566,13 +577,13 @@</span>
        (working_directory == NULL || !*working_directory) &amp;&amp;
        (flags &amp; G_SPAWN_LEAVE_DESCRIPTORS_OPEN))
      {
        /* We can do without the helper process */
        gboolean retval =
<span class="udiff-line-modified-removed">-     do_spawn_directly (exit_status, do_return_handle, flags,</span>
<span class="udiff-line-modified-removed">-                argv, envp, protected_argv,</span>
<span class="udiff-line-modified-removed">-                child_handle, error);</span>
<span class="udiff-line-modified-added">+   do_spawn_directly (exit_status, do_return_handle, flags,</span>
<span class="udiff-line-modified-added">+          argv, envp, protected_argv,</span>
<span class="udiff-line-modified-added">+          child_handle, error);</span>
        g_strfreev (protected_argv);
        return retval;
      }
  
    if (!make_pipe (child_err_report_pipe, error))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -604,11 +615,11 @@</span>
    /* Make the read end of the child error report pipe
     * noninherited. Otherwise it will needlessly be inherited by the
     * helper process, and the started actual user process. As such that
     * shouldn&#39;t harm, but it is unnecessary.
     */
<span class="udiff-line-modified-removed">-   child_err_report_pipe[0] = dup_noninherited (child_err_report_pipe[0], _O_RDONLY);</span>
<span class="udiff-line-modified-added">+   child_err_report_pipe[0] = reopen_noninherited (child_err_report_pipe[0], _O_RDONLY);</span>
  
    if (flags &amp; G_SPAWN_FILE_AND_ARGV_ZERO)
      {
        /* Overload ARG_CHILD_ERR_REPORT to also encode the
         * G_SPAWN_FILE_AND_ARGV_ZERO functionality.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -623,11 +634,11 @@</span>
     * helper process will inherit it, and thus if this process happens
     * to crash before writing the sync byte to the pipe, the helper
     * process won&#39;t read but won&#39;t get any EOF either, as it has the
     * write end open itself.
     */
<span class="udiff-line-modified-removed">-   helper_sync_pipe[1] = dup_noninherited (helper_sync_pipe[1], _O_WRONLY);</span>
<span class="udiff-line-modified-added">+   helper_sync_pipe[1] = reopen_noninherited (helper_sync_pipe[1], _O_WRONLY);</span>
  
    if (stdin_fd != -1)
      {
        _g_sprintf (args[ARG_STDIN], &quot;%d&quot;, stdin_fd);
        new_argv[ARG_STDIN] = args[ARG_STDIN];
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -655,11 +666,11 @@</span>
    else
      {
        new_argv[ARG_STDOUT] = &quot;-&quot;;
      }
  
<span class="udiff-line-modified-removed">-   if (stdout_fd != -1)</span>
<span class="udiff-line-modified-added">+   if (stderr_fd != -1)</span>
      {
        _g_sprintf (args[ARG_STDERR], &quot;%d&quot;, stderr_fd);
        new_argv[ARG_STDERR] = args[ARG_STDERR];
      }
    else if (flags &amp; G_SPAWN_STDERR_TO_DEV_NULL)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -698,23 +709,23 @@</span>
  
    if (debug)
      {
        g_print (&quot;calling %s with argv:\n&quot;, helper_process);
        for (i = 0; i &lt; argc + 1 + ARG_COUNT; i++)
<span class="udiff-line-modified-removed">-     g_print (&quot;argv[%d]: %s\n&quot;, i, (new_argv[i] ? new_argv[i] : &quot;NULL&quot;));</span>
<span class="udiff-line-modified-added">+   g_print (&quot;argv[%d]: %s\n&quot;, i, (new_argv[i] ? new_argv[i] : &quot;NULL&quot;));</span>
      }
  
    if (!utf8_charv_to_wcharv (new_argv, &amp;wargv, &amp;conv_error_index, &amp;conv_error))
      {
        if (conv_error_index == ARG_WORKING_DIRECTORY)
<span class="udiff-line-modified-removed">-     g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_CHDIR,</span>
<span class="udiff-line-modified-removed">-              _(&quot;Invalid working directory: %s&quot;),</span>
<span class="udiff-line-modified-removed">-              conv_error-&gt;message);</span>
<span class="udiff-line-modified-added">+   g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_CHDIR,</span>
<span class="udiff-line-modified-added">+          _(&quot;Invalid working directory: %s&quot;),</span>
<span class="udiff-line-modified-added">+          conv_error-&gt;message);</span>
        else
<span class="udiff-line-modified-removed">-     g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,</span>
<span class="udiff-line-modified-removed">-              _(&quot;Invalid string in argument vector at %d: %s&quot;),</span>
<span class="udiff-line-modified-removed">-              conv_error_index - ARG_PROGRAM, conv_error-&gt;message);</span>
<span class="udiff-line-modified-added">+   g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,</span>
<span class="udiff-line-modified-added">+          _(&quot;Invalid string in argument vector at %d: %s&quot;),</span>
<span class="udiff-line-modified-added">+          conv_error_index - ARG_PROGRAM, conv_error-&gt;message);</span>
        g_error_free (conv_error);
        g_strfreev (protected_argv);
        g_free (new_argv[0]);
        g_free (new_argv[ARG_WORKING_DIRECTORY]);
        g_free (new_argv);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -724,12 +735,12 @@</span>
      }
  
    if (!utf8_charv_to_wcharv (envp, &amp;wenvp, NULL, &amp;conv_error))
      {
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,
<span class="udiff-line-modified-removed">-            _(&quot;Invalid string in environment: %s&quot;),</span>
<span class="udiff-line-modified-removed">-            conv_error-&gt;message);</span>
<span class="udiff-line-modified-added">+        _(&quot;Invalid string in environment: %s&quot;),</span>
<span class="udiff-line-modified-added">+        conv_error-&gt;message);</span>
        g_error_free (conv_error);
        g_strfreev (protected_argv);
        g_free (new_argv[0]);
        g_free (new_argv[ARG_WORKING_DIRECTORY]);
        g_free (new_argv);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -767,12 +778,12 @@</span>
  
    /* Check if gspawn-win32-helper couldn&#39;t be run */
    if (rc == -1 &amp;&amp; errsv != 0)
      {
        g_set_error (error, G_SPAWN_ERROR, G_SPAWN_ERROR_FAILED,
<span class="udiff-line-modified-removed">-                    _(&quot;Failed to execute helper program (%s)&quot;),</span>
<span class="udiff-line-modified-removed">-            g_strerror (errsv));</span>
<span class="udiff-line-modified-added">+        _(&quot;Failed to execute helper program (%s)&quot;),</span>
<span class="udiff-line-modified-added">+        g_strerror (errsv));</span>
        goto cleanup_and_fail;
      }
  
    if (exit_status != NULL)
      {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -787,44 +798,44 @@</span>
      }
    else
      {
        /* Asynchronous case. We read the helper&#39;s report right away. */
        if (!read_helper_report (child_err_report_pipe[0], helper_report, error))
<span class="udiff-line-modified-removed">-     goto cleanup_and_fail;</span>
<span class="udiff-line-modified-added">+   goto cleanup_and_fail;</span>
  
        close_and_invalidate (&amp;child_err_report_pipe[0]);
  
        switch (helper_report[0])
<span class="udiff-line-added">+   {</span>
<span class="udiff-line-added">+   case CHILD_NO_ERROR:</span>
<span class="udiff-line-added">+     if (child_handle &amp;&amp; do_return_handle)</span>
<span class="udiff-line-added">+       {</span>
<span class="udiff-line-added">+         /* rc is our HANDLE for gspawn-win32-helper. It has</span>
<span class="udiff-line-added">+          * told us the HANDLE of its child. Duplicate that into</span>
<span class="udiff-line-added">+          * a HANDLE valid in this process.</span>
<span class="udiff-line-added">+          */</span>
<span class="udiff-line-added">+         if (!DuplicateHandle ((HANDLE) rc, (HANDLE) helper_report[1],</span>
<span class="udiff-line-added">+             GetCurrentProcess (), (LPHANDLE) child_handle,</span>
<span class="udiff-line-added">+             0, TRUE, DUPLICATE_SAME_ACCESS))</span>
      {
<span class="udiff-line-modified-removed">-     case CHILD_NO_ERROR:</span>
<span class="udiff-line-modified-removed">-       if (child_handle &amp;&amp; do_return_handle)</span>
<span class="udiff-line-modified-removed">-         {</span>
<span class="udiff-line-removed">-           /* rc is our HANDLE for gspawn-win32-helper. It has</span>
<span class="udiff-line-removed">-            * told us the HANDLE of its child. Duplicate that into</span>
<span class="udiff-line-removed">-            * a HANDLE valid in this process.</span>
<span class="udiff-line-removed">-            */</span>
<span class="udiff-line-removed">-           if (!DuplicateHandle ((HANDLE) rc, (HANDLE) helper_report[1],</span>
<span class="udiff-line-removed">-                     GetCurrentProcess (), (LPHANDLE) child_handle,</span>
<span class="udiff-line-removed">-                     0, TRUE, DUPLICATE_SAME_ACCESS))</span>
<span class="udiff-line-removed">-         {</span>
<span class="udiff-line-removed">-           char *emsg = g_win32_error_message (GetLastError ());</span>
<span class="udiff-line-removed">-           g_print(&quot;%s\n&quot;, emsg);</span>
<span class="udiff-line-removed">-           *child_handle = 0;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-       else if (child_handle)</span>
<span class="udiff-line-removed">-         *child_handle = 0;</span>
<span class="udiff-line-removed">-       write (helper_sync_pipe[1], &quot; &quot;, 1);</span>
<span class="udiff-line-removed">-       close_and_invalidate (&amp;helper_sync_pipe[1]);</span>
<span class="udiff-line-removed">-       break;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     default:</span>
<span class="udiff-line-removed">-       write (helper_sync_pipe[1], &quot; &quot;, 1);</span>
<span class="udiff-line-removed">-       close_and_invalidate (&amp;helper_sync_pipe[1]);</span>
<span class="udiff-line-removed">-       set_child_error (helper_report, working_directory, error);</span>
<span class="udiff-line-removed">-       goto cleanup_and_fail;</span>
<span class="udiff-line-modified-added">+       char *emsg = g_win32_error_message (GetLastError ());</span>
<span class="udiff-line-modified-added">+       g_print(&quot;%s\n&quot;, emsg);</span>
<span class="udiff-line-modified-added">+       *child_handle = 0;</span>
      }
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     else if (child_handle)</span>
<span class="udiff-line-added">+       *child_handle = 0;</span>
<span class="udiff-line-added">+     write (helper_sync_pipe[1], &quot; &quot;, 1);</span>
<span class="udiff-line-added">+     close_and_invalidate (&amp;helper_sync_pipe[1]);</span>
<span class="udiff-line-added">+     break;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   default:</span>
<span class="udiff-line-added">+     write (helper_sync_pipe[1], &quot; &quot;, 1);</span>
<span class="udiff-line-added">+     close_and_invalidate (&amp;helper_sync_pipe[1]);</span>
<span class="udiff-line-added">+     set_child_error (helper_report, working_directory, error);</span>
<span class="udiff-line-added">+     goto cleanup_and_fail;</span>
<span class="udiff-line-added">+   }</span>
      }
  
    /* Success against all odds! return the information */
  
    if (rc != -1)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -848,22 +859,22 @@</span>
    return FALSE;
  }
  
  static gboolean
  do_spawn_with_pipes (gint                 *exit_status,
<span class="udiff-line-modified-removed">-              gboolean          do_return_handle,</span>
<span class="udiff-line-modified-removed">-              const gchar          *working_directory,</span>
<span class="udiff-line-modified-removed">-              gchar               **argv,</span>
<span class="udiff-line-modified-removed">-              char                **envp,</span>
<span class="udiff-line-modified-removed">-              GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-              GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-              GPid                 *child_handle,</span>
<span class="udiff-line-modified-removed">-              gint                 *standard_input,</span>
<span class="udiff-line-modified-removed">-              gint                 *standard_output,</span>
<span class="udiff-line-modified-removed">-              gint                 *standard_error,</span>
<span class="udiff-line-modified-removed">-              gint         *err_report,</span>
<span class="udiff-line-modified-removed">-              GError              **error)</span>
<span class="udiff-line-modified-added">+          gboolean      do_return_handle,</span>
<span class="udiff-line-modified-added">+          const gchar          *working_directory,</span>
<span class="udiff-line-modified-added">+          gchar               **argv,</span>
<span class="udiff-line-modified-added">+          char                **envp,</span>
<span class="udiff-line-modified-added">+          GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+          GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+          GPid                 *child_handle,</span>
<span class="udiff-line-modified-added">+          gint                 *standard_input,</span>
<span class="udiff-line-modified-added">+          gint                 *standard_output,</span>
<span class="udiff-line-modified-added">+          gint                 *standard_error,</span>
<span class="udiff-line-modified-added">+          gint     *err_report,</span>
<span class="udiff-line-modified-added">+          GError              **error)</span>
  {
    int stdin_pipe[2] = { -1, -1 };
    int stdout_pipe[2] = { -1, -1 };
    int stderr_pipe[2] = { -1, -1 };
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -875,22 +886,22 @@</span>
  
    if (standard_error &amp;&amp; !make_pipe (stderr_pipe, error))
      goto cleanup_and_fail;
  
    if (!do_spawn_with_fds (exit_status,
<span class="udiff-line-modified-removed">-               do_return_handle,</span>
<span class="udiff-line-modified-removed">-               working_directory,</span>
<span class="udiff-line-modified-removed">-               argv,</span>
<span class="udiff-line-modified-removed">-               envp,</span>
<span class="udiff-line-modified-removed">-               flags,</span>
<span class="udiff-line-modified-removed">-               child_setup,</span>
<span class="udiff-line-modified-removed">-               child_handle,</span>
<span class="udiff-line-modified-removed">-               stdin_pipe[0],</span>
<span class="udiff-line-modified-removed">-               stdout_pipe[1],</span>
<span class="udiff-line-modified-removed">-               stderr_pipe[1],</span>
<span class="udiff-line-modified-removed">-               err_report,</span>
<span class="udiff-line-modified-removed">-               error))</span>
<span class="udiff-line-modified-added">+         do_return_handle,</span>
<span class="udiff-line-modified-added">+         working_directory,</span>
<span class="udiff-line-modified-added">+         argv,</span>
<span class="udiff-line-modified-added">+         envp,</span>
<span class="udiff-line-modified-added">+         flags,</span>
<span class="udiff-line-modified-added">+         child_setup,</span>
<span class="udiff-line-modified-added">+         child_handle,</span>
<span class="udiff-line-modified-added">+         stdin_pipe[0],</span>
<span class="udiff-line-modified-added">+         stdout_pipe[1],</span>
<span class="udiff-line-modified-added">+         stderr_pipe[1],</span>
<span class="udiff-line-modified-added">+         err_report,</span>
<span class="udiff-line-modified-added">+         error))</span>
      goto cleanup_and_fail;
  
    /* Close the other process&#39;s ends of the pipes in this process,
     * otherwise the reader will never get EOF.
     */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -925,19 +936,19 @@</span>
    return FALSE;
  }
  
  gboolean
  g_spawn_sync (const gchar          *working_directory,
<span class="udiff-line-modified-removed">-            gchar               **argv,</span>
<span class="udiff-line-modified-removed">-            gchar               **envp,</span>
<span class="udiff-line-modified-removed">-            GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-            GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-            gpointer              user_data,</span>
<span class="udiff-line-modified-removed">-            gchar               **standard_output,</span>
<span class="udiff-line-modified-removed">-            gchar               **standard_error,</span>
<span class="udiff-line-modified-removed">-            gint                 *exit_status,</span>
<span class="udiff-line-modified-removed">-            GError              **error)</span>
<span class="udiff-line-modified-added">+               gchar               **argv,</span>
<span class="udiff-line-modified-added">+               gchar               **envp,</span>
<span class="udiff-line-modified-added">+               GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+               GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+               gpointer              user_data,</span>
<span class="udiff-line-modified-added">+               gchar               **standard_output,</span>
<span class="udiff-line-modified-added">+               gchar               **standard_error,</span>
<span class="udiff-line-modified-added">+               gint                 *exit_status,</span>
<span class="udiff-line-modified-added">+               GError              **error)</span>
  {
    gint outpipe = -1;
    gint errpipe = -1;
    gint reportpipe = -1;
    GIOChannel *outchannel = NULL;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -968,22 +979,22 @@</span>
  
    if (standard_error)
      *standard_error = NULL;
  
    if (!do_spawn_with_pipes (&amp;status,
<span class="udiff-line-modified-removed">-                 FALSE,</span>
<span class="udiff-line-modified-removed">-                 working_directory,</span>
<span class="udiff-line-modified-removed">-                 argv,</span>
<span class="udiff-line-modified-removed">-                 envp,</span>
<span class="udiff-line-modified-removed">-                 flags,</span>
<span class="udiff-line-modified-removed">-                 child_setup,</span>
<span class="udiff-line-modified-removed">-                 NULL,</span>
<span class="udiff-line-modified-removed">-                 NULL,</span>
<span class="udiff-line-modified-removed">-                 standard_output ? &amp;outpipe : NULL,</span>
<span class="udiff-line-modified-removed">-                 standard_error ? &amp;errpipe : NULL,</span>
<span class="udiff-line-modified-removed">-                 &amp;reportpipe,</span>
<span class="udiff-line-modified-removed">-                 error))</span>
<span class="udiff-line-modified-added">+           FALSE,</span>
<span class="udiff-line-modified-added">+           working_directory,</span>
<span class="udiff-line-modified-added">+           argv,</span>
<span class="udiff-line-modified-added">+           envp,</span>
<span class="udiff-line-modified-added">+           flags,</span>
<span class="udiff-line-modified-added">+           child_setup,</span>
<span class="udiff-line-modified-added">+           NULL,</span>
<span class="udiff-line-modified-added">+           NULL,</span>
<span class="udiff-line-modified-added">+           standard_output ? &amp;outpipe : NULL,</span>
<span class="udiff-line-modified-added">+           standard_error ? &amp;errpipe : NULL,</span>
<span class="udiff-line-modified-added">+           &amp;reportpipe,</span>
<span class="udiff-line-modified-added">+           error))</span>
      return FALSE;
  
    /* Read data from child. */
  
    failed = FALSE;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -993,49 +1004,49 @@</span>
        outstr = g_string_new (NULL);
        outchannel = g_io_channel_win32_new_fd (outpipe);
        g_io_channel_set_encoding (outchannel, NULL, NULL);
        g_io_channel_set_buffered (outchannel, FALSE);
        g_io_channel_win32_make_pollfd (outchannel,
<span class="udiff-line-modified-removed">-                       G_IO_IN | G_IO_ERR | G_IO_HUP,</span>
<span class="udiff-line-modified-removed">-                       &amp;outfd);</span>
<span class="udiff-line-modified-added">+               G_IO_IN | G_IO_ERR | G_IO_HUP,</span>
<span class="udiff-line-modified-added">+               &amp;outfd);</span>
        if (debug)
<span class="udiff-line-modified-removed">-     g_print (&quot;outfd=%p\n&quot;, (HANDLE) outfd.fd);</span>
<span class="udiff-line-modified-added">+   g_print (&quot;outfd=%p\n&quot;, (HANDLE) outfd.fd);</span>
      }
  
    if (errpipe &gt;= 0)
      {
        errstr = g_string_new (NULL);
        errchannel = g_io_channel_win32_new_fd (errpipe);
        g_io_channel_set_encoding (errchannel, NULL, NULL);
        g_io_channel_set_buffered (errchannel, FALSE);
        g_io_channel_win32_make_pollfd (errchannel,
<span class="udiff-line-modified-removed">-                       G_IO_IN | G_IO_ERR | G_IO_HUP,</span>
<span class="udiff-line-modified-removed">-                       &amp;errfd);</span>
<span class="udiff-line-modified-added">+               G_IO_IN | G_IO_ERR | G_IO_HUP,</span>
<span class="udiff-line-modified-added">+               &amp;errfd);</span>
        if (debug)
<span class="udiff-line-modified-removed">-     g_print (&quot;errfd=%p\n&quot;, (HANDLE) errfd.fd);</span>
<span class="udiff-line-modified-added">+   g_print (&quot;errfd=%p\n&quot;, (HANDLE) errfd.fd);</span>
      }
  
    /* Read data until we get EOF on all pipes. */
    while (!failed &amp;&amp; (outpipe &gt;= 0 || errpipe &gt;= 0))
      {
        nfds = 0;
        if (outpipe &gt;= 0)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       fds[nfds] = outfd;</span>
<span class="udiff-line-modified-removed">-       outindex = nfds;</span>
<span class="udiff-line-modified-removed">-       nfds++;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     fds[nfds] = outfd;</span>
<span class="udiff-line-modified-added">+     outindex = nfds;</span>
<span class="udiff-line-modified-added">+     nfds++;</span>
<span class="udiff-line-modified-added">+   }</span>
        if (errpipe &gt;= 0)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       fds[nfds] = errfd;</span>
<span class="udiff-line-modified-removed">-       errindex = nfds;</span>
<span class="udiff-line-modified-removed">-       nfds++;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     fds[nfds] = errfd;</span>
<span class="udiff-line-modified-added">+     errindex = nfds;</span>
<span class="udiff-line-modified-added">+     nfds++;</span>
<span class="udiff-line-modified-added">+   }</span>
  
        if (debug)
<span class="udiff-line-modified-removed">-     g_print (&quot;g_spawn_sync: calling g_io_channel_win32_poll, nfds=%d\n&quot;,</span>
<span class="udiff-line-modified-removed">-          nfds);</span>
<span class="udiff-line-modified-added">+   g_print (&quot;g_spawn_sync: calling g_io_channel_win32_poll, nfds=%d\n&quot;,</span>
<span class="udiff-line-modified-added">+      nfds);</span>
  
        ret = g_io_channel_win32_poll (fds, nfds, -1);
  
        if (ret &lt; 0)
          {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1050,24 +1061,24 @@</span>
        if (outpipe &gt;= 0 &amp;&amp; (fds[outindex].revents &amp; G_IO_IN))
          {
            switch (read_data (outstr, outchannel, error))
              {
              case READ_FAILED:
<span class="udiff-line-modified-removed">-           if (debug)</span>
<span class="udiff-line-modified-removed">-         g_print (&quot;g_spawn_sync: outchannel: READ_FAILED\n&quot;);</span>
<span class="udiff-line-modified-added">+         if (debug)</span>
<span class="udiff-line-modified-added">+     g_print (&quot;g_spawn_sync: outchannel: READ_FAILED\n&quot;);</span>
                failed = TRUE;
                break;
              case READ_EOF:
<span class="udiff-line-modified-removed">-           if (debug)</span>
<span class="udiff-line-modified-removed">-         g_print (&quot;g_spawn_sync: outchannel: READ_EOF\n&quot;);</span>
<span class="udiff-line-modified-added">+         if (debug)</span>
<span class="udiff-line-modified-added">+     g_print (&quot;g_spawn_sync: outchannel: READ_EOF\n&quot;);</span>
                g_io_channel_unref (outchannel);
<span class="udiff-line-modified-removed">-           outchannel = NULL;</span>
<span class="udiff-line-modified-added">+         outchannel = NULL;</span>
                close_and_invalidate (&amp;outpipe);
                break;
              default:
<span class="udiff-line-modified-removed">-           if (debug)</span>
<span class="udiff-line-modified-removed">-         g_print (&quot;g_spawn_sync: outchannel: OK\n&quot;);</span>
<span class="udiff-line-modified-added">+         if (debug)</span>
<span class="udiff-line-modified-added">+     g_print (&quot;g_spawn_sync: outchannel: OK\n&quot;);</span>
                break;
              }
  
            if (failed)
              break;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1076,24 +1087,24 @@</span>
        if (errpipe &gt;= 0 &amp;&amp; (fds[errindex].revents &amp; G_IO_IN))
          {
            switch (read_data (errstr, errchannel, error))
              {
              case READ_FAILED:
<span class="udiff-line-modified-removed">-           if (debug)</span>
<span class="udiff-line-modified-removed">-         g_print (&quot;g_spawn_sync: errchannel: READ_FAILED\n&quot;);</span>
<span class="udiff-line-modified-added">+         if (debug)</span>
<span class="udiff-line-modified-added">+     g_print (&quot;g_spawn_sync: errchannel: READ_FAILED\n&quot;);</span>
                failed = TRUE;
                break;
              case READ_EOF:
<span class="udiff-line-modified-removed">-           if (debug)</span>
<span class="udiff-line-modified-removed">-         g_print (&quot;g_spawn_sync: errchannel: READ_EOF\n&quot;);</span>
<span class="udiff-line-modified-removed">-           g_io_channel_unref (errchannel);</span>
<span class="udiff-line-modified-removed">-           errchannel = NULL;</span>
<span class="udiff-line-modified-added">+         if (debug)</span>
<span class="udiff-line-modified-added">+     g_print (&quot;g_spawn_sync: errchannel: READ_EOF\n&quot;);</span>
<span class="udiff-line-modified-added">+         g_io_channel_unref (errchannel);</span>
<span class="udiff-line-modified-added">+         errchannel = NULL;</span>
                close_and_invalidate (&amp;errpipe);
                break;
              default:
<span class="udiff-line-modified-removed">-           if (debug)</span>
<span class="udiff-line-modified-removed">-         g_print (&quot;g_spawn_sync: errchannel: OK\n&quot;);</span>
<span class="udiff-line-modified-added">+         if (debug)</span>
<span class="udiff-line-modified-added">+     g_print (&quot;g_spawn_sync: errchannel: OK\n&quot;);</span>
                break;
              }
  
            if (failed)
              break;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1114,25 +1125,25 @@</span>
         * grandchild has finished.
         */
        gintptr helper_report[2];
  
        if (!read_helper_report (reportpipe, helper_report, error))
<span class="udiff-line-modified-removed">-     failed = TRUE;</span>
<span class="udiff-line-modified-added">+   failed = TRUE;</span>
        else
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       switch (helper_report[0])</span>
<span class="udiff-line-modified-removed">-         {</span>
<span class="udiff-line-modified-removed">-         case CHILD_NO_ERROR:</span>
<span class="udiff-line-modified-removed">-           if (exit_status)</span>
<span class="udiff-line-modified-removed">-         *exit_status = helper_report[1];</span>
<span class="udiff-line-modified-removed">-           break;</span>
<span class="udiff-line-modified-removed">-         default:</span>
<span class="udiff-line-modified-removed">-           set_child_error (helper_report, working_directory, error);</span>
<span class="udiff-line-modified-removed">-           failed = TRUE;</span>
<span class="udiff-line-modified-removed">-           break;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     switch (helper_report[0])</span>
<span class="udiff-line-modified-added">+       {</span>
<span class="udiff-line-modified-added">+       case CHILD_NO_ERROR:</span>
<span class="udiff-line-modified-added">+         if (exit_status)</span>
<span class="udiff-line-modified-added">+     *exit_status = helper_report[1];</span>
<span class="udiff-line-modified-added">+         break;</span>
<span class="udiff-line-modified-added">+       default:</span>
<span class="udiff-line-modified-added">+         set_child_error (helper_report, working_directory, error);</span>
<span class="udiff-line-modified-added">+         failed = TRUE;</span>
<span class="udiff-line-modified-added">+         break;</span>
<span class="udiff-line-modified-added">+       }</span>
<span class="udiff-line-modified-added">+   }</span>
        close_and_invalidate (&amp;reportpipe);
      }
  
  
    /* These should only be open still if we had an error.  */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1167,20 +1178,20 @@</span>
      }
  }
  
  gboolean
  g_spawn_async_with_pipes (const gchar          *working_directory,
<span class="udiff-line-modified-removed">-                    gchar               **argv,</span>
<span class="udiff-line-modified-removed">-                    gchar               **envp,</span>
<span class="udiff-line-modified-removed">-                    GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-                    GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-                    gpointer              user_data,</span>
<span class="udiff-line-modified-removed">-                    GPid                 *child_handle,</span>
<span class="udiff-line-modified-removed">-                    gint                 *standard_input,</span>
<span class="udiff-line-modified-removed">-                    gint                 *standard_output,</span>
<span class="udiff-line-modified-removed">-                    gint                 *standard_error,</span>
<span class="udiff-line-modified-removed">-                    GError              **error)</span>
<span class="udiff-line-modified-added">+                           gchar               **argv,</span>
<span class="udiff-line-modified-added">+                           gchar               **envp,</span>
<span class="udiff-line-modified-added">+                           GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+                           GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+                           gpointer              user_data,</span>
<span class="udiff-line-modified-added">+                           GPid                 *child_handle,</span>
<span class="udiff-line-modified-added">+                           gint                 *standard_input,</span>
<span class="udiff-line-modified-added">+                           gint                 *standard_output,</span>
<span class="udiff-line-modified-added">+                           gint                 *standard_error,</span>
<span class="udiff-line-modified-added">+                           GError              **error)</span>
  {
    g_return_val_if_fail (argv != NULL, FALSE);
    g_return_val_if_fail (standard_output == NULL ||
                          !(flags &amp; G_SPAWN_STDOUT_TO_DEV_NULL), FALSE);
    g_return_val_if_fail (standard_error == NULL ||
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1188,22 +1199,22 @@</span>
    /* can&#39;t inherit stdin if we have an input pipe. */
    g_return_val_if_fail (standard_input == NULL ||
                          !(flags &amp; G_SPAWN_CHILD_INHERITS_STDIN), FALSE);
  
    return do_spawn_with_pipes (NULL,
<span class="udiff-line-modified-removed">-                   (flags &amp; G_SPAWN_DO_NOT_REAP_CHILD),</span>
<span class="udiff-line-modified-removed">-                   working_directory,</span>
<span class="udiff-line-modified-removed">-                   argv,</span>
<span class="udiff-line-modified-removed">-                   envp,</span>
<span class="udiff-line-modified-removed">-                   flags,</span>
<span class="udiff-line-modified-removed">-                   child_setup,</span>
<span class="udiff-line-modified-removed">-                   child_handle,</span>
<span class="udiff-line-modified-removed">-                   standard_input,</span>
<span class="udiff-line-modified-removed">-                   standard_output,</span>
<span class="udiff-line-modified-removed">-                   standard_error,</span>
<span class="udiff-line-modified-removed">-                   NULL,</span>
<span class="udiff-line-modified-removed">-                   error);</span>
<span class="udiff-line-modified-added">+             (flags &amp; G_SPAWN_DO_NOT_REAP_CHILD),</span>
<span class="udiff-line-modified-added">+             working_directory,</span>
<span class="udiff-line-modified-added">+             argv,</span>
<span class="udiff-line-modified-added">+             envp,</span>
<span class="udiff-line-modified-added">+             flags,</span>
<span class="udiff-line-modified-added">+             child_setup,</span>
<span class="udiff-line-modified-added">+             child_handle,</span>
<span class="udiff-line-modified-added">+             standard_input,</span>
<span class="udiff-line-modified-added">+             standard_output,</span>
<span class="udiff-line-modified-added">+             standard_error,</span>
<span class="udiff-line-modified-added">+             NULL,</span>
<span class="udiff-line-modified-added">+             error);</span>
  }
  
  gboolean
  g_spawn_async_with_fds (const gchar          *working_directory,
                          gchar               **argv,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1225,30 +1236,30 @@</span>
    /* can&#39;t inherit stdin if we have an input pipe. */
    g_return_val_if_fail (stdin_fd == -1 ||
                          !(flags &amp; G_SPAWN_CHILD_INHERITS_STDIN), FALSE);
  
    return do_spawn_with_fds (NULL,
<span class="udiff-line-modified-removed">-                 (flags &amp; G_SPAWN_DO_NOT_REAP_CHILD),</span>
<span class="udiff-line-modified-removed">-                 working_directory,</span>
<span class="udiff-line-modified-removed">-                 argv,</span>
<span class="udiff-line-modified-removed">-                 envp,</span>
<span class="udiff-line-modified-removed">-                 flags,</span>
<span class="udiff-line-modified-removed">-                 child_setup,</span>
<span class="udiff-line-modified-removed">-                 child_handle,</span>
<span class="udiff-line-modified-removed">-                 stdin_fd,</span>
<span class="udiff-line-modified-removed">-                 stdout_fd,</span>
<span class="udiff-line-modified-removed">-                 stderr_fd,</span>
<span class="udiff-line-modified-removed">-                 NULL,</span>
<span class="udiff-line-modified-removed">-                 error);</span>
<span class="udiff-line-modified-added">+           (flags &amp; G_SPAWN_DO_NOT_REAP_CHILD),</span>
<span class="udiff-line-modified-added">+           working_directory,</span>
<span class="udiff-line-modified-added">+           argv,</span>
<span class="udiff-line-modified-added">+           envp,</span>
<span class="udiff-line-modified-added">+           flags,</span>
<span class="udiff-line-modified-added">+           child_setup,</span>
<span class="udiff-line-modified-added">+           child_handle,</span>
<span class="udiff-line-modified-added">+           stdin_fd,</span>
<span class="udiff-line-modified-added">+           stdout_fd,</span>
<span class="udiff-line-modified-added">+           stderr_fd,</span>
<span class="udiff-line-modified-added">+           NULL,</span>
<span class="udiff-line-modified-added">+           error);</span>
  }
  
  gboolean
  g_spawn_command_line_sync (const gchar  *command_line,
<span class="udiff-line-modified-removed">-                 gchar       **standard_output,</span>
<span class="udiff-line-modified-removed">-                 gchar       **standard_error,</span>
<span class="udiff-line-modified-removed">-                 gint         *exit_status,</span>
<span class="udiff-line-modified-removed">-                 GError      **error)</span>
<span class="udiff-line-modified-added">+                            gchar       **standard_output,</span>
<span class="udiff-line-modified-added">+                            gchar       **standard_error,</span>
<span class="udiff-line-modified-added">+                            gint         *exit_status,</span>
<span class="udiff-line-modified-added">+                            GError      **error)</span>
  {
    gboolean retval;
    gchar **argv = 0;
  
    g_return_val_if_fail (command_line != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1257,27 +1268,27 @@</span>
                             NULL, &amp;argv,
                             error))
      return FALSE;
  
    retval = g_spawn_sync (NULL,
<span class="udiff-line-modified-removed">-                   argv,</span>
<span class="udiff-line-modified-removed">-                   NULL,</span>
<span class="udiff-line-modified-removed">-                   G_SPAWN_SEARCH_PATH,</span>
<span class="udiff-line-modified-removed">-                   NULL,</span>
<span class="udiff-line-modified-removed">-                   NULL,</span>
<span class="udiff-line-modified-removed">-                   standard_output,</span>
<span class="udiff-line-modified-removed">-                   standard_error,</span>
<span class="udiff-line-modified-removed">-                   exit_status,</span>
<span class="udiff-line-modified-removed">-                   error);</span>
<span class="udiff-line-modified-added">+                          argv,</span>
<span class="udiff-line-modified-added">+                          NULL,</span>
<span class="udiff-line-modified-added">+                          G_SPAWN_SEARCH_PATH,</span>
<span class="udiff-line-modified-added">+                          NULL,</span>
<span class="udiff-line-modified-added">+                          NULL,</span>
<span class="udiff-line-modified-added">+                          standard_output,</span>
<span class="udiff-line-modified-added">+                          standard_error,</span>
<span class="udiff-line-modified-added">+                          exit_status,</span>
<span class="udiff-line-modified-added">+                          error);</span>
    g_strfreev (argv);
  
    return retval;
  }
  
  gboolean
  g_spawn_command_line_async (const gchar *command_line,
<span class="udiff-line-modified-removed">-                  GError     **error)</span>
<span class="udiff-line-modified-added">+                             GError     **error)</span>
  {
    gboolean retval;
    gchar **argv = 0;
  
    g_return_val_if_fail (command_line != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1286,17 +1297,17 @@</span>
                             NULL, &amp;argv,
                             error))
      return FALSE;
  
    retval = g_spawn_async (NULL,
<span class="udiff-line-modified-removed">-                    argv,</span>
<span class="udiff-line-modified-removed">-                    NULL,</span>
<span class="udiff-line-modified-removed">-                    G_SPAWN_SEARCH_PATH,</span>
<span class="udiff-line-modified-removed">-                    NULL,</span>
<span class="udiff-line-modified-removed">-                    NULL,</span>
<span class="udiff-line-modified-removed">-                    NULL,</span>
<span class="udiff-line-modified-removed">-                    error);</span>
<span class="udiff-line-modified-added">+                           argv,</span>
<span class="udiff-line-modified-added">+                           NULL,</span>
<span class="udiff-line-modified-added">+                           G_SPAWN_SEARCH_PATH,</span>
<span class="udiff-line-modified-added">+                           NULL,</span>
<span class="udiff-line-modified-added">+                           NULL,</span>
<span class="udiff-line-modified-added">+                           NULL,</span>
<span class="udiff-line-modified-added">+                           error);</span>
    g_strfreev (argv);
  
    return retval;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1306,19 +1317,19 @@</span>
      CloseHandle (pid);
  }
  
  gboolean
  g_spawn_check_exit_status (gint      exit_status,
<span class="udiff-line-modified-removed">-                GError  **error)</span>
<span class="udiff-line-modified-added">+          GError  **error)</span>
  {
    gboolean ret = FALSE;
  
    if (exit_status != 0)
      {
        g_set_error (error, G_SPAWN_EXIT_ERROR, exit_status,
<span class="udiff-line-modified-removed">-            _(&quot;Child process exited with code %ld&quot;),</span>
<span class="udiff-line-modified-removed">-            (long) exit_status);</span>
<span class="udiff-line-modified-added">+        _(&quot;Child process exited with code %ld&quot;),</span>
<span class="udiff-line-modified-added">+        (long) exit_status);</span>
        goto out;
      }
  
    ret = TRUE;
   out:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1367,95 +1378,95 @@</span>
  _GLIB_EXTERN gboolean g_spawn_command_line_async_utf8 (const gchar           *command_line,
                                                         GError               **error);
  
  gboolean
  g_spawn_async_utf8 (const gchar          *working_directory,
<span class="udiff-line-modified-removed">-                           gchar               **argv,</span>
<span class="udiff-line-modified-removed">-                           gchar               **envp,</span>
<span class="udiff-line-modified-removed">-                           GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-                           GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-                           gpointer              user_data,</span>
<span class="udiff-line-modified-removed">-                           GPid                 *child_handle,</span>
<span class="udiff-line-modified-removed">-                           GError              **error)</span>
<span class="udiff-line-modified-added">+                     gchar               **argv,</span>
<span class="udiff-line-modified-added">+                     gchar               **envp,</span>
<span class="udiff-line-modified-added">+                     GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+                     GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+                     gpointer              user_data,</span>
<span class="udiff-line-modified-added">+                     GPid                 *child_handle,</span>
<span class="udiff-line-modified-added">+                     GError              **error)</span>
  {
    return g_spawn_async (working_directory,
                          argv,
                          envp,
                          flags,
                          child_setup,
                          user_data,
<span class="udiff-line-modified-removed">-                       child_handle,</span>
<span class="udiff-line-modified-removed">-                       error);</span>
<span class="udiff-line-modified-added">+                         child_handle,</span>
<span class="udiff-line-modified-added">+                         error);</span>
  }
  
  gboolean
  g_spawn_async_with_pipes_utf8 (const gchar          *working_directory,
<span class="udiff-line-modified-removed">-            gchar               **argv,</span>
<span class="udiff-line-modified-removed">-            gchar               **envp,</span>
<span class="udiff-line-modified-removed">-            GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-            GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-            gpointer              user_data,</span>
<span class="udiff-line-modified-removed">-            GPid                 *child_handle,</span>
<span class="udiff-line-modified-added">+                                gchar               **argv,</span>
<span class="udiff-line-modified-added">+                                gchar               **envp,</span>
<span class="udiff-line-modified-added">+                                GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+                                GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+                                gpointer              user_data,</span>
<span class="udiff-line-modified-added">+                                GPid                 *child_handle,</span>
                                 gint                 *standard_input,
                                 gint                 *standard_output,
                                 gint                 *standard_error,
<span class="udiff-line-modified-removed">-            GError              **error)</span>
<span class="udiff-line-modified-added">+                                GError              **error)</span>
  {
    return g_spawn_async_with_pipes (working_directory,
                                     argv,
                                     envp,
<span class="udiff-line-modified-removed">-                    flags,</span>
<span class="udiff-line-modified-removed">-                    child_setup,</span>
<span class="udiff-line-modified-removed">-                    user_data,</span>
<span class="udiff-line-modified-removed">-                    child_handle,</span>
<span class="udiff-line-modified-added">+                                    flags,</span>
<span class="udiff-line-modified-added">+                                    child_setup,</span>
<span class="udiff-line-modified-added">+                                    user_data,</span>
<span class="udiff-line-modified-added">+                                    child_handle,</span>
                                     standard_input,
                                     standard_output,
                                     standard_error,
<span class="udiff-line-modified-removed">-                    error);</span>
<span class="udiff-line-modified-added">+                                    error);</span>
  }
  
  gboolean
  g_spawn_sync_utf8 (const gchar          *working_directory,
<span class="udiff-line-modified-removed">-           gchar               **argv,</span>
<span class="udiff-line-modified-removed">-           gchar               **envp,</span>
<span class="udiff-line-modified-removed">-           GSpawnFlags           flags,</span>
<span class="udiff-line-modified-removed">-           GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-removed">-           gpointer              user_data,</span>
<span class="udiff-line-modified-removed">-           gchar               **standard_output,</span>
<span class="udiff-line-modified-removed">-           gchar               **standard_error,</span>
<span class="udiff-line-modified-removed">-           gint                 *exit_status,</span>
<span class="udiff-line-modified-removed">-           GError              **error)</span>
<span class="udiff-line-modified-added">+                    gchar               **argv,</span>
<span class="udiff-line-modified-added">+                    gchar               **envp,</span>
<span class="udiff-line-modified-added">+                    GSpawnFlags           flags,</span>
<span class="udiff-line-modified-added">+                    GSpawnChildSetupFunc  child_setup,</span>
<span class="udiff-line-modified-added">+                    gpointer              user_data,</span>
<span class="udiff-line-modified-added">+                    gchar               **standard_output,</span>
<span class="udiff-line-modified-added">+                    gchar               **standard_error,</span>
<span class="udiff-line-modified-added">+                    gint                 *exit_status,</span>
<span class="udiff-line-modified-added">+                    GError              **error)</span>
  {
    return g_spawn_sync (working_directory,
                         argv,
                         envp,
                         flags,
                         child_setup,
                         user_data,
                         standard_output,
                         standard_error,
                         exit_status,
<span class="udiff-line-modified-removed">-                   error);</span>
<span class="udiff-line-modified-added">+                        error);</span>
  }
  
  gboolean
  g_spawn_command_line_sync_utf8 (const gchar  *command_line,
<span class="udiff-line-modified-removed">-                gchar       **standard_output,</span>
<span class="udiff-line-modified-removed">-                gchar       **standard_error,</span>
<span class="udiff-line-modified-removed">-                gint         *exit_status,</span>
<span class="udiff-line-modified-removed">-                GError      **error)</span>
<span class="udiff-line-modified-added">+                                 gchar       **standard_output,</span>
<span class="udiff-line-modified-added">+                                 gchar       **standard_error,</span>
<span class="udiff-line-modified-added">+                                 gint         *exit_status,</span>
<span class="udiff-line-modified-added">+                                 GError      **error)</span>
  {
    return g_spawn_command_line_sync (command_line,
<span class="udiff-line-modified-removed">-                          standard_output,</span>
<span class="udiff-line-modified-removed">-                          standard_error,</span>
<span class="udiff-line-modified-removed">-                          exit_status,</span>
<span class="udiff-line-modified-removed">-                          error);</span>
<span class="udiff-line-modified-added">+                                     standard_output,</span>
<span class="udiff-line-modified-added">+                                     standard_error,</span>
<span class="udiff-line-modified-added">+                                     exit_status,</span>
<span class="udiff-line-modified-added">+                                     error);</span>
  }
  
  gboolean
  g_spawn_command_line_async_utf8 (const gchar *command_line,
<span class="udiff-line-modified-removed">-                 GError     **error)</span>
<span class="udiff-line-modified-added">+                                  GError     **error)</span>
  {
    return g_spawn_command_line_async (command_line, error);
  }
  
  #endif /* G_OS_WIN32 */
</pre>
<center><a href="gspawn-win32-helper.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gspawn.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>