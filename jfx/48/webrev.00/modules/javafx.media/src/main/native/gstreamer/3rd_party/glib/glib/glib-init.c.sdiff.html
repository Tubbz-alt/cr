<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/glib-init.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="glib-autocleanups.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="glib-init.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/glib-init.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright ï¿½ 2011 Canonical Limited</span>
  3  *
  4  * This library is free software; you can redistribute it and/or
  5  * modify it under the terms of the GNU Lesser General Public
  6  * License as published by the Free Software Foundation; either
  7  * version 2.1 of the License, or (at your option) any later version.
  8  *
  9  * This library is distributed in the hope that it will be useful, but
 10  * WITHOUT ANY WARRANTY; without even the implied warranty of
 11  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 12  * Lesser General Public License for more details.
 13  *
 14  * You should have received a copy of the GNU Lesser General Public
 15  * License along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 16  *
 17  * Author: Ryan Lortie &lt;desrt@desrt.ca&gt;
 18  */
 19 
 20 #include &quot;config.h&quot;
 21 
 22 #include &quot;glib-init.h&quot;
<span class="line-modified"> 23 </span>
<span class="line-removed"> 24 #include &quot;glib-private.h&quot;</span>
 25 #include &quot;gtypes.h&quot;
 26 #include &quot;gutils.h&quot;     /* for GDebugKey */
 27 #include &quot;gconstructor.h&quot;
 28 #include &quot;gmem.h&quot;       /* for g_mem_gc_friendly */
 29 
 30 #include &lt;string.h&gt;
 31 #include &lt;stdlib.h&gt;
 32 #include &lt;stdio.h&gt;
 33 #include &lt;ctype.h&gt;
 34 
 35 /* This seems as good a place as any to make static assertions about platform
 36  * assumptions we make throughout GLib. */
 37 
 38 /* We do not support 36-bit bytes or other historical curiosities. */
 39 G_STATIC_ASSERT (CHAR_BIT == 8);
 40 
 41 /* We assume that data pointers are the same size as function pointers... */
 42 G_STATIC_ASSERT (sizeof (gpointer) == sizeof (GFunc));
<span class="line-modified"> 43 G_STATIC_ASSERT (_g_alignof (gpointer) == _g_alignof (GFunc));</span>
 44 /* ... and that all function pointers are the same size. */
 45 G_STATIC_ASSERT (sizeof (GFunc) == sizeof (GCompareDataFunc));
<span class="line-modified"> 46 G_STATIC_ASSERT (_g_alignof (GFunc) == _g_alignof (GCompareDataFunc));</span>
 47 
 48 /* We assume that &quot;small&quot; enums (those where all values fit in INT32_MIN
 49  * to INT32_MAX) are exactly int-sized. In particular, we assume that if
 50  * an enum has no members that exceed the range of char/short, the
 51  * compiler will make it int-sized anyway, so adding a member later that
 52  * *does* exceed the range of char/short is not an ABI break. */
 53 typedef enum {
 54     TEST_CHAR_0 = 0
 55 } TestChar;
 56 typedef enum {
 57     TEST_SHORT_0 = 0,
 58     TEST_SHORT_256 = 256
 59 } TestShort;
 60 typedef enum {
 61     TEST_INT32_MIN = G_MININT32,
 62     TEST_INT32_MAX = G_MAXINT32
 63 } TestInt;
 64 G_STATIC_ASSERT (sizeof (TestChar) == sizeof (int));
 65 G_STATIC_ASSERT (sizeof (TestShort) == sizeof (int));
 66 G_STATIC_ASSERT (sizeof (TestInt) == sizeof (int));
<span class="line-modified"> 67 G_STATIC_ASSERT (_g_alignof (TestChar) == _g_alignof (int));</span>
<span class="line-modified"> 68 G_STATIC_ASSERT (_g_alignof (TestShort) == _g_alignof (int));</span>
<span class="line-modified"> 69 G_STATIC_ASSERT (_g_alignof (TestInt) == _g_alignof (int));</span>
 70 
 71 /**
 72  * g_mem_gc_friendly:
 73  *
 74  * This variable is %TRUE if the `G_DEBUG` environment variable
 75  * includes the key `gc-friendly`.
 76  */
 77 gboolean g_mem_gc_friendly = FALSE;
 78 
 79 GLogLevelFlags g_log_msg_prefix = G_LOG_LEVEL_ERROR | G_LOG_LEVEL_WARNING |
 80                                   G_LOG_LEVEL_CRITICAL | G_LOG_LEVEL_DEBUG;
 81 GLogLevelFlags g_log_always_fatal = G_LOG_FATAL_MASK;
 82 
 83 static gboolean
 84 debug_key_matches (const gchar *key,
 85                    const gchar *token,
 86                    guint        length)
 87 {
 88   /* may not call GLib functions: see note in g_parse_debug_string() */
 89   for (; length; length--, key++, token++)
</pre>
<hr />
<pre>
135 {
136   guint i;
137   guint result = 0;
138 
139   if (string == NULL)
140     return 0;
141 
142   /* this function is used during the initialisation of gmessages, gmem
143    * and gslice, so it may not do anything that causes memory to be
144    * allocated or risks messages being emitted.
145    *
146    * this means, more or less, that this code may not call anything
147    * inside GLib.
148    */
149 
150   if (!strcasecmp (string, &quot;help&quot;))
151     {
152       /* using stdio directly for the reason stated above */
153       fprintf (stderr, &quot;Supported debug values:&quot;);
154       for (i = 0; i &lt; nkeys; i++)
<span class="line-modified">155        fprintf (stderr, &quot; %s&quot;, keys[i].key);</span>
156       fprintf (stderr, &quot; all help\n&quot;);
157     }
158   else
159     {
160       const gchar *p = string;
161       const gchar *q;
162       gboolean invert = FALSE;
163 
164       while (*p)
165        {
166          q = strpbrk (p, &quot;:;, \t&quot;);
167          if (!q)
168            q = p + strlen (p);
169 
170          if (debug_key_matches (&quot;all&quot;, p, q - p))
171            {
172              invert = TRUE;
173            }
174          else
175            {
</pre>
<hr />
<pre>
270   g_quark_init ();
271 }
272 
273 #if defined (G_OS_WIN32)
274 
275 BOOL WINAPI DllMain (HINSTANCE hinstDLL,
276                      DWORD     fdwReason,
277                      LPVOID    lpvReserved);
278 
279 HMODULE glib_dll;
280 
281 BOOL WINAPI
282 DllMain (HINSTANCE hinstDLL,
283          DWORD     fdwReason,
284          LPVOID    lpvReserved)
285 {
286   switch (fdwReason)
287     {
288     case DLL_PROCESS_ATTACH:
289       glib_dll = hinstDLL;



290       g_clock_win32_init ();
291 #ifdef THREADS_WIN32
292       g_thread_win32_init ();
293 #endif
294       glib_init ();
295       /* must go after glib_init */
296       g_console_win32_init ();
297       break;
298 
299     case DLL_THREAD_DETACH:
300 #ifdef THREADS_WIN32
301       g_thread_win32_thread_detach ();
302 #endif
303       break;
304 
305     case DLL_PROCESS_DETACH:
306 #ifdef THREADS_WIN32
307       if (lpvReserved == NULL)
308         g_thread_win32_process_detach ();
309 #endif



310       break;
311 
312     default:
313       /* do nothing */
314       ;
315     }
316 
317   return TRUE;
318 }
319 
320 #elif defined (G_HAS_CONSTRUCTORS)
321 
322 #ifdef G_DEFINE_CONSTRUCTOR_NEEDS_PRAGMA
323 #pragma G_DEFINE_CONSTRUCTOR_PRAGMA_ARGS(glib_init_ctor)
324 #endif
325 G_DEFINE_CONSTRUCTOR(glib_init_ctor)
326 
327 static void
328 glib_init_ctor (void)
329 {
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2011 Canonical Limited</span>
  3  *
  4  * This library is free software; you can redistribute it and/or
  5  * modify it under the terms of the GNU Lesser General Public
  6  * License as published by the Free Software Foundation; either
  7  * version 2.1 of the License, or (at your option) any later version.
  8  *
  9  * This library is distributed in the hope that it will be useful, but
 10  * WITHOUT ANY WARRANTY; without even the implied warranty of
 11  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 12  * Lesser General Public License for more details.
 13  *
 14  * You should have received a copy of the GNU Lesser General Public
 15  * License along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 16  *
 17  * Author: Ryan Lortie &lt;desrt@desrt.ca&gt;
 18  */
 19 
 20 #include &quot;config.h&quot;
 21 
 22 #include &quot;glib-init.h&quot;
<span class="line-modified"> 23 #include &quot;gmacros.h&quot;</span>

 24 #include &quot;gtypes.h&quot;
 25 #include &quot;gutils.h&quot;     /* for GDebugKey */
 26 #include &quot;gconstructor.h&quot;
 27 #include &quot;gmem.h&quot;       /* for g_mem_gc_friendly */
 28 
 29 #include &lt;string.h&gt;
 30 #include &lt;stdlib.h&gt;
 31 #include &lt;stdio.h&gt;
 32 #include &lt;ctype.h&gt;
 33 
 34 /* This seems as good a place as any to make static assertions about platform
 35  * assumptions we make throughout GLib. */
 36 
 37 /* We do not support 36-bit bytes or other historical curiosities. */
 38 G_STATIC_ASSERT (CHAR_BIT == 8);
 39 
 40 /* We assume that data pointers are the same size as function pointers... */
 41 G_STATIC_ASSERT (sizeof (gpointer) == sizeof (GFunc));
<span class="line-modified"> 42 G_STATIC_ASSERT (G_ALIGNOF (gpointer) == G_ALIGNOF (GFunc));</span>
 43 /* ... and that all function pointers are the same size. */
 44 G_STATIC_ASSERT (sizeof (GFunc) == sizeof (GCompareDataFunc));
<span class="line-modified"> 45 G_STATIC_ASSERT (G_ALIGNOF (GFunc) == G_ALIGNOF (GCompareDataFunc));</span>
 46 
 47 /* We assume that &quot;small&quot; enums (those where all values fit in INT32_MIN
 48  * to INT32_MAX) are exactly int-sized. In particular, we assume that if
 49  * an enum has no members that exceed the range of char/short, the
 50  * compiler will make it int-sized anyway, so adding a member later that
 51  * *does* exceed the range of char/short is not an ABI break. */
 52 typedef enum {
 53     TEST_CHAR_0 = 0
 54 } TestChar;
 55 typedef enum {
 56     TEST_SHORT_0 = 0,
 57     TEST_SHORT_256 = 256
 58 } TestShort;
 59 typedef enum {
 60     TEST_INT32_MIN = G_MININT32,
 61     TEST_INT32_MAX = G_MAXINT32
 62 } TestInt;
 63 G_STATIC_ASSERT (sizeof (TestChar) == sizeof (int));
 64 G_STATIC_ASSERT (sizeof (TestShort) == sizeof (int));
 65 G_STATIC_ASSERT (sizeof (TestInt) == sizeof (int));
<span class="line-modified"> 66 G_STATIC_ASSERT (G_ALIGNOF (TestChar) == G_ALIGNOF (int));</span>
<span class="line-modified"> 67 G_STATIC_ASSERT (G_ALIGNOF (TestShort) == G_ALIGNOF (int));</span>
<span class="line-modified"> 68 G_STATIC_ASSERT (G_ALIGNOF (TestInt) == G_ALIGNOF (int));</span>
 69 
 70 /**
 71  * g_mem_gc_friendly:
 72  *
 73  * This variable is %TRUE if the `G_DEBUG` environment variable
 74  * includes the key `gc-friendly`.
 75  */
 76 gboolean g_mem_gc_friendly = FALSE;
 77 
 78 GLogLevelFlags g_log_msg_prefix = G_LOG_LEVEL_ERROR | G_LOG_LEVEL_WARNING |
 79                                   G_LOG_LEVEL_CRITICAL | G_LOG_LEVEL_DEBUG;
 80 GLogLevelFlags g_log_always_fatal = G_LOG_FATAL_MASK;
 81 
 82 static gboolean
 83 debug_key_matches (const gchar *key,
 84                    const gchar *token,
 85                    guint        length)
 86 {
 87   /* may not call GLib functions: see note in g_parse_debug_string() */
 88   for (; length; length--, key++, token++)
</pre>
<hr />
<pre>
134 {
135   guint i;
136   guint result = 0;
137 
138   if (string == NULL)
139     return 0;
140 
141   /* this function is used during the initialisation of gmessages, gmem
142    * and gslice, so it may not do anything that causes memory to be
143    * allocated or risks messages being emitted.
144    *
145    * this means, more or less, that this code may not call anything
146    * inside GLib.
147    */
148 
149   if (!strcasecmp (string, &quot;help&quot;))
150     {
151       /* using stdio directly for the reason stated above */
152       fprintf (stderr, &quot;Supported debug values:&quot;);
153       for (i = 0; i &lt; nkeys; i++)
<span class="line-modified">154         fprintf (stderr, &quot; %s&quot;, keys[i].key);</span>
155       fprintf (stderr, &quot; all help\n&quot;);
156     }
157   else
158     {
159       const gchar *p = string;
160       const gchar *q;
161       gboolean invert = FALSE;
162 
163       while (*p)
164        {
165          q = strpbrk (p, &quot;:;, \t&quot;);
166          if (!q)
167            q = p + strlen (p);
168 
169          if (debug_key_matches (&quot;all&quot;, p, q - p))
170            {
171              invert = TRUE;
172            }
173          else
174            {
</pre>
<hr />
<pre>
269   g_quark_init ();
270 }
271 
272 #if defined (G_OS_WIN32)
273 
274 BOOL WINAPI DllMain (HINSTANCE hinstDLL,
275                      DWORD     fdwReason,
276                      LPVOID    lpvReserved);
277 
278 HMODULE glib_dll;
279 
280 BOOL WINAPI
281 DllMain (HINSTANCE hinstDLL,
282          DWORD     fdwReason,
283          LPVOID    lpvReserved)
284 {
285   switch (fdwReason)
286     {
287     case DLL_PROCESS_ATTACH:
288       glib_dll = hinstDLL;
<span class="line-added">289 #ifndef GSTREAMER_LITE</span>
<span class="line-added">290       g_crash_handler_win32_init ();</span>
<span class="line-added">291 #endif // GSTREAMER_LITE</span>
292       g_clock_win32_init ();
293 #ifdef THREADS_WIN32
294       g_thread_win32_init ();
295 #endif
296       glib_init ();
297       /* must go after glib_init */
298       g_console_win32_init ();
299       break;
300 
301     case DLL_THREAD_DETACH:
302 #ifdef THREADS_WIN32
303       g_thread_win32_thread_detach ();
304 #endif
305       break;
306 
307     case DLL_PROCESS_DETACH:
308 #ifdef THREADS_WIN32
309       if (lpvReserved == NULL)
310         g_thread_win32_process_detach ();
311 #endif
<span class="line-added">312 #ifndef GSTREAMER_LITE</span>
<span class="line-added">313       g_crash_handler_win32_deinit ();</span>
<span class="line-added">314 #endif // GSTREAMER_LITE</span>
315       break;
316 
317     default:
318       /* do nothing */
319       ;
320     }
321 
322   return TRUE;
323 }
324 
325 #elif defined (G_HAS_CONSTRUCTORS)
326 
327 #ifdef G_DEFINE_CONSTRUCTOR_NEEDS_PRAGMA
328 #pragma G_DEFINE_CONSTRUCTOR_PRAGMA_ARGS(glib_init_ctor)
329 #endif
330 G_DEFINE_CONSTRUCTOR(glib_init_ctor)
331 
332 static void
333 glib_init_ctor (void)
334 {
</pre>
</td>
</tr>
</table>
<center><a href="glib-autocleanups.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="glib-init.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>