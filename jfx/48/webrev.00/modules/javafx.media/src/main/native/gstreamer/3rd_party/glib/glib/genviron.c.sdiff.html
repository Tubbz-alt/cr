<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/genviron.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gdir.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gerror.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/genviron.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 27 #include &quot;genviron.h&quot;
 28 
 29 #include &lt;stdlib.h&gt;
 30 #include &lt;string.h&gt;
 31 #ifdef HAVE_CRT_EXTERNS_H
 32 #include &lt;crt_externs.h&gt; /* for _NSGetEnviron */
 33 #endif
 34 #ifdef G_OS_WIN32
 35 #include &lt;windows.h&gt;
 36 #endif
 37 
 38 #include &quot;glib-private.h&quot;
 39 #include &quot;gmem.h&quot;
 40 #include &quot;gmessages.h&quot;
 41 #include &quot;gstrfuncs.h&quot;
 42 #include &quot;gunicode.h&quot;
 43 #include &quot;gconvert.h&quot;
 44 #include &quot;gquark.h&quot;
 45 
 46 /* Environ array functions {{{1 */












 47 static gint
 48 g_environ_find (gchar       **envp,
 49                 const gchar  *variable)
 50 {
<span class="line-modified"> 51   gint len, i;</span>

 52 
 53   if (envp == NULL)
 54     return -1;
 55 
 56   len = strlen (variable);
 57 
 58   for (i = 0; envp[i]; i++)
 59     {
<span class="line-modified"> 60       if (strncmp (envp[i], variable, len) == 0 &amp;&amp;</span>
<span class="line-removed"> 61           envp[i][len] == &#39;=&#39;)</span>
 62         return i;
 63     }
 64 
 65   return -1;
 66 }
 67 
 68 /**
 69  * g_environ_getenv:
 70  * @envp: (nullable) (array zero-terminated=1) (transfer none) (element-type filename):
 71  *     an environment list (eg, as returned from g_get_environ()), or %NULL
 72  *     for an empty environment list
 73  * @variable: (type filename): the environment variable to get
 74  *
 75  * Returns the value of the environment variable @variable in the
 76  * provided list @envp.
 77  *
 78  * Returns: (type filename): the value of the environment variable, or %NULL if
 79  *     the environment variable is not set in @envp. The returned
 80  *     string is owned by @envp, and will be freed if @variable is
 81  *     set or unset again.
</pre>
<hr />
<pre>
138         }
139     }
140   else
141     {
142       gint length;
143 
144       length = envp ? g_strv_length (envp) : 0;
145       envp = g_renew (gchar *, envp, length + 2);
146       envp[length] = g_strdup_printf (&quot;%s=%s&quot;, variable, value);
147       envp[length + 1] = NULL;
148     }
149 
150   return envp;
151 }
152 
153 static gchar **
154 g_environ_unsetenv_internal (gchar        **envp,
155                              const gchar   *variable,
156                              gboolean       free_value)
157 {
<span class="line-modified">158   gint len;</span>
159   gchar **e, **f;
160 
161   len = strlen (variable);
162 
163   /* Note that we remove *all* environment entries for
164    * the variable name, not just the first.
165    */
166   e = f = envp;
167   while (*e != NULL)
168     {
<span class="line-modified">169       if (strncmp (*e, variable, len) != 0 || (*e)[len] != &#39;=&#39;)</span>
170         {
171           *f = *e;
172           f++;
173         }
174       else
175         {
176           if (free_value)
177             g_free (*e);
178         }
179 
180       e++;
181     }
182   *f = NULL;
183 
184   return envp;
185 }
186 
187 
188 /**
189  * g_environ_unsetenv:
</pre>
<hr />
<pre>
639 #endif  /* G_OS_WIN32 */
640 
641 #ifdef G_OS_WIN32
642 
643 /* Binary compatibility versions. Not for newly compiled code. */
644 
645 _GLIB_EXTERN const gchar *g_getenv_utf8   (const gchar  *variable);
646 _GLIB_EXTERN gboolean     g_setenv_utf8   (const gchar  *variable,
647                                            const gchar  *value,
648                                            gboolean      overwrite);
649 _GLIB_EXTERN void         g_unsetenv_utf8 (const gchar  *variable);
650 
651 const gchar *
652 g_getenv_utf8 (const gchar *variable)
653 {
654   return g_getenv (variable);
655 }
656 
657 gboolean
658 g_setenv_utf8 (const gchar *variable,
<span class="line-modified">659           const gchar *value,</span>
<span class="line-modified">660           gboolean     overwrite)</span>
661 {
662   return g_setenv (variable, value, overwrite);
663 }
664 
665 void
666 g_unsetenv_utf8 (const gchar *variable)
667 {
668   g_unsetenv (variable);
669 }
670 
671 #endif
672 
673 /* Epilogue {{{1 */
674 /* vim: set foldmethod=marker: */
</pre>
</td>
<td>
<hr />
<pre>
 27 #include &quot;genviron.h&quot;
 28 
 29 #include &lt;stdlib.h&gt;
 30 #include &lt;string.h&gt;
 31 #ifdef HAVE_CRT_EXTERNS_H
 32 #include &lt;crt_externs.h&gt; /* for _NSGetEnviron */
 33 #endif
 34 #ifdef G_OS_WIN32
 35 #include &lt;windows.h&gt;
 36 #endif
 37 
 38 #include &quot;glib-private.h&quot;
 39 #include &quot;gmem.h&quot;
 40 #include &quot;gmessages.h&quot;
 41 #include &quot;gstrfuncs.h&quot;
 42 #include &quot;gunicode.h&quot;
 43 #include &quot;gconvert.h&quot;
 44 #include &quot;gquark.h&quot;
 45 
 46 /* Environ array functions {{{1 */
<span class="line-added"> 47 static gboolean</span>
<span class="line-added"> 48 g_environ_matches (const gchar *env, const gchar *variable, gsize len)</span>
<span class="line-added"> 49 {</span>
<span class="line-added"> 50 #ifdef G_OS_WIN32</span>
<span class="line-added"> 51     /* TODO handle Unicode environment variable names */</span>
<span class="line-added"> 52     /* Like filesystem paths, environment variables are case-insensitive. */</span>
<span class="line-added"> 53     return g_ascii_strncasecmp (env, variable, len) == 0 &amp;&amp; env[len] == &#39;=&#39;;</span>
<span class="line-added"> 54 #else</span>
<span class="line-added"> 55     return strncmp (env, variable, len) == 0 &amp;&amp; env[len] == &#39;=&#39;;</span>
<span class="line-added"> 56 #endif</span>
<span class="line-added"> 57 }</span>
<span class="line-added"> 58 </span>
 59 static gint
 60 g_environ_find (gchar       **envp,
 61                 const gchar  *variable)
 62 {
<span class="line-modified"> 63   gsize len;</span>
<span class="line-added"> 64   gint i;</span>
 65 
 66   if (envp == NULL)
 67     return -1;
 68 
 69   len = strlen (variable);
 70 
 71   for (i = 0; envp[i]; i++)
 72     {
<span class="line-modified"> 73       if (g_environ_matches (envp[i], variable, len))</span>

 74         return i;
 75     }
 76 
 77   return -1;
 78 }
 79 
 80 /**
 81  * g_environ_getenv:
 82  * @envp: (nullable) (array zero-terminated=1) (transfer none) (element-type filename):
 83  *     an environment list (eg, as returned from g_get_environ()), or %NULL
 84  *     for an empty environment list
 85  * @variable: (type filename): the environment variable to get
 86  *
 87  * Returns the value of the environment variable @variable in the
 88  * provided list @envp.
 89  *
 90  * Returns: (type filename): the value of the environment variable, or %NULL if
 91  *     the environment variable is not set in @envp. The returned
 92  *     string is owned by @envp, and will be freed if @variable is
 93  *     set or unset again.
</pre>
<hr />
<pre>
150         }
151     }
152   else
153     {
154       gint length;
155 
156       length = envp ? g_strv_length (envp) : 0;
157       envp = g_renew (gchar *, envp, length + 2);
158       envp[length] = g_strdup_printf (&quot;%s=%s&quot;, variable, value);
159       envp[length + 1] = NULL;
160     }
161 
162   return envp;
163 }
164 
165 static gchar **
166 g_environ_unsetenv_internal (gchar        **envp,
167                              const gchar   *variable,
168                              gboolean       free_value)
169 {
<span class="line-modified">170   gsize len;</span>
171   gchar **e, **f;
172 
173   len = strlen (variable);
174 
175   /* Note that we remove *all* environment entries for
176    * the variable name, not just the first.
177    */
178   e = f = envp;
179   while (*e != NULL)
180     {
<span class="line-modified">181       if (!g_environ_matches (*e, variable, len))</span>
182         {
183           *f = *e;
184           f++;
185         }
186       else
187         {
188           if (free_value)
189             g_free (*e);
190         }
191 
192       e++;
193     }
194   *f = NULL;
195 
196   return envp;
197 }
198 
199 
200 /**
201  * g_environ_unsetenv:
</pre>
<hr />
<pre>
651 #endif  /* G_OS_WIN32 */
652 
653 #ifdef G_OS_WIN32
654 
655 /* Binary compatibility versions. Not for newly compiled code. */
656 
657 _GLIB_EXTERN const gchar *g_getenv_utf8   (const gchar  *variable);
658 _GLIB_EXTERN gboolean     g_setenv_utf8   (const gchar  *variable,
659                                            const gchar  *value,
660                                            gboolean      overwrite);
661 _GLIB_EXTERN void         g_unsetenv_utf8 (const gchar  *variable);
662 
663 const gchar *
664 g_getenv_utf8 (const gchar *variable)
665 {
666   return g_getenv (variable);
667 }
668 
669 gboolean
670 g_setenv_utf8 (const gchar *variable,
<span class="line-modified">671                const gchar *value,</span>
<span class="line-modified">672                gboolean     overwrite)</span>
673 {
674   return g_setenv (variable, value, overwrite);
675 }
676 
677 void
678 g_unsetenv_utf8 (const gchar *variable)
679 {
680   g_unsetenv (variable);
681 }
682 
683 #endif
684 
685 /* Epilogue {{{1 */
686 /* vim: set foldmethod=marker: */
</pre>
</td>
</tr>
</table>
<center><a href="gdir.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gerror.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>