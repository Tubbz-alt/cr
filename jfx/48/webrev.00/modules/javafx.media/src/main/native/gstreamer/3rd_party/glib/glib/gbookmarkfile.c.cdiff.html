<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gbookmarkfile.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gbitlock.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gbookmarkfile.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gbookmarkfile.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 93,66 ***</span>
   *
   * The #GBookmarkFile parser was added in GLib 2.12.
   */
  
  /* XBEL 1.0 standard entities */
<span class="line-modified">! #define XBEL_VERSION        &quot;1.0&quot;</span>
<span class="line-modified">! #define XBEL_DTD_NICK       &quot;xbel&quot;</span>
<span class="line-modified">! #define XBEL_DTD_SYSTEM     &quot;+//IDN python.org//DTD XML Bookmark &quot; \</span>
<span class="line-modified">!                 &quot;Exchange Language 1.0//EN//XML&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define XBEL_DTD_URI        &quot;http://www.python.org/topics/xml/dtds/xbel-1.0.dtd&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define XBEL_ROOT_ELEMENT   &quot;xbel&quot;</span>
<span class="line-modified">! #define XBEL_FOLDER_ELEMENT &quot;folder&quot;    /* unused */</span>
<span class="line-modified">! #define XBEL_BOOKMARK_ELEMENT   &quot;bookmark&quot;</span>
<span class="line-modified">! #define XBEL_ALIAS_ELEMENT  &quot;alias&quot;     /* unused */</span>
<span class="line-modified">! #define XBEL_SEPARATOR_ELEMENT  &quot;separator&quot;     /* unused */</span>
  #define XBEL_TITLE_ELEMENT  &quot;title&quot;
<span class="line-modified">! #define XBEL_DESC_ELEMENT   &quot;desc&quot;</span>
<span class="line-modified">! #define XBEL_INFO_ELEMENT   &quot;info&quot;</span>
<span class="line-modified">! #define XBEL_METADATA_ELEMENT   &quot;metadata&quot;</span>
  
  #define XBEL_VERSION_ATTRIBUTE  &quot;version&quot;
<span class="line-modified">! #define XBEL_FOLDED_ATTRIBUTE   &quot;folded&quot;    /* unused */</span>
<span class="line-modified">! #define XBEL_OWNER_ATTRIBUTE    &quot;owner&quot;</span>
<span class="line-modified">! #define XBEL_ADDED_ATTRIBUTE    &quot;added&quot;</span>
  #define XBEL_VISITED_ATTRIBUTE  &quot;visited&quot;
  #define XBEL_MODIFIED_ATTRIBUTE &quot;modified&quot;
<span class="line-modified">! #define XBEL_ID_ATTRIBUTE   &quot;id&quot;</span>
  #define XBEL_HREF_ATTRIBUTE &quot;href&quot;
<span class="line-modified">! #define XBEL_REF_ATTRIBUTE  &quot;ref&quot;       /* unused */</span>
  
<span class="line-modified">! #define XBEL_YES_VALUE      &quot;yes&quot;</span>
<span class="line-modified">! #define XBEL_NO_VALUE       &quot;no&quot;</span>
  
  /* Desktop bookmark spec entities */
<span class="line-modified">! #define BOOKMARK_METADATA_OWNER     &quot;http://freedesktop.org&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define BOOKMARK_NAMESPACE_NAME     &quot;bookmark&quot;</span>
<span class="line-modified">! #define BOOKMARK_NAMESPACE_URI      &quot;http://www.freedesktop.org/standards/desktop-bookmarks&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define BOOKMARK_GROUPS_ELEMENT     &quot;groups&quot;</span>
<span class="line-modified">! #define BOOKMARK_GROUP_ELEMENT      &quot;group&quot;</span>
<span class="line-modified">! #define BOOKMARK_APPLICATIONS_ELEMENT   &quot;applications&quot;</span>
<span class="line-modified">! #define BOOKMARK_APPLICATION_ELEMENT    &quot;application&quot;</span>
<span class="line-modified">! #define BOOKMARK_ICON_ELEMENT       &quot;icon&quot;</span>
<span class="line-modified">! #define BOOKMARK_PRIVATE_ELEMENT    &quot;private&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define BOOKMARK_NAME_ATTRIBUTE     &quot;name&quot;</span>
<span class="line-modified">! #define BOOKMARK_EXEC_ATTRIBUTE     &quot;exec&quot;</span>
<span class="line-modified">! #define BOOKMARK_COUNT_ATTRIBUTE    &quot;count&quot;</span>
<span class="line-modified">! #define BOOKMARK_TIMESTAMP_ATTRIBUTE    &quot;timestamp&quot;     /* deprecated by &quot;modified&quot; */</span>
  #define BOOKMARK_MODIFIED_ATTRIBUTE     &quot;modified&quot;
<span class="line-modified">! #define BOOKMARK_HREF_ATTRIBUTE     &quot;href&quot;</span>
<span class="line-modified">! #define BOOKMARK_TYPE_ATTRIBUTE     &quot;type&quot;</span>
  
  /* Shared MIME Info entities */
<span class="line-modified">! #define MIME_NAMESPACE_NAME         &quot;mime&quot;</span>
<span class="line-modified">! #define MIME_NAMESPACE_URI      &quot;http://www.freedesktop.org/standards/shared-mime-info&quot;</span>
<span class="line-modified">! #define MIME_TYPE_ELEMENT       &quot;mime-type&quot;</span>
<span class="line-modified">! #define MIME_TYPE_ATTRIBUTE         &quot;type&quot;</span>
  
  
  typedef struct _BookmarkAppInfo  BookmarkAppInfo;
  typedef struct _BookmarkMetadata BookmarkMetadata;
  typedef struct _BookmarkItem     BookmarkItem;
<span class="line-new-header">--- 93,66 ---</span>
   *
   * The #GBookmarkFile parser was added in GLib 2.12.
   */
  
  /* XBEL 1.0 standard entities */
<span class="line-modified">! #define XBEL_VERSION    &quot;1.0&quot;</span>
<span class="line-modified">! #define XBEL_DTD_NICK   &quot;xbel&quot;</span>
<span class="line-modified">! #define XBEL_DTD_SYSTEM   &quot;+//IDN python.org//DTD XML Bookmark &quot; \</span>
<span class="line-modified">!         &quot;Exchange Language 1.0//EN//XML&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define XBEL_DTD_URI    &quot;http://www.python.org/topics/xml/dtds/xbel-1.0.dtd&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define XBEL_ROOT_ELEMENT &quot;xbel&quot;</span>
<span class="line-modified">! #define XBEL_FOLDER_ELEMENT &quot;folder&quot;  /* unused */</span>
<span class="line-modified">! #define XBEL_BOOKMARK_ELEMENT &quot;bookmark&quot;</span>
<span class="line-modified">! #define XBEL_ALIAS_ELEMENT  &quot;alias&quot;   /* unused */</span>
<span class="line-modified">! #define XBEL_SEPARATOR_ELEMENT  &quot;separator&quot;   /* unused */</span>
  #define XBEL_TITLE_ELEMENT  &quot;title&quot;
<span class="line-modified">! #define XBEL_DESC_ELEMENT &quot;desc&quot;</span>
<span class="line-modified">! #define XBEL_INFO_ELEMENT &quot;info&quot;</span>
<span class="line-modified">! #define XBEL_METADATA_ELEMENT &quot;metadata&quot;</span>
  
  #define XBEL_VERSION_ATTRIBUTE  &quot;version&quot;
<span class="line-modified">! #define XBEL_FOLDED_ATTRIBUTE &quot;folded&quot;  /* unused */</span>
<span class="line-modified">! #define XBEL_OWNER_ATTRIBUTE  &quot;owner&quot;</span>
<span class="line-modified">! #define XBEL_ADDED_ATTRIBUTE  &quot;added&quot;</span>
  #define XBEL_VISITED_ATTRIBUTE  &quot;visited&quot;
  #define XBEL_MODIFIED_ATTRIBUTE &quot;modified&quot;
<span class="line-modified">! #define XBEL_ID_ATTRIBUTE &quot;id&quot;</span>
  #define XBEL_HREF_ATTRIBUTE &quot;href&quot;
<span class="line-modified">! #define XBEL_REF_ATTRIBUTE  &quot;ref&quot;     /* unused */</span>
  
<span class="line-modified">! #define XBEL_YES_VALUE    &quot;yes&quot;</span>
<span class="line-modified">! #define XBEL_NO_VALUE   &quot;no&quot;</span>
  
  /* Desktop bookmark spec entities */
<span class="line-modified">! #define BOOKMARK_METADATA_OWNER   &quot;http://freedesktop.org&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define BOOKMARK_NAMESPACE_NAME   &quot;bookmark&quot;</span>
<span class="line-modified">! #define BOOKMARK_NAMESPACE_URI    &quot;http://www.freedesktop.org/standards/desktop-bookmarks&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define BOOKMARK_GROUPS_ELEMENT   &quot;groups&quot;</span>
<span class="line-modified">! #define BOOKMARK_GROUP_ELEMENT    &quot;group&quot;</span>
<span class="line-modified">! #define BOOKMARK_APPLICATIONS_ELEMENT &quot;applications&quot;</span>
<span class="line-modified">! #define BOOKMARK_APPLICATION_ELEMENT  &quot;application&quot;</span>
<span class="line-modified">! #define BOOKMARK_ICON_ELEMENT     &quot;icon&quot;</span>
<span class="line-modified">! #define BOOKMARK_PRIVATE_ELEMENT  &quot;private&quot;</span>
<span class="line-modified">! </span>
<span class="line-modified">! #define BOOKMARK_NAME_ATTRIBUTE   &quot;name&quot;</span>
<span class="line-modified">! #define BOOKMARK_EXEC_ATTRIBUTE   &quot;exec&quot;</span>
<span class="line-modified">! #define BOOKMARK_COUNT_ATTRIBUTE  &quot;count&quot;</span>
<span class="line-modified">! #define BOOKMARK_TIMESTAMP_ATTRIBUTE  &quot;timestamp&quot;     /* deprecated by &quot;modified&quot; */</span>
  #define BOOKMARK_MODIFIED_ATTRIBUTE     &quot;modified&quot;
<span class="line-modified">! #define BOOKMARK_HREF_ATTRIBUTE   &quot;href&quot;</span>
<span class="line-modified">! #define BOOKMARK_TYPE_ATTRIBUTE   &quot;type&quot;</span>
  
  /* Shared MIME Info entities */
<span class="line-modified">! #define MIME_NAMESPACE_NAME     &quot;mime&quot;</span>
<span class="line-modified">! #define MIME_NAMESPACE_URI    &quot;http://www.freedesktop.org/standards/shared-mime-info&quot;</span>
<span class="line-modified">! #define MIME_TYPE_ELEMENT     &quot;mime-type&quot;</span>
<span class="line-modified">! #define MIME_TYPE_ATTRIBUTE     &quot;type&quot;</span>
  
  
  typedef struct _BookmarkAppInfo  BookmarkAppInfo;
  typedef struct _BookmarkMetadata BookmarkMetadata;
  typedef struct _BookmarkItem     BookmarkItem;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 201,11 ***</span>
  {
    gchar *title;
    gchar *description;
  
    /* we store our items in a list and keep a copy inside
<span class="line-modified">!    * an hash table for faster lookup performances</span>
     */
    GList *items;
    GHashTable *items_by_uri;
  };
  
<span class="line-new-header">--- 201,11 ---</span>
  {
    gchar *title;
    gchar *description;
  
    /* we store our items in a list and keep a copy inside
<span class="line-modified">!    * a hash table for faster lookup performances</span>
     */
    GList *items;
    GHashTable *items_by_uri;
  };
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 231,24 ***</span>
  } ParserState;
  
  static void          g_bookmark_file_init        (GBookmarkFile  *bookmark);
  static void          g_bookmark_file_clear       (GBookmarkFile  *bookmark);
  static gboolean      g_bookmark_file_parse       (GBookmarkFile  *bookmark,
<span class="line-modified">!                           const gchar    *buffer,</span>
<span class="line-modified">!                           gsize           length,</span>
<span class="line-modified">!                           GError        **error);</span>
  static gchar *       g_bookmark_file_dump        (GBookmarkFile  *bookmark,
<span class="line-modified">!                           gsize          *length,</span>
<span class="line-modified">!                           GError        **error);</span>
  static BookmarkItem *g_bookmark_file_lookup_item (GBookmarkFile  *bookmark,
<span class="line-modified">!                           const gchar    *uri);</span>
  static void          g_bookmark_file_add_item    (GBookmarkFile  *bookmark,
<span class="line-modified">!                           BookmarkItem   *item,</span>
<span class="line-modified">!                           GError        **error);</span>
  
<span class="line-modified">! static time_t  timestamp_from_iso8601 (const gchar *iso_date);</span>
<span class="line-modified">! static gchar * timestamp_to_iso8601   (time_t       timestamp);</span>
  
  /********************************
   * BookmarkAppInfo              *
   *                              *
   * Application metadata storage *
<span class="line-new-header">--- 231,26 ---</span>
  } ParserState;
  
  static void          g_bookmark_file_init        (GBookmarkFile  *bookmark);
  static void          g_bookmark_file_clear       (GBookmarkFile  *bookmark);
  static gboolean      g_bookmark_file_parse       (GBookmarkFile  *bookmark,
<span class="line-modified">!               const gchar    *buffer,</span>
<span class="line-modified">!               gsize           length,</span>
<span class="line-modified">!               GError        **error);</span>
  static gchar *       g_bookmark_file_dump        (GBookmarkFile  *bookmark,
<span class="line-modified">!               gsize          *length,</span>
<span class="line-modified">!               GError        **error);</span>
  static BookmarkItem *g_bookmark_file_lookup_item (GBookmarkFile  *bookmark,
<span class="line-modified">!               const gchar    *uri);</span>
  static void          g_bookmark_file_add_item    (GBookmarkFile  *bookmark,
<span class="line-modified">!               BookmarkItem   *item,</span>
<span class="line-modified">!               GError        **error);</span>
  
<span class="line-modified">! static gboolean  timestamp_from_iso8601 (const gchar  *iso_date,</span>
<span class="line-modified">!                                          time_t       *out_timestamp,</span>
<span class="line-added">+                                          GError      **error);</span>
<span class="line-added">+ static gchar    *timestamp_to_iso8601   (time_t        timestamp);</span>
  
  /********************************
   * BookmarkAppInfo              *
   *                              *
   * Application metadata storage *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 385,120 ***</span>
  
    retval = g_string_sized_new (1024);
  
    /* metadata container */
    g_string_append (retval,
<span class="line-modified">!            &quot;      &quot;</span>
<span class="line-modified">!            &quot;&lt;&quot; XBEL_METADATA_ELEMENT</span>
<span class="line-modified">!            &quot; &quot; XBEL_OWNER_ATTRIBUTE &quot;=\&quot;&quot; BOOKMARK_METADATA_OWNER</span>
<span class="line-modified">!            &quot;\&quot;&gt;\n&quot;);</span>
  
    /* mime type */
    if (metadata-&gt;mime_type) {
      buffer = g_strconcat (&quot;        &quot;
<span class="line-modified">!               &quot;&lt;&quot; MIME_NAMESPACE_NAME &quot;:&quot; MIME_TYPE_ELEMENT &quot; &quot;</span>
<span class="line-modified">!               MIME_TYPE_ATTRIBUTE &quot;=\&quot;&quot;, metadata-&gt;mime_type, &quot;\&quot;/&gt;\n&quot;,</span>
<span class="line-modified">!               NULL);</span>
      g_string_append (retval, buffer);
      g_free (buffer);
    }
  
    if (metadata-&gt;groups)
      {
        GList *l;
  
        /* open groups container */
        g_string_append (retval,
<span class="line-modified">!                &quot;        &quot;</span>
<span class="line-modified">!                &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!                &quot;:&quot; BOOKMARK_GROUPS_ELEMENT &quot;&gt;\n&quot;);</span>
  
        for (l = g_list_last (metadata-&gt;groups); l != NULL; l = l-&gt;prev)
          {
            gchar *group_name;
  
<span class="line-modified">!       group_name = g_markup_escape_text ((gchar *) l-&gt;data, -1);</span>
<span class="line-modified">!       buffer = g_strconcat (&quot;          &quot;</span>
<span class="line-modified">!                 &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!                 &quot;:&quot; BOOKMARK_GROUP_ELEMENT &quot;&gt;&quot;,</span>
<span class="line-modified">!                 group_name,</span>
<span class="line-modified">!                 &quot;&lt;/&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!                 &quot;:&quot;  BOOKMARK_GROUP_ELEMENT &quot;&gt;\n&quot;, NULL);</span>
<span class="line-modified">!       g_string_append (retval, buffer);</span>
  
<span class="line-modified">!       g_free (buffer);</span>
<span class="line-modified">!       g_free (group_name);</span>
          }
  
        /* close groups container */
        g_string_append (retval,
<span class="line-modified">!                &quot;        &quot;</span>
<span class="line-modified">!                &quot;&lt;/&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!                &quot;:&quot; BOOKMARK_GROUPS_ELEMENT &quot;&gt;\n&quot;);</span>
      }
  
    if (metadata-&gt;applications)
      {
        GList *l;
  
        /* open applications container */
        g_string_append (retval,
<span class="line-modified">!                &quot;        &quot;</span>
<span class="line-modified">!                &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!                &quot;:&quot; BOOKMARK_APPLICATIONS_ELEMENT &quot;&gt;\n&quot;);</span>
  
        for (l = g_list_last (metadata-&gt;applications); l != NULL; l = l-&gt;prev)
          {
            BookmarkAppInfo *app_info = (BookmarkAppInfo *) l-&gt;data;
            gchar *app_data;
  
<span class="line-modified">!       g_warn_if_fail (app_info != NULL);</span>
  
            app_data = bookmark_app_info_dump (app_info);
  
<span class="line-modified">!       if (app_data)</span>
              {
                retval = g_string_append (retval, app_data);
  
<span class="line-modified">!           g_free (app_data);</span>
<span class="line-modified">!         }</span>
          }
  
        /* close applications container */
        g_string_append (retval,
<span class="line-modified">!                &quot;        &quot;</span>
<span class="line-modified">!                &quot;&lt;/&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!                &quot;:&quot; BOOKMARK_APPLICATIONS_ELEMENT &quot;&gt;\n&quot;);</span>
      }
  
    /* icon */
    if (metadata-&gt;icon_href)
      {
        if (!metadata-&gt;icon_mime)
          metadata-&gt;icon_mime = g_strdup (&quot;application/octet-stream&quot;);
  
        buffer = g_strconcat (&quot;       &quot;
<span class="line-modified">!                 &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!                 &quot;:&quot; BOOKMARK_ICON_ELEMENT</span>
<span class="line-modified">!                 &quot; &quot; BOOKMARK_HREF_ATTRIBUTE &quot;=\&quot;&quot;, metadata-&gt;icon_href,</span>
<span class="line-modified">!                 &quot;\&quot; &quot; BOOKMARK_TYPE_ATTRIBUTE &quot;=\&quot;&quot;, metadata-&gt;icon_mime, &quot;\&quot;/&gt;\n&quot;, NULL);</span>
        g_string_append (retval, buffer);
  
        g_free (buffer);
      }
  
    /* private hint */
    if (metadata-&gt;is_private)
      g_string_append (retval,
<span class="line-modified">!              &quot;        &quot;</span>
<span class="line-modified">!              &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!              &quot;:&quot; BOOKMARK_PRIVATE_ELEMENT &quot;/&gt;\n&quot;);</span>
  
    /* close metadata container */
    g_string_append (retval,
<span class="line-modified">!            &quot;      &quot;</span>
<span class="line-modified">!            &quot;&lt;/&quot; XBEL_METADATA_ELEMENT &quot;&gt;\n&quot;);</span>
  
    return g_string_free (retval, FALSE);
  }
  
  /******************************************************
<span class="line-new-header">--- 387,120 ---</span>
  
    retval = g_string_sized_new (1024);
  
    /* metadata container */
    g_string_append (retval,
<span class="line-modified">!        &quot;      &quot;</span>
<span class="line-modified">!        &quot;&lt;&quot; XBEL_METADATA_ELEMENT</span>
<span class="line-modified">!        &quot; &quot; XBEL_OWNER_ATTRIBUTE &quot;=\&quot;&quot; BOOKMARK_METADATA_OWNER</span>
<span class="line-modified">!        &quot;\&quot;&gt;\n&quot;);</span>
  
    /* mime type */
    if (metadata-&gt;mime_type) {
      buffer = g_strconcat (&quot;        &quot;
<span class="line-modified">!         &quot;&lt;&quot; MIME_NAMESPACE_NAME &quot;:&quot; MIME_TYPE_ELEMENT &quot; &quot;</span>
<span class="line-modified">!         MIME_TYPE_ATTRIBUTE &quot;=\&quot;&quot;, metadata-&gt;mime_type, &quot;\&quot;/&gt;\n&quot;,</span>
<span class="line-modified">!         NULL);</span>
      g_string_append (retval, buffer);
      g_free (buffer);
    }
  
    if (metadata-&gt;groups)
      {
        GList *l;
  
        /* open groups container */
        g_string_append (retval,
<span class="line-modified">!            &quot;        &quot;</span>
<span class="line-modified">!            &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!            &quot;:&quot; BOOKMARK_GROUPS_ELEMENT &quot;&gt;\n&quot;);</span>
  
        for (l = g_list_last (metadata-&gt;groups); l != NULL; l = l-&gt;prev)
          {
            gchar *group_name;
  
<span class="line-modified">!     group_name = g_markup_escape_text ((gchar *) l-&gt;data, -1);</span>
<span class="line-modified">!     buffer = g_strconcat (&quot;          &quot;</span>
<span class="line-modified">!         &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!         &quot;:&quot; BOOKMARK_GROUP_ELEMENT &quot;&gt;&quot;,</span>
<span class="line-modified">!         group_name,</span>
<span class="line-modified">!         &quot;&lt;/&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!         &quot;:&quot;  BOOKMARK_GROUP_ELEMENT &quot;&gt;\n&quot;, NULL);</span>
<span class="line-modified">!     g_string_append (retval, buffer);</span>
  
<span class="line-modified">!     g_free (buffer);</span>
<span class="line-modified">!     g_free (group_name);</span>
          }
  
        /* close groups container */
        g_string_append (retval,
<span class="line-modified">!            &quot;        &quot;</span>
<span class="line-modified">!            &quot;&lt;/&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!            &quot;:&quot; BOOKMARK_GROUPS_ELEMENT &quot;&gt;\n&quot;);</span>
      }
  
    if (metadata-&gt;applications)
      {
        GList *l;
  
        /* open applications container */
        g_string_append (retval,
<span class="line-modified">!            &quot;        &quot;</span>
<span class="line-modified">!            &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!            &quot;:&quot; BOOKMARK_APPLICATIONS_ELEMENT &quot;&gt;\n&quot;);</span>
  
        for (l = g_list_last (metadata-&gt;applications); l != NULL; l = l-&gt;prev)
          {
            BookmarkAppInfo *app_info = (BookmarkAppInfo *) l-&gt;data;
            gchar *app_data;
  
<span class="line-modified">!     g_warn_if_fail (app_info != NULL);</span>
  
            app_data = bookmark_app_info_dump (app_info);
  
<span class="line-modified">!     if (app_data)</span>
              {
                retval = g_string_append (retval, app_data);
  
<span class="line-modified">!         g_free (app_data);</span>
<span class="line-modified">!       }</span>
          }
  
        /* close applications container */
        g_string_append (retval,
<span class="line-modified">!            &quot;        &quot;</span>
<span class="line-modified">!            &quot;&lt;/&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!            &quot;:&quot; BOOKMARK_APPLICATIONS_ELEMENT &quot;&gt;\n&quot;);</span>
      }
  
    /* icon */
    if (metadata-&gt;icon_href)
      {
        if (!metadata-&gt;icon_mime)
          metadata-&gt;icon_mime = g_strdup (&quot;application/octet-stream&quot;);
  
        buffer = g_strconcat (&quot;       &quot;
<span class="line-modified">!           &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!           &quot;:&quot; BOOKMARK_ICON_ELEMENT</span>
<span class="line-modified">!           &quot; &quot; BOOKMARK_HREF_ATTRIBUTE &quot;=\&quot;&quot;, metadata-&gt;icon_href,</span>
<span class="line-modified">!           &quot;\&quot; &quot; BOOKMARK_TYPE_ATTRIBUTE &quot;=\&quot;&quot;, metadata-&gt;icon_mime, &quot;\&quot;/&gt;\n&quot;, NULL);</span>
        g_string_append (retval, buffer);
  
        g_free (buffer);
      }
  
    /* private hint */
    if (metadata-&gt;is_private)
      g_string_append (retval,
<span class="line-modified">!          &quot;        &quot;</span>
<span class="line-modified">!          &quot;&lt;&quot; BOOKMARK_NAMESPACE_NAME</span>
<span class="line-modified">!          &quot;:&quot; BOOKMARK_PRIVATE_ELEMENT &quot;/&gt;\n&quot;);</span>
  
    /* close metadata container */
    g_string_append (retval,
<span class="line-modified">!        &quot;      &quot;</span>
<span class="line-modified">!        &quot;&lt;/&quot; XBEL_METADATA_ELEMENT &quot;&gt;\n&quot;);</span>
  
    return g_string_free (retval, FALSE);
  }
  
  /******************************************************
</pre>
<hr />
<pre>
<span class="line-old-header">*** 633,27 ***</span>
          {
            buffer = g_strconcat (&quot;    &quot;
                                  &quot;&lt;&quot; XBEL_INFO_ELEMENT &quot;&gt;\n&quot;,
                                  metadata,
                                  &quot;    &quot;
<span class="line-modified">!                 &quot;&lt;/&quot; XBEL_INFO_ELEMENT &quot;&gt;\n&quot;,</span>
                                  NULL);
            retval = g_string_append (retval, buffer);
  
            g_free (buffer);
<span class="line-modified">!       g_free (metadata);</span>
<span class="line-modified">!     }</span>
      }
  
    g_string_append (retval, &quot;  &lt;/&quot; XBEL_BOOKMARK_ELEMENT &quot;&gt;\n&quot;);
  
    return g_string_free (retval, FALSE);
  }
  
  static BookmarkAppInfo *
  bookmark_item_lookup_app_info (BookmarkItem *item,
<span class="line-modified">!                    const gchar  *app_name)</span>
  {
    g_warn_if_fail (item != NULL &amp;&amp; app_name != NULL);
  
    if (!item-&gt;metadata)
      return NULL;
<span class="line-new-header">--- 635,27 ---</span>
          {
            buffer = g_strconcat (&quot;    &quot;
                                  &quot;&lt;&quot; XBEL_INFO_ELEMENT &quot;&gt;\n&quot;,
                                  metadata,
                                  &quot;    &quot;
<span class="line-modified">!         &quot;&lt;/&quot; XBEL_INFO_ELEMENT &quot;&gt;\n&quot;,</span>
                                  NULL);
            retval = g_string_append (retval, buffer);
  
            g_free (buffer);
<span class="line-modified">!     g_free (metadata);</span>
<span class="line-modified">!   }</span>
      }
  
    g_string_append (retval, &quot;  &lt;/&quot; XBEL_BOOKMARK_ELEMENT &quot;&gt;\n&quot;);
  
    return g_string_free (retval, FALSE);
  }
  
  static BookmarkAppInfo *
  bookmark_item_lookup_app_info (BookmarkItem *item,
<span class="line-modified">!              const gchar  *app_name)</span>
  {
    g_warn_if_fail (item != NULL &amp;&amp; app_name != NULL);
  
    if (!item-&gt;metadata)
      return NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 712,12 ***</span>
  
    retval = g_new (ParseData, 1);
  
    retval-&gt;state = STATE_STARTED;
    retval-&gt;namespaces = g_hash_table_new_full (g_str_hash, g_str_equal,
<span class="line-modified">!                           (GDestroyNotify) g_free,</span>
<span class="line-modified">!                           (GDestroyNotify) g_free);</span>
    retval-&gt;bookmark_file = NULL;
    retval-&gt;current_item = NULL;
  
    return retval;
  }
<span class="line-new-header">--- 714,12 ---</span>
  
    retval = g_new (ParseData, 1);
  
    retval-&gt;state = STATE_STARTED;
    retval-&gt;namespaces = g_hash_table_new_full (g_str_hash, g_str_equal,
<span class="line-modified">!                   (GDestroyNotify) g_free,</span>
<span class="line-modified">!                   (GDestroyNotify) g_free);</span>
    retval-&gt;bookmark_file = NULL;
    retval-&gt;current_item = NULL;
  
    return retval;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 728,18 ***</span>
    g_hash_table_destroy (parse_data-&gt;namespaces);
  
    g_free (parse_data);
  }
  
<span class="line-modified">! #define IS_ATTRIBUTE(s,a)   ((0 == strcmp ((s), (a))))</span>
  
  static void
  parse_bookmark_element (GMarkupParseContext  *context,
<span class="line-modified">!             ParseData            *parse_data,</span>
<span class="line-modified">!             const gchar         **attribute_names,</span>
<span class="line-modified">!             const gchar         **attribute_values,</span>
<span class="line-modified">!             GError              **error)</span>
  {
    const gchar *uri, *added, *modified, *visited;
    const gchar *attr;
    gint i;
    BookmarkItem *item;
<span class="line-new-header">--- 730,18 ---</span>
    g_hash_table_destroy (parse_data-&gt;namespaces);
  
    g_free (parse_data);
  }
  
<span class="line-modified">! #define IS_ATTRIBUTE(s,a) ((0 == strcmp ((s), (a))))</span>
  
  static void
  parse_bookmark_element (GMarkupParseContext  *context,
<span class="line-modified">!       ParseData            *parse_data,</span>
<span class="line-modified">!       const gchar         **attribute_names,</span>
<span class="line-modified">!       const gchar         **attribute_values,</span>
<span class="line-modified">!       GError              **error)</span>
  {
    const gchar *uri, *added, *modified, *visited;
    const gchar *attr;
    gint i;
    BookmarkItem *item;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 764,50 ***</span>
            /* bookmark is defined by the XBEL spec, so we need
             * to error out if the element has different or
             * missing attributes
             */
            g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                        G_MARKUP_ERROR_UNKNOWN_ATTRIBUTE,</span>
<span class="line-modified">!                        _(&quot;Unexpected attribute &#39;%s&#39; for element &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                        attr,</span>
<span class="line-modified">!                        XBEL_BOOKMARK_ELEMENT);</span>
            return;
          }
      }
  
    if (!uri)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                    G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                    _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!                    XBEL_HREF_ATTRIBUTE,</span>
<span class="line-modified">!                    XBEL_BOOKMARK_ELEMENT);</span>
        return;
      }
  
    g_warn_if_fail (parse_data-&gt;current_item == NULL);
  
<span class="line-modified">! item = bookmark_item_new (uri);</span>
  #ifdef GSTREAMER_LITE
    if (item == NULL) {
      return;
    }
  #endif // GSTREAMER_LITE
  
<span class="line-modified">!   if (added)</span>
<span class="line-modified">!     item-&gt;added = timestamp_from_iso8601 (added);</span>
  
<span class="line-modified">!   if (modified)</span>
<span class="line-modified">!     item-&gt;modified = timestamp_from_iso8601 (modified);</span>
  
<span class="line-modified">!   if (visited)</span>
<span class="line-modified">!     item-&gt;visited = timestamp_from_iso8601 (visited);</span>
  
    add_error = NULL;
    g_bookmark_file_add_item (parse_data-&gt;bookmark_file,
<span class="line-modified">!                 item,</span>
<span class="line-modified">!                 &amp;add_error);</span>
    if (add_error)
      {
        bookmark_item_free (item);
  
        g_propagate_error (error, add_error);
<span class="line-new-header">--- 766,50 ---</span>
            /* bookmark is defined by the XBEL spec, so we need
             * to error out if the element has different or
             * missing attributes
             */
            g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!            G_MARKUP_ERROR_UNKNOWN_ATTRIBUTE,</span>
<span class="line-modified">!                    _(&quot;Unexpected attribute &#39;%s&#39; for element &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    attr,</span>
<span class="line-modified">!                    XBEL_BOOKMARK_ELEMENT);</span>
            return;
          }
      }
  
    if (!uri)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!              G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!              _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!              XBEL_HREF_ATTRIBUTE,</span>
<span class="line-modified">!              XBEL_BOOKMARK_ELEMENT);</span>
        return;
      }
  
    g_warn_if_fail (parse_data-&gt;current_item == NULL);
  
<span class="line-modified">!   item = bookmark_item_new (uri);</span>
  #ifdef GSTREAMER_LITE
    if (item == NULL) {
      return;
    }
  #endif // GSTREAMER_LITE
  
<span class="line-modified">!   if (added != NULL &amp;&amp; !timestamp_from_iso8601 (added, &amp;item-&gt;added, error))</span>
<span class="line-modified">!     return;</span>
  
<span class="line-modified">!   if (modified != NULL &amp;&amp; !timestamp_from_iso8601 (modified, &amp;item-&gt;modified, error))</span>
<span class="line-modified">!     return;</span>
  
<span class="line-modified">!   if (visited != NULL &amp;&amp; !timestamp_from_iso8601 (visited, &amp;item-&gt;visited, error))</span>
<span class="line-modified">!     return;</span>
  
    add_error = NULL;
    g_bookmark_file_add_item (parse_data-&gt;bookmark_file,
<span class="line-modified">!             item,</span>
<span class="line-modified">!             &amp;add_error);</span>
    if (add_error)
      {
        bookmark_item_free (item);
  
        g_propagate_error (error, add_error);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 818,14 ***</span>
    parse_data-&gt;current_item = item;
  }
  
  static void
  parse_application_element (GMarkupParseContext  *context,
<span class="line-modified">!                ParseData            *parse_data,</span>
<span class="line-modified">!                const gchar         **attribute_names,</span>
<span class="line-modified">!                const gchar         **attribute_values,</span>
<span class="line-modified">!                GError              **error)</span>
  {
    const gchar *name, *exec, *count, *stamp, *modified;
    const gchar *attr;
    gint i;
    BookmarkItem *item;
<span class="line-new-header">--- 820,14 ---</span>
    parse_data-&gt;current_item = item;
  }
  
  static void
  parse_application_element (GMarkupParseContext  *context,
<span class="line-modified">!          ParseData            *parse_data,</span>
<span class="line-modified">!          const gchar         **attribute_names,</span>
<span class="line-modified">!          const gchar         **attribute_values,</span>
<span class="line-modified">!          GError              **error)</span>
  {
    const gchar *name, *exec, *count, *stamp, *modified;
    const gchar *attr;
    gint i;
    BookmarkItem *item;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 851,24 ***</span>
  
    /* the &quot;name&quot; and &quot;exec&quot; attributes are mandatory */
    if (!name)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                    G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                    _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!                    BOOKMARK_NAME_ATTRIBUTE,</span>
<span class="line-modified">!                    BOOKMARK_APPLICATION_ELEMENT);</span>
        return;
      }
  
    if (!exec)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                    G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                    _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!                    BOOKMARK_EXEC_ATTRIBUTE,</span>
<span class="line-modified">!                    BOOKMARK_APPLICATION_ELEMENT);</span>
        return;
      }
  
    g_warn_if_fail (parse_data-&gt;current_item != NULL);
    item = parse_data-&gt;current_item;
<span class="line-new-header">--- 853,24 ---</span>
  
    /* the &quot;name&quot; and &quot;exec&quot; attributes are mandatory */
    if (!name)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!              G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!              _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!              BOOKMARK_NAME_ATTRIBUTE,</span>
<span class="line-modified">!              BOOKMARK_APPLICATION_ELEMENT);</span>
        return;
      }
  
    if (!exec)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!              G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!              _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!              BOOKMARK_EXEC_ATTRIBUTE,</span>
<span class="line-modified">!              BOOKMARK_APPLICATION_ELEMENT);</span>
        return;
      }
  
    g_warn_if_fail (parse_data-&gt;current_item != NULL);
    item = parse_data-&gt;current_item;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 885,11 ***</span>
            return;
        }
  #endif // GSTREAMER_LITE
  
        if (!item-&gt;metadata)
<span class="line-modified">!         item-&gt;metadata = bookmark_metadata_new ();</span>
  
        item-&gt;metadata-&gt;applications = g_list_prepend (item-&gt;metadata-&gt;applications, ai);
        g_hash_table_replace (item-&gt;metadata-&gt;apps_by_name, ai-&gt;name, ai);
      }
  
<span class="line-new-header">--- 887,11 ---</span>
            return;
        }
  #endif // GSTREAMER_LITE
  
        if (!item-&gt;metadata)
<span class="line-modified">!   item-&gt;metadata = bookmark_metadata_new ();</span>
  
        item-&gt;metadata-&gt;applications = g_list_prepend (item-&gt;metadata-&gt;applications, ai);
        g_hash_table_replace (item-&gt;metadata-&gt;apps_by_name, ai-&gt;name, ai);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 899,12 ***</span>
    if (count)
      ai-&gt;count = atoi (count);
    else
      ai-&gt;count = 1;
  
<span class="line-modified">!   if (modified)</span>
<span class="line-modified">!     ai-&gt;stamp = timestamp_from_iso8601 (modified);</span>
    else
      {
        /* the timestamp attribute has been deprecated but we still parse
         * it for backward compatibility
         */
<span class="line-new-header">--- 901,15 ---</span>
    if (count)
      ai-&gt;count = atoi (count);
    else
      ai-&gt;count = 1;
  
<span class="line-modified">!   if (modified != NULL)</span>
<span class="line-modified">!     {</span>
<span class="line-added">+       if (!timestamp_from_iso8601 (modified, &amp;ai-&gt;stamp, error))</span>
<span class="line-added">+         return;</span>
<span class="line-added">+     }</span>
    else
      {
        /* the timestamp attribute has been deprecated but we still parse
         * it for backward compatibility
         */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 915,14 ***</span>
      }
  }
  
  static void
  parse_mime_type_element (GMarkupParseContext  *context,
<span class="line-modified">!              ParseData            *parse_data,</span>
<span class="line-modified">!              const gchar         **attribute_names,</span>
<span class="line-modified">!              const gchar         **attribute_values,</span>
<span class="line-modified">!              GError              **error)</span>
  {
    const gchar *type;
    const gchar *attr;
    gint i;
    BookmarkItem *item;
<span class="line-new-header">--- 920,14 ---</span>
      }
  }
  
  static void
  parse_mime_type_element (GMarkupParseContext  *context,
<span class="line-modified">!        ParseData            *parse_data,</span>
<span class="line-modified">!        const gchar         **attribute_names,</span>
<span class="line-modified">!        const gchar         **attribute_values,</span>
<span class="line-modified">!        GError              **error)</span>
  {
    const gchar *type;
    const gchar *attr;
    gint i;
    BookmarkItem *item;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 950,14 ***</span>
    item-&gt;metadata-&gt;mime_type = g_strdup (type);
  }
  
  static void
  parse_icon_element (GMarkupParseContext  *context,
<span class="line-modified">!             ParseData            *parse_data,</span>
<span class="line-modified">!             const gchar         **attribute_names,</span>
<span class="line-modified">!             const gchar         **attribute_values,</span>
<span class="line-modified">!             GError              **error)</span>
  {
    const gchar *href;
    const gchar *type;
    const gchar *attr;
    gint i;
<span class="line-new-header">--- 955,14 ---</span>
    item-&gt;metadata-&gt;mime_type = g_strdup (type);
  }
  
  static void
  parse_icon_element (GMarkupParseContext  *context,
<span class="line-modified">!         ParseData            *parse_data,</span>
<span class="line-modified">!         const gchar         **attribute_names,</span>
<span class="line-modified">!         const gchar         **attribute_values,</span>
<span class="line-modified">!         GError              **error)</span>
  {
    const gchar *href;
    const gchar *type;
    const gchar *attr;
    gint i;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 978,14 ***</span>
  
    /* the &quot;href&quot; attribute is mandatory */
    if (!href)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                    G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                    _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!                    BOOKMARK_HREF_ATTRIBUTE,</span>
<span class="line-modified">!                    BOOKMARK_ICON_ELEMENT);</span>
        return;
      }
  
    if (!type)
      type = &quot;application/octet-stream&quot;;
<span class="line-new-header">--- 983,14 ---</span>
  
    /* the &quot;href&quot; attribute is mandatory */
    if (!href)
      {
        g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!              G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!              _(&quot;Attribute &#39;%s&#39; of element &#39;%s&#39; not found&quot;),</span>
<span class="line-modified">!              BOOKMARK_HREF_ATTRIBUTE,</span>
<span class="line-modified">!              BOOKMARK_ICON_ELEMENT);</span>
        return;
      }
  
    if (!type)
      type = &quot;application/octet-stream&quot;;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1016,11 ***</span>
   * namespace table inside GMarkup and ask it to resolve the namespaces for us.
   */
  static void
  map_namespace_to_name (ParseData    *parse_data,
                         const gchar **attribute_names,
<span class="line-modified">!                const gchar **attribute_values)</span>
  {
    const gchar *attr;
    gint i;
  
    g_warn_if_fail (parse_data != NULL);
<span class="line-new-header">--- 1021,11 ---</span>
   * namespace table inside GMarkup and ask it to resolve the namespaces for us.
   */
  static void
  map_namespace_to_name (ParseData    *parse_data,
                         const gchar **attribute_names,
<span class="line-modified">!            const gchar **attribute_values)</span>
  {
    const gchar *attr;
    gint i;
  
    g_warn_if_fail (parse_data != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1111,11 ***</span>
    g_free (ns_name);
  
    return retval;
  }
  
<span class="line-modified">! #define IS_ELEMENT(p,s,e)   (is_element_full ((p), (s), NULL, (e), &#39;\0&#39;))</span>
  #define IS_ELEMENT_NS(p,s,n,e)  (is_element_full ((p), (s), (n), (e), &#39;|&#39;))
  
  static const gchar *
  parser_state_to_element_name (ParserState state)
  {
<span class="line-new-header">--- 1116,11 ---</span>
    g_free (ns_name);
  
    return retval;
  }
  
<span class="line-modified">! #define IS_ELEMENT(p,s,e) (is_element_full ((p), (s), NULL, (e), &#39;\0&#39;))</span>
  #define IS_ELEMENT_NS(p,s,n,e)  (is_element_full ((p), (s), (n), (e), &#39;|&#39;))
  
  static const gchar *
  parser_state_to_element_name (ParserState state)
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1184,16 ***</span>
              {
                if ((IS_ATTRIBUTE (attr, XBEL_VERSION_ATTRIBUTE)) &amp;&amp;
                    (0 == strcmp (attribute_values[i], XBEL_VERSION)))
                  parse_data-&gt;state = STATE_ROOT;
              }
<span class="line-modified">!     }</span>
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                      G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                      _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                      element_name, XBEL_ROOT_ELEMENT);</span>
        break;
      case STATE_ROOT:
        if (IS_ELEMENT (parse_data, element_name, XBEL_TITLE_ELEMENT))
          parse_data-&gt;state = STATE_TITLE;
        else if (IS_ELEMENT (parse_data, element_name, XBEL_DESC_ELEMENT))
<span class="line-new-header">--- 1189,16 ---</span>
              {
                if ((IS_ATTRIBUTE (attr, XBEL_VERSION_ATTRIBUTE)) &amp;&amp;
                    (0 == strcmp (attribute_values[i], XBEL_VERSION)))
                  parse_data-&gt;state = STATE_ROOT;
              }
<span class="line-modified">!   }</span>
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!          G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                  _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                  element_name, XBEL_ROOT_ELEMENT);</span>
        break;
      case STATE_ROOT:
        if (IS_ELEMENT (parse_data, element_name, XBEL_TITLE_ELEMENT))
          parse_data-&gt;state = STATE_TITLE;
        else if (IS_ELEMENT (parse_data, element_name, XBEL_DESC_ELEMENT))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1203,37 ***</span>
            GError *inner_error = NULL;
  
            parse_data-&gt;state = STATE_BOOKMARK;
  
            parse_bookmark_element (context,
<span class="line-modified">!                       parse_data,</span>
<span class="line-modified">!                       attribute_names,</span>
<span class="line-modified">!                       attribute_values,</span>
<span class="line-modified">!                       &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                      G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                      _(&quot;Unexpected tag &#39;%s&#39; inside &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                      element_name,</span>
<span class="line-modified">!                      XBEL_ROOT_ELEMENT);</span>
        break;
      case STATE_BOOKMARK:
        if (IS_ELEMENT (parse_data, element_name, XBEL_TITLE_ELEMENT))
          parse_data-&gt;state = STATE_TITLE;
        else if (IS_ELEMENT (parse_data, element_name, XBEL_DESC_ELEMENT))
          parse_data-&gt;state = STATE_DESC;
        else if (IS_ELEMENT (parse_data, element_name, XBEL_INFO_ELEMENT))
          parse_data-&gt;state = STATE_INFO;
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                      G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                      _(&quot;Unexpected tag &#39;%s&#39; inside &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                      element_name,</span>
<span class="line-modified">!                      XBEL_BOOKMARK_ELEMENT);</span>
        break;
      case STATE_INFO:
        if (IS_ELEMENT (parse_data, element_name, XBEL_METADATA_ELEMENT))
          {
            const gchar *attr;
<span class="line-new-header">--- 1208,37 ---</span>
            GError *inner_error = NULL;
  
            parse_data-&gt;state = STATE_BOOKMARK;
  
            parse_bookmark_element (context,
<span class="line-modified">!                   parse_data,</span>
<span class="line-modified">!                   attribute_names,</span>
<span class="line-modified">!                   attribute_values,</span>
<span class="line-modified">!                   &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                _(&quot;Unexpected tag &#39;%s&#39; inside &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                element_name,</span>
<span class="line-modified">!                XBEL_ROOT_ELEMENT);</span>
        break;
      case STATE_BOOKMARK:
        if (IS_ELEMENT (parse_data, element_name, XBEL_TITLE_ELEMENT))
          parse_data-&gt;state = STATE_TITLE;
        else if (IS_ELEMENT (parse_data, element_name, XBEL_DESC_ELEMENT))
          parse_data-&gt;state = STATE_DESC;
        else if (IS_ELEMENT (parse_data, element_name, XBEL_INFO_ELEMENT))
          parse_data-&gt;state = STATE_INFO;
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                  _(&quot;Unexpected tag &#39;%s&#39; inside &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                  element_name,</span>
<span class="line-modified">!                  XBEL_BOOKMARK_ELEMENT);</span>
        break;
      case STATE_INFO:
        if (IS_ELEMENT (parse_data, element_name, XBEL_METADATA_ELEMENT))
          {
            const gchar *attr;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1252,14 ***</span>
                  }
              }
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                      G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                      _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                      element_name,</span>
<span class="line-modified">!                      XBEL_METADATA_ELEMENT);</span>
        break;
      case STATE_METADATA:
        if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_APPLICATIONS_ELEMENT))
          parse_data-&gt;state = STATE_APPLICATIONS;
        else if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_GROUPS_ELEMENT))
<span class="line-new-header">--- 1257,14 ---</span>
                  }
              }
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                element_name,</span>
<span class="line-modified">!                XBEL_METADATA_ELEMENT);</span>
        break;
      case STATE_METADATA:
        if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_APPLICATIONS_ELEMENT))
          parse_data-&gt;state = STATE_APPLICATIONS;
        else if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_GROUPS_ELEMENT))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1268,72 ***</span>
          parse_data-&gt;current_item-&gt;metadata-&gt;is_private = TRUE;
        else if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_ICON_ELEMENT))
          {
            GError *inner_error = NULL;
  
<span class="line-modified">!       parse_data-&gt;state = STATE_ICON;</span>
  
            parse_icon_element (context,
<span class="line-modified">!                       parse_data,</span>
<span class="line-modified">!                       attribute_names,</span>
<span class="line-modified">!                       attribute_values,</span>
<span class="line-modified">!                       &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else if (IS_ELEMENT_NS (parse_data, element_name, MIME_NAMESPACE_URI, MIME_TYPE_ELEMENT))
          {
            GError *inner_error = NULL;
  
            parse_data-&gt;state = STATE_MIME;
  
            parse_mime_type_element (context,
<span class="line-modified">!                        parse_data,</span>
<span class="line-modified">!                        attribute_names,</span>
<span class="line-modified">!                        attribute_values,</span>
<span class="line-modified">!                        &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                      G_MARKUP_ERROR_UNKNOWN_ELEMENT,</span>
<span class="line-modified">!                      _(&quot;Unexpected tag &#39;%s&#39; inside &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                     element_name,</span>
<span class="line-modified">!                     XBEL_METADATA_ELEMENT);</span>
        break;
      case STATE_APPLICATIONS:
        if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_APPLICATION_ELEMENT))
          {
            GError *inner_error = NULL;
  
            parse_data-&gt;state = STATE_APPLICATION;
  
            parse_application_element (context,
<span class="line-modified">!                          parse_data,</span>
<span class="line-modified">!                          attribute_names,</span>
<span class="line-modified">!                          attribute_values,</span>
<span class="line-modified">!                          &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                      G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                      _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                      element_name,</span>
<span class="line-modified">!                      BOOKMARK_APPLICATION_ELEMENT);</span>
        break;
      case STATE_GROUPS:
        if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_GROUP_ELEMENT))
          parse_data-&gt;state = STATE_GROUP;
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                      G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                      _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                      element_name,</span>
<span class="line-modified">!                      BOOKMARK_GROUP_ELEMENT);</span>
        break;
  
      case STATE_TITLE:
      case STATE_DESC:
      case STATE_APPLICATION:
<span class="line-new-header">--- 1273,72 ---</span>
          parse_data-&gt;current_item-&gt;metadata-&gt;is_private = TRUE;
        else if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_ICON_ELEMENT))
          {
            GError *inner_error = NULL;
  
<span class="line-modified">!     parse_data-&gt;state = STATE_ICON;</span>
  
            parse_icon_element (context,
<span class="line-modified">!                     parse_data,</span>
<span class="line-modified">!                     attribute_names,</span>
<span class="line-modified">!                     attribute_values,</span>
<span class="line-modified">!                     &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else if (IS_ELEMENT_NS (parse_data, element_name, MIME_NAMESPACE_URI, MIME_TYPE_ELEMENT))
          {
            GError *inner_error = NULL;
  
            parse_data-&gt;state = STATE_MIME;
  
            parse_mime_type_element (context,
<span class="line-modified">!                    parse_data,</span>
<span class="line-modified">!                    attribute_names,</span>
<span class="line-modified">!                    attribute_values,</span>
<span class="line-modified">!                    &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                G_MARKUP_ERROR_UNKNOWN_ELEMENT,</span>
<span class="line-modified">!                _(&quot;Unexpected tag &#39;%s&#39; inside &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                element_name,</span>
<span class="line-modified">!                XBEL_METADATA_ELEMENT);</span>
        break;
      case STATE_APPLICATIONS:
        if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_APPLICATION_ELEMENT))
          {
            GError *inner_error = NULL;
  
            parse_data-&gt;state = STATE_APPLICATION;
  
            parse_application_element (context,
<span class="line-modified">!                      parse_data,</span>
<span class="line-modified">!                      attribute_names,</span>
<span class="line-modified">!                      attribute_values,</span>
<span class="line-modified">!                      &amp;inner_error);</span>
            if (inner_error)
              g_propagate_error (error, inner_error);
          }
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                element_name,</span>
<span class="line-modified">!                BOOKMARK_APPLICATION_ELEMENT);</span>
        break;
      case STATE_GROUPS:
        if (IS_ELEMENT_NS (parse_data, element_name, BOOKMARK_NAMESPACE_URI, BOOKMARK_GROUP_ELEMENT))
          parse_data-&gt;state = STATE_GROUP;
        else
          g_set_error (error, G_MARKUP_ERROR,
<span class="line-modified">!                G_MARKUP_ERROR_INVALID_CONTENT,</span>
<span class="line-modified">!                _(&quot;Unexpected tag &#39;%s&#39;, tag &#39;%s&#39; expected&quot;),</span>
<span class="line-modified">!                element_name,</span>
<span class="line-modified">!                BOOKMARK_GROUP_ELEMENT);</span>
        break;
  
      case STATE_TITLE:
      case STATE_DESC:
      case STATE_APPLICATION:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1475,13 ***</span>
    NULL
  };
  
  static gboolean
  g_bookmark_file_parse (GBookmarkFile  *bookmark,
<span class="line-modified">!              const gchar  *buffer,</span>
<span class="line-modified">!              gsize         length,</span>
<span class="line-modified">!              GError       **error)</span>
  {
    GMarkupParseContext *context;
    ParseData *parse_data;
    GError *parse_error, *end_error;
    gboolean retval;
<span class="line-new-header">--- 1480,13 ---</span>
    NULL
  };
  
  static gboolean
  g_bookmark_file_parse (GBookmarkFile  *bookmark,
<span class="line-modified">!        const gchar  *buffer,</span>
<span class="line-modified">!        gsize         length,</span>
<span class="line-modified">!        GError       **error)</span>
  {
    GMarkupParseContext *context;
    ParseData *parse_data;
    GError *parse_error, *end_error;
    gboolean retval;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1499,18 ***</span>
  
    parse_data = parse_data_new ();
    parse_data-&gt;bookmark_file = bookmark;
  
    context = g_markup_parse_context_new (&amp;markup_parser,
<span class="line-modified">!                     0,</span>
<span class="line-modified">!                     parse_data,</span>
<span class="line-modified">!                     (GDestroyNotify) parse_data_free);</span>
  
    retval = g_markup_parse_context_parse (context,
<span class="line-modified">!                      buffer,</span>
<span class="line-modified">!                      length,</span>
<span class="line-modified">!                      &amp;parse_error);</span>
    if (!retval)
      g_propagate_error (error, parse_error);
    else
     {
       retval = g_markup_parse_context_end_parse (context, &amp;end_error);
<span class="line-new-header">--- 1504,18 ---</span>
  
    parse_data = parse_data_new ();
    parse_data-&gt;bookmark_file = bookmark;
  
    context = g_markup_parse_context_new (&amp;markup_parser,
<span class="line-modified">!             0,</span>
<span class="line-modified">!             parse_data,</span>
<span class="line-modified">!             (GDestroyNotify) parse_data_free);</span>
  
    retval = g_markup_parse_context_parse (context,
<span class="line-modified">!              buffer,</span>
<span class="line-modified">!              length,</span>
<span class="line-modified">!              &amp;parse_error);</span>
    if (!retval)
      g_propagate_error (error, parse_error);
    else
     {
       retval = g_markup_parse_context_end_parse (context, &amp;end_error);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1523,41 ***</span>
    return retval;
  }
  
  static gchar *
  g_bookmark_file_dump (GBookmarkFile  *bookmark,
<span class="line-modified">!               gsize          *length,</span>
<span class="line-modified">!               GError        **error)</span>
  {
    GString *retval;
    gchar *buffer;
    GList *l;
  
    retval = g_string_sized_new (4096);
  
    g_string_append (retval,
<span class="line-modified">!            &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span>
  #if 0
<span class="line-modified">!            /* XXX - do we really need the doctype? */</span>
<span class="line-modified">!            &quot;&lt;!DOCTYPE &quot; XBEL_DTD_NICK &quot;\n&quot;</span>
<span class="line-modified">!            &quot;  PUBLIC \&quot;&quot; XBEL_DTD_SYSTEM &quot;\&quot;\n&quot;</span>
<span class="line-modified">!            &quot;         \&quot;&quot; XBEL_DTD_URI &quot;\&quot;&gt;\n&quot;</span>
  #endif
<span class="line-modified">!            &quot;&lt;&quot; XBEL_ROOT_ELEMENT &quot; &quot; XBEL_VERSION_ATTRIBUTE &quot;=\&quot;&quot; XBEL_VERSION &quot;\&quot;\n&quot;</span>
<span class="line-modified">!            &quot;      xmlns:&quot; BOOKMARK_NAMESPACE_NAME &quot;=\&quot;&quot; BOOKMARK_NAMESPACE_URI &quot;\&quot;\n&quot;</span>
<span class="line-modified">!            &quot;      xmlns:&quot; MIME_NAMESPACE_NAME     &quot;=\&quot;&quot; MIME_NAMESPACE_URI &quot;\&quot;\n&gt;&quot;);</span>
  
    if (bookmark-&gt;title)
      {
        gchar *escaped_title;
  
        escaped_title = g_markup_escape_text (bookmark-&gt;title, -1);
  
        buffer = g_strconcat (&quot;  &quot;
<span class="line-modified">!                 &quot;&lt;&quot; XBEL_TITLE_ELEMENT &quot;&gt;&quot;,</span>
<span class="line-modified">!                 escaped_title,</span>
<span class="line-modified">!                 &quot;&lt;/&quot; XBEL_TITLE_ELEMENT &quot;&gt;\n&quot;, NULL);</span>
  
        g_string_append (retval, buffer);
  
        g_free (buffer);
        g_free (escaped_title);
<span class="line-new-header">--- 1528,41 ---</span>
    return retval;
  }
  
  static gchar *
  g_bookmark_file_dump (GBookmarkFile  *bookmark,
<span class="line-modified">!           gsize          *length,</span>
<span class="line-modified">!           GError        **error)</span>
  {
    GString *retval;
    gchar *buffer;
    GList *l;
  
    retval = g_string_sized_new (4096);
  
    g_string_append (retval,
<span class="line-modified">!        &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;</span>
  #if 0
<span class="line-modified">!        /* XXX - do we really need the doctype? */</span>
<span class="line-modified">!        &quot;&lt;!DOCTYPE &quot; XBEL_DTD_NICK &quot;\n&quot;</span>
<span class="line-modified">!        &quot;  PUBLIC \&quot;&quot; XBEL_DTD_SYSTEM &quot;\&quot;\n&quot;</span>
<span class="line-modified">!        &quot;         \&quot;&quot; XBEL_DTD_URI &quot;\&quot;&gt;\n&quot;</span>
  #endif
<span class="line-modified">!        &quot;&lt;&quot; XBEL_ROOT_ELEMENT &quot; &quot; XBEL_VERSION_ATTRIBUTE &quot;=\&quot;&quot; XBEL_VERSION &quot;\&quot;\n&quot;</span>
<span class="line-modified">!        &quot;      xmlns:&quot; BOOKMARK_NAMESPACE_NAME &quot;=\&quot;&quot; BOOKMARK_NAMESPACE_URI &quot;\&quot;\n&quot;</span>
<span class="line-modified">!        &quot;      xmlns:&quot; MIME_NAMESPACE_NAME     &quot;=\&quot;&quot; MIME_NAMESPACE_URI &quot;\&quot;\n&gt;&quot;);</span>
  
    if (bookmark-&gt;title)
      {
        gchar *escaped_title;
  
        escaped_title = g_markup_escape_text (bookmark-&gt;title, -1);
  
        buffer = g_strconcat (&quot;  &quot;
<span class="line-modified">!           &quot;&lt;&quot; XBEL_TITLE_ELEMENT &quot;&gt;&quot;,</span>
<span class="line-modified">!           escaped_title,</span>
<span class="line-modified">!           &quot;&lt;/&quot; XBEL_TITLE_ELEMENT &quot;&gt;\n&quot;, NULL);</span>
  
        g_string_append (retval, buffer);
  
        g_free (buffer);
        g_free (escaped_title);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1568,13 ***</span>
        gchar *escaped_desc;
  
        escaped_desc = g_markup_escape_text (bookmark-&gt;description, -1);
  
        buffer = g_strconcat (&quot;  &quot;
<span class="line-modified">!                 &quot;&lt;&quot; XBEL_DESC_ELEMENT &quot;&gt;&quot;,</span>
<span class="line-modified">!                 escaped_desc,</span>
<span class="line-modified">!                 &quot;&lt;/&quot; XBEL_DESC_ELEMENT &quot;&gt;\n&quot;, NULL);</span>
        g_string_append (retval, buffer);
  
        g_free (buffer);
        g_free (escaped_desc);
      }
<span class="line-new-header">--- 1573,13 ---</span>
        gchar *escaped_desc;
  
        escaped_desc = g_markup_escape_text (bookmark-&gt;description, -1);
  
        buffer = g_strconcat (&quot;  &quot;
<span class="line-modified">!           &quot;&lt;&quot; XBEL_DESC_ELEMENT &quot;&gt;&quot;,</span>
<span class="line-modified">!           escaped_desc,</span>
<span class="line-modified">!           &quot;&lt;/&quot; XBEL_DESC_ELEMENT &quot;&gt;\n&quot;, NULL);</span>
        g_string_append (retval, buffer);
  
        g_free (buffer);
        g_free (escaped_desc);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1618,32 ***</span>
   * should free the returned string.
   */
  static gchar *
  timestamp_to_iso8601 (time_t timestamp)
  {
<span class="line-modified">!   GTimeVal stamp;</span>
  
<span class="line-modified">!   if (timestamp == (time_t) -1)</span>
<span class="line-removed">-     g_get_current_time (&amp;stamp);</span>
<span class="line-removed">-   else</span>
<span class="line-removed">-     {</span>
<span class="line-removed">-       stamp.tv_sec = timestamp;</span>
<span class="line-removed">-       stamp.tv_usec = 0;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-   return g_time_val_to_iso8601 (&amp;stamp);</span>
  }
  
<span class="line-modified">! static time_t</span>
<span class="line-modified">! timestamp_from_iso8601 (const gchar *iso_date)</span>
  {
<span class="line-modified">!   GTimeVal stamp;</span>
  
<span class="line-modified">!   if (!g_time_val_from_iso8601 (iso_date, &amp;stamp))</span>
<span class="line-modified">!     return (time_t) -1;</span>
  
<span class="line-modified">!   return (time_t) stamp.tv_sec;</span>
  }
  
  G_DEFINE_QUARK (g-bookmark-file-error-quark, g_bookmark_file_error)
  
  /********************
<span class="line-new-header">--- 1623,36 ---</span>
   * should free the returned string.
   */
  static gchar *
  timestamp_to_iso8601 (time_t timestamp)
  {
<span class="line-modified">!   GDateTime *dt = g_date_time_new_from_unix_utc (timestamp);</span>
<span class="line-added">+   gchar *iso8601_string = g_date_time_format_iso8601 (dt);</span>
<span class="line-added">+   g_date_time_unref (dt);</span>
  
<span class="line-modified">!   return g_steal_pointer (&amp;iso8601_string);</span>
  }
  
<span class="line-modified">! static gboolean</span>
<span class="line-modified">! timestamp_from_iso8601 (const gchar  *iso_date,</span>
<span class="line-added">+                         time_t       *out_timestamp,</span>
<span class="line-added">+                         GError      **error)</span>
  {
<span class="line-modified">!   gint64 time_val;</span>
<span class="line-added">+   GDateTime *dt = g_date_time_new_from_iso8601 (iso_date, NULL);</span>
<span class="line-added">+   if (dt == NULL)</span>
<span class="line-added">+     {</span>
<span class="line-added">+       g_set_error (error, G_BOOKMARK_FILE_ERROR, G_BOOKMARK_FILE_ERROR_READ,</span>
<span class="line-added">+                    _(&quot;Invalid date/time &#39;%s&#39; in bookmark file&quot;), iso_date);</span>
<span class="line-added">+       return FALSE;</span>
<span class="line-added">+     }</span>
  
<span class="line-modified">!   time_val = g_date_time_to_unix (dt);</span>
<span class="line-modified">!   g_date_time_unref (dt);</span>
  
<span class="line-modified">!   *out_timestamp = time_val;</span>
<span class="line-added">+   return TRUE;</span>
  }
  
  G_DEFINE_QUARK (g-bookmark-file-error-quark, g_bookmark_file_error)
  
  /********************
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1710,13 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_load_from_data (GBookmarkFile  *bookmark,
<span class="line-modified">!                 const gchar    *data,</span>
<span class="line-modified">!                 gsize           length,</span>
<span class="line-modified">!                 GError        **error)</span>
  {
    GError *parse_error;
    gboolean retval;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
<span class="line-new-header">--- 1719,13 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_load_from_data (GBookmarkFile  *bookmark,
<span class="line-modified">!         const gchar    *data,</span>
<span class="line-modified">!         gsize           length,</span>
<span class="line-modified">!         GError        **error)</span>
  {
    GError *parse_error;
    gboolean retval;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1754,12 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_load_from_file (GBookmarkFile  *bookmark,
<span class="line-modified">!                 const gchar    *filename,</span>
<span class="line-modified">!                 GError        **error)</span>
  {
    gboolean ret = FALSE;
    gchar *buffer = NULL;
    gsize len;
  
<span class="line-new-header">--- 1763,12 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_load_from_file (GBookmarkFile  *bookmark,
<span class="line-modified">!         const gchar    *filename,</span>
<span class="line-modified">!         GError        **error)</span>
  {
    gboolean ret = FALSE;
    gchar *buffer = NULL;
    gsize len;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1866,13 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_load_from_data_dirs (GBookmarkFile  *bookmark,
<span class="line-modified">!                      const gchar    *file,</span>
<span class="line-modified">!                      gchar         **full_path,</span>
<span class="line-modified">!                      GError        **error)</span>
  {
    GError *file_error = NULL;
    gchar **all_data_dirs, **data_dirs;
    const gchar *user_data_dir;
    const gchar * const * system_data_dirs;
<span class="line-new-header">--- 1875,13 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_load_from_data_dirs (GBookmarkFile  *bookmark,
<span class="line-modified">!              const gchar    *file,</span>
<span class="line-modified">!              gchar         **full_path,</span>
<span class="line-modified">!              GError        **error)</span>
  {
    GError *file_error = NULL;
    gchar **all_data_dirs, **data_dirs;
    const gchar *user_data_dir;
    const gchar * const * system_data_dirs;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1904,20 ***</span>
        output_path = find_file_in_data_dirs (file, &amp;data_dirs, &amp;file_error);
  
        if (file_error)
          {
            g_propagate_error (error, file_error);
<span class="line-modified">!       break;</span>
          }
  
        found_file = g_bookmark_file_load_from_file (bookmark,
<span class="line-modified">!                                output_path,</span>
<span class="line-modified">!                                &amp;file_error);</span>
        if (file_error)
          {
<span class="line-modified">!       g_propagate_error (error, file_error);</span>
<span class="line-modified">!       break;</span>
          }
      }
  
    if (found_file &amp;&amp; full_path)
      *full_path = output_path;
<span class="line-new-header">--- 1913,20 ---</span>
        output_path = find_file_in_data_dirs (file, &amp;data_dirs, &amp;file_error);
  
        if (file_error)
          {
            g_propagate_error (error, file_error);
<span class="line-modified">!     break;</span>
          }
  
        found_file = g_bookmark_file_load_from_file (bookmark,
<span class="line-modified">!                      output_path,</span>
<span class="line-modified">!                      &amp;file_error);</span>
        if (file_error)
          {
<span class="line-modified">!     g_propagate_error (error, file_error);</span>
<span class="line-modified">!     break;</span>
          }
      }
  
    if (found_file &amp;&amp; full_path)
      *full_path = output_path;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1943,12 ***</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_to_data (GBookmarkFile  *bookmark,
<span class="line-modified">!              gsize          *length,</span>
<span class="line-modified">!              GError        **error)</span>
  {
    GError *write_error = NULL;
    gchar *retval;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
<span class="line-new-header">--- 1952,12 ---</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_to_data (GBookmarkFile  *bookmark,
<span class="line-modified">!        gsize          *length,</span>
<span class="line-modified">!        GError        **error)</span>
  {
    GError *write_error = NULL;
    gchar *retval;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1977,12 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_to_file (GBookmarkFile  *bookmark,
<span class="line-modified">!              const gchar    *filename,</span>
<span class="line-modified">!              GError        **error)</span>
  {
    gchar *data;
    GError *data_error, *write_error;
    gsize len;
    gboolean retval;
<span class="line-new-header">--- 1986,12 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_to_file (GBookmarkFile  *bookmark,
<span class="line-modified">!        const gchar    *filename,</span>
<span class="line-modified">!        GError        **error)</span>
  {
    gchar *data;
    GError *data_error, *write_error;
    gsize len;
    gboolean retval;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2015,22 ***</span>
    return retval;
  }
  
  static BookmarkItem *
  g_bookmark_file_lookup_item (GBookmarkFile *bookmark,
<span class="line-modified">!                  const gchar   *uri)</span>
  {
    g_warn_if_fail (bookmark != NULL &amp;&amp; uri != NULL);
  
    return g_hash_table_lookup (bookmark-&gt;items_by_uri, uri);
  }
  
  /* this function adds a new item to the list */
  static void
  g_bookmark_file_add_item (GBookmarkFile  *bookmark,
<span class="line-modified">!               BookmarkItem   *item,</span>
<span class="line-modified">!               GError        **error)</span>
  {
    g_warn_if_fail (bookmark != NULL);
    g_warn_if_fail (item != NULL);
  
  #ifdef GSTREAMER_LITE
<span class="line-new-header">--- 2024,22 ---</span>
    return retval;
  }
  
  static BookmarkItem *
  g_bookmark_file_lookup_item (GBookmarkFile *bookmark,
<span class="line-modified">!            const gchar   *uri)</span>
  {
    g_warn_if_fail (bookmark != NULL &amp;&amp; uri != NULL);
  
    return g_hash_table_lookup (bookmark-&gt;items_by_uri, uri);
  }
  
  /* this function adds a new item to the list */
  static void
  g_bookmark_file_add_item (GBookmarkFile  *bookmark,
<span class="line-modified">!         BookmarkItem   *item,</span>
<span class="line-modified">!         GError        **error)</span>
  {
    g_warn_if_fail (bookmark != NULL);
    g_warn_if_fail (item != NULL);
  
  #ifdef GSTREAMER_LITE
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2043,21 ***</span>
     * screwing up something big time.
     */
    if (G_UNLIKELY (g_bookmark_file_has_item (bookmark, item-&gt;uri)))
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_INVALID_URI,</span>
<span class="line-modified">!                    _(&quot;A bookmark for URI &#39;%s&#39; already exists&quot;),</span>
<span class="line-modified">!                    item-&gt;uri);</span>
        return;
      }
  
    bookmark-&gt;items = g_list_prepend (bookmark-&gt;items, item);
  
    g_hash_table_replace (bookmark-&gt;items_by_uri,
<span class="line-modified">!             item-&gt;uri,</span>
<span class="line-modified">!             item);</span>
  
    if (item-&gt;added == (time_t) -1)
      item-&gt;added = time (NULL);
  
    if (item-&gt;modified == (time_t) -1)
<span class="line-new-header">--- 2052,21 ---</span>
     * screwing up something big time.
     */
    if (G_UNLIKELY (g_bookmark_file_has_item (bookmark, item-&gt;uri)))
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_INVALID_URI,</span>
<span class="line-modified">!        _(&quot;A bookmark for URI &#39;%s&#39; already exists&quot;),</span>
<span class="line-modified">!        item-&gt;uri);</span>
        return;
      }
  
    bookmark-&gt;items = g_list_prepend (bookmark-&gt;items, item);
  
    g_hash_table_replace (bookmark-&gt;items_by_uri,
<span class="line-modified">!       item-&gt;uri,</span>
<span class="line-modified">!       item);</span>
  
    if (item-&gt;added == (time_t) -1)
      item-&gt;added = time (NULL);
  
    if (item-&gt;modified == (time_t) -1)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2076,12 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_remove_item (GBookmarkFile  *bookmark,
<span class="line-modified">!                  const gchar    *uri,</span>
<span class="line-modified">!                  GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
<span class="line-new-header">--- 2085,12 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_remove_item (GBookmarkFile  *bookmark,
<span class="line-modified">!            const gchar    *uri,</span>
<span class="line-modified">!            GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2089,13 ***</span>
    item = g_bookmark_file_lookup_item (bookmark, uri);
  
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    bookmark-&gt;items = g_list_remove (bookmark-&gt;items, item);
    g_hash_table_remove (bookmark-&gt;items_by_uri, item-&gt;uri);
<span class="line-new-header">--- 2098,13 ---</span>
    item = g_bookmark_file_lookup_item (bookmark, uri);
  
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    bookmark-&gt;items = g_list_remove (bookmark-&gt;items, item);
    g_hash_table_remove (bookmark-&gt;items_by_uri, item-&gt;uri);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2116,11 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_has_item (GBookmarkFile *bookmark,
<span class="line-modified">!               const gchar   *uri)</span>
  {
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
  
    return (NULL != g_hash_table_lookup (bookmark-&gt;items_by_uri, uri));
<span class="line-new-header">--- 2125,11 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_has_item (GBookmarkFile *bookmark,
<span class="line-modified">!         const gchar   *uri)</span>
  {
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
  
    return (NULL != g_hash_table_lookup (bookmark-&gt;items_by_uri, uri));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2140,11 ***</span>
   *
   * Since: 2.12
   */
  gchar **
  g_bookmark_file_get_uris (GBookmarkFile *bookmark,
<span class="line-modified">!               gsize         *length)</span>
  {
    GList *l;
    gchar **uris;
    gsize i, n_items;
  
<span class="line-new-header">--- 2149,11 ---</span>
   *
   * Since: 2.12
   */
  gchar **
  g_bookmark_file_get_uris (GBookmarkFile *bookmark,
<span class="line-modified">!         gsize         *length)</span>
  {
    GList *l;
    gchar **uris;
    gsize i, n_items;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2185,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_title (GBookmarkFile *bookmark,
<span class="line-modified">!                const gchar   *uri,</span>
<span class="line-modified">!                const gchar   *title)</span>
  {
    g_return_if_fail (bookmark != NULL);
  
    if (!uri)
      {
<span class="line-new-header">--- 2194,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_title (GBookmarkFile *bookmark,
<span class="line-modified">!          const gchar   *uri,</span>
<span class="line-modified">!          const gchar   *title)</span>
  {
    g_return_if_fail (bookmark != NULL);
  
    if (!uri)
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2233,12 ***</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_get_title (GBookmarkFile  *bookmark,
<span class="line-modified">!                const gchar    *uri,</span>
<span class="line-modified">!                GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
  
<span class="line-new-header">--- 2242,12 ---</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_get_title (GBookmarkFile  *bookmark,
<span class="line-modified">!          const gchar    *uri,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2247,13 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return NULL;
      }
  
    return g_strdup (item-&gt;title);
  }
<span class="line-new-header">--- 2256,13 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return NULL;
      }
  
    return g_strdup (item-&gt;title);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2272,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_description (GBookmarkFile *bookmark,
<span class="line-modified">!                  const gchar   *uri,</span>
<span class="line-modified">!                  const gchar   *description)</span>
  {
    g_return_if_fail (bookmark != NULL);
  
    if (!uri)
      {
<span class="line-new-header">--- 2281,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_description (GBookmarkFile *bookmark,
<span class="line-modified">!          const gchar   *uri,</span>
<span class="line-modified">!          const gchar   *description)</span>
  {
    g_return_if_fail (bookmark != NULL);
  
    if (!uri)
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2318,12 ***</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_get_description (GBookmarkFile  *bookmark,
<span class="line-modified">!                  const gchar    *uri,</span>
<span class="line-modified">!                  GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
  
<span class="line-new-header">--- 2327,12 ---</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_get_description (GBookmarkFile  *bookmark,
<span class="line-modified">!          const gchar    *uri,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2332,13 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return NULL;
      }
  
    return g_strdup (item-&gt;description);
  }
<span class="line-new-header">--- 2341,13 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return NULL;
      }
  
    return g_strdup (item-&gt;description);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2355,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_mime_type (GBookmarkFile *bookmark,
<span class="line-modified">!                    const gchar   *uri,</span>
<span class="line-modified">!                    const gchar   *mime_type)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
<span class="line-new-header">--- 2364,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_mime_type (GBookmarkFile *bookmark,
<span class="line-modified">!              const gchar   *uri,</span>
<span class="line-modified">!              const gchar   *mime_type)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2400,34 ***</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_get_mime_type (GBookmarkFile  *bookmark,
<span class="line-modified">!                    const gchar    *uri,</span>
<span class="line-modified">!                    GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
    g_return_val_if_fail (uri != NULL, NULL);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return NULL;
      }
  
    if (!item-&gt;metadata)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!                    _(&quot;No MIME type defined in the bookmark for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return NULL;
      }
  
    return g_strdup (item-&gt;metadata-&gt;mime_type);
  }
<span class="line-new-header">--- 2409,34 ---</span>
   *
   * Since: 2.12
   */
  gchar *
  g_bookmark_file_get_mime_type (GBookmarkFile  *bookmark,
<span class="line-modified">!              const gchar    *uri,</span>
<span class="line-modified">!              GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, NULL);
    g_return_val_if_fail (uri != NULL, NULL);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return NULL;
      }
  
    if (!item-&gt;metadata)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!        _(&quot;No MIME type defined in the bookmark for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return NULL;
      }
  
    return g_strdup (item-&gt;metadata-&gt;mime_type);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2444,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_is_private (GBookmarkFile *bookmark,
<span class="line-modified">!                 const gchar   *uri,</span>
<span class="line-modified">!                 gboolean       is_private)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
<span class="line-new-header">--- 2453,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_is_private (GBookmarkFile *bookmark,
<span class="line-modified">!         const gchar   *uri,</span>
<span class="line-modified">!         gboolean       is_private)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2485,34 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_get_is_private (GBookmarkFile  *bookmark,
<span class="line-modified">!                 const gchar    *uri,</span>
<span class="line-modified">!                 GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    if (!item-&gt;metadata)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!                    _(&quot;No private flag has been defined in bookmark for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    return item-&gt;metadata-&gt;is_private;
  }
<span class="line-new-header">--- 2494,34 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_get_is_private (GBookmarkFile  *bookmark,
<span class="line-modified">!         const gchar    *uri,</span>
<span class="line-modified">!         GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    if (!item-&gt;metadata)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!        _(&quot;No private flag has been defined in bookmark for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!         uri);</span>
        return FALSE;
      }
  
    return item-&gt;metadata-&gt;is_private;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2529,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_added (GBookmarkFile *bookmark,
<span class="line-modified">!                const gchar   *uri,</span>
<span class="line-modified">!                time_t         added)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
<span class="line-new-header">--- 2538,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_added (GBookmarkFile *bookmark,
<span class="line-modified">!          const gchar   *uri,</span>
<span class="line-modified">!          time_t         added)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2568,25 ***</span>
   *
   * Since: 2.12
   */
  time_t
  g_bookmark_file_get_added (GBookmarkFile  *bookmark,
<span class="line-modified">!                const gchar    *uri,</span>
<span class="line-modified">!                GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, (time_t) -1);
    g_return_val_if_fail (uri != NULL, (time_t) -1);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return (time_t) -1;
      }
  
    return item-&gt;added;
  }
<span class="line-new-header">--- 2577,25 ---</span>
   *
   * Since: 2.12
   */
  time_t
  g_bookmark_file_get_added (GBookmarkFile  *bookmark,
<span class="line-modified">!          const gchar    *uri,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, (time_t) -1);
    g_return_val_if_fail (uri != NULL, (time_t) -1);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return (time_t) -1;
      }
  
    return item-&gt;added;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2608,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_modified (GBookmarkFile *bookmark,
<span class="line-modified">!                   const gchar   *uri,</span>
<span class="line-modified">!                   time_t         modified)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
<span class="line-new-header">--- 2617,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_modified (GBookmarkFile *bookmark,
<span class="line-modified">!             const gchar   *uri,</span>
<span class="line-modified">!             time_t         modified)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2646,25 ***</span>
   *
   * Since: 2.12
   */
  time_t
  g_bookmark_file_get_modified (GBookmarkFile  *bookmark,
<span class="line-modified">!                   const gchar    *uri,</span>
<span class="line-modified">!                   GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, (time_t) -1);
    g_return_val_if_fail (uri != NULL, (time_t) -1);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return (time_t) -1;
      }
  
    return item-&gt;modified;
  }
<span class="line-new-header">--- 2655,25 ---</span>
   *
   * Since: 2.12
   */
  time_t
  g_bookmark_file_get_modified (GBookmarkFile  *bookmark,
<span class="line-modified">!             const gchar    *uri,</span>
<span class="line-modified">!             GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, (time_t) -1);
    g_return_val_if_fail (uri != NULL, (time_t) -1);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return (time_t) -1;
      }
  
    return item-&gt;modified;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2687,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_visited (GBookmarkFile *bookmark,
<span class="line-modified">!                  const gchar   *uri,</span>
<span class="line-modified">!                  time_t         visited)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
<span class="line-new-header">--- 2696,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_visited (GBookmarkFile *bookmark,
<span class="line-modified">!            const gchar   *uri,</span>
<span class="line-modified">!            time_t         visited)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2725,25 ***</span>
   *
   * Since: 2.12
   */
  time_t
  g_bookmark_file_get_visited (GBookmarkFile  *bookmark,
<span class="line-modified">!                  const gchar    *uri,</span>
<span class="line-modified">!                  GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, (time_t) -1);
    g_return_val_if_fail (uri != NULL, (time_t) -1);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return (time_t) -1;
      }
  
    return item-&gt;visited;
  }
<span class="line-new-header">--- 2734,25 ---</span>
   *
   * Since: 2.12
   */
  time_t
  g_bookmark_file_get_visited (GBookmarkFile  *bookmark,
<span class="line-modified">!            const gchar    *uri,</span>
<span class="line-modified">!            GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, (time_t) -1);
    g_return_val_if_fail (uri != NULL, (time_t) -1);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return (time_t) -1;
      }
  
    return item-&gt;visited;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2765,13 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_has_group (GBookmarkFile  *bookmark,
<span class="line-modified">!                const gchar    *uri,</span>
<span class="line-modified">!                const gchar    *group,</span>
<span class="line-modified">!                GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
<span class="line-new-header">--- 2774,13 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_has_group (GBookmarkFile  *bookmark,
<span class="line-modified">!          const gchar    *uri,</span>
<span class="line-modified">!          const gchar    *group,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2779,13 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    if (!item-&gt;metadata)
      return FALSE;
<span class="line-new-header">--- 2788,13 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    if (!item-&gt;metadata)
      return FALSE;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2813,12 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_add_group (GBookmarkFile *bookmark,
<span class="line-modified">!                const gchar   *uri,</span>
<span class="line-modified">!                const gchar   *group)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
<span class="line-new-header">--- 2822,12 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_add_group (GBookmarkFile *bookmark,
<span class="line-modified">!          const gchar   *uri,</span>
<span class="line-modified">!          const gchar   *group)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2862,13 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_remove_group (GBookmarkFile  *bookmark,
<span class="line-modified">!                   const gchar    *uri,</span>
<span class="line-modified">!                   const gchar    *group,</span>
<span class="line-modified">!                   GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
<span class="line-new-header">--- 2871,13 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_remove_group (GBookmarkFile  *bookmark,
<span class="line-modified">!             const gchar    *uri,</span>
<span class="line-modified">!             const gchar    *group,</span>
<span class="line-modified">!             GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2876,13 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    if (!item-&gt;metadata)
      {
<span class="line-new-header">--- 2885,13 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    if (!item-&gt;metadata)
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2897,11 ***</span>
      {
        if (strcmp (l-&gt;data, group) == 0)
          {
            item-&gt;metadata-&gt;groups = g_list_remove_link (item-&gt;metadata-&gt;groups, l);
            g_free (l-&gt;data);
<span class="line-modified">!       g_list_free_1 (l);</span>
  
            item-&gt;modified = time (NULL);
  
            return TRUE;
          }
<span class="line-new-header">--- 2906,11 ---</span>
      {
        if (strcmp (l-&gt;data, group) == 0)
          {
            item-&gt;metadata-&gt;groups = g_list_remove_link (item-&gt;metadata-&gt;groups, l);
            g_free (l-&gt;data);
<span class="line-modified">!     g_list_free_1 (l);</span>
  
            item-&gt;modified = time (NULL);
  
            return TRUE;
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2925,13 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_groups (GBookmarkFile  *bookmark,
<span class="line-modified">!                 const gchar    *uri,</span>
<span class="line-modified">!                 const gchar   **groups,</span>
<span class="line-modified">!                 gsize           length)</span>
  {
    BookmarkItem *item;
    gsize i;
  
    g_return_if_fail (bookmark != NULL);
<span class="line-new-header">--- 2934,13 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_groups (GBookmarkFile  *bookmark,
<span class="line-modified">!           const gchar    *uri,</span>
<span class="line-modified">!           const gchar   **groups,</span>
<span class="line-modified">!           gsize           length)</span>
  {
    BookmarkItem *item;
    gsize i;
  
    g_return_if_fail (bookmark != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2953,11 ***</span>
  
    if (groups)
      {
        for (i = 0; i &lt; length &amp;&amp; groups[i] != NULL; i++)
          item-&gt;metadata-&gt;groups = g_list_append (item-&gt;metadata-&gt;groups,
<span class="line-modified">!                             g_strdup (groups[i]));</span>
      }
  
    item-&gt;modified = time (NULL);
  }
  
<span class="line-new-header">--- 2962,11 ---</span>
  
    if (groups)
      {
        for (i = 0; i &lt; length &amp;&amp; groups[i] != NULL; i++)
          item-&gt;metadata-&gt;groups = g_list_append (item-&gt;metadata-&gt;groups,
<span class="line-modified">!                   g_strdup (groups[i]));</span>
      }
  
    item-&gt;modified = time (NULL);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2981,13 ***</span>
   *
   * Since: 2.12
   */
  gchar **
  g_bookmark_file_get_groups (GBookmarkFile  *bookmark,
<span class="line-modified">!                 const gchar    *uri,</span>
<span class="line-modified">!                 gsize          *length,</span>
<span class="line-modified">!                 GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
    gsize len, i;
    gchar **retval;
<span class="line-new-header">--- 2990,13 ---</span>
   *
   * Since: 2.12
   */
  gchar **
  g_bookmark_file_get_groups (GBookmarkFile  *bookmark,
<span class="line-modified">!           const gchar    *uri,</span>
<span class="line-modified">!           gsize          *length,</span>
<span class="line-modified">!           GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
    gsize len, i;
    gchar **retval;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2997,20 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return NULL;
      }
  
    if (!item-&gt;metadata)
      {
        if (length)
<span class="line-modified">!     *length = 0;</span>
  
        return NULL;
      }
  
    len = g_list_length (item-&gt;metadata-&gt;groups);
<span class="line-new-header">--- 3006,20 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return NULL;
      }
  
    if (!item-&gt;metadata)
      {
        if (length)
<span class="line-modified">!   *length = 0;</span>
  
        return NULL;
      }
  
    len = g_list_length (item-&gt;metadata-&gt;groups);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3066,13 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_add_application (GBookmarkFile *bookmark,
<span class="line-modified">!                  const gchar   *uri,</span>
<span class="line-modified">!                  const gchar   *name,</span>
<span class="line-modified">!                  const gchar   *exec)</span>
  {
    BookmarkItem *item;
    gchar *app_name, *app_exec;
  
    g_return_if_fail (bookmark != NULL);
<span class="line-new-header">--- 3075,13 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_add_application (GBookmarkFile *bookmark,
<span class="line-modified">!          const gchar   *uri,</span>
<span class="line-modified">!          const gchar   *name,</span>
<span class="line-modified">!          const gchar   *exec)</span>
  {
    BookmarkItem *item;
    gchar *app_name, *app_exec;
  
    g_return_if_fail (bookmark != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3126,28 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_remove_application (GBookmarkFile  *bookmark,
<span class="line-modified">!                     const gchar    *uri,</span>
<span class="line-modified">!                     const gchar    *name,</span>
<span class="line-modified">!                     GError        **error)</span>
  {
    GError *set_error;
    gboolean retval;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
    g_return_val_if_fail (name != NULL, FALSE);
  
    set_error = NULL;
    retval = g_bookmark_file_set_app_info (bookmark, uri,
<span class="line-modified">!                      name,</span>
<span class="line-modified">!                      &quot;&quot;,</span>
<span class="line-modified">!                      0,</span>
<span class="line-modified">!                      (time_t) -1,</span>
<span class="line-modified">!                      &amp;set_error);</span>
    if (set_error)
      {
        g_propagate_error (error, set_error);
  
        return FALSE;
<span class="line-new-header">--- 3135,28 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_remove_application (GBookmarkFile  *bookmark,
<span class="line-modified">!             const gchar    *uri,</span>
<span class="line-modified">!             const gchar    *name,</span>
<span class="line-modified">!             GError        **error)</span>
  {
    GError *set_error;
    gboolean retval;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
    g_return_val_if_fail (name != NULL, FALSE);
  
    set_error = NULL;
    retval = g_bookmark_file_set_app_info (bookmark, uri,
<span class="line-modified">!              name,</span>
<span class="line-modified">!              &quot;&quot;,</span>
<span class="line-modified">!              0,</span>
<span class="line-modified">!              (time_t) -1,</span>
<span class="line-modified">!              &amp;set_error);</span>
    if (set_error)
      {
        g_propagate_error (error, set_error);
  
        return FALSE;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3173,13 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_has_application (GBookmarkFile  *bookmark,
<span class="line-modified">!                  const gchar    *uri,</span>
<span class="line-modified">!                  const gchar    *name,</span>
<span class="line-modified">!                  GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
<span class="line-new-header">--- 3182,13 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_has_application (GBookmarkFile  *bookmark,
<span class="line-modified">!          const gchar    *uri,</span>
<span class="line-modified">!          const gchar    *name,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3187,13 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    return (NULL != bookmark_item_lookup_app_info (item, name));
  }
<span class="line-new-header">--- 3196,13 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    return (NULL != bookmark_item_lookup_app_info (item, name));
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3242,16 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_set_app_info (GBookmarkFile  *bookmark,
<span class="line-modified">!                   const gchar    *uri,</span>
<span class="line-modified">!                   const gchar    *name,</span>
<span class="line-modified">!                   const gchar    *exec,</span>
<span class="line-modified">!                   gint            count,</span>
<span class="line-modified">!                   time_t          stamp,</span>
<span class="line-modified">!                   GError        **error)</span>
  {
    BookmarkItem *item;
    BookmarkAppInfo *ai;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
<span class="line-new-header">--- 3251,16 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_set_app_info (GBookmarkFile  *bookmark,
<span class="line-modified">!             const gchar    *uri,</span>
<span class="line-modified">!             const gchar    *name,</span>
<span class="line-modified">!             const gchar    *exec,</span>
<span class="line-modified">!             gint            count,</span>
<span class="line-modified">!             time_t          stamp,</span>
<span class="line-modified">!             GError        **error)</span>
  {
    BookmarkItem *item;
    BookmarkAppInfo *ai;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3263,20 ***</span>
    if (!item)
      {
        if (count == 0)
          {
            g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                        uri);</span>
<span class="line-modified">!       return FALSE;</span>
<span class="line-modified">!     }</span>
        else
          {
            item = bookmark_item_new (uri);
<span class="line-modified">!       g_bookmark_file_add_item (bookmark, item, NULL);</span>
<span class="line-modified">!     }</span>
      }
  
    if (!item-&gt;metadata)
      item-&gt;metadata = bookmark_metadata_new ();
  
<span class="line-new-header">--- 3272,20 ---</span>
    if (!item)
      {
        if (count == 0)
          {
            g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!            G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!            _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!            uri);</span>
<span class="line-modified">!     return FALSE;</span>
<span class="line-modified">!   }</span>
        else
          {
            item = bookmark_item_new (uri);
<span class="line-modified">!     g_bookmark_file_add_item (bookmark, item, NULL);</span>
<span class="line-modified">!   }</span>
      }
  
    if (!item-&gt;metadata)
      item-&gt;metadata = bookmark_metadata_new ();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3284,14 ***</span>
    if (!ai)
      {
        if (count == 0)
          {
            g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                        G_BOOKMARK_FILE_ERROR_APP_NOT_REGISTERED,</span>
<span class="line-modified">!                        _(&quot;No application with name &#39;%s&#39; registered a bookmark for &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                        name,</span>
<span class="line-modified">!                        uri);</span>
            return FALSE;
          }
        else
          {
            ai = bookmark_app_info_new (name);
<span class="line-new-header">--- 3293,14 ---</span>
    if (!ai)
      {
        if (count == 0)
          {
            g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!            G_BOOKMARK_FILE_ERROR_APP_NOT_REGISTERED,</span>
<span class="line-modified">!            _(&quot;No application with name &#39;%s&#39; registered a bookmark for &#39;%s&#39;&quot;),</span>
<span class="line-modified">!            name,</span>
<span class="line-modified">!            uri);</span>
            return FALSE;
          }
        else
          {
            ai = bookmark_app_info_new (name);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3338,11 ***</span>
  }
  
  /* expands the application&#39;s command line */
  static gchar *
  expand_exec_line (const gchar *exec_fmt,
<span class="line-modified">!           const gchar *uri)</span>
  {
    GString *exec;
    gchar ch;
  
    exec = g_string_sized_new (512);
<span class="line-new-header">--- 3347,11 ---</span>
  }
  
  /* expands the application&#39;s command line */
  static gchar *
  expand_exec_line (const gchar *exec_fmt,
<span class="line-modified">!       const gchar *uri)</span>
  {
    GString *exec;
    gchar ch;
  
    exec = g_string_sized_new (512);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3356,23 ***</span>
  
       ch = *exec_fmt++;
       switch (ch)
         {
         case &#39;\0&#39;:
<span class="line-modified">!      goto out;</span>
         case &#39;U&#39;:
         case &#39;u&#39;:
           g_string_append (exec, uri);
           break;
         case &#39;F&#39;:
         case &#39;f&#39;:
           {
<span class="line-modified">!        gchar *file = g_filename_from_uri (uri, NULL, NULL);</span>
             if (file)
               {
<span class="line-modified">!            g_string_append (exec, file);</span>
<span class="line-modified">!            g_free (file);</span>
               }
             else
               {
                 g_string_free (exec, TRUE);
                 return NULL;
<span class="line-new-header">--- 3365,23 ---</span>
  
       ch = *exec_fmt++;
       switch (ch)
         {
         case &#39;\0&#39;:
<span class="line-modified">!    goto out;</span>
         case &#39;U&#39;:
         case &#39;u&#39;:
           g_string_append (exec, uri);
           break;
         case &#39;F&#39;:
         case &#39;f&#39;:
           {
<span class="line-modified">!      gchar *file = g_filename_from_uri (uri, NULL, NULL);</span>
             if (file)
               {
<span class="line-modified">!          g_string_append (exec, file);</span>
<span class="line-modified">!          g_free (file);</span>
               }
             else
               {
                 g_string_free (exec, TRUE);
                 return NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3418,16 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_get_app_info (GBookmarkFile  *bookmark,
<span class="line-modified">!                   const gchar    *uri,</span>
<span class="line-modified">!                   const gchar    *name,</span>
<span class="line-modified">!                   gchar         **exec,</span>
<span class="line-modified">!                   guint          *count,</span>
<span class="line-modified">!                   time_t         *stamp,</span>
<span class="line-modified">!                   GError        **error)</span>
  {
    BookmarkItem *item;
    BookmarkAppInfo *ai;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
<span class="line-new-header">--- 3427,16 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_get_app_info (GBookmarkFile  *bookmark,
<span class="line-modified">!             const gchar    *uri,</span>
<span class="line-modified">!             const gchar    *name,</span>
<span class="line-modified">!             gchar         **exec,</span>
<span class="line-modified">!             guint          *count,</span>
<span class="line-modified">!             time_t         *stamp,</span>
<span class="line-modified">!             GError        **error)</span>
  {
    BookmarkItem *item;
    BookmarkAppInfo *ai;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3436,24 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    ai = bookmark_item_lookup_app_info (item, name);
    if (!ai)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_APP_NOT_REGISTERED,</span>
<span class="line-modified">!                    _(&quot;No application with name &#39;%s&#39; registered a bookmark for &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    name,</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    if (exec)
      {
<span class="line-new-header">--- 3445,24 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    ai = bookmark_item_lookup_app_info (item, name);
    if (!ai)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_APP_NOT_REGISTERED,</span>
<span class="line-modified">!        _(&quot;No application with name &#39;%s&#39; registered a bookmark for &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        name,</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    if (exec)
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3469,13 ***</span>
  
        *exec = expand_exec_line (command_line, uri);
        if (!*exec)
          {
            g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                        G_BOOKMARK_FILE_ERROR_INVALID_URI,</span>
<span class="line-modified">!                        _(&quot;Failed to expand exec line &#39;%s&#39; with URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                        ai-&gt;exec, uri);</span>
            g_free (command_line);
  
            return FALSE;
          }
        else
<span class="line-new-header">--- 3478,13 ---</span>
  
        *exec = expand_exec_line (command_line, uri);
        if (!*exec)
          {
            g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!            G_BOOKMARK_FILE_ERROR_INVALID_URI,</span>
<span class="line-modified">!            _(&quot;Failed to expand exec line &#39;%s&#39; with URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!          ai-&gt;exec, uri);</span>
            g_free (command_line);
  
            return FALSE;
          }
        else
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3509,13 ***</span>
   *
   * Since: 2.12
   */
  gchar **
  g_bookmark_file_get_applications (GBookmarkFile  *bookmark,
<span class="line-modified">!                   const gchar    *uri,</span>
<span class="line-modified">!                   gsize          *length,</span>
<span class="line-modified">!                   GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
    gchar **apps;
    gsize i, n_apps;
<span class="line-new-header">--- 3518,13 ---</span>
   *
   * Since: 2.12
   */
  gchar **
  g_bookmark_file_get_applications (GBookmarkFile  *bookmark,
<span class="line-modified">!           const gchar    *uri,</span>
<span class="line-modified">!           gsize          *length,</span>
<span class="line-modified">!           GError        **error)</span>
  {
    BookmarkItem *item;
    GList *l;
    gchar **apps;
    gsize i, n_apps;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3525,20 ***</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return NULL;
      }
  
    if (!item-&gt;metadata)
      {
        if (length)
<span class="line-modified">!     *length = 0;</span>
  
        return NULL;
      }
  
    n_apps = g_list_length (item-&gt;metadata-&gt;applications);
<span class="line-new-header">--- 3534,20 ---</span>
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return NULL;
      }
  
    if (!item-&gt;metadata)
      {
        if (length)
<span class="line-modified">!   *length = 0;</span>
  
        return NULL;
      }
  
    n_apps = g_list_length (item-&gt;metadata-&gt;applications);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3601,26 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_move_item (GBookmarkFile  *bookmark,
<span class="line-modified">!                const gchar    *old_uri,</span>
<span class="line-modified">!                const gchar    *new_uri,</span>
<span class="line-modified">!                GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (old_uri != NULL, FALSE);
  
    item = g_bookmark_file_lookup_item (bookmark, old_uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    old_uri);</span>
        return FALSE;
      }
  
    if (new_uri &amp;&amp; new_uri[0] != &#39;\0&#39;)
      {
<span class="line-new-header">--- 3610,26 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_move_item (GBookmarkFile  *bookmark,
<span class="line-modified">!          const gchar    *old_uri,</span>
<span class="line-modified">!          const gchar    *new_uri,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (old_uri != NULL, FALSE);
  
    item = g_bookmark_file_lookup_item (bookmark, old_uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        old_uri);</span>
        return FALSE;
      }
  
    if (new_uri &amp;&amp; new_uri[0] != &#39;\0&#39;)
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3667,13 ***</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_icon (GBookmarkFile *bookmark,
<span class="line-modified">!               const gchar   *uri,</span>
<span class="line-modified">!               const gchar   *href,</span>
<span class="line-modified">!               const gchar   *mime_type)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
<span class="line-new-header">--- 3676,13 ---</span>
   *
   * Since: 2.12
   */
  void
  g_bookmark_file_set_icon (GBookmarkFile *bookmark,
<span class="line-modified">!         const gchar   *uri,</span>
<span class="line-modified">!         const gchar   *href,</span>
<span class="line-modified">!         const gchar   *mime_type)</span>
  {
    BookmarkItem *item;
  
    g_return_if_fail (bookmark != NULL);
    g_return_if_fail (uri != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3719,27 ***</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_get_icon (GBookmarkFile  *bookmark,
<span class="line-modified">!               const gchar    *uri,</span>
<span class="line-modified">!               gchar         **href,</span>
<span class="line-modified">!               gchar         **mime_type,</span>
<span class="line-modified">!               GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!                    G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    uri);</span>
        return FALSE;
      }
  
    if ((!item-&gt;metadata) || (!item-&gt;metadata-&gt;icon_href))
      return FALSE;
<span class="line-new-header">--- 3728,27 ---</span>
   *
   * Since: 2.12
   */
  gboolean
  g_bookmark_file_get_icon (GBookmarkFile  *bookmark,
<span class="line-modified">!         const gchar    *uri,</span>
<span class="line-modified">!         gchar         **href,</span>
<span class="line-modified">!         gchar         **mime_type,</span>
<span class="line-modified">!         GError        **error)</span>
  {
    BookmarkItem *item;
  
    g_return_val_if_fail (bookmark != NULL, FALSE);
    g_return_val_if_fail (uri != NULL, FALSE);
  
    item = g_bookmark_file_lookup_item (bookmark, uri);
    if (!item)
      {
        g_set_error (error, G_BOOKMARK_FILE_ERROR,
<span class="line-modified">!        G_BOOKMARK_FILE_ERROR_URI_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;No bookmark found for URI &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        uri);</span>
        return FALSE;
      }
  
    if ((!item-&gt;metadata) || (!item-&gt;metadata-&gt;icon_href))
      return FALSE;
</pre>
<center><a href="gbitlock.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gbookmarkfile.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>