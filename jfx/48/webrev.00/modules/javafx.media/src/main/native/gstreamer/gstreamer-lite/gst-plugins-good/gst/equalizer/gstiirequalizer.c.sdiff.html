<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-good/gst/equalizer/gstiirequalizer.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../audioparsers/parsersplugin.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../isomp4/fourcc.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-good/gst/equalizer/gstiirequalizer.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
325      G_LOCK(type_init_mutex);
326      if(!type) // Use double check lock pattern
327      {
328 #endif // GSTREAMER_LITE
329 
330     const GTypeInfo type_info = {
331       sizeof (GstIirEqualizerBandClass),
332       NULL,
333       NULL,
334       (GClassInitFunc) gst_iir_equalizer_band_class_init,
335       NULL,
336       NULL,
337       sizeof (GstIirEqualizerBand),
338       0,
339       (GInstanceInitFunc) gst_iir_equalizer_band_init,
340     };
341     type =
342         g_type_register_static (GST_TYPE_OBJECT, &quot;GstIirEqualizerBand&quot;,
343         &amp;type_info, 0);
344 #ifdef GSTREAMER_LITE
<span class="line-modified">345      }</span>
346      G_UNLOCK(type_init_mutex);
347 #endif // GSTREAMER_LITE
348   }
349   return (type);
350 }
351 
352 
353 /* child proxy iface */
354 static GObject *
355 gst_iir_equalizer_child_proxy_get_child_by_index (GstChildProxy * child_proxy,
356     guint index)
357 {
358   GstIirEqualizer *equ = GST_IIR_EQUALIZER (child_proxy);
359   GObject *ret;
360 
361   BANDS_LOCK (equ);
362   if (G_UNLIKELY (index &gt;= equ-&gt;freq_band_count)) {
363     BANDS_UNLOCK (equ);
364     g_return_val_if_fail (index &lt; equ-&gt;freq_band_count, NULL);
365   }
</pre>
<hr />
<pre>
896   BANDS_LOCK (equ);
897   if (need_new_coefficients) {
898     update_coefficients (equ);
899   }
900   BANDS_UNLOCK (equ);
901 
902   gst_buffer_map (buf, &amp;map, GST_MAP_READWRITE);
903   equ-&gt;process (equ, map.data, map.size, channels);
904   gst_buffer_unmap (buf, &amp;map);
905 
906   return GST_FLOW_OK;
907 }
908 
909 static gboolean
910 gst_iir_equalizer_setup (GstAudioFilter * audio, const GstAudioInfo * info)
911 {
912   GstIirEqualizer *equ = GST_IIR_EQUALIZER (audio);
913 
914   switch (GST_AUDIO_INFO_FORMAT (info)) {
915     case GST_AUDIO_FORMAT_S16:
<span class="line-modified">916           equ-&gt;history_size = history_size_gint16;</span>
<span class="line-modified">917           equ-&gt;process = gst_iir_equ_process_gint16;</span>
<span class="line-modified">918           break;</span>
919     case GST_AUDIO_FORMAT_F32:
<span class="line-modified">920           equ-&gt;history_size = history_size_gfloat;</span>
<span class="line-modified">921           equ-&gt;process = gst_iir_equ_process_gfloat;</span>
<span class="line-modified">922           break;</span>
923     case GST_AUDIO_FORMAT_F64:
<span class="line-modified">924           equ-&gt;history_size = history_size_gdouble;</span>
<span class="line-modified">925           equ-&gt;process = gst_iir_equ_process_gdouble;</span>
<span class="line-modified">926           break;</span>
<span class="line-modified">927         default:</span>
<span class="line-modified">928           return FALSE;</span>
<span class="line-modified">929       }</span>
930 
931   alloc_history (equ, info);
932   return TRUE;
933 }
934 
935 #ifdef GSTREAMER_LITE
936 gboolean
937 plugin_init_equalizer (GstPlugin * plugin)
938 #else // GSTREAMER_LITE
939 static gboolean
940 plugin_init (GstPlugin * plugin)
941 #endif // GSTREAMER_LITE
942 {
943   GST_DEBUG_CATEGORY_INIT (equalizer_debug, &quot;equalizer&quot;, 0, &quot;equalizer&quot;);
944 
945   if (!(gst_element_register (plugin, &quot;equalizer-nbands&quot;, GST_RANK_NONE,
946               GST_TYPE_IIR_EQUALIZER_NBANDS)))
947     return FALSE;
948 
949 #ifndef GSTREAMER_LITE
</pre>
</td>
<td>
<hr />
<pre>
325      G_LOCK(type_init_mutex);
326      if(!type) // Use double check lock pattern
327      {
328 #endif // GSTREAMER_LITE
329 
330     const GTypeInfo type_info = {
331       sizeof (GstIirEqualizerBandClass),
332       NULL,
333       NULL,
334       (GClassInitFunc) gst_iir_equalizer_band_class_init,
335       NULL,
336       NULL,
337       sizeof (GstIirEqualizerBand),
338       0,
339       (GInstanceInitFunc) gst_iir_equalizer_band_init,
340     };
341     type =
342         g_type_register_static (GST_TYPE_OBJECT, &quot;GstIirEqualizerBand&quot;,
343         &amp;type_info, 0);
344 #ifdef GSTREAMER_LITE
<span class="line-modified">345   }</span>
346      G_UNLOCK(type_init_mutex);
347 #endif // GSTREAMER_LITE
348   }
349   return (type);
350 }
351 
352 
353 /* child proxy iface */
354 static GObject *
355 gst_iir_equalizer_child_proxy_get_child_by_index (GstChildProxy * child_proxy,
356     guint index)
357 {
358   GstIirEqualizer *equ = GST_IIR_EQUALIZER (child_proxy);
359   GObject *ret;
360 
361   BANDS_LOCK (equ);
362   if (G_UNLIKELY (index &gt;= equ-&gt;freq_band_count)) {
363     BANDS_UNLOCK (equ);
364     g_return_val_if_fail (index &lt; equ-&gt;freq_band_count, NULL);
365   }
</pre>
<hr />
<pre>
896   BANDS_LOCK (equ);
897   if (need_new_coefficients) {
898     update_coefficients (equ);
899   }
900   BANDS_UNLOCK (equ);
901 
902   gst_buffer_map (buf, &amp;map, GST_MAP_READWRITE);
903   equ-&gt;process (equ, map.data, map.size, channels);
904   gst_buffer_unmap (buf, &amp;map);
905 
906   return GST_FLOW_OK;
907 }
908 
909 static gboolean
910 gst_iir_equalizer_setup (GstAudioFilter * audio, const GstAudioInfo * info)
911 {
912   GstIirEqualizer *equ = GST_IIR_EQUALIZER (audio);
913 
914   switch (GST_AUDIO_INFO_FORMAT (info)) {
915     case GST_AUDIO_FORMAT_S16:
<span class="line-modified">916       equ-&gt;history_size = history_size_gint16;</span>
<span class="line-modified">917       equ-&gt;process = gst_iir_equ_process_gint16;</span>
<span class="line-modified">918       break;</span>
919     case GST_AUDIO_FORMAT_F32:
<span class="line-modified">920       equ-&gt;history_size = history_size_gfloat;</span>
<span class="line-modified">921       equ-&gt;process = gst_iir_equ_process_gfloat;</span>
<span class="line-modified">922       break;</span>
923     case GST_AUDIO_FORMAT_F64:
<span class="line-modified">924       equ-&gt;history_size = history_size_gdouble;</span>
<span class="line-modified">925       equ-&gt;process = gst_iir_equ_process_gdouble;</span>
<span class="line-modified">926       break;</span>
<span class="line-modified">927     default:</span>
<span class="line-modified">928       return FALSE;</span>
<span class="line-modified">929   }</span>
930 
931   alloc_history (equ, info);
932   return TRUE;
933 }
934 
935 #ifdef GSTREAMER_LITE
936 gboolean
937 plugin_init_equalizer (GstPlugin * plugin)
938 #else // GSTREAMER_LITE
939 static gboolean
940 plugin_init (GstPlugin * plugin)
941 #endif // GSTREAMER_LITE
942 {
943   GST_DEBUG_CATEGORY_INIT (equalizer_debug, &quot;equalizer&quot;, 0, &quot;equalizer&quot;);
944 
945   if (!(gst_element_register (plugin, &quot;equalizer-nbands&quot;, GST_RANK_NONE,
946               GST_TYPE_IIR_EQUALIZER_NBANDS)))
947     return FALSE;
948 
949 #ifndef GSTREAMER_LITE
</pre>
</td>
</tr>
</table>
<center><a href="../audioparsers/parsersplugin.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../isomp4/fourcc.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>