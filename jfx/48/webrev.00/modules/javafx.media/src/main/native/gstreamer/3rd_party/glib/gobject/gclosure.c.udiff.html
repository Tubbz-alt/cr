<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/gobject/gclosure.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gboxed.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gclosure.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/gobject/gclosure.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -84,39 +84,39 @@</span>
   *
   * - g_closure_invalidate() and invalidation notifiers allow callbacks to be
   *   automatically removed when the objects they point to go away.
   */
  
<span class="udiff-line-modified-removed">- #define CLOSURE_MAX_REF_COUNT       ((1 &lt;&lt; 15) - 1)</span>
<span class="udiff-line-modified-removed">- #define CLOSURE_MAX_N_GUARDS        ((1 &lt;&lt; 1) - 1)</span>
<span class="udiff-line-modified-removed">- #define CLOSURE_MAX_N_FNOTIFIERS    ((1 &lt;&lt; 2) - 1)</span>
<span class="udiff-line-modified-removed">- #define CLOSURE_MAX_N_INOTIFIERS    ((1 &lt;&lt; 8) - 1)</span>
<span class="udiff-line-modified-removed">- #define CLOSURE_N_MFUNCS(cl)        (((cl)-&gt;n_guards &lt;&lt; 1L))</span>
<span class="udiff-line-modified-added">+ #define CLOSURE_MAX_REF_COUNT   ((1 &lt;&lt; 15) - 1)</span>
<span class="udiff-line-modified-added">+ #define CLOSURE_MAX_N_GUARDS    ((1 &lt;&lt; 1) - 1)</span>
<span class="udiff-line-modified-added">+ #define CLOSURE_MAX_N_FNOTIFIERS  ((1 &lt;&lt; 2) - 1)</span>
<span class="udiff-line-modified-added">+ #define CLOSURE_MAX_N_INOTIFIERS  ((1 &lt;&lt; 8) - 1)</span>
<span class="udiff-line-modified-added">+ #define CLOSURE_N_MFUNCS(cl)    (((cl)-&gt;n_guards &lt;&lt; 1L))</span>
  /* same as G_CLOSURE_N_NOTIFIERS() (keep in sync) */
<span class="udiff-line-modified-removed">- #define CLOSURE_N_NOTIFIERS(cl)     (CLOSURE_N_MFUNCS (cl) + \</span>
<span class="udiff-line-modified-added">+ #define CLOSURE_N_NOTIFIERS(cl)   (CLOSURE_N_MFUNCS (cl) + \</span>
                                           (cl)-&gt;n_fnotifiers + \
                                           (cl)-&gt;n_inotifiers)
  
  typedef union {
    GClosure closure;
    volatile gint vint;
  } ClosureInt;
  
  #define CHANGE_FIELD(_closure, _field, _OP, _value, _must_set, _SET_OLD, _SET_NEW)      \
  G_STMT_START {                                                                          \
<span class="udiff-line-modified-removed">-   ClosureInt *cunion = (ClosureInt*) _closure;                                      \</span>
<span class="udiff-line-modified-removed">-   gint new_int, old_int, success;                                                   \</span>
<span class="udiff-line-modified-removed">-   do                                                                            \</span>
<span class="udiff-line-modified-removed">-     {                                                                           \</span>
<span class="udiff-line-modified-removed">-       ClosureInt tmp;                                                           \</span>
<span class="udiff-line-modified-removed">-       tmp.vint = old_int = cunion-&gt;vint;                                        \</span>
<span class="udiff-line-modified-added">+   ClosureInt *cunion = (ClosureInt*) _closure;                                    \</span>
<span class="udiff-line-modified-added">+   gint new_int, old_int, success;                                                 \</span>
<span class="udiff-line-modified-added">+   do                                                                        \</span>
<span class="udiff-line-modified-added">+     {                                                                       \</span>
<span class="udiff-line-modified-added">+       ClosureInt tmp;                                                       \</span>
<span class="udiff-line-modified-added">+       tmp.vint = old_int = cunion-&gt;vint;                                    \</span>
        _SET_OLD tmp.closure._field;                                                      \
<span class="udiff-line-modified-removed">-       tmp.closure._field _OP _value;                                            \</span>
<span class="udiff-line-modified-added">+       tmp.closure._field _OP _value;                                          \</span>
        _SET_NEW tmp.closure._field;                                                      \
<span class="udiff-line-modified-removed">-       new_int = tmp.vint;                                                       \</span>
<span class="udiff-line-modified-added">+       new_int = tmp.vint;                                                   \</span>
        success = g_atomic_int_compare_and_exchange (&amp;cunion-&gt;vint, old_int, new_int);    \
<span class="udiff-line-modified-removed">-     }                                                                           \</span>
<span class="udiff-line-modified-added">+     }                                                                       \</span>
    while (!success &amp;&amp; _must_set);                                                        \
  } G_STMT_END
  
  #define SWAP(_closure, _field, _value, _oldv)   CHANGE_FIELD (_closure, _field, =, _value, TRUE, *(_oldv) =,     (void) )
  #define SET(_closure, _field, _value)           CHANGE_FIELD (_closure, _field, =, _value, TRUE,     (void),     (void) )
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -188,11 +188,11 @@</span>
   *
   * Returns: (transfer none): a floating reference to a new #GClosure
   */
  GClosure*
  g_closure_new_simple (guint           sizeof_closure,
<span class="udiff-line-modified-removed">-               gpointer        data)</span>
<span class="udiff-line-modified-added">+           gpointer        data)</span>
  {
    GClosure *closure;
    gint private_size;
    gchar *allocated;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -234,11 +234,11 @@</span>
    return closure;
  }
  
  static inline void
  closure_invoke_notifiers (GClosure *closure,
<span class="udiff-line-modified-removed">-               guint     notify_type)</span>
<span class="udiff-line-modified-added">+         guint     notify_type)</span>
  {
    /* notifier layout:
     *     n_guards    n_guards     n_fnotif.  n_inotifiers
     * -&gt;[[pre_guards][post_guards][fnotifiers][inotifiers]]
     *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -259,62 +259,62 @@</span>
      {
        GClosureNotifyData *ndata;
        guint i, offs;
      case FNOTIFY:
        while (closure-&gt;n_fnotifiers)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-added">+   {</span>
            guint n;
<span class="udiff-line-modified-removed">-       DEC_ASSIGN (closure, n_fnotifiers, &amp;n);</span>
<span class="udiff-line-modified-added">+     DEC_ASSIGN (closure, n_fnotifiers, &amp;n);</span>
  
<span class="udiff-line-modified-removed">-       ndata = closure-&gt;notifiers + CLOSURE_N_MFUNCS (closure) + n;</span>
<span class="udiff-line-modified-removed">-       closure-&gt;marshal = (GClosureMarshal) ndata-&gt;notify;</span>
<span class="udiff-line-modified-removed">-       closure-&gt;data = ndata-&gt;data;</span>
<span class="udiff-line-modified-removed">-       ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+     ndata = closure-&gt;notifiers + CLOSURE_N_MFUNCS (closure) + n;</span>
<span class="udiff-line-modified-added">+     closure-&gt;marshal = (GClosureMarshal) ndata-&gt;notify;</span>
<span class="udiff-line-modified-added">+     closure-&gt;data = ndata-&gt;data;</span>
<span class="udiff-line-modified-added">+     ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-added">+   }</span>
        closure-&gt;marshal = NULL;
        closure-&gt;data = NULL;
        break;
      case INOTIFY:
        SET (closure, in_inotify, TRUE);
        while (closure-&gt;n_inotifiers)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-added">+   {</span>
            guint n;
            DEC_ASSIGN (closure, n_inotifiers, &amp;n);
  
<span class="udiff-line-modified-removed">-       ndata = closure-&gt;notifiers + CLOSURE_N_MFUNCS (closure) + closure-&gt;n_fnotifiers + n;</span>
<span class="udiff-line-modified-removed">-       closure-&gt;marshal = (GClosureMarshal) ndata-&gt;notify;</span>
<span class="udiff-line-modified-removed">-       closure-&gt;data = ndata-&gt;data;</span>
<span class="udiff-line-modified-removed">-       ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+     ndata = closure-&gt;notifiers + CLOSURE_N_MFUNCS (closure) + closure-&gt;n_fnotifiers + n;</span>
<span class="udiff-line-modified-added">+     closure-&gt;marshal = (GClosureMarshal) ndata-&gt;notify;</span>
<span class="udiff-line-modified-added">+     closure-&gt;data = ndata-&gt;data;</span>
<span class="udiff-line-modified-added">+     ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-added">+   }</span>
        closure-&gt;marshal = NULL;
        closure-&gt;data = NULL;
        SET (closure, in_inotify, FALSE);
        break;
      case PRE_NOTIFY:
        i = closure-&gt;n_guards;
        offs = 0;
        while (i--)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       ndata = closure-&gt;notifiers + offs + i;</span>
<span class="udiff-line-modified-removed">-       ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     ndata = closure-&gt;notifiers + offs + i;</span>
<span class="udiff-line-modified-added">+     ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-added">+   }</span>
        break;
      case POST_NOTIFY:
        i = closure-&gt;n_guards;
        offs = i;
        while (i--)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       ndata = closure-&gt;notifiers + offs + i;</span>
<span class="udiff-line-modified-removed">-       ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     ndata = closure-&gt;notifiers + offs + i;</span>
<span class="udiff-line-modified-added">+     ndata-&gt;notify (ndata-&gt;data, closure);</span>
<span class="udiff-line-modified-added">+   }</span>
        break;
      }
  }
  
  static void
  g_closure_set_meta_va_marshal (GClosure       *closure,
<span class="udiff-line-modified-removed">-                    GVaClosureMarshal va_meta_marshal)</span>
<span class="udiff-line-modified-added">+              GVaClosureMarshal va_meta_marshal)</span>
  {
    GRealClosure *real_closure;
  
    g_return_if_fail (closure != NULL);
    g_return_if_fail (va_meta_marshal != NULL);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -350,12 +350,12 @@</span>
   * the right callback and passes it to the marshaller as the
   * @marshal_data argument.
   */
  void
  g_closure_set_meta_marshal (GClosure       *closure,
<span class="udiff-line-modified-removed">-                 gpointer        marshal_data,</span>
<span class="udiff-line-modified-removed">-                 GClosureMarshal meta_marshal)</span>
<span class="udiff-line-modified-added">+           gpointer        marshal_data,</span>
<span class="udiff-line-modified-added">+           GClosureMarshal meta_marshal)</span>
  {
    GRealClosure *real_closure;
  
    g_return_if_fail (closure != NULL);
    g_return_if_fail (meta_marshal != NULL);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -385,14 +385,14 @@</span>
   * the extra arguments for the duration of the callback. See
   * g_object_watch_closure() for an example of marshal guards.
   */
  void
  g_closure_add_marshal_guards (GClosure      *closure,
<span class="udiff-line-modified-removed">-                   gpointer       pre_marshal_data,</span>
<span class="udiff-line-modified-removed">-                   GClosureNotify pre_marshal_notify,</span>
<span class="udiff-line-modified-removed">-                   gpointer       post_marshal_data,</span>
<span class="udiff-line-modified-removed">-                   GClosureNotify post_marshal_notify)</span>
<span class="udiff-line-modified-added">+             gpointer       pre_marshal_data,</span>
<span class="udiff-line-modified-added">+             GClosureNotify pre_marshal_notify,</span>
<span class="udiff-line-modified-added">+             gpointer       post_marshal_data,</span>
<span class="udiff-line-modified-added">+             GClosureNotify post_marshal_notify)</span>
  {
    guint i;
  
    g_return_if_fail (closure != NULL);
    g_return_if_fail (pre_marshal_notify != NULL);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -402,27 +402,27 @@</span>
    g_return_if_fail (closure-&gt;n_guards &lt; CLOSURE_MAX_N_GUARDS);
  
    closure-&gt;notifiers = g_renew (GClosureNotifyData, closure-&gt;notifiers, CLOSURE_N_NOTIFIERS (closure) + 2);
    if (closure-&gt;n_inotifiers)
      closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +
<span class="udiff-line-modified-removed">-             closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-removed">-             closure-&gt;n_inotifiers + 1)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-removed">-                                       closure-&gt;n_fnotifiers + 0)];</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_inotifiers + 1)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-added">+                     closure-&gt;n_fnotifiers + 0)];</span>
    if (closure-&gt;n_inotifiers &gt; 1)
      closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +
<span class="udiff-line-modified-removed">-             closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-removed">-             closure-&gt;n_inotifiers)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-removed">-                                       closure-&gt;n_fnotifiers + 1)];</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_inotifiers)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-added">+                       closure-&gt;n_fnotifiers + 1)];</span>
    if (closure-&gt;n_fnotifiers)
      closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +
<span class="udiff-line-modified-removed">-             closure-&gt;n_fnotifiers + 1)] = closure-&gt;notifiers[CLOSURE_N_MFUNCS (closure) + 0];</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_fnotifiers + 1)] = closure-&gt;notifiers[CLOSURE_N_MFUNCS (closure) + 0];</span>
    if (closure-&gt;n_fnotifiers &gt; 1)
      closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +
<span class="udiff-line-modified-removed">-             closure-&gt;n_fnotifiers)] = closure-&gt;notifiers[CLOSURE_N_MFUNCS (closure) + 1];</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_fnotifiers)] = closure-&gt;notifiers[CLOSURE_N_MFUNCS (closure) + 1];</span>
    if (closure-&gt;n_guards)
      closure-&gt;notifiers[(closure-&gt;n_guards +
<span class="udiff-line-modified-removed">-             closure-&gt;n_guards + 1)] = closure-&gt;notifiers[closure-&gt;n_guards];</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_guards + 1)] = closure-&gt;notifiers[closure-&gt;n_guards];</span>
    i = closure-&gt;n_guards;
    closure-&gt;notifiers[i].data = pre_marshal_data;
    closure-&gt;notifiers[i].notify = pre_marshal_notify;
    closure-&gt;notifiers[i + 1].data = post_marshal_data;
    closure-&gt;notifiers[i + 1].notify = post_marshal_notify;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -442,25 +442,25 @@</span>
   * both invalidated and finalized, then the invalidate notifiers will
   * be run before the finalize notifiers.
   */
  void
  g_closure_add_finalize_notifier (GClosure      *closure,
<span class="udiff-line-modified-removed">-                  gpointer       notify_data,</span>
<span class="udiff-line-modified-removed">-                  GClosureNotify notify_func)</span>
<span class="udiff-line-modified-added">+          gpointer       notify_data,</span>
<span class="udiff-line-modified-added">+          GClosureNotify notify_func)</span>
  {
    guint i;
  
    g_return_if_fail (closure != NULL);
    g_return_if_fail (notify_func != NULL);
    g_return_if_fail (closure-&gt;n_fnotifiers &lt; CLOSURE_MAX_N_FNOTIFIERS);
  
    closure-&gt;notifiers = g_renew (GClosureNotifyData, closure-&gt;notifiers, CLOSURE_N_NOTIFIERS (closure) + 1);
    if (closure-&gt;n_inotifiers)
      closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +
<span class="udiff-line-modified-removed">-             closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-removed">-             closure-&gt;n_inotifiers)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-removed">-                                       closure-&gt;n_fnotifiers + 0)];</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-added">+       closure-&gt;n_inotifiers)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-added">+                       closure-&gt;n_fnotifiers + 0)];</span>
    i = CLOSURE_N_MFUNCS (closure) + closure-&gt;n_fnotifiers;
    closure-&gt;notifiers[i].data = notify_data;
    closure-&gt;notifiers[i].notify = notify_func;
    INC (closure, n_fnotifiers);
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -476,12 +476,12 @@</span>
   * notifiers are invoked before finalization notifiers, in an
   * unspecified order.
   */
  void
  g_closure_add_invalidate_notifier (GClosure      *closure,
<span class="udiff-line-modified-removed">-                    gpointer       notify_data,</span>
<span class="udiff-line-modified-removed">-                    GClosureNotify notify_func)</span>
<span class="udiff-line-modified-added">+            gpointer       notify_data,</span>
<span class="udiff-line-modified-added">+            GClosureNotify notify_func)</span>
  {
    guint i;
  
    g_return_if_fail (closure != NULL);
    g_return_if_fail (notify_func != NULL);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -495,48 +495,48 @@</span>
    INC (closure, n_inotifiers);
  }
  
  static inline gboolean
  closure_try_remove_inotify (GClosure       *closure,
<span class="udiff-line-modified-removed">-                 gpointer       notify_data,</span>
<span class="udiff-line-modified-removed">-                 GClosureNotify notify_func)</span>
<span class="udiff-line-modified-added">+           gpointer       notify_data,</span>
<span class="udiff-line-modified-added">+           GClosureNotify notify_func)</span>
  {
    GClosureNotifyData *ndata, *nlast;
  
    nlast = closure-&gt;notifiers + CLOSURE_N_NOTIFIERS (closure) - 1;
    for (ndata = nlast + 1 - closure-&gt;n_inotifiers; ndata &lt;= nlast; ndata++)
      if (ndata-&gt;notify == notify_func &amp;&amp; ndata-&gt;data == notify_data)
        {
<span class="udiff-line-modified-removed">-     DEC (closure, n_inotifiers);</span>
<span class="udiff-line-modified-removed">-     if (ndata &lt; nlast)</span>
<span class="udiff-line-modified-removed">-       *ndata = *nlast;</span>
<span class="udiff-line-modified-added">+   DEC (closure, n_inotifiers);</span>
<span class="udiff-line-modified-added">+   if (ndata &lt; nlast)</span>
<span class="udiff-line-modified-added">+     *ndata = *nlast;</span>
  
<span class="udiff-line-modified-removed">-     return TRUE;</span>
<span class="udiff-line-modified-added">+   return TRUE;</span>
        }
    return FALSE;
  }
  
  static inline gboolean
  closure_try_remove_fnotify (GClosure       *closure,
<span class="udiff-line-modified-removed">-                 gpointer       notify_data,</span>
<span class="udiff-line-modified-removed">-                 GClosureNotify notify_func)</span>
<span class="udiff-line-modified-added">+           gpointer       notify_data,</span>
<span class="udiff-line-modified-added">+           GClosureNotify notify_func)</span>
  {
    GClosureNotifyData *ndata, *nlast;
  
    nlast = closure-&gt;notifiers + CLOSURE_N_NOTIFIERS (closure) - closure-&gt;n_inotifiers - 1;
    for (ndata = nlast + 1 - closure-&gt;n_fnotifiers; ndata &lt;= nlast; ndata++)
      if (ndata-&gt;notify == notify_func &amp;&amp; ndata-&gt;data == notify_data)
        {
<span class="udiff-line-modified-removed">-     DEC (closure, n_fnotifiers);</span>
<span class="udiff-line-modified-removed">-     if (ndata &lt; nlast)</span>
<span class="udiff-line-modified-removed">-       *ndata = *nlast;</span>
<span class="udiff-line-modified-removed">-     if (closure-&gt;n_inotifiers)</span>
<span class="udiff-line-modified-removed">-       closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-removed">-                   closure-&gt;n_fnotifiers)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-removed">-                                         closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-removed">-                                         closure-&gt;n_inotifiers)];</span>
<span class="udiff-line-modified-removed">-     return TRUE;</span>
<span class="udiff-line-modified-added">+   DEC (closure, n_fnotifiers);</span>
<span class="udiff-line-modified-added">+   if (ndata &lt; nlast)</span>
<span class="udiff-line-modified-added">+     *ndata = *nlast;</span>
<span class="udiff-line-modified-added">+   if (closure-&gt;n_inotifiers)</span>
<span class="udiff-line-modified-added">+     closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-added">+             closure-&gt;n_fnotifiers)] = closure-&gt;notifiers[(CLOSURE_N_MFUNCS (closure) +</span>
<span class="udiff-line-modified-added">+                       closure-&gt;n_fnotifiers +</span>
<span class="udiff-line-modified-added">+                       closure-&gt;n_inotifiers)];</span>
<span class="udiff-line-modified-added">+   return TRUE;</span>
        }
    return FALSE;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -562,11 +562,11 @@</span>
    return closure;
  }
  
  /**
   * g_closure_invalidate:
<span class="udiff-line-modified-removed">-  * @closure: GClosure to invalidate</span>
<span class="udiff-line-modified-added">+  * @closure: #GClosure to invalidate</span>
   *
   * Sets a flag on the closure to indicate that its calling
   * environment has become invalid, and thus causes any future
   * invocations of g_closure_invoke() on this @closure to be
   * ignored. Also, invalidation notifiers installed on the closure will
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -741,23 +741,23 @@</span>
   *
   * Notice that notifiers are automatically removed after they are run.
   */
  void
  g_closure_remove_invalidate_notifier (GClosure      *closure,
<span class="udiff-line-modified-removed">-                       gpointer       notify_data,</span>
<span class="udiff-line-modified-removed">-                       GClosureNotify notify_func)</span>
<span class="udiff-line-modified-added">+               gpointer       notify_data,</span>
<span class="udiff-line-modified-added">+               GClosureNotify notify_func)</span>
  {
    g_return_if_fail (closure != NULL);
    g_return_if_fail (notify_func != NULL);
  
    if (closure-&gt;is_invalid &amp;&amp; closure-&gt;in_inotify &amp;&amp; /* account removal of notify_func() while it&#39;s called */
        ((gpointer) closure-&gt;marshal) == ((gpointer) notify_func) &amp;&amp;
        closure-&gt;data == notify_data)
      closure-&gt;marshal = NULL;
    else if (!closure_try_remove_inotify (closure, notify_data, notify_func))
      g_warning (G_STRLOC &quot;: unable to remove uninstalled invalidation notifier: %p (%p)&quot;,
<span class="udiff-line-modified-removed">-            notify_func, notify_data);</span>
<span class="udiff-line-modified-added">+          notify_func, notify_data);</span>
  }
  
  /**
   * g_closure_remove_finalize_notifier: (skip)
   * @closure: a #GClosure
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -769,12 +769,12 @@</span>
   *
   * Notice that notifiers are automatically removed after they are run.
   */
  void
  g_closure_remove_finalize_notifier (GClosure      *closure,
<span class="udiff-line-modified-removed">-                     gpointer       notify_data,</span>
<span class="udiff-line-modified-removed">-                     GClosureNotify notify_func)</span>
<span class="udiff-line-modified-added">+             gpointer       notify_data,</span>
<span class="udiff-line-modified-added">+             GClosureNotify notify_func)</span>
  {
    g_return_if_fail (closure != NULL);
    g_return_if_fail (notify_func != NULL);
  
    if (closure-&gt;is_invalid &amp;&amp; !closure-&gt;in_inotify &amp;&amp; /* account removal of notify_func() while it&#39;s called */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -800,14 +800,14 @@</span>
   *
   * Invokes the closure, i.e. executes the callback represented by the @closure.
   */
  void
  g_closure_invoke (GClosure       *closure,
<span class="udiff-line-modified-removed">-           GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-removed">-           guint           n_param_values,</span>
<span class="udiff-line-modified-removed">-           const GValue   *param_values,</span>
<span class="udiff-line-modified-removed">-           gpointer        invocation_hint)</span>
<span class="udiff-line-modified-added">+       GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-added">+       guint           n_param_values,</span>
<span class="udiff-line-modified-added">+       const GValue   *param_values,</span>
<span class="udiff-line-modified-added">+       gpointer        invocation_hint)</span>
  {
    GRealClosure *real_closure;
  
    g_return_if_fail (closure != NULL);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -822,28 +822,28 @@</span>
  
        g_return_if_fail (closure-&gt;marshal || real_closure-&gt;meta_marshal);
  
        SET (closure, in_marshal, TRUE);
        if (real_closure-&gt;meta_marshal)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       marshal_data = real_closure-&gt;meta_marshal_data;</span>
<span class="udiff-line-modified-removed">-       marshal = real_closure-&gt;meta_marshal;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     marshal_data = real_closure-&gt;meta_marshal_data;</span>
<span class="udiff-line-modified-added">+     marshal = real_closure-&gt;meta_marshal;</span>
<span class="udiff-line-modified-added">+   }</span>
        else
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       marshal_data = NULL;</span>
<span class="udiff-line-modified-removed">-       marshal = closure-&gt;marshal;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     marshal_data = NULL;</span>
<span class="udiff-line-modified-added">+     marshal = closure-&gt;marshal;</span>
<span class="udiff-line-modified-added">+   }</span>
        if (!in_marshal)
<span class="udiff-line-modified-removed">-     closure_invoke_notifiers (closure, PRE_NOTIFY);</span>
<span class="udiff-line-modified-added">+   closure_invoke_notifiers (closure, PRE_NOTIFY);</span>
        marshal (closure,
<span class="udiff-line-modified-removed">-            return_value,</span>
<span class="udiff-line-modified-removed">-            n_param_values, param_values,</span>
<span class="udiff-line-modified-removed">-            invocation_hint,</span>
<span class="udiff-line-modified-removed">-            marshal_data);</span>
<span class="udiff-line-modified-added">+          return_value,</span>
<span class="udiff-line-modified-added">+          n_param_values, param_values,</span>
<span class="udiff-line-modified-added">+          invocation_hint,</span>
<span class="udiff-line-modified-added">+          marshal_data);</span>
        if (!in_marshal)
<span class="udiff-line-modified-removed">-     closure_invoke_notifiers (closure, POST_NOTIFY);</span>
<span class="udiff-line-modified-added">+   closure_invoke_notifiers (closure, POST_NOTIFY);</span>
        SET (closure, in_marshal, in_marshal);
      }
    g_closure_unref (closure);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -862,15 +862,15 @@</span>
       real_closure-&gt;va_meta_marshal != NULL);
  }
  
  void
  _g_closure_invoke_va (GClosure       *closure,
<span class="udiff-line-modified-removed">-               GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-removed">-               gpointer        instance,</span>
<span class="udiff-line-modified-removed">-               va_list         args,</span>
<span class="udiff-line-modified-removed">-               int             n_params,</span>
<span class="udiff-line-modified-removed">-               GType          *param_types)</span>
<span class="udiff-line-modified-added">+           GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-added">+           gpointer        instance,</span>
<span class="udiff-line-modified-added">+           va_list         args,</span>
<span class="udiff-line-modified-added">+           int             n_params,</span>
<span class="udiff-line-modified-added">+           GType          *param_types)</span>
  {
    GRealClosure *real_closure;
  
    g_return_if_fail (closure != NULL);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -885,28 +885,28 @@</span>
  
        g_return_if_fail (closure-&gt;marshal || real_closure-&gt;meta_marshal);
  
        SET (closure, in_marshal, TRUE);
        if (real_closure-&gt;va_meta_marshal)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       marshal_data = real_closure-&gt;meta_marshal_data;</span>
<span class="udiff-line-modified-removed">-       marshal = real_closure-&gt;va_meta_marshal;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     marshal_data = real_closure-&gt;meta_marshal_data;</span>
<span class="udiff-line-modified-added">+     marshal = real_closure-&gt;va_meta_marshal;</span>
<span class="udiff-line-modified-added">+   }</span>
        else
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       marshal_data = NULL;</span>
<span class="udiff-line-modified-removed">-       marshal = real_closure-&gt;va_marshal;</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     marshal_data = NULL;</span>
<span class="udiff-line-modified-added">+     marshal = real_closure-&gt;va_marshal;</span>
<span class="udiff-line-modified-added">+   }</span>
        if (!in_marshal)
<span class="udiff-line-modified-removed">-     closure_invoke_notifiers (closure, PRE_NOTIFY);</span>
<span class="udiff-line-modified-added">+   closure_invoke_notifiers (closure, PRE_NOTIFY);</span>
        marshal (closure,
<span class="udiff-line-modified-removed">-            return_value,</span>
<span class="udiff-line-modified-removed">-            instance, args,</span>
<span class="udiff-line-modified-removed">-            marshal_data,</span>
<span class="udiff-line-modified-removed">-            n_params, param_types);</span>
<span class="udiff-line-modified-added">+          return_value,</span>
<span class="udiff-line-modified-added">+          instance, args,</span>
<span class="udiff-line-modified-added">+          marshal_data,</span>
<span class="udiff-line-modified-added">+          n_params, param_types);</span>
        if (!in_marshal)
<span class="udiff-line-modified-removed">-     closure_invoke_notifiers (closure, POST_NOTIFY);</span>
<span class="udiff-line-modified-added">+   closure_invoke_notifiers (closure, POST_NOTIFY);</span>
        SET (closure, in_marshal, in_marshal);
      }
    g_closure_unref (closure);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -923,36 +923,36 @@</span>
   * functions), what it provides is a callback function to use instead of
   * @closure-&gt;callback.
   */
  void
  g_closure_set_marshal (GClosure       *closure,
<span class="udiff-line-modified-removed">-                GClosureMarshal marshal)</span>
<span class="udiff-line-modified-added">+            GClosureMarshal marshal)</span>
  {
    g_return_if_fail (closure != NULL);
    g_return_if_fail (marshal != NULL);
  
    if (closure-&gt;marshal &amp;&amp; closure-&gt;marshal != marshal)
      g_warning (&quot;attempt to override closure-&gt;marshal (%p) with new marshal (%p)&quot;,
<span class="udiff-line-modified-removed">-            closure-&gt;marshal, marshal);</span>
<span class="udiff-line-modified-added">+          closure-&gt;marshal, marshal);</span>
    else
      closure-&gt;marshal = marshal;
  }
  
  void
  _g_closure_set_va_marshal (GClosure       *closure,
<span class="udiff-line-modified-removed">-                GVaClosureMarshal marshal)</span>
<span class="udiff-line-modified-added">+          GVaClosureMarshal marshal)</span>
  {
    GRealClosure *real_closure;
  
    g_return_if_fail (closure != NULL);
    g_return_if_fail (marshal != NULL);
  
    real_closure = G_REAL_CLOSURE (closure);
  
    if (real_closure-&gt;va_marshal &amp;&amp; real_closure-&gt;va_marshal != marshal)
      g_warning (&quot;attempt to override closure-&gt;va_marshal (%p) with new marshal (%p)&quot;,
<span class="udiff-line-modified-removed">-            real_closure-&gt;va_marshal, marshal);</span>
<span class="udiff-line-modified-added">+          real_closure-&gt;va_marshal, marshal);</span>
    else
      real_closure-&gt;va_marshal = marshal;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -962,16 +962,18 @@</span>
   * @destroy_data: destroy notify to be called when @user_data is no longer used
   *
   * Creates a new closure which invokes @callback_func with @user_data as
   * the last parameter.
   *
<span class="udiff-line-added">+  * @destroy_data will be called as a finalize notifier on the #GClosure.</span>
<span class="udiff-line-added">+  *</span>
   * Returns: (transfer none): a floating reference to a new #GCClosure
   */
  GClosure*
  g_cclosure_new (GCallback      callback_func,
<span class="udiff-line-modified-removed">-         gpointer       user_data,</span>
<span class="udiff-line-modified-removed">-         GClosureNotify destroy_data)</span>
<span class="udiff-line-modified-added">+     gpointer       user_data,</span>
<span class="udiff-line-modified-added">+     GClosureNotify destroy_data)</span>
  {
    GClosure *closure;
  
    g_return_val_if_fail (callback_func != NULL, NULL);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -994,16 +996,18 @@</span>
   * @destroy_data: destroy notify to be called when @user_data is no longer used
   *
   * Creates a new closure which invokes @callback_func with @user_data as
   * the first parameter.
   *
<span class="udiff-line-added">+  * @destroy_data will be called as a finalize notifier on the #GClosure.</span>
<span class="udiff-line-added">+  *</span>
   * Returns: (transfer none): a floating reference to a new #GCClosure
   */
  GClosure*
  g_cclosure_new_swap (GCallback      callback_func,
<span class="udiff-line-modified-removed">-              gpointer       user_data,</span>
<span class="udiff-line-modified-removed">-              GClosureNotify destroy_data)</span>
<span class="udiff-line-modified-added">+          gpointer       user_data,</span>
<span class="udiff-line-modified-added">+          GClosureNotify destroy_data)</span>
  {
    GClosure *closure;
  
    g_return_val_if_fail (callback_func != NULL, NULL);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1020,39 +1024,39 @@</span>
    return closure;
  }
  
  static void
  g_type_class_meta_marshal (GClosure       *closure,
<span class="udiff-line-modified-removed">-                GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-removed">-                guint           n_param_values,</span>
<span class="udiff-line-modified-removed">-                const GValue   *param_values,</span>
<span class="udiff-line-modified-removed">-                gpointer        invocation_hint,</span>
<span class="udiff-line-modified-removed">-                gpointer        marshal_data)</span>
<span class="udiff-line-modified-added">+          GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-added">+          guint           n_param_values,</span>
<span class="udiff-line-modified-added">+          const GValue   *param_values,</span>
<span class="udiff-line-modified-added">+          gpointer        invocation_hint,</span>
<span class="udiff-line-modified-added">+          gpointer        marshal_data)</span>
  {
    GTypeClass *class;
    gpointer callback;
    /* GType itype = (GType) closure-&gt;data; */
    guint offset = GPOINTER_TO_UINT (marshal_data);
  
    class = G_TYPE_INSTANCE_GET_CLASS (g_value_peek_pointer (param_values + 0), itype, GTypeClass);
    callback = G_STRUCT_MEMBER (gpointer, class, offset);
    if (callback)
      closure-&gt;marshal (closure,
<span class="udiff-line-modified-removed">-               return_value,</span>
<span class="udiff-line-modified-removed">-               n_param_values, param_values,</span>
<span class="udiff-line-modified-removed">-               invocation_hint,</span>
<span class="udiff-line-modified-removed">-               callback);</span>
<span class="udiff-line-modified-added">+           return_value,</span>
<span class="udiff-line-modified-added">+           n_param_values, param_values,</span>
<span class="udiff-line-modified-added">+           invocation_hint,</span>
<span class="udiff-line-modified-added">+           callback);</span>
  }
  
  static void
  g_type_class_meta_marshalv (GClosure *closure,
<span class="udiff-line-modified-removed">-                 GValue   *return_value,</span>
<span class="udiff-line-modified-removed">-                 gpointer  instance,</span>
<span class="udiff-line-modified-removed">-                 va_list   args,</span>
<span class="udiff-line-modified-removed">-                 gpointer  marshal_data,</span>
<span class="udiff-line-modified-removed">-                 int       n_params,</span>
<span class="udiff-line-modified-removed">-                 GType    *param_types)</span>
<span class="udiff-line-modified-added">+           GValue   *return_value,</span>
<span class="udiff-line-modified-added">+           gpointer  instance,</span>
<span class="udiff-line-modified-added">+           va_list   args,</span>
<span class="udiff-line-modified-added">+           gpointer  marshal_data,</span>
<span class="udiff-line-modified-added">+           int       n_params,</span>
<span class="udiff-line-modified-added">+           GType    *param_types)</span>
  {
    GRealClosure *real_closure;
    GTypeClass *class;
    gpointer callback;
    /* GType itype = (GType) closure-&gt;data; */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1062,43 +1066,43 @@</span>
  
    class = G_TYPE_INSTANCE_GET_CLASS (instance, itype, GTypeClass);
    callback = G_STRUCT_MEMBER (gpointer, class, offset);
    if (callback)
      real_closure-&gt;va_marshal (closure,
<span class="udiff-line-modified-removed">-                   return_value,</span>
<span class="udiff-line-modified-removed">-                   instance, args,</span>
<span class="udiff-line-modified-removed">-                   callback,</span>
<span class="udiff-line-modified-removed">-                   n_params,</span>
<span class="udiff-line-modified-removed">-                   param_types);</span>
<span class="udiff-line-modified-added">+             return_value,</span>
<span class="udiff-line-modified-added">+             instance, args,</span>
<span class="udiff-line-modified-added">+             callback,</span>
<span class="udiff-line-modified-added">+             n_params,</span>
<span class="udiff-line-modified-added">+             param_types);</span>
  }
  
  static void
  g_type_iface_meta_marshal (GClosure       *closure,
<span class="udiff-line-modified-removed">-                GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-removed">-                guint           n_param_values,</span>
<span class="udiff-line-modified-removed">-                const GValue   *param_values,</span>
<span class="udiff-line-modified-removed">-                gpointer        invocation_hint,</span>
<span class="udiff-line-modified-removed">-                gpointer        marshal_data)</span>
<span class="udiff-line-modified-added">+          GValue /*out*/ *return_value,</span>
<span class="udiff-line-modified-added">+          guint           n_param_values,</span>
<span class="udiff-line-modified-added">+          const GValue   *param_values,</span>
<span class="udiff-line-modified-added">+          gpointer        invocation_hint,</span>
<span class="udiff-line-modified-added">+          gpointer        marshal_data)</span>
  {
    GTypeClass *class;
    gpointer callback;
    GType itype = (GType) closure-&gt;data;
    guint offset = GPOINTER_TO_UINT (marshal_data);
  
    class = G_TYPE_INSTANCE_GET_INTERFACE (g_value_peek_pointer (param_values + 0), itype, GTypeClass);
    callback = G_STRUCT_MEMBER (gpointer, class, offset);
    if (callback)
      closure-&gt;marshal (closure,
<span class="udiff-line-modified-removed">-               return_value,</span>
<span class="udiff-line-modified-removed">-               n_param_values, param_values,</span>
<span class="udiff-line-modified-removed">-               invocation_hint,</span>
<span class="udiff-line-modified-removed">-               callback);</span>
<span class="udiff-line-modified-added">+           return_value,</span>
<span class="udiff-line-modified-added">+           n_param_values, param_values,</span>
<span class="udiff-line-modified-added">+           invocation_hint,</span>
<span class="udiff-line-modified-added">+           callback);</span>
  }
  
  gboolean
  _g_closure_is_void (GClosure *closure,
<span class="udiff-line-modified-removed">-             gpointer instance)</span>
<span class="udiff-line-modified-added">+         gpointer instance)</span>
  {
    GRealClosure *real_closure;
    GTypeClass *class;
    gpointer callback;
    GType itype;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1130,16 +1134,16 @@</span>
    return FALSE;
  }
  
  static void
  g_type_iface_meta_marshalv (GClosure *closure,
<span class="udiff-line-modified-removed">-                 GValue   *return_value,</span>
<span class="udiff-line-modified-removed">-                 gpointer  instance,</span>
<span class="udiff-line-modified-removed">-                 va_list   args,</span>
<span class="udiff-line-modified-removed">-                 gpointer  marshal_data,</span>
<span class="udiff-line-modified-removed">-                 int       n_params,</span>
<span class="udiff-line-modified-removed">-                 GType    *param_types)</span>
<span class="udiff-line-modified-added">+           GValue   *return_value,</span>
<span class="udiff-line-modified-added">+           gpointer  instance,</span>
<span class="udiff-line-modified-added">+           va_list   args,</span>
<span class="udiff-line-modified-added">+           gpointer  marshal_data,</span>
<span class="udiff-line-modified-added">+           int       n_params,</span>
<span class="udiff-line-modified-added">+           GType    *param_types)</span>
  {
    GRealClosure *real_closure;
    GTypeClass *class;
    gpointer callback;
    GType itype = (GType) closure-&gt;data;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1149,15 +1153,15 @@</span>
  
    class = G_TYPE_INSTANCE_GET_INTERFACE (instance, itype, GTypeClass);
    callback = G_STRUCT_MEMBER (gpointer, class, offset);
    if (callback)
      real_closure-&gt;va_marshal (closure,
<span class="udiff-line-modified-removed">-                   return_value,</span>
<span class="udiff-line-modified-removed">-                   instance, args,</span>
<span class="udiff-line-modified-removed">-                   callback,</span>
<span class="udiff-line-modified-removed">-                   n_params,</span>
<span class="udiff-line-modified-removed">-                   param_types);</span>
<span class="udiff-line-modified-added">+             return_value,</span>
<span class="udiff-line-modified-added">+             instance, args,</span>
<span class="udiff-line-modified-added">+             callback,</span>
<span class="udiff-line-modified-added">+             n_params,</span>
<span class="udiff-line-modified-added">+             param_types);</span>
  }
  
  /**
   * g_signal_type_cclosure_new:
   * @itype: the #GType identifier of an interface or classed type
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1170,11 +1174,11 @@</span>
   *
   * Returns: (transfer none): a floating reference to a new #GCClosure
   */
  GClosure*
  g_signal_type_cclosure_new (GType    itype,
<span class="udiff-line-modified-removed">-                 guint    struct_offset)</span>
<span class="udiff-line-modified-added">+           guint    struct_offset)</span>
  {
    GClosure *closure;
  
    g_return_val_if_fail (G_TYPE_IS_CLASSED (itype) || G_TYPE_IS_INTERFACE (itype), NULL);
    g_return_val_if_fail (struct_offset &gt;= sizeof (GTypeClass), NULL);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1368,12 +1372,12 @@</span>
    guint64 _guint64;
  } va_arg_storage;
  
  static ffi_type *
  va_to_ffi_type (GType gtype,
<span class="udiff-line-modified-removed">-         va_list *va,</span>
<span class="udiff-line-modified-removed">-         va_arg_storage *storage)</span>
<span class="udiff-line-modified-added">+     va_list *va,</span>
<span class="udiff-line-modified-added">+     va_arg_storage *storage)</span>
  {
    ffi_type *rettype = NULL;
    GType type = g_type_fundamental (gtype);
    g_assert (type != G_TYPE_INVALID);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1556,16 +1560,16 @@</span>
   *
   * Since: 2.30
   */
  void
  g_cclosure_marshal_generic_va (GClosure *closure,
<span class="udiff-line-modified-removed">-                    GValue   *return_value,</span>
<span class="udiff-line-modified-removed">-                    gpointer  instance,</span>
<span class="udiff-line-modified-removed">-                    va_list   args_list,</span>
<span class="udiff-line-modified-removed">-                    gpointer  marshal_data,</span>
<span class="udiff-line-modified-removed">-                    int       n_params,</span>
<span class="udiff-line-modified-removed">-                    GType    *param_types)</span>
<span class="udiff-line-modified-added">+              GValue   *return_value,</span>
<span class="udiff-line-modified-added">+              gpointer  instance,</span>
<span class="udiff-line-modified-added">+              va_list   args_list,</span>
<span class="udiff-line-modified-added">+              gpointer  marshal_data,</span>
<span class="udiff-line-modified-added">+              int       n_params,</span>
<span class="udiff-line-modified-added">+              GType    *param_types)</span>
  {
    ffi_type *rtype;
    void *rvalue;
    int n_args;
    ffi_type **atypes;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1617,27 +1621,27 @@</span>
      {
        GType type = param_types[i]  &amp; ~G_SIGNAL_TYPE_STATIC_SCOPE;
        GType fundamental = G_TYPE_FUNDAMENTAL (type);
  
        atypes[i+1] = va_to_ffi_type (type,
<span class="udiff-line-modified-removed">-                     &amp;args_copy,</span>
<span class="udiff-line-modified-removed">-                     &amp;storage[i]);</span>
<span class="udiff-line-modified-added">+             &amp;args_copy,</span>
<span class="udiff-line-modified-added">+             &amp;storage[i]);</span>
        args[i+1] = &amp;storage[i];
  
        if ((param_types[i]  &amp; G_SIGNAL_TYPE_STATIC_SCOPE) == 0)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       if (fundamental == G_TYPE_STRING &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         storage[i]._gpointer = g_strdup (storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-       else if (fundamental == G_TYPE_PARAM &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         storage[i]._gpointer = g_param_spec_ref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-       else if (fundamental == G_TYPE_BOXED &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         storage[i]._gpointer = g_boxed_copy (type, storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-       else if (fundamental == G_TYPE_VARIANT &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         storage[i]._gpointer = g_variant_ref_sink (storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     if (fundamental == G_TYPE_STRING &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       storage[i]._gpointer = g_strdup (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+     else if (fundamental == G_TYPE_PARAM &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       storage[i]._gpointer = g_param_spec_ref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+     else if (fundamental == G_TYPE_BOXED &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       storage[i]._gpointer = g_boxed_copy (type, storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+     else if (fundamental == G_TYPE_VARIANT &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       storage[i]._gpointer = g_variant_ref_sink (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+   }</span>
        if (fundamental == G_TYPE_OBJECT &amp;&amp; storage[i]._gpointer != NULL)
<span class="udiff-line-modified-removed">-     storage[i]._gpointer = g_object_ref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+   storage[i]._gpointer = g_object_ref (storage[i]._gpointer);</span>
      }
  
    va_end (args_copy);
  
    if (ffi_prep_cif (&amp;cif, FFI_DEFAULT_ABI, n_args, rtype, atypes) != FFI_OK)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1650,22 +1654,22 @@</span>
      {
        GType type = param_types[i]  &amp; ~G_SIGNAL_TYPE_STATIC_SCOPE;
        GType fundamental = G_TYPE_FUNDAMENTAL (type);
  
        if ((param_types[i]  &amp; G_SIGNAL_TYPE_STATIC_SCOPE) == 0)
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-       if (fundamental == G_TYPE_STRING &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         g_free (storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-       else if (fundamental == G_TYPE_PARAM &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         g_param_spec_unref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-       else if (fundamental == G_TYPE_BOXED &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         g_boxed_free (type, storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-       else if (fundamental == G_TYPE_VARIANT &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-removed">-         g_variant_unref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+   {</span>
<span class="udiff-line-modified-added">+     if (fundamental == G_TYPE_STRING &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       g_free (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+     else if (fundamental == G_TYPE_PARAM &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       g_param_spec_unref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+     else if (fundamental == G_TYPE_BOXED &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       g_boxed_free (type, storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+     else if (fundamental == G_TYPE_VARIANT &amp;&amp; storage[i]._gpointer != NULL)</span>
<span class="udiff-line-modified-added">+       g_variant_unref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+   }</span>
        if (fundamental == G_TYPE_OBJECT &amp;&amp; storage[i]._gpointer != NULL)
<span class="udiff-line-modified-removed">-     g_object_unref (storage[i]._gpointer);</span>
<span class="udiff-line-modified-added">+   g_object_unref (storage[i]._gpointer);</span>
      }
  
    if (return_value &amp;&amp; G_VALUE_TYPE (return_value))
      value_from_ffi_type (return_value, rvalue);
  }
</pre>
<center><a href="gboxed.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gclosure.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>