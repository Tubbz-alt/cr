<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/plugins/elements/gstqueue.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../libs/gst/controller/gsttriggercontrolsource.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="gsttypefindelement.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/plugins/elements/gstqueue.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 937,11 ***</span>
        /* make sure it pauses, this should happen since we sent
         * flush_start downstream. */
  #ifdef GSTREAMER_LITE
        // Pause task on pad only if it is linked
        if (gst_pad_is_linked (queue-&gt;srcpad)) {
<span class="line-modified">!           gst_pad_pause_task (queue-&gt;srcpad);</span>
        }
  #else // GSTREAMER_LITE
        gst_pad_pause_task (queue-&gt;srcpad);
  #endif // GSTREAMER_LITE
        GST_CAT_LOG_OBJECT (queue_dataflow, queue, &quot;loop stopped&quot;);
<span class="line-new-header">--- 937,11 ---</span>
        /* make sure it pauses, this should happen since we sent
         * flush_start downstream. */
  #ifdef GSTREAMER_LITE
        // Pause task on pad only if it is linked
        if (gst_pad_is_linked (queue-&gt;srcpad)) {
<span class="line-modified">!         gst_pad_pause_task (queue-&gt;srcpad);</span>
        }
  #else // GSTREAMER_LITE
        gst_pad_pause_task (queue-&gt;srcpad);
  #endif // GSTREAMER_LITE
        GST_CAT_LOG_OBJECT (queue_dataflow, queue, &quot;loop stopped&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1024,11 ***</span>
                  queue-&gt;unexpected = FALSE;
                }
  
                break;
              default:
<span class="line-modified">!           goto out_eos;</span>
            }
          }
  
          gst_queue_locked_enqueue_event (queue, event);
          GST_QUEUE_MUTEX_UNLOCK (queue);
<span class="line-new-header">--- 1024,11 ---</span>
                  queue-&gt;unexpected = FALSE;
                }
  
                break;
              default:
<span class="line-modified">!               goto out_eos;</span>
            }
          }
  
          gst_queue_locked_enqueue_event (queue, event);
          GST_QUEUE_MUTEX_UNLOCK (queue);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1081,11 ***</span>
          qitem.size = 0;
          gst_queue_array_push_tail_struct (queue-&gt;queue, &amp;qitem);
          GST_QUEUE_SIGNAL_ADD (queue);
          while (queue-&gt;srcresult == GST_FLOW_OK &amp;&amp;
              queue-&gt;last_handled_query != query)
<span class="line-modified">!         g_cond_wait (&amp;queue-&gt;query_handled, &amp;queue-&gt;qlock);</span>
          queue-&gt;last_handled_query = NULL;
          if (queue-&gt;srcresult != GST_FLOW_OK)
            goto out_flushing;
          res = queue-&gt;last_query;
          GST_QUEUE_MUTEX_UNLOCK (queue);
<span class="line-new-header">--- 1081,11 ---</span>
          qitem.size = 0;
          gst_queue_array_push_tail_struct (queue-&gt;queue, &amp;qitem);
          GST_QUEUE_SIGNAL_ADD (queue);
          while (queue-&gt;srcresult == GST_FLOW_OK &amp;&amp;
              queue-&gt;last_handled_query != query)
<span class="line-modified">!           g_cond_wait (&amp;queue-&gt;query_handled, &amp;queue-&gt;qlock);</span>
          queue-&gt;last_handled_query = NULL;
          if (queue-&gt;srcresult != GST_FLOW_OK)
            goto out_flushing;
          res = queue-&gt;last_query;
          GST_QUEUE_MUTEX_UNLOCK (queue);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1207,16 ***</span>
    if (!is_list) {
      GstClockTime duration, timestamp;
      GstBuffer *buffer = GST_BUFFER_CAST (obj);
  
      timestamp = GST_BUFFER_DTS_OR_PTS (buffer);
<span class="line-modified">!   duration = GST_BUFFER_DURATION (buffer);</span>
  
<span class="line-modified">!   GST_CAT_LOG_OBJECT (queue_dataflow, queue, &quot;received buffer %p of size %&quot;</span>
<span class="line-modified">!       G_GSIZE_FORMAT &quot;, time %&quot; GST_TIME_FORMAT &quot;, duration %&quot;</span>
<span class="line-modified">!       GST_TIME_FORMAT, buffer, gst_buffer_get_size (buffer),</span>
<span class="line-modified">!       GST_TIME_ARGS (timestamp), GST_TIME_ARGS (duration));</span>
    } else {
      GST_CAT_LOG_OBJECT (queue_dataflow, queue,
          &quot;received buffer list %p with %u buffers&quot;, obj,
          gst_buffer_list_length (GST_BUFFER_LIST_CAST (obj)));
    }
<span class="line-new-header">--- 1207,16 ---</span>
    if (!is_list) {
      GstClockTime duration, timestamp;
      GstBuffer *buffer = GST_BUFFER_CAST (obj);
  
      timestamp = GST_BUFFER_DTS_OR_PTS (buffer);
<span class="line-modified">!     duration = GST_BUFFER_DURATION (buffer);</span>
  
<span class="line-modified">!     GST_CAT_LOG_OBJECT (queue_dataflow, queue, &quot;received buffer %p of size %&quot;</span>
<span class="line-modified">!         G_GSIZE_FORMAT &quot;, time %&quot; GST_TIME_FORMAT &quot;, duration %&quot;</span>
<span class="line-modified">!         GST_TIME_FORMAT, buffer, gst_buffer_get_size (buffer),</span>
<span class="line-modified">!         GST_TIME_ARGS (timestamp), GST_TIME_ARGS (duration));</span>
    } else {
      GST_CAT_LOG_OBJECT (queue_dataflow, queue,
          &quot;received buffer list %p with %u buffers&quot;, obj,
          gst_buffer_list_length (GST_BUFFER_LIST_CAST (obj)));
    }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1274,18 ***</span>
    }
  
    if (queue-&gt;tail_needs_discont) {
      if (!is_list) {
        GstBuffer *buffer = GST_BUFFER_CAST (obj);
<span class="line-modified">!     GstBuffer *subbuffer = gst_buffer_make_writable (buffer);</span>
  
<span class="line-modified">!     if (subbuffer) {</span>
<span class="line-modified">!       buffer = subbuffer;</span>
<span class="line-modified">!       GST_BUFFER_FLAG_SET (buffer, GST_BUFFER_FLAG_DISCONT);</span>
<span class="line-modified">!     } else {</span>
<span class="line-modified">!       GST_DEBUG_OBJECT (queue, &quot;Could not mark buffer as DISCONT&quot;);</span>
<span class="line-modified">!     }</span>
  
        obj = GST_MINI_OBJECT_CAST (buffer);
      } else {
        GstBufferList *buffer_list = GST_BUFFER_LIST_CAST (obj);
  
<span class="line-new-header">--- 1274,18 ---</span>
    }
  
    if (queue-&gt;tail_needs_discont) {
      if (!is_list) {
        GstBuffer *buffer = GST_BUFFER_CAST (obj);
<span class="line-modified">!       GstBuffer *subbuffer = gst_buffer_make_writable (buffer);</span>
  
<span class="line-modified">!       if (subbuffer) {</span>
<span class="line-modified">!         buffer = subbuffer;</span>
<span class="line-modified">!         GST_BUFFER_FLAG_SET (buffer, GST_BUFFER_FLAG_DISCONT);</span>
<span class="line-modified">!       } else {</span>
<span class="line-modified">!         GST_DEBUG_OBJECT (queue, &quot;Could not mark buffer as DISCONT&quot;);</span>
<span class="line-modified">!       }</span>
  
        obj = GST_MINI_OBJECT_CAST (buffer);
      } else {
        GstBufferList *buffer_list = GST_BUFFER_LIST_CAST (obj);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1376,28 ***</span>
  next:
    is_list = GST_IS_BUFFER_LIST (data);
  
    if (GST_IS_BUFFER (data) || is_list) {
      if (!is_list) {
<span class="line-modified">!     GstBuffer *buffer;</span>
  
<span class="line-modified">!     buffer = GST_BUFFER_CAST (data);</span>
  
<span class="line-modified">!     if (queue-&gt;head_needs_discont) {</span>
<span class="line-modified">!       GstBuffer *subbuffer = gst_buffer_make_writable (buffer);</span>
  
<span class="line-modified">!       if (subbuffer) {</span>
<span class="line-modified">!         buffer = subbuffer;</span>
<span class="line-modified">!         GST_BUFFER_FLAG_SET (buffer, GST_BUFFER_FLAG_DISCONT);</span>
<span class="line-modified">!       } else {</span>
<span class="line-modified">!         GST_DEBUG_OBJECT (queue, &quot;Could not mark buffer as DISCONT&quot;);</span>
        }
<span class="line-removed">-       queue-&gt;head_needs_discont = FALSE;</span>
<span class="line-removed">-     }</span>
  
<span class="line-modified">!     GST_QUEUE_MUTEX_UNLOCK (queue);</span>
<span class="line-modified">!     result = gst_pad_push (queue-&gt;srcpad, buffer);</span>
      } else {
        GstBufferList *buffer_list;
  
        buffer_list = GST_BUFFER_LIST_CAST (data);
  
<span class="line-new-header">--- 1376,28 ---</span>
  next:
    is_list = GST_IS_BUFFER_LIST (data);
  
    if (GST_IS_BUFFER (data) || is_list) {
      if (!is_list) {
<span class="line-modified">!       GstBuffer *buffer;</span>
  
<span class="line-modified">!       buffer = GST_BUFFER_CAST (data);</span>
  
<span class="line-modified">!       if (queue-&gt;head_needs_discont) {</span>
<span class="line-modified">!         GstBuffer *subbuffer = gst_buffer_make_writable (buffer);</span>
  
<span class="line-modified">!         if (subbuffer) {</span>
<span class="line-modified">!           buffer = subbuffer;</span>
<span class="line-modified">!           GST_BUFFER_FLAG_SET (buffer, GST_BUFFER_FLAG_DISCONT);</span>
<span class="line-modified">!         } else {</span>
<span class="line-modified">!           GST_DEBUG_OBJECT (queue, &quot;Could not mark buffer as DISCONT&quot;);</span>
<span class="line-added">+         }</span>
<span class="line-added">+         queue-&gt;head_needs_discont = FALSE;</span>
        }
  
<span class="line-modified">!       GST_QUEUE_MUTEX_UNLOCK (queue);</span>
<span class="line-modified">!       result = gst_pad_push (queue-&gt;srcpad, buffer);</span>
      } else {
        GstBufferList *buffer_list;
  
        buffer_list = GST_BUFFER_LIST_CAST (data);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1567,16 ***</span>
    {
      gboolean eos = queue-&gt;eos;
      GstFlowReturn ret = queue-&gt;srcresult;
  
  #ifdef GSTREAMER_LITE
<span class="line-modified">!       // Pause task on pad only if it is linked</span>
<span class="line-modified">!       if (gst_pad_is_linked (queue-&gt;srcpad)) {</span>
<span class="line-removed">-           gst_pad_pause_task (queue-&gt;srcpad);</span>
<span class="line-removed">-       }</span>
<span class="line-removed">- #else // GSTREAMER_LITE</span>
        gst_pad_pause_task (queue-&gt;srcpad);
  #endif // GSTREAMER_LITE
  
      GST_CAT_LOG_OBJECT (queue_dataflow, queue,
          &quot;pause task, reason:  %s&quot;, gst_flow_get_name (ret));
      if (ret == GST_FLOW_FLUSHING) {
<span class="line-new-header">--- 1567,16 ---</span>
    {
      gboolean eos = queue-&gt;eos;
      GstFlowReturn ret = queue-&gt;srcresult;
  
  #ifdef GSTREAMER_LITE
<span class="line-modified">!     // Pause task on pad only if it is linked</span>
<span class="line-modified">!     if (gst_pad_is_linked (queue-&gt;srcpad)) {</span>
        gst_pad_pause_task (queue-&gt;srcpad);
<span class="line-added">+     }</span>
<span class="line-added">+ #else // GSTREAMER_LITE</span>
<span class="line-added">+     gst_pad_pause_task (queue-&gt;srcpad);</span>
  #endif // GSTREAMER_LITE
  
      GST_CAT_LOG_OBJECT (queue_dataflow, queue,
          &quot;pause task, reason:  %s&quot;, gst_flow_get_name (ret));
      if (ret == GST_FLOW_FLUSHING) {
</pre>
<center><a href="../../libs/gst/controller/gsttriggercontrolsource.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="gsttypefindelement.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>