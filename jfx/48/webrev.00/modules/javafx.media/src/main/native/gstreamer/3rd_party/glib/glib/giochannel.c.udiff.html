<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/giochannel.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ghostutils.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="giochannel.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/giochannel.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -37,11 +37,10 @@</span>
  #include &quot;giochannel.h&quot;
  
  #include &quot;gstrfuncs.h&quot;
  #include &quot;gtestutils.h&quot;
  #include &quot;glibintl.h&quot;
<span class="udiff-line-removed">- #include &quot;gunicodeprivate.h&quot;</span>
  
  
  /**
   * SECTION:iochannels
   * @title: IO Channels
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -151,29 +150,29 @@</span>
   **/
  
  #define G_IO_NICE_BUF_SIZE  1024
  
  /* This needs to be as wide as the largest character in any possible encoding */
<span class="udiff-line-modified-removed">- #define MAX_CHAR_SIZE       10</span>
<span class="udiff-line-modified-added">+ #define MAX_CHAR_SIZE   10</span>
  
  /* Some simplifying macros, which reduce the need to worry whether the
   * buffers have been allocated. These also make USE_BUF () an lvalue,
   * which is used in g_io_channel_read_to_end ().
   */
<span class="udiff-line-modified-removed">- #define USE_BUF(channel)    ((channel)-&gt;encoding ? (channel)-&gt;encoded_read_buf \</span>
<span class="udiff-line-modified-removed">-                  : (channel)-&gt;read_buf)</span>
<span class="udiff-line-modified-removed">- #define BUF_LEN(string)     ((string) ? (string)-&gt;len : 0)</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- static GIOError     g_io_error_get_from_g_error (GIOStatus    status,</span>
<span class="udiff-line-modified-removed">-                              GError      *err);</span>
<span class="udiff-line-modified-removed">- static void     g_io_channel_purge      (GIOChannel  *channel);</span>
<span class="udiff-line-modified-removed">- static GIOStatus    g_io_channel_fill_buffer    (GIOChannel  *channel,</span>
<span class="udiff-line-modified-removed">-                              GError     **err);</span>
<span class="udiff-line-modified-removed">- static GIOStatus    g_io_channel_read_line_backend  (GIOChannel  *channel,</span>
<span class="udiff-line-modified-removed">-                              gsize       *length,</span>
<span class="udiff-line-modified-removed">-                              gsize       *terminator_pos,</span>
<span class="udiff-line-modified-removed">-                              GError     **error);</span>
<span class="udiff-line-modified-added">+ #define USE_BUF(channel)  ((channel)-&gt;encoding ? (channel)-&gt;encoded_read_buf \</span>
<span class="udiff-line-modified-added">+          : (channel)-&gt;read_buf)</span>
<span class="udiff-line-modified-added">+ #define BUF_LEN(string)   ((string) ? (string)-&gt;len : 0)</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ static GIOError   g_io_error_get_from_g_error (GIOStatus    status,</span>
<span class="udiff-line-modified-added">+                GError      *err);</span>
<span class="udiff-line-modified-added">+ static void   g_io_channel_purge    (GIOChannel  *channel);</span>
<span class="udiff-line-modified-added">+ static GIOStatus  g_io_channel_fill_buffer  (GIOChannel  *channel,</span>
<span class="udiff-line-modified-added">+                GError     **err);</span>
<span class="udiff-line-modified-added">+ static GIOStatus  g_io_channel_read_line_backend  (GIOChannel  *channel,</span>
<span class="udiff-line-modified-added">+                gsize       *length,</span>
<span class="udiff-line-modified-added">+                gsize       *terminator_pos,</span>
<span class="udiff-line-modified-added">+                GError     **error);</span>
  
  /**
   * g_io_channel_init:
   * @channel: a #GIOChannel
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -257,21 +256,21 @@</span>
      }
  }
  
  static GIOError
  g_io_error_get_from_g_error (GIOStatus  status,
<span class="udiff-line-modified-removed">-                  GError    *err)</span>
<span class="udiff-line-modified-added">+            GError    *err)</span>
  {
    switch (status)
      {
        case G_IO_STATUS_NORMAL:
        case G_IO_STATUS_EOF:
          return G_IO_ERROR_NONE;
        case G_IO_STATUS_AGAIN:
          return G_IO_ERROR_AGAIN;
        case G_IO_STATUS_ERROR:
<span class="udiff-line-modified-removed">-     g_return_val_if_fail (err != NULL, G_IO_ERROR_UNKNOWN);</span>
<span class="udiff-line-modified-added">+   g_return_val_if_fail (err != NULL, G_IO_ERROR_UNKNOWN);</span>
  
          if (err-&gt;domain != G_IO_CHANNEL_ERROR)
            return G_IO_ERROR_UNKNOWN;
          switch (err-&gt;code)
            {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -299,13 +298,13 @@</span>
   *
   * Deprecated:2.2: Use g_io_channel_read_chars() instead.
   **/
  GIOError
  g_io_channel_read (GIOChannel *channel,
<span class="udiff-line-modified-removed">-            gchar      *buf,</span>
<span class="udiff-line-modified-removed">-            gsize       count,</span>
<span class="udiff-line-modified-removed">-            gsize      *bytes_read)</span>
<span class="udiff-line-modified-added">+        gchar      *buf,</span>
<span class="udiff-line-modified-added">+        gsize       count,</span>
<span class="udiff-line-modified-added">+        gsize      *bytes_read)</span>
  {
    GError *err = NULL;
    GIOError error;
    GIOStatus status;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -344,13 +343,13 @@</span>
   *
   * Deprecated:2.2: Use g_io_channel_write_chars() instead.
   **/
  GIOError
  g_io_channel_write (GIOChannel  *channel,
<span class="udiff-line-modified-removed">-             const gchar *buf,</span>
<span class="udiff-line-modified-removed">-             gsize        count,</span>
<span class="udiff-line-modified-removed">-             gsize       *bytes_written)</span>
<span class="udiff-line-modified-added">+         const gchar *buf,</span>
<span class="udiff-line-modified-added">+         gsize        count,</span>
<span class="udiff-line-modified-added">+         gsize       *bytes_written)</span>
  {
    GError *err = NULL;
    GIOError error;
    GIOStatus status;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -383,12 +382,12 @@</span>
   *
   * Deprecated:2.2: Use g_io_channel_seek_position() instead.
   **/
  GIOError
  g_io_channel_seek (GIOChannel *channel,
<span class="udiff-line-modified-removed">-            gint64      offset,</span>
<span class="udiff-line-modified-removed">-            GSeekType   type)</span>
<span class="udiff-line-modified-added">+        gint64      offset,</span>
<span class="udiff-line-modified-added">+        GSeekType   type)</span>
  {
    GError *err = NULL;
    GIOError error;
    GIOStatus status;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -481,12 +480,12 @@</span>
   *
   * Returns: the status of the operation.
   **/
  GIOStatus
  g_io_channel_shutdown (GIOChannel  *channel,
<span class="udiff-line-modified-removed">-                gboolean     flush,</span>
<span class="udiff-line-modified-removed">-                GError     **err)</span>
<span class="udiff-line-modified-added">+            gboolean     flush,</span>
<span class="udiff-line-modified-added">+            GError     **err)</span>
  {
    GIOStatus status, result;
    GError *tmperr = NULL;
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -607,11 +606,11 @@</span>
   *
   * Returns: a new #GSource
   */
  GSource *
  g_io_create_watch (GIOChannel   *channel,
<span class="udiff-line-modified-removed">-            GIOCondition  condition)</span>
<span class="udiff-line-modified-added">+        GIOCondition  condition)</span>
  {
    g_return_val_if_fail (channel != NULL, NULL);
  
    return channel-&gt;funcs-&gt;io_create_watch (channel, condition);
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -634,15 +633,15 @@</span>
   *
   * Returns: the event source id
   */
  guint
  g_io_add_watch_full (GIOChannel    *channel,
<span class="udiff-line-modified-removed">-              gint           priority,</span>
<span class="udiff-line-modified-removed">-              GIOCondition   condition,</span>
<span class="udiff-line-modified-removed">-              GIOFunc        func,</span>
<span class="udiff-line-modified-removed">-              gpointer       user_data,</span>
<span class="udiff-line-modified-removed">-              GDestroyNotify notify)</span>
<span class="udiff-line-modified-added">+          gint           priority,</span>
<span class="udiff-line-modified-added">+          GIOCondition   condition,</span>
<span class="udiff-line-modified-added">+          GIOFunc        func,</span>
<span class="udiff-line-modified-added">+          gpointer       user_data,</span>
<span class="udiff-line-modified-added">+          GDestroyNotify notify)</span>
  {
    GSource *source;
    guint id;
  
    g_return_val_if_fail (channel != NULL, 0);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -697,13 +696,13 @@</span>
   * A bitwise combination representing a condition to watch for on an
   * event source.
   **/
  guint
  g_io_add_watch (GIOChannel   *channel,
<span class="udiff-line-modified-removed">-         GIOCondition  condition,</span>
<span class="udiff-line-modified-removed">-         GIOFunc       func,</span>
<span class="udiff-line-modified-removed">-         gpointer      user_data)</span>
<span class="udiff-line-modified-added">+     GIOCondition  condition,</span>
<span class="udiff-line-modified-added">+     GIOFunc       func,</span>
<span class="udiff-line-modified-added">+     gpointer      user_data)</span>
  {
    return g_io_add_watch_full (channel, G_PRIORITY_DEFAULT, condition, func, user_data, NULL);
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -880,11 +879,11 @@</span>
   * where in the file a line break occurs.
   **/
  void
  g_io_channel_set_line_term (GIOChannel  *channel,
                              const gchar *line_term,
<span class="udiff-line-modified-removed">-                 gint         length)</span>
<span class="udiff-line-modified-added">+           gint         length)</span>
  {
    g_return_if_fail (channel != NULL);
    g_return_if_fail (line_term == NULL || length != 0); /* Disallow &quot;&quot; */
  
    if (line_term == NULL)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -909,11 +908,11 @@</span>
   * Returns: The line termination string. This value
   *   is owned by GLib and must not be freed.
   **/
  const gchar *
  g_io_channel_get_line_term (GIOChannel *channel,
<span class="udiff-line-modified-removed">-                 gint       *length)</span>
<span class="udiff-line-modified-added">+           gint       *length)</span>
  {
    g_return_val_if_fail (channel != NULL, NULL);
  
    if (length)
      *length = channel-&gt;line_term_len;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -963,15 +962,15 @@</span>
                          GIOFlags     flags,
                          GError     **error)
  {
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL),
<span class="udiff-line-modified-removed">-             G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       G_IO_STATUS_ERROR);</span>
  
    return (*channel-&gt;funcs-&gt;io_set_flags) (channel,
<span class="udiff-line-modified-removed">-                       flags &amp; G_IO_FLAG_SET_MASK,</span>
<span class="udiff-line-modified-removed">-                       error);</span>
<span class="udiff-line-modified-added">+             flags &amp; G_IO_FLAG_SET_MASK,</span>
<span class="udiff-line-modified-added">+             error);</span>
  }
  
  /**
   * g_io_channel_get_flags:
   * @channel: a #GIOChannel
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1022,11 +1021,11 @@</span>
   * Setting this flag to %TRUE for a channel you have already closed
   * can cause problems when the final reference to the #GIOChannel is dropped.
   **/
  void
  g_io_channel_set_close_on_unref (GIOChannel *channel,
<span class="udiff-line-modified-removed">-                                  gboolean    do_close)</span>
<span class="udiff-line-modified-added">+          gboolean    do_close)</span>
  {
    g_return_if_fail (channel != NULL);
  
    channel-&gt;close_on_unref = do_close;
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1085,11 +1084,11 @@</span>
     * For sockets, both can contain data.
     */
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL),
<span class="udiff-line-modified-removed">-             G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       G_IO_STATUS_ERROR);</span>
    g_return_val_if_fail (channel-&gt;is_seekable, G_IO_STATUS_ERROR);
  
    switch (type)
      {
        case G_SEEK_CUR: /* The user is seeking relative to the head of the buffer */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1172,11 +1171,11 @@</span>
   *   #G_IO_STATUS_NORMAL, #G_IO_STATUS_AGAIN, or
   *   #G_IO_STATUS_ERROR.
   **/
  GIOStatus
  g_io_channel_flush (GIOChannel  *channel,
<span class="udiff-line-modified-removed">-                     GError     **error)</span>
<span class="udiff-line-modified-added">+         GError     **error)</span>
  {
    GIOStatus status;
    gsize this_time = 1, bytes_written = 0;
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1188,13 +1187,13 @@</span>
    do
      {
        g_assert (this_time &gt; 0);
  
        status = channel-&gt;funcs-&gt;io_write (channel,
<span class="udiff-line-modified-removed">-                      channel-&gt;write_buf-&gt;str + bytes_written,</span>
<span class="udiff-line-modified-removed">-                      channel-&gt;write_buf-&gt;len - bytes_written,</span>
<span class="udiff-line-modified-removed">-                      &amp;this_time, error);</span>
<span class="udiff-line-modified-added">+            channel-&gt;write_buf-&gt;str + bytes_written,</span>
<span class="udiff-line-modified-added">+            channel-&gt;write_buf-&gt;len - bytes_written,</span>
<span class="udiff-line-modified-added">+            &amp;this_time, error);</span>
        bytes_written += this_time;
      }
    while ((bytes_written &lt; channel-&gt;write_buf-&gt;len)
           &amp;&amp; (status == G_IO_STATUS_NORMAL));
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1305,24 +1304,26 @@</span>
   * calling one of the API &quot;read&quot; functions.
   *
   * Return Value: %G_IO_STATUS_NORMAL if the encoding was successfully set
   */
  GIOStatus
<span class="udiff-line-modified-removed">- g_io_channel_set_encoding (GIOChannel   *channel,</span>
<span class="udiff-line-modified-added">+ g_io_channel_set_encoding (GIOChannel *channel,</span>
                             const gchar  *encoding,
<span class="udiff-line-modified-removed">-                            GError      **error)</span>
<span class="udiff-line-modified-added">+          GError      **error)</span>
  {
    GIConv read_cd, write_cd;
<span class="udiff-line-added">+ #ifndef G_DISABLE_ASSERT</span>
    gboolean did_encode;
<span class="udiff-line-added">+ #endif</span>
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL), G_IO_STATUS_ERROR);
  
    /* Make sure the encoded buffers are empty */
  
    g_return_val_if_fail (!channel-&gt;do_encode || !channel-&gt;encoded_read_buf ||
<span class="udiff-line-modified-removed">-             channel-&gt;encoded_read_buf-&gt;len == 0, G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       channel-&gt;encoded_read_buf-&gt;len == 0, G_IO_STATUS_ERROR);</span>
  
    if (!channel-&gt;use_buffer)
      {
        g_warning (&quot;Need to set the channel buffered before setting the encoding.&quot;);
        g_warning (&quot;Assuming this is what you meant and acting accordingly.&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1334,11 +1335,13 @@</span>
      {
        g_warning (&quot;Partial character at end of write buffer not flushed.&quot;);
        channel-&gt;partial_write_buf[0] = &#39;\0&#39;;
      }
  
<span class="udiff-line-added">+ #ifndef G_DISABLE_ASSERT</span>
    did_encode = channel-&gt;do_encode;
<span class="udiff-line-added">+ #endif</span>
  
    if (!encoding || strcmp (encoding, &quot;UTF8&quot;) == 0 || strcmp (encoding, &quot;UTF-8&quot;) == 0)
      {
        channel-&gt;do_encode = FALSE;
        read_cd = write_cd = (GIConv) -1;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1518,22 +1521,22 @@</span>
                           channel-&gt;encoded_read_buf-&gt;len + outbytes_left);
        outbuf = channel-&gt;encoded_read_buf-&gt;str + channel-&gt;encoded_read_buf-&gt;len
                 - outbytes_left;
  
        errnum = g_iconv (channel-&gt;read_cd, &amp;inbuf, &amp;inbytes_left,
<span class="udiff-line-modified-removed">-             &amp;outbuf, &amp;outbytes_left);</span>
<span class="udiff-line-modified-added">+       &amp;outbuf, &amp;outbytes_left);</span>
        errval = errno;
  
        g_assert (inbuf + inbytes_left == channel-&gt;read_buf-&gt;str
                  + channel-&gt;read_buf-&gt;len);
        g_assert (outbuf + outbytes_left == channel-&gt;encoded_read_buf-&gt;str
                  + channel-&gt;encoded_read_buf-&gt;len);
  
        g_string_erase (channel-&gt;read_buf, 0,
<span class="udiff-line-modified-removed">-               channel-&gt;read_buf-&gt;len - inbytes_left);</span>
<span class="udiff-line-modified-added">+           channel-&gt;read_buf-&gt;len - inbytes_left);</span>
        g_string_truncate (channel-&gt;encoded_read_buf,
<span class="udiff-line-modified-removed">-              channel-&gt;encoded_read_buf-&gt;len - outbytes_left);</span>
<span class="udiff-line-modified-added">+        channel-&gt;encoded_read_buf-&gt;len - outbytes_left);</span>
  
        if (errnum == (gsize) -1)
          {
            switch (errval)
              {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1642,20 +1645,20 @@</span>
   **/
  GIOStatus
  g_io_channel_read_line (GIOChannel  *channel,
                          gchar      **str_return,
                          gsize       *length,
<span class="udiff-line-modified-removed">-             gsize       *terminator_pos,</span>
<span class="udiff-line-modified-removed">-                 GError     **error)</span>
<span class="udiff-line-modified-added">+       gsize       *terminator_pos,</span>
<span class="udiff-line-modified-added">+             GError     **error)</span>
  {
    GIOStatus status;
    gsize got_length;
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail (str_return != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL),
<span class="udiff-line-modified-removed">-             G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       G_IO_STATUS_ERROR);</span>
    g_return_val_if_fail (channel-&gt;is_readable, G_IO_STATUS_ERROR);
  
    status = g_io_channel_read_line_backend (channel, &amp;got_length, terminator_pos, error);
  
    if (length &amp;&amp; status != G_IO_STATUS_ERROR)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1688,20 +1691,20 @@</span>
   * Returns: the status of the operation.
   **/
  GIOStatus
  g_io_channel_read_line_string (GIOChannel  *channel,
                                 GString     *buffer,
<span class="udiff-line-modified-removed">-                                gsize       *terminator_pos,</span>
<span class="udiff-line-modified-removed">-                                GError     **error)</span>
<span class="udiff-line-modified-added">+              gsize       *terminator_pos,</span>
<span class="udiff-line-modified-added">+                                GError   **error)</span>
  {
    gsize length;
    GIOStatus status;
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail (buffer != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL),
<span class="udiff-line-modified-removed">-             G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       G_IO_STATUS_ERROR);</span>
    g_return_val_if_fail (channel-&gt;is_readable, G_IO_STATUS_ERROR);
  
    if (buffer-&gt;len &gt; 0)
      g_string_truncate (buffer, 0); /* clear out the buffer */
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1867,13 +1870,13 @@</span>
            got_term_len = 0;
            break;
          }
  
        if (use_buf-&gt;len &gt; line_term_len - 1)
<span class="udiff-line-modified-removed">-     checked_to = use_buf-&gt;len - (line_term_len - 1);</span>
<span class="udiff-line-modified-added">+   checked_to = use_buf-&gt;len - (line_term_len - 1);</span>
        else
<span class="udiff-line-modified-removed">-     checked_to = 0;</span>
<span class="udiff-line-modified-added">+   checked_to = 0;</span>
      }
  
  done:
  
    if (terminator_pos)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1956,13 +1959,13 @@</span>
          *str_return = g_string_free (USE_BUF (channel), FALSE);
        else
          g_string_free (USE_BUF (channel), TRUE);
  
        if (channel-&gt;encoding)
<span class="udiff-line-modified-removed">-     channel-&gt;encoded_read_buf = NULL;</span>
<span class="udiff-line-modified-added">+   channel-&gt;encoded_read_buf = NULL;</span>
        else
<span class="udiff-line-modified-removed">-     channel-&gt;read_buf = NULL;</span>
<span class="udiff-line-modified-added">+   channel-&gt;read_buf = NULL;</span>
      }
  
    return G_IO_STATUS_NORMAL;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2098,19 +2101,19 @@</span>
   *
   * Returns: a #GIOStatus
   **/
  GIOStatus
  g_io_channel_read_unichar (GIOChannel  *channel,
<span class="udiff-line-modified-removed">-                gunichar    *thechar,</span>
<span class="udiff-line-modified-removed">-                GError     **error)</span>
<span class="udiff-line-modified-added">+          gunichar    *thechar,</span>
<span class="udiff-line-modified-added">+          GError     **error)</span>
  {
    GIOStatus status = G_IO_STATUS_NORMAL;
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail (channel-&gt;encoding != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL),
<span class="udiff-line-modified-removed">-             G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       G_IO_STATUS_ERROR);</span>
    g_return_val_if_fail (channel-&gt;is_readable, G_IO_STATUS_ERROR);
  
    while (BUF_LEN (channel-&gt;encoded_read_buf) == 0 &amp;&amp; status == G_IO_STATUS_NORMAL)
      status = g_io_channel_fill_buffer (channel, error);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2172,47 +2175,50 @@</span>
   **/
  GIOStatus
  g_io_channel_write_chars (GIOChannel   *channel,
                            const gchar  *buf,
                            gssize        count,
<span class="udiff-line-modified-removed">-               gsize        *bytes_written,</span>
<span class="udiff-line-modified-added">+         gsize        *bytes_written,</span>
                            GError      **error)
  {
<span class="udiff-line-added">+   gsize count_unsigned;</span>
    GIOStatus status;
    gssize wrote_bytes = 0;
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL),
<span class="udiff-line-modified-removed">-             G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       G_IO_STATUS_ERROR);</span>
    g_return_val_if_fail (channel-&gt;is_writeable, G_IO_STATUS_ERROR);
  
    if ((count &lt; 0) &amp;&amp; buf)
      count = strlen (buf);
<span class="udiff-line-added">+   count_unsigned = count;</span>
  
<span class="udiff-line-modified-removed">-   if (count == 0)</span>
<span class="udiff-line-modified-added">+   if (count_unsigned == 0)</span>
      {
        if (bytes_written)
          *bytes_written = 0;
        return G_IO_STATUS_NORMAL;
      }
  
    g_return_val_if_fail (buf != NULL, G_IO_STATUS_ERROR);
<span class="udiff-line-modified-removed">-   g_return_val_if_fail (count &gt; 0, G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+   g_return_val_if_fail (count_unsigned &gt; 0, G_IO_STATUS_ERROR);</span>
  
    /* Raw write case */
  
    if (!channel-&gt;use_buffer)
      {
        gsize tmp_bytes;
  
        g_assert (!channel-&gt;write_buf || channel-&gt;write_buf-&gt;len == 0);
        g_assert (channel-&gt;partial_write_buf[0] == &#39;\0&#39;);
  
<span class="udiff-line-modified-removed">-       status = channel-&gt;funcs-&gt;io_write (channel, buf, count, &amp;tmp_bytes, error);</span>
<span class="udiff-line-modified-added">+       status = channel-&gt;funcs-&gt;io_write (channel, buf, count_unsigned,</span>
<span class="udiff-line-added">+                                          &amp;tmp_bytes, error);</span>
  
        if (bytes_written)
<span class="udiff-line-modified-removed">-     *bytes_written = tmp_bytes;</span>
<span class="udiff-line-modified-added">+   *bytes_written = tmp_bytes;</span>
  
        return status;
      }
  
    /* General case */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2281,11 +2287,11 @@</span>
         */
        g_assert (space_in_buf &gt;= MAX_CHAR_SIZE);
  
        if (!channel-&gt;encoding)
          {
<span class="udiff-line-modified-removed">-           gssize write_this = MIN (space_in_buf, count - wrote_bytes);</span>
<span class="udiff-line-modified-added">+           gssize write_this = MIN (space_in_buf, count_unsigned - wrote_bytes);</span>
  
            g_string_append_len (channel-&gt;write_buf, buf, write_this);
            buf += write_this;
            wrote_bytes += write_this;
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2301,19 +2307,19 @@</span>
                g_assert (wrote_bytes == 0);
  
                from_buf = channel-&gt;partial_write_buf;
                from_buf_old_len = strlen (channel-&gt;partial_write_buf);
                g_assert (from_buf_old_len &gt; 0);
<span class="udiff-line-modified-removed">-               from_buf_len = MIN (6, from_buf_old_len + count);</span>
<span class="udiff-line-modified-added">+               from_buf_len = MIN (6, from_buf_old_len + count_unsigned);</span>
  
                memcpy (channel-&gt;partial_write_buf + from_buf_old_len, buf,
                        from_buf_len - from_buf_old_len);
              }
            else
              {
                from_buf = buf;
<span class="udiff-line-modified-removed">-               from_buf_len = count - wrote_bytes;</span>
<span class="udiff-line-modified-added">+               from_buf_len = count_unsigned - wrote_bytes;</span>
                from_buf_old_len = 0;
              }
  
  reconvert:
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2322,11 +2328,11 @@</span>
                const gchar *badchar;
                gsize try_len = MIN (from_buf_len, space_in_buf);
  
                /* UTF-8, just validate, emulate g_iconv */
  
<span class="udiff-line-modified-removed">-               if (!_g_utf8_validate_len (from_buf, try_len, &amp;badchar))</span>
<span class="udiff-line-modified-added">+               if (!g_utf8_validate_len (from_buf, try_len, &amp;badchar))</span>
                  {
                    gunichar try_char;
                    gsize incomplete_len = from_buf + try_len - badchar;
  
                    left_len = from_buf + from_buf_len - badchar;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2388,22 +2394,22 @@</span>
              }
  
            if (err == (gsize) -1)
              {
                switch (errnum)
<span class="udiff-line-modified-removed">-             {</span>
<span class="udiff-line-modified-added">+           {</span>
                    case EINVAL:
                      g_assert (left_len &lt; 6);
  
                      if (from_buf_old_len == 0)
                        {
                          /* Not from partial_write_buf */
  
                          memcpy (channel-&gt;partial_write_buf, from_buf, left_len);
                          channel-&gt;partial_write_buf[left_len] = &#39;\0&#39;;
                          if (bytes_written)
<span class="udiff-line-modified-removed">-                           *bytes_written = count;</span>
<span class="udiff-line-modified-added">+                           *bytes_written = count_unsigned;</span>
                          return G_IO_STATUS_NORMAL;
                        }
  
                      /* Working in partial_write_buf */
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2411,16 +2417,16 @@</span>
                        {
                          /* Didn&#39;t convert anything, must still have
                           * less than a full character
                           */
  
<span class="udiff-line-modified-removed">-                         g_assert (count == from_buf_len - from_buf_old_len);</span>
<span class="udiff-line-modified-added">+                         g_assert (count_unsigned == from_buf_len - from_buf_old_len);</span>
  
                          channel-&gt;partial_write_buf[from_buf_len] = &#39;\0&#39;;
  
                          if (bytes_written)
<span class="udiff-line-modified-removed">-                           *bytes_written = count;</span>
<span class="udiff-line-modified-added">+                           *bytes_written = count_unsigned;</span>
  
                          return G_IO_STATUS_NORMAL;
                        }
  
                      g_assert (from_buf_len - left_len &gt;= from_buf_old_len);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2478,11 +2484,11 @@</span>
              buf = from_buf;
          }
      }
  
    if (bytes_written)
<span class="udiff-line-modified-removed">-     *bytes_written = count;</span>
<span class="udiff-line-modified-added">+     *bytes_written = count_unsigned;</span>
  
    return G_IO_STATUS_NORMAL;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2497,21 +2503,21 @@</span>
   *
   * Returns: a #GIOStatus
   **/
  GIOStatus
  g_io_channel_write_unichar (GIOChannel  *channel,
<span class="udiff-line-modified-removed">-                 gunichar     thechar,</span>
<span class="udiff-line-modified-removed">-                 GError     **error)</span>
<span class="udiff-line-modified-added">+           gunichar     thechar,</span>
<span class="udiff-line-modified-added">+           GError     **error)</span>
  {
    GIOStatus status;
    gchar static_buf[6];
    gsize char_len, wrote_len;
  
    g_return_val_if_fail (channel != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail (channel-&gt;encoding != NULL, G_IO_STATUS_ERROR);
    g_return_val_if_fail ((error == NULL) || (*error == NULL),
<span class="udiff-line-modified-removed">-             G_IO_STATUS_ERROR);</span>
<span class="udiff-line-modified-added">+       G_IO_STATUS_ERROR);</span>
    g_return_val_if_fail (channel-&gt;is_writeable, G_IO_STATUS_ERROR);
  
    char_len = g_unichar_to_utf8 (thechar, static_buf);
  
    if (channel-&gt;partial_write_buf[0] != &#39;\0&#39;)
</pre>
<center><a href="ghostutils.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="giochannel.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>