<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gscanner.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gregex.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gscanner.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gscanner.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 273,111 ***</span>
   * be changed during the parsing phase and will affect the lexical
   * parsing of the next unpeeked token.
   */
  
  /* --- defines --- */
<span class="line-modified">! #define to_lower(c)             ( \</span>
<span class="line-modified">!     (guchar) (                          \</span>
<span class="line-modified">!       ( (((guchar)(c))&gt;=&#39;A&#39; &amp;&amp; ((guchar)(c))&lt;=&#39;Z&#39;) * (&#39;a&#39;-&#39;A&#39;) ) |  \</span>
<span class="line-modified">!       ( (((guchar)(c))&gt;=192 &amp;&amp; ((guchar)(c))&lt;=214) * (224-192) ) |  \</span>
<span class="line-modified">!       ( (((guchar)(c))&gt;=216 &amp;&amp; ((guchar)(c))&lt;=222) * (248-216) ) |  \</span>
<span class="line-modified">!       ((guchar)(c))                         \</span>
<span class="line-modified">!     )                               \</span>
  )
<span class="line-modified">! #define READ_BUFFER_SIZE    (4000)</span>
  
  
  /* --- typedefs --- */
<span class="line-modified">! typedef struct  _GScannerKey    GScannerKey;</span>
  
  struct  _GScannerKey
  {
<span class="line-modified">!   guint      scope_id;</span>
<span class="line-modified">!   gchar     *symbol;</span>
    gpointer   value;
  };
  
  
  /* --- variables --- */
  static const GScannerConfig g_scanner_config_template =
  {
    (
     &quot; \t\r\n&quot;
<span class="line-modified">!    )            /* cset_skip_characters */,</span>
    (
     G_CSET_a_2_z
     &quot;_&quot;
     G_CSET_A_2_Z
<span class="line-modified">!    )            /* cset_identifier_first */,</span>
    (
     G_CSET_a_2_z
     &quot;_&quot;
     G_CSET_A_2_Z
     G_CSET_DIGITS
     G_CSET_LATINS
     G_CSET_LATINC
<span class="line-modified">!    )            /* cset_identifier_nth */,</span>
<span class="line-modified">!   ( &quot;#\n&quot; )     /* cpair_comment_single */,</span>
<span class="line-modified">! </span>
<span class="line-modified">!   FALSE         /* case_sensitive */,</span>
<span class="line-modified">! </span>
<span class="line-modified">!   TRUE          /* skip_comment_multi */,</span>
<span class="line-modified">!   TRUE          /* skip_comment_single */,</span>
<span class="line-modified">!   TRUE          /* scan_comment_multi */,</span>
<span class="line-modified">!   TRUE          /* scan_identifier */,</span>
<span class="line-modified">!   FALSE         /* scan_identifier_1char */,</span>
<span class="line-modified">!   FALSE         /* scan_identifier_NULL */,</span>
<span class="line-modified">!   TRUE          /* scan_symbols */,</span>
<span class="line-modified">!   FALSE         /* scan_binary */,</span>
<span class="line-modified">!   TRUE          /* scan_octal */,</span>
<span class="line-modified">!   TRUE          /* scan_float */,</span>
<span class="line-modified">!   TRUE          /* scan_hex */,</span>
<span class="line-modified">!   FALSE         /* scan_hex_dollar */,</span>
<span class="line-modified">!   TRUE          /* scan_string_sq */,</span>
<span class="line-modified">!   TRUE          /* scan_string_dq */,</span>
<span class="line-modified">!   TRUE          /* numbers_2_int */,</span>
<span class="line-modified">!   FALSE         /* int_2_float */,</span>
<span class="line-modified">!   FALSE         /* identifier_2_string */,</span>
<span class="line-modified">!   TRUE          /* char_2_token */,</span>
<span class="line-modified">!   FALSE         /* symbol_2_token */,</span>
<span class="line-modified">!   FALSE         /* scope_0_fallback */,</span>
<span class="line-modified">!   FALSE         /* store_int64 */,</span>
  };
  
  
  /* --- prototypes --- */
  static inline
<span class="line-modified">! GScannerKey*    g_scanner_lookup_internal (GScanner *scanner,</span>
<span class="line-modified">!                        guint     scope_id,</span>
<span class="line-modified">!                        const gchar  *symbol);</span>
  static gboolean g_scanner_key_equal   (gconstpointer v1,
<span class="line-modified">!                        gconstpointer v2);</span>
<span class="line-modified">! static guint    g_scanner_key_hash    (gconstpointer v);</span>
  static void g_scanner_get_token_ll    (GScanner *scanner,
<span class="line-modified">!                        GTokenType   *token_p,</span>
<span class="line-modified">!                        GTokenValue  *value_p,</span>
<span class="line-modified">!                        guint    *line_p,</span>
<span class="line-modified">!                        guint    *position_p);</span>
<span class="line-modified">! static void g_scanner_get_token_i     (GScanner *scanner,</span>
<span class="line-modified">!                        GTokenType   *token_p,</span>
<span class="line-modified">!                        GTokenValue  *value_p,</span>
<span class="line-modified">!                        guint    *line_p,</span>
<span class="line-modified">!                        guint    *position_p);</span>
<span class="line-modified">! </span>
<span class="line-modified">! static guchar   g_scanner_peek_next_char  (GScanner *scanner);</span>
<span class="line-modified">! static guchar   g_scanner_get_char    (GScanner *scanner,</span>
<span class="line-modified">!                        guint    *line_p,</span>
<span class="line-modified">!                        guint    *position_p);</span>
<span class="line-modified">! static void g_scanner_msg_handler     (GScanner *scanner,</span>
<span class="line-modified">!                        gchar    *message,</span>
<span class="line-modified">!                        gboolean  is_error);</span>
  
  
  /* --- functions --- */
  static inline gint
<span class="line-modified">! g_scanner_char_2_num (guchar    c,</span>
<span class="line-modified">!               guchar    base)</span>
  {
    if (c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;)
      c -= &#39;0&#39;;
    else if (c &gt;= &#39;A&#39; &amp;&amp; c &lt;= &#39;Z&#39;)
      c -= &#39;A&#39; - 10;
<span class="line-new-header">--- 273,112 ---</span>
   * be changed during the parsing phase and will affect the lexical
   * parsing of the next unpeeked token.
   */
  
  /* --- defines --- */
<span class="line-modified">! #define to_lower(c)       ( \</span>
<span class="line-modified">!   (guchar) (              \</span>
<span class="line-modified">!     ( (((guchar)(c))&gt;=&#39;A&#39; &amp;&amp; ((guchar)(c))&lt;=&#39;Z&#39;) * (&#39;a&#39;-&#39;A&#39;) ) |  \</span>
<span class="line-modified">!     ( (((guchar)(c))&gt;=192 &amp;&amp; ((guchar)(c))&lt;=214) * (224-192) ) |  \</span>
<span class="line-modified">!     ( (((guchar)(c))&gt;=216 &amp;&amp; ((guchar)(c))&lt;=222) * (248-216) ) |  \</span>
<span class="line-modified">!     ((guchar)(c))             \</span>
<span class="line-modified">!   )               \</span>
  )
<span class="line-modified">! #define READ_BUFFER_SIZE  (4000)</span>
  
  
  /* --- typedefs --- */
<span class="line-modified">! typedef struct  _GScannerKey  GScannerKey;</span>
  
  struct  _GScannerKey
  {
<span class="line-modified">!   guint    scope_id;</span>
<span class="line-modified">!   gchar   *symbol;</span>
    gpointer   value;
  };
  
  
  /* --- variables --- */
  static const GScannerConfig g_scanner_config_template =
  {
    (
     &quot; \t\r\n&quot;
<span class="line-modified">!    )      /* cset_skip_characters */,</span>
    (
     G_CSET_a_2_z
     &quot;_&quot;
     G_CSET_A_2_Z
<span class="line-modified">!    )      /* cset_identifier_first */,</span>
    (
     G_CSET_a_2_z
     &quot;_&quot;
     G_CSET_A_2_Z
     G_CSET_DIGITS
     G_CSET_LATINS
     G_CSET_LATINC
<span class="line-modified">!    )      /* cset_identifier_nth */,</span>
<span class="line-modified">!   ( &quot;#\n&quot; )   /* cpair_comment_single */,</span>
<span class="line-modified">! </span>
<span class="line-modified">!   FALSE     /* case_sensitive */,</span>
<span class="line-modified">! </span>
<span class="line-modified">!   TRUE      /* skip_comment_multi */,</span>
<span class="line-modified">!   TRUE      /* skip_comment_single */,</span>
<span class="line-modified">!   TRUE      /* scan_comment_multi */,</span>
<span class="line-modified">!   TRUE      /* scan_identifier */,</span>
<span class="line-modified">!   FALSE     /* scan_identifier_1char */,</span>
<span class="line-modified">!   FALSE     /* scan_identifier_NULL */,</span>
<span class="line-modified">!   TRUE      /* scan_symbols */,</span>
<span class="line-modified">!   FALSE     /* scan_binary */,</span>
<span class="line-modified">!   TRUE      /* scan_octal */,</span>
<span class="line-modified">!   TRUE      /* scan_float */,</span>
<span class="line-modified">!   TRUE      /* scan_hex */,</span>
<span class="line-modified">!   FALSE     /* scan_hex_dollar */,</span>
<span class="line-modified">!   TRUE      /* scan_string_sq */,</span>
<span class="line-modified">!   TRUE      /* scan_string_dq */,</span>
<span class="line-modified">!   TRUE      /* numbers_2_int */,</span>
<span class="line-modified">!   FALSE     /* int_2_float */,</span>
<span class="line-modified">!   FALSE     /* identifier_2_string */,</span>
<span class="line-modified">!   TRUE      /* char_2_token */,</span>
<span class="line-modified">!   FALSE     /* symbol_2_token */,</span>
<span class="line-modified">!   FALSE     /* scope_0_fallback */,</span>
<span class="line-modified">!   FALSE     /* store_int64 */,</span>
<span class="line-added">+   0         /* padding_dummy */</span>
  };
  
  
  /* --- prototypes --- */
  static inline
<span class="line-modified">! GScannerKey*  g_scanner_lookup_internal (GScanner *scanner,</span>
<span class="line-modified">!              guint   scope_id,</span>
<span class="line-modified">!              const gchar  *symbol);</span>
  static gboolean g_scanner_key_equal   (gconstpointer v1,
<span class="line-modified">!              gconstpointer v2);</span>
<span class="line-modified">! static guint  g_scanner_key_hash    (gconstpointer v);</span>
  static void g_scanner_get_token_ll    (GScanner *scanner,
<span class="line-modified">!              GTokenType *token_p,</span>
<span class="line-modified">!              GTokenValue  *value_p,</span>
<span class="line-modified">!              guint  *line_p,</span>
<span class="line-modified">!              guint  *position_p);</span>
<span class="line-modified">! static void g_scanner_get_token_i   (GScanner *scanner,</span>
<span class="line-modified">!              GTokenType *token_p,</span>
<span class="line-modified">!              GTokenValue  *value_p,</span>
<span class="line-modified">!              guint  *line_p,</span>
<span class="line-modified">!              guint  *position_p);</span>
<span class="line-modified">! </span>
<span class="line-modified">! static guchar g_scanner_peek_next_char  (GScanner *scanner);</span>
<span class="line-modified">! static guchar g_scanner_get_char    (GScanner *scanner,</span>
<span class="line-modified">!              guint  *line_p,</span>
<span class="line-modified">!              guint  *position_p);</span>
<span class="line-modified">! static void g_scanner_msg_handler   (GScanner *scanner,</span>
<span class="line-modified">!              gchar  *message,</span>
<span class="line-modified">!              gboolean  is_error);</span>
  
  
  /* --- functions --- */
  static inline gint
<span class="line-modified">! g_scanner_char_2_num (guchar  c,</span>
<span class="line-modified">!           guchar  base)</span>
  {
    if (c &gt;= &#39;0&#39; &amp;&amp; c &lt;= &#39;9&#39;)
      c -= &#39;0&#39;;
    else if (c &gt;= &#39;A&#39; &amp;&amp; c &lt;= &#39;Z&#39;)
      c -= &#39;A&#39; - 10;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 421,38 ***</span>
    scanner-&gt;input_name = NULL;
    g_datalist_init (&amp;scanner-&gt;qdata);
  
    scanner-&gt;config = g_new0 (GScannerConfig, 1);
  
<span class="line-modified">!   scanner-&gt;config-&gt;case_sensitive    = config_templ-&gt;case_sensitive;</span>
    scanner-&gt;config-&gt;cset_skip_characters  = config_templ-&gt;cset_skip_characters;
    if (!scanner-&gt;config-&gt;cset_skip_characters)
      scanner-&gt;config-&gt;cset_skip_characters = &quot;&quot;;
    scanner-&gt;config-&gt;cset_identifier_first = config_templ-&gt;cset_identifier_first;
    scanner-&gt;config-&gt;cset_identifier_nth   = config_templ-&gt;cset_identifier_nth;
    scanner-&gt;config-&gt;cpair_comment_single  = config_templ-&gt;cpair_comment_single;
<span class="line-modified">!   scanner-&gt;config-&gt;skip_comment_multi    = config_templ-&gt;skip_comment_multi;</span>
    scanner-&gt;config-&gt;skip_comment_single   = config_templ-&gt;skip_comment_single;
<span class="line-modified">!   scanner-&gt;config-&gt;scan_comment_multi    = config_templ-&gt;scan_comment_multi;</span>
    scanner-&gt;config-&gt;scan_identifier   = config_templ-&gt;scan_identifier;
    scanner-&gt;config-&gt;scan_identifier_1char = config_templ-&gt;scan_identifier_1char;
    scanner-&gt;config-&gt;scan_identifier_NULL  = config_templ-&gt;scan_identifier_NULL;
<span class="line-modified">!   scanner-&gt;config-&gt;scan_symbols      = config_templ-&gt;scan_symbols;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_binary       = config_templ-&gt;scan_binary;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_octal        = config_templ-&gt;scan_octal;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_float        = config_templ-&gt;scan_float;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_hex      = config_templ-&gt;scan_hex;</span>
    scanner-&gt;config-&gt;scan_hex_dollar   = config_templ-&gt;scan_hex_dollar;
<span class="line-modified">!   scanner-&gt;config-&gt;scan_string_sq    = config_templ-&gt;scan_string_sq;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_string_dq    = config_templ-&gt;scan_string_dq;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;numbers_2_int     = config_templ-&gt;numbers_2_int;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;int_2_float       = config_templ-&gt;int_2_float;</span>
    scanner-&gt;config-&gt;identifier_2_string   = config_templ-&gt;identifier_2_string;
<span class="line-modified">!   scanner-&gt;config-&gt;char_2_token      = config_templ-&gt;char_2_token;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;symbol_2_token    = config_templ-&gt;symbol_2_token;</span>
    scanner-&gt;config-&gt;scope_0_fallback  = config_templ-&gt;scope_0_fallback;
<span class="line-modified">!   scanner-&gt;config-&gt;store_int64       = config_templ-&gt;store_int64;</span>
  
    scanner-&gt;token = G_TOKEN_NONE;
    scanner-&gt;value.v_int64 = 0;
    scanner-&gt;line = 1;
    scanner-&gt;position = 0;
<span class="line-new-header">--- 422,38 ---</span>
    scanner-&gt;input_name = NULL;
    g_datalist_init (&amp;scanner-&gt;qdata);
  
    scanner-&gt;config = g_new0 (GScannerConfig, 1);
  
<span class="line-modified">!   scanner-&gt;config-&gt;case_sensitive  = config_templ-&gt;case_sensitive;</span>
    scanner-&gt;config-&gt;cset_skip_characters  = config_templ-&gt;cset_skip_characters;
    if (!scanner-&gt;config-&gt;cset_skip_characters)
      scanner-&gt;config-&gt;cset_skip_characters = &quot;&quot;;
    scanner-&gt;config-&gt;cset_identifier_first = config_templ-&gt;cset_identifier_first;
    scanner-&gt;config-&gt;cset_identifier_nth   = config_templ-&gt;cset_identifier_nth;
    scanner-&gt;config-&gt;cpair_comment_single  = config_templ-&gt;cpair_comment_single;
<span class="line-modified">!   scanner-&gt;config-&gt;skip_comment_multi  = config_templ-&gt;skip_comment_multi;</span>
    scanner-&gt;config-&gt;skip_comment_single   = config_templ-&gt;skip_comment_single;
<span class="line-modified">!   scanner-&gt;config-&gt;scan_comment_multi  = config_templ-&gt;scan_comment_multi;</span>
    scanner-&gt;config-&gt;scan_identifier   = config_templ-&gt;scan_identifier;
    scanner-&gt;config-&gt;scan_identifier_1char = config_templ-&gt;scan_identifier_1char;
    scanner-&gt;config-&gt;scan_identifier_NULL  = config_templ-&gt;scan_identifier_NULL;
<span class="line-modified">!   scanner-&gt;config-&gt;scan_symbols    = config_templ-&gt;scan_symbols;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_binary     = config_templ-&gt;scan_binary;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_octal    = config_templ-&gt;scan_octal;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_float    = config_templ-&gt;scan_float;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_hex    = config_templ-&gt;scan_hex;</span>
    scanner-&gt;config-&gt;scan_hex_dollar   = config_templ-&gt;scan_hex_dollar;
<span class="line-modified">!   scanner-&gt;config-&gt;scan_string_sq  = config_templ-&gt;scan_string_sq;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;scan_string_dq  = config_templ-&gt;scan_string_dq;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;numbers_2_int   = config_templ-&gt;numbers_2_int;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;int_2_float     = config_templ-&gt;int_2_float;</span>
    scanner-&gt;config-&gt;identifier_2_string   = config_templ-&gt;identifier_2_string;
<span class="line-modified">!   scanner-&gt;config-&gt;char_2_token    = config_templ-&gt;char_2_token;</span>
<span class="line-modified">!   scanner-&gt;config-&gt;symbol_2_token  = config_templ-&gt;symbol_2_token;</span>
    scanner-&gt;config-&gt;scope_0_fallback  = config_templ-&gt;scope_0_fallback;
<span class="line-modified">!   scanner-&gt;config-&gt;store_int64     = config_templ-&gt;store_int64;</span>
  
    scanner-&gt;token = G_TOKEN_NONE;
    scanner-&gt;value.v_int64 = 0;
    scanner-&gt;line = 1;
    scanner-&gt;position = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 474,11 ***</span>
    return scanner;
  }
  
  static inline void
  g_scanner_free_value (GTokenType     *token_p,
<span class="line-modified">!               GTokenValue     *value_p)</span>
  {
    switch (*token_p)
      {
      case G_TOKEN_STRING:
      case G_TOKEN_IDENTIFIER:
<span class="line-new-header">--- 475,11 ---</span>
    return scanner;
  }
  
  static inline void
  g_scanner_free_value (GTokenType     *token_p,
<span class="line-modified">!           GTokenValue     *value_p)</span>
  {
    switch (*token_p)
      {
      case G_TOKEN_STRING:
      case G_TOKEN_IDENTIFIER:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 495,12 ***</span>
    *token_p = G_TOKEN_NONE;
  }
  
  static void
  g_scanner_destroy_symbol_table_entry (gpointer _key,
<span class="line-modified">!                       gpointer _value,</span>
<span class="line-modified">!                       gpointer _data)</span>
  {
    GScannerKey *key = _key;
  
    g_free (key-&gt;symbol);
    g_free (key);
<span class="line-new-header">--- 496,12 ---</span>
    *token_p = G_TOKEN_NONE;
  }
  
  static void
  g_scanner_destroy_symbol_table_entry (gpointer _key,
<span class="line-modified">!               gpointer _value,</span>
<span class="line-modified">!               gpointer _data)</span>
  {
    GScannerKey *key = _key;
  
    g_free (key-&gt;symbol);
    g_free (key);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 517,29 ***</span>
  {
    g_return_if_fail (scanner != NULL);
  
    g_datalist_clear (&amp;scanner-&gt;qdata);
    g_hash_table_foreach (scanner-&gt;symbol_table,
<span class="line-modified">!             g_scanner_destroy_symbol_table_entry, NULL);</span>
    g_hash_table_destroy (scanner-&gt;symbol_table);
    g_scanner_free_value (&amp;scanner-&gt;token, &amp;scanner-&gt;value);
    g_scanner_free_value (&amp;scanner-&gt;next_token, &amp;scanner-&gt;next_value);
    g_free (scanner-&gt;config);
    g_free (scanner-&gt;buffer);
    g_free (scanner);
  }
  
  static void
<span class="line-modified">! g_scanner_msg_handler (GScanner     *scanner,</span>
<span class="line-modified">!                gchar        *message,</span>
<span class="line-modified">!                gboolean     is_error)</span>
  {
    g_return_if_fail (scanner != NULL);
  
    _g_fprintf (stderr, &quot;%s:%d: &quot;,
<span class="line-modified">!           scanner-&gt;input_name ? scanner-&gt;input_name : &quot;&lt;memory&gt;&quot;,</span>
<span class="line-modified">!           scanner-&gt;line);</span>
    if (is_error)
      _g_fprintf (stderr, &quot;error: &quot;);
    _g_fprintf (stderr, &quot;%s\n&quot;, message);
  }
  
<span class="line-new-header">--- 518,29 ---</span>
  {
    g_return_if_fail (scanner != NULL);
  
    g_datalist_clear (&amp;scanner-&gt;qdata);
    g_hash_table_foreach (scanner-&gt;symbol_table,
<span class="line-modified">!       g_scanner_destroy_symbol_table_entry, NULL);</span>
    g_hash_table_destroy (scanner-&gt;symbol_table);
    g_scanner_free_value (&amp;scanner-&gt;token, &amp;scanner-&gt;value);
    g_scanner_free_value (&amp;scanner-&gt;next_token, &amp;scanner-&gt;next_value);
    g_free (scanner-&gt;config);
    g_free (scanner-&gt;buffer);
    g_free (scanner);
  }
  
  static void
<span class="line-modified">! g_scanner_msg_handler (GScanner   *scanner,</span>
<span class="line-modified">!            gchar    *message,</span>
<span class="line-modified">!            gboolean   is_error)</span>
  {
    g_return_if_fail (scanner != NULL);
  
    _g_fprintf (stderr, &quot;%s:%d: &quot;,
<span class="line-modified">!         scanner-&gt;input_name ? scanner-&gt;input_name : &quot;&lt;memory&gt;&quot;,</span>
<span class="line-modified">!         scanner-&gt;line);</span>
    if (is_error)
      _g_fprintf (stderr, &quot;error: &quot;);
    _g_fprintf (stderr, &quot;%s\n&quot;, message);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 550,13 ***</span>
   * @...: the parameters to insert into the format string
   *
   * Outputs an error message, via the #GScanner message handler.
   */
  void
<span class="line-modified">! g_scanner_error (GScanner   *scanner,</span>
<span class="line-modified">!          const gchar    *format,</span>
<span class="line-modified">!                  ...)</span>
  {
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (format != NULL);
  
    scanner-&gt;parse_errors++;
<span class="line-new-header">--- 551,13 ---</span>
   * @...: the parameters to insert into the format string
   *
   * Outputs an error message, via the #GScanner message handler.
   */
  void
<span class="line-modified">! g_scanner_error (GScanner *scanner,</span>
<span class="line-modified">!      const gchar  *format,</span>
<span class="line-modified">!      ...)</span>
  {
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (format != NULL);
  
    scanner-&gt;parse_errors++;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 584,12 ***</span>
   *
   * Outputs a warning message, via the #GScanner message handler.
   */
  void
  g_scanner_warn (GScanner       *scanner,
<span class="line-modified">!         const gchar    *format,</span>
<span class="line-modified">!         ...)</span>
  {
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (format != NULL);
  
    if (scanner-&gt;msg_handler)
<span class="line-new-header">--- 585,12 ---</span>
   *
   * Outputs a warning message, via the #GScanner message handler.
   */
  void
  g_scanner_warn (GScanner       *scanner,
<span class="line-modified">!     const gchar    *format,</span>
<span class="line-modified">!     ...)</span>
  {
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (format != NULL);
  
    if (scanner-&gt;msg_handler)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 607,11 ***</span>
      }
  }
  
  static gboolean
  g_scanner_key_equal (gconstpointer v1,
<span class="line-modified">!              gconstpointer v2)</span>
  {
    const GScannerKey *key1 = v1;
    const GScannerKey *key2 = v2;
  
    return (key1-&gt;scope_id == key2-&gt;scope_id) &amp;&amp; (strcmp (key1-&gt;symbol, key2-&gt;symbol) == 0);
<span class="line-new-header">--- 608,11 ---</span>
      }
  }
  
  static gboolean
  g_scanner_key_equal (gconstpointer v1,
<span class="line-modified">!          gconstpointer v2)</span>
  {
    const GScannerKey *key1 = v1;
    const GScannerKey *key2 = v2;
  
    return (key1-&gt;scope_id == key2-&gt;scope_id) &amp;&amp; (strcmp (key1-&gt;symbol, key2-&gt;symbol) == 0);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 631,14 ***</span>
    return h;
  }
  
  static inline GScannerKey*
  g_scanner_lookup_internal (GScanner *scanner,
<span class="line-modified">!                guint     scope_id,</span>
<span class="line-modified">!                const gchar  *symbol)</span>
  {
<span class="line-modified">!   GScannerKey   *key_p;</span>
    GScannerKey key;
  
    key.scope_id = scope_id;
  
    if (!scanner-&gt;config-&gt;case_sensitive)
<span class="line-new-header">--- 632,14 ---</span>
    return h;
  }
  
  static inline GScannerKey*
  g_scanner_lookup_internal (GScanner *scanner,
<span class="line-modified">!          guint   scope_id,</span>
<span class="line-modified">!          const gchar  *symbol)</span>
  {
<span class="line-modified">!   GScannerKey *key_p;</span>
    GScannerKey key;
  
    key.scope_id = scope_id;
  
    if (!scanner-&gt;config-&gt;case_sensitive)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 646,11 ***</span>
        gchar *d;
        const gchar *c;
  
        key.symbol = g_new (gchar, strlen (symbol) + 1);
        for (d = key.symbol, c = symbol; *c; c++, d++)
<span class="line-modified">!     *d = to_lower (*c);</span>
        *d = 0;
        key_p = g_hash_table_lookup (scanner-&gt;symbol_table, &amp;key);
        g_free (key.symbol);
      }
    else
<span class="line-new-header">--- 647,11 ---</span>
        gchar *d;
        const gchar *c;
  
        key.symbol = g_new (gchar, strlen (symbol) + 1);
        for (d = key.symbol, c = symbol; *c; c++, d++)
<span class="line-modified">!   *d = to_lower (*c);</span>
        *d = 0;
        key_p = g_hash_table_lookup (scanner-&gt;symbol_table, &amp;key);
        g_free (key.symbol);
      }
    else
</pre>
<hr />
<pre>
<span class="line-old-header">*** 681,16 ***</span>
   * @value: the value of the symbol
   *
   * Adds a symbol to the given scope.
   */
  void
<span class="line-modified">! g_scanner_scope_add_symbol (GScanner    *scanner,</span>
<span class="line-modified">!                 guint    scope_id,</span>
<span class="line-modified">!                 const gchar *symbol,</span>
<span class="line-modified">!                 gpointer     value)</span>
  {
<span class="line-modified">!   GScannerKey   *key;</span>
  
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (symbol != NULL);
  
    key = g_scanner_lookup_internal (scanner, scope_id, symbol);
<span class="line-new-header">--- 682,16 ---</span>
   * @value: the value of the symbol
   *
   * Adds a symbol to the given scope.
   */
  void
<span class="line-modified">! g_scanner_scope_add_symbol (GScanner  *scanner,</span>
<span class="line-modified">!           guint  scope_id,</span>
<span class="line-modified">!           const gchar *symbol,</span>
<span class="line-modified">!           gpointer   value)</span>
  {
<span class="line-modified">!   GScannerKey *key;</span>
  
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (symbol != NULL);
  
    key = g_scanner_lookup_internal (scanner, scope_id, symbol);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 700,20 ***</span>
        key = g_new (GScannerKey, 1);
        key-&gt;scope_id = scope_id;
        key-&gt;symbol = g_strdup (symbol);
        key-&gt;value = value;
        if (!scanner-&gt;config-&gt;case_sensitive)
<span class="line-modified">!     {</span>
<span class="line-modified">!       gchar *c;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       c = key-&gt;symbol;</span>
<span class="line-modified">!       while (*c != 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *c = to_lower (*c);</span>
<span class="line-modified">!           c++;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
        g_hash_table_add (scanner-&gt;symbol_table, key);
      }
    else
      key-&gt;value = value;
  }
<span class="line-new-header">--- 701,20 ---</span>
        key = g_new (GScannerKey, 1);
        key-&gt;scope_id = scope_id;
        key-&gt;symbol = g_strdup (symbol);
        key-&gt;value = value;
        if (!scanner-&gt;config-&gt;case_sensitive)
<span class="line-modified">!   {</span>
<span class="line-modified">!     gchar *c;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     c = key-&gt;symbol;</span>
<span class="line-modified">!     while (*c != 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *c = to_lower (*c);</span>
<span class="line-modified">!         c++;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!   }</span>
        g_hash_table_add (scanner-&gt;symbol_table, key);
      }
    else
      key-&gt;value = value;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 736,14 ***</span>
   *
   * Removes a symbol from a scope.
   */
  void
  g_scanner_scope_remove_symbol (GScanner    *scanner,
<span class="line-modified">!                    guint        scope_id,</span>
<span class="line-modified">!                                const gchar *symbol)</span>
  {
<span class="line-modified">!   GScannerKey   *key;</span>
  
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (symbol != NULL);
  
    key = g_scanner_lookup_internal (scanner, scope_id, symbol);
<span class="line-new-header">--- 737,14 ---</span>
   *
   * Removes a symbol from a scope.
   */
  void
  g_scanner_scope_remove_symbol (GScanner    *scanner,
<span class="line-modified">!              guint      scope_id,</span>
<span class="line-modified">!              const gchar *symbol)</span>
  {
<span class="line-modified">!   GScannerKey *key;</span>
  
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (symbol != NULL);
  
    key = g_scanner_lookup_internal (scanner, scope_id, symbol);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 785,14 ***</span>
   *
   * Returns: the value of @symbol in the current scope, or %NULL
   *     if @symbol is not bound in the current scope
   */
  gpointer
<span class="line-modified">! g_scanner_lookup_symbol (GScanner   *scanner,</span>
<span class="line-modified">!              const gchar    *symbol)</span>
  {
<span class="line-modified">!   GScannerKey   *key;</span>
    guint scope_id;
  
    g_return_val_if_fail (scanner != NULL, NULL);
  
    if (!symbol)
<span class="line-new-header">--- 786,14 ---</span>
   *
   * Returns: the value of @symbol in the current scope, or %NULL
   *     if @symbol is not bound in the current scope
   */
  gpointer
<span class="line-modified">! g_scanner_lookup_symbol (GScanner *scanner,</span>
<span class="line-modified">!        const gchar  *symbol)</span>
  {
<span class="line-modified">!   GScannerKey *key;</span>
    guint scope_id;
  
    g_return_val_if_fail (scanner != NULL, NULL);
  
    if (!symbol)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 822,14 ***</span>
   *     if @symbol is not bound in the given scope.
   *
   */
  gpointer
  g_scanner_scope_lookup_symbol (GScanner       *scanner,
<span class="line-modified">!                    guint           scope_id,</span>
<span class="line-modified">!                                const gchar    *symbol)</span>
  {
<span class="line-modified">!   GScannerKey   *key;</span>
  
    g_return_val_if_fail (scanner != NULL, NULL);
  
    if (!symbol)
      return NULL;
<span class="line-new-header">--- 823,14 ---</span>
   *     if @symbol is not bound in the given scope.
   *
   */
  gpointer
  g_scanner_scope_lookup_symbol (GScanner       *scanner,
<span class="line-modified">!              guint         scope_id,</span>
<span class="line-modified">!              const gchar    *symbol)</span>
  {
<span class="line-modified">!   GScannerKey *key;</span>
  
    g_return_val_if_fail (scanner != NULL, NULL);
  
    if (!symbol)
      return NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 850,12 ***</span>
   * Sets the current scope.
   *
   * Returns: the old scope id
   */
  guint
<span class="line-modified">! g_scanner_set_scope (GScanner       *scanner,</span>
<span class="line-modified">!              guint       scope_id)</span>
  {
    guint old_scope_id;
  
    g_return_val_if_fail (scanner != NULL, 0);
  
<span class="line-new-header">--- 851,12 ---</span>
   * Sets the current scope.
   *
   * Returns: the old scope id
   */
  guint
<span class="line-modified">! g_scanner_set_scope (GScanner     *scanner,</span>
<span class="line-modified">!          guint       scope_id)</span>
  {
    guint old_scope_id;
  
    g_return_val_if_fail (scanner != NULL, 0);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 865,12 ***</span>
    return old_scope_id;
  }
  
  static void
  g_scanner_foreach_internal (gpointer  _key,
<span class="line-modified">!                 gpointer  _value,</span>
<span class="line-modified">!                 gpointer  _user_data)</span>
  {
    GScannerKey *key;
    gpointer *d;
    GHFunc func;
    gpointer user_data;
<span class="line-new-header">--- 866,12 ---</span>
    return old_scope_id;
  }
  
  static void
  g_scanner_foreach_internal (gpointer  _key,
<span class="line-modified">!           gpointer  _value,</span>
<span class="line-modified">!           gpointer  _user_data)</span>
  {
    GScannerKey *key;
    gpointer *d;
    GHFunc func;
    gpointer user_data;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 909,13 ***</span>
   * the symbol and value of each pair, and the given @user_data
   * parameter.
   */
  void
  g_scanner_scope_foreach_symbol (GScanner       *scanner,
<span class="line-modified">!                 guint       scope_id,</span>
<span class="line-modified">!                 GHFunc      func,</span>
<span class="line-modified">!                 gpointer    user_data)</span>
  {
    gpointer d[3];
  
    g_return_if_fail (scanner != NULL);
  
<span class="line-new-header">--- 910,13 ---</span>
   * the symbol and value of each pair, and the given @user_data
   * parameter.
   */
  void
  g_scanner_scope_foreach_symbol (GScanner       *scanner,
<span class="line-modified">!         guint   scope_id,</span>
<span class="line-modified">!         GHFunc    func,</span>
<span class="line-modified">!         gpointer  user_data)</span>
  {
    gpointer d[3];
  
    g_return_if_fail (scanner != NULL);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 952,14 ***</span>
    if (scanner-&gt;next_token == G_TOKEN_NONE)
      {
        scanner-&gt;next_line = scanner-&gt;line;
        scanner-&gt;next_position = scanner-&gt;position;
        g_scanner_get_token_i (scanner,
<span class="line-modified">!                  &amp;scanner-&gt;next_token,</span>
<span class="line-modified">!                  &amp;scanner-&gt;next_value,</span>
<span class="line-modified">!                  &amp;scanner-&gt;next_line,</span>
<span class="line-modified">!                  &amp;scanner-&gt;next_position);</span>
      }
  
    return scanner-&gt;next_token;
  }
  
<span class="line-new-header">--- 953,14 ---</span>
    if (scanner-&gt;next_token == G_TOKEN_NONE)
      {
        scanner-&gt;next_line = scanner-&gt;line;
        scanner-&gt;next_position = scanner-&gt;position;
        g_scanner_get_token_i (scanner,
<span class="line-modified">!            &amp;scanner-&gt;next_token,</span>
<span class="line-modified">!            &amp;scanner-&gt;next_value,</span>
<span class="line-modified">!            &amp;scanner-&gt;next_line,</span>
<span class="line-modified">!            &amp;scanner-&gt;next_position);</span>
      }
  
    return scanner-&gt;next_token;
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 989,14 ***</span>
        scanner-&gt;position = scanner-&gt;next_position;
        scanner-&gt;next_token = G_TOKEN_NONE;
      }
    else
      g_scanner_get_token_i (scanner,
<span class="line-modified">!                &amp;scanner-&gt;token,</span>
<span class="line-modified">!                &amp;scanner-&gt;value,</span>
<span class="line-modified">!                &amp;scanner-&gt;line,</span>
<span class="line-modified">!                &amp;scanner-&gt;position);</span>
  
    return scanner-&gt;token;
  }
  
  /**
<span class="line-new-header">--- 990,14 ---</span>
        scanner-&gt;position = scanner-&gt;next_position;
        scanner-&gt;next_token = G_TOKEN_NONE;
      }
    else
      g_scanner_get_token_i (scanner,
<span class="line-modified">!          &amp;scanner-&gt;token,</span>
<span class="line-modified">!          &amp;scanner-&gt;value,</span>
<span class="line-modified">!          &amp;scanner-&gt;line,</span>
<span class="line-modified">!          &amp;scanner-&gt;position);</span>
  
    return scanner-&gt;token;
  }
  
  /**
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1102,11 ***</span>
   *
   * Prepares to scan a file.
   */
  void
  g_scanner_input_file (GScanner *scanner,
<span class="line-modified">!               gint  input_fd)</span>
  {
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (input_fd &gt;= 0);
  
    if (scanner-&gt;input_fd &gt;= 0)
<span class="line-new-header">--- 1103,11 ---</span>
   *
   * Prepares to scan a file.
   */
  void
  g_scanner_input_file (GScanner *scanner,
<span class="line-modified">!           gint  input_fd)</span>
  {
    g_return_if_fail (scanner != NULL);
    g_return_if_fail (input_fd &gt;= 0);
  
    if (scanner-&gt;input_fd &gt;= 0)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1134,12 ***</span>
   *
   * Prepares to scan a text buffer.
   */
  void
  g_scanner_input_text (GScanner    *scanner,
<span class="line-modified">!                       const gchar *text,</span>
<span class="line-modified">!               guint    text_len)</span>
  {
    g_return_if_fail (scanner != NULL);
    if (text_len)
      g_return_if_fail (text != NULL);
    else
<span class="line-new-header">--- 1135,12 ---</span>
   *
   * Prepares to scan a text buffer.
   */
  void
  g_scanner_input_text (GScanner    *scanner,
<span class="line-modified">!           const gchar *text,</span>
<span class="line-modified">!           guint    text_len)</span>
  {
    g_return_if_fail (scanner != NULL);
    if (text_len)
      g_return_if_fail (text != NULL);
    else
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1177,28 ***</span>
        gint count;
        gchar *buffer;
  
        buffer = scanner-&gt;buffer;
        do
<span class="line-modified">!     {</span>
<span class="line-modified">!       count = read (scanner-&gt;input_fd, buffer, READ_BUFFER_SIZE);</span>
<span class="line-modified">!     }</span>
        while (count == -1 &amp;&amp; (errno == EINTR || errno == EAGAIN));
  
        if (count &lt; 1)
<span class="line-modified">!     {</span>
<span class="line-modified">!       scanner-&gt;input_fd = -1;</span>
  
<span class="line-modified">!       return 0;</span>
<span class="line-modified">!     }</span>
        else
<span class="line-modified">!     {</span>
<span class="line-modified">!       scanner-&gt;text = buffer;</span>
<span class="line-modified">!       scanner-&gt;text_end = buffer + count;</span>
  
<span class="line-modified">!       return *buffer;</span>
<span class="line-modified">!     }</span>
      }
    else
      return 0;
  }
  
<span class="line-new-header">--- 1178,28 ---</span>
        gint count;
        gchar *buffer;
  
        buffer = scanner-&gt;buffer;
        do
<span class="line-modified">!   {</span>
<span class="line-modified">!     count = read (scanner-&gt;input_fd, buffer, READ_BUFFER_SIZE);</span>
<span class="line-modified">!   }</span>
        while (count == -1 &amp;&amp; (errno == EINTR || errno == EAGAIN));
  
        if (count &lt; 1)
<span class="line-modified">!   {</span>
<span class="line-modified">!     scanner-&gt;input_fd = -1;</span>
  
<span class="line-modified">!     return 0;</span>
<span class="line-modified">!   }</span>
        else
<span class="line-modified">!   {</span>
<span class="line-modified">!     scanner-&gt;text = buffer;</span>
<span class="line-modified">!     scanner-&gt;text_end = buffer + count;</span>
  
<span class="line-modified">!     return *buffer;</span>
<span class="line-modified">!   }</span>
      }
    else
      return 0;
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1226,24 ***</span>
      {
        gint buffered;
  
        buffered = scanner-&gt;text_end - scanner-&gt;text;
        if (lseek (scanner-&gt;input_fd, - buffered, SEEK_CUR) &gt;= 0)
<span class="line-modified">!     {</span>
<span class="line-modified">!       /* we succeeded, blow our buffer&#39;s contents now */</span>
<span class="line-modified">!       scanner-&gt;text = NULL;</span>
<span class="line-modified">!       scanner-&gt;text_end = NULL;</span>
<span class="line-modified">!     }</span>
        else
<span class="line-modified">!     errno = 0;</span>
      }
  }
  
  static guchar
<span class="line-modified">! g_scanner_get_char (GScanner    *scanner,</span>
<span class="line-modified">!             guint   *line_p,</span>
<span class="line-modified">!             guint   *position_p)</span>
  {
    guchar fchar;
  
    if (scanner-&gt;text &lt; scanner-&gt;text_end)
      fchar = *(scanner-&gt;text++);
<span class="line-new-header">--- 1227,24 ---</span>
      {
        gint buffered;
  
        buffered = scanner-&gt;text_end - scanner-&gt;text;
        if (lseek (scanner-&gt;input_fd, - buffered, SEEK_CUR) &gt;= 0)
<span class="line-modified">!   {</span>
<span class="line-modified">!     /* we succeeded, blow our buffer&#39;s contents now */</span>
<span class="line-modified">!     scanner-&gt;text = NULL;</span>
<span class="line-modified">!     scanner-&gt;text_end = NULL;</span>
<span class="line-modified">!   }</span>
        else
<span class="line-modified">!   errno = 0;</span>
      }
  }
  
  static guchar
<span class="line-modified">! g_scanner_get_char (GScanner  *scanner,</span>
<span class="line-modified">!         guint *line_p,</span>
<span class="line-modified">!         guint *position_p)</span>
  {
    guchar fchar;
  
    if (scanner-&gt;text &lt; scanner-&gt;text_end)
      fchar = *(scanner-&gt;text++);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1252,32 ***</span>
        gint count;
        gchar *buffer;
  
        buffer = scanner-&gt;buffer;
        do
<span class="line-modified">!     {</span>
<span class="line-modified">!       count = read (scanner-&gt;input_fd, buffer, READ_BUFFER_SIZE);</span>
<span class="line-modified">!     }</span>
        while (count == -1 &amp;&amp; (errno == EINTR || errno == EAGAIN));
  
        if (count &lt; 1)
<span class="line-modified">!     {</span>
<span class="line-modified">!       scanner-&gt;input_fd = -1;</span>
<span class="line-modified">!       fchar = 0;</span>
<span class="line-modified">!     }</span>
        else
<span class="line-modified">!     {</span>
<span class="line-modified">!       scanner-&gt;text = buffer + 1;</span>
<span class="line-modified">!       scanner-&gt;text_end = buffer + count;</span>
<span class="line-modified">!       fchar = *buffer;</span>
<span class="line-modified">!       if (!fchar)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           g_scanner_sync_file_offset (scanner);</span>
<span class="line-modified">!           scanner-&gt;text_end = scanner-&gt;text;</span>
<span class="line-modified">!           scanner-&gt;input_fd = -1;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
      }
    else
      fchar = 0;
  
    if (fchar == &#39;\n&#39;)
<span class="line-new-header">--- 1253,32 ---</span>
        gint count;
        gchar *buffer;
  
        buffer = scanner-&gt;buffer;
        do
<span class="line-modified">!   {</span>
<span class="line-modified">!     count = read (scanner-&gt;input_fd, buffer, READ_BUFFER_SIZE);</span>
<span class="line-modified">!   }</span>
        while (count == -1 &amp;&amp; (errno == EINTR || errno == EAGAIN));
  
        if (count &lt; 1)
<span class="line-modified">!   {</span>
<span class="line-modified">!     scanner-&gt;input_fd = -1;</span>
<span class="line-modified">!     fchar = 0;</span>
<span class="line-modified">!   }</span>
        else
<span class="line-modified">!   {</span>
<span class="line-modified">!     scanner-&gt;text = buffer + 1;</span>
<span class="line-modified">!     scanner-&gt;text_end = buffer + count;</span>
<span class="line-modified">!     fchar = *buffer;</span>
<span class="line-modified">!     if (!fchar)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         g_scanner_sync_file_offset (scanner);</span>
<span class="line-modified">!         scanner-&gt;text_end = scanner-&gt;text;</span>
<span class="line-modified">!         scanner-&gt;input_fd = -1;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!   }</span>
      }
    else
      fchar = 0;
  
    if (fchar == &#39;\n&#39;)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1319,25 ***</span>
   * call to g_scanner_get_next_token(), as g_scanner_unexp_token()
   * evaluates the scanner&#39;s current token (not the peeked token)
   * to construct part of the message.
   */
  void
<span class="line-modified">! g_scanner_unexp_token (GScanner     *scanner,</span>
<span class="line-modified">!                GTokenType    expected_token,</span>
<span class="line-modified">!                const gchar  *identifier_spec,</span>
<span class="line-modified">!                const gchar  *symbol_spec,</span>
<span class="line-modified">!                const gchar  *symbol_name,</span>
<span class="line-modified">!                const gchar  *message,</span>
<span class="line-modified">!                gint      is_error)</span>
  {
    gchar *token_string;
    guint token_string_len;
    gchar *expected_string;
    guint expected_string_len;
    gchar *message_prefix;
    gboolean print_unexp;
<span class="line-modified">!   void (*msg_handler)   (GScanner*, const gchar*, ...);</span>
  
    g_return_if_fail (scanner != NULL);
  
    if (is_error)
      msg_handler = g_scanner_error;
<span class="line-new-header">--- 1320,25 ---</span>
   * call to g_scanner_get_next_token(), as g_scanner_unexp_token()
   * evaluates the scanner&#39;s current token (not the peeked token)
   * to construct part of the message.
   */
  void
<span class="line-modified">! g_scanner_unexp_token (GScanner   *scanner,</span>
<span class="line-modified">!            GTokenType  expected_token,</span>
<span class="line-modified">!            const gchar  *identifier_spec,</span>
<span class="line-modified">!            const gchar  *symbol_spec,</span>
<span class="line-modified">!            const gchar  *symbol_name,</span>
<span class="line-modified">!            const gchar  *message,</span>
<span class="line-modified">!            gint    is_error)</span>
  {
    gchar *token_string;
    guint token_string_len;
    gchar *expected_string;
    guint expected_string_len;
    gchar *message_prefix;
    gboolean print_unexp;
<span class="line-modified">!   void (*msg_handler) (GScanner*, const gchar*, ...);</span>
  
    g_return_if_fail (scanner != NULL);
  
    if (is_error)
      msg_handler = g_scanner_error;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1361,125 ***</span>
        _g_snprintf (token_string, token_string_len, &quot;end of file&quot;);
        break;
  
      default:
        if (scanner-&gt;token &gt;= 1 &amp;&amp; scanner-&gt;token &lt;= 255)
<span class="line-modified">!     {</span>
<span class="line-modified">!       if ((scanner-&gt;token &gt;= &#39; &#39; &amp;&amp; scanner-&gt;token &lt;= &#39;~&#39;) ||</span>
<span class="line-modified">!           strchr (scanner-&gt;config-&gt;cset_identifier_first, scanner-&gt;token) ||</span>
<span class="line-modified">!           strchr (scanner-&gt;config-&gt;cset_identifier_nth, scanner-&gt;token))</span>
<span class="line-modified">!         _g_snprintf (token_string, token_string_len, &quot;character &#39;%c&#39;&quot;, scanner-&gt;token);</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         _g_snprintf (token_string, token_string_len, &quot;character &#39;\\%o&#39;&quot;, scanner-&gt;token);</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     }</span>
        else if (!scanner-&gt;config-&gt;symbol_2_token)
<span class="line-modified">!     {</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;(unknown) token &lt;%d&gt;&quot;, scanner-&gt;token);</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     }</span>
        /* fall through */
      case G_TOKEN_SYMBOL:
        if (expected_token == G_TOKEN_SYMBOL ||
<span class="line-modified">!       (scanner-&gt;config-&gt;symbol_2_token &amp;&amp;</span>
<span class="line-modified">!        expected_token &gt; G_TOKEN_LAST))</span>
<span class="line-modified">!     print_unexp = FALSE;</span>
        if (symbol_name)
<span class="line-modified">!     _g_snprintf (token_string,</span>
<span class="line-modified">!              token_string_len,</span>
<span class="line-modified">!              &quot;%s%s &#39;%s&#39;&quot;,</span>
<span class="line-modified">!              print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!              symbol_spec,</span>
<span class="line-modified">!              symbol_name);</span>
        else
<span class="line-modified">!     _g_snprintf (token_string,</span>
<span class="line-modified">!              token_string_len,</span>
<span class="line-modified">!              &quot;%s%s&quot;,</span>
<span class="line-modified">!              print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!              symbol_spec);</span>
        break;
  
      case G_TOKEN_ERROR:
        print_unexp = FALSE;
        expected_token = G_TOKEN_NONE;
        switch (scanner-&gt;value.v_error)
<span class="line-modified">!     {</span>
<span class="line-modified">!     case G_ERR_UNEXP_EOF:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: unexpected end of file&quot;);</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case G_ERR_UNEXP_EOF_IN_STRING:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: unterminated string constant&quot;);</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case G_ERR_UNEXP_EOF_IN_COMMENT:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: unterminated comment&quot;);</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case G_ERR_NON_DIGIT_IN_CONST:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: non digit in constant&quot;);</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case G_ERR_FLOAT_RADIX:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: invalid radix for floating constant&quot;);</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case G_ERR_FLOAT_MALFORMED:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: malformed floating constant&quot;);</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case G_ERR_DIGIT_RADIX:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: digit is beyond radix&quot;);</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case G_ERR_UNKNOWN:</span>
<span class="line-modified">!     default:</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;scanner: unknown error&quot;);</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     }</span>
        break;
  
      case G_TOKEN_CHAR:
        _g_snprintf (token_string, token_string_len, &quot;character &#39;%c&#39;&quot;, scanner-&gt;value.v_char);
        break;
  
      case G_TOKEN_IDENTIFIER:
      case G_TOKEN_IDENTIFIER_NULL:
        if (expected_token == G_TOKEN_IDENTIFIER ||
<span class="line-modified">!       expected_token == G_TOKEN_IDENTIFIER_NULL)</span>
<span class="line-modified">!     print_unexp = FALSE;</span>
        _g_snprintf (token_string,
<span class="line-modified">!           token_string_len,</span>
<span class="line-modified">!           &quot;%s%s &#39;%s&#39;&quot;,</span>
<span class="line-modified">!           print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!           identifier_spec,</span>
<span class="line-modified">!           scanner-&gt;token == G_TOKEN_IDENTIFIER ? scanner-&gt;value.v_string : &quot;null&quot;);</span>
        break;
  
      case G_TOKEN_BINARY:
      case G_TOKEN_OCTAL:
      case G_TOKEN_INT:
      case G_TOKEN_HEX:
        if (scanner-&gt;config-&gt;store_int64)
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;number &#39;%&quot; G_GUINT64_FORMAT &quot;&#39;&quot;, scanner-&gt;value.v_int64);</span>
        else
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;number &#39;%lu&#39;&quot;, scanner-&gt;value.v_int);</span>
        break;
  
      case G_TOKEN_FLOAT:
        _g_snprintf (token_string, token_string_len, &quot;number &#39;%.3f&#39;&quot;, scanner-&gt;value.v_float);
        break;
  
      case G_TOKEN_STRING:
        if (expected_token == G_TOKEN_STRING)
<span class="line-modified">!     print_unexp = FALSE;</span>
        _g_snprintf (token_string,
<span class="line-modified">!            token_string_len,</span>
<span class="line-modified">!            &quot;%s%sstring constant \&quot;%s\&quot;&quot;,</span>
<span class="line-modified">!            print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!            scanner-&gt;value.v_string[0] == 0 ? &quot;empty &quot; : &quot;&quot;,</span>
<span class="line-modified">!            scanner-&gt;value.v_string);</span>
        token_string[token_string_len - 2] = &#39;&quot;&#39;;
        token_string[token_string_len - 1] = 0;
        break;
  
      case G_TOKEN_COMMENT_SINGLE:
<span class="line-new-header">--- 1362,125 ---</span>
        _g_snprintf (token_string, token_string_len, &quot;end of file&quot;);
        break;
  
      default:
        if (scanner-&gt;token &gt;= 1 &amp;&amp; scanner-&gt;token &lt;= 255)
<span class="line-modified">!   {</span>
<span class="line-modified">!     if ((scanner-&gt;token &gt;= &#39; &#39; &amp;&amp; scanner-&gt;token &lt;= &#39;~&#39;) ||</span>
<span class="line-modified">!         strchr (scanner-&gt;config-&gt;cset_identifier_first, scanner-&gt;token) ||</span>
<span class="line-modified">!         strchr (scanner-&gt;config-&gt;cset_identifier_nth, scanner-&gt;token))</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;character &#39;%c&#39;&quot;, scanner-&gt;token);</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       _g_snprintf (token_string, token_string_len, &quot;character &#39;\\%o&#39;&quot;, scanner-&gt;token);</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!   }</span>
        else if (!scanner-&gt;config-&gt;symbol_2_token)
<span class="line-modified">!   {</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;(unknown) token &lt;%d&gt;&quot;, scanner-&gt;token);</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!   }</span>
        /* fall through */
      case G_TOKEN_SYMBOL:
        if (expected_token == G_TOKEN_SYMBOL ||
<span class="line-modified">!     (scanner-&gt;config-&gt;symbol_2_token &amp;&amp;</span>
<span class="line-modified">!      expected_token &gt; G_TOKEN_LAST))</span>
<span class="line-modified">!   print_unexp = FALSE;</span>
        if (symbol_name)
<span class="line-modified">!   _g_snprintf (token_string,</span>
<span class="line-modified">!          token_string_len,</span>
<span class="line-modified">!          &quot;%s%s &#39;%s&#39;&quot;,</span>
<span class="line-modified">!          print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!          symbol_spec,</span>
<span class="line-modified">!          symbol_name);</span>
        else
<span class="line-modified">!   _g_snprintf (token_string,</span>
<span class="line-modified">!          token_string_len,</span>
<span class="line-modified">!          &quot;%s%s&quot;,</span>
<span class="line-modified">!          print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!          symbol_spec);</span>
        break;
  
      case G_TOKEN_ERROR:
        print_unexp = FALSE;
        expected_token = G_TOKEN_NONE;
        switch (scanner-&gt;value.v_error)
<span class="line-modified">!   {</span>
<span class="line-modified">!   case G_ERR_UNEXP_EOF:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: unexpected end of file&quot;);</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case G_ERR_UNEXP_EOF_IN_STRING:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: unterminated string constant&quot;);</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case G_ERR_UNEXP_EOF_IN_COMMENT:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: unterminated comment&quot;);</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case G_ERR_NON_DIGIT_IN_CONST:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: non digit in constant&quot;);</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case G_ERR_FLOAT_RADIX:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: invalid radix for floating constant&quot;);</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case G_ERR_FLOAT_MALFORMED:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: malformed floating constant&quot;);</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case G_ERR_DIGIT_RADIX:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: digit is beyond radix&quot;);</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case G_ERR_UNKNOWN:</span>
<span class="line-modified">!   default:</span>
<span class="line-modified">!     _g_snprintf (token_string, token_string_len, &quot;scanner: unknown error&quot;);</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!   }</span>
        break;
  
      case G_TOKEN_CHAR:
        _g_snprintf (token_string, token_string_len, &quot;character &#39;%c&#39;&quot;, scanner-&gt;value.v_char);
        break;
  
      case G_TOKEN_IDENTIFIER:
      case G_TOKEN_IDENTIFIER_NULL:
        if (expected_token == G_TOKEN_IDENTIFIER ||
<span class="line-modified">!     expected_token == G_TOKEN_IDENTIFIER_NULL)</span>
<span class="line-modified">!   print_unexp = FALSE;</span>
        _g_snprintf (token_string,
<span class="line-modified">!       token_string_len,</span>
<span class="line-modified">!       &quot;%s%s &#39;%s&#39;&quot;,</span>
<span class="line-modified">!       print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!       identifier_spec,</span>
<span class="line-modified">!       scanner-&gt;token == G_TOKEN_IDENTIFIER ? scanner-&gt;value.v_string : &quot;null&quot;);</span>
        break;
  
      case G_TOKEN_BINARY:
      case G_TOKEN_OCTAL:
      case G_TOKEN_INT:
      case G_TOKEN_HEX:
        if (scanner-&gt;config-&gt;store_int64)
<span class="line-modified">!   _g_snprintf (token_string, token_string_len, &quot;number &#39;%&quot; G_GUINT64_FORMAT &quot;&#39;&quot;, scanner-&gt;value.v_int64);</span>
        else
<span class="line-modified">!   _g_snprintf (token_string, token_string_len, &quot;number &#39;%lu&#39;&quot;, scanner-&gt;value.v_int);</span>
        break;
  
      case G_TOKEN_FLOAT:
        _g_snprintf (token_string, token_string_len, &quot;number &#39;%.3f&#39;&quot;, scanner-&gt;value.v_float);
        break;
  
      case G_TOKEN_STRING:
        if (expected_token == G_TOKEN_STRING)
<span class="line-modified">!   print_unexp = FALSE;</span>
        _g_snprintf (token_string,
<span class="line-modified">!        token_string_len,</span>
<span class="line-modified">!        &quot;%s%sstring constant \&quot;%s\&quot;&quot;,</span>
<span class="line-modified">!        print_unexp ? &quot;&quot; : &quot;invalid &quot;,</span>
<span class="line-modified">!        scanner-&gt;value.v_string[0] == 0 ? &quot;empty &quot; : &quot;&quot;,</span>
<span class="line-modified">!        scanner-&gt;value.v_string);</span>
        token_string[token_string_len - 2] = &#39;&quot;&#39;;
        token_string[token_string_len - 1] = 0;
        break;
  
      case G_TOKEN_COMMENT_SINGLE:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1506,90 ***</span>
      case G_TOKEN_EOF:
        _g_snprintf (expected_string, expected_string_len, &quot;end of file&quot;);
        break;
      default:
        if (expected_token &gt;= 1 &amp;&amp; expected_token &lt;= 255)
<span class="line-modified">!     {</span>
<span class="line-modified">!       if ((expected_token &gt;= &#39; &#39; &amp;&amp; expected_token &lt;= &#39;~&#39;) ||</span>
<span class="line-modified">!           strchr (scanner-&gt;config-&gt;cset_identifier_first, expected_token) ||</span>
<span class="line-modified">!           strchr (scanner-&gt;config-&gt;cset_identifier_nth, expected_token))</span>
<span class="line-modified">!         _g_snprintf (expected_string, expected_string_len, &quot;character &#39;%c&#39;&quot;, expected_token);</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         _g_snprintf (expected_string, expected_string_len, &quot;character &#39;\\%o&#39;&quot;, expected_token);</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     }</span>
        else if (!scanner-&gt;config-&gt;symbol_2_token)
<span class="line-modified">!     {</span>
<span class="line-modified">!       _g_snprintf (expected_string, expected_string_len, &quot;(unknown) token &lt;%d&gt;&quot;, expected_token);</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     }</span>
        /* fall through */
      case G_TOKEN_SYMBOL:
        need_valid = (scanner-&gt;token == G_TOKEN_SYMBOL ||
<span class="line-modified">!             (scanner-&gt;config-&gt;symbol_2_token &amp;&amp;</span>
<span class="line-modified">!              scanner-&gt;token &gt; G_TOKEN_LAST));</span>
        _g_snprintf (expected_string,
<span class="line-modified">!            expected_string_len,</span>
<span class="line-modified">!            &quot;%s%s&quot;,</span>
<span class="line-modified">!            need_valid ? &quot;valid &quot; : &quot;&quot;,</span>
<span class="line-modified">!            symbol_spec);</span>
<span class="line-modified">!       /* FIXME: should we attempt to lookup the symbol_name for symbol_2_token? */</span>
        break;
      case G_TOKEN_CHAR:
        _g_snprintf (expected_string, expected_string_len, &quot;%scharacter&quot;,
<span class="line-modified">!            scanner-&gt;token == G_TOKEN_CHAR ? &quot;valid &quot; : &quot;&quot;);</span>
        break;
      case G_TOKEN_BINARY:
        tstring = &quot;binary&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!            scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_OCTAL:
        tstring = &quot;octal&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!            scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_INT:
        tstring = &quot;integer&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!            scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_HEX:
        tstring = &quot;hexadecimal&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!            scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_FLOAT:
        tstring = &quot;float&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!            scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_STRING:
        _g_snprintf (expected_string,
<span class="line-modified">!            expected_string_len,</span>
<span class="line-modified">!            &quot;%sstring constant&quot;,</span>
<span class="line-modified">!            scanner-&gt;token == G_TOKEN_STRING ? &quot;valid &quot; : &quot;&quot;);</span>
        break;
      case G_TOKEN_IDENTIFIER:
      case G_TOKEN_IDENTIFIER_NULL:
        need_valid = (scanner-&gt;token == G_TOKEN_IDENTIFIER_NULL ||
<span class="line-modified">!             scanner-&gt;token == G_TOKEN_IDENTIFIER);</span>
        _g_snprintf (expected_string,
<span class="line-modified">!            expected_string_len,</span>
<span class="line-modified">!            &quot;%s%s&quot;,</span>
<span class="line-modified">!            need_valid ? &quot;valid &quot; : &quot;&quot;,</span>
<span class="line-modified">!            identifier_spec);</span>
        break;
      case G_TOKEN_COMMENT_SINGLE:
        tstring = &quot;single-line&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%scomment (%s)&quot;,
<span class="line-modified">!            scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_COMMENT_MULTI:
        tstring = &quot;multi-line&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%scomment (%s)&quot;,
<span class="line-modified">!            scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_NONE:
      case G_TOKEN_ERROR:
        /* this is handled upon printout */
        break;
<span class="line-new-header">--- 1507,90 ---</span>
      case G_TOKEN_EOF:
        _g_snprintf (expected_string, expected_string_len, &quot;end of file&quot;);
        break;
      default:
        if (expected_token &gt;= 1 &amp;&amp; expected_token &lt;= 255)
<span class="line-modified">!   {</span>
<span class="line-modified">!     if ((expected_token &gt;= &#39; &#39; &amp;&amp; expected_token &lt;= &#39;~&#39;) ||</span>
<span class="line-modified">!         strchr (scanner-&gt;config-&gt;cset_identifier_first, expected_token) ||</span>
<span class="line-modified">!         strchr (scanner-&gt;config-&gt;cset_identifier_nth, expected_token))</span>
<span class="line-modified">!       _g_snprintf (expected_string, expected_string_len, &quot;character &#39;%c&#39;&quot;, expected_token);</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       _g_snprintf (expected_string, expected_string_len, &quot;character &#39;\\%o&#39;&quot;, expected_token);</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!   }</span>
        else if (!scanner-&gt;config-&gt;symbol_2_token)
<span class="line-modified">!   {</span>
<span class="line-modified">!     _g_snprintf (expected_string, expected_string_len, &quot;(unknown) token &lt;%d&gt;&quot;, expected_token);</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!   }</span>
        /* fall through */
      case G_TOKEN_SYMBOL:
        need_valid = (scanner-&gt;token == G_TOKEN_SYMBOL ||
<span class="line-modified">!         (scanner-&gt;config-&gt;symbol_2_token &amp;&amp;</span>
<span class="line-modified">!          scanner-&gt;token &gt; G_TOKEN_LAST));</span>
        _g_snprintf (expected_string,
<span class="line-modified">!        expected_string_len,</span>
<span class="line-modified">!        &quot;%s%s&quot;,</span>
<span class="line-modified">!        need_valid ? &quot;valid &quot; : &quot;&quot;,</span>
<span class="line-modified">!        symbol_spec);</span>
<span class="line-modified">!       /* FIXME: should we attempt to look up the symbol_name for symbol_2_token? */</span>
        break;
      case G_TOKEN_CHAR:
        _g_snprintf (expected_string, expected_string_len, &quot;%scharacter&quot;,
<span class="line-modified">!        scanner-&gt;token == G_TOKEN_CHAR ? &quot;valid &quot; : &quot;&quot;);</span>
        break;
      case G_TOKEN_BINARY:
        tstring = &quot;binary&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!        scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_OCTAL:
        tstring = &quot;octal&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!        scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_INT:
        tstring = &quot;integer&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!        scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_HEX:
        tstring = &quot;hexadecimal&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!        scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_FLOAT:
        tstring = &quot;float&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%snumber (%s)&quot;,
<span class="line-modified">!        scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_STRING:
        _g_snprintf (expected_string,
<span class="line-modified">!        expected_string_len,</span>
<span class="line-modified">!        &quot;%sstring constant&quot;,</span>
<span class="line-modified">!        scanner-&gt;token == G_TOKEN_STRING ? &quot;valid &quot; : &quot;&quot;);</span>
        break;
      case G_TOKEN_IDENTIFIER:
      case G_TOKEN_IDENTIFIER_NULL:
        need_valid = (scanner-&gt;token == G_TOKEN_IDENTIFIER_NULL ||
<span class="line-modified">!         scanner-&gt;token == G_TOKEN_IDENTIFIER);</span>
        _g_snprintf (expected_string,
<span class="line-modified">!        expected_string_len,</span>
<span class="line-modified">!        &quot;%s%s&quot;,</span>
<span class="line-modified">!        need_valid ? &quot;valid &quot; : &quot;&quot;,</span>
<span class="line-modified">!        identifier_spec);</span>
        break;
      case G_TOKEN_COMMENT_SINGLE:
        tstring = &quot;single-line&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%scomment (%s)&quot;,
<span class="line-modified">!        scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_COMMENT_MULTI:
        tstring = &quot;multi-line&quot;;
        _g_snprintf (expected_string, expected_string_len, &quot;%scomment (%s)&quot;,
<span class="line-modified">!        scanner-&gt;token == expected_token ? &quot;valid &quot; : &quot;&quot;, tstring);</span>
        break;
      case G_TOKEN_NONE:
      case G_TOKEN_ERROR:
        /* this is handled upon printout */
        break;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1603,90 ***</span>
        message = &quot;&quot;;
      }
    if (expected_token == G_TOKEN_ERROR)
      {
        msg_handler (scanner,
<span class="line-modified">!            &quot;failure around %s%s%s&quot;,</span>
<span class="line-modified">!            token_string,</span>
<span class="line-modified">!            message_prefix,</span>
<span class="line-modified">!            message);</span>
      }
    else if (expected_token == G_TOKEN_NONE)
      {
        if (print_unexp)
<span class="line-modified">!     msg_handler (scanner,</span>
<span class="line-modified">!              &quot;unexpected %s%s%s&quot;,</span>
<span class="line-modified">!              token_string,</span>
<span class="line-modified">!              message_prefix,</span>
<span class="line-modified">!              message);</span>
        else
<span class="line-modified">!     msg_handler (scanner,</span>
<span class="line-modified">!              &quot;%s%s%s&quot;,</span>
<span class="line-modified">!              token_string,</span>
<span class="line-modified">!              message_prefix,</span>
<span class="line-modified">!              message);</span>
      }
    else
      {
        if (print_unexp)
<span class="line-modified">!     msg_handler (scanner,</span>
<span class="line-modified">!              &quot;unexpected %s, expected %s%s%s&quot;,</span>
<span class="line-modified">!              token_string,</span>
<span class="line-modified">!              expected_string,</span>
<span class="line-modified">!              message_prefix,</span>
<span class="line-modified">!              message);</span>
        else
<span class="line-modified">!     msg_handler (scanner,</span>
<span class="line-modified">!              &quot;%s, expected %s%s%s&quot;,</span>
<span class="line-modified">!              token_string,</span>
<span class="line-modified">!              expected_string,</span>
<span class="line-modified">!              message_prefix,</span>
<span class="line-modified">!              message);</span>
      }
  
    g_free (token_string);
    g_free (expected_string);
  }
  
  static void
  g_scanner_get_token_i (GScanner *scanner,
<span class="line-modified">!                GTokenType   *token_p,</span>
<span class="line-modified">!                GTokenValue  *value_p,</span>
<span class="line-modified">!                guint        *line_p,</span>
<span class="line-modified">!                guint        *position_p)</span>
  {
    do
      {
        g_scanner_free_value (token_p, value_p);
        g_scanner_get_token_ll (scanner, token_p, value_p, line_p, position_p);
      }
    while (((*token_p &gt; 0 &amp;&amp; *token_p &lt; 256) &amp;&amp;
<span class="line-modified">!       strchr (scanner-&gt;config-&gt;cset_skip_characters, *token_p)) ||</span>
<span class="line-modified">!      (*token_p == G_TOKEN_CHAR &amp;&amp;</span>
<span class="line-modified">!       strchr (scanner-&gt;config-&gt;cset_skip_characters, value_p-&gt;v_char)) ||</span>
<span class="line-modified">!      (*token_p == G_TOKEN_COMMENT_MULTI &amp;&amp;</span>
<span class="line-modified">!       scanner-&gt;config-&gt;skip_comment_multi) ||</span>
<span class="line-modified">!      (*token_p == G_TOKEN_COMMENT_SINGLE &amp;&amp;</span>
<span class="line-modified">!       scanner-&gt;config-&gt;skip_comment_single));</span>
  
    switch (*token_p)
      {
      case G_TOKEN_IDENTIFIER:
        if (scanner-&gt;config-&gt;identifier_2_string)
<span class="line-modified">!     *token_p = G_TOKEN_STRING;</span>
        break;
  
      case G_TOKEN_SYMBOL:
        if (scanner-&gt;config-&gt;symbol_2_token)
<span class="line-modified">!     *token_p = (GTokenType) value_p-&gt;v_symbol;</span>
        break;
  
      case G_TOKEN_BINARY:
      case G_TOKEN_OCTAL:
      case G_TOKEN_HEX:
        if (scanner-&gt;config-&gt;numbers_2_int)
<span class="line-modified">!     *token_p = G_TOKEN_INT;</span>
        break;
  
      default:
        break;
      }
<span class="line-new-header">--- 1604,90 ---</span>
        message = &quot;&quot;;
      }
    if (expected_token == G_TOKEN_ERROR)
      {
        msg_handler (scanner,
<span class="line-modified">!        &quot;failure around %s%s%s&quot;,</span>
<span class="line-modified">!        token_string,</span>
<span class="line-modified">!        message_prefix,</span>
<span class="line-modified">!        message);</span>
      }
    else if (expected_token == G_TOKEN_NONE)
      {
        if (print_unexp)
<span class="line-modified">!   msg_handler (scanner,</span>
<span class="line-modified">!          &quot;unexpected %s%s%s&quot;,</span>
<span class="line-modified">!          token_string,</span>
<span class="line-modified">!          message_prefix,</span>
<span class="line-modified">!          message);</span>
        else
<span class="line-modified">!   msg_handler (scanner,</span>
<span class="line-modified">!          &quot;%s%s%s&quot;,</span>
<span class="line-modified">!          token_string,</span>
<span class="line-modified">!          message_prefix,</span>
<span class="line-modified">!          message);</span>
      }
    else
      {
        if (print_unexp)
<span class="line-modified">!   msg_handler (scanner,</span>
<span class="line-modified">!          &quot;unexpected %s, expected %s%s%s&quot;,</span>
<span class="line-modified">!          token_string,</span>
<span class="line-modified">!          expected_string,</span>
<span class="line-modified">!          message_prefix,</span>
<span class="line-modified">!          message);</span>
        else
<span class="line-modified">!   msg_handler (scanner,</span>
<span class="line-modified">!          &quot;%s, expected %s%s%s&quot;,</span>
<span class="line-modified">!          token_string,</span>
<span class="line-modified">!          expected_string,</span>
<span class="line-modified">!          message_prefix,</span>
<span class="line-modified">!          message);</span>
      }
  
    g_free (token_string);
    g_free (expected_string);
  }
  
  static void
  g_scanner_get_token_i (GScanner *scanner,
<span class="line-modified">!            GTokenType *token_p,</span>
<span class="line-modified">!            GTokenValue  *value_p,</span>
<span class="line-modified">!            guint    *line_p,</span>
<span class="line-modified">!            guint    *position_p)</span>
  {
    do
      {
        g_scanner_free_value (token_p, value_p);
        g_scanner_get_token_ll (scanner, token_p, value_p, line_p, position_p);
      }
    while (((*token_p &gt; 0 &amp;&amp; *token_p &lt; 256) &amp;&amp;
<span class="line-modified">!     strchr (scanner-&gt;config-&gt;cset_skip_characters, *token_p)) ||</span>
<span class="line-modified">!    (*token_p == G_TOKEN_CHAR &amp;&amp;</span>
<span class="line-modified">!     strchr (scanner-&gt;config-&gt;cset_skip_characters, value_p-&gt;v_char)) ||</span>
<span class="line-modified">!    (*token_p == G_TOKEN_COMMENT_MULTI &amp;&amp;</span>
<span class="line-modified">!     scanner-&gt;config-&gt;skip_comment_multi) ||</span>
<span class="line-modified">!    (*token_p == G_TOKEN_COMMENT_SINGLE &amp;&amp;</span>
<span class="line-modified">!     scanner-&gt;config-&gt;skip_comment_single));</span>
  
    switch (*token_p)
      {
      case G_TOKEN_IDENTIFIER:
        if (scanner-&gt;config-&gt;identifier_2_string)
<span class="line-modified">!   *token_p = G_TOKEN_STRING;</span>
        break;
  
      case G_TOKEN_SYMBOL:
        if (scanner-&gt;config-&gt;symbol_2_token)
<span class="line-modified">!   *token_p = (GTokenType) value_p-&gt;v_symbol;</span>
        break;
  
      case G_TOKEN_BINARY:
      case G_TOKEN_OCTAL:
      case G_TOKEN_HEX:
        if (scanner-&gt;config-&gt;numbers_2_int)
<span class="line-modified">!   *token_p = G_TOKEN_INT;</span>
        break;
  
      default:
        break;
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1698,32 ***</span>
        if (scanner-&gt;config-&gt;store_int64)
          {
            value_p-&gt;v_float = value_p-&gt;v_int64;
          }
        else
<span class="line-modified">!     value_p-&gt;v_float = value_p-&gt;v_int;</span>
      }
  
    errno = 0;
  }
  
  static void
<span class="line-modified">! g_scanner_get_token_ll  (GScanner   *scanner,</span>
<span class="line-modified">!              GTokenType *token_p,</span>
<span class="line-modified">!              GTokenValue    *value_p,</span>
<span class="line-modified">!              guint      *line_p,</span>
<span class="line-modified">!              guint      *position_p)</span>
  {
    GScannerConfig *config;
<span class="line-modified">!   GTokenType       token;</span>
    gboolean     in_comment_multi;
    gboolean     in_comment_single;
    gboolean     in_string_sq;
    gboolean     in_string_dq;
<span class="line-modified">!   GString     *gstring;</span>
<span class="line-modified">!   GTokenValue      value;</span>
<span class="line-modified">!   guchar       ch;</span>
  
    config = scanner-&gt;config;
    (*value_p).v_int64 = 0;
  
    if ((scanner-&gt;text &gt;= scanner-&gt;text_end &amp;&amp; scanner-&gt;input_fd &lt; 0) ||
<span class="line-new-header">--- 1699,32 ---</span>
        if (scanner-&gt;config-&gt;store_int64)
          {
            value_p-&gt;v_float = value_p-&gt;v_int64;
          }
        else
<span class="line-modified">!   value_p-&gt;v_float = value_p-&gt;v_int;</span>
      }
  
    errno = 0;
  }
  
  static void
<span class="line-modified">! g_scanner_get_token_ll  (GScanner *scanner,</span>
<span class="line-modified">!        GTokenType *token_p,</span>
<span class="line-modified">!        GTokenValue  *value_p,</span>
<span class="line-modified">!        guint    *line_p,</span>
<span class="line-modified">!        guint    *position_p)</span>
  {
    GScannerConfig *config;
<span class="line-modified">!   GTokenType     token;</span>
    gboolean     in_comment_multi;
    gboolean     in_comment_single;
    gboolean     in_string_sq;
    gboolean     in_string_dq;
<span class="line-modified">!   GString   *gstring;</span>
<span class="line-modified">!   GTokenValue    value;</span>
<span class="line-modified">!   guchar     ch;</span>
  
    config = scanner-&gt;config;
    (*value_p).v_int64 = 0;
  
    if ((scanner-&gt;text &gt;= scanner-&gt;text_end &amp;&amp; scanner-&gt;input_fd &lt; 0) ||
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1751,453 ***</span>
        /* this is *evil*, but needed ;(
         * we first check for identifier first character, because  it
         * might interfere with other key chars like slashes or numbers
         */
        if (config-&gt;scan_identifier &amp;&amp;
<span class="line-modified">!       ch &amp;&amp; strchr (config-&gt;cset_identifier_first, ch))</span>
<span class="line-modified">!     goto identifier_precedence;</span>
  
        switch (ch)
<span class="line-modified">!     {</span>
<span class="line-modified">!     case 0:</span>
<span class="line-modified">!       token = G_TOKEN_EOF;</span>
<span class="line-modified">!       (*position_p)++;</span>
<span class="line-modified">!       /* ch = 0; */</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     case &#39;/&#39;:</span>
<span class="line-modified">!       if (!config-&gt;scan_comment_multi ||</span>
<span class="line-modified">!           g_scanner_peek_next_char (scanner) != &#39;*&#39;)</span>
<span class="line-modified">!         goto default_case;</span>
        g_scanner_get_char (scanner, line_p, position_p);
<span class="line-modified">!       token = G_TOKEN_COMMENT_MULTI;</span>
<span class="line-removed">-       in_comment_multi = TRUE;</span>
<span class="line-removed">-       gstring = g_string_new (NULL);</span>
<span class="line-removed">-       while ((ch = g_scanner_get_char (scanner, line_p, position_p)) != 0)</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           if (ch == &#39;*&#39; &amp;&amp; g_scanner_peek_next_char (scanner) == &#39;/&#39;)</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-           in_comment_multi = FALSE;</span>
<span class="line-removed">-           break;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           else</span>
<span class="line-removed">-         gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-       ch = 0;</span>
        break;
  
<span class="line-modified">!     case &#39;\&#39;&#39;:</span>
<span class="line-modified">!       if (!config-&gt;scan_string_sq)</span>
<span class="line-modified">!         goto default_case;</span>
<span class="line-modified">!       token = G_TOKEN_STRING;</span>
<span class="line-modified">!       in_string_sq = TRUE;</span>
<span class="line-modified">!       gstring = g_string_new (NULL);</span>
<span class="line-modified">!       while ((ch = g_scanner_get_char (scanner, line_p, position_p)) != 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           if (ch == &#39;\&#39;&#39;)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           in_string_sq = FALSE;</span>
<span class="line-removed">-           break;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           else</span>
<span class="line-removed">-         gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-       ch = 0;</span>
        break;
  
<span class="line-modified">!     case &#39;&quot;&#39;:</span>
<span class="line-modified">!       if (!config-&gt;scan_string_dq)</span>
<span class="line-modified">!         goto default_case;</span>
<span class="line-modified">!       token = G_TOKEN_STRING;</span>
<span class="line-modified">!       in_string_dq = TRUE;</span>
<span class="line-modified">!       gstring = g_string_new (NULL);</span>
<span class="line-modified">!       while ((ch = g_scanner_get_char (scanner, line_p, position_p)) != 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           if (ch == &#39;&quot;&#39;)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           in_string_dq = FALSE;</span>
<span class="line-removed">-           break;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           else</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           if (ch == &#39;\\&#39;)</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-               switch (ch)</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               guint i;</span>
<span class="line-removed">-               guint fchar;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case 0:</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;\\&#39;:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, &#39;\\&#39;);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;n&#39;:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, &#39;\n&#39;);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;t&#39;:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, &#39;\t&#39;);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;r&#39;:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, &#39;\r&#39;);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;b&#39;:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, &#39;\b&#39;);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;f&#39;:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, &#39;\f&#39;);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;0&#39;:</span>
<span class="line-removed">-             case &#39;1&#39;:</span>
<span class="line-removed">-             case &#39;2&#39;:</span>
<span class="line-removed">-             case &#39;3&#39;:</span>
<span class="line-removed">-             case &#39;4&#39;:</span>
<span class="line-removed">-             case &#39;5&#39;:</span>
<span class="line-removed">-             case &#39;6&#39;:</span>
<span class="line-removed">-             case &#39;7&#39;:</span>
<span class="line-removed">-               i = ch - &#39;0&#39;;</span>
<span class="line-removed">-               fchar = g_scanner_peek_next_char (scanner);</span>
<span class="line-removed">-               if (fchar &gt;= &#39;0&#39; &amp;&amp; fchar &lt;= &#39;7&#39;)</span>
<span class="line-removed">-                 {</span>
<span class="line-removed">-                   ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-                   i = i * 8 + ch - &#39;0&#39;;</span>
<span class="line-removed">-                   fchar = g_scanner_peek_next_char (scanner);</span>
<span class="line-removed">-                   if (fchar &gt;= &#39;0&#39; &amp;&amp; fchar &lt;= &#39;7&#39;)</span>
<span class="line-removed">-                 {</span>
<span class="line-removed">-                   ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-                   i = i * 8 + ch - &#39;0&#39;;</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-                 }</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, i);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             default:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-           else</span>
<span class="line-removed">-             gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-       ch = 0;</span>
        break;
<span class="line-modified">! </span>
<span class="line-modified">!     case &#39;.&#39;:</span>
<span class="line-modified">!       if (!config-&gt;scan_float)</span>
<span class="line-modified">!         goto default_case;</span>
<span class="line-removed">-       token = G_TOKEN_FLOAT;</span>
<span class="line-removed">-       dotted_float = TRUE;</span>
<span class="line-removed">-       ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-       goto number_parsing;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     case &#39;$&#39;:</span>
<span class="line-removed">-       if (!config-&gt;scan_hex_dollar)</span>
<span class="line-removed">-         goto default_case;</span>
<span class="line-removed">-       token = G_TOKEN_HEX;</span>
<span class="line-removed">-       ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-       goto number_parsing;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     case &#39;0&#39;:</span>
<span class="line-removed">-       if (config-&gt;scan_octal)</span>
<span class="line-removed">-         token = G_TOKEN_OCTAL;</span>
<span class="line-removed">-       else</span>
<span class="line-removed">-         token = G_TOKEN_INT;</span>
<span class="line-removed">-       ch = g_scanner_peek_next_char (scanner);</span>
<span class="line-removed">-       if (config-&gt;scan_hex &amp;&amp; (ch == &#39;x&#39; || ch == &#39;X&#39;))</span>
          {
<span class="line-removed">-           token = G_TOKEN_HEX;</span>
<span class="line-removed">-           g_scanner_get_char (scanner, line_p, position_p);</span>
            ch = g_scanner_get_char (scanner, line_p, position_p);
<span class="line-modified">!           if (ch == 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           token = G_TOKEN_ERROR;</span>
<span class="line-modified">!           value.v_error = G_ERR_UNEXP_EOF;</span>
<span class="line-modified">!           (*position_p)++;</span>
<span class="line-modified">!           break;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!           if (g_scanner_char_2_num (ch, 16) &lt; 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           token = G_TOKEN_ERROR;</span>
<span class="line-modified">!           value.v_error = G_ERR_DIGIT_RADIX;</span>
<span class="line-modified">!           ch = 0;</span>
<span class="line-modified">!           break;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       else if (config-&gt;scan_binary &amp;&amp; (ch == &#39;b&#39; || ch == &#39;B&#39;))</span>
          {
<span class="line-removed">-           token = G_TOKEN_BINARY;</span>
<span class="line-removed">-           g_scanner_get_char (scanner, line_p, position_p);</span>
            ch = g_scanner_get_char (scanner, line_p, position_p);
<span class="line-modified">!           if (ch == 0)</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           token = G_TOKEN_ERROR;</span>
<span class="line-removed">-           value.v_error = G_ERR_UNEXP_EOF;</span>
<span class="line-removed">-           (*position_p)++;</span>
<span class="line-removed">-           break;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           if (g_scanner_char_2_num (ch, 10) &lt; 0)</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           token = G_TOKEN_ERROR;</span>
<span class="line-removed">-           value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-removed">-           ch = 0;</span>
<span class="line-removed">-           break;</span>
          }
          }
        else
<span class="line-modified">!         ch = &#39;0&#39;;</span>
<span class="line-modified">!       /* fall through */</span>
<span class="line-modified">!     case &#39;1&#39;:</span>
<span class="line-modified">!     case &#39;2&#39;:</span>
<span class="line-modified">!     case &#39;3&#39;:</span>
<span class="line-modified">!     case &#39;4&#39;:</span>
<span class="line-modified">!     case &#39;5&#39;:</span>
<span class="line-modified">!     case &#39;6&#39;:</span>
<span class="line-modified">!     case &#39;7&#39;:</span>
<span class="line-modified">!     case &#39;8&#39;:</span>
<span class="line-modified">!     case &#39;9&#39;:</span>
<span class="line-modified">!     number_parsing:</span>
      {
            gboolean in_number = TRUE;
<span class="line-modified">!       gchar *endptr;</span>
  
<span class="line-modified">!       if (token == G_TOKEN_NONE)</span>
<span class="line-modified">!         token = G_TOKEN_INT;</span>
  
<span class="line-modified">!       gstring = g_string_new (dotted_float ? &quot;0.&quot; : &quot;&quot;);</span>
<span class="line-modified">!       gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">- </span>
<span class="line-removed">-       do /* while (in_number) */</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           gboolean is_E;</span>
  
<span class="line-modified">!           is_E = token == G_TOKEN_FLOAT &amp;&amp; (ch == &#39;e&#39; || ch == &#39;E&#39;);</span>
  
<span class="line-modified">!           ch = g_scanner_peek_next_char (scanner);</span>
  
<span class="line-modified">!           if (g_scanner_char_2_num (ch, 36) &gt;= 0 ||</span>
<span class="line-removed">-           (config-&gt;scan_float &amp;&amp; ch == &#39;.&#39;) ||</span>
<span class="line-removed">-           (is_E &amp;&amp; (ch == &#39;+&#39; || ch == &#39;-&#39;)))</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           ch = g_scanner_get_char (scanner, line_p, position_p);</span>
  
<span class="line-modified">!           switch (ch)</span>
<span class="line-modified">!             {</span>
<span class="line-modified">!             case &#39;.&#39;:</span>
<span class="line-modified">!               if (token != G_TOKEN_INT &amp;&amp; token != G_TOKEN_OCTAL)</span>
<span class="line-modified">!             {</span>
<span class="line-removed">-               value.v_error = token == G_TOKEN_FLOAT ? G_ERR_FLOAT_MALFORMED : G_ERR_FLOAT_RADIX;</span>
<span class="line-removed">-               token = G_TOKEN_ERROR;</span>
<span class="line-removed">-               in_number = FALSE;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-               else</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               token = G_TOKEN_FLOAT;</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;0&#39;:</span>
<span class="line-removed">-             case &#39;1&#39;:</span>
<span class="line-removed">-             case &#39;2&#39;:</span>
<span class="line-removed">-             case &#39;3&#39;:</span>
<span class="line-removed">-             case &#39;4&#39;:</span>
<span class="line-removed">-             case &#39;5&#39;:</span>
<span class="line-removed">-             case &#39;6&#39;:</span>
<span class="line-removed">-             case &#39;7&#39;:</span>
<span class="line-removed">-             case &#39;8&#39;:</span>
<span class="line-removed">-             case &#39;9&#39;:</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;-&#39;:</span>
<span class="line-removed">-             case &#39;+&#39;:</span>
<span class="line-removed">-               if (token != G_TOKEN_FLOAT)</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               token = G_TOKEN_ERROR;</span>
<span class="line-removed">-               value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-removed">-               in_number = FALSE;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-               else</span>
<span class="line-removed">-             gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             case &#39;e&#39;:</span>
<span class="line-removed">-             case &#39;E&#39;:</span>
<span class="line-removed">-               if ((token != G_TOKEN_HEX &amp;&amp; !config-&gt;scan_float) ||</span>
<span class="line-removed">-               (token != G_TOKEN_HEX &amp;&amp;</span>
<span class="line-removed">-                token != G_TOKEN_OCTAL &amp;&amp;</span>
<span class="line-removed">-                token != G_TOKEN_FLOAT &amp;&amp;</span>
<span class="line-removed">-                token != G_TOKEN_INT))</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               token = G_TOKEN_ERROR;</span>
<span class="line-removed">-               value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-removed">-               in_number = FALSE;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-               else</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               if (token != G_TOKEN_HEX)</span>
<span class="line-removed">-                 token = G_TOKEN_FLOAT;</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">- </span>
<span class="line-removed">-             default:</span>
<span class="line-removed">-               if (token != G_TOKEN_HEX)</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               token = G_TOKEN_ERROR;</span>
<span class="line-removed">-               value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-removed">-               in_number = FALSE;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-               else</span>
<span class="line-removed">-             gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           else</span>
<span class="line-removed">-         in_number = FALSE;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-       while (in_number);</span>
  
<span class="line-modified">!       endptr = NULL;</span>
<span class="line-removed">-       if (token == G_TOKEN_FLOAT)</span>
<span class="line-removed">-         value.v_float = g_strtod (gstring-&gt;str, &amp;endptr);</span>
<span class="line-removed">-       else</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           guint64 ui64 = 0;</span>
<span class="line-removed">-           switch (token)</span>
          {
<span class="line-modified">!         case G_TOKEN_BINARY:</span>
<span class="line-modified">!           ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 2);</span>
<span class="line-modified">!           break;</span>
<span class="line-modified">!         case G_TOKEN_OCTAL:</span>
<span class="line-modified">!           ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 8);</span>
            break;
<span class="line-modified">!         case G_TOKEN_INT:</span>
<span class="line-modified">!           ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 10);</span>
            break;
<span class="line-modified">!         case G_TOKEN_HEX:</span>
<span class="line-modified">!           ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 16);</span>
            break;
<span class="line-modified">!         default: ;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!           if (scanner-&gt;config-&gt;store_int64)</span>
<span class="line-modified">!         value.v_int64 = ui64;</span>
            else
<span class="line-modified">!         value.v_int = ui64;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       if (endptr &amp;&amp; *endptr)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           token = G_TOKEN_ERROR;</span>
<span class="line-modified">!           if (*endptr == &#39;e&#39; || *endptr == &#39;E&#39;)</span>
          value.v_error = G_ERR_NON_DIGIT_IN_CONST;
            else
<span class="line-modified">!         value.v_error = G_ERR_DIGIT_RADIX;</span>
          }
<span class="line-modified">!       g_string_free (gstring, TRUE);</span>
<span class="line-modified">!       gstring = NULL;</span>
<span class="line-modified">!       ch = 0;</span>
<span class="line-modified">!     } /* number_parsing:... */</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     default:</span>
<span class="line-modified">!     default_case:</span>
      {
<span class="line-modified">!       if (config-&gt;cpair_comment_single &amp;&amp;</span>
<span class="line-modified">!           ch == config-&gt;cpair_comment_single[0])</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           token = G_TOKEN_COMMENT_SINGLE;</span>
<span class="line-modified">!           in_comment_single = TRUE;</span>
<span class="line-modified">!           gstring = g_string_new (NULL);</span>
<span class="line-modified">!           ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-modified">!           while (ch != 0)</span>
          {
<span class="line-modified">!           if (ch == config-&gt;cpair_comment_single[1])</span>
<span class="line-modified">!             {</span>
<span class="line-modified">!               in_comment_single = FALSE;</span>
<span class="line-removed">-               ch = 0;</span>
<span class="line-removed">-               break;</span>
<span class="line-removed">-             }</span>
<span class="line-removed">- </span>
<span class="line-removed">-           gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-           ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           /* ignore a missing newline at EOF for single line comments */</span>
<span class="line-removed">-           if (in_comment_single &amp;&amp;</span>
<span class="line-removed">-           config-&gt;cpair_comment_single[1] == &#39;\n&#39;)</span>
<span class="line-removed">-         in_comment_single = FALSE;</span>
          }
<span class="line-removed">-       else if (config-&gt;scan_identifier &amp;&amp; ch &amp;&amp;</span>
<span class="line-removed">-            strchr (config-&gt;cset_identifier_first, ch))</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-         identifier_precedence:</span>
  
<span class="line-modified">!           if (config-&gt;cset_identifier_nth &amp;&amp; ch &amp;&amp;</span>
<span class="line-modified">!           strchr (config-&gt;cset_identifier_nth,</span>
<span class="line-modified">!               g_scanner_peek_next_char (scanner)))</span>
          {
<span class="line-modified">!           token = G_TOKEN_IDENTIFIER;</span>
<span class="line-removed">-           gstring = g_string_new (NULL);</span>
            gstring = g_string_append_c (gstring, ch);
<span class="line-modified">!           do</span>
<span class="line-removed">-             {</span>
<span class="line-removed">-               ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-removed">-               gstring = g_string_append_c (gstring, ch);</span>
<span class="line-removed">-               ch = g_scanner_peek_next_char (scanner);</span>
<span class="line-removed">-             }</span>
<span class="line-removed">-           while (ch &amp;&amp; strchr (config-&gt;cset_identifier_nth, ch));</span>
<span class="line-removed">-           ch = 0;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           else if (config-&gt;scan_identifier_1char)</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           token = G_TOKEN_IDENTIFIER;</span>
<span class="line-removed">-           value.v_identifier = g_new0 (gchar, 2);</span>
<span class="line-removed">-           value.v_identifier[0] = ch;</span>
<span class="line-removed">-           ch = 0;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-       if (ch)</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           if (config-&gt;char_2_token)</span>
<span class="line-removed">-         token = ch;</span>
<span class="line-removed">-           else</span>
<span class="line-removed">-         {</span>
<span class="line-removed">-           token = G_TOKEN_CHAR;</span>
<span class="line-removed">-           value.v_char = ch;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-           ch = 0;</span>
          }
<span class="line-modified">!     } /* default_case:... */</span>
<span class="line-modified">!     break;</span>
      }
        g_assert (ch == 0 &amp;&amp; token != G_TOKEN_NONE); /* paranoid */
      }
    while (ch != 0);
  
    if (in_comment_multi || in_comment_single ||
        in_string_sq || in_string_dq)
      {
        token = G_TOKEN_ERROR;
        if (gstring)
<span class="line-modified">!     {</span>
<span class="line-modified">!       g_string_free (gstring, TRUE);</span>
<span class="line-modified">!       gstring = NULL;</span>
<span class="line-modified">!     }</span>
        (*position_p)++;
        if (in_comment_multi || in_comment_single)
<span class="line-modified">!     value.v_error = G_ERR_UNEXP_EOF_IN_COMMENT;</span>
        else /* (in_string_sq || in_string_dq) */
<span class="line-modified">!     value.v_error = G_ERR_UNEXP_EOF_IN_STRING;</span>
      }
  
    if (gstring)
      {
        value.v_string = g_string_free (gstring, FALSE);
<span class="line-new-header">--- 1752,453 ---</span>
        /* this is *evil*, but needed ;(
         * we first check for identifier first character, because  it
         * might interfere with other key chars like slashes or numbers
         */
        if (config-&gt;scan_identifier &amp;&amp;
<span class="line-modified">!     ch &amp;&amp; strchr (config-&gt;cset_identifier_first, ch))</span>
<span class="line-modified">!   goto identifier_precedence;</span>
  
        switch (ch)
<span class="line-modified">!   {</span>
<span class="line-modified">!   case 0:</span>
<span class="line-modified">!     token = G_TOKEN_EOF;</span>
<span class="line-modified">!     (*position_p)++;</span>
<span class="line-modified">!     /* ch = 0; */</span>
<span class="line-modified">!     break;</span>
  
<span class="line-modified">!   case &#39;/&#39;:</span>
<span class="line-modified">!     if (!config-&gt;scan_comment_multi ||</span>
<span class="line-modified">!         g_scanner_peek_next_char (scanner) != &#39;*&#39;)</span>
<span class="line-modified">!       goto default_case;</span>
<span class="line-added">+     g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+     token = G_TOKEN_COMMENT_MULTI;</span>
<span class="line-added">+     in_comment_multi = TRUE;</span>
<span class="line-added">+     gstring = g_string_new (NULL);</span>
<span class="line-added">+     while ((ch = g_scanner_get_char (scanner, line_p, position_p)) != 0)</span>
<span class="line-added">+       {</span>
<span class="line-added">+         if (ch == &#39;*&#39; &amp;&amp; g_scanner_peek_next_char (scanner) == &#39;/&#39;)</span>
<span class="line-added">+     {</span>
        g_scanner_get_char (scanner, line_p, position_p);
<span class="line-modified">!       in_comment_multi = FALSE;</span>
        break;
<span class="line-added">+     }</span>
<span class="line-added">+         else</span>
<span class="line-added">+     gstring = g_string_append_c (gstring, ch);</span>
<span class="line-added">+       }</span>
<span class="line-added">+     ch = 0;</span>
<span class="line-added">+     break;</span>
  
<span class="line-modified">!   case &#39;\&#39;&#39;:</span>
<span class="line-modified">!     if (!config-&gt;scan_string_sq)</span>
<span class="line-modified">!       goto default_case;</span>
<span class="line-modified">!     token = G_TOKEN_STRING;</span>
<span class="line-modified">!     in_string_sq = TRUE;</span>
<span class="line-modified">!     gstring = g_string_new (NULL);</span>
<span class="line-modified">!     while ((ch = g_scanner_get_char (scanner, line_p, position_p)) != 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         if (ch == &#39;\&#39;&#39;)</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       in_string_sq = FALSE;</span>
        break;
<span class="line-added">+     }</span>
<span class="line-added">+         else</span>
<span class="line-added">+     gstring = g_string_append_c (gstring, ch);</span>
<span class="line-added">+       }</span>
<span class="line-added">+     ch = 0;</span>
<span class="line-added">+     break;</span>
  
<span class="line-modified">!   case &#39;&quot;&#39;:</span>
<span class="line-modified">!     if (!config-&gt;scan_string_dq)</span>
<span class="line-modified">!       goto default_case;</span>
<span class="line-modified">!     token = G_TOKEN_STRING;</span>
<span class="line-modified">!     in_string_dq = TRUE;</span>
<span class="line-modified">!     gstring = g_string_new (NULL);</span>
<span class="line-modified">!     while ((ch = g_scanner_get_char (scanner, line_p, position_p)) != 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         if (ch == &#39;&quot;&#39;)</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       in_string_dq = FALSE;</span>
        break;
<span class="line-modified">!     }</span>
<span class="line-modified">!         else</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       if (ch == &#39;\\&#39;)</span>
          {
            ch = g_scanner_get_char (scanner, line_p, position_p);
<span class="line-modified">!           switch (ch)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         guint i;</span>
<span class="line-modified">!         guint fchar;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       case 0:</span>
<span class="line-modified">!         break;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       case &#39;\\&#39;:</span>
<span class="line-modified">!         gstring = g_string_append_c (gstring, &#39;\\&#39;);</span>
<span class="line-modified">!         break;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       case &#39;n&#39;:</span>
<span class="line-modified">!         gstring = g_string_append_c (gstring, &#39;\n&#39;);</span>
<span class="line-modified">!         break;</span>
<span class="line-modified">! </span>
<span class="line-added">+       case &#39;t&#39;:</span>
<span class="line-added">+         gstring = g_string_append_c (gstring, &#39;\t&#39;);</span>
<span class="line-added">+         break;</span>
<span class="line-added">+ </span>
<span class="line-added">+       case &#39;r&#39;:</span>
<span class="line-added">+         gstring = g_string_append_c (gstring, &#39;\r&#39;);</span>
<span class="line-added">+         break;</span>
<span class="line-added">+ </span>
<span class="line-added">+       case &#39;b&#39;:</span>
<span class="line-added">+         gstring = g_string_append_c (gstring, &#39;\b&#39;);</span>
<span class="line-added">+         break;</span>
<span class="line-added">+ </span>
<span class="line-added">+       case &#39;f&#39;:</span>
<span class="line-added">+         gstring = g_string_append_c (gstring, &#39;\f&#39;);</span>
<span class="line-added">+         break;</span>
<span class="line-added">+ </span>
<span class="line-added">+       case &#39;0&#39;:</span>
<span class="line-added">+       case &#39;1&#39;:</span>
<span class="line-added">+       case &#39;2&#39;:</span>
<span class="line-added">+       case &#39;3&#39;:</span>
<span class="line-added">+       case &#39;4&#39;:</span>
<span class="line-added">+       case &#39;5&#39;:</span>
<span class="line-added">+       case &#39;6&#39;:</span>
<span class="line-added">+       case &#39;7&#39;:</span>
<span class="line-added">+         i = ch - &#39;0&#39;;</span>
<span class="line-added">+         fchar = g_scanner_peek_next_char (scanner);</span>
<span class="line-added">+         if (fchar &gt;= &#39;0&#39; &amp;&amp; fchar &lt;= &#39;7&#39;)</span>
<span class="line-added">+           {</span>
<span class="line-added">+             ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+             i = i * 8 + ch - &#39;0&#39;;</span>
<span class="line-added">+             fchar = g_scanner_peek_next_char (scanner);</span>
<span class="line-added">+             if (fchar &gt;= &#39;0&#39; &amp;&amp; fchar &lt;= &#39;7&#39;)</span>
          {
            ch = g_scanner_get_char (scanner, line_p, position_p);
<span class="line-modified">!           i = i * 8 + ch - &#39;0&#39;;</span>
          }
<span class="line-added">+           }</span>
<span class="line-added">+         gstring = g_string_append_c (gstring, i);</span>
<span class="line-added">+         break;</span>
<span class="line-added">+ </span>
<span class="line-added">+       default:</span>
<span class="line-added">+         gstring = g_string_append_c (gstring, ch);</span>
<span class="line-added">+         break;</span>
<span class="line-added">+       }</span>
          }
        else
<span class="line-modified">!         gstring = g_string_append_c (gstring, ch);</span>
<span class="line-modified">!     }</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     ch = 0;</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">! </span>
<span class="line-modified">!   case &#39;.&#39;:</span>
<span class="line-modified">!     if (!config-&gt;scan_float)</span>
<span class="line-modified">!       goto default_case;</span>
<span class="line-modified">!     token = G_TOKEN_FLOAT;</span>
<span class="line-modified">!     dotted_float = TRUE;</span>
<span class="line-modified">!     ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+     goto number_parsing;</span>
<span class="line-added">+ </span>
<span class="line-added">+   case &#39;$&#39;:</span>
<span class="line-added">+     if (!config-&gt;scan_hex_dollar)</span>
<span class="line-added">+       goto default_case;</span>
<span class="line-added">+     token = G_TOKEN_HEX;</span>
<span class="line-added">+     ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+     goto number_parsing;</span>
<span class="line-added">+ </span>
<span class="line-added">+   case &#39;0&#39;:</span>
<span class="line-added">+     if (config-&gt;scan_octal)</span>
<span class="line-added">+       token = G_TOKEN_OCTAL;</span>
<span class="line-added">+     else</span>
<span class="line-added">+       token = G_TOKEN_INT;</span>
<span class="line-added">+     ch = g_scanner_peek_next_char (scanner);</span>
<span class="line-added">+     if (config-&gt;scan_hex &amp;&amp; (ch == &#39;x&#39; || ch == &#39;X&#39;))</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_HEX;</span>
<span class="line-added">+         g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+         ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+         if (ch == 0)</span>
<span class="line-added">+     {</span>
<span class="line-added">+       token = G_TOKEN_ERROR;</span>
<span class="line-added">+       value.v_error = G_ERR_UNEXP_EOF;</span>
<span class="line-added">+       (*position_p)++;</span>
<span class="line-added">+       break;</span>
<span class="line-added">+     }</span>
<span class="line-added">+         if (g_scanner_char_2_num (ch, 16) &lt; 0)</span>
<span class="line-added">+     {</span>
<span class="line-added">+       token = G_TOKEN_ERROR;</span>
<span class="line-added">+       value.v_error = G_ERR_DIGIT_RADIX;</span>
<span class="line-added">+       ch = 0;</span>
<span class="line-added">+       break;</span>
<span class="line-added">+     }</span>
<span class="line-added">+       }</span>
<span class="line-added">+     else if (config-&gt;scan_binary &amp;&amp; (ch == &#39;b&#39; || ch == &#39;B&#39;))</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_BINARY;</span>
<span class="line-added">+         g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+         ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+         if (ch == 0)</span>
      {
<span class="line-added">+       token = G_TOKEN_ERROR;</span>
<span class="line-added">+       value.v_error = G_ERR_UNEXP_EOF;</span>
<span class="line-added">+       (*position_p)++;</span>
<span class="line-added">+       break;</span>
<span class="line-added">+     }</span>
<span class="line-added">+         if (g_scanner_char_2_num (ch, 10) &lt; 0)</span>
<span class="line-added">+     {</span>
<span class="line-added">+       token = G_TOKEN_ERROR;</span>
<span class="line-added">+       value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-added">+       ch = 0;</span>
<span class="line-added">+       break;</span>
<span class="line-added">+     }</span>
<span class="line-added">+       }</span>
<span class="line-added">+     else</span>
<span class="line-added">+       ch = &#39;0&#39;;</span>
<span class="line-added">+     /* fall through */</span>
<span class="line-added">+   case &#39;1&#39;:</span>
<span class="line-added">+   case &#39;2&#39;:</span>
<span class="line-added">+   case &#39;3&#39;:</span>
<span class="line-added">+   case &#39;4&#39;:</span>
<span class="line-added">+   case &#39;5&#39;:</span>
<span class="line-added">+   case &#39;6&#39;:</span>
<span class="line-added">+   case &#39;7&#39;:</span>
<span class="line-added">+   case &#39;8&#39;:</span>
<span class="line-added">+   case &#39;9&#39;:</span>
<span class="line-added">+   number_parsing:</span>
<span class="line-added">+   {</span>
            gboolean in_number = TRUE;
<span class="line-modified">!     gchar *endptr;</span>
  
<span class="line-modified">!     if (token == G_TOKEN_NONE)</span>
<span class="line-modified">!       token = G_TOKEN_INT;</span>
  
<span class="line-modified">!     gstring = g_string_new (dotted_float ? &quot;0.&quot; : &quot;&quot;);</span>
<span class="line-modified">!     gstring = g_string_append_c (gstring, ch);</span>
  
<span class="line-modified">!     do /* while (in_number) */</span>
<span class="line-added">+       {</span>
<span class="line-added">+         gboolean is_E;</span>
  
<span class="line-modified">!         is_E = token == G_TOKEN_FLOAT &amp;&amp; (ch == &#39;e&#39; || ch == &#39;E&#39;);</span>
  
<span class="line-modified">!         ch = g_scanner_peek_next_char (scanner);</span>
  
<span class="line-modified">!         if (g_scanner_char_2_num (ch, 36) &gt;= 0 ||</span>
<span class="line-modified">!       (config-&gt;scan_float &amp;&amp; ch == &#39;.&#39;) ||</span>
<span class="line-modified">!       (is_E &amp;&amp; (ch == &#39;+&#39; || ch == &#39;-&#39;)))</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       ch = g_scanner_get_char (scanner, line_p, position_p);</span>
  
<span class="line-modified">!       switch (ch)</span>
          {
<span class="line-modified">!         case &#39;.&#39;:</span>
<span class="line-modified">!           if (token != G_TOKEN_INT &amp;&amp; token != G_TOKEN_OCTAL)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         value.v_error = token == G_TOKEN_FLOAT ? G_ERR_FLOAT_MALFORMED : G_ERR_FLOAT_RADIX;</span>
<span class="line-modified">!         token = G_TOKEN_ERROR;</span>
<span class="line-added">+         in_number = FALSE;</span>
<span class="line-added">+       }</span>
<span class="line-added">+           else</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_FLOAT;</span>
<span class="line-added">+         gstring = g_string_append_c (gstring, ch);</span>
<span class="line-added">+       }</span>
            break;
<span class="line-modified">! </span>
<span class="line-modified">!         case &#39;0&#39;:</span>
<span class="line-added">+         case &#39;1&#39;:</span>
<span class="line-added">+         case &#39;2&#39;:</span>
<span class="line-added">+         case &#39;3&#39;:</span>
<span class="line-added">+         case &#39;4&#39;:</span>
<span class="line-added">+         case &#39;5&#39;:</span>
<span class="line-added">+         case &#39;6&#39;:</span>
<span class="line-added">+         case &#39;7&#39;:</span>
<span class="line-added">+         case &#39;8&#39;:</span>
<span class="line-added">+         case &#39;9&#39;:</span>
<span class="line-added">+           gstring = g_string_append_c (gstring, ch);</span>
            break;
<span class="line-modified">! </span>
<span class="line-modified">!         case &#39;-&#39;:</span>
<span class="line-added">+         case &#39;+&#39;:</span>
<span class="line-added">+           if (token != G_TOKEN_FLOAT)</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_ERROR;</span>
<span class="line-added">+         value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-added">+         in_number = FALSE;</span>
<span class="line-added">+       }</span>
<span class="line-added">+           else</span>
<span class="line-added">+       gstring = g_string_append_c (gstring, ch);</span>
            break;
<span class="line-modified">! </span>
<span class="line-modified">!         case &#39;e&#39;:</span>
<span class="line-modified">!         case &#39;E&#39;:</span>
<span class="line-modified">!           if ((token != G_TOKEN_HEX &amp;&amp; !config-&gt;scan_float) ||</span>
<span class="line-added">+         (token != G_TOKEN_HEX &amp;&amp;</span>
<span class="line-added">+          token != G_TOKEN_OCTAL &amp;&amp;</span>
<span class="line-added">+          token != G_TOKEN_FLOAT &amp;&amp;</span>
<span class="line-added">+          token != G_TOKEN_INT))</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_ERROR;</span>
<span class="line-added">+         value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-added">+         in_number = FALSE;</span>
<span class="line-added">+       }</span>
            else
<span class="line-modified">!       {</span>
<span class="line-modified">!         if (token != G_TOKEN_HEX)</span>
<span class="line-modified">!           token = G_TOKEN_FLOAT;</span>
<span class="line-modified">!         gstring = g_string_append_c (gstring, ch);</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!           break;</span>
<span class="line-added">+ </span>
<span class="line-added">+         default:</span>
<span class="line-added">+           if (token != G_TOKEN_HEX)</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_ERROR;</span>
          value.v_error = G_ERR_NON_DIGIT_IN_CONST;
<span class="line-added">+         in_number = FALSE;</span>
<span class="line-added">+       }</span>
            else
<span class="line-modified">!       gstring = g_string_append_c (gstring, ch);</span>
<span class="line-added">+           break;</span>
          }
<span class="line-modified">!     }</span>
<span class="line-modified">!         else</span>
<span class="line-modified">!     in_number = FALSE;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     while (in_number);</span>
<span class="line-modified">! </span>
<span class="line-modified">!     endptr = NULL;</span>
<span class="line-modified">!     if (token == G_TOKEN_FLOAT)</span>
<span class="line-added">+       value.v_float = g_strtod (gstring-&gt;str, &amp;endptr);</span>
<span class="line-added">+     else</span>
<span class="line-added">+       {</span>
<span class="line-added">+         guint64 ui64 = 0;</span>
<span class="line-added">+         switch (token)</span>
      {
<span class="line-modified">!     case G_TOKEN_BINARY:</span>
<span class="line-modified">!       ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 2);</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     case G_TOKEN_OCTAL:</span>
<span class="line-modified">!       ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 8);</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     case G_TOKEN_INT:</span>
<span class="line-modified">!       ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 10);</span>
<span class="line-added">+       break;</span>
<span class="line-added">+     case G_TOKEN_HEX:</span>
<span class="line-added">+       ui64 = g_ascii_strtoull (gstring-&gt;str, &amp;endptr, 16);</span>
<span class="line-added">+       break;</span>
<span class="line-added">+     default: ;</span>
<span class="line-added">+     }</span>
<span class="line-added">+         if (scanner-&gt;config-&gt;store_int64)</span>
<span class="line-added">+     value.v_int64 = ui64;</span>
<span class="line-added">+         else</span>
<span class="line-added">+     value.v_int = ui64;</span>
<span class="line-added">+       }</span>
<span class="line-added">+     if (endptr &amp;&amp; *endptr)</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_ERROR;</span>
<span class="line-added">+         if (*endptr == &#39;e&#39; || *endptr == &#39;E&#39;)</span>
<span class="line-added">+     value.v_error = G_ERR_NON_DIGIT_IN_CONST;</span>
<span class="line-added">+         else</span>
<span class="line-added">+     value.v_error = G_ERR_DIGIT_RADIX;</span>
<span class="line-added">+       }</span>
<span class="line-added">+     g_string_free (gstring, TRUE);</span>
<span class="line-added">+     gstring = NULL;</span>
<span class="line-added">+     ch = 0;</span>
<span class="line-added">+   } /* number_parsing:... */</span>
<span class="line-added">+   break;</span>
<span class="line-added">+ </span>
<span class="line-added">+   default:</span>
<span class="line-added">+   default_case:</span>
<span class="line-added">+   {</span>
<span class="line-added">+     if (config-&gt;cpair_comment_single &amp;&amp;</span>
<span class="line-added">+         ch == config-&gt;cpair_comment_single[0])</span>
<span class="line-added">+       {</span>
<span class="line-added">+         token = G_TOKEN_COMMENT_SINGLE;</span>
<span class="line-added">+         in_comment_single = TRUE;</span>
<span class="line-added">+         gstring = g_string_new (NULL);</span>
<span class="line-added">+         ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-added">+         while (ch != 0)</span>
<span class="line-added">+     {</span>
<span class="line-added">+       if (ch == config-&gt;cpair_comment_single[1])</span>
          {
<span class="line-modified">!           in_comment_single = FALSE;</span>
<span class="line-modified">!           ch = 0;</span>
<span class="line-modified">!           break;</span>
          }
  
<span class="line-modified">!       gstring = g_string_append_c (gstring, ch);</span>
<span class="line-modified">!       ch = g_scanner_get_char (scanner, line_p, position_p);</span>
<span class="line-modified">!     }</span>
<span class="line-added">+         /* ignore a missing newline at EOF for single line comments */</span>
<span class="line-added">+         if (in_comment_single &amp;&amp;</span>
<span class="line-added">+       config-&gt;cpair_comment_single[1] == &#39;\n&#39;)</span>
<span class="line-added">+     in_comment_single = FALSE;</span>
<span class="line-added">+       }</span>
<span class="line-added">+     else if (config-&gt;scan_identifier &amp;&amp; ch &amp;&amp;</span>
<span class="line-added">+        strchr (config-&gt;cset_identifier_first, ch))</span>
<span class="line-added">+       {</span>
<span class="line-added">+       identifier_precedence:</span>
<span class="line-added">+ </span>
<span class="line-added">+         if (config-&gt;cset_identifier_nth &amp;&amp; ch &amp;&amp;</span>
<span class="line-added">+       strchr (config-&gt;cset_identifier_nth,</span>
<span class="line-added">+         g_scanner_peek_next_char (scanner)))</span>
<span class="line-added">+     {</span>
<span class="line-added">+       token = G_TOKEN_IDENTIFIER;</span>
<span class="line-added">+       gstring = g_string_new (NULL);</span>
<span class="line-added">+       gstring = g_string_append_c (gstring, ch);</span>
<span class="line-added">+       do</span>
          {
<span class="line-modified">!           ch = g_scanner_get_char (scanner, line_p, position_p);</span>
            gstring = g_string_append_c (gstring, ch);
<span class="line-modified">!           ch = g_scanner_peek_next_char (scanner);</span>
          }
<span class="line-modified">!       while (ch &amp;&amp; strchr (config-&gt;cset_identifier_nth, ch));</span>
<span class="line-modified">!       ch = 0;</span>
<span class="line-added">+     }</span>
<span class="line-added">+         else if (config-&gt;scan_identifier_1char)</span>
<span class="line-added">+     {</span>
<span class="line-added">+       token = G_TOKEN_IDENTIFIER;</span>
<span class="line-added">+       value.v_identifier = g_new0 (gchar, 2);</span>
<span class="line-added">+       value.v_identifier[0] = ch;</span>
<span class="line-added">+       ch = 0;</span>
<span class="line-added">+     }</span>
<span class="line-added">+       }</span>
<span class="line-added">+     if (ch)</span>
<span class="line-added">+       {</span>
<span class="line-added">+         if (config-&gt;char_2_token)</span>
<span class="line-added">+     token = ch;</span>
<span class="line-added">+         else</span>
<span class="line-added">+     {</span>
<span class="line-added">+       token = G_TOKEN_CHAR;</span>
<span class="line-added">+       value.v_char = ch;</span>
      }
<span class="line-added">+         ch = 0;</span>
<span class="line-added">+       }</span>
<span class="line-added">+   } /* default_case:... */</span>
<span class="line-added">+   break;</span>
<span class="line-added">+   }</span>
        g_assert (ch == 0 &amp;&amp; token != G_TOKEN_NONE); /* paranoid */
      }
    while (ch != 0);
  
    if (in_comment_multi || in_comment_single ||
        in_string_sq || in_string_dq)
      {
        token = G_TOKEN_ERROR;
        if (gstring)
<span class="line-modified">!   {</span>
<span class="line-modified">!     g_string_free (gstring, TRUE);</span>
<span class="line-modified">!     gstring = NULL;</span>
<span class="line-modified">!   }</span>
        (*position_p)++;
        if (in_comment_multi || in_comment_single)
<span class="line-modified">!   value.v_error = G_ERR_UNEXP_EOF_IN_COMMENT;</span>
        else /* (in_string_sq || in_string_dq) */
<span class="line-modified">!   value.v_error = G_ERR_UNEXP_EOF_IN_STRING;</span>
      }
  
    if (gstring)
      {
        value.v_string = g_string_free (gstring, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2205,55 ***</span>
      }
  
    if (token == G_TOKEN_IDENTIFIER)
      {
        if (config-&gt;scan_symbols)
<span class="line-modified">!     {</span>
<span class="line-modified">!       GScannerKey *key;</span>
<span class="line-modified">!       guint scope_id;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       scope_id = scanner-&gt;scope_id;</span>
<span class="line-modified">!       key = g_scanner_lookup_internal (scanner, scope_id, value.v_identifier);</span>
<span class="line-modified">!       if (!key &amp;&amp; scope_id &amp;&amp; scanner-&gt;config-&gt;scope_0_fallback)</span>
<span class="line-modified">!         key = g_scanner_lookup_internal (scanner, 0, value.v_identifier);</span>
<span class="line-modified">! </span>
<span class="line-modified">!       if (key)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           g_free (value.v_identifier);</span>
<span class="line-modified">!           token = G_TOKEN_SYMBOL;</span>
<span class="line-modified">!           value.v_symbol = key-&gt;value;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
  
        if (token == G_TOKEN_IDENTIFIER &amp;&amp;
<span class="line-modified">!       config-&gt;scan_identifier_NULL &amp;&amp;</span>
<span class="line-modified">!       strlen (value.v_identifier) == 4)</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       gchar *null_upper = &quot;NULL&quot;;</span>
<span class="line-modified">!       gchar *null_lower = &quot;null&quot;;</span>
<span class="line-modified">! </span>
<span class="line-modified">!       if (scanner-&gt;config-&gt;case_sensitive)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           if (value.v_identifier[0] == null_upper[0] &amp;&amp;</span>
<span class="line-modified">!           value.v_identifier[1] == null_upper[1] &amp;&amp;</span>
<span class="line-modified">!           value.v_identifier[2] == null_upper[2] &amp;&amp;</span>
<span class="line-modified">!           value.v_identifier[3] == null_upper[3])</span>
<span class="line-modified">!         token = G_TOKEN_IDENTIFIER_NULL;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           if ((value.v_identifier[0] == null_upper[0] ||</span>
<span class="line-modified">!            value.v_identifier[0] == null_lower[0]) &amp;&amp;</span>
<span class="line-modified">!           (value.v_identifier[1] == null_upper[1] ||</span>
<span class="line-modified">!            value.v_identifier[1] == null_lower[1]) &amp;&amp;</span>
<span class="line-modified">!           (value.v_identifier[2] == null_upper[2] ||</span>
<span class="line-modified">!            value.v_identifier[2] == null_lower[2]) &amp;&amp;</span>
<span class="line-modified">!           (value.v_identifier[3] == null_upper[3] ||</span>
<span class="line-modified">!            value.v_identifier[3] == null_lower[3]))</span>
<span class="line-modified">!         token = G_TOKEN_IDENTIFIER_NULL;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
      }
  
    *token_p = token;
    *value_p = value;
  }
<span class="line-new-header">--- 2206,55 ---</span>
      }
  
    if (token == G_TOKEN_IDENTIFIER)
      {
        if (config-&gt;scan_symbols)
<span class="line-modified">!   {</span>
<span class="line-modified">!     GScannerKey *key;</span>
<span class="line-modified">!     guint scope_id;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     scope_id = scanner-&gt;scope_id;</span>
<span class="line-modified">!     key = g_scanner_lookup_internal (scanner, scope_id, value.v_identifier);</span>
<span class="line-modified">!     if (!key &amp;&amp; scope_id &amp;&amp; scanner-&gt;config-&gt;scope_0_fallback)</span>
<span class="line-modified">!       key = g_scanner_lookup_internal (scanner, 0, value.v_identifier);</span>
<span class="line-modified">! </span>
<span class="line-modified">!     if (key)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         g_free (value.v_identifier);</span>
<span class="line-modified">!         token = G_TOKEN_SYMBOL;</span>
<span class="line-modified">!         value.v_symbol = key-&gt;value;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!   }</span>
  
        if (token == G_TOKEN_IDENTIFIER &amp;&amp;
<span class="line-modified">!     config-&gt;scan_identifier_NULL &amp;&amp;</span>
<span class="line-modified">!     strlen (value.v_identifier) == 4)</span>
<span class="line-modified">!   {</span>
<span class="line-modified">!     gchar *null_upper = &quot;NULL&quot;;</span>
<span class="line-modified">!     gchar *null_lower = &quot;null&quot;;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     if (scanner-&gt;config-&gt;case_sensitive)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         if (value.v_identifier[0] == null_upper[0] &amp;&amp;</span>
<span class="line-modified">!       value.v_identifier[1] == null_upper[1] &amp;&amp;</span>
<span class="line-modified">!       value.v_identifier[2] == null_upper[2] &amp;&amp;</span>
<span class="line-modified">!       value.v_identifier[3] == null_upper[3])</span>
<span class="line-modified">!     token = G_TOKEN_IDENTIFIER_NULL;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         if ((value.v_identifier[0] == null_upper[0] ||</span>
<span class="line-modified">!        value.v_identifier[0] == null_lower[0]) &amp;&amp;</span>
<span class="line-modified">!       (value.v_identifier[1] == null_upper[1] ||</span>
<span class="line-modified">!        value.v_identifier[1] == null_lower[1]) &amp;&amp;</span>
<span class="line-modified">!       (value.v_identifier[2] == null_upper[2] ||</span>
<span class="line-modified">!        value.v_identifier[2] == null_lower[2]) &amp;&amp;</span>
<span class="line-modified">!       (value.v_identifier[3] == null_upper[3] ||</span>
<span class="line-modified">!        value.v_identifier[3] == null_lower[3]))</span>
<span class="line-modified">!     token = G_TOKEN_IDENTIFIER_NULL;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!   }</span>
      }
  
    *token_p = token;
    *value_p = value;
  }
</pre>
<center><a href="gregex.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gscanner.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>