<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gkeyfile.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="giowin32.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gkeyfile.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gkeyfile.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 536,93 ***</span>
    gchar *key;  /* NULL for comments */
    gchar *value;
  };
  
  static gint                  find_file_in_data_dirs            (const gchar            *file,
<span class="line-modified">!                                 const gchar           **data_dirs,</span>
<span class="line-modified">!                                 gchar                 **output_file,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static gboolean              g_key_file_load_from_fd           (GKeyFile               *key_file,
<span class="line-modified">!                                 gint                    fd,</span>
<span class="line-modified">!                                 GKeyFileFlags           flags,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static GList                *g_key_file_lookup_group_node      (GKeyFile               *key_file,
<span class="line-modified">!                                                     const gchar            *group_name);</span>
  static GKeyFileGroup        *g_key_file_lookup_group           (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *group_name);</span>
  
  static GList                *g_key_file_lookup_key_value_pair_node  (GKeyFile       *key_file,
<span class="line-modified">!                                                          GKeyFileGroup  *group,</span>
                                                                       const gchar    *key);
  static GKeyFileKeyValuePair *g_key_file_lookup_key_value_pair       (GKeyFile       *key_file,
                                                                       GKeyFileGroup  *group,
                                                                       const gchar    *key);
  
  static void                  g_key_file_remove_group_node          (GKeyFile      *key_file,
<span class="line-modified">!                                     GList         *group_node);</span>
  static void                  g_key_file_remove_key_value_pair_node (GKeyFile      *key_file,
                                                                      GKeyFileGroup *group,
                                                                      GList         *pair_node);
  
  static void                  g_key_file_add_key_value_pair     (GKeyFile               *key_file,
                                                                  GKeyFileGroup          *group,
                                                                  GKeyFileKeyValuePair   *pair);
  static void                  g_key_file_add_key                (GKeyFile               *key_file,
<span class="line-modified">!                                 GKeyFileGroup          *group,</span>
<span class="line-modified">!                                 const gchar            *key,</span>
<span class="line-modified">!                                 const gchar            *value);</span>
  static void                  g_key_file_add_group              (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *group_name);</span>
  static gboolean              g_key_file_is_group_name          (const gchar *name);
  static gboolean              g_key_file_is_key_name            (const gchar *name);
  static void                  g_key_file_key_value_pair_free    (GKeyFileKeyValuePair   *pair);
  static gboolean              g_key_file_line_is_comment        (const gchar            *line);
  static gboolean              g_key_file_line_is_group          (const gchar            *line);
  static gboolean              g_key_file_line_is_key_value_pair (const gchar            *line);
  static gchar                *g_key_file_parse_value_as_string  (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *value,</span>
<span class="line-modified">!                                 GSList                **separators,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static gchar                *g_key_file_parse_string_as_value  (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *string,</span>
<span class="line-modified">!                                 gboolean                escape_separator);</span>
  static gint                  g_key_file_parse_value_as_integer (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *value,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static gchar                *g_key_file_parse_integer_as_value (GKeyFile               *key_file,
<span class="line-modified">!                                 gint                    value);</span>
  static gdouble               g_key_file_parse_value_as_double  (GKeyFile               *key_file,
                                                                  const gchar            *value,
                                                                  GError                **error);
  static gboolean              g_key_file_parse_value_as_boolean (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *value,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static gchar                *g_key_file_parse_boolean_as_value (GKeyFile               *key_file,
<span class="line-modified">!                                 gboolean                value);</span>
  static gchar                *g_key_file_parse_value_as_comment (GKeyFile               *key_file,
<span class="line-modified">!                                                                 const gchar            *value);</span>
  static gchar                *g_key_file_parse_comment_as_value (GKeyFile               *key_file,
                                                                  const gchar            *comment);
  static void                  g_key_file_parse_key_value_pair   (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *line,</span>
<span class="line-modified">!                                 gsize                   length,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static void                  g_key_file_parse_comment          (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *line,</span>
<span class="line-modified">!                                 gsize                   length,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static void                  g_key_file_parse_group            (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *line,</span>
<span class="line-modified">!                                 gsize                   length,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static gchar                *key_get_locale                    (const gchar            *key);
  static void                  g_key_file_parse_data             (GKeyFile               *key_file,
<span class="line-modified">!                                 const gchar            *data,</span>
<span class="line-modified">!                                 gsize                   length,</span>
<span class="line-modified">!                                 GError                **error);</span>
  static void                  g_key_file_flush_parse_buffer     (GKeyFile               *key_file,
<span class="line-modified">!                                 GError                **error);</span>
  
  G_DEFINE_QUARK (g-key-file-error-quark, g_key_file_error)
  
  static void
  g_key_file_init (GKeyFile *key_file)
<span class="line-new-header">--- 536,94 ---</span>
    gchar *key;  /* NULL for comments */
    gchar *value;
  };
  
  static gint                  find_file_in_data_dirs            (const gchar            *file,
<span class="line-modified">!                 const gchar           **data_dirs,</span>
<span class="line-modified">!                 gchar                 **output_file,</span>
<span class="line-modified">!                 GError                **error);</span>
  static gboolean              g_key_file_load_from_fd           (GKeyFile               *key_file,
<span class="line-modified">!                 gint                    fd,</span>
<span class="line-modified">!                 GKeyFileFlags           flags,</span>
<span class="line-modified">!                 GError                **error);</span>
  static GList                *g_key_file_lookup_group_node      (GKeyFile               *key_file,
<span class="line-modified">!                                               const gchar            *group_name);</span>
  static GKeyFileGroup        *g_key_file_lookup_group           (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *group_name);</span>
  
  static GList                *g_key_file_lookup_key_value_pair_node  (GKeyFile       *key_file,
<span class="line-modified">!                                                    GKeyFileGroup  *group,</span>
                                                                       const gchar    *key);
  static GKeyFileKeyValuePair *g_key_file_lookup_key_value_pair       (GKeyFile       *key_file,
                                                                       GKeyFileGroup  *group,
                                                                       const gchar    *key);
  
  static void                  g_key_file_remove_group_node          (GKeyFile      *key_file,
<span class="line-modified">!                       GList         *group_node);</span>
  static void                  g_key_file_remove_key_value_pair_node (GKeyFile      *key_file,
                                                                      GKeyFileGroup *group,
                                                                      GList         *pair_node);
  
  static void                  g_key_file_add_key_value_pair     (GKeyFile               *key_file,
                                                                  GKeyFileGroup          *group,
                                                                  GKeyFileKeyValuePair   *pair);
  static void                  g_key_file_add_key                (GKeyFile               *key_file,
<span class="line-modified">!                 GKeyFileGroup          *group,</span>
<span class="line-modified">!                 const gchar            *key,</span>
<span class="line-modified">!                 const gchar            *value);</span>
  static void                  g_key_file_add_group              (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *group_name);</span>
  static gboolean              g_key_file_is_group_name          (const gchar *name);
  static gboolean              g_key_file_is_key_name            (const gchar *name);
  static void                  g_key_file_key_value_pair_free    (GKeyFileKeyValuePair   *pair);
  static gboolean              g_key_file_line_is_comment        (const gchar            *line);
  static gboolean              g_key_file_line_is_group          (const gchar            *line);
  static gboolean              g_key_file_line_is_key_value_pair (const gchar            *line);
  static gchar                *g_key_file_parse_value_as_string  (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *value,</span>
<span class="line-modified">!                 GSList                **separators,</span>
<span class="line-modified">!                 GError                **error);</span>
  static gchar                *g_key_file_parse_string_as_value  (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *string,</span>
<span class="line-modified">!                 gboolean                escape_separator);</span>
  static gint                  g_key_file_parse_value_as_integer (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *value,</span>
<span class="line-modified">!                 GError                **error);</span>
  static gchar                *g_key_file_parse_integer_as_value (GKeyFile               *key_file,
<span class="line-modified">!                 gint                    value);</span>
  static gdouble               g_key_file_parse_value_as_double  (GKeyFile               *key_file,
                                                                  const gchar            *value,
                                                                  GError                **error);
  static gboolean              g_key_file_parse_value_as_boolean (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *value,</span>
<span class="line-modified">!                 GError                **error);</span>
  static gchar                *g_key_file_parse_boolean_as_value (GKeyFile               *key_file,
<span class="line-modified">!                 gboolean                value);</span>
  static gchar                *g_key_file_parse_value_as_comment (GKeyFile               *key_file,
<span class="line-modified">!                                                                 const gchar            *value,</span>
<span class="line-added">+                                                                 gboolean                is_final_line);</span>
  static gchar                *g_key_file_parse_comment_as_value (GKeyFile               *key_file,
                                                                  const gchar            *comment);
  static void                  g_key_file_parse_key_value_pair   (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *line,</span>
<span class="line-modified">!                 gsize                   length,</span>
<span class="line-modified">!                 GError                **error);</span>
  static void                  g_key_file_parse_comment          (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *line,</span>
<span class="line-modified">!                 gsize                   length,</span>
<span class="line-modified">!                 GError                **error);</span>
  static void                  g_key_file_parse_group            (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *line,</span>
<span class="line-modified">!                 gsize                   length,</span>
<span class="line-modified">!                 GError                **error);</span>
  static gchar                *key_get_locale                    (const gchar            *key);
  static void                  g_key_file_parse_data             (GKeyFile               *key_file,
<span class="line-modified">!                 const gchar            *data,</span>
<span class="line-modified">!                 gsize                   length,</span>
<span class="line-modified">!                 GError                **error);</span>
  static void                  g_key_file_flush_parse_buffer     (GKeyFile               *key_file,
<span class="line-modified">!                 GError                **error);</span>
  
  G_DEFINE_QUARK (g-key-file-error-quark, g_key_file_error)
  
  static void
  g_key_file_init (GKeyFile *key_file)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 707,11 ***</span>
   *
   * Since: 2.6
   */
  void
  g_key_file_set_list_separator (GKeyFile *key_file,
<span class="line-modified">!                    gchar     separator)</span>
  {
    g_return_if_fail (key_file != NULL);
  
    key_file-&gt;list_separator = separator;
  }
<span class="line-new-header">--- 708,11 ---</span>
   *
   * Since: 2.6
   */
  void
  g_key_file_set_list_separator (GKeyFile *key_file,
<span class="line-modified">!              gchar     separator)</span>
  {
    g_return_if_fail (key_file != NULL);
  
    key_file-&gt;list_separator = separator;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 797,13 ***</span>
    return fd;
  }
  
  static gboolean
  g_key_file_load_from_fd (GKeyFile       *key_file,
<span class="line-modified">!              gint            fd,</span>
<span class="line-modified">!              GKeyFileFlags   flags,</span>
<span class="line-modified">!              GError        **error)</span>
  {
    GError *key_file_error = NULL;
    gssize bytes_read;
    struct stat stat_buf;
    gchar read_buf[4096];
<span class="line-new-header">--- 798,13 ---</span>
    return fd;
  }
  
  static gboolean
  g_key_file_load_from_fd (GKeyFile       *key_file,
<span class="line-modified">!        gint            fd,</span>
<span class="line-modified">!        GKeyFileFlags   flags,</span>
<span class="line-modified">!        GError        **error)</span>
  {
    GError *key_file_error = NULL;
    gssize bytes_read;
    struct stat stat_buf;
    gchar read_buf[4096];
</pre>
<hr />
<pre>
<span class="line-old-header">*** 852,12 ***</span>
                                 g_strerror (errsv));
            return FALSE;
          }
  
        g_key_file_parse_data (key_file,
<span class="line-modified">!                  read_buf, bytes_read,</span>
<span class="line-modified">!                  &amp;key_file_error);</span>
      }
    while (!key_file_error);
  
    if (key_file_error)
      {
<span class="line-new-header">--- 853,12 ---</span>
                                 g_strerror (errsv));
            return FALSE;
          }
  
        g_key_file_parse_data (key_file,
<span class="line-modified">!            read_buf, bytes_read,</span>
<span class="line-modified">!            &amp;key_file_error);</span>
      }
    while (!key_file_error);
  
    if (key_file_error)
      {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 896,13 ***</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_load_from_file (GKeyFile       *key_file,
<span class="line-modified">!                const gchar    *file,</span>
<span class="line-modified">!                GKeyFileFlags   flags,</span>
<span class="line-modified">!                GError        **error)</span>
  {
    GError *key_file_error = NULL;
    gint fd;
    int errsv;
  
<span class="line-new-header">--- 897,13 ---</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_load_from_file (GKeyFile       *key_file,
<span class="line-modified">!          const gchar    *file,</span>
<span class="line-modified">!          GKeyFileFlags   flags,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    GError *key_file_error = NULL;
    gint fd;
    int errsv;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 947,14 ***</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_load_from_data (GKeyFile       *key_file,
<span class="line-modified">!                const gchar    *data,</span>
<span class="line-modified">!                gsize           length,</span>
<span class="line-modified">!                GKeyFileFlags   flags,</span>
<span class="line-modified">!                GError        **error)</span>
  {
    GError *key_file_error = NULL;
    gchar list_separator;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
<span class="line-new-header">--- 948,14 ---</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_load_from_data (GKeyFile       *key_file,
<span class="line-modified">!          const gchar    *data,</span>
<span class="line-modified">!          gsize           length,</span>
<span class="line-modified">!          GKeyFileFlags   flags,</span>
<span class="line-modified">!          GError        **error)</span>
  {
    GError *key_file_error = NULL;
    gchar list_separator;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1073,21 ***</span>
  
        if (fd == -1)
          {
            if (key_file_error)
              g_propagate_error (error, key_file_error);
<span class="line-modified">!       break;</span>
          }
  
        found_file = g_key_file_load_from_fd (key_file, fd, flags,
<span class="line-modified">!                                         &amp;key_file_error);</span>
        close (fd);
  
        if (key_file_error)
          {
<span class="line-modified">!       g_propagate_error (error, key_file_error);</span>
<span class="line-modified">!       break;</span>
          }
      }
  
    if (found_file &amp;&amp; full_path)
      *full_path = output_path;
<span class="line-new-header">--- 1074,21 ---</span>
  
        if (fd == -1)
          {
            if (key_file_error)
              g_propagate_error (error, key_file_error);
<span class="line-modified">!     break;</span>
          }
  
        found_file = g_key_file_load_from_fd (key_file, fd, flags,
<span class="line-modified">!                                       &amp;key_file_error);</span>
        close (fd);
  
        if (key_file_error)
          {
<span class="line-modified">!     g_propagate_error (error, key_file_error);</span>
<span class="line-modified">!     break;</span>
          }
      }
  
    if (found_file &amp;&amp; full_path)
      *full_path = output_path;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1115,14 ***</span>
   * Returns: %TRUE if a key file could be loaded, %FALSE othewise
   * Since: 2.6
   **/
  gboolean
  g_key_file_load_from_data_dirs (GKeyFile       *key_file,
<span class="line-modified">!                 const gchar    *file,</span>
<span class="line-modified">!                 gchar         **full_path,</span>
<span class="line-modified">!                 GKeyFileFlags   flags,</span>
<span class="line-modified">!                 GError        **error)</span>
  {
    gchar **all_data_dirs;
    const gchar * user_data_dir;
    const gchar * const * system_data_dirs;
    gsize i, j;
<span class="line-new-header">--- 1116,14 ---</span>
   * Returns: %TRUE if a key file could be loaded, %FALSE othewise
   * Since: 2.6
   **/
  gboolean
  g_key_file_load_from_data_dirs (GKeyFile       *key_file,
<span class="line-modified">!         const gchar    *file,</span>
<span class="line-modified">!         gchar         **full_path,</span>
<span class="line-modified">!         GKeyFileFlags   flags,</span>
<span class="line-modified">!         GError        **error)</span>
  {
    gchar **all_data_dirs;
    const gchar * user_data_dir;
    const gchar * const * system_data_dirs;
    gsize i, j;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1222,31 ***</span>
  /* If G_KEY_FILE_KEEP_TRANSLATIONS is not set, only returns
   * true for locales that match those in g_get_language_names().
   */
  static gboolean
  g_key_file_locale_is_interesting (GKeyFile    *key_file,
<span class="line-modified">!                   const gchar *locale)</span>
  {
    gsize i;
  
    if (key_file-&gt;flags &amp; G_KEY_FILE_KEEP_TRANSLATIONS)
      return TRUE;
  
    for (i = 0; key_file-&gt;locales[i] != NULL; i++)
      {
        if (g_ascii_strcasecmp (key_file-&gt;locales[i], locale) == 0)
<span class="line-modified">!     return TRUE;</span>
      }
  
    return FALSE;
  }
  
  static void
  g_key_file_parse_line (GKeyFile     *key_file,
<span class="line-modified">!                const gchar  *line,</span>
<span class="line-modified">!                gsize         length,</span>
<span class="line-modified">!                GError      **error)</span>
  {
    GError *parse_error = NULL;
    gchar *line_start;
  
    g_return_if_fail (key_file != NULL);
<span class="line-new-header">--- 1223,31 ---</span>
  /* If G_KEY_FILE_KEEP_TRANSLATIONS is not set, only returns
   * true for locales that match those in g_get_language_names().
   */
  static gboolean
  g_key_file_locale_is_interesting (GKeyFile    *key_file,
<span class="line-modified">!           const gchar *locale)</span>
  {
    gsize i;
  
    if (key_file-&gt;flags &amp; G_KEY_FILE_KEEP_TRANSLATIONS)
      return TRUE;
  
    for (i = 0; key_file-&gt;locales[i] != NULL; i++)
      {
        if (g_ascii_strcasecmp (key_file-&gt;locales[i], locale) == 0)
<span class="line-modified">!   return TRUE;</span>
      }
  
    return FALSE;
  }
  
  static void
  g_key_file_parse_line (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *line,</span>
<span class="line-modified">!            gsize         length,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    GError *parse_error = NULL;
    gchar *line_start;
  
    g_return_if_fail (key_file != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1258,16 ***</span>
  
    if (g_key_file_line_is_comment (line_start))
      g_key_file_parse_comment (key_file, line, length, &amp;parse_error);
    else if (g_key_file_line_is_group (line_start))
      g_key_file_parse_group (key_file, line_start,
<span class="line-modified">!                 length - (line_start - line),</span>
<span class="line-modified">!                 &amp;parse_error);</span>
    else if (g_key_file_line_is_key_value_pair (line_start))
      g_key_file_parse_key_value_pair (key_file, line_start,
<span class="line-modified">!                      length - (line_start - line),</span>
<span class="line-modified">!                      &amp;parse_error);</span>
    else
      {
        gchar *line_utf8 = g_utf8_make_valid (line, length);
        g_set_error (error, G_KEY_FILE_ERROR,
                     G_KEY_FILE_ERROR_PARSE,
<span class="line-new-header">--- 1259,16 ---</span>
  
    if (g_key_file_line_is_comment (line_start))
      g_key_file_parse_comment (key_file, line, length, &amp;parse_error);
    else if (g_key_file_line_is_group (line_start))
      g_key_file_parse_group (key_file, line_start,
<span class="line-modified">!           length - (line_start - line),</span>
<span class="line-modified">!           &amp;parse_error);</span>
    else if (g_key_file_line_is_key_value_pair (line_start))
      g_key_file_parse_key_value_pair (key_file, line_start,
<span class="line-modified">!              length - (line_start - line),</span>
<span class="line-modified">!              &amp;parse_error);</span>
    else
      {
        gchar *line_utf8 = g_utf8_make_valid (line, length);
        g_set_error (error, G_KEY_FILE_ERROR,
                     G_KEY_FILE_ERROR_PARSE,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1283,13 ***</span>
      g_propagate_error (error, parse_error);
  }
  
  static void
  g_key_file_parse_comment (GKeyFile     *key_file,
<span class="line-modified">!               const gchar  *line,</span>
<span class="line-modified">!               gsize         length,</span>
<span class="line-modified">!               GError      **error)</span>
  {
    GKeyFileKeyValuePair *pair;
  
    if (!(key_file-&gt;flags &amp; G_KEY_FILE_KEEP_COMMENTS))
      return;
<span class="line-new-header">--- 1284,13 ---</span>
      g_propagate_error (error, parse_error);
  }
  
  static void
  g_key_file_parse_comment (GKeyFile     *key_file,
<span class="line-modified">!         const gchar  *line,</span>
<span class="line-modified">!         gsize         length,</span>
<span class="line-modified">!         GError      **error)</span>
  {
    GKeyFileKeyValuePair *pair;
  
    if (!(key_file-&gt;flags &amp; G_KEY_FILE_KEEP_COMMENTS))
      return;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1310,13 ***</span>
      g_list_prepend (key_file-&gt;current_group-&gt;key_value_pairs, pair);
  }
  
  static void
  g_key_file_parse_group (GKeyFile     *key_file,
<span class="line-modified">!             const gchar  *line,</span>
<span class="line-modified">!             gsize         length,</span>
<span class="line-modified">!             GError      **error)</span>
  {
    gchar *group_name;
    const gchar *group_name_start, *group_name_end;
  
    /* advance past opening &#39;[&#39;
<span class="line-new-header">--- 1311,13 ---</span>
      g_list_prepend (key_file-&gt;current_group-&gt;key_value_pairs, pair);
  }
  
  static void
  g_key_file_parse_group (GKeyFile     *key_file,
<span class="line-modified">!       const gchar  *line,</span>
<span class="line-modified">!       gsize         length,</span>
<span class="line-modified">!       GError      **error)</span>
  {
    gchar *group_name;
    const gchar *group_name_start, *group_name_end;
  
    /* advance past opening &#39;[&#39;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1331,25 ***</span>
                            group_name_end - group_name_start);
  
    if (!g_key_file_is_group_name (group_name))
      {
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!            G_KEY_FILE_ERROR_PARSE,</span>
<span class="line-modified">!            _(&quot;Invalid group name: %s&quot;), group_name);</span>
        g_free (group_name);
        return;
      }
  
    g_key_file_add_group (key_file, group_name);
    g_free (group_name);
  }
  
  static void
  g_key_file_parse_key_value_pair (GKeyFile     *key_file,
<span class="line-modified">!                  const gchar  *line,</span>
<span class="line-modified">!                  gsize         length,</span>
<span class="line-modified">!                  GError      **error)</span>
  {
    gchar *key, *value, *key_end, *value_start, *locale;
    gsize key_len, value_len;
  
    if (key_file-&gt;current_group == NULL || key_file-&gt;current_group-&gt;name == NULL)
<span class="line-new-header">--- 1332,25 ---</span>
                            group_name_end - group_name_start);
  
    if (!g_key_file_is_group_name (group_name))
      {
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!        G_KEY_FILE_ERROR_PARSE,</span>
<span class="line-modified">!        _(&quot;Invalid group name: %s&quot;), group_name);</span>
        g_free (group_name);
        return;
      }
  
    g_key_file_add_group (key_file, group_name);
    g_free (group_name);
  }
  
  static void
  g_key_file_parse_key_value_pair (GKeyFile     *key_file,
<span class="line-modified">!          const gchar  *line,</span>
<span class="line-modified">!          gsize         length,</span>
<span class="line-modified">!          GError      **error)</span>
  {
    gchar *key, *value, *key_end, *value_start, *locale;
    gsize key_len, value_len;
  
    if (key_file-&gt;current_group == NULL || key_file-&gt;current_group-&gt;name == NULL)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1404,16 ***</span>
                   key_file-&gt;current_group-&gt;name) == 0
        &amp;&amp; strcmp (key, &quot;Encoding&quot;) == 0)
      {
        if (g_ascii_strcasecmp (value, &quot;UTF-8&quot;) != 0)
          {
<span class="line-modified">!       gchar *value_utf8 = g_utf8_make_valid (value, value_len);</span>
            g_set_error (error, G_KEY_FILE_ERROR,
                         G_KEY_FILE_ERROR_UNKNOWN_ENCODING,
                         _(&quot;Key file contains unsupported &quot;
<span class="line-modified">!                          &quot;encoding &#39;%s&#39;&quot;), value_utf8);</span>
<span class="line-modified">!           g_free (value_utf8);</span>
  
            g_free (key);
            g_free (value);
            return;
          }
<span class="line-new-header">--- 1405,16 ---</span>
                   key_file-&gt;current_group-&gt;name) == 0
        &amp;&amp; strcmp (key, &quot;Encoding&quot;) == 0)
      {
        if (g_ascii_strcasecmp (value, &quot;UTF-8&quot;) != 0)
          {
<span class="line-modified">!     gchar *value_utf8 = g_utf8_make_valid (value, value_len);</span>
            g_set_error (error, G_KEY_FILE_ERROR,
                         G_KEY_FILE_ERROR_UNKNOWN_ENCODING,
                         _(&quot;Key file contains unsupported &quot;
<span class="line-modified">!        &quot;encoding &#39;%s&#39;&quot;), value_utf8);</span>
<span class="line-modified">!     g_free (value_utf8);</span>
  
            g_free (key);
            g_free (value);
            return;
          }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1466,13 ***</span>
    return locale;
  }
  
  static void
  g_key_file_parse_data (GKeyFile     *key_file,
<span class="line-modified">!                const gchar  *data,</span>
<span class="line-modified">!                gsize         length,</span>
<span class="line-modified">!                GError      **error)</span>
  {
    GError *parse_error;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
<span class="line-new-header">--- 1467,13 ---</span>
    return locale;
  }
  
  static void
  g_key_file_parse_data (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *data,</span>
<span class="line-modified">!            gsize         length,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    GError *parse_error;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1483,16 ***</span>
    i = 0;
    while (i &lt; length)
      {
        if (data[i] == &#39;\n&#39;)
          {
<span class="line-modified">!       if (key_file-&gt;parse_buffer-&gt;len &gt; 0</span>
<span class="line-modified">!           &amp;&amp; (key_file-&gt;parse_buffer-&gt;str[key_file-&gt;parse_buffer-&gt;len - 1]</span>
<span class="line-modified">!           == &#39;\r&#39;))</span>
<span class="line-modified">!         g_string_erase (key_file-&gt;parse_buffer,</span>
<span class="line-modified">!                 key_file-&gt;parse_buffer-&gt;len - 1,</span>
<span class="line-modified">!                 1);</span>
  
            /* When a newline is encountered flush the parse buffer so that the
             * line can be parsed.  Note that completely blank lines won&#39;t show
             * up in the parse buffer, so they get parsed directly.
             */
<span class="line-new-header">--- 1484,16 ---</span>
    i = 0;
    while (i &lt; length)
      {
        if (data[i] == &#39;\n&#39;)
          {
<span class="line-modified">!     if (key_file-&gt;parse_buffer-&gt;len &gt; 0</span>
<span class="line-modified">!         &amp;&amp; (key_file-&gt;parse_buffer-&gt;str[key_file-&gt;parse_buffer-&gt;len - 1]</span>
<span class="line-modified">!       == &#39;\r&#39;))</span>
<span class="line-modified">!       g_string_erase (key_file-&gt;parse_buffer,</span>
<span class="line-modified">!           key_file-&gt;parse_buffer-&gt;len - 1,</span>
<span class="line-modified">!           1);</span>
  
            /* When a newline is encountered flush the parse buffer so that the
             * line can be parsed.  Note that completely blank lines won&#39;t show
             * up in the parse buffer, so they get parsed directly.
             */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1528,23 ***</span>
      }
  }
  
  static void
  g_key_file_flush_parse_buffer (GKeyFile  *key_file,
<span class="line-modified">!                    GError   **error)</span>
  {
    GError *file_error = NULL;
  
    g_return_if_fail (key_file != NULL);
  
    file_error = NULL;
  
    if (key_file-&gt;parse_buffer-&gt;len &gt; 0)
      {
        g_key_file_parse_line (key_file, key_file-&gt;parse_buffer-&gt;str,
<span class="line-modified">!                  key_file-&gt;parse_buffer-&gt;len,</span>
<span class="line-modified">!                  &amp;file_error);</span>
        g_string_erase (key_file-&gt;parse_buffer, 0, -1);
  
        if (file_error)
          {
            g_propagate_error (error, file_error);
<span class="line-new-header">--- 1529,23 ---</span>
      }
  }
  
  static void
  g_key_file_flush_parse_buffer (GKeyFile  *key_file,
<span class="line-modified">!              GError   **error)</span>
  {
    GError *file_error = NULL;
  
    g_return_if_fail (key_file != NULL);
  
    file_error = NULL;
  
    if (key_file-&gt;parse_buffer-&gt;len &gt; 0)
      {
        g_key_file_parse_line (key_file, key_file-&gt;parse_buffer-&gt;str,
<span class="line-modified">!            key_file-&gt;parse_buffer-&gt;len,</span>
<span class="line-modified">!            &amp;file_error);</span>
        g_string_erase (key_file-&gt;parse_buffer, 0, -1);
  
        if (file_error)
          {
            g_propagate_error (error, file_error);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1570,12 ***</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_to_data (GKeyFile  *key_file,
<span class="line-modified">!             gsize     *length,</span>
<span class="line-modified">!             GError   **error)</span>
  {
    GString *data_string;
    GList *group_node, *key_file_node;
  
    g_return_val_if_fail (key_file != NULL, NULL);
<span class="line-new-header">--- 1571,12 ---</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_to_data (GKeyFile  *key_file,
<span class="line-modified">!         gsize     *length,</span>
<span class="line-modified">!         GError   **error)</span>
  {
    GString *data_string;
    GList *group_node, *key_file_node;
  
    g_return_val_if_fail (key_file != NULL, NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1640,13 ***</span>
   *
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_keys (GKeyFile     *key_file,
<span class="line-modified">!              const gchar  *group_name,</span>
<span class="line-modified">!              gsize        *length,</span>
<span class="line-modified">!              GError      **error)</span>
  {
    GKeyFileGroup *group;
    GList *tmp;
    gchar **keys;
    gsize i, num_keys;
<span class="line-new-header">--- 1641,13 ---</span>
   *
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_keys (GKeyFile     *key_file,
<span class="line-modified">!          const gchar  *group_name,</span>
<span class="line-modified">!          gsize        *length,</span>
<span class="line-modified">!          GError      **error)</span>
  {
    GKeyFileGroup *group;
    GList *tmp;
    gchar **keys;
    gsize i, num_keys;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1675,11 ***</span>
        GKeyFileKeyValuePair *pair;
  
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (pair-&gt;key)
<span class="line-modified">!     num_keys++;</span>
      }
  
    keys = g_new (gchar *, num_keys + 1);
  
    i = num_keys - 1;
<span class="line-new-header">--- 1676,11 ---</span>
        GKeyFileKeyValuePair *pair;
  
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (pair-&gt;key)
<span class="line-modified">!   num_keys++;</span>
      }
  
    keys = g_new (gchar *, num_keys + 1);
  
    i = num_keys - 1;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1688,14 ***</span>
        GKeyFileKeyValuePair *pair;
  
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (pair-&gt;key)
<span class="line-modified">!     {</span>
<span class="line-modified">!       keys[i] = g_strdup (pair-&gt;key);</span>
<span class="line-modified">!       i--;</span>
<span class="line-modified">!     }</span>
      }
  
    keys[num_keys] = NULL;
  
    if (length)
<span class="line-new-header">--- 1689,14 ---</span>
        GKeyFileKeyValuePair *pair;
  
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (pair-&gt;key)
<span class="line-modified">!   {</span>
<span class="line-modified">!     keys[i] = g_strdup (pair-&gt;key);</span>
<span class="line-modified">!     i--;</span>
<span class="line-modified">!   }</span>
      }
  
    keys[num_keys] = NULL;
  
    if (length)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1738,11 ***</span>
   *   Use g_strfreev() to free it.
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_groups (GKeyFile *key_file,
<span class="line-modified">!                gsize    *length)</span>
  {
    GList *group_node;
    gchar **groups;
    gsize i, num_groups;
  
<span class="line-new-header">--- 1739,11 ---</span>
   *   Use g_strfreev() to free it.
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_groups (GKeyFile *key_file,
<span class="line-modified">!            gsize    *length)</span>
  {
    GList *group_node;
    gchar **groups;
    gsize i, num_groups;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1817,13 ***</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_get_value (GKeyFile     *key_file,
<span class="line-modified">!               const gchar  *group_name,</span>
<span class="line-modified">!               const gchar  *key,</span>
<span class="line-modified">!               GError      **error)</span>
  {
    GKeyFileGroup *group;
    GKeyFileKeyValuePair *pair;
    gchar *value = NULL;
  
<span class="line-new-header">--- 1818,13 ---</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_get_value (GKeyFile     *key_file,
<span class="line-modified">!           const gchar  *group_name,</span>
<span class="line-modified">!           const gchar  *key,</span>
<span class="line-modified">!           GError      **error)</span>
  {
    GKeyFileGroup *group;
    GKeyFileKeyValuePair *pair;
    gchar *value = NULL;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1872,13 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_value (GKeyFile    *key_file,
<span class="line-modified">!               const gchar *group_name,</span>
<span class="line-modified">!               const gchar *key,</span>
<span class="line-modified">!               const gchar *value)</span>
  {
    GKeyFileGroup *group;
    GKeyFileKeyValuePair *pair;
  
    g_return_if_fail (key_file != NULL);
<span class="line-new-header">--- 1873,13 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_value (GKeyFile    *key_file,
<span class="line-modified">!           const gchar *group_name,</span>
<span class="line-modified">!           const gchar *key,</span>
<span class="line-modified">!           const gchar *value)</span>
  {
    GKeyFileGroup *group;
    GKeyFileKeyValuePair *pair;
  
    g_return_if_fail (key_file != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1930,13 ***</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_get_string (GKeyFile     *key_file,
<span class="line-modified">!                const gchar  *group_name,</span>
<span class="line-modified">!                const gchar  *key,</span>
<span class="line-modified">!                GError      **error)</span>
  {
    gchar *value, *string_value;
    GError *key_file_error;
  
    g_return_val_if_fail (key_file != NULL, NULL);
<span class="line-new-header">--- 1931,13 ---</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_get_string (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *group_name,</span>
<span class="line-modified">!            const gchar  *key,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    gchar *value, *string_value;
    GError *key_file_error;
  
    g_return_val_if_fail (key_file != NULL, NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1965,11 ***</span>
  
        return NULL;
      }
  
    string_value = g_key_file_parse_value_as_string (key_file, value, NULL,
<span class="line-modified">!                            &amp;key_file_error);</span>
    g_free (value);
  
    if (key_file_error)
      {
        if (g_error_matches (key_file_error,
<span class="line-new-header">--- 1966,11 ---</span>
  
        return NULL;
      }
  
    string_value = g_key_file_parse_value_as_string (key_file, value, NULL,
<span class="line-modified">!                &amp;key_file_error);</span>
    g_free (value);
  
    if (key_file_error)
      {
        if (g_error_matches (key_file_error,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2005,13 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_string (GKeyFile    *key_file,
<span class="line-modified">!                const gchar *group_name,</span>
<span class="line-modified">!                const gchar *key,</span>
<span class="line-modified">!                const gchar *string)</span>
  {
    gchar *value;
  
    g_return_if_fail (key_file != NULL);
    g_return_if_fail (string != NULL);
<span class="line-new-header">--- 2006,13 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_string (GKeyFile    *key_file,
<span class="line-modified">!            const gchar *group_name,</span>
<span class="line-modified">!            const gchar *key,</span>
<span class="line-modified">!            const gchar *string)</span>
  {
    gchar *value;
  
    g_return_if_fail (key_file != NULL);
    g_return_if_fail (string != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2042,14 ***</span>
   *
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_string_list (GKeyFile     *key_file,
<span class="line-modified">!                 const gchar  *group_name,</span>
<span class="line-modified">!                 const gchar  *key,</span>
<span class="line-modified">!                 gsize        *length,</span>
<span class="line-modified">!                 GError      **error)</span>
  {
    GError *key_file_error = NULL;
    gchar *value, *string_value, **values;
    gint i, len;
    GSList *p, *pieces = NULL;
<span class="line-new-header">--- 2043,14 ---</span>
   *
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_string_list (GKeyFile     *key_file,
<span class="line-modified">!           const gchar  *group_name,</span>
<span class="line-modified">!           const gchar  *key,</span>
<span class="line-modified">!           gsize        *length,</span>
<span class="line-modified">!           GError      **error)</span>
  {
    GError *key_file_error = NULL;
    gchar *value, *string_value, **values;
    gint i, len;
    GSList *p, *pieces = NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2134,14 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_string_list (GKeyFile            *key_file,
<span class="line-modified">!                 const gchar         *group_name,</span>
<span class="line-modified">!                 const gchar         *key,</span>
<span class="line-modified">!                 const gchar * const  list[],</span>
<span class="line-modified">!                 gsize                length)</span>
  {
    GString *value_list;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
<span class="line-new-header">--- 2135,14 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_string_list (GKeyFile            *key_file,
<span class="line-modified">!           const gchar         *group_name,</span>
<span class="line-modified">!           const gchar         *key,</span>
<span class="line-modified">!           const gchar * const  list[],</span>
<span class="line-modified">!           gsize                length)</span>
  {
    GString *value_list;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2181,14 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_locale_string (GKeyFile     *key_file,
<span class="line-modified">!                   const gchar  *group_name,</span>
<span class="line-modified">!                   const gchar  *key,</span>
<span class="line-modified">!                   const gchar  *locale,</span>
<span class="line-modified">!                   const gchar  *string)</span>
  {
    gchar *full_key, *value;
  
    g_return_if_fail (key_file != NULL);
    g_return_if_fail (key != NULL);
<span class="line-new-header">--- 2182,14 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_locale_string (GKeyFile     *key_file,
<span class="line-modified">!             const gchar  *group_name,</span>
<span class="line-modified">!             const gchar  *key,</span>
<span class="line-modified">!             const gchar  *locale,</span>
<span class="line-modified">!             const gchar  *string)</span>
  {
    gchar *full_key, *value;
  
    g_return_if_fail (key_file != NULL);
    g_return_if_fail (key != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2228,14 ***</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_get_locale_string (GKeyFile     *key_file,
<span class="line-modified">!                   const gchar  *group_name,</span>
<span class="line-modified">!                   const gchar  *key,</span>
<span class="line-modified">!                   const gchar  *locale,</span>
<span class="line-modified">!                   GError      **error)</span>
  {
    gchar *candidate_key, *translated_value;
    GError *key_file_error;
    gchar **languages;
    gboolean free_languages = FALSE;
<span class="line-new-header">--- 2229,14 ---</span>
   *
   * Since: 2.6
   **/
  gchar *
  g_key_file_get_locale_string (GKeyFile     *key_file,
<span class="line-modified">!             const gchar  *group_name,</span>
<span class="line-modified">!             const gchar  *key,</span>
<span class="line-modified">!             const gchar  *locale,</span>
<span class="line-modified">!             GError      **error)</span>
  {
    gchar *candidate_key, *translated_value;
    GError *key_file_error;
    gchar **languages;
    gboolean free_languages = FALSE;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2263,27 ***</span>
    for (i = 0; languages[i]; i++)
      {
        candidate_key = g_strdup_printf (&quot;%s[%s]&quot;, key, languages[i]);
  
        translated_value = g_key_file_get_string (key_file,
<span class="line-modified">!                         group_name,</span>
<span class="line-modified">!                         candidate_key, NULL);</span>
        g_free (candidate_key);
  
        if (translated_value)
<span class="line-modified">!     break;</span>
  
        g_free (translated_value);
        translated_value = NULL;
     }
  
    /* Fallback to untranslated key
     */
    if (!translated_value)
      {
        translated_value = g_key_file_get_string (key_file, group_name, key,
<span class="line-modified">!                         &amp;key_file_error);</span>
  
        if (!translated_value)
          g_propagate_error (error, key_file_error);
      }
  
<span class="line-new-header">--- 2264,27 ---</span>
    for (i = 0; languages[i]; i++)
      {
        candidate_key = g_strdup_printf (&quot;%s[%s]&quot;, key, languages[i]);
  
        translated_value = g_key_file_get_string (key_file,
<span class="line-modified">!             group_name,</span>
<span class="line-modified">!             candidate_key, NULL);</span>
        g_free (candidate_key);
  
        if (translated_value)
<span class="line-modified">!   break;</span>
  
        g_free (translated_value);
        translated_value = NULL;
     }
  
    /* Fallback to untranslated key
     */
    if (!translated_value)
      {
        translated_value = g_key_file_get_string (key_file, group_name, key,
<span class="line-modified">!             &amp;key_file_error);</span>
  
        if (!translated_value)
          g_propagate_error (error, key_file_error);
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2388,15 ***</span>
   *
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_locale_string_list (GKeyFile     *key_file,
<span class="line-modified">!                    const gchar  *group_name,</span>
<span class="line-modified">!                    const gchar  *key,</span>
<span class="line-modified">!                    const gchar  *locale,</span>
<span class="line-modified">!                    gsize        *length,</span>
<span class="line-modified">!                    GError      **error)</span>
  {
    GError *key_file_error;
    gchar **values, *value;
    char list_separator[2];
    gsize len;
<span class="line-new-header">--- 2389,15 ---</span>
   *
   * Since: 2.6
   **/
  gchar **
  g_key_file_get_locale_string_list (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *group_name,</span>
<span class="line-modified">!            const gchar  *key,</span>
<span class="line-modified">!            const gchar  *locale,</span>
<span class="line-modified">!            gsize        *length,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    GError *key_file_error;
    gchar **values, *value;
    char list_separator[2];
    gsize len;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2406,12 ***</span>
    g_return_val_if_fail (key != NULL, NULL);
  
    key_file_error = NULL;
  
    value = g_key_file_get_locale_string (key_file, group_name,
<span class="line-modified">!                     key, locale,</span>
<span class="line-modified">!                     &amp;key_file_error);</span>
  
    if (key_file_error)
      g_propagate_error (error, key_file_error);
  
    if (!value)
<span class="line-new-header">--- 2407,12 ---</span>
    g_return_val_if_fail (key != NULL, NULL);
  
    key_file_error = NULL;
  
    value = g_key_file_get_locale_string (key_file, group_name,
<span class="line-modified">!           key, locale,</span>
<span class="line-modified">!           &amp;key_file_error);</span>
  
    if (key_file_error)
      g_propagate_error (error, key_file_error);
  
    if (!value)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2452,15 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_locale_string_list (GKeyFile            *key_file,
<span class="line-modified">!                    const gchar         *group_name,</span>
<span class="line-modified">!                    const gchar         *key,</span>
<span class="line-modified">!                    const gchar         *locale,</span>
<span class="line-modified">!                    const gchar * const  list[],</span>
<span class="line-modified">!                    gsize                length)</span>
  {
    GString *value_list;
    gchar *full_key;
    gsize i;
  
<span class="line-new-header">--- 2453,15 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_locale_string_list (GKeyFile            *key_file,
<span class="line-modified">!            const gchar         *group_name,</span>
<span class="line-modified">!            const gchar         *key,</span>
<span class="line-modified">!            const gchar         *locale,</span>
<span class="line-modified">!            const gchar * const  list[],</span>
<span class="line-modified">!            gsize                length)</span>
  {
    GString *value_list;
    gchar *full_key;
    gsize i;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2512,13 ***</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_get_boolean (GKeyFile     *key_file,
<span class="line-modified">!             const gchar  *group_name,</span>
<span class="line-modified">!             const gchar  *key,</span>
<span class="line-modified">!             GError      **error)</span>
  {
    GError *key_file_error = NULL;
    gchar *value;
    gboolean bool_value;
  
<span class="line-new-header">--- 2513,13 ---</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_get_boolean (GKeyFile     *key_file,
<span class="line-modified">!       const gchar  *group_name,</span>
<span class="line-modified">!       const gchar  *key,</span>
<span class="line-modified">!       GError      **error)</span>
  {
    GError *key_file_error = NULL;
    gchar *value;
    gboolean bool_value;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2533,11 ***</span>
        g_propagate_error (error, key_file_error);
        return FALSE;
      }
  
    bool_value = g_key_file_parse_value_as_boolean (key_file, value,
<span class="line-modified">!                           &amp;key_file_error);</span>
    g_free (value);
  
    if (key_file_error)
      {
        if (g_error_matches (key_file_error,
<span class="line-new-header">--- 2534,11 ---</span>
        g_propagate_error (error, key_file_error);
        return FALSE;
      }
  
    bool_value = g_key_file_parse_value_as_boolean (key_file, value,
<span class="line-modified">!               &amp;key_file_error);</span>
    g_free (value);
  
    if (key_file_error)
      {
        if (g_error_matches (key_file_error,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2570,13 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_boolean (GKeyFile    *key_file,
<span class="line-modified">!             const gchar *group_name,</span>
<span class="line-modified">!             const gchar *key,</span>
<span class="line-modified">!             gboolean     value)</span>
  {
    gchar *result;
  
    g_return_if_fail (key_file != NULL);
  
<span class="line-new-header">--- 2571,13 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_boolean (GKeyFile    *key_file,
<span class="line-modified">!       const gchar *group_name,</span>
<span class="line-modified">!       const gchar *key,</span>
<span class="line-modified">!       gboolean     value)</span>
  {
    gchar *result;
  
    g_return_if_fail (key_file != NULL);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2608,14 ***</span>
   *
   * Since: 2.6
   **/
  gboolean *
  g_key_file_get_boolean_list (GKeyFile     *key_file,
<span class="line-modified">!                  const gchar  *group_name,</span>
<span class="line-modified">!                  const gchar  *key,</span>
<span class="line-modified">!                  gsize        *length,</span>
<span class="line-modified">!                  GError      **error)</span>
  {
    GError *key_file_error;
    gchar **values;
    gboolean *bool_values;
    gsize i, num_bools;
<span class="line-new-header">--- 2609,14 ---</span>
   *
   * Since: 2.6
   **/
  gboolean *
  g_key_file_get_boolean_list (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *group_name,</span>
<span class="line-modified">!            const gchar  *key,</span>
<span class="line-modified">!            gsize        *length,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    GError *key_file_error;
    gchar **values;
    gboolean *bool_values;
    gsize i, num_bools;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2628,11 ***</span>
      *length = 0;
  
    key_file_error = NULL;
  
    values = g_key_file_get_string_list (key_file, group_name, key,
<span class="line-modified">!                        &amp;num_bools, &amp;key_file_error);</span>
  
    if (key_file_error)
      g_propagate_error (error, key_file_error);
  
    if (!values)
<span class="line-new-header">--- 2629,11 ---</span>
      *length = 0;
  
    key_file_error = NULL;
  
    values = g_key_file_get_string_list (key_file, group_name, key,
<span class="line-modified">!                &amp;num_bools, &amp;key_file_error);</span>
  
    if (key_file_error)
      g_propagate_error (error, key_file_error);
  
    if (!values)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2641,12 ***</span>
    bool_values = g_new (gboolean, num_bools);
  
    for (i = 0; i &lt; num_bools; i++)
      {
        bool_values[i] = g_key_file_parse_value_as_boolean (key_file,
<span class="line-modified">!                               values[i],</span>
<span class="line-modified">!                               &amp;key_file_error);</span>
  
        if (key_file_error)
          {
            g_propagate_error (error, key_file_error);
            g_strfreev (values);
<span class="line-new-header">--- 2642,12 ---</span>
    bool_values = g_new (gboolean, num_bools);
  
    for (i = 0; i &lt; num_bools; i++)
      {
        bool_values[i] = g_key_file_parse_value_as_boolean (key_file,
<span class="line-modified">!                 values[i],</span>
<span class="line-modified">!                 &amp;key_file_error);</span>
  
        if (key_file_error)
          {
            g_propagate_error (error, key_file_error);
            g_strfreev (values);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2677,14 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_boolean_list (GKeyFile    *key_file,
<span class="line-modified">!                  const gchar *group_name,</span>
<span class="line-modified">!                  const gchar *key,</span>
<span class="line-modified">!                  gboolean     list[],</span>
<span class="line-modified">!                  gsize        length)</span>
  {
    GString *value_list;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
<span class="line-new-header">--- 2678,14 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_boolean_list (GKeyFile    *key_file,
<span class="line-modified">!            const gchar *group_name,</span>
<span class="line-modified">!            const gchar *key,</span>
<span class="line-modified">!            gboolean     list[],</span>
<span class="line-modified">!            gsize        length)</span>
  {
    GString *value_list;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2733,13 ***</span>
   *
   * Since: 2.6
   **/
  gint
  g_key_file_get_integer (GKeyFile     *key_file,
<span class="line-modified">!             const gchar  *group_name,</span>
<span class="line-modified">!             const gchar  *key,</span>
<span class="line-modified">!             GError      **error)</span>
  {
    GError *key_file_error;
    gchar *value;
    gint int_value;
  
<span class="line-new-header">--- 2734,13 ---</span>
   *
   * Since: 2.6
   **/
  gint
  g_key_file_get_integer (GKeyFile     *key_file,
<span class="line-modified">!       const gchar  *group_name,</span>
<span class="line-modified">!       const gchar  *key,</span>
<span class="line-modified">!       GError      **error)</span>
  {
    GError *key_file_error;
    gchar *value;
    gint int_value;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2756,11 ***</span>
        g_propagate_error (error, key_file_error);
        return 0;
      }
  
    int_value = g_key_file_parse_value_as_integer (key_file, value,
<span class="line-modified">!                          &amp;key_file_error);</span>
    g_free (value);
  
    if (key_file_error)
      {
        if (g_error_matches (key_file_error,
<span class="line-new-header">--- 2757,11 ---</span>
        g_propagate_error (error, key_file_error);
        return 0;
      }
  
    int_value = g_key_file_parse_value_as_integer (key_file, value,
<span class="line-modified">!              &amp;key_file_error);</span>
    g_free (value);
  
    if (key_file_error)
      {
        if (g_error_matches (key_file_error,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2793,13 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_integer (GKeyFile    *key_file,
<span class="line-modified">!             const gchar *group_name,</span>
<span class="line-modified">!             const gchar *key,</span>
<span class="line-modified">!             gint         value)</span>
  {
    gchar *result;
  
    g_return_if_fail (key_file != NULL);
  
<span class="line-new-header">--- 2794,13 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_integer (GKeyFile    *key_file,
<span class="line-modified">!       const gchar *group_name,</span>
<span class="line-modified">!       const gchar *key,</span>
<span class="line-modified">!       gint         value)</span>
  {
    gchar *result;
  
    g_return_if_fail (key_file != NULL);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2986,14 ***</span>
   *
   * Since: 2.6
   **/
  gint *
  g_key_file_get_integer_list (GKeyFile     *key_file,
<span class="line-modified">!                  const gchar  *group_name,</span>
<span class="line-modified">!                  const gchar  *key,</span>
<span class="line-modified">!                  gsize        *length,</span>
<span class="line-modified">!                  GError      **error)</span>
  {
    GError *key_file_error = NULL;
    gchar **values;
    gint *int_values;
    gsize i, num_ints;
<span class="line-new-header">--- 2987,14 ---</span>
   *
   * Since: 2.6
   **/
  gint *
  g_key_file_get_integer_list (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *group_name,</span>
<span class="line-modified">!            const gchar  *key,</span>
<span class="line-modified">!            gsize        *length,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    GError *key_file_error = NULL;
    gchar **values;
    gint *int_values;
    gsize i, num_ints;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3004,11 ***</span>
  
    if (length)
      *length = 0;
  
    values = g_key_file_get_string_list (key_file, group_name, key,
<span class="line-modified">!                        &amp;num_ints, &amp;key_file_error);</span>
  
    if (key_file_error)
      g_propagate_error (error, key_file_error);
  
    if (!values)
<span class="line-new-header">--- 3005,11 ---</span>
  
    if (length)
      *length = 0;
  
    values = g_key_file_get_string_list (key_file, group_name, key,
<span class="line-modified">!                &amp;num_ints, &amp;key_file_error);</span>
  
    if (key_file_error)
      g_propagate_error (error, key_file_error);
  
    if (!values)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3017,12 ***</span>
    int_values = g_new (gint, num_ints);
  
    for (i = 0; i &lt; num_ints; i++)
      {
        int_values[i] = g_key_file_parse_value_as_integer (key_file,
<span class="line-modified">!                              values[i],</span>
<span class="line-modified">!                              &amp;key_file_error);</span>
  
        if (key_file_error)
          {
            g_propagate_error (error, key_file_error);
            g_strfreev (values);
<span class="line-new-header">--- 3018,12 ---</span>
    int_values = g_new (gint, num_ints);
  
    for (i = 0; i &lt; num_ints; i++)
      {
        int_values[i] = g_key_file_parse_value_as_integer (key_file,
<span class="line-modified">!                values[i],</span>
<span class="line-modified">!                &amp;key_file_error);</span>
  
        if (key_file_error)
          {
            g_propagate_error (error, key_file_error);
            g_strfreev (values);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3052,14 ***</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_integer_list (GKeyFile    *key_file,
<span class="line-modified">!                  const gchar *group_name,</span>
<span class="line-modified">!                  const gchar *key,</span>
<span class="line-modified">!                  gint         list[],</span>
<span class="line-modified">!                  gsize        length)</span>
  {
    GString *values;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
<span class="line-new-header">--- 3053,14 ---</span>
   *
   * Since: 2.6
   **/
  void
  g_key_file_set_integer_list (GKeyFile    *key_file,
<span class="line-modified">!            const gchar *group_name,</span>
<span class="line-modified">!            const gchar *key,</span>
<span class="line-modified">!            gint         list[],</span>
<span class="line-modified">!            gsize        length)</span>
  {
    GString *values;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3158,11 ***</span>
  /**
   * g_key_file_set_double:
   * @key_file: a #GKeyFile
   * @group_name: a group name
   * @key: a key
<span class="line-modified">!  * @value: an double value</span>
   *
   * Associates a new double value with @key under @group_name.
   * If @key cannot be found then it is created.
   *
   * Since: 2.12
<span class="line-new-header">--- 3159,11 ---</span>
  /**
   * g_key_file_set_double:
   * @key_file: a #GKeyFile
   * @group_name: a group name
   * @key: a key
<span class="line-modified">!  * @value: a double value</span>
   *
   * Associates a new double value with @key under @group_name.
   * If @key cannot be found then it is created.
   *
   * Since: 2.12
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3235,12 ***</span>
    double_values = g_new (gdouble, num_doubles);
  
    for (i = 0; i &lt; num_doubles; i++)
      {
        double_values[i] = g_key_file_parse_value_as_double (key_file,
<span class="line-modified">!                                values[i],</span>
<span class="line-modified">!                                &amp;key_file_error);</span>
  
        if (key_file_error)
          {
            g_propagate_error (error, key_file_error);
            g_strfreev (values);
<span class="line-new-header">--- 3236,12 ---</span>
    double_values = g_new (gdouble, num_doubles);
  
    for (i = 0; i &lt; num_doubles; i++)
      {
        double_values[i] = g_key_file_parse_value_as_double (key_file,
<span class="line-modified">!                  values[i],</span>
<span class="line-modified">!                  &amp;key_file_error);</span>
  
        if (key_file_error)
          {
            g_propagate_error (error, key_file_error);
            g_strfreev (values);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3270,14 ***</span>
   *
   * Since: 2.12
   **/
  void
  g_key_file_set_double_list (GKeyFile    *key_file,
<span class="line-modified">!                 const gchar *group_name,</span>
<span class="line-modified">!                 const gchar *key,</span>
<span class="line-modified">!                 gdouble      list[],</span>
<span class="line-modified">!                 gsize        length)</span>
  {
    GString *values;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
<span class="line-new-header">--- 3271,14 ---</span>
   *
   * Since: 2.12
   **/
  void
  g_key_file_set_double_list (GKeyFile    *key_file,
<span class="line-modified">!           const gchar *group_name,</span>
<span class="line-modified">!           const gchar *key,</span>
<span class="line-modified">!           gdouble      list[],</span>
<span class="line-modified">!           gsize        length)</span>
  {
    GString *values;
    gsize i;
  
    g_return_if_fail (key_file != NULL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3570,13 ***</span>
    while (tmp != key_node)
      {
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (string == NULL)
<span class="line-modified">!     string = g_string_sized_new (512);</span>
  
<span class="line-modified">!       comment = g_key_file_parse_value_as_comment (key_file, pair-&gt;value);</span>
        g_string_append (string, comment);
        g_free (comment);
  
        tmp = tmp-&gt;prev;
      }
<span class="line-new-header">--- 3571,14 ---</span>
    while (tmp != key_node)
      {
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (string == NULL)
<span class="line-modified">!   string = g_string_sized_new (512);</span>
  
<span class="line-modified">!       comment = g_key_file_parse_value_as_comment (key_file, pair-&gt;value,</span>
<span class="line-added">+                                                    (tmp-&gt;prev == key_node));</span>
        g_string_append (string, comment);
        g_free (comment);
  
        tmp = tmp-&gt;prev;
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3592,12 ***</span>
    return comment;
  }
  
  static gchar *
  get_group_comment (GKeyFile       *key_file,
<span class="line-modified">!            GKeyFileGroup  *group,</span>
<span class="line-modified">!            GError        **error)</span>
  {
    GString *string;
    GList *tmp;
    gchar *comment;
  
<span class="line-new-header">--- 3594,12 ---</span>
    return comment;
  }
  
  static gchar *
  get_group_comment (GKeyFile       *key_file,
<span class="line-modified">!        GKeyFileGroup  *group,</span>
<span class="line-modified">!        GError        **error)</span>
  {
    GString *string;
    GList *tmp;
    gchar *comment;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3609,17 ***</span>
        GKeyFileKeyValuePair *pair;
  
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (pair-&gt;key != NULL)
<span class="line-modified">!     {</span>
<span class="line-modified">!       tmp = tmp-&gt;prev;</span>
<span class="line-modified">!       break;</span>
<span class="line-modified">!     }</span>
  
        if (tmp-&gt;next == NULL)
<span class="line-modified">!     break;</span>
  
        tmp = tmp-&gt;next;
      }
  
    while (tmp != NULL)
<span class="line-new-header">--- 3611,17 ---</span>
        GKeyFileKeyValuePair *pair;
  
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (pair-&gt;key != NULL)
<span class="line-modified">!   {</span>
<span class="line-modified">!     tmp = tmp-&gt;prev;</span>
<span class="line-modified">!     break;</span>
<span class="line-modified">!   }</span>
  
        if (tmp-&gt;next == NULL)
<span class="line-modified">!   break;</span>
  
        tmp = tmp-&gt;next;
      }
  
    while (tmp != NULL)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3629,11 ***</span>
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (string == NULL)
          string = g_string_sized_new (512);
  
<span class="line-modified">!       comment = g_key_file_parse_value_as_comment (key_file, pair-&gt;value);</span>
        g_string_append (string, comment);
        g_free (comment);
  
        tmp = tmp-&gt;prev;
      }
<span class="line-new-header">--- 3631,12 ---</span>
        pair = (GKeyFileKeyValuePair *) tmp-&gt;data;
  
        if (string == NULL)
          string = g_string_sized_new (512);
  
<span class="line-modified">!       comment = g_key_file_parse_value_as_comment (key_file, pair-&gt;value,</span>
<span class="line-added">+                                                    (tmp-&gt;prev == NULL));</span>
        g_string_append (string, comment);
        g_free (comment);
  
        tmp = tmp-&gt;prev;
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3700,11 ***</span>
   * Retrieves a comment above @key from @group_name.
   * If @key is %NULL then @comment will be read from above
   * @group_name. If both @key and @group_name are %NULL, then
   * @comment will be read from above the first group in the file.
   *
<span class="line-modified">!  * Note that the returned string includes the &#39;#&#39; comment markers.</span>
   *
   * Returns: a comment that should be freed with g_free()
   *
   * Since: 2.6
   **/
<span class="line-new-header">--- 3703,13 ---</span>
   * Retrieves a comment above @key from @group_name.
   * If @key is %NULL then @comment will be read from above
   * @group_name. If both @key and @group_name are %NULL, then
   * @comment will be read from above the first group in the file.
   *
<span class="line-modified">!  * Note that the returned string does not include the &#39;#&#39; comment markers,</span>
<span class="line-added">+  * but does include any whitespace after them (on each line). It includes</span>
<span class="line-added">+  * the line breaks between lines, but does not include the final line break.</span>
   *
   * Returns: a comment that should be freed with g_free()
   *
   * Since: 2.6
   **/
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3768,11 ***</span>
   * otherwise.
   * Since: 2.6
   **/
  gboolean
  g_key_file_has_group (GKeyFile    *key_file,
<span class="line-modified">!               const gchar *group_name)</span>
  {
    g_return_val_if_fail (key_file != NULL, FALSE);
    g_return_val_if_fail (group_name != NULL, FALSE);
  
    return g_key_file_lookup_group (key_file, group_name) != NULL;
<span class="line-new-header">--- 3773,11 ---</span>
   * otherwise.
   * Since: 2.6
   **/
  gboolean
  g_key_file_has_group (GKeyFile    *key_file,
<span class="line-modified">!           const gchar *group_name)</span>
  {
    g_return_val_if_fail (key_file != NULL, FALSE);
    g_return_val_if_fail (group_name != NULL, FALSE);
  
    return g_key_file_lookup_group (key_file, group_name) != NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3781,14 ***</span>
  /* This code remains from a historical attempt to add a new public API
   * which respects the GError rules.
   */
  static gboolean
  g_key_file_has_key_full (GKeyFile     *key_file,
<span class="line-modified">!              const gchar  *group_name,</span>
<span class="line-modified">!              const gchar  *key,</span>
<span class="line-modified">!              gboolean     *has_key,</span>
<span class="line-modified">!              GError      **error)</span>
  {
    GKeyFileKeyValuePair *pair;
    GKeyFileGroup *group;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
<span class="line-new-header">--- 3786,14 ---</span>
  /* This code remains from a historical attempt to add a new public API
   * which respects the GError rules.
   */
  static gboolean
  g_key_file_has_key_full (GKeyFile     *key_file,
<span class="line-modified">!        const gchar  *group_name,</span>
<span class="line-modified">!        const gchar  *key,</span>
<span class="line-modified">!        gboolean     *has_key,</span>
<span class="line-modified">!        GError      **error)</span>
  {
    GKeyFileKeyValuePair *pair;
    GKeyFileGroup *group;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3840,13 ***</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_has_key (GKeyFile     *key_file,
<span class="line-modified">!             const gchar  *group_name,</span>
<span class="line-modified">!             const gchar  *key,</span>
<span class="line-modified">!             GError      **error)</span>
  {
    GError *temp_error = NULL;
    gboolean has_key;
  
    if (g_key_file_has_key_full (key_file, group_name, key, &amp;has_key, &amp;temp_error))
<span class="line-new-header">--- 3845,13 ---</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_has_key (GKeyFile     *key_file,
<span class="line-modified">!         const gchar  *group_name,</span>
<span class="line-modified">!         const gchar  *key,</span>
<span class="line-modified">!         GError      **error)</span>
  {
    GError *temp_error = NULL;
    gboolean has_key;
  
    if (g_key_file_has_key_full (key_file, group_name, key, &amp;has_key, &amp;temp_error))
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3860,11 ***</span>
      }
  }
  
  static void
  g_key_file_add_group (GKeyFile    *key_file,
<span class="line-modified">!               const gchar *group_name)</span>
  {
    GKeyFileGroup *group;
  
    g_return_if_fail (key_file != NULL);
    g_return_if_fail (g_key_file_is_group_name (group_name));
<span class="line-new-header">--- 3865,11 ---</span>
      }
  }
  
  static void
  g_key_file_add_group (GKeyFile    *key_file,
<span class="line-modified">!           const gchar *group_name)</span>
  {
    GKeyFileGroup *group;
  
    g_return_if_fail (key_file != NULL);
    g_return_if_fail (g_key_file_is_group_name (group_name));
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3909,11 ***</span>
   *     anyway.
   */
  static void
  g_key_file_remove_key_value_pair_node (GKeyFile      *key_file,
                                         GKeyFileGroup *group,
<span class="line-modified">!                            GList         *pair_node)</span>
  {
  
    GKeyFileKeyValuePair *pair;
  
    pair = (GKeyFileKeyValuePair *) pair_node-&gt;data;
<span class="line-new-header">--- 3914,11 ---</span>
   *     anyway.
   */
  static void
  g_key_file_remove_key_value_pair_node (GKeyFile      *key_file,
                                         GKeyFileGroup *group,
<span class="line-modified">!                      GList         *pair_node)</span>
  {
  
    GKeyFileKeyValuePair *pair;
  
    pair = (GKeyFileKeyValuePair *) pair_node-&gt;data;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3927,11 ***</span>
    g_list_free_1 (pair_node);
  }
  
  static void
  g_key_file_remove_group_node (GKeyFile *key_file,
<span class="line-modified">!                   GList    *group_node)</span>
  {
    GKeyFileGroup *group;
    GList *tmp;
  
    group = (GKeyFileGroup *) group_node-&gt;data;
<span class="line-new-header">--- 3932,11 ---</span>
    g_list_free_1 (pair_node);
  }
  
  static void
  g_key_file_remove_group_node (GKeyFile *key_file,
<span class="line-modified">!             GList    *group_node)</span>
  {
    GKeyFileGroup *group;
    GList *tmp;
  
    group = (GKeyFileGroup *) group_node-&gt;data;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3958,17 ***</span>
     */
    if (key_file-&gt;start_group == group)
      {
        tmp = g_list_last (key_file-&gt;groups);
        while (tmp != NULL)
<span class="line-modified">!     {</span>
<span class="line-modified">!       if (tmp != group_node &amp;&amp;</span>
<span class="line-modified">!           ((GKeyFileGroup *) tmp-&gt;data)-&gt;name != NULL)</span>
<span class="line-modified">!         break;</span>
  
<span class="line-modified">!       tmp = tmp-&gt;prev;</span>
<span class="line-modified">!     }</span>
  
        if (tmp)
          key_file-&gt;start_group = (GKeyFileGroup *) tmp-&gt;data;
        else
          key_file-&gt;start_group = NULL;
<span class="line-new-header">--- 3963,17 ---</span>
     */
    if (key_file-&gt;start_group == group)
      {
        tmp = g_list_last (key_file-&gt;groups);
        while (tmp != NULL)
<span class="line-modified">!   {</span>
<span class="line-modified">!     if (tmp != group_node &amp;&amp;</span>
<span class="line-modified">!         ((GKeyFileGroup *) tmp-&gt;data)-&gt;name != NULL)</span>
<span class="line-modified">!       break;</span>
  
<span class="line-modified">!     tmp = tmp-&gt;prev;</span>
<span class="line-modified">!   }</span>
  
        if (tmp)
          key_file-&gt;start_group = (GKeyFileGroup *) tmp-&gt;data;
        else
          key_file-&gt;start_group = NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4018,12 ***</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_remove_group (GKeyFile     *key_file,
<span class="line-modified">!              const gchar  *group_name,</span>
<span class="line-modified">!              GError      **error)</span>
  {
    GList *group_node;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
    g_return_val_if_fail (group_name != NULL, FALSE);
<span class="line-new-header">--- 4023,12 ---</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_remove_group (GKeyFile     *key_file,
<span class="line-modified">!        const gchar  *group_name,</span>
<span class="line-modified">!        GError      **error)</span>
  {
    GList *group_node;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
    g_return_val_if_fail (group_name != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4031,13 ***</span>
    group_node = g_key_file_lookup_group_node (key_file, group_name);
  
    if (!group_node)
      {
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!                    G_KEY_FILE_ERROR_GROUP_NOT_FOUND,</span>
<span class="line-modified">!                    _(&quot;Key file does not have group &#39;%s&#39;&quot;),</span>
<span class="line-modified">!                    group_name);</span>
        return FALSE;
      }
  
    g_key_file_remove_group_node (key_file, group_node);
  
<span class="line-new-header">--- 4036,13 ---</span>
    group_node = g_key_file_lookup_group_node (key_file, group_name);
  
    if (!group_node)
      {
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!        G_KEY_FILE_ERROR_GROUP_NOT_FOUND,</span>
<span class="line-modified">!        _(&quot;Key file does not have group &#39;%s&#39;&quot;),</span>
<span class="line-modified">!        group_name);</span>
        return FALSE;
      }
  
    g_key_file_remove_group_node (key_file, group_node);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4053,13 ***</span>
    group-&gt;key_value_pairs = g_list_prepend (group-&gt;key_value_pairs, pair);
  }
  
  static void
  g_key_file_add_key (GKeyFile      *key_file,
<span class="line-modified">!             GKeyFileGroup *group,</span>
<span class="line-modified">!             const gchar   *key,</span>
<span class="line-modified">!             const gchar   *value)</span>
  {
    GKeyFileKeyValuePair *pair;
  
    pair = g_slice_new (GKeyFileKeyValuePair);
  #ifdef GSTREAMER_LITE
<span class="line-new-header">--- 4058,13 ---</span>
    group-&gt;key_value_pairs = g_list_prepend (group-&gt;key_value_pairs, pair);
  }
  
  static void
  g_key_file_add_key (GKeyFile      *key_file,
<span class="line-modified">!         GKeyFileGroup *group,</span>
<span class="line-modified">!         const gchar   *key,</span>
<span class="line-modified">!         const gchar   *value)</span>
  {
    GKeyFileKeyValuePair *pair;
  
    pair = g_slice_new (GKeyFileKeyValuePair);
  #ifdef GSTREAMER_LITE
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4086,13 ***</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_remove_key (GKeyFile     *key_file,
<span class="line-modified">!                const gchar  *group_name,</span>
<span class="line-modified">!                const gchar  *key,</span>
<span class="line-modified">!                GError      **error)</span>
  {
    GKeyFileGroup *group;
    GKeyFileKeyValuePair *pair;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
<span class="line-new-header">--- 4091,13 ---</span>
   *
   * Since: 2.6
   **/
  gboolean
  g_key_file_remove_key (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *group_name,</span>
<span class="line-modified">!            const gchar  *key,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    GKeyFileGroup *group;
    GKeyFileKeyValuePair *pair;
  
    g_return_val_if_fail (key_file != NULL, FALSE);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4130,11 ***</span>
    return TRUE;
  }
  
  static GList *
  g_key_file_lookup_group_node (GKeyFile    *key_file,
<span class="line-modified">!                   const gchar *group_name)</span>
  {
    GKeyFileGroup *group;
    GList *tmp;
  
    for (tmp = key_file-&gt;groups; tmp != NULL; tmp = tmp-&gt;next)
<span class="line-new-header">--- 4135,11 ---</span>
    return TRUE;
  }
  
  static GList *
  g_key_file_lookup_group_node (GKeyFile    *key_file,
<span class="line-modified">!             const gchar *group_name)</span>
  {
    GKeyFileGroup *group;
    GList *tmp;
  
    for (tmp = key_file-&gt;groups; tmp != NULL; tmp = tmp-&gt;next)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4148,18 ***</span>
    return tmp;
  }
  
  static GKeyFileGroup *
  g_key_file_lookup_group (GKeyFile    *key_file,
<span class="line-modified">!              const gchar *group_name)</span>
  {
    return (GKeyFileGroup *)g_hash_table_lookup (key_file-&gt;group_hash, group_name);
  }
  
  static GList *
  g_key_file_lookup_key_value_pair_node (GKeyFile       *key_file,
<span class="line-modified">!                            GKeyFileGroup  *group,</span>
                                         const gchar    *key)
  {
    GList *key_node;
  
    for (key_node = group-&gt;key_value_pairs;
<span class="line-new-header">--- 4153,18 ---</span>
    return tmp;
  }
  
  static GKeyFileGroup *
  g_key_file_lookup_group (GKeyFile    *key_file,
<span class="line-modified">!        const gchar *group_name)</span>
  {
    return (GKeyFileGroup *)g_hash_table_lookup (key_file-&gt;group_hash, group_name);
  }
  
  static GList *
  g_key_file_lookup_key_value_pair_node (GKeyFile       *key_file,
<span class="line-modified">!                      GKeyFileGroup  *group,</span>
                                         const gchar    *key)
  {
    GList *key_node;
  
    for (key_node = group-&gt;key_value_pairs;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4177,12 ***</span>
    return key_node;
  }
  
  static GKeyFileKeyValuePair *
  g_key_file_lookup_key_value_pair (GKeyFile      *key_file,
<span class="line-modified">!                   GKeyFileGroup *group,</span>
<span class="line-modified">!                   const gchar   *key)</span>
  {
    return (GKeyFileKeyValuePair *) g_hash_table_lookup (group-&gt;lookup_map, key);
  }
  
  /* Lines starting with # or consisting entirely of whitespace are merely
<span class="line-new-header">--- 4182,12 ---</span>
    return key_node;
  }
  
  static GKeyFileKeyValuePair *
  g_key_file_lookup_key_value_pair (GKeyFile      *key_file,
<span class="line-modified">!           GKeyFileGroup *group,</span>
<span class="line-modified">!           const gchar   *key)</span>
  {
    return (GKeyFileKeyValuePair *) g_hash_table_lookup (group-&gt;lookup_map, key);
  }
  
  /* Lines starting with # or consisting entirely of whitespace are merely
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4307,13 ***</span>
    return TRUE;
  }
  
  static gchar *
  g_key_file_parse_value_as_string (GKeyFile     *key_file,
<span class="line-modified">!                   const gchar  *value,</span>
<span class="line-modified">!                   GSList      **pieces,</span>
<span class="line-modified">!                   GError      **error)</span>
  {
    gchar *string_value, *p, *q0, *q;
  
    string_value = g_new (gchar, strlen (value) + 1);
  
<span class="line-new-header">--- 4312,13 ---</span>
    return TRUE;
  }
  
  static gchar *
  g_key_file_parse_value_as_string (GKeyFile     *key_file,
<span class="line-modified">!           const gchar  *value,</span>
<span class="line-modified">!           GSList      **pieces,</span>
<span class="line-modified">!           GError      **error)</span>
  {
    gchar *string_value, *p, *q0, *q;
  
    string_value = g_new (gchar, strlen (value) + 1);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4345,54 ***</span>
  
              case &#39;\\&#39;:
                *q = &#39;\\&#39;;
                break;
  
<span class="line-modified">!         case &#39;\0&#39;:</span>
<span class="line-modified">!           g_set_error_literal (error, G_KEY_FILE_ERROR,</span>
                                     G_KEY_FILE_ERROR_INVALID_VALUE,
                                     _(&quot;Key file contains escape character &quot;
                                       &quot;at end of line&quot;));
<span class="line-modified">!           break;</span>
  
              default:
<span class="line-modified">!           if (pieces &amp;&amp; *p == key_file-&gt;list_separator)</span>
<span class="line-modified">!         *q = key_file-&gt;list_separator;</span>
<span class="line-modified">!           else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *q++ = &#39;\\&#39;;</span>
<span class="line-modified">!           *q = *p;</span>
  
<span class="line-modified">!           if (*error == NULL)</span>
<span class="line-modified">!             {</span>
<span class="line-modified">!               gchar sequence[3];</span>
  
<span class="line-modified">!               sequence[0] = &#39;\\&#39;;</span>
<span class="line-modified">!               sequence[1] = *p;</span>
<span class="line-modified">!               sequence[2] = &#39;\0&#39;;</span>
  
<span class="line-modified">!               g_set_error (error, G_KEY_FILE_ERROR,</span>
<span class="line-modified">!                            G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!                            _(&quot;Key file contains invalid escape &quot;</span>
<span class="line-modified">!                            &quot;sequence &#39;%s&#39;&quot;), sequence);</span>
<span class="line-removed">-             }</span>
          }
                break;
              }
          }
        else
<span class="line-modified">!     {</span>
<span class="line-modified">!       *q = *p;</span>
<span class="line-modified">!       if (pieces &amp;&amp; (*p == key_file-&gt;list_separator))</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *pieces = g_slist_prepend (*pieces, g_strndup (q0, q - q0));</span>
<span class="line-modified">!           q0 = q + 1;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
  
        if (*p == &#39;\0&#39;)
<span class="line-modified">!     break;</span>
  
        q++;
        p++;
      }
  
<span class="line-new-header">--- 4350,54 ---</span>
  
              case &#39;\\&#39;:
                *q = &#39;\\&#39;;
                break;
  
<span class="line-modified">!       case &#39;\0&#39;:</span>
<span class="line-modified">!         g_set_error_literal (error, G_KEY_FILE_ERROR,</span>
                                     G_KEY_FILE_ERROR_INVALID_VALUE,
                                     _(&quot;Key file contains escape character &quot;
                                       &quot;at end of line&quot;));
<span class="line-modified">!         break;</span>
  
              default:
<span class="line-modified">!         if (pieces &amp;&amp; *p == key_file-&gt;list_separator)</span>
<span class="line-modified">!     *q = key_file-&gt;list_separator;</span>
<span class="line-modified">!         else</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       *q++ = &#39;\\&#39;;</span>
<span class="line-modified">!       *q = *p;</span>
  
<span class="line-modified">!       if (*error == NULL)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           gchar sequence[3];</span>
  
<span class="line-modified">!           sequence[0] = &#39;\\&#39;;</span>
<span class="line-modified">!           sequence[1] = *p;</span>
<span class="line-modified">!           sequence[2] = &#39;\0&#39;;</span>
  
<span class="line-modified">!           g_set_error (error, G_KEY_FILE_ERROR,</span>
<span class="line-modified">!            G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!            _(&quot;Key file contains invalid escape &quot;</span>
<span class="line-modified">!              &quot;sequence &#39;%s&#39;&quot;), sequence);</span>
          }
<span class="line-added">+     }</span>
                break;
              }
          }
        else
<span class="line-modified">!   {</span>
<span class="line-modified">!     *q = *p;</span>
<span class="line-modified">!     if (pieces &amp;&amp; (*p == key_file-&gt;list_separator))</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *pieces = g_slist_prepend (*pieces, g_strndup (q0, q - q0));</span>
<span class="line-modified">!         q0 = q + 1;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!   }</span>
  
        if (*p == &#39;\0&#39;)
<span class="line-modified">!   break;</span>
  
        q++;
        p++;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4407,12 ***</span>
    return string_value;
  }
  
  static gchar *
  g_key_file_parse_string_as_value (GKeyFile    *key_file,
<span class="line-modified">!                   const gchar *string,</span>
<span class="line-modified">!                   gboolean     escape_separator)</span>
  {
    gchar *value, *p, *q;
    gsize length;
    gboolean parsing_leading_space;
  
<span class="line-new-header">--- 4412,12 ---</span>
    return string_value;
  }
  
  static gchar *
  g_key_file_parse_string_as_value (GKeyFile    *key_file,
<span class="line-modified">!           const gchar *string,</span>
<span class="line-modified">!           gboolean     escape_separator)</span>
  {
    gchar *value, *p, *q;
    gsize length;
    gboolean parsing_leading_space;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4439,12 ***</span>
                strcpy (q, escaped_character);
                q += 2;
              }
            else
              {
<span class="line-modified">!           *q = *p;</span>
<span class="line-modified">!           q++;</span>
              }
            break;
          case &#39;\t&#39;:
            if (parsing_leading_space)
              {
<span class="line-new-header">--- 4444,12 ---</span>
                strcpy (q, escaped_character);
                q += 2;
              }
            else
              {
<span class="line-modified">!         *q = *p;</span>
<span class="line-modified">!         q++;</span>
              }
            break;
          case &#39;\t&#39;:
            if (parsing_leading_space)
              {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4452,12 ***</span>
                strcpy (q, escaped_character);
                q += 2;
              }
            else
              {
<span class="line-modified">!           *q = *p;</span>
<span class="line-modified">!           q++;</span>
              }
            break;
          case &#39;\n&#39;:
            escaped_character[1] = &#39;n&#39;;
            strcpy (q, escaped_character);
<span class="line-new-header">--- 4457,12 ---</span>
                strcpy (q, escaped_character);
                q += 2;
              }
            else
              {
<span class="line-modified">!         *q = *p;</span>
<span class="line-modified">!         q++;</span>
              }
            break;
          case &#39;\n&#39;:
            escaped_character[1] = &#39;n&#39;;
            strcpy (q, escaped_character);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4473,23 ***</span>
            strcpy (q, escaped_character);
            q += 2;
            parsing_leading_space = FALSE;
            break;
          default:
<span class="line-modified">!       if (escape_separator &amp;&amp; *p == key_file-&gt;list_separator)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           escaped_character[1] = key_file-&gt;list_separator;</span>
<span class="line-modified">!           strcpy (q, escaped_character);</span>
<span class="line-modified">!           q += 2;</span>
                parsing_leading_space = TRUE;
<span class="line-modified">!         }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *q = *p;</span>
<span class="line-modified">!           q++;</span>
                parsing_leading_space = FALSE;
<span class="line-modified">!         }</span>
            break;
          }
        p++;
      }
    *q = &#39;\0&#39;;
<span class="line-new-header">--- 4478,23 ---</span>
            strcpy (q, escaped_character);
            q += 2;
            parsing_leading_space = FALSE;
            break;
          default:
<span class="line-modified">!     if (escape_separator &amp;&amp; *p == key_file-&gt;list_separator)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         escaped_character[1] = key_file-&gt;list_separator;</span>
<span class="line-modified">!         strcpy (q, escaped_character);</span>
<span class="line-modified">!         q += 2;</span>
                parsing_leading_space = TRUE;
<span class="line-modified">!       }</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *q = *p;</span>
<span class="line-modified">!         q++;</span>
                parsing_leading_space = FALSE;
<span class="line-modified">!       }</span>
            break;
          }
        p++;
      }
    *q = &#39;\0&#39;;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4497,12 ***</span>
    return value;
  }
  
  static gint
  g_key_file_parse_value_as_integer (GKeyFile     *key_file,
<span class="line-modified">!                    const gchar  *value,</span>
<span class="line-modified">!                    GError      **error)</span>
  {
    gchar *eof_int;
    glong long_value;
    gint int_value;
    int errsv;
<span class="line-new-header">--- 4502,12 ---</span>
    return value;
  }
  
  static gint
  g_key_file_parse_value_as_integer (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *value,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    gchar *eof_int;
    glong long_value;
    gint int_value;
    int errsv;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4513,38 ***</span>
  
    if (*value == &#39;\0&#39; || (*eof_int != &#39;\0&#39; &amp;&amp; !g_ascii_isspace(*eof_int)))
      {
        gchar *value_utf8 = g_utf8_make_valid (value, -1);
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!                    G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!                    _(&quot;Value &#39;%s&#39; cannot be interpreted &quot;</span>
<span class="line-modified">!                    &quot;as a number.&quot;), value_utf8);</span>
        g_free (value_utf8);
  
        return 0;
      }
  
    int_value = long_value;
    if (int_value != long_value || errsv == ERANGE)
      {
        gchar *value_utf8 = g_utf8_make_valid (value, -1);
        g_set_error (error,
<span class="line-modified">!                    G_KEY_FILE_ERROR,</span>
<span class="line-modified">!                    G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!                    _(&quot;Integer value &#39;%s&#39; out of range&quot;),</span>
<span class="line-modified">!                    value_utf8);</span>
        g_free (value_utf8);
  
        return 0;
      }
  
    return int_value;
  }
  
  static gchar *
  g_key_file_parse_integer_as_value (GKeyFile *key_file,
<span class="line-modified">!                    gint      value)</span>
  
  {
    return g_strdup_printf (&quot;%d&quot;, value);
  }
  
<span class="line-new-header">--- 4518,38 ---</span>
  
    if (*value == &#39;\0&#39; || (*eof_int != &#39;\0&#39; &amp;&amp; !g_ascii_isspace(*eof_int)))
      {
        gchar *value_utf8 = g_utf8_make_valid (value, -1);
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!        G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!        _(&quot;Value &#39;%s&#39; cannot be interpreted &quot;</span>
<span class="line-modified">!          &quot;as a number.&quot;), value_utf8);</span>
        g_free (value_utf8);
  
        return 0;
      }
  
    int_value = long_value;
    if (int_value != long_value || errsv == ERANGE)
      {
        gchar *value_utf8 = g_utf8_make_valid (value, -1);
        g_set_error (error,
<span class="line-modified">!        G_KEY_FILE_ERROR,</span>
<span class="line-modified">!        G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!        _(&quot;Integer value &#39;%s&#39; out of range&quot;),</span>
<span class="line-modified">!        value_utf8);</span>
        g_free (value_utf8);
  
        return 0;
      }
  
    return int_value;
  }
  
  static gchar *
  g_key_file_parse_integer_as_value (GKeyFile *key_file,
<span class="line-modified">!            gint      value)</span>
  
  {
    return g_strdup_printf (&quot;%d&quot;, value);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4560,14 ***</span>
  
    if (*end_of_valid_d != &#39;\0&#39; || end_of_valid_d == value)
      {
        gchar *value_utf8 = g_utf8_make_valid (value, -1);
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!                    G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!                    _(&quot;Value &#39;%s&#39; cannot be interpreted &quot;</span>
<span class="line-modified">!                    &quot;as a float number.&quot;),</span>
<span class="line-modified">!                    value_utf8);</span>
        g_free (value_utf8);
  
        double_value = 0;
      }
  
<span class="line-new-header">--- 4565,14 ---</span>
  
    if (*end_of_valid_d != &#39;\0&#39; || end_of_valid_d == value)
      {
        gchar *value_utf8 = g_utf8_make_valid (value, -1);
        g_set_error (error, G_KEY_FILE_ERROR,
<span class="line-modified">!        G_KEY_FILE_ERROR_INVALID_VALUE,</span>
<span class="line-modified">!        _(&quot;Value &#39;%s&#39; cannot be interpreted &quot;</span>
<span class="line-modified">!          &quot;as a float number.&quot;),</span>
<span class="line-modified">!        value_utf8);</span>
        g_free (value_utf8);
  
        double_value = 0;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4581,12 ***</span>
    return strncmp (s1, s2, MAX (len1, len2));
  }
  
  static gboolean
  g_key_file_parse_value_as_boolean (GKeyFile     *key_file,
<span class="line-modified">!                    const gchar  *value,</span>
<span class="line-modified">!                    GError      **error)</span>
  {
    gchar *value_utf8;
    gint i, length = 0;
  
    /* Count the number of non-whitespace characters */
<span class="line-new-header">--- 4586,12 ---</span>
    return strncmp (s1, s2, MAX (len1, len2));
  }
  
  static gboolean
  g_key_file_parse_value_as_boolean (GKeyFile     *key_file,
<span class="line-modified">!            const gchar  *value,</span>
<span class="line-modified">!            GError      **error)</span>
  {
    gchar *value_utf8;
    gint i, length = 0;
  
    /* Count the number of non-whitespace characters */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4601,29 ***</span>
  
    value_utf8 = g_utf8_make_valid (value, -1);
    g_set_error (error, G_KEY_FILE_ERROR,
                 G_KEY_FILE_ERROR_INVALID_VALUE,
                 _(&quot;Value &#39;%s&#39; cannot be interpreted &quot;
<span class="line-modified">!                &quot;as a boolean.&quot;), value_utf8);</span>
    g_free (value_utf8);
  
    return FALSE;
  }
  
  static gchar *
  g_key_file_parse_boolean_as_value (GKeyFile *key_file,
<span class="line-modified">!                    gboolean  value)</span>
  {
    if (value)
      return g_strdup (&quot;true&quot;);
    else
      return g_strdup (&quot;false&quot;);
  }
  
  static gchar *
  g_key_file_parse_value_as_comment (GKeyFile    *key_file,
<span class="line-modified">!                                    const gchar *value)</span>
  {
    GString *string;
    gchar **lines;
    gsize i;
  
<span class="line-new-header">--- 4606,30 ---</span>
  
    value_utf8 = g_utf8_make_valid (value, -1);
    g_set_error (error, G_KEY_FILE_ERROR,
                 G_KEY_FILE_ERROR_INVALID_VALUE,
                 _(&quot;Value &#39;%s&#39; cannot be interpreted &quot;
<span class="line-modified">!      &quot;as a boolean.&quot;), value_utf8);</span>
    g_free (value_utf8);
  
    return FALSE;
  }
  
  static gchar *
  g_key_file_parse_boolean_as_value (GKeyFile *key_file,
<span class="line-modified">!            gboolean  value)</span>
  {
    if (value)
      return g_strdup (&quot;true&quot;);
    else
      return g_strdup (&quot;false&quot;);
  }
  
  static gchar *
  g_key_file_parse_value_as_comment (GKeyFile    *key_file,
<span class="line-modified">!                                    const gchar *value,</span>
<span class="line-added">+                                    gboolean     is_final_line)</span>
  {
    GString *string;
    gchar **lines;
    gsize i;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 4631,17 ***</span>
  
    lines = g_strsplit (value, &quot;\n&quot;, 0);
  
    for (i = 0; lines[i] != NULL; i++)
      {
<span class="line-modified">!         if (lines[i][0] != &#39;#&#39;)</span>
<span class="line-modified">!            g_string_append_printf (string, &quot;%s\n&quot;, lines[i]);</span>
<span class="line-modified">!         else</span>
<span class="line-modified">!            g_string_append_printf (string, &quot;%s\n&quot;, lines[i] + 1);</span>
      }
    g_strfreev (lines);
  
    return g_string_free (string, FALSE);
  }
  
  static gchar *
  g_key_file_parse_comment_as_value (GKeyFile      *key_file,
<span class="line-new-header">--- 4637,26 ---</span>
  
    lines = g_strsplit (value, &quot;\n&quot;, 0);
  
    for (i = 0; lines[i] != NULL; i++)
      {
<span class="line-modified">!       const gchar *line = lines[i];</span>
<span class="line-modified">! </span>
<span class="line-modified">!       if (i != 0)</span>
<span class="line-modified">!         g_string_append_c (string, &#39;\n&#39;);</span>
<span class="line-added">+ </span>
<span class="line-added">+       if (line[0] == &#39;#&#39;)</span>
<span class="line-added">+         line++;</span>
<span class="line-added">+       g_string_append (string, line);</span>
      }
    g_strfreev (lines);
  
<span class="line-added">+   /* This function gets called once per line of a comment, but we don&#39;t want</span>
<span class="line-added">+    * to add a trailing newline. */</span>
<span class="line-added">+   if (!is_final_line)</span>
<span class="line-added">+     g_string_append_c (string, &#39;\n&#39;);</span>
<span class="line-added">+ </span>
    return g_string_free (string, FALSE);
  }
  
  static gchar *
  g_key_file_parse_comment_as_value (GKeyFile      *key_file,
</pre>
<center><a href="giowin32.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gkeyfile.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>