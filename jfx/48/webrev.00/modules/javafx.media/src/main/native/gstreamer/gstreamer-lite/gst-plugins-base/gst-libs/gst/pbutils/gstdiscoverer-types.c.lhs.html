<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/pbutils/gstdiscoverer-types.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /* GStreamer
   2  * Copyright (C) 2010 Collabora Multimedia
   3  *               2010 Nokia Corporation
   4  *
   5  * This library is free software; you can redistribute it and/or
   6  * modify it under the terms of the GNU Library General Public
   7  * License as published by the Free Software Foundation; either
   8  * version 2 of the License, or (at your option) any later version.
   9  *
  10  * This library is distributed in the hope that it will be useful,
  11  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  12  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  13  * Library General Public License for more details.
  14  *
  15  * You should have received a copy of the GNU Library General Public
  16  * License along with this library; if not, write to the
  17  * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,
  18  * Boston, MA 02110-1301, USA.
  19  */
  20 
  21 #ifdef HAVE_CONFIG_H
  22 #include &quot;config.h&quot;
  23 #endif
  24 
  25 #include &quot;pbutils.h&quot;
  26 #include &quot;pbutils-private.h&quot;
  27 
  28 static GstDiscovererStreamInfo
  29     * gst_discoverer_info_copy_int (GstDiscovererStreamInfo * info,
  30     GHashTable * stream_map);
  31 
  32 static GstDiscovererContainerInfo
  33     * gst_stream_container_info_copy_int (GstDiscovererContainerInfo * ptr,
  34     GHashTable * stream_map);
  35 
  36 static GstDiscovererAudioInfo
  37     * gst_discoverer_audio_info_copy_int (GstDiscovererAudioInfo * ptr);
  38 
  39 static GstDiscovererVideoInfo
  40     * gst_discoverer_video_info_copy_int (GstDiscovererVideoInfo * ptr);
  41 
  42 static GstDiscovererSubtitleInfo
  43     * gst_discoverer_subtitle_info_copy_int (GstDiscovererSubtitleInfo * ptr);
  44 
  45 /* Per-stream information */
  46 
  47 G_DEFINE_TYPE (GstDiscovererStreamInfo, gst_discoverer_stream_info,
  48     G_TYPE_OBJECT);
  49 
  50 static void
  51 gst_discoverer_stream_info_init (GstDiscovererStreamInfo * info)
  52 {
  53   /* Nothing needs initialization */
  54 }
  55 
  56 static void
  57 gst_discoverer_stream_info_finalize (GObject * object)
  58 {
  59   GstDiscovererStreamInfo *info = (GstDiscovererStreamInfo *) object;
  60 
  61   if (info-&gt;next)
  62     g_object_unref ((GObject *) info-&gt;next);
  63 
  64   if (info-&gt;caps)
  65     gst_caps_unref (info-&gt;caps);
  66 
  67   if (info-&gt;tags)
  68     gst_tag_list_unref (info-&gt;tags);
  69 
  70   if (info-&gt;toc)
  71     gst_toc_unref (info-&gt;toc);
  72 
  73   g_free (info-&gt;stream_id);
  74 
  75   if (info-&gt;misc)
  76     gst_structure_free (info-&gt;misc);
  77 }
  78 
  79 static void
  80 gst_discoverer_stream_info_class_init (GObjectClass * klass)
  81 {
  82   klass-&gt;finalize = gst_discoverer_stream_info_finalize;
  83 }
  84 
  85 static GstDiscovererStreamInfo *
  86 gst_discoverer_stream_info_new (void)
  87 {
  88   return (GstDiscovererStreamInfo *)
  89       g_object_new (GST_TYPE_DISCOVERER_STREAM_INFO, NULL);
  90 }
  91 
  92 static GstDiscovererStreamInfo *
  93 gst_discoverer_info_copy_int (GstDiscovererStreamInfo * info,
  94     GHashTable * stream_map)
  95 {
  96   GstDiscovererStreamInfo *ret;
  97   GType ltyp;
  98 
  99   g_return_val_if_fail (info != NULL, NULL);
 100 
 101   ltyp = G_TYPE_FROM_INSTANCE (info);
 102 
 103   if (ltyp == GST_TYPE_DISCOVERER_CONTAINER_INFO) {
 104     ret = (GstDiscovererStreamInfo *)
 105         gst_stream_container_info_copy_int (
 106         (GstDiscovererContainerInfo *) info, stream_map);
 107   } else if (ltyp == GST_TYPE_DISCOVERER_AUDIO_INFO) {
 108     ret = (GstDiscovererStreamInfo *)
 109         gst_discoverer_audio_info_copy_int ((GstDiscovererAudioInfo *) info);
 110 
 111   } else if (ltyp == GST_TYPE_DISCOVERER_VIDEO_INFO) {
 112     ret = (GstDiscovererStreamInfo *)
 113         gst_discoverer_video_info_copy_int ((GstDiscovererVideoInfo *) info);
 114 
 115   } else if (ltyp == GST_TYPE_DISCOVERER_SUBTITLE_INFO) {
 116     ret = (GstDiscovererStreamInfo *)
 117         gst_discoverer_subtitle_info_copy_int ((GstDiscovererSubtitleInfo *)
 118         info);
 119 
 120   } else
 121     ret = gst_discoverer_stream_info_new ();
 122 
 123   if (info-&gt;next) {
 124     ret-&gt;next = gst_discoverer_info_copy_int (info-&gt;next, stream_map);
 125     ret-&gt;next-&gt;previous = ret;
 126   }
 127 
 128   if (info-&gt;caps)
 129     ret-&gt;caps = gst_caps_copy (info-&gt;caps);
 130 
 131   if (info-&gt;tags)
 132     ret-&gt;tags = gst_tag_list_copy (info-&gt;tags);
 133 
 134   if (info-&gt;toc)
 135     ret-&gt;toc = gst_toc_ref (info-&gt;toc);
 136 
 137   if (info-&gt;stream_id)
 138     ret-&gt;stream_id = g_strdup (info-&gt;stream_id);
 139 
 140   if (info-&gt;misc)
 141     ret-&gt;misc = gst_structure_copy (info-&gt;misc);
 142 
 143   if (stream_map)
 144     g_hash_table_insert (stream_map, info, ret);
 145 
 146   return ret;
 147 }
 148 
 149 /* Container information */
 150 G_DEFINE_TYPE (GstDiscovererContainerInfo, gst_discoverer_container_info,
 151     GST_TYPE_DISCOVERER_STREAM_INFO);
 152 
 153 static void
 154 gst_discoverer_container_info_init (GstDiscovererContainerInfo * info)
 155 {
 156   /* Nothing to initialize */
 157 }
 158 
 159 static GstDiscovererContainerInfo *
 160 gst_discoverer_container_info_new (void)
 161 {
 162   return (GstDiscovererContainerInfo *)
 163       g_object_new (GST_TYPE_DISCOVERER_CONTAINER_INFO, NULL);
 164 }
 165 
 166 static void
 167 gst_discoverer_container_info_finalize (GObject * object)
 168 {
 169   GstDiscovererContainerInfo *info = (GstDiscovererContainerInfo *) object;
 170   GList *tmp;
 171 
 172   for (tmp = ((GstDiscovererContainerInfo *) info)-&gt;streams; tmp;
 173       tmp = tmp-&gt;next)
 174     g_object_unref ((GObject *) tmp-&gt;data);
 175 
 176   gst_discoverer_stream_info_list_free (info-&gt;streams);
 177 
 178   gst_discoverer_stream_info_finalize ((GObject *) info);
 179 }
 180 
 181 static void
 182 gst_discoverer_container_info_class_init (GObjectClass * klass)
 183 {
 184   klass-&gt;finalize = gst_discoverer_container_info_finalize;
 185 }
 186 
 187 static GstDiscovererContainerInfo *
 188 gst_stream_container_info_copy_int (GstDiscovererContainerInfo * ptr,
 189     GHashTable * stream_map)
 190 {
 191   GstDiscovererContainerInfo *ret;
 192   GList *tmp;
 193 
 194   g_return_val_if_fail (ptr != NULL, NULL);
 195 
 196   ret = gst_discoverer_container_info_new ();
 197 
 198   for (tmp = ((GstDiscovererContainerInfo *) ptr)-&gt;streams; tmp;
 199       tmp = tmp-&gt;next) {
 200     GstDiscovererStreamInfo *subtop = gst_discoverer_info_copy_int (tmp-&gt;data,
 201         stream_map);
 202     ret-&gt;streams = g_list_append (ret-&gt;streams, subtop);
 203     if (stream_map)
 204       g_hash_table_insert (stream_map, tmp-&gt;data, subtop);
 205   }
 206 
 207   return ret;
 208 }
 209 
 210 /* Audio information */
 211 G_DEFINE_TYPE (GstDiscovererAudioInfo, gst_discoverer_audio_info,
 212     GST_TYPE_DISCOVERER_STREAM_INFO);
 213 
 214 static void
 215 gst_discoverer_audio_info_finalize (GObject * object)
 216 {
 217   GstDiscovererAudioInfo *info = (GstDiscovererAudioInfo *) object;
 218 
 219   g_free (info-&gt;language);
 220 
 221   G_OBJECT_CLASS (gst_discoverer_audio_info_parent_class)-&gt;finalize (object);
 222 }
 223 
 224 static void
 225 gst_discoverer_audio_info_class_init (GObjectClass * klass)
 226 {
 227   klass-&gt;finalize = gst_discoverer_audio_info_finalize;
 228 }
 229 
 230 static void
 231 gst_discoverer_audio_info_init (GstDiscovererAudioInfo * info)
 232 {
 233   info-&gt;language = NULL;
 234 }
 235 
 236 static GstDiscovererAudioInfo *
 237 gst_discoverer_audio_info_new (void)
 238 {
 239   return (GstDiscovererAudioInfo *)
 240       g_object_new (GST_TYPE_DISCOVERER_AUDIO_INFO, NULL);
 241 }
 242 
 243 static GstDiscovererAudioInfo *
 244 gst_discoverer_audio_info_copy_int (GstDiscovererAudioInfo * ptr)
 245 {
 246   GstDiscovererAudioInfo *ret;
 247 
 248   ret = gst_discoverer_audio_info_new ();
 249 
 250   ret-&gt;channels = ptr-&gt;channels;
 251   ret-&gt;channel_mask = ptr-&gt;channel_mask;
 252   ret-&gt;sample_rate = ptr-&gt;sample_rate;
 253   ret-&gt;depth = ptr-&gt;depth;
 254   ret-&gt;bitrate = ptr-&gt;bitrate;
 255   ret-&gt;max_bitrate = ptr-&gt;max_bitrate;
 256   ret-&gt;language = g_strdup (ptr-&gt;language);
 257 
 258   return ret;
 259 }
 260 
 261 /* Subtitle information */
 262 G_DEFINE_TYPE (GstDiscovererSubtitleInfo, gst_discoverer_subtitle_info,
 263     GST_TYPE_DISCOVERER_STREAM_INFO);
 264 
 265 static void
 266 gst_discoverer_subtitle_info_init (GstDiscovererSubtitleInfo * info)
 267 {
 268   info-&gt;language = NULL;
 269 }
 270 
 271 static void
 272 gst_discoverer_subtitle_info_finalize (GObject * object)
 273 {
 274   GstDiscovererSubtitleInfo *info = (GstDiscovererSubtitleInfo *) object;
 275 
 276   g_free (info-&gt;language);
 277 
 278   G_OBJECT_CLASS (gst_discoverer_subtitle_info_parent_class)-&gt;finalize (object);
 279 }
 280 
 281 static void
 282 gst_discoverer_subtitle_info_class_init (GObjectClass * klass)
 283 {
 284   klass-&gt;finalize = gst_discoverer_subtitle_info_finalize;
 285 }
 286 
 287 static GstDiscovererSubtitleInfo *
 288 gst_discoverer_subtitle_info_new (void)
 289 {
 290   return (GstDiscovererSubtitleInfo *)
 291       g_object_new (GST_TYPE_DISCOVERER_SUBTITLE_INFO, NULL);
 292 }
 293 
 294 static GstDiscovererSubtitleInfo *
 295 gst_discoverer_subtitle_info_copy_int (GstDiscovererSubtitleInfo * ptr)
 296 {
 297   GstDiscovererSubtitleInfo *ret;
 298 
 299   ret = gst_discoverer_subtitle_info_new ();
 300 
 301   ret-&gt;language = g_strdup (ptr-&gt;language);
 302 
 303   return ret;
 304 }
 305 
 306 /* Video information */
 307 G_DEFINE_TYPE (GstDiscovererVideoInfo, gst_discoverer_video_info,
 308     GST_TYPE_DISCOVERER_STREAM_INFO);
 309 
 310 static void
 311 gst_discoverer_video_info_class_init (GObjectClass * klass)
 312 {
 313   /* Nothing to initialize */
 314 }
 315 
 316 static void
 317 gst_discoverer_video_info_init (GstDiscovererVideoInfo * info)
 318 {
 319   /* Nothing to initialize */
 320 }
 321 
 322 static GstDiscovererVideoInfo *
 323 gst_discoverer_video_info_new (void)
 324 {
 325   return (GstDiscovererVideoInfo *)
 326       g_object_new (GST_TYPE_DISCOVERER_VIDEO_INFO, NULL);
 327 }
 328 
 329 static GstDiscovererVideoInfo *
 330 gst_discoverer_video_info_copy_int (GstDiscovererVideoInfo * ptr)
 331 {
 332   GstDiscovererVideoInfo *ret;
 333 
 334   ret = gst_discoverer_video_info_new ();
 335 
 336   ret-&gt;width = ptr-&gt;width;
 337   ret-&gt;height = ptr-&gt;height;
 338   ret-&gt;depth = ptr-&gt;depth;
 339   ret-&gt;framerate_num = ptr-&gt;framerate_num;
 340   ret-&gt;framerate_denom = ptr-&gt;framerate_denom;
 341   ret-&gt;par_num = ptr-&gt;par_num;
 342   ret-&gt;par_denom = ptr-&gt;par_denom;
 343   ret-&gt;interlaced = ptr-&gt;interlaced;
 344   ret-&gt;bitrate = ptr-&gt;bitrate;
 345   ret-&gt;max_bitrate = ptr-&gt;max_bitrate;
 346   ret-&gt;is_image = ptr-&gt;is_image;
 347 
 348   return ret;
 349 }
 350 
 351 /* Global stream information */
 352 G_DEFINE_TYPE (GstDiscovererInfo, gst_discoverer_info, G_TYPE_OBJECT);
 353 
 354 static void
 355 gst_discoverer_info_init (GstDiscovererInfo * info)
 356 {
 357   info-&gt;missing_elements_details = g_ptr_array_new_with_free_func (g_free);
 358 }
 359 
 360 static void
 361 gst_discoverer_info_finalize (GObject * object)
 362 {
 363   GstDiscovererInfo *info = (GstDiscovererInfo *) object;
 364   g_free (info-&gt;uri);
 365 
 366   if (info-&gt;stream_info)
 367     g_object_unref ((GObject *) info-&gt;stream_info);
 368 
 369   if (info-&gt;misc)
 370     gst_structure_free (info-&gt;misc);
 371 
 372   g_list_free (info-&gt;stream_list);
 373 
 374   if (info-&gt;tags)
 375     gst_tag_list_unref (info-&gt;tags);
 376 
 377   if (info-&gt;toc)
 378     gst_toc_unref (info-&gt;toc);
 379 
 380   g_ptr_array_unref (info-&gt;missing_elements_details);
 381 }
 382 
 383 static GstDiscovererInfo *
 384 gst_discoverer_info_new (void)
 385 {
 386   return (GstDiscovererInfo *) g_object_new (GST_TYPE_DISCOVERER_INFO, NULL);
 387 }
 388 
 389 /**
 390  * gst_discoverer_info_copy:
 391  * @ptr: (transfer none): a #GstDiscovererInfo
 392  *
 393  * Returns: (transfer full): A copy of the #GstDiscovererInfo
 394  */
 395 GstDiscovererInfo *
 396 gst_discoverer_info_copy (GstDiscovererInfo * ptr)
 397 {
 398   GstDiscovererInfo *ret;
 399   GHashTable *stream_map;
 400   GList *tmp;
 401 
 402   g_return_val_if_fail (ptr != NULL, NULL);
 403 
 404   stream_map = g_hash_table_new (g_direct_hash, NULL);
 405 
 406   ret = gst_discoverer_info_new ();
 407 
 408   ret-&gt;uri = g_strdup (ptr-&gt;uri);
 409   if (ptr-&gt;stream_info) {
 410     ret-&gt;stream_info = gst_discoverer_info_copy_int (ptr-&gt;stream_info,
 411         stream_map);
 412   }
 413   ret-&gt;duration = ptr-&gt;duration;
 414   ret-&gt;result = ptr-&gt;result;
 415   ret-&gt;seekable = ptr-&gt;seekable;
 416   ret-&gt;live = ptr-&gt;live;
 417   if (ptr-&gt;misc)
 418     ret-&gt;misc = gst_structure_copy (ptr-&gt;misc);
 419 
 420   /* We need to set up the new list of streams to correspond to old one. The
 421    * list just contains a set of pointers to streams in the stream_info tree,
 422    * so we keep a map of old stream info objects to the corresponding new
 423    * ones and use that to figure out correspondence in stream_list. */
 424   for (tmp = ptr-&gt;stream_list; tmp; tmp = tmp-&gt;next) {
 425     GstDiscovererStreamInfo *old_stream = (GstDiscovererStreamInfo *) tmp-&gt;data;
 426     GstDiscovererStreamInfo *new_stream = g_hash_table_lookup (stream_map,
 427         old_stream);
 428     g_assert (new_stream != NULL);
 429     ret-&gt;stream_list = g_list_append (ret-&gt;stream_list, new_stream);
 430   }
 431 
 432   if (ptr-&gt;tags)
 433     ret-&gt;tags = gst_tag_list_copy (ptr-&gt;tags);
 434 
 435   if (ptr-&gt;toc)
 436     ret-&gt;toc = gst_toc_ref (ptr-&gt;toc);
 437 
 438   g_hash_table_destroy (stream_map);
 439   return ret;
 440 }
 441 
 442 static void
 443 gst_discoverer_info_class_init (GObjectClass * klass)
 444 {
 445   klass-&gt;finalize = gst_discoverer_info_finalize;
 446 }
 447 
 448 /**
 449  * gst_discoverer_stream_info_list_free:
 450  * @infos: (element-type GstPbutils.DiscovererStreamInfo): a #GList of #GstDiscovererStreamInfo
 451  *
 452  * Decrements the reference count of all contained #GstDiscovererStreamInfo
 453  * and fress the #GList.
 454  */
 455 void
 456 gst_discoverer_stream_info_list_free (GList * infos)
 457 {
 458   GList *tmp;
 459 
 460   for (tmp = infos; tmp; tmp = tmp-&gt;next)
 461     gst_discoverer_stream_info_unref ((GstDiscovererStreamInfo *) tmp-&gt;data);
 462   g_list_free (infos);
 463 }
 464 
 465 /**
 466  * gst_discoverer_info_get_streams:
 467  * @info: a #GstDiscovererInfo
 468  * @streamtype: a #GType derived from #GstDiscovererStreamInfo
 469  *
 470  * Finds the #GstDiscovererStreamInfo contained in @info that match the
 471  * given @streamtype.
 472  *
 473  * Returns: (transfer full) (element-type GstPbutils.DiscovererStreamInfo): A #GList of
 474  * matching #GstDiscovererStreamInfo. The caller should free it with
 475  * gst_discoverer_stream_info_list_free().
 476  */
 477 GList *
 478 gst_discoverer_info_get_streams (GstDiscovererInfo * info, GType streamtype)
 479 {
 480   GList *tmp, *res = NULL;
 481 
 482   for (tmp = info-&gt;stream_list; tmp; tmp = tmp-&gt;next) {
 483     GstDiscovererStreamInfo *stmp = (GstDiscovererStreamInfo *) tmp-&gt;data;
 484 
 485     if (G_TYPE_CHECK_INSTANCE_TYPE (stmp, streamtype))
 486       res = g_list_append (res, gst_discoverer_stream_info_ref (stmp));
 487   }
 488 
 489   return res;
 490 }
 491 
 492 /**
 493  * gst_discoverer_info_get_audio_streams:
 494  * @info: a #GstDiscovererInfo
 495  *
 496  * Finds all the #GstDiscovererAudioInfo contained in @info
 497  *
 498  * Returns: (transfer full) (element-type GstPbutils.DiscovererStreamInfo): A #GList of
 499  * matching #GstDiscovererStreamInfo. The caller should free it with
 500  * gst_discoverer_stream_info_list_free().
 501  */
 502 GList *
 503 gst_discoverer_info_get_audio_streams (GstDiscovererInfo * info)
 504 {
 505   return gst_discoverer_info_get_streams (info, GST_TYPE_DISCOVERER_AUDIO_INFO);
 506 }
 507 
 508 /**
 509  * gst_discoverer_info_get_video_streams:
 510  * @info: a #GstDiscovererInfo
 511  *
 512  * Finds all the #GstDiscovererVideoInfo contained in @info
 513  *
 514  * Returns: (transfer full) (element-type GstPbutils.DiscovererStreamInfo): A #GList of
 515  * matching #GstDiscovererStreamInfo. The caller should free it with
 516  * gst_discoverer_stream_info_list_free().
 517  */
 518 GList *
 519 gst_discoverer_info_get_video_streams (GstDiscovererInfo * info)
 520 {
 521   return gst_discoverer_info_get_streams (info, GST_TYPE_DISCOVERER_VIDEO_INFO);
 522 }
 523 
 524 /**
 525  * gst_discoverer_info_get_subtitle_streams:
 526  * @info: a #GstDiscovererInfo
 527  *
 528  * Finds all the #GstDiscovererSubtitleInfo contained in @info
 529  *
 530  * Returns: (transfer full) (element-type GstPbutils.DiscovererStreamInfo): A #GList of
 531  * matching #GstDiscovererStreamInfo. The caller should free it with
 532  * gst_discoverer_stream_info_list_free().
 533  */
 534 GList *
 535 gst_discoverer_info_get_subtitle_streams (GstDiscovererInfo * info)
 536 {
 537   return gst_discoverer_info_get_streams (info,
 538       GST_TYPE_DISCOVERER_SUBTITLE_INFO);
 539 }
 540 
 541 /**
 542  * gst_discoverer_info_get_container_streams:
 543  * @info: a #GstDiscovererInfo
 544  *
 545  * Finds all the #GstDiscovererContainerInfo contained in @info
 546  *
 547  * Returns: (transfer full) (element-type GstPbutils.DiscovererStreamInfo): A #GList of
 548  * matching #GstDiscovererStreamInfo. The caller should free it with
 549  * gst_discoverer_stream_info_list_free().
 550  */
 551 GList *
 552 gst_discoverer_info_get_container_streams (GstDiscovererInfo * info)
 553 {
 554   return gst_discoverer_info_get_streams (info,
 555       GST_TYPE_DISCOVERER_CONTAINER_INFO);
 556 }
 557 
 558 /**
 559  * gst_discoverer_stream_info_get_stream_type_nick:
 560  * @info: a #GstDiscovererStreamInfo
 561  *
 562  * Returns: a human readable name for the stream type of the given @info (ex : &quot;audio&quot;,
 563  * &quot;container&quot;,...).
 564  */
 565 const gchar *
 566 gst_discoverer_stream_info_get_stream_type_nick (GstDiscovererStreamInfo * info)
 567 {
 568   if (GST_IS_DISCOVERER_CONTAINER_INFO (info))
 569     return &quot;container&quot;;
 570   if (GST_IS_DISCOVERER_AUDIO_INFO (info))
 571     return &quot;audio&quot;;
 572   if (GST_IS_DISCOVERER_VIDEO_INFO (info)) {
 573     if (gst_discoverer_video_info_is_image ((GstDiscovererVideoInfo *)
 574             info))
 575       return &quot;video(image)&quot;;
 576     else
 577       return &quot;video&quot;;
 578   }
 579   if (GST_IS_DISCOVERER_SUBTITLE_INFO (info))
 580     return &quot;subtitles&quot;;
 581   return &quot;unknown&quot;;
 582 }
 583 
 584 /* ACCESSORS */
 585 
 586 
 587 #define GENERIC_ACCESSOR_CODE(parent, parenttype, parentgtype, fieldname, type, failval) \
<a name="1" id="anc1"></a><span class="line-modified"> 588   type parent##_get_##fieldname(const parenttype info) {            \</span>
 589     g_return_val_if_fail(G_TYPE_CHECK_INSTANCE_TYPE((info), parentgtype), failval); \
<a name="2" id="anc2"></a><span class="line-modified"> 590     return (info)-&gt;fieldname;               \</span>
 591   }
 592 
 593 /**
 594  * gst_discoverer_stream_info_get_previous:
 595  * @info: a #GstDiscovererStreamInfo
 596  *
 597  * Returns: (transfer full): the previous #GstDiscovererStreamInfo in a chain.
 598  * %NULL for starting points. Unref with #gst_discoverer_stream_info_unref
 599  * after usage.
 600  */
 601 GstDiscovererStreamInfo *
 602 gst_discoverer_stream_info_get_previous (GstDiscovererStreamInfo * info)
 603 {
 604   g_return_val_if_fail (GST_IS_DISCOVERER_STREAM_INFO (info), NULL);
 605 
 606   if (info-&gt;previous)
 607     return gst_discoverer_stream_info_ref (info-&gt;previous);
 608   return NULL;
 609 }
 610 
 611 /**
 612  * gst_discoverer_stream_info_get_next:
 613  * @info: a #GstDiscovererStreamInfo
 614  *
 615  * Returns: (transfer full): the next #GstDiscovererStreamInfo in a chain. %NULL
 616  * for final streams.
 617  * Unref with #gst_discoverer_stream_info_unref after usage.
 618  */
 619 GstDiscovererStreamInfo *
 620 gst_discoverer_stream_info_get_next (GstDiscovererStreamInfo * info)
 621 {
 622   g_return_val_if_fail (GST_IS_DISCOVERER_STREAM_INFO (info), NULL);
 623 
 624   if (info-&gt;next)
 625     return gst_discoverer_stream_info_ref (info-&gt;next);
 626   return NULL;
 627 }
 628 
 629 
 630 /**
 631  * gst_discoverer_stream_info_get_caps:
 632  * @info: a #GstDiscovererStreamInfo
 633  *
 634  * Returns: (transfer full): the #GstCaps of the stream. Unref with
 635  * #gst_caps_unref after usage.
 636  */
 637 GstCaps *
 638 gst_discoverer_stream_info_get_caps (GstDiscovererStreamInfo * info)
 639 {
 640   g_return_val_if_fail (GST_IS_DISCOVERER_STREAM_INFO (info), NULL);
 641 
 642   if (info-&gt;caps)
 643     return gst_caps_ref (info-&gt;caps);
 644   return NULL;
 645 }
 646 
 647 /**
 648  * gst_discoverer_stream_info_get_tags:
 649  * @info: a #GstDiscovererStreamInfo
 650  *
 651  * Returns: (transfer none): the tags contained in this stream. If you wish to
 652  * use the tags after the life-time of @info you will need to copy them.
 653  */
 654 const GstTagList *
 655 gst_discoverer_stream_info_get_tags (GstDiscovererStreamInfo * info)
 656 {
 657   g_return_val_if_fail (GST_IS_DISCOVERER_STREAM_INFO (info), NULL);
 658 
 659   return info-&gt;tags;
 660 }
 661 
 662 /**
 663  * gst_discoverer_stream_info_get_toc:
 664  * @info: a #GstDiscovererStreamInfo
 665  *
 666  * Returns: (transfer none): the TOC contained in this stream. If you wish to
 667  * use the TOC after the life-time of @info you will need to copy it.
 668  */
 669 const GstToc *
 670 gst_discoverer_stream_info_get_toc (GstDiscovererStreamInfo * info)
 671 {
 672   g_return_val_if_fail (GST_IS_DISCOVERER_STREAM_INFO (info), NULL);
 673 
 674   return info-&gt;toc;
 675 }
 676 
 677 /**
 678  * gst_discoverer_stream_info_get_stream_id:
 679  * @info: a #GstDiscovererStreamInfo
 680  *
 681  * Returns: (transfer none): the stream ID of this stream. If you wish to
 682  * use the stream ID after the life-time of @info you will need to copy it.
 683  */
 684 const gchar *
 685 gst_discoverer_stream_info_get_stream_id (GstDiscovererStreamInfo * info)
 686 {
 687   g_return_val_if_fail (GST_IS_DISCOVERER_STREAM_INFO (info), NULL);
 688 
 689   return info-&gt;stream_id;
 690 }
 691 
<a name="3" id="anc3"></a>
 692 /**
 693  * gst_discoverer_stream_info_get_misc:
 694  * @info: a #GstDiscovererStreamInfo
 695  *
 696  * Deprecated: This functions is deprecated since version 1.4, use
 697  * #gst_discoverer_info_get_missing_elements_installer_details
 698  *
 699  * Returns: (transfer none): additional information regarding the stream (for
 700  * example codec version, profile, etc..). If you wish to use the #GstStructure
 701  * after the life-time of @info you will need to copy it.
 702  */
 703 const GstStructure *
 704 gst_discoverer_stream_info_get_misc (GstDiscovererStreamInfo * info)
 705 {
 706   g_return_val_if_fail (GST_IS_DISCOVERER_STREAM_INFO (info), NULL);
 707 
 708   return info-&gt;misc;
 709 }
<a name="4" id="anc4"></a>
 710 
 711 /* GstDiscovererContainerInfo */
 712 
 713 /**
 714  * gst_discoverer_container_info_get_streams:
 715  * @info: a #GstDiscovererStreamInfo
 716  *
 717  * Returns: (transfer full) (element-type GstPbutils.DiscovererStreamInfo): the list of
 718  * #GstDiscovererStreamInfo this container stream offers.
 719  * Free with gst_discoverer_stream_info_list_free() after usage.
 720  */
 721 
 722 GList *
 723 gst_discoverer_container_info_get_streams (GstDiscovererContainerInfo * info)
 724 {
 725   GList *res = NULL, *tmp;
 726 
 727   g_return_val_if_fail (GST_IS_DISCOVERER_CONTAINER_INFO (info), NULL);
 728 
 729   for (tmp = info-&gt;streams; tmp; tmp = tmp-&gt;next)
 730     res =
 731         g_list_append (res,
 732         gst_discoverer_stream_info_ref ((GstDiscovererStreamInfo *) tmp-&gt;data));
 733 
 734   return res;
 735 }
 736 
 737 /* GstDiscovererAudioInfo */
 738 
<a name="5" id="anc5"></a><span class="line-modified"> 739 #define AUDIO_INFO_ACCESSOR_CODE(fieldname, type, failval)      \</span>
 740   GENERIC_ACCESSOR_CODE(gst_discoverer_audio_info, GstDiscovererAudioInfo*, \
<a name="6" id="anc6"></a><span class="line-modified"> 741             GST_TYPE_DISCOVERER_AUDIO_INFO,     \</span>
<span class="line-modified"> 742             fieldname, type, failval)</span>
 743 
 744 /**
 745  * gst_discoverer_audio_info_get_channels:
 746  * @info: a #GstDiscovererAudioInfo
 747  *
 748  * Returns: the number of channels in the stream.
 749  */
 750 
 751 AUDIO_INFO_ACCESSOR_CODE (channels, guint, 0);
 752 
 753 /**
 754  * gst_discoverer_audio_info_get_channel_mask:
 755  * @info: a #GstDiscovererAudioInfo
 756  *
 757  * Returns: the channel-mask of the stream, refer to
 758  * gst_audio_channel_positions_from_mask() for more
 759  * information.
 760  *
 761  * Since: 1.14
 762  */
 763 
 764 AUDIO_INFO_ACCESSOR_CODE (channel_mask, guint64, G_MAXUINT64);
 765 
 766 /**
 767  * gst_discoverer_audio_info_get_sample_rate:
 768  * @info: a #GstDiscovererAudioInfo
 769  *
 770  * Returns: the sample rate of the stream in Hertz.
 771  */
 772 
 773 AUDIO_INFO_ACCESSOR_CODE (sample_rate, guint, 0);
 774 
 775 /**
 776  * gst_discoverer_audio_info_get_depth:
 777  * @info: a #GstDiscovererAudioInfo
 778  *
 779  * Returns: the number of bits used per sample in each channel.
 780  */
 781 
 782 AUDIO_INFO_ACCESSOR_CODE (depth, guint, 0);
 783 
 784 /**
 785  * gst_discoverer_audio_info_get_bitrate:
 786  * @info: a #GstDiscovererAudioInfo
 787  *
 788  * Returns: the average or nominal bitrate of the stream in bits/second.
 789  */
 790 
 791 AUDIO_INFO_ACCESSOR_CODE (bitrate, guint, 0);
 792 
 793 /**
 794  * gst_discoverer_audio_info_get_max_bitrate:
 795  * @info: a #GstDiscovererAudioInfo
 796  *
 797  * Returns: the maximum bitrate of the stream in bits/second.
 798  */
 799 
 800 AUDIO_INFO_ACCESSOR_CODE (max_bitrate, guint, 0);
 801 
 802 /**
 803  * gst_discoverer_audio_info_get_language:
 804  * @info: a #GstDiscovererAudioInfo
 805  *
 806  * Returns: the language of the stream, or NULL if unknown.
 807  */
 808 
 809 AUDIO_INFO_ACCESSOR_CODE (language, const gchar *, NULL);
 810 
 811 /* GstDiscovererVideoInfo */
 812 
<a name="7" id="anc7"></a><span class="line-modified"> 813 #define VIDEO_INFO_ACCESSOR_CODE(fieldname, type, failval)      \</span>
 814   GENERIC_ACCESSOR_CODE(gst_discoverer_video_info, GstDiscovererVideoInfo*, \
<a name="8" id="anc8"></a><span class="line-modified"> 815             GST_TYPE_DISCOVERER_VIDEO_INFO,         \</span>
<span class="line-modified"> 816             fieldname, type, failval)</span>
 817 
 818 /**
 819  * gst_discoverer_video_info_get_width:
 820  * @info: a #GstDiscovererVideoInfo
 821  *
 822  * Returns: the width of the video stream in pixels.
 823  */
 824 
 825 VIDEO_INFO_ACCESSOR_CODE (width, guint, 0);
 826 
 827 /**
 828  * gst_discoverer_video_info_get_height:
 829  * @info: a #GstDiscovererVideoInfo
 830  *
 831  * Returns: the height of the video stream in pixels.
 832  */
 833 
 834 VIDEO_INFO_ACCESSOR_CODE (height, guint, 0);
 835 
 836 /**
 837  * gst_discoverer_video_info_get_depth:
 838  * @info: a #GstDiscovererVideoInfo
 839  *
 840  * Returns: the depth in bits of the video stream.
 841  */
 842 
 843 VIDEO_INFO_ACCESSOR_CODE (depth, guint, 0);
 844 
 845 /**
 846  * gst_discoverer_video_info_get_framerate_num:
 847  * @info: a #GstDiscovererVideoInfo
 848  *
 849  * Returns: the framerate of the video stream (numerator).
 850  */
 851 
 852 VIDEO_INFO_ACCESSOR_CODE (framerate_num, guint, 0);
 853 
 854 /**
 855  * gst_discoverer_video_info_get_framerate_denom:
 856  * @info: a #GstDiscovererVideoInfo
 857  *
 858  * Returns: the framerate of the video stream (denominator).
 859  */
 860 
 861 VIDEO_INFO_ACCESSOR_CODE (framerate_denom, guint, 0);
 862 
 863 /**
 864  * gst_discoverer_video_info_get_par_num:
 865  * @info: a #GstDiscovererVideoInfo
 866  *
 867  * Returns: the Pixel Aspect Ratio (PAR) of the video stream (numerator).
 868  */
 869 
 870 VIDEO_INFO_ACCESSOR_CODE (par_num, guint, 0);
 871 
 872 /**
 873  * gst_discoverer_video_info_get_par_denom:
 874  * @info: a #GstDiscovererVideoInfo
 875  *
 876  * Returns: the Pixel Aspect Ratio (PAR) of the video stream (denominator).
 877  */
 878 
 879 VIDEO_INFO_ACCESSOR_CODE (par_denom, guint, 0);
 880 
 881 /**
 882  * gst_discoverer_video_info_is_interlaced:
 883  * @info: a #GstDiscovererVideoInfo
 884  *
 885  * Returns: %TRUE if the stream is interlaced, else %FALSE.
 886  */
 887 gboolean
 888 gst_discoverer_video_info_is_interlaced (const GstDiscovererVideoInfo * info)
 889 {
 890   g_return_val_if_fail (GST_IS_DISCOVERER_VIDEO_INFO (info), FALSE);
 891 
 892   return info-&gt;interlaced;
 893 }
 894 
 895 /**
 896  * gst_discoverer_video_info_get_bitrate:
 897  * @info: a #GstDiscovererVideoInfo
 898  *
 899  * Returns: the average or nominal bitrate of the video stream in bits/second.
 900  */
 901 
 902 VIDEO_INFO_ACCESSOR_CODE (bitrate, guint, 0);
 903 
 904 /**
 905  * gst_discoverer_video_info_get_max_bitrate:
 906  * @info: a #GstDiscovererVideoInfo
 907  *
 908  * Returns: the maximum bitrate of the video stream in bits/second.
 909  */
 910 
 911 VIDEO_INFO_ACCESSOR_CODE (max_bitrate, guint, 0);
 912 
 913 /**
 914  * gst_discoverer_video_info_is_image:
 915  * @info: a #GstDiscovererVideoInfo
 916  *
 917  * Returns: %TRUE if the video stream corresponds to an image (i.e. only contains
 918  * one frame).
 919  */
 920 gboolean
 921 gst_discoverer_video_info_is_image (const GstDiscovererVideoInfo * info)
 922 {
 923   g_return_val_if_fail (GST_IS_DISCOVERER_VIDEO_INFO (info), FALSE);
 924 
 925   return info-&gt;is_image;
 926 }
 927 
 928 /* GstDiscovererSubtitleInfo */
 929 
 930 #define SUBTITLE_INFO_ACCESSOR_CODE(fieldname, type, failval)                     \
 931   GENERIC_ACCESSOR_CODE(gst_discoverer_subtitle_info, GstDiscovererSubtitleInfo*, \
<a name="9" id="anc9"></a><span class="line-modified"> 932             GST_TYPE_DISCOVERER_SUBTITLE_INFO,                        \</span>
<span class="line-modified"> 933             fieldname, type, failval)</span>
 934 
 935 /**
 936  * gst_discoverer_subtitle_info_get_language:
 937  * @info: a #GstDiscovererSubtitleInfo
 938  *
 939  * Returns: the language of the stream, or NULL if unknown.
 940  */
 941 
 942 SUBTITLE_INFO_ACCESSOR_CODE (language, const gchar *, NULL);
 943 
 944 /* GstDiscovererInfo */
 945 
<a name="10" id="anc10"></a><span class="line-modified"> 946 #define DISCOVERER_INFO_ACCESSOR_CODE(fieldname, type, failval)     \</span>
<span class="line-modified"> 947   GENERIC_ACCESSOR_CODE(gst_discoverer_info, GstDiscovererInfo*,    \</span>
<span class="line-modified"> 948             GST_TYPE_DISCOVERER_INFO,           \</span>
<span class="line-modified"> 949             fieldname, type, failval)</span>
 950 
 951 /**
 952  * gst_discoverer_info_get_uri:
 953  * @info: a #GstDiscovererInfo
 954  *
 955  * Returns: (transfer none): the URI to which this information corresponds to.
 956  * Copy it if you wish to use it after the life-time of @info.
 957  */
 958 
 959 DISCOVERER_INFO_ACCESSOR_CODE (uri, const gchar *, NULL);
 960 
 961 /**
 962  * gst_discoverer_info_get_result:
 963  * @info: a #GstDiscovererInfo
 964  *
 965  * Returns: the result of the discovery as a #GstDiscovererResult.
 966  */
 967 
 968 DISCOVERER_INFO_ACCESSOR_CODE (result, GstDiscovererResult, GST_DISCOVERER_OK);
 969 
 970 /**
 971  * gst_discoverer_info_get_stream_info:
 972  * @info: a #GstDiscovererInfo
 973  *
 974  * Returns: (transfer full): the structure (or topology) of the URI as a
 975  * #GstDiscovererStreamInfo.
 976  * This structure can be traversed to see the original hierarchy. Unref with
 977  * gst_discoverer_stream_info_unref() after usage.
 978  */
 979 
 980 GstDiscovererStreamInfo *
 981 gst_discoverer_info_get_stream_info (GstDiscovererInfo * info)
 982 {
 983   g_return_val_if_fail (GST_IS_DISCOVERER_INFO (info), NULL);
 984 
 985   if (info-&gt;stream_info)
 986     return gst_discoverer_stream_info_ref (info-&gt;stream_info);
 987   return NULL;
 988 }
 989 
 990 /**
 991  * gst_discoverer_info_get_stream_list:
 992  * @info: a #GstDiscovererInfo
 993  *
 994  * Returns: (transfer full) (element-type GstPbutils.DiscovererStreamInfo): the list of
 995  * all streams contained in the #info. Free after usage
 996  * with gst_discoverer_stream_info_list_free().
 997  */
 998 GList *
 999 gst_discoverer_info_get_stream_list (GstDiscovererInfo * info)
1000 {
1001   GList *res = NULL, *tmp;
1002 
1003   g_return_val_if_fail (GST_IS_DISCOVERER_INFO (info), NULL);
1004 
1005   for (tmp = info-&gt;stream_list; tmp; tmp = tmp-&gt;next)
1006     res =
1007         g_list_append (res,
1008         gst_discoverer_stream_info_ref ((GstDiscovererStreamInfo *) tmp-&gt;data));
1009 
1010   return res;
1011 }
1012 
1013 /**
1014  * gst_discoverer_info_get_duration:
1015  * @info: a #GstDiscovererInfo
1016  *
1017  * Returns: the duration of the URI in #GstClockTime (nanoseconds).
1018  */
1019 
1020 DISCOVERER_INFO_ACCESSOR_CODE (duration, GstClockTime, GST_CLOCK_TIME_NONE);
1021 
1022 /**
1023  * gst_discoverer_info_get_seekable:
1024  * @info: a #GstDiscovererInfo
1025  *
1026  * Returns: the whether the URI is seekable.
1027  */
1028 
1029 DISCOVERER_INFO_ACCESSOR_CODE (seekable, gboolean, FALSE);
1030 
1031 /**
1032  * gst_discoverer_info_get_live:
1033  * @info: a #GstDiscovererInfo
1034  *
1035  * Returns: whether the URI is live.
1036  *
1037  * Since: 1.14
1038  */
1039 
1040 DISCOVERER_INFO_ACCESSOR_CODE (live, gboolean, FALSE);
1041 
<a name="11" id="anc11"></a>
1042 /**
1043  * gst_discoverer_info_get_misc:
1044  * @info: a #GstDiscovererInfo
1045  *
1046  * Deprecated: This functions is deprecated since version 1.4, use
1047  * #gst_discoverer_info_get_missing_elements_installer_details
1048  *
1049  * Returns: (transfer none): Miscellaneous information stored as a #GstStructure
1050  * (for example: information about missing plugins). If you wish to use the
1051  * #GstStructure after the life-time of @info, you will need to copy it.
1052  */
1053 
1054 DISCOVERER_INFO_ACCESSOR_CODE (misc, const GstStructure *, NULL);
<a name="12" id="anc12"></a>
1055 
1056 /**
1057  * gst_discoverer_info_get_tags:
1058  * @info: a #GstDiscovererInfo
1059  *
1060  * Returns: (transfer none): all tags contained in the URI. If you wish to use
1061  * the tags after the life-time of @info, you will need to copy them.
1062  */
1063 
1064 DISCOVERER_INFO_ACCESSOR_CODE (tags, const GstTagList *, NULL);
1065 
1066 /**
1067  * gst_discoverer_info_get_toc:
1068  * @info: a #GstDiscovererInfo
1069  *
1070  * Returns: (transfer none): TOC contained in the URI. If you wish to use
1071  * the TOC after the life-time of @info, you will need to copy it.
1072  */
1073 
1074 DISCOVERER_INFO_ACCESSOR_CODE (toc, const GstToc *, NULL);
1075 
1076 /**
1077  * gst_discoverer_info_ref:
1078  * @info: a #GstDiscovererInfo
1079  *
1080  * Increments the reference count of @info.
1081  *
1082  * Returns: the same #GstDiscovererInfo object
1083  */
1084 
1085 /**
1086  * gst_discoverer_info_unref:
1087  * @info: a #GstDiscovererInfo
1088  *
1089  * Decrements the reference count of @info.
1090  */
1091 
1092 /**
1093  * gst_discoverer_stream_info_ref:
1094  * @info: a #GstDiscovererStreamInfo
1095  *
1096  * Increments the reference count of @info.
1097  *
1098  * Returns: the same #GstDiscovererStreamInfo object
1099  */
1100 
1101 /**
1102  * gst_discoverer_stream_info_unref:
1103  * @info: a #GstDiscovererStreamInfo
1104  *
1105  * Decrements the reference count of @info.
1106  */
1107 
1108 
1109 /**
1110  * gst_discoverer_info_get_missing_elements_installer_details:
1111  * @info: a #GstDiscovererStreamInfo to retrieve installer detail
1112  * for the missing element
1113  *
1114  * Get the installer details for missing elements
1115  *
1116  * Returns: (transfer none) (array zero-terminated=1): An array of strings
1117  * containing informations about how to install the various missing elements
1118  * for @info to be usable. If you wish to use the strings after the life-time
1119  * of @info, you will need to copy them.
1120  *
1121  * Since: 1.4
1122  */
1123 const gchar **
1124 gst_discoverer_info_get_missing_elements_installer_details (const
1125     GstDiscovererInfo * info)
1126 {
1127 
1128   if (info-&gt;result != GST_DISCOVERER_MISSING_PLUGINS) {
1129     GST_WARNING_OBJECT (info, &quot;Trying to get missing element installed details &quot;
1130         &quot;but result is not &#39;MISSING_PLUGINS&#39;&quot;);
1131 
1132     return NULL;
1133   }
1134 
1135   if (info-&gt;missing_elements_details-&gt;pdata[info-&gt;missing_elements_details-&gt;
1136           len]) {
1137     GST_DEBUG (&quot;Adding NULL pointer to the end of missing_elements_details&quot;);
1138     g_ptr_array_add (info-&gt;missing_elements_details, NULL);
1139   }
1140 
1141   return (const gchar **) info-&gt;missing_elements_details-&gt;pdata;
1142 }
<a name="13" id="anc13"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="13" type="hidden" />
</body>
</html>