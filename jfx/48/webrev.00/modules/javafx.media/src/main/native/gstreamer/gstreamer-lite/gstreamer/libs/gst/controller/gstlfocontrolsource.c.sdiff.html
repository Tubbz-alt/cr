<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/libs/gst/controller/gstlfocontrolsource.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gstinterpolationcontrolsource.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="gsttimedvaluecontrolsource.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/libs/gst/controller/gstlfocontrolsource.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 18  * You should have received a copy of the GNU Library General Public
 19  * License along with this library; if not, write to the
 20  * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,
 21  * Boston, MA 02110-1301, USA.
 22  */
 23 
 24 /**
 25  * SECTION:gstlfocontrolsource
 26  * @title: GstLFOControlSource
 27  * @short_description: LFO control source
 28  *
 29  * #GstLFOControlSource is a #GstControlSource, that provides several periodic
 30  * waveforms as control values.
 31  *
 32  * To use #GstLFOControlSource get a new instance by calling
 33  * gst_lfo_control_source_new(), bind it to a #GParamSpec and set the relevant
 34  * properties.
 35  *
 36  * All functions are MT-safe.
 37  */



 38 
 39 #include &lt;float.h&gt;
 40 
 41 #include &lt;glib-object.h&gt;
 42 #include &lt;gst/gst.h&gt;
 43 #include &lt;gst/gstcontrolsource.h&gt;
 44 
 45 #include &quot;gstlfocontrolsource.h&quot;
 46 
 47 #include &quot;gst/glib-compat-private.h&quot;
 48 
 49 #include &lt;gst/math-compat.h&gt;
 50 
 51 #define GST_CAT_DEFAULT controller_debug
 52 GST_DEBUG_CATEGORY_STATIC (GST_CAT_DEFAULT);
 53 
 54 struct _GstLFOControlSourcePrivate
 55 {
 56   GstLFOWaveform waveform;
 57   gdouble frequency;
</pre>
<hr />
<pre>
360   (GstControlSourceGetValue) waveform_triangle_get,
361         (GstControlSourceGetValueArray) waveform_triangle_get_value_array}
362 };
363 
364 static const guint num_waveforms = G_N_ELEMENTS (waveforms);
365 
366 enum
367 {
368   PROP_WAVEFORM = 1,
369   PROP_FREQUENCY,
370   PROP_TIMESHIFT,
371   PROP_AMPLITUDE,
372   PROP_OFFSET
373 };
374 
375 #define _do_init \
376   GST_DEBUG_CATEGORY_INIT (GST_CAT_DEFAULT, &quot;lfo control source&quot;, 0, &quot;low frequency oscillator control source&quot;)
377 
378 #define gst_lfo_control_source_parent_class parent_class
379 G_DEFINE_TYPE_WITH_CODE (GstLFOControlSource, gst_lfo_control_source,
<span class="line-modified">380     GST_TYPE_CONTROL_SOURCE, _do_init);</span>
381 
382 static void
383 gst_lfo_control_source_reset (GstLFOControlSource * self)
384 {
385   GstControlSource *csource = GST_CONTROL_SOURCE (self);
386 
387   csource-&gt;get_value = NULL;
388   csource-&gt;get_value_array = NULL;
389 }
390 
391 /**
392  * gst_lfo_control_source_new:
393  *
394  * This returns a new, unbound #GstLFOControlSource.
395  *
396  * Returns: (transfer full): a new, unbound #GstLFOControlSource.
397  */
398 GstControlSource *
399 gst_lfo_control_source_new (void)
400 {
</pre>
<hr />
<pre>
411     GstLFOWaveform waveform)
412 {
413   GstControlSource *csource = GST_CONTROL_SOURCE (self);
414 
415   if (waveform &gt;= num_waveforms || (int) waveform &lt; 0) {
416     GST_WARNING (&quot;waveform %d invalid or not implemented yet&quot;, waveform);
417     return FALSE;
418   }
419 
420   csource-&gt;get_value = waveforms[waveform].get;
421   csource-&gt;get_value_array = waveforms[waveform].get_value_array;
422 
423   self-&gt;priv-&gt;waveform = waveform;
424 
425   return TRUE;
426 }
427 
428 static void
429 gst_lfo_control_source_init (GstLFOControlSource * self)
430 {
<span class="line-modified">431   self-&gt;priv =</span>
<span class="line-removed">432       G_TYPE_INSTANCE_GET_PRIVATE (self, GST_TYPE_LFO_CONTROL_SOURCE,</span>
<span class="line-removed">433       GstLFOControlSourcePrivate);</span>
434   self-&gt;priv-&gt;waveform = gst_lfo_control_source_set_waveform (self,
435       GST_LFO_WAVEFORM_SINE);
436   self-&gt;priv-&gt;frequency = 1.0;
437   self-&gt;priv-&gt;amplitude = 1.0;
438   self-&gt;priv-&gt;period = GST_SECOND / self-&gt;priv-&gt;frequency;
439   self-&gt;priv-&gt;timeshift = 0;
440 
441   g_mutex_init (&amp;self-&gt;lock);
442 }
443 
444 static void
445 gst_lfo_control_source_finalize (GObject * obj)
446 {
447   GstLFOControlSource *self = GST_LFO_CONTROL_SOURCE (obj);
448 
449   gst_lfo_control_source_reset (self);
450   g_mutex_clear (&amp;self-&gt;lock);
451 
452   G_OBJECT_CLASS (parent_class)-&gt;finalize (obj);
453 }
</pre>
<hr />
<pre>
513     case PROP_TIMESHIFT:
514       g_value_set_uint64 (value, self-&gt;priv-&gt;timeshift);
515       break;
516     case PROP_AMPLITUDE:
517       g_value_set_double (value, self-&gt;priv-&gt;amplitude);
518       break;
519     case PROP_OFFSET:
520       g_value_set_double (value, self-&gt;priv-&gt;offset);
521       break;
522     default:
523       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
524       break;
525   }
526 }
527 
528 static void
529 gst_lfo_control_source_class_init (GstLFOControlSourceClass * klass)
530 {
531   GObjectClass *gobject_class = G_OBJECT_CLASS (klass);
532 
<span class="line-removed">533   g_type_class_add_private (klass, sizeof (GstLFOControlSourcePrivate));</span>
<span class="line-removed">534 </span>
535   gobject_class-&gt;finalize = gst_lfo_control_source_finalize;
536   gobject_class-&gt;set_property = gst_lfo_control_source_set_property;
537   gobject_class-&gt;get_property = gst_lfo_control_source_get_property;
538 
539   /**
540    * GstLFOControlSource:waveform:
541    *
542    * Specifies the waveform that should be used for this #GstLFOControlSource.
543    */
544   g_object_class_install_property (gobject_class, PROP_WAVEFORM,
545       g_param_spec_enum (&quot;waveform&quot;, &quot;Waveform&quot;, &quot;Waveform&quot;,
546           GST_TYPE_LFO_WAVEFORM, GST_LFO_WAVEFORM_SINE,
547           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
548 
549   /**
550    * GstLFOControlSource:frequency:
551    *
552    * Specifies the frequency that should be used for the waveform
553    * of this #GstLFOControlSource. It should be large enough
554    * so that the period is longer than one nanosecond.
</pre>
</td>
<td>
<hr />
<pre>
 18  * You should have received a copy of the GNU Library General Public
 19  * License along with this library; if not, write to the
 20  * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,
 21  * Boston, MA 02110-1301, USA.
 22  */
 23 
 24 /**
 25  * SECTION:gstlfocontrolsource
 26  * @title: GstLFOControlSource
 27  * @short_description: LFO control source
 28  *
 29  * #GstLFOControlSource is a #GstControlSource, that provides several periodic
 30  * waveforms as control values.
 31  *
 32  * To use #GstLFOControlSource get a new instance by calling
 33  * gst_lfo_control_source_new(), bind it to a #GParamSpec and set the relevant
 34  * properties.
 35  *
 36  * All functions are MT-safe.
 37  */
<span class="line-added"> 38 #ifdef HAVE_CONFIG_H</span>
<span class="line-added"> 39 #include &quot;config.h&quot;</span>
<span class="line-added"> 40 #endif</span>
 41 
 42 #include &lt;float.h&gt;
 43 
 44 #include &lt;glib-object.h&gt;
 45 #include &lt;gst/gst.h&gt;
 46 #include &lt;gst/gstcontrolsource.h&gt;
 47 
 48 #include &quot;gstlfocontrolsource.h&quot;
 49 
 50 #include &quot;gst/glib-compat-private.h&quot;
 51 
 52 #include &lt;gst/math-compat.h&gt;
 53 
 54 #define GST_CAT_DEFAULT controller_debug
 55 GST_DEBUG_CATEGORY_STATIC (GST_CAT_DEFAULT);
 56 
 57 struct _GstLFOControlSourcePrivate
 58 {
 59   GstLFOWaveform waveform;
 60   gdouble frequency;
</pre>
<hr />
<pre>
363   (GstControlSourceGetValue) waveform_triangle_get,
364         (GstControlSourceGetValueArray) waveform_triangle_get_value_array}
365 };
366 
367 static const guint num_waveforms = G_N_ELEMENTS (waveforms);
368 
369 enum
370 {
371   PROP_WAVEFORM = 1,
372   PROP_FREQUENCY,
373   PROP_TIMESHIFT,
374   PROP_AMPLITUDE,
375   PROP_OFFSET
376 };
377 
378 #define _do_init \
379   GST_DEBUG_CATEGORY_INIT (GST_CAT_DEFAULT, &quot;lfo control source&quot;, 0, &quot;low frequency oscillator control source&quot;)
380 
381 #define gst_lfo_control_source_parent_class parent_class
382 G_DEFINE_TYPE_WITH_CODE (GstLFOControlSource, gst_lfo_control_source,
<span class="line-modified">383     GST_TYPE_CONTROL_SOURCE, G_ADD_PRIVATE (GstLFOControlSource) _do_init);</span>
384 
385 static void
386 gst_lfo_control_source_reset (GstLFOControlSource * self)
387 {
388   GstControlSource *csource = GST_CONTROL_SOURCE (self);
389 
390   csource-&gt;get_value = NULL;
391   csource-&gt;get_value_array = NULL;
392 }
393 
394 /**
395  * gst_lfo_control_source_new:
396  *
397  * This returns a new, unbound #GstLFOControlSource.
398  *
399  * Returns: (transfer full): a new, unbound #GstLFOControlSource.
400  */
401 GstControlSource *
402 gst_lfo_control_source_new (void)
403 {
</pre>
<hr />
<pre>
414     GstLFOWaveform waveform)
415 {
416   GstControlSource *csource = GST_CONTROL_SOURCE (self);
417 
418   if (waveform &gt;= num_waveforms || (int) waveform &lt; 0) {
419     GST_WARNING (&quot;waveform %d invalid or not implemented yet&quot;, waveform);
420     return FALSE;
421   }
422 
423   csource-&gt;get_value = waveforms[waveform].get;
424   csource-&gt;get_value_array = waveforms[waveform].get_value_array;
425 
426   self-&gt;priv-&gt;waveform = waveform;
427 
428   return TRUE;
429 }
430 
431 static void
432 gst_lfo_control_source_init (GstLFOControlSource * self)
433 {
<span class="line-modified">434   self-&gt;priv = gst_lfo_control_source_get_instance_private (self);</span>


435   self-&gt;priv-&gt;waveform = gst_lfo_control_source_set_waveform (self,
436       GST_LFO_WAVEFORM_SINE);
437   self-&gt;priv-&gt;frequency = 1.0;
438   self-&gt;priv-&gt;amplitude = 1.0;
439   self-&gt;priv-&gt;period = GST_SECOND / self-&gt;priv-&gt;frequency;
440   self-&gt;priv-&gt;timeshift = 0;
441 
442   g_mutex_init (&amp;self-&gt;lock);
443 }
444 
445 static void
446 gst_lfo_control_source_finalize (GObject * obj)
447 {
448   GstLFOControlSource *self = GST_LFO_CONTROL_SOURCE (obj);
449 
450   gst_lfo_control_source_reset (self);
451   g_mutex_clear (&amp;self-&gt;lock);
452 
453   G_OBJECT_CLASS (parent_class)-&gt;finalize (obj);
454 }
</pre>
<hr />
<pre>
514     case PROP_TIMESHIFT:
515       g_value_set_uint64 (value, self-&gt;priv-&gt;timeshift);
516       break;
517     case PROP_AMPLITUDE:
518       g_value_set_double (value, self-&gt;priv-&gt;amplitude);
519       break;
520     case PROP_OFFSET:
521       g_value_set_double (value, self-&gt;priv-&gt;offset);
522       break;
523     default:
524       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
525       break;
526   }
527 }
528 
529 static void
530 gst_lfo_control_source_class_init (GstLFOControlSourceClass * klass)
531 {
532   GObjectClass *gobject_class = G_OBJECT_CLASS (klass);
533 


534   gobject_class-&gt;finalize = gst_lfo_control_source_finalize;
535   gobject_class-&gt;set_property = gst_lfo_control_source_set_property;
536   gobject_class-&gt;get_property = gst_lfo_control_source_get_property;
537 
538   /**
539    * GstLFOControlSource:waveform:
540    *
541    * Specifies the waveform that should be used for this #GstLFOControlSource.
542    */
543   g_object_class_install_property (gobject_class, PROP_WAVEFORM,
544       g_param_spec_enum (&quot;waveform&quot;, &quot;Waveform&quot;, &quot;Waveform&quot;,
545           GST_TYPE_LFO_WAVEFORM, GST_LFO_WAVEFORM_SINE,
546           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
547 
548   /**
549    * GstLFOControlSource:frequency:
550    *
551    * Specifies the frequency that should be used for the waveform
552    * of this #GstLFOControlSource. It should be large enough
553    * so that the period is longer than one nanosecond.
</pre>
</td>
</tr>
</table>
<center><a href="gstinterpolationcontrolsource.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="gsttimedvaluecontrolsource.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>