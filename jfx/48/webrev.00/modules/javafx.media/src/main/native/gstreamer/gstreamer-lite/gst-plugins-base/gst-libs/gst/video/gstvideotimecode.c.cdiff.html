<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/gstvideotimecode.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gstvideosink.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="gstvideotimecode.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/gstvideotimecode.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 14,10 ***</span>
<span class="line-new-header">--- 14,13 ---</span>
   * You should have received a copy of the GNU Library General Public
   * License along with this library; if not, write to the
   * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,
   * Boston, MA 02110-1301, USA.
   */
<span class="line-added">+ #ifdef HAVE_CONFIG_H</span>
<span class="line-added">+ #include &quot;config.h&quot;</span>
<span class="line-added">+ #endif</span>
  
  #include &lt;stdio.h&gt;
  #include &quot;gstvideotimecode.h&quot;
  
  static void
</pre>
<hr />
<pre>
<span class="line-old-header">*** 64,43 ***</span>
  {
    guint fr;
  
    g_return_val_if_fail (tc != NULL, FALSE);
  
<span class="line-modified">!   fr = (tc-&gt;config.fps_n + (tc-&gt;config.fps_d &gt;&gt; 1)) / tc-&gt;config.fps_d;</span>
  
    if (tc-&gt;hours &gt;= 24)
      return FALSE;
    if (tc-&gt;minutes &gt;= 60)
      return FALSE;
    if (tc-&gt;seconds &gt;= 60)
      return FALSE;
<span class="line-modified">!   if (tc-&gt;config.fps_d == 0)</span>
<span class="line-modified">!     return FALSE;</span>
    if (tc-&gt;frames &gt;= fr &amp;&amp; (tc-&gt;config.fps_n != 0 || tc-&gt;config.fps_d != 1))
      return FALSE;
    if (tc-&gt;config.fps_d == 1001) {
      if (tc-&gt;config.fps_n != 30000 &amp;&amp; tc-&gt;config.fps_n != 60000 &amp;&amp;
          tc-&gt;config.fps_n != 24000)
        return FALSE;
    } else if (tc-&gt;config.fps_n % tc-&gt;config.fps_d != 0) {
      return FALSE;
    }
    if ((tc-&gt;config.flags &amp; GST_VIDEO_TIME_CODE_FLAGS_DROP_FRAME) &amp;&amp;
        tc-&gt;minutes % 10 &amp;&amp; tc-&gt;seconds == 0 &amp;&amp; tc-&gt;frames &lt; fr / 15) {
      return FALSE;
    }
  
    return TRUE;
  }
  
  /**
   * gst_video_time_code_to_string:
<span class="line-modified">!  * @tc: #GstVideoTimeCode to convert</span>
   *
   * Returns: the SMPTE ST 2059-1:2015 string representation of @tc. That will
<span class="line-modified">!  * take the form hh:mm:ss:ff . The last separator (between seconds and frames)</span>
   * may vary:
   *
   * &#39;;&#39; for drop-frame, non-interlaced content and for drop-frame interlaced
   * field 2
   * &#39;,&#39; for drop-frame interlaced field 1
<span class="line-new-header">--- 67,60 ---</span>
  {
    guint fr;
  
    g_return_val_if_fail (tc != NULL, FALSE);
  
<span class="line-modified">!   if (tc-&gt;config.fps_n == 0 || tc-&gt;config.fps_d == 0)</span>
<span class="line-added">+     return FALSE;</span>
  
    if (tc-&gt;hours &gt;= 24)
      return FALSE;
    if (tc-&gt;minutes &gt;= 60)
      return FALSE;
    if (tc-&gt;seconds &gt;= 60)
      return FALSE;
<span class="line-modified">! </span>
<span class="line-modified">!   /* We can&#39;t have more frames than rounded up frames per second */</span>
<span class="line-added">+   fr = (tc-&gt;config.fps_n + (tc-&gt;config.fps_d &gt;&gt; 1)) / tc-&gt;config.fps_d;</span>
    if (tc-&gt;frames &gt;= fr &amp;&amp; (tc-&gt;config.fps_n != 0 || tc-&gt;config.fps_d != 1))
      return FALSE;
<span class="line-added">+ </span>
<span class="line-added">+   /* We either need a specific X/1001 framerate or otherwise an integer</span>
<span class="line-added">+    * framerate */</span>
    if (tc-&gt;config.fps_d == 1001) {
      if (tc-&gt;config.fps_n != 30000 &amp;&amp; tc-&gt;config.fps_n != 60000 &amp;&amp;
          tc-&gt;config.fps_n != 24000)
        return FALSE;
    } else if (tc-&gt;config.fps_n % tc-&gt;config.fps_d != 0) {
      return FALSE;
    }
<span class="line-added">+ </span>
<span class="line-added">+   /* We only support 30000/1001 and 60000/1001 as drop-frame framerates.</span>
<span class="line-added">+    * 24000/1001 is *not* a drop-frame framerate! */</span>
<span class="line-added">+   if (tc-&gt;config.flags &amp; GST_VIDEO_TIME_CODE_FLAGS_DROP_FRAME) {</span>
<span class="line-added">+     if (tc-&gt;config.fps_d != 1001 || (tc-&gt;config.fps_n != 30000</span>
<span class="line-added">+             &amp;&amp; tc-&gt;config.fps_n != 60000))</span>
<span class="line-added">+       return FALSE;</span>
<span class="line-added">+   }</span>
<span class="line-added">+ </span>
<span class="line-added">+   /* Drop-frame framerates require skipping over the first two</span>
<span class="line-added">+    * timecodes every minutes except for every tenth minute in case</span>
<span class="line-added">+    * of 30000/1001 and the first four timecodes for 60000/1001 */</span>
    if ((tc-&gt;config.flags &amp; GST_VIDEO_TIME_CODE_FLAGS_DROP_FRAME) &amp;&amp;
        tc-&gt;minutes % 10 &amp;&amp; tc-&gt;seconds == 0 &amp;&amp; tc-&gt;frames &lt; fr / 15) {
      return FALSE;
    }
  
    return TRUE;
  }
  
  /**
   * gst_video_time_code_to_string:
<span class="line-modified">!  * @tc: A #GstVideoTimeCode to convert</span>
   *
   * Returns: the SMPTE ST 2059-1:2015 string representation of @tc. That will
<span class="line-modified">!  * take the form hh:mm:ss:ff. The last separator (between seconds and frames)</span>
   * may vary:
   *
   * &#39;;&#39; for drop-frame, non-interlaced content and for drop-frame interlaced
   * field 2
   * &#39;,&#39; for drop-frame interlaced field 1
</pre>
<hr />
<pre>
<span class="line-old-header">*** 139,11 ***</span>
   * gst_video_time_code_to_date_time:
   * @tc: A valid #GstVideoTimeCode to convert
   *
   * The @tc.config-&gt;latest_daily_jam is required to be non-NULL.
   *
<span class="line-modified">!  * Returns: the #GDateTime representation of @tc.</span>
   *
   * Since: 1.10
   */
  GDateTime *
  gst_video_time_code_to_date_time (const GstVideoTimeCode * tc)
<span class="line-new-header">--- 159,12 ---</span>
   * gst_video_time_code_to_date_time:
   * @tc: A valid #GstVideoTimeCode to convert
   *
   * The @tc.config-&gt;latest_daily_jam is required to be non-NULL.
   *
<span class="line-modified">!  * Returns: (nullable): the #GDateTime representation of @tc or %NULL if @tc</span>
<span class="line-added">+  *   has no daily jam.</span>
   *
   * Since: 1.10
   */
  GDateTime *
  gst_video_time_code_to_date_time (const GstVideoTimeCode * tc)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 151,33 ***</span>
    GDateTime *ret;
    GDateTime *ret2;
    gdouble add_us;
  
    g_return_val_if_fail (gst_video_time_code_is_valid (tc), NULL);
<span class="line-removed">-   g_return_val_if_fail (tc-&gt;config.latest_daily_jam != NULL, NULL);</span>
  
<span class="line-modified">!   ret = g_date_time_ref (tc-&gt;config.latest_daily_jam);</span>
<span class="line-removed">- </span>
<span class="line-removed">-   if (ret == NULL) {</span>
      gchar *tc_str = gst_video_time_code_to_string (tc);
      GST_WARNING
          (&quot;Asked to convert time code %s to GDateTime, but its latest daily jam is NULL&quot;,
          tc_str);
      g_free (tc_str);
<span class="line-removed">-     g_date_time_unref (ret);</span>
      return NULL;
    }
  
<span class="line-modified">!   if (tc-&gt;config.fps_n == 0 &amp;&amp; tc-&gt;config.fps_d == 1) {</span>
<span class="line-removed">-     gchar *tc_str = gst_video_time_code_to_string (tc);</span>
<span class="line-removed">-     GST_WARNING</span>
<span class="line-removed">-         (&quot;Asked to convert time code %s to GDateTime, but its framerate is unknown&quot;,</span>
<span class="line-removed">-         tc_str);</span>
<span class="line-removed">-     g_free (tc_str);</span>
<span class="line-removed">-     g_date_time_unref (ret);</span>
<span class="line-removed">-     return NULL;</span>
<span class="line-removed">-   }</span>
  
    gst_util_fraction_to_double (tc-&gt;frames * tc-&gt;config.fps_d, tc-&gt;config.fps_n,
        &amp;add_us);
    if ((tc-&gt;config.flags &amp; GST_VIDEO_TIME_CODE_FLAGS_INTERLACED)
        &amp;&amp; tc-&gt;field_count == 1) {
<span class="line-new-header">--- 172,21 ---</span>
    GDateTime *ret;
    GDateTime *ret2;
    gdouble add_us;
  
    g_return_val_if_fail (gst_video_time_code_is_valid (tc), NULL);
  
<span class="line-modified">!   if (tc-&gt;config.latest_daily_jam == NULL) {</span>
      gchar *tc_str = gst_video_time_code_to_string (tc);
      GST_WARNING
          (&quot;Asked to convert time code %s to GDateTime, but its latest daily jam is NULL&quot;,
          tc_str);
      g_free (tc_str);
      return NULL;
    }
  
<span class="line-modified">!   ret = g_date_time_ref (tc-&gt;config.latest_daily_jam);</span>
  
    gst_util_fraction_to_double (tc-&gt;frames * tc-&gt;config.fps_d, tc-&gt;config.fps_n,
        &amp;add_us);
    if ((tc-&gt;config.flags &amp; GST_VIDEO_TIME_CODE_FLAGS_INTERLACED)
        &amp;&amp; tc-&gt;field_count == 1) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 198,32 ***</span>
    return ret2;
  }
  
  /**
   * gst_video_time_code_init_from_date_time:
<span class="line-modified">!  * @tc: a #GstVideoTimeCode</span>
   * @fps_n: Numerator of the frame rate
   * @fps_d: Denominator of the frame rate
   * @dt: #GDateTime to convert
   * @flags: #GstVideoTimeCodeFlags
   * @field_count: Interlaced video field count
   *
<span class="line-modified">!  * The resulting config-&gt;latest_daily_jam is set to</span>
<span class="line-modified">!  * midnight, and timecode is set to the given time.</span>
   *
   * Since: 1.12
   */
<span class="line-removed">- </span>
  void
  gst_video_time_code_init_from_date_time (GstVideoTimeCode * tc,
      guint fps_n, guint fps_d,
      GDateTime * dt, GstVideoTimeCodeFlags flags, guint field_count)
  {
    GDateTime *jam;
    guint64 frames;
    gboolean add_a_frame = FALSE;
  
    jam = g_date_time_new_local (g_date_time_get_year (dt),
        g_date_time_get_month (dt), g_date_time_get_day_of_month (dt), 0, 0, 0.0);
  
    /* Note: This might be inaccurate for 1 frame
     * in case we have a drop frame timecode */
<span class="line-new-header">--- 207,66 ---</span>
    return ret2;
  }
  
  /**
   * gst_video_time_code_init_from_date_time:
<span class="line-modified">!  * @tc: an uninitialized #GstVideoTimeCode</span>
   * @fps_n: Numerator of the frame rate
   * @fps_d: Denominator of the frame rate
   * @dt: #GDateTime to convert
   * @flags: #GstVideoTimeCodeFlags
   * @field_count: Interlaced video field count
   *
<span class="line-modified">!  * The resulting config-&gt;latest_daily_jam is set to midnight, and timecode is</span>
<span class="line-modified">!  * set to the given time.</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Will assert on invalid parameters, use gst_video_time_code_init_from_date_time_full()</span>
<span class="line-added">+  * for being able to handle invalid parameters.</span>
   *
   * Since: 1.12
   */
  void
  gst_video_time_code_init_from_date_time (GstVideoTimeCode * tc,
      guint fps_n, guint fps_d,
      GDateTime * dt, GstVideoTimeCodeFlags flags, guint field_count)
<span class="line-added">+ {</span>
<span class="line-added">+   if (!gst_video_time_code_init_from_date_time_full (tc, fps_n, fps_d, dt,</span>
<span class="line-added">+           flags, field_count))</span>
<span class="line-added">+     g_return_if_fail (gst_video_time_code_is_valid (tc));</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ /**</span>
<span class="line-added">+  * gst_video_time_code_init_from_date_time_full:</span>
<span class="line-added">+  * @tc: a #GstVideoTimeCode</span>
<span class="line-added">+  * @fps_n: Numerator of the frame rate</span>
<span class="line-added">+  * @fps_d: Denominator of the frame rate</span>
<span class="line-added">+  * @dt: #GDateTime to convert</span>
<span class="line-added">+  * @flags: #GstVideoTimeCodeFlags</span>
<span class="line-added">+  * @field_count: Interlaced video field count</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * The resulting config-&gt;latest_daily_jam is set to</span>
<span class="line-added">+  * midnight, and timecode is set to the given time.</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Returns: %TRUE if @tc could be correctly initialized to a valid timecode</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Since: 1.16</span>
<span class="line-added">+  */</span>
<span class="line-added">+ gboolean</span>
<span class="line-added">+ gst_video_time_code_init_from_date_time_full (GstVideoTimeCode * tc,</span>
<span class="line-added">+     guint fps_n, guint fps_d,</span>
<span class="line-added">+     GDateTime * dt, GstVideoTimeCodeFlags flags, guint field_count)</span>
  {
    GDateTime *jam;
    guint64 frames;
    gboolean add_a_frame = FALSE;
  
<span class="line-added">+   g_return_val_if_fail (tc != NULL, FALSE);</span>
<span class="line-added">+   g_return_val_if_fail (dt != NULL, FALSE);</span>
<span class="line-added">+   g_return_val_if_fail (fps_n != 0 &amp;&amp; fps_d != 0, FALSE);</span>
<span class="line-added">+ </span>
<span class="line-added">+   gst_video_time_code_clear (tc);</span>
<span class="line-added">+ </span>
    jam = g_date_time_new_local (g_date_time_get_year (dt),
        g_date_time_get_month (dt), g_date_time_get_day_of_month (dt), 0, 0, 0.0);
  
    /* Note: This might be inaccurate for 1 frame
     * in case we have a drop frame timecode */
</pre>
<hr />
<pre>
<span class="line-old-header">*** 251,37 ***</span>
    if (add_a_frame)
      gst_video_time_code_increment_frame (tc);
  
    g_date_time_unref (jam);
  
<span class="line-modified">!   g_return_if_fail (gst_video_time_code_is_valid (tc));</span>
  }
  
  /**
   * gst_video_time_code_nsec_since_daily_jam:
   * @tc: a valid #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: how many nsec have passed since the daily jam of @tc .</span>
   *
   * Since: 1.10
   */
  guint64
  gst_video_time_code_nsec_since_daily_jam (const GstVideoTimeCode * tc)
  {
    guint64 frames, nsec;
  
    g_return_val_if_fail (gst_video_time_code_is_valid (tc), -1);
  
<span class="line-removed">-   if (tc-&gt;config.fps_n == 0 &amp;&amp; tc-&gt;config.fps_d == 1) {</span>
<span class="line-removed">-     gchar *tc_str = gst_video_time_code_to_string (tc);</span>
<span class="line-removed">-     GST_WARNING</span>
<span class="line-removed">-         (&quot;Asked to calculate nsec since daily jam of time code %s, but its framerate is unknown&quot;,</span>
<span class="line-removed">-         tc_str);</span>
<span class="line-removed">-     g_free (tc_str);</span>
<span class="line-removed">-     return -1;</span>
<span class="line-removed">-   }</span>
<span class="line-removed">- </span>
    frames = gst_video_time_code_frames_since_daily_jam (tc);
    nsec =
        gst_util_uint64_scale (frames, GST_SECOND * tc-&gt;config.fps_d,
        tc-&gt;config.fps_n);
  
<span class="line-new-header">--- 294,28 ---</span>
    if (add_a_frame)
      gst_video_time_code_increment_frame (tc);
  
    g_date_time_unref (jam);
  
<span class="line-modified">!   return gst_video_time_code_is_valid (tc);</span>
  }
  
  /**
   * gst_video_time_code_nsec_since_daily_jam:
   * @tc: a valid #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: how many nsec have passed since the daily jam of @tc.</span>
   *
   * Since: 1.10
   */
  guint64
  gst_video_time_code_nsec_since_daily_jam (const GstVideoTimeCode * tc)
  {
    guint64 frames, nsec;
  
    g_return_val_if_fail (gst_video_time_code_is_valid (tc), -1);
  
    frames = gst_video_time_code_frames_since_daily_jam (tc);
    nsec =
        gst_util_uint64_scale (frames, GST_SECOND * tc-&gt;config.fps_d,
        tc-&gt;config.fps_n);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 290,11 ***</span>
  
  /**
   * gst_video_time_code_frames_since_daily_jam:
   * @tc: a valid #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: how many frames have passed since the daily jam of @tc .</span>
   *
   * Since: 1.10
   */
  guint64
  gst_video_time_code_frames_since_daily_jam (const GstVideoTimeCode * tc)
<span class="line-new-header">--- 324,11 ---</span>
  
  /**
   * gst_video_time_code_frames_since_daily_jam:
   * @tc: a valid #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: how many frames have passed since the daily jam of @tc.</span>
   *
   * Since: 1.10
   */
  guint64
  gst_video_time_code_frames_since_daily_jam (const GstVideoTimeCode * tc)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 322,13 ***</span>
      if (tc-&gt;config.fps_n == 30000) {
        dropframe_multiplier = 2;
      } else if (tc-&gt;config.fps_n == 60000) {
        dropframe_multiplier = 4;
      } else {
<span class="line-modified">!       GST_ERROR (&quot;Unsupported drop frame rate %u/%u&quot;, tc-&gt;config.fps_n,</span>
<span class="line-modified">!           tc-&gt;config.fps_d);</span>
<span class="line-removed">-       return -1;</span>
      }
  
      return tc-&gt;frames + (ff_nom * tc-&gt;seconds) +
          (ff_minutes * tc-&gt;minutes) +
          dropframe_multiplier * ((gint) (tc-&gt;minutes / 10)) +
<span class="line-new-header">--- 356,12 ---</span>
      if (tc-&gt;config.fps_n == 30000) {
        dropframe_multiplier = 2;
      } else if (tc-&gt;config.fps_n == 60000) {
        dropframe_multiplier = 4;
      } else {
<span class="line-modified">!       /* already checked by gst_video_time_code_is_valid() */</span>
<span class="line-modified">!       g_assert_not_reached ();</span>
      }
  
      return tc-&gt;frames + (ff_nom * tc-&gt;seconds) +
          (ff_minutes * tc-&gt;minutes) +
          dropframe_multiplier * ((gint) (tc-&gt;minutes / 10)) +
</pre>
<hr />
<pre>
<span class="line-old-header">*** 342,11 ***</span>
  
  /**
   * gst_video_time_code_increment_frame:
   * @tc: a valid #GstVideoTimeCode
   *
<span class="line-modified">!  * Adds one frame to @tc .</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_increment_frame (GstVideoTimeCode * tc)
<span class="line-new-header">--- 375,11 ---</span>
  
  /**
   * gst_video_time_code_increment_frame:
   * @tc: a valid #GstVideoTimeCode
   *
<span class="line-modified">!  * Adds one frame to @tc.</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_increment_frame (GstVideoTimeCode * tc)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 358,11 ***</span>
   * gst_video_time_code_add_frames:
   * @tc: a valid #GstVideoTimeCode
   * @frames: How many frames to add or subtract
   *
   * Adds or subtracts @frames amount of frames to @tc. tc needs to
<span class="line-modified">!  * contain valid data, as verified by #gst_video_time_code_is_valid.</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_add_frames (GstVideoTimeCode * tc, gint64 frames)
<span class="line-new-header">--- 391,11 ---</span>
   * gst_video_time_code_add_frames:
   * @tc: a valid #GstVideoTimeCode
   * @frames: How many frames to add or subtract
   *
   * Adds or subtracts @frames amount of frames to @tc. tc needs to
<span class="line-modified">!  * contain valid data, as verified by gst_video_time_code_is_valid().</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_add_frames (GstVideoTimeCode * tc, gint64 frames)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 383,14 ***</span>
    gst_util_fraction_to_double (tc-&gt;config.fps_n, tc-&gt;config.fps_d, &amp;ff);
    if (tc-&gt;config.fps_d == 1001) {
      ff_nom = tc-&gt;config.fps_n / 1000;
    } else {
      ff_nom = ff;
<span class="line-removed">-     if (tc-&gt;config.fps_d != 1)</span>
<span class="line-removed">-       GST_WARNING (&quot;Unsupported frame rate %u/%u, results may be wrong&quot;,</span>
<span class="line-removed">-           tc-&gt;config.fps_n, tc-&gt;config.fps_d);</span>
    }
    if (tc-&gt;config.flags &amp; GST_VIDEO_TIME_CODE_FLAGS_DROP_FRAME) {
      /* these need to be truncated to integer: side effect, code looks cleaner
       * */
      guint ff_minutes = 60 * ff;
      guint ff_hours = 3600 * ff;
<span class="line-new-header">--- 416,12 ---</span>
    gst_util_fraction_to_double (tc-&gt;config.fps_n, tc-&gt;config.fps_d, &amp;ff);
    if (tc-&gt;config.fps_d == 1001) {
      ff_nom = tc-&gt;config.fps_n / 1000;
    } else {
      ff_nom = ff;
    }
<span class="line-added">+ </span>
    if (tc-&gt;config.flags &amp; GST_VIDEO_TIME_CODE_FLAGS_DROP_FRAME) {
      /* these need to be truncated to integer: side effect, code looks cleaner
       * */
      guint ff_minutes = 60 * ff;
      guint ff_hours = 3600 * ff;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 399,18 ***</span>
      guint64 min_new_tmp1, min_new_tmp2, min_new_tmp3, min_new_denom;
      /* for 30000/1001 we drop the first 2 frames per minute, for 60000/1001 we
       * drop the first 4 : so we use this number */
      guint dropframe_multiplier;
  
<span class="line-modified">!     if (tc-&gt;config.fps_n == 30000)</span>
        dropframe_multiplier = 2;
<span class="line-modified">!     else if (tc-&gt;config.fps_n == 60000)</span>
        dropframe_multiplier = 4;
<span class="line-modified">!     else {</span>
<span class="line-modified">!       GST_ERROR (&quot;Unsupported drop frame rate %u/%u&quot;, tc-&gt;config.fps_n,</span>
<span class="line-modified">!           tc-&gt;config.fps_d);</span>
<span class="line-removed">-       return;</span>
      }
  
      framecount =
          frames + tc-&gt;frames + (ff_nom * tc-&gt;seconds) +
          (ff_minutes * tc-&gt;minutes) +
<span class="line-new-header">--- 430,17 ---</span>
      guint64 min_new_tmp1, min_new_tmp2, min_new_tmp3, min_new_denom;
      /* for 30000/1001 we drop the first 2 frames per minute, for 60000/1001 we
       * drop the first 4 : so we use this number */
      guint dropframe_multiplier;
  
<span class="line-modified">!     if (tc-&gt;config.fps_n == 30000) {</span>
        dropframe_multiplier = 2;
<span class="line-modified">!     } else if (tc-&gt;config.fps_n == 60000) {</span>
        dropframe_multiplier = 4;
<span class="line-modified">!     } else {</span>
<span class="line-modified">!       /* already checked by gst_video_time_code_is_valid() */</span>
<span class="line-modified">!       g_assert_not_reached ();</span>
      }
  
      framecount =
          frames + tc-&gt;frames + (ff_nom * tc-&gt;seconds) +
          (ff_minutes * tc-&gt;minutes) +
</pre>
<hr />
<pre>
<span class="line-old-header">*** 454,27 ***</span>
          framecount - (ff_nom * (sec_new + sixty * (min_new +
                  (sixty * h_notmod24))));
      if (frames_new &gt; ff_nom)
        frames_new = 0;
    }
    h_new = h_notmod24 % 24;
  
    g_assert (min_new &lt; 60);
    g_assert (sec_new &lt; 60);
    g_assert (frames_new &lt; ff_nom);
    tc-&gt;hours = h_new;
    tc-&gt;minutes = min_new;
    tc-&gt;seconds = sec_new;
    tc-&gt;frames = frames_new;
  }
  
  /**
   * gst_video_time_code_compare:
<span class="line-modified">!  * @tc1: a #GstVideoTimeCode</span>
<span class="line-modified">!  * @tc2: another #GstVideoTimeCode</span>
   *
<span class="line-modified">!  * Compares @tc1 and @tc2 . If both have latest daily jam information, it is</span>
   * taken into account. Otherwise, it is assumed that the daily jam of both
   * @tc1 and @tc2 was at the same time. Both time codes must be valid.
   *
   * Returns: 1 if @tc1 is after @tc2, -1 if @tc1 is before @tc2, 0 otherwise.
   *
<span class="line-new-header">--- 484,30 ---</span>
          framecount - (ff_nom * (sec_new + sixty * (min_new +
                  (sixty * h_notmod24))));
      if (frames_new &gt; ff_nom)
        frames_new = 0;
    }
<span class="line-added">+ </span>
    h_new = h_notmod24 % 24;
  
<span class="line-added">+   /* The calculations above should always give correct results */</span>
    g_assert (min_new &lt; 60);
    g_assert (sec_new &lt; 60);
    g_assert (frames_new &lt; ff_nom);
<span class="line-added">+ </span>
    tc-&gt;hours = h_new;
    tc-&gt;minutes = min_new;
    tc-&gt;seconds = sec_new;
    tc-&gt;frames = frames_new;
  }
  
  /**
   * gst_video_time_code_compare:
<span class="line-modified">!  * @tc1: a valid #GstVideoTimeCode</span>
<span class="line-modified">!  * @tc2: another valid #GstVideoTimeCode</span>
   *
<span class="line-modified">!  * Compares @tc1 and @tc2. If both have latest daily jam information, it is</span>
   * taken into account. Otherwise, it is assumed that the daily jam of both
   * @tc1 and @tc2 was at the same time. Both time codes must be valid.
   *
   * Returns: 1 if @tc1 is after @tc2, -1 if @tc1 is before @tc2, 0 otherwise.
   *
</pre>
<hr />
<pre>
<span class="line-old-header">*** 567,11 ***</span>
   * @field_count is 0 for progressive, 1 or 2 for interlaced.
   * @latest_daiy_jam reference is stolen from caller.
   *
   * Returns: a new #GstVideoTimeCode with the given values.
   * The values are not checked for being in a valid range. To see if your
<span class="line-modified">!  * timecode actually has valid content, use #gst_video_time_code_is_valid.</span>
   *
   * Since: 1.10
   */
  GstVideoTimeCode *
  gst_video_time_code_new (guint fps_n, guint fps_d, GDateTime * latest_daily_jam,
<span class="line-new-header">--- 600,11 ---</span>
   * @field_count is 0 for progressive, 1 or 2 for interlaced.
   * @latest_daiy_jam reference is stolen from caller.
   *
   * Returns: a new #GstVideoTimeCode with the given values.
   * The values are not checked for being in a valid range. To see if your
<span class="line-modified">!  * timecode actually has valid content, use gst_video_time_code_is_valid().</span>
   *
   * Since: 1.10
   */
  GstVideoTimeCode *
  gst_video_time_code_new (guint fps_n, guint fps_d, GDateTime * latest_daily_jam,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 587,11 ***</span>
  }
  
  /**
   * gst_video_time_code_new_empty:
   *
<span class="line-modified">!  * Returns: a new empty #GstVideoTimeCode</span>
   *
   * Since: 1.10
   */
  GstVideoTimeCode *
  gst_video_time_code_new_empty (void)
<span class="line-new-header">--- 620,11 ---</span>
  }
  
  /**
   * gst_video_time_code_new_empty:
   *
<span class="line-modified">!  * Returns: a new empty, invalid #GstVideoTimeCode</span>
   *
   * Since: 1.10
   */
  GstVideoTimeCode *
  gst_video_time_code_new_empty (void)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 633,22 ***</span>
  static gboolean
  gst_video_time_code_deserialize (GValue * dest, const gchar * tc_str)
  {
    GstVideoTimeCode *tc = gst_video_time_code_new_from_string (tc_str);
  
<span class="line-modified">!   if (tc == NULL || !gst_video_time_code_is_valid (tc))</span>
      return FALSE;
  
    g_value_take_boxed (dest, tc);
    return TRUE;
  }
  
  /**
   * gst_video_time_code_new_from_string:
   * @tc_str: The string that represents the #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: a new #GstVideoTimeCode from the given string</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCode *
  gst_video_time_code_new_from_string (const gchar * tc_str)
<span class="line-new-header">--- 666,24 ---</span>
  static gboolean
  gst_video_time_code_deserialize (GValue * dest, const gchar * tc_str)
  {
    GstVideoTimeCode *tc = gst_video_time_code_new_from_string (tc_str);
  
<span class="line-modified">!   if (tc == NULL) {</span>
      return FALSE;
<span class="line-added">+   }</span>
  
    g_value_take_boxed (dest, tc);
    return TRUE;
  }
  
  /**
   * gst_video_time_code_new_from_string:
   * @tc_str: The string that represents the #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: (nullable): a new #GstVideoTimeCode from the given string or %NULL</span>
<span class="line-added">+  *   if the string could not be passed.</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCode *
  gst_video_time_code_new_from_string (const gchar * tc_str)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 657,22 ***</span>
    guint hours, minutes, seconds, frames;
  
    if (sscanf (tc_str, &quot;%02u:%02u:%02u:%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,
            &amp;frames)
        == 4
<span class="line-removed">-       || sscanf (tc_str, &quot;%02u:%02u:%02u;%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,</span>
<span class="line-removed">-           &amp;frames)</span>
<span class="line-removed">-       == 4</span>
        || sscanf (tc_str, &quot;%02u:%02u:%02u.%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,
            &amp;frames)
<span class="line-removed">-       == 4</span>
<span class="line-removed">-       || sscanf (tc_str, &quot;%02u:%02u:%02u,%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,</span>
<span class="line-removed">-           &amp;frames)</span>
        == 4) {
      tc = gst_video_time_code_new (0, 1, NULL, GST_VIDEO_TIME_CODE_FLAGS_NONE,
          hours, minutes, seconds, frames, 0);
  
      return tc;
    } else {
      GST_ERROR (&quot;Warning: Could not parse timecode %s. &quot;
          &quot;Please input a timecode in the form 00:00:00:00&quot;, tc_str);
      return NULL;
<span class="line-new-header">--- 692,26 ---</span>
    guint hours, minutes, seconds, frames;
  
    if (sscanf (tc_str, &quot;%02u:%02u:%02u:%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,
            &amp;frames)
        == 4
        || sscanf (tc_str, &quot;%02u:%02u:%02u.%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,
            &amp;frames)
        == 4) {
      tc = gst_video_time_code_new (0, 1, NULL, GST_VIDEO_TIME_CODE_FLAGS_NONE,
          hours, minutes, seconds, frames, 0);
  
<span class="line-added">+     return tc;</span>
<span class="line-added">+   } else if (sscanf (tc_str, &quot;%02u:%02u:%02u;%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,</span>
<span class="line-added">+           &amp;frames)</span>
<span class="line-added">+       == 4 || sscanf (tc_str, &quot;%02u:%02u:%02u,%02u&quot;, &amp;hours, &amp;minutes, &amp;seconds,</span>
<span class="line-added">+           &amp;frames)</span>
<span class="line-added">+       == 4) {</span>
<span class="line-added">+     tc = gst_video_time_code_new (0, 1, NULL,</span>
<span class="line-added">+         GST_VIDEO_TIME_CODE_FLAGS_DROP_FRAME, hours, minutes, seconds, frames,</span>
<span class="line-added">+         0);</span>
<span class="line-added">+ </span>
      return tc;
    } else {
      GST_ERROR (&quot;Warning: Could not parse timecode %s. &quot;
          &quot;Please input a timecode in the form 00:00:00:00&quot;, tc_str);
      return NULL;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 688,25 ***</span>
   * @field_count: Interlaced video field count
   *
   * The resulting config-&gt;latest_daily_jam is set to
   * midnight, and timecode is set to the given time.
   *
<span class="line-modified">!  * Returns: the #GVideoTimeCode representation of @dt.</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCode *
  gst_video_time_code_new_from_date_time (guint fps_n, guint fps_d,
      GDateTime * dt, GstVideoTimeCodeFlags flags, guint field_count)
  {
    GstVideoTimeCode *tc;
    tc = gst_video_time_code_new_empty ();
<span class="line-modified">!   gst_video_time_code_init_from_date_time (tc, fps_n, fps_d, dt, flags,</span>
        field_count);
    return tc;
  }
  
  /**
   * gst_video_time_code_init:
   * @tc: a #GstVideoTimeCode
   * @fps_n: Numerator of the frame rate
   * @fps_d: Denominator of the frame rate
<span class="line-new-header">--- 727,59 ---</span>
   * @field_count: Interlaced video field count
   *
   * The resulting config-&gt;latest_daily_jam is set to
   * midnight, and timecode is set to the given time.
   *
<span class="line-modified">!  * This might return a completely invalid timecode, use</span>
<span class="line-added">+  * gst_video_time_code_new_from_date_time_full() to ensure</span>
<span class="line-added">+  * that you would get %NULL instead in that case.</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Returns: the #GstVideoTimeCode representation of @dt.</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCode *
  gst_video_time_code_new_from_date_time (guint fps_n, guint fps_d,
      GDateTime * dt, GstVideoTimeCodeFlags flags, guint field_count)
  {
    GstVideoTimeCode *tc;
    tc = gst_video_time_code_new_empty ();
<span class="line-modified">!   gst_video_time_code_init_from_date_time_full (tc, fps_n, fps_d, dt, flags,</span>
        field_count);
    return tc;
  }
  
<span class="line-added">+ /**</span>
<span class="line-added">+  * gst_video_time_code_new_from_date_time_full:</span>
<span class="line-added">+  * @fps_n: Numerator of the frame rate</span>
<span class="line-added">+  * @fps_d: Denominator of the frame rate</span>
<span class="line-added">+  * @dt: #GDateTime to convert</span>
<span class="line-added">+  * @flags: #GstVideoTimeCodeFlags</span>
<span class="line-added">+  * @field_count: Interlaced video field count</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * The resulting config-&gt;latest_daily_jam is set to</span>
<span class="line-added">+  * midnight, and timecode is set to the given time.</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Returns: the #GstVideoTimeCode representation of @dt, or %NULL if</span>
<span class="line-added">+  *   no valid timecode could be created.</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Since: 1.16</span>
<span class="line-added">+  */</span>
<span class="line-added">+ GstVideoTimeCode *</span>
<span class="line-added">+ gst_video_time_code_new_from_date_time_full (guint fps_n, guint fps_d,</span>
<span class="line-added">+     GDateTime * dt, GstVideoTimeCodeFlags flags, guint field_count)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   GstVideoTimeCode *tc;</span>
<span class="line-added">+   tc = gst_video_time_code_new_empty ();</span>
<span class="line-added">+   if (!gst_video_time_code_init_from_date_time_full (tc, fps_n, fps_d, dt,</span>
<span class="line-added">+           flags, field_count)) {</span>
<span class="line-added">+     gst_video_time_code_free (tc);</span>
<span class="line-added">+     return NULL;</span>
<span class="line-added">+   }</span>
<span class="line-added">+   return tc;</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  /**
   * gst_video_time_code_init:
   * @tc: a #GstVideoTimeCode
   * @fps_n: Numerator of the frame rate
   * @fps_d: Denominator of the frame rate
</pre>
<hr />
<pre>
<span class="line-old-header">*** 721,11 ***</span>
   * @field_count is 0 for progressive, 1 or 2 for interlaced.
   * @latest_daiy_jam reference is stolen from caller.
   *
   * Initializes @tc with the given values.
   * The values are not checked for being in a valid range. To see if your
<span class="line-modified">!  * timecode actually has valid content, use #gst_video_time_code_is_valid.</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_init (GstVideoTimeCode * tc, guint fps_n, guint fps_d,
<span class="line-new-header">--- 794,11 ---</span>
   * @field_count is 0 for progressive, 1 or 2 for interlaced.
   * @latest_daiy_jam reference is stolen from caller.
   *
   * Initializes @tc with the given values.
   * The values are not checked for being in a valid range. To see if your
<span class="line-modified">!  * timecode actually has valid content, use gst_video_time_code_is_valid().</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_init (GstVideoTimeCode * tc, guint fps_n, guint fps_d,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 748,11 ***</span>
  
  /**
   * gst_video_time_code_clear:
   * @tc: a #GstVideoTimeCode
   *
<span class="line-modified">!  * Initializes @tc with empty/zero/NULL values.</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_clear (GstVideoTimeCode * tc)
<span class="line-new-header">--- 821,12 ---</span>
  
  /**
   * gst_video_time_code_clear:
   * @tc: a #GstVideoTimeCode
   *
<span class="line-modified">!  * Initializes @tc with empty/zero/NULL values and frees any memory</span>
<span class="line-added">+  * it might currently use.</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_clear (GstVideoTimeCode * tc)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 772,11 ***</span>
  
  /**
   * gst_video_time_code_copy:
   * @tc: a #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: a new #GstVideoTimeCode with the same values as @tc .</span>
   *
   * Since: 1.10
   */
  GstVideoTimeCode *
  gst_video_time_code_copy (const GstVideoTimeCode * tc)
<span class="line-new-header">--- 846,11 ---</span>
  
  /**
   * gst_video_time_code_copy:
   * @tc: a #GstVideoTimeCode
   *
<span class="line-modified">!  * Returns: a new #GstVideoTimeCode with the same values as @tc.</span>
   *
   * Since: 1.10
   */
  GstVideoTimeCode *
  gst_video_time_code_copy (const GstVideoTimeCode * tc)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 788,11 ***</span>
  
  /**
   * gst_video_time_code_free:
   * @tc: a #GstVideoTimeCode
   *
<span class="line-modified">!  * Frees @tc .</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_free (GstVideoTimeCode * tc)
<span class="line-new-header">--- 862,11 ---</span>
  
  /**
   * gst_video_time_code_free:
   * @tc: a #GstVideoTimeCode
   *
<span class="line-modified">!  * Frees @tc.</span>
   *
   * Since: 1.10
   */
  void
  gst_video_time_code_free (GstVideoTimeCode * tc)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 818,11 ***</span>
   * adding (&quot;00:00:00;00&quot;, &quot;00:01:00:00&quot;) will return &quot;00:01:00;02&quot;
   * because of drop-frame oddities. However,
   * adding (&quot;00:09:00;02&quot;, &quot;00:01:00:00&quot;) will return &quot;00:10:00;00&quot;
   * because this time we can have an exact minute.
   *
<span class="line-modified">!  * Returns: A new #GstVideoTimeCode with @tc_inter added.</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCode *
  gst_video_time_code_add_interval (const GstVideoTimeCode * tc,
<span class="line-new-header">--- 892,12 ---</span>
   * adding (&quot;00:00:00;00&quot;, &quot;00:01:00:00&quot;) will return &quot;00:01:00;02&quot;
   * because of drop-frame oddities. However,
   * adding (&quot;00:09:00;02&quot;, &quot;00:01:00:00&quot;) will return &quot;00:10:00;00&quot;
   * because this time we can have an exact minute.
   *
<span class="line-modified">!  * Returns: (nullable): A new #GstVideoTimeCode with @tc_inter added or %NULL</span>
<span class="line-added">+  *   if the interval can&#39;t be added.</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCode *
  gst_video_time_code_add_interval (const GstVideoTimeCode * tc,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 908,11 ***</span>
   * gst_video_time_code_interval_new_from_string:
   * @tc_inter_str: The string that represents the #GstVideoTimeCodeInterval
   *
   * @tc_inter_str must only have &quot;:&quot; as separators.
   *
<span class="line-modified">!  * Returns: a new #GstVideoTimeCodeInterval from the given string</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCodeInterval *
  gst_video_time_code_interval_new_from_string (const gchar * tc_inter_str)
<span class="line-new-header">--- 983,12 ---</span>
   * gst_video_time_code_interval_new_from_string:
   * @tc_inter_str: The string that represents the #GstVideoTimeCodeInterval
   *
   * @tc_inter_str must only have &quot;:&quot; as separators.
   *
<span class="line-modified">!  * Returns: (nullable): a new #GstVideoTimeCodeInterval from the given string</span>
<span class="line-added">+  *   or %NULL if the string could not be passed.</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCodeInterval *
  gst_video_time_code_interval_new_from_string (const gchar * tc_inter_str)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 984,11 ***</span>
  
  /**
   * gst_video_time_code_interval_copy:
   * @tc: a #GstVideoTimeCodeInterval
   *
<span class="line-modified">!  * Returns: a new #GstVideoTimeCodeInterval with the same values as @tc .</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCodeInterval *
  gst_video_time_code_interval_copy (const GstVideoTimeCodeInterval * tc)
<span class="line-new-header">--- 1060,11 ---</span>
  
  /**
   * gst_video_time_code_interval_copy:
   * @tc: a #GstVideoTimeCodeInterval
   *
<span class="line-modified">!  * Returns: a new #GstVideoTimeCodeInterval with the same values as @tc.</span>
   *
   * Since: 1.12
   */
  GstVideoTimeCodeInterval *
  gst_video_time_code_interval_copy (const GstVideoTimeCodeInterval * tc)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 999,11 ***</span>
  
  /**
   * gst_video_time_code_interval_free:
   * @tc: a #GstVideoTimeCodeInterval
   *
<span class="line-modified">!  * Frees @tc .</span>
   *
   * Since: 1.12
   */
  void
  gst_video_time_code_interval_free (GstVideoTimeCodeInterval * tc)
<span class="line-new-header">--- 1075,11 ---</span>
  
  /**
   * gst_video_time_code_interval_free:
   * @tc: a #GstVideoTimeCodeInterval
   *
<span class="line-modified">!  * Frees @tc.</span>
   *
   * Since: 1.12
   */
  void
  gst_video_time_code_interval_free (GstVideoTimeCodeInterval * tc)
</pre>
<center><a href="gstvideosink.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="gstvideotimecode.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>