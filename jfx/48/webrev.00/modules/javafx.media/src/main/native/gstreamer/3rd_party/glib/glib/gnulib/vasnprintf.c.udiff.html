<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gnulib/vasnprintf.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="printf.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="vasnprintf.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gnulib/vasnprintf.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /* vsprintf with automatic memory allocation.
<span class="udiff-line-modified-removed">-    Copyright (C) 1999, 2002-2016 Free Software Foundation, Inc.</span>
<span class="udiff-line-modified-added">+    Copyright (C) 1999, 2002-2019 Free Software Foundation, Inc.</span>
  
     This program is free software; you can redistribute it and/or modify
     it under the terms of the GNU Lesser General Public License as published by
     the Free Software Foundation; either version 2.1, or (at your option)
     any later version.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -10,11 +10,11 @@</span>
     but WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     GNU Lesser General Public License for more details.
  
     You should have received a copy of the GNU Lesser General Public License along
<span class="udiff-line-modified-removed">-    with this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<span class="udiff-line-modified-added">+    with this program; if not, see &lt;https://www.gnu.org/licenses/&gt;.  */</span>
  
  /* This file can be parametrized with the following macros:
       VASNPRINTF         The name of the function being defined.
       FCHAR_T            The element type of the format string.
       DCHAR_T            The element type of the destination (result) string.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -53,61 +53,83 @@</span>
  #endif
  
  #ifndef VASNPRINTF
  # include &lt;config.h&gt;
  #endif
<span class="udiff-line-removed">- /* galloca.h also defines alloca and HAVE_ALLOCA makes the code below use it */</span>
  #include &quot;glib/galloca.h&quot;
<span class="udiff-line-removed">- #define HAVE_ALLOCA 1</span>
  
  #include &quot;g-gnulib.h&quot;
  
  /* Specification.  */
<span class="udiff-line-modified-removed">- #include &quot;vasnprintf.h&quot;</span>
<span class="udiff-line-modified-added">+ #ifndef VASNPRINTF</span>
<span class="udiff-line-added">+ # if WIDE_CHAR_VERSION</span>
<span class="udiff-line-added">+ #  include &quot;vasnwprintf.h&quot;</span>
<span class="udiff-line-added">+ # else</span>
<span class="udiff-line-added">+ #  include &quot;vasnprintf.h&quot;</span>
<span class="udiff-line-added">+ # endif</span>
<span class="udiff-line-added">+ #endif</span>
  
  #include &lt;locale.h&gt;     /* localeconv() */
  #include &lt;stdio.h&gt;      /* snprintf(), sprintf() */
  #include &lt;stdlib.h&gt;     /* abort(), malloc(), realloc(), free() */
  #include &lt;string.h&gt;     /* memcpy(), strlen() */
  #include &lt;errno.h&gt;      /* errno */
  #include &lt;limits.h&gt;     /* CHAR_BIT */
  #include &lt;float.h&gt;      /* DBL_MAX_EXP, LDBL_MAX_EXP */
<span class="udiff-line-added">+ #if HAVE_NL_LANGINFO</span>
<span class="udiff-line-added">+ # include &lt;langinfo.h&gt;</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ #ifndef VASNPRINTF</span>
<span class="udiff-line-added">+ # if WIDE_CHAR_VERSION</span>
<span class="udiff-line-added">+ #  include &quot;wprintf-parse.h&quot;</span>
<span class="udiff-line-added">+ # else</span>
  #  include &quot;printf-parse.h&quot;
<span class="udiff-line-added">+ # endif</span>
<span class="udiff-line-added">+ #endif</span>
  
<span class="udiff-line-added">+ /* Checked size_t computations.  */</span>
  #include &quot;xsize.h&quot;
  
  #include &quot;verify.h&quot;
  
  #if (NEED_PRINTF_DOUBLE || NEED_PRINTF_LONG_DOUBLE) &amp;&amp; !defined IN_LIBINTL
<span class="udiff-line-modified-removed">- # include &lt;math.h&gt;</span>
<span class="udiff-line-modified-added">+ # include &lt;gnulib_math.h&gt;</span>
  # include &quot;float+.h&quot;
  #endif
  
  #if (NEED_PRINTF_DOUBLE || NEED_PRINTF_INFINITE_DOUBLE) &amp;&amp; !defined IN_LIBINTL
<span class="udiff-line-modified-removed">- # include &lt;math.h&gt;</span>
<span class="udiff-line-modified-added">+ # include &lt;gnulib_math.h&gt;</span>
  # include &quot;isnand-nolibm.h&quot;
  #endif
  
  #if (NEED_PRINTF_LONG_DOUBLE || NEED_PRINTF_INFINITE_LONG_DOUBLE) &amp;&amp; !defined IN_LIBINTL
<span class="udiff-line-modified-removed">- # include &lt;math.h&gt;</span>
<span class="udiff-line-modified-added">+ # include &lt;gnulib_math.h&gt;</span>
  # include &quot;isnanl-nolibm.h&quot;
  # include &quot;fpucw.h&quot;
  #endif
  
  #if (NEED_PRINTF_DIRECTIVE_A || NEED_PRINTF_DOUBLE) &amp;&amp; !defined IN_LIBINTL
<span class="udiff-line-modified-removed">- # include &lt;math.h&gt;</span>
<span class="udiff-line-modified-added">+ # include &lt;gnulib_math.h&gt;</span>
  # include &quot;isnand-nolibm.h&quot;
  # include &quot;printf-frexp.h&quot;
  #endif
  
  #if (NEED_PRINTF_DIRECTIVE_A || NEED_PRINTF_LONG_DOUBLE) &amp;&amp; !defined IN_LIBINTL
<span class="udiff-line-modified-removed">- # include &lt;math.h&gt;</span>
<span class="udiff-line-modified-added">+ # include &lt;gnulib_math.h&gt;</span>
  # include &quot;isnanl-nolibm.h&quot;
  # include &quot;printf-frexpl.h&quot;
  # include &quot;fpucw.h&quot;
  #endif
  
<span class="udiff-line-added">+ #ifndef FALLTHROUGH</span>
<span class="udiff-line-added">+ # if __GNUC__ &lt; 7</span>
<span class="udiff-line-added">+ #  define FALLTHROUGH ((void) 0)</span>
<span class="udiff-line-added">+ # else</span>
<span class="udiff-line-added">+ #  define FALLTHROUGH __attribute__ ((__fallthrough__))</span>
<span class="udiff-line-added">+ # endif</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  /* Default parameters.  */
  #ifndef VASNPRINTF
  # if WIDE_CHAR_VERSION
  #  define VASNPRINTF vasnwprintf
  #  define FCHAR_T wchar_t
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -142,10 +164,11 @@</span>
        MSVCRT function _snwprintf(), so prefer that.  */
  #  if defined __MINGW32__
  #   define SNPRINTF snwprintf
  #  else
  #   define SNPRINTF _snwprintf
<span class="udiff-line-added">+ #   define USE_MSVC__SNPRINTF 1</span>
  #  endif
  # else
     /* Unix.  */
  #  define SNPRINTF swprintf
  # endif
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -167,11 +190,13 @@</span>
  #  if defined __MINGW32__
  #   define SNPRINTF snprintf
      /* Here we need to call the native snprintf, not rpl_snprintf.  */
  #   undef snprintf
  #  else
<span class="udiff-line-added">+     /* MSVC versions &lt; 14 did not have snprintf, only _snprintf.  */</span>
  #   define SNPRINTF _snprintf
<span class="udiff-line-added">+ #   define USE_MSVC__SNPRINTF 1</span>
  #  endif
  # else
     /* Unix.  */
  #  define SNPRINTF snprintf
     /* Here we need to call the native snprintf, not rpl_snprintf.  */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -181,11 +206,11 @@</span>
  /* Here we need to call the native sprintf, not rpl_sprintf.  */
  #undef sprintf
  
  /* GCC &gt;= 4.0 with -Wall emits unjustified &quot;... may be used uninitialized&quot;
     warnings in this file.  Use -Dlint to suppress them.  */
<span class="udiff-line-modified-removed">- #ifdef lint</span>
<span class="udiff-line-modified-added">+ #if defined GCC_LINT || defined lint</span>
  # define IF_LINT(Code) Code
  #else
  # define IF_LINT(Code) /* empty */
  #endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -194,11 +219,11 @@</span>
  #undef exp
  #define exp expo
  #undef remainder
  #define remainder rem
  
<span class="udiff-line-modified-removed">- #if (!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99) &amp;&amp; !WIDE_CHAR_VERSION</span>
<span class="udiff-line-modified-added">+ #if (!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF) &amp;&amp; !WIDE_CHAR_VERSION</span>
  # if (HAVE_STRNLEN &amp;&amp; !defined _AIX)
  #  define local_strnlen strnlen
  # else
  #  ifndef local_strnlen_defined
  #   define local_strnlen_defined 1
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -210,11 +235,11 @@</span>
  }
  #  endif
  # endif
  #endif
  
<span class="udiff-line-modified-removed">- #if (((!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99) &amp;&amp; WIDE_CHAR_VERSION) || ((!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || (NEED_PRINTF_DIRECTIVE_LS &amp;&amp; !defined IN_LIBINTL)) &amp;&amp; !WIDE_CHAR_VERSION &amp;&amp; DCHAR_IS_TCHAR)) &amp;&amp; HAVE_WCHAR_T</span>
<span class="udiff-line-modified-added">+ #if (((!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF) &amp;&amp; WIDE_CHAR_VERSION) || ((!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF || (NEED_PRINTF_DIRECTIVE_LS &amp;&amp; !defined IN_LIBINTL)) &amp;&amp; !WIDE_CHAR_VERSION &amp;&amp; DCHAR_IS_TCHAR)) &amp;&amp; HAVE_WCHAR_T</span>
  # if HAVE_WCSLEN
  #  define local_wcslen wcslen
  # else
     /* Solaris 2.5.1 has wcslen() in a separate library libw.so. To avoid
        a dependency towards this library, here is a local substitute.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -233,11 +258,11 @@</span>
  }
  #  endif
  # endif
  #endif
  
<span class="udiff-line-modified-removed">- #if (!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99) &amp;&amp; HAVE_WCHAR_T &amp;&amp; WIDE_CHAR_VERSION</span>
<span class="udiff-line-modified-added">+ #if (!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF) &amp;&amp; HAVE_WCHAR_T &amp;&amp; WIDE_CHAR_VERSION</span>
  # if HAVE_WCSNLEN
  #  define local_wcsnlen wcsnlen
  # else
  #  ifndef local_wcsnlen_defined
  #   define local_wcsnlen_defined 1
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -835,11 +860,13 @@</span>
  {
    mp_limb_t *a_ptr = a.limbs;
    size_t a_len = a.nlimbs;
    /* 0.03345 is slightly larger than log(2)/(9*log(10)).  */
    size_t c_len = 9 * ((size_t)(a_len * (GMP_LIMB_BITS * 0.03345f)) + 1);
<span class="udiff-line-modified-removed">-   char *c_ptr = (char *) malloc (xsum (c_len, extra_zeroes));</span>
<span class="udiff-line-modified-added">+   /* We need extra_zeroes bytes for zeroes, followed by c_len bytes for the</span>
<span class="udiff-line-added">+      digits of a, followed by 1 byte for the terminating NUL.  */</span>
<span class="udiff-line-added">+   char *c_ptr = (char *) malloc (xsum (xsum (extra_zeroes, c_len), 1));</span>
    if (c_ptr != NULL)
      {
        char *d_ptr = c_ptr;
        for (; extra_zeroes &gt; 0; extra_zeroes--)
          *d_ptr++ = &#39;0&#39;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1503,11 +1530,11 @@</span>
    return *digits == &#39;\0&#39;;
  }
  
  #endif
  
<span class="udiff-line-modified-removed">- #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99</span>
<span class="udiff-line-modified-added">+ #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF</span>
  
  /* Use a different function name, to make it possible that the &#39;wchar_t&#39;
     parametrization and the &#39;char&#39; parametrization get compiled in the same
     translation unit.  */
  # if WIDE_CHAR_VERSION
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2378,11 +2405,11 @@</span>
                    default:
                      abort ();
                    }
                }
  #endif
<span class="udiff-line-modified-removed">- #if (!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || (NEED_PRINTF_DIRECTIVE_LS &amp;&amp; !defined IN_LIBINTL)) &amp;&amp; HAVE_WCHAR_T</span>
<span class="udiff-line-modified-added">+ #if (!USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF || (NEED_PRINTF_DIRECTIVE_LS &amp;&amp; !defined IN_LIBINTL)) &amp;&amp; HAVE_WCHAR_T</span>
              else if (dp-&gt;conversion == &#39;s&#39;
  # if WIDE_CHAR_VERSION
                       &amp;&amp; a.arg[dp-&gt;arg_index].type != TYPE_WIDE_STRING
  # else
                       &amp;&amp; a.arg[dp-&gt;arg_index].type == TYPE_WIDE_STRING
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2669,11 +2696,11 @@</span>
                                  free (buf_malloced);
                                CLEANUP ();
                                errno = EILSEQ;
                                return NULL;
                              }
<span class="udiff-line-modified-removed">-                           if (precision &lt; count)</span>
<span class="udiff-line-modified-added">+                           if (precision &lt; (unsigned int) count)</span>
                              break;
                            arg_end++;
                            characters += count;
                            precision -= count;
                          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4218,11 +4245,11 @@</span>
  #   if WIDE_CHAR_VERSION
                                  {
                                    static const wchar_t decimal_format[] =
                                      /* Produce the same number of exponent digits
                                         as the native printf implementation.  */
<span class="udiff-line-modified-removed">- #    if (defined _WIN32 || defined __WIN32__) &amp;&amp; ! defined __CYGWIN__</span>
<span class="udiff-line-modified-added">+ #    if (defined _WIN32 &amp;&amp; FALSE) &amp;&amp; ! defined __CYGWIN__</span>
                                      { &#39;%&#39;, &#39;+&#39;, &#39;.&#39;, &#39;3&#39;, &#39;d&#39;, &#39;\0&#39; };
  #    else
                                      { &#39;%&#39;, &#39;+&#39;, &#39;.&#39;, &#39;2&#39;, &#39;d&#39;, &#39;\0&#39; };
  #    endif
                                    SNPRINTF (p, 6 + 1, decimal_format, exponent);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4232,11 +4259,11 @@</span>
  #   else
                                  {
                                    static const char decimal_format[] =
                                      /* Produce the same number of exponent digits
                                         as the native printf implementation.  */
<span class="udiff-line-modified-removed">- #    if (defined _WIN32 || defined __WIN32__) &amp;&amp; ! defined __CYGWIN__</span>
<span class="udiff-line-modified-added">+ #    if (defined _WIN32 &amp;&amp; FALSE) &amp;&amp; ! defined __CYGWIN__</span>
                                      &quot;%+.3d&quot;;
  #    else
                                      &quot;%+.2d&quot;;
  #    endif
                                    if (sizeof (DCHAR_T) == 1)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4411,11 +4438,11 @@</span>
  #   if WIDE_CHAR_VERSION
                                          {
                                            static const wchar_t decimal_format[] =
                                              /* Produce the same number of exponent digits
                                                 as the native printf implementation.  */
<span class="udiff-line-modified-removed">- #    if (defined _WIN32 || defined __WIN32__) &amp;&amp; ! defined __CYGWIN__</span>
<span class="udiff-line-modified-added">+ #    if (defined _WIN32 &amp;&amp; FALSE) &amp;&amp; ! defined __CYGWIN__</span>
                                              { &#39;%&#39;, &#39;+&#39;, &#39;.&#39;, &#39;3&#39;, &#39;d&#39;, &#39;\0&#39; };
  #    else
                                              { &#39;%&#39;, &#39;+&#39;, &#39;.&#39;, &#39;2&#39;, &#39;d&#39;, &#39;\0&#39; };
  #    endif
                                            SNPRINTF (p, 6 + 1, decimal_format, exponent);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4425,11 +4452,11 @@</span>
  #   else
                                          {
                                            static const char decimal_format[] =
                                              /* Produce the same number of exponent digits
                                                 as the native printf implementation.  */
<span class="udiff-line-modified-removed">- #    if (defined _WIN32 || defined __WIN32__) &amp;&amp; ! defined __CYGWIN__</span>
<span class="udiff-line-modified-added">+ #    if (defined _WIN32 &amp;&amp; FALSE) &amp;&amp; ! defined __CYGWIN__</span>
                                              &quot;%+.3d&quot;;
  #    else
                                              &quot;%+.2d&quot;;
  #    endif
                                            if (sizeof (DCHAR_T) == 1)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4483,11 +4510,11 @@</span>
                                    }
                                  *p++ = dp-&gt;conversion; /* &#39;e&#39; or &#39;E&#39; */
                                  *p++ = &#39;+&#39;;
                                  /* Produce the same number of exponent digits as
                                     the native printf implementation.  */
<span class="udiff-line-modified-removed">- #   if (defined _WIN32 || defined __WIN32__) &amp;&amp; ! defined __CYGWIN__</span>
<span class="udiff-line-modified-added">+ #   if (defined _WIN32 &amp;&amp; FALSE) &amp;&amp; ! defined __CYGWIN__</span>
                                  *p++ = &#39;0&#39;;
  #   endif
                                  *p++ = &#39;0&#39;;
                                  *p++ = &#39;0&#39;;
                                }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4577,14 +4604,14 @@</span>
                  arg_type type = a.arg[dp-&gt;arg_index].type;
                  int flags = dp-&gt;flags;
  #if !DCHAR_IS_TCHAR || ENABLE_UNISTDIO || NEED_PRINTF_FLAG_LEFTADJUST || NEED_PRINTF_FLAG_ZERO || NEED_PRINTF_UNBOUNDED_PRECISION
                  int has_width;
  #endif
<span class="udiff-line-modified-removed">- #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || !DCHAR_IS_TCHAR || ENABLE_UNISTDIO || NEED_PRINTF_FLAG_LEFTADJUST || NEED_PRINTF_FLAG_ZERO || NEED_PRINTF_UNBOUNDED_PRECISION</span>
<span class="udiff-line-modified-added">+ #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF || !DCHAR_IS_TCHAR || ENABLE_UNISTDIO || NEED_PRINTF_FLAG_LEFTADJUST || NEED_PRINTF_FLAG_ZERO || NEED_PRINTF_UNBOUNDED_PRECISION</span>
                  size_t width;
  #endif
<span class="udiff-line-modified-removed">- #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || NEED_PRINTF_UNBOUNDED_PRECISION</span>
<span class="udiff-line-modified-added">+ #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF || NEED_PRINTF_UNBOUNDED_PRECISION</span>
                  int has_precision;
                  size_t precision;
  #endif
  #if NEED_PRINTF_UNBOUNDED_PRECISION
                  int prec_ourselves;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4609,11 +4636,11 @@</span>
  #endif
  
  #if !DCHAR_IS_TCHAR || ENABLE_UNISTDIO || NEED_PRINTF_FLAG_LEFTADJUST || NEED_PRINTF_FLAG_ZERO || NEED_PRINTF_UNBOUNDED_PRECISION
                  has_width = 0;
  #endif
<span class="udiff-line-modified-removed">- #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || !DCHAR_IS_TCHAR || ENABLE_UNISTDIO || NEED_PRINTF_FLAG_LEFTADJUST || NEED_PRINTF_FLAG_ZERO || NEED_PRINTF_UNBOUNDED_PRECISION</span>
<span class="udiff-line-modified-added">+ #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF || !DCHAR_IS_TCHAR || ENABLE_UNISTDIO || NEED_PRINTF_FLAG_LEFTADJUST || NEED_PRINTF_FLAG_ZERO || NEED_PRINTF_UNBOUNDED_PRECISION</span>
                  width = 0;
                  if (dp-&gt;width_start != dp-&gt;width_end)
                    {
                      if (dp-&gt;width_arg_index != ARG_NONE)
                        {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4643,11 +4670,11 @@</span>
                      has_width = 1;
  #endif
                    }
  #endif
  
<span class="udiff-line-modified-removed">- #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || NEED_PRINTF_UNBOUNDED_PRECISION</span>
<span class="udiff-line-modified-added">+ #if !USE_SNPRINTF || !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF || NEED_PRINTF_UNBOUNDED_PRECISION</span>
                  has_precision = 0;
                  precision = 6;
                  if (dp-&gt;precision_start != dp-&gt;precision_end)
                    {
                      if (dp-&gt;precision_arg_index != ARG_NONE)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4811,20 +4838,20 @@</span>
                  switch (type)
                    {
  #if HAVE_LONG_LONG
                    case TYPE_LONGLONGINT:
                    case TYPE_ULONGLONGINT:
<span class="udiff-line-modified-removed">- # if (defined _WIN32 || defined __WIN32__) &amp;&amp; ! defined __CYGWIN__</span>
<span class="udiff-line-modified-added">+ # if (defined _WIN32 &amp;&amp; FALSE) &amp;&amp; ! defined __CYGWIN__</span>
                      *fbp++ = &#39;I&#39;;
                      *fbp++ = &#39;6&#39;;
                      *fbp++ = &#39;4&#39;;
                      break;
  # else
                      *fbp++ = &#39;l&#39;;
<span class="udiff-line-removed">-                     /*FALLTHROUGH*/</span>
  # endif
  #endif
<span class="udiff-line-added">+                     FALLTHROUGH;</span>
                    case TYPE_LONGINT:
                    case TYPE_ULONGINT:
  #if HAVE_WINT_T
                    case TYPE_WIDE_CHAR:
  #endif
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4844,11 +4871,15 @@</span>
                    *fbp = &#39;f&#39;;
                  else
  #endif
                    *fbp = dp-&gt;conversion;
  #if USE_SNPRINTF
<span class="udiff-line-modified-removed">- # if !(((__GLIBC__ &gt; 2 || (__GLIBC__ == 2 &amp;&amp; __GLIBC_MINOR__ &gt;= 3)) &amp;&amp; !defined __UCLIBC__) || ((defined _WIN32 || defined __WIN32__) &amp;&amp; ! defined __CYGWIN__))</span>
<span class="udiff-line-modified-added">+ # if ! (((__GLIBC__ &gt; 2 || (__GLIBC__ == 2 &amp;&amp; __GLIBC_MINOR__ &gt;= 3))        \</span>
<span class="udiff-line-added">+          &amp;&amp; !defined __UCLIBC__)                                            \</span>
<span class="udiff-line-added">+         || (defined __APPLE__ &amp;&amp; defined __MACH__)                          \</span>
<span class="udiff-line-added">+         || defined __ANDROID__                                              \</span>
<span class="udiff-line-added">+         || (defined _WIN32 &amp;&amp; ! defined __CYGWIN__))</span>
                  fbp[1] = &#39;%&#39;;
                  fbp[2] = &#39;n&#39;;
                  fbp[3] = &#39;\0&#39;;
  # else
                  /* On glibc2 systems from glibc &gt;= 2.3 - probably also older
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4858,10 +4889,25 @@</span>
                     Therefore we can avoid using %n in this situation.
                     On glibc2 systems from 2004-10-18 or newer, the use of %n
                     in format strings in writable memory may crash the program
                     (if compiled with _FORTIFY_SOURCE=2), so we should avoid it
                     in this situation.  */
<span class="udiff-line-added">+                 /* On Mac OS X 10.3 or newer, we know that snprintf&#39;s return</span>
<span class="udiff-line-added">+                    value conforms to ISO C 99: the tests gl_SNPRINTF_RETVAL_C99</span>
<span class="udiff-line-added">+                    and gl_SNPRINTF_TRUNCATION_C99 pass.</span>
<span class="udiff-line-added">+                    Therefore we can avoid using %n in this situation.</span>
<span class="udiff-line-added">+                    On Mac OS X 10.13 or newer, the use of %n in format strings</span>
<span class="udiff-line-added">+                    in writable memory by default crashes the program, so we</span>
<span class="udiff-line-added">+                    should avoid it in this situation.  */</span>
<span class="udiff-line-added">+                 /* On Android, we know that snprintf&#39;s return value conforms to</span>
<span class="udiff-line-added">+                    ISO C 99: the tests gl_SNPRINTF_RETVAL_C99 and</span>
<span class="udiff-line-added">+                    gl_SNPRINTF_TRUNCATION_C99 pass.</span>
<span class="udiff-line-added">+                    Therefore we can avoid using %n in this situation.</span>
<span class="udiff-line-added">+                    Starting on 2018-03-07, the use of %n in format strings</span>
<span class="udiff-line-added">+                    produces a fatal error (see</span>
<span class="udiff-line-added">+                    &lt;https://android.googlesource.com/platform/bionic/+/41398d03b7e8e0dfb951660ae713e682e9fc0336&gt;),</span>
<span class="udiff-line-added">+                    so we should avoid it.  */</span>
                  /* On native Windows systems (such as mingw), we can avoid using
                     %n because:
                       - Although the gl_SNPRINTF_TRUNCATION_C99 test fails,
                         snprintf does not write more than the specified number
                         of bytes. (snprintf (buf, 3, &quot;%d %d&quot;, 4567, 89) writes
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4870,12 +4916,12 @@</span>
                         allows us to recognize the case of an insufficient
                         buffer size: it returns -1 in this case.
                     On native Windows systems (such as mingw) where the OS is
                     Windows Vista, the use of %n in format strings by default
                     crashes the program. See
<span class="udiff-line-modified-removed">-                      &lt;http://gcc.gnu.org/ml/gcc/2007-06/msg00122.html&gt; and</span>
<span class="udiff-line-modified-removed">-                      &lt;http://msdn2.microsoft.com/en-us/library/ms175782(VS.80).aspx&gt;</span>
<span class="udiff-line-modified-added">+                      &lt;https://gcc.gnu.org/ml/gcc/2007-06/msg00122.html&gt; and</span>
<span class="udiff-line-modified-added">+                      &lt;https://msdn.microsoft.com/en-us/library/ms175782.aspx&gt;</span>
                     So we should avoid %n in this situation.  */
                  fbp[1] = &#39;\0&#39;;
  # endif
  #else
                  fbp[1] = &#39;\0&#39;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5090,11 +5136,11 @@</span>
                         produced.  */
                      if (count &gt;= 0)
                        {
                          /* Verify that snprintf() has NUL-terminated its
                             result.  */
<span class="udiff-line-modified-removed">-                         if (count &lt; maxlen</span>
<span class="udiff-line-modified-added">+                         if ((unsigned int) count &lt; maxlen</span>
                              &amp;&amp; ((TCHAR_T *) (result + length)) [count] != &#39;\0&#39;)
                            abort ();
                          /* Portability hack.  */
                          if (retcount &gt; count)
                            count = retcount;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5113,11 +5159,11 @@</span>
                          else
                            {
                              /* Look at the snprintf() return value.  */
                              if (retcount &lt; 0)
                                {
<span class="udiff-line-modified-removed">- # if !HAVE_SNPRINTF_RETVAL_C99</span>
<span class="udiff-line-modified-added">+ # if !HAVE_SNPRINTF_RETVAL_C99 || USE_MSVC__SNPRINTF</span>
                                  /* HP-UX 10.20 snprintf() is doubly deficient:
                                     It doesn&#39;t understand the &#39;%n&#39; directive,
                                     *and* it returns -1 (rather than the length
                                     that would have been required) when the
                                     buffer is too small.
</pre>
<center><a href="printf.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="vasnprintf.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>