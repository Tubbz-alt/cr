<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/win_iconv.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="libcharset/localcharset.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../gmodule/gmodule-dl.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/win_iconv.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 416     {865, &quot;IBM865&quot;},
 417     {865, &quot;CSIBM865&quot;},
 418 
 419     {869, &quot;869&quot;},
 420     {869, &quot;CP-GR&quot;},
 421     {869, &quot;CP869&quot;},
 422     {869, &quot;IBM869&quot;},
 423     {869, &quot;CSIBM869&quot;},
 424 
 425     /* !IsValidCodePage(1152) */
 426     {1125, &quot;CP1125&quot;},
 427 
 428     /*
 429      * Code Page Identifiers
 430      * http://msdn2.microsoft.com/en-us/library/ms776446.aspx
 431      */
 432     {37, &quot;IBM037&quot;}, /* IBM EBCDIC US-Canada */
 433     {437, &quot;IBM437&quot;}, /* OEM United States */
 434     {500, &quot;IBM500&quot;}, /* IBM EBCDIC International */
 435     {708, &quot;ASMO-708&quot;}, /* Arabic (ASMO 708) */
<span class="line-modified"> 436     /* 709      Arabic (ASMO-449+, BCON V4) */</span>
<span class="line-modified"> 437     /* 710      Arabic - Transparent Arabic */</span>
 438     {720, &quot;DOS-720&quot;}, /* Arabic (Transparent ASMO); Arabic (DOS) */
 439     {737, &quot;ibm737&quot;}, /* OEM Greek (formerly 437G); Greek (DOS) */
 440     {775, &quot;ibm775&quot;}, /* OEM Baltic; Baltic (DOS) */
 441     {850, &quot;ibm850&quot;}, /* OEM Multilingual Latin 1; Western European (DOS) */
 442     {852, &quot;ibm852&quot;}, /* OEM Latin 2; Central European (DOS) */
 443     {855, &quot;IBM855&quot;}, /* OEM Cyrillic (primarily Russian) */
 444     {857, &quot;ibm857&quot;}, /* OEM Turkish; Turkish (DOS) */
 445     {858, &quot;IBM00858&quot;}, /* OEM Multilingual Latin 1 + Euro symbol */
 446     {860, &quot;IBM860&quot;}, /* OEM Portuguese; Portuguese (DOS) */
 447     {861, &quot;ibm861&quot;}, /* OEM Icelandic; Icelandic (DOS) */
 448     {862, &quot;DOS-862&quot;}, /* OEM Hebrew; Hebrew (DOS) */
 449     {863, &quot;IBM863&quot;}, /* OEM French Canadian; French Canadian (DOS) */
 450     {864, &quot;IBM864&quot;}, /* OEM Arabic; Arabic (864) */
 451     {865, &quot;IBM865&quot;}, /* OEM Nordic; Nordic (DOS) */
 452     {866, &quot;cp866&quot;}, /* OEM Russian; Cyrillic (DOS) */
 453     {869, &quot;ibm869&quot;}, /* OEM Modern Greek; Greek, Modern (DOS) */
 454     {870, &quot;IBM870&quot;}, /* IBM EBCDIC Multilingual/ROECE (Latin 2); IBM EBCDIC Multilingual Latin 2 */
 455     {874, &quot;windows-874&quot;}, /* ANSI/OEM Thai (same as 28605, ISO 8859-15); Thai (Windows) */
 456     {875, &quot;cp875&quot;}, /* IBM EBCDIC Greek Modern */
 457     {932, &quot;shift_jis&quot;}, /* ANSI/OEM Japanese; Japanese (Shift-JIS) */
</pre>
<hr />
<pre>
 517     {20278, &quot;IBM278&quot;}, /* IBM EBCDIC Finland-Sweden */
 518     {20280, &quot;IBM280&quot;}, /* IBM EBCDIC Italy */
 519     {20284, &quot;IBM284&quot;}, /* IBM EBCDIC Latin America-Spain */
 520     {20285, &quot;IBM285&quot;}, /* IBM EBCDIC United Kingdom */
 521     {20290, &quot;IBM290&quot;}, /* IBM EBCDIC Japanese Katakana Extended */
 522     {20297, &quot;IBM297&quot;}, /* IBM EBCDIC France */
 523     {20420, &quot;IBM420&quot;}, /* IBM EBCDIC Arabic */
 524     {20423, &quot;IBM423&quot;}, /* IBM EBCDIC Greek */
 525     {20424, &quot;IBM424&quot;}, /* IBM EBCDIC Hebrew */
 526     {20833, &quot;x-EBCDIC-KoreanExtended&quot;}, /* IBM EBCDIC Korean Extended */
 527     {20838, &quot;IBM-Thai&quot;}, /* IBM EBCDIC Thai */
 528     {20866, &quot;koi8-r&quot;}, /* Russian (KOI8-R); Cyrillic (KOI8-R) */
 529     {20871, &quot;IBM871&quot;}, /* IBM EBCDIC Icelandic */
 530     {20880, &quot;IBM880&quot;}, /* IBM EBCDIC Cyrillic Russian */
 531     {20905, &quot;IBM905&quot;}, /* IBM EBCDIC Turkish */
 532     {20924, &quot;IBM00924&quot;}, /* IBM EBCDIC Latin 1/Open System (1047 + Euro symbol) */
 533     {20932, &quot;EUC-JP&quot;}, /* Japanese (JIS 0208-1990 and 0121-1990) */
 534     {20936, &quot;x-cp20936&quot;}, /* Simplified Chinese (GB2312); Chinese Simplified (GB2312-80) */
 535     {20949, &quot;x-cp20949&quot;}, /* Korean Wansung */
 536     {21025, &quot;cp1025&quot;}, /* IBM EBCDIC Cyrillic Serbian-Bulgarian */
<span class="line-modified"> 537     /* 21027        (deprecated) */</span>
 538     {21866, &quot;koi8-u&quot;}, /* Ukrainian (KOI8-U); Cyrillic (KOI8-U) */
 539     {28591, &quot;iso-8859-1&quot;}, /* ISO 8859-1 Latin 1; Western European (ISO) */
 540     {28591, &quot;iso8859-1&quot;}, /* ISO 8859-1 Latin 1; Western European (ISO) */
 541     {28591, &quot;iso_8859-1&quot;},
 542     {28591, &quot;iso_8859_1&quot;},
 543     {28592, &quot;iso-8859-2&quot;}, /* ISO 8859-2 Central European; Central European (ISO) */
 544     {28592, &quot;iso8859-2&quot;}, /* ISO 8859-2 Central European; Central European (ISO) */
 545     {28592, &quot;iso_8859-2&quot;},
 546     {28592, &quot;iso_8859_2&quot;},
 547     {28593, &quot;iso-8859-3&quot;}, /* ISO 8859-3 Latin 3 */
 548     {28593, &quot;iso8859-3&quot;}, /* ISO 8859-3 Latin 3 */
 549     {28593, &quot;iso_8859-3&quot;},
 550     {28593, &quot;iso_8859_3&quot;},
 551     {28594, &quot;iso-8859-4&quot;}, /* ISO 8859-4 Baltic */
 552     {28594, &quot;iso8859-4&quot;}, /* ISO 8859-4 Baltic */
 553     {28594, &quot;iso_8859-4&quot;},
 554     {28594, &quot;iso_8859_4&quot;},
 555     {28595, &quot;iso-8859-5&quot;}, /* ISO 8859-5 Cyrillic */
 556     {28595, &quot;iso8859-5&quot;}, /* ISO 8859-5 Cyrillic */
 557     {28595, &quot;iso_8859-5&quot;},
</pre>
<hr />
<pre>
 574     {28599, &quot;iso_8859_9&quot;},
 575     {28603, &quot;iso-8859-13&quot;}, /* ISO 8859-13 Estonian */
 576     {28603, &quot;iso8859-13&quot;}, /* ISO 8859-13 Estonian */
 577     {28603, &quot;iso_8859-13&quot;},
 578     {28603, &quot;iso_8859_13&quot;},
 579     {28605, &quot;iso-8859-15&quot;}, /* ISO 8859-15 Latin 9 */
 580     {28605, &quot;iso8859-15&quot;}, /* ISO 8859-15 Latin 9 */
 581     {28605, &quot;iso_8859-15&quot;},
 582     {28605, &quot;iso_8859_15&quot;},
 583     {29001, &quot;x-Europa&quot;}, /* Europa 3 */
 584     {38598, &quot;iso-8859-8-i&quot;}, /* ISO 8859-8 Hebrew; Hebrew (ISO-Logical) */
 585     {38598, &quot;iso8859-8-i&quot;}, /* ISO 8859-8 Hebrew; Hebrew (ISO-Logical) */
 586     {38598, &quot;iso_8859-8-i&quot;},
 587     {38598, &quot;iso_8859_8-i&quot;},
 588     {50220, &quot;iso-2022-jp&quot;}, /* ISO 2022 Japanese with no halfwidth Katakana; Japanese (JIS) */
 589     {50221, &quot;csISO2022JP&quot;}, /* ISO 2022 Japanese with halfwidth Katakana; Japanese (JIS-Allow 1 byte Kana) */
 590     {50222, &quot;iso-2022-jp&quot;}, /* ISO 2022 Japanese JIS X 0201-1989; Japanese (JIS-Allow 1 byte Kana - SO/SI) */
 591     {50225, &quot;iso-2022-kr&quot;}, /* ISO 2022 Korean */
 592     {50225, &quot;iso2022-kr&quot;}, /* ISO 2022 Korean */
 593     {50227, &quot;x-cp50227&quot;}, /* ISO 2022 Simplified Chinese; Chinese Simplified (ISO 2022) */
<span class="line-modified"> 594     /* 50229        ISO 2022 Traditional Chinese */</span>
<span class="line-modified"> 595     /* 50930        EBCDIC Japanese (Katakana) Extended */</span>
<span class="line-modified"> 596     /* 50931        EBCDIC US-Canada and Japanese */</span>
<span class="line-modified"> 597     /* 50933        EBCDIC Korean Extended and Korean */</span>
<span class="line-modified"> 598     /* 50935        EBCDIC Simplified Chinese Extended and Simplified Chinese */</span>
<span class="line-modified"> 599     /* 50936        EBCDIC Simplified Chinese */</span>
<span class="line-modified"> 600     /* 50937        EBCDIC US-Canada and Traditional Chinese */</span>
<span class="line-modified"> 601     /* 50939        EBCDIC Japanese (Latin) Extended and Japanese */</span>
 602     {51932, &quot;euc-jp&quot;}, /* EUC Japanese */
 603     {51936, &quot;EUC-CN&quot;}, /* EUC Simplified Chinese; Chinese Simplified (EUC) */
 604     {51949, &quot;euc-kr&quot;}, /* EUC Korean */
<span class="line-modified"> 605     /* 51950        EUC Traditional Chinese */</span>
 606     {52936, &quot;hz-gb-2312&quot;}, /* HZ-GB2312 Simplified Chinese; Chinese Simplified (HZ) */
 607     {54936, &quot;GB18030&quot;}, /* Windows XP and later: GB18030 Simplified Chinese (4 byte); Chinese Simplified (GB18030) */
 608     {57002, &quot;x-iscii-de&quot;}, /* ISCII Devanagari */
 609     {57003, &quot;x-iscii-be&quot;}, /* ISCII Bengali */
 610     {57004, &quot;x-iscii-ta&quot;}, /* ISCII Tamil */
 611     {57005, &quot;x-iscii-te&quot;}, /* ISCII Telugu */
 612     {57006, &quot;x-iscii-as&quot;}, /* ISCII Assamese */
 613     {57007, &quot;x-iscii-or&quot;}, /* ISCII Oriya */
 614     {57008, &quot;x-iscii-ka&quot;}, /* ISCII Kannada */
 615     {57009, &quot;x-iscii-ma&quot;}, /* ISCII Malayalam */
 616     {57010, &quot;x-iscii-gu&quot;}, /* ISCII Gujarati */
 617     {57011, &quot;x-iscii-pa&quot;}, /* ISCII Punjabi */
 618 
 619     {0, NULL}
 620 };
 621 
 622 /*
 623  * SJIS SHIFTJIS table              CP932 table
 624  * ---- --------------------------- --------------------------------
 625  *   5C U+00A5 YEN SIGN             U+005C REVERSE SOLIDUS
</pre>
<hr />
<pre>
 980     }
 981     else if (cv-&gt;codepage == 65001)
 982     {
 983         cv-&gt;mbtowc = kernel_mbtowc;
 984         cv-&gt;wctomb = kernel_wctomb;
 985         cv-&gt;mblen = utf8_mblen;
 986     }
 987     else if ((cv-&gt;codepage == 50220 || cv-&gt;codepage == 50221 || cv-&gt;codepage == 50222) &amp;&amp; load_mlang())
 988     {
 989         cv-&gt;mbtowc = iso2022jp_mbtowc;
 990         cv-&gt;wctomb = iso2022jp_wctomb;
 991         cv-&gt;flush = iso2022jp_flush;
 992     }
 993     else if (cv-&gt;codepage == 51932 &amp;&amp; load_mlang())
 994     {
 995         cv-&gt;mbtowc = mlang_mbtowc;
 996         cv-&gt;wctomb = mlang_wctomb;
 997         cv-&gt;mblen = eucjp_mblen;
 998     }
 999     else if (IsValidCodePage(cv-&gt;codepage)
<span class="line-modified">1000          &amp;&amp; GetCPInfo(cv-&gt;codepage, &amp;cpinfo) != 0)</span>
1001     {
1002         cv-&gt;mbtowc = kernel_mbtowc;
1003         cv-&gt;wctomb = kernel_wctomb;
1004         if (cpinfo.MaxCharSize == 1)
1005             cv-&gt;mblen = sbcs_mblen;
1006         else if (cpinfo.MaxCharSize == 2)
1007             cv-&gt;mblen = dbcs_mblen;
1008         else
<span class="line-modified">1009         cv-&gt;mblen = mbcs_mblen;</span>
1010     }
1011     else
1012     {
1013         /* not supported */
1014         free(name);
1015         errno = EINVAL;
1016         return FALSE;
1017     }
1018 
1019     if (use_compat)
1020     {
1021         switch (cv-&gt;codepage)
1022         {
1023         case 932: cv-&gt;compat = cp932_compat; break;
1024         case 20932: cv-&gt;compat = cp20932_compat; break;
1025         case 51932: cv-&gt;compat = cp51932_compat; break;
1026         case 50220: case 50221: case 50222: cv-&gt;compat = cp5022x_compat; break;
1027         }
1028     }
1029 
1030     free(name);
1031 
1032     return TRUE;
1033 }
1034 
1035 static int
1036 name_to_codepage(const char *name)
1037 {
1038     int i;
1039 
1040     if (*name == &#39;\0&#39; ||
<span class="line-modified">1041     strcmp(name, &quot;char&quot;) == 0)</span>
1042         return GetACP();
1043     else if (strcmp(name, &quot;wchar_t&quot;) == 0)
1044         return 1200;
1045     else if (_strnicmp(name, &quot;cp&quot;, 2) == 0)
1046         return atoi(name + 2); /* CP123 */
1047     else if (&#39;0&#39; &lt;= name[0] &amp;&amp; name[0] &lt;= &#39;9&#39;)
1048         return atoi(name);     /* 123 */
1049     else if (_strnicmp(name, &quot;xx&quot;, 2) == 0)
1050         return atoi(name + 2); /* XX123 for debug */
1051 
1052     for (i = 0; codepage_alias[i].name != NULL; ++i)
1053         if (_stricmp(name, codepage_alias[i].name) == 0)
1054             return codepage_alias[i].codepage;
1055     return -1;
1056 }
1057 
1058 /*
1059  * http://www.faqs.org/rfcs/rfc2781.html
1060  */
1061 static uint
</pre>
<hr />
<pre>
1081         wbuf[0] = 0xD800 | ((wc &gt;&gt; 10) &amp; 0x3FF);
1082         wbuf[1] = 0xDC00 | (wc &amp; 0x3FF);
1083         *wbufsize = 2;
1084     }
1085 }
1086 
1087 /*
1088  * Check if codepage is one of those for which the dwFlags parameter
1089  * to MultiByteToWideChar() must be zero. Return zero or
1090  * MB_ERR_INVALID_CHARS.  The docs in Platform SDK for for Windows
1091  * Server 2003 R2 claims that also codepage 65001 is one of these, but
1092  * that doesn&#39;t seem to be the case. The MSDN docs for MSVS2008 leave
1093  * out 65001 (UTF-8), and that indeed seems to be the case on XP, it
1094  * works fine to pass MB_ERR_INVALID_CHARS in dwFlags when converting
1095  * from UTF-8.
1096  */
1097 static int
1098 mbtowc_flags(int codepage)
1099 {
1100     return (codepage == 50220 || codepage == 50221 ||
<span class="line-modified">1101         codepage == 50222 || codepage == 50225 ||</span>
<span class="line-modified">1102         codepage == 50227 || codepage == 50229 ||</span>
<span class="line-modified">1103         codepage == 52936 || codepage == 54936 ||</span>
<span class="line-modified">1104         (codepage &gt;= 57002 &amp;&amp; codepage &lt;= 57011) ||</span>
<span class="line-modified">1105         codepage == 65000 || codepage == 42) ? 0 : MB_ERR_INVALID_CHARS;</span>
1106 }
1107 
1108 /*
1109  * Check if codepage is one those for which the lpUsedDefaultChar
1110  * parameter to WideCharToMultiByte() must be NULL.  The docs in
1111  * Platform SDK for Windows Server 2003 R2 claims that this is the
1112  * list below, while the MSDN docs for MSVS2008 claim that it is only
1113  * for 65000 (UTF-7) and 65001 (UTF-8). This time the earlier Platform
1114  * SDK seems to be correct, at least for XP.
1115  */
1116 static int
1117 must_use_null_useddefaultchar(int codepage)
1118 {
1119     return (codepage == 65000 || codepage == 65001 ||
1120             codepage == 50220 || codepage == 50221 ||
1121             codepage == 50222 || codepage == 50225 ||
1122             codepage == 50227 || codepage == 50229 ||
1123             codepage == 52936 || codepage == 54936 ||
1124             (codepage &gt;= 57002 &amp;&amp; codepage &lt;= 57011) ||
1125             codepage == 42);
</pre>
<hr />
<pre>
1297 sbcs_mblen(csconv_t *cv UNUSED, const uchar *buf UNUSED, int bufsize UNUSED)
1298 {
1299     return 1;
1300 }
1301 
1302 static int
1303 dbcs_mblen(csconv_t *cv, const uchar *buf, int bufsize)
1304 {
1305     int len = IsDBCSLeadByteEx(cv-&gt;codepage, buf[0]) ? 2 : 1;
1306     if (bufsize &lt; len)
1307         return seterror(EINVAL);
1308     return len;
1309 }
1310 
1311 static int
1312 mbcs_mblen(csconv_t *cv, const uchar *buf, int bufsize)
1313 {
1314     int len = 0;
1315 
1316     if (cv-&gt;codepage == 54936) {
<span class="line-modified">1317     if (buf[0] &lt;= 0x7F) len = 1;</span>
<span class="line-modified">1318     else if (buf[0] &gt;= 0x81 &amp;&amp; buf[0] &lt;= 0xFE &amp;&amp;</span>
<span class="line-modified">1319          bufsize &gt;= 2 &amp;&amp;</span>
<span class="line-modified">1320          ((buf[1] &gt;= 0x40 &amp;&amp; buf[1] &lt;= 0x7E) ||</span>
<span class="line-modified">1321           (buf[1] &gt;= 0x80 &amp;&amp; buf[1] &lt;= 0xFE))) len = 2;</span>
<span class="line-modified">1322     else if (buf[0] &gt;= 0x81 &amp;&amp; buf[0] &lt;= 0xFE &amp;&amp;</span>
<span class="line-modified">1323          bufsize &gt;= 4 &amp;&amp;</span>
<span class="line-modified">1324          buf[1] &gt;= 0x30 &amp;&amp; buf[1] &lt;= 0x39) len = 4;</span>
<span class="line-modified">1325     else</span>
<span class="line-modified">1326         return seterror(EINVAL);</span>
<span class="line-modified">1327     return len;</span>
1328     }
1329     else
<span class="line-modified">1330     return seterror(EINVAL);</span>
1331 }
1332 
1333 static int
1334 utf8_mblen(csconv_t *cv UNUSED, const uchar *buf, int bufsize)
1335 {
1336     int len = 0;
1337 
1338     if (buf[0] &lt; 0x80) len = 1;
1339     else if ((buf[0] &amp; 0xE0) == 0xC0) len = 2;
1340     else if ((buf[0] &amp; 0xF0) == 0xE0) len = 3;
1341     else if ((buf[0] &amp; 0xF8) == 0xF0) len = 4;
1342     else if ((buf[0] &amp; 0xFC) == 0xF8) len = 5;
1343     else if ((buf[0] &amp; 0xFE) == 0xFC) len = 6;
1344 
1345     if (len == 0)
1346         return seterror(EILSEQ);
1347     else if (bufsize &lt; len)
1348         return seterror(EINVAL);
1349     return len;
1350 }
</pre>
</td>
<td>
<hr />
<pre>
 416     {865, &quot;IBM865&quot;},
 417     {865, &quot;CSIBM865&quot;},
 418 
 419     {869, &quot;869&quot;},
 420     {869, &quot;CP-GR&quot;},
 421     {869, &quot;CP869&quot;},
 422     {869, &quot;IBM869&quot;},
 423     {869, &quot;CSIBM869&quot;},
 424 
 425     /* !IsValidCodePage(1152) */
 426     {1125, &quot;CP1125&quot;},
 427 
 428     /*
 429      * Code Page Identifiers
 430      * http://msdn2.microsoft.com/en-us/library/ms776446.aspx
 431      */
 432     {37, &quot;IBM037&quot;}, /* IBM EBCDIC US-Canada */
 433     {437, &quot;IBM437&quot;}, /* OEM United States */
 434     {500, &quot;IBM500&quot;}, /* IBM EBCDIC International */
 435     {708, &quot;ASMO-708&quot;}, /* Arabic (ASMO 708) */
<span class="line-modified"> 436     /* 709    Arabic (ASMO-449+, BCON V4) */</span>
<span class="line-modified"> 437     /* 710    Arabic - Transparent Arabic */</span>
 438     {720, &quot;DOS-720&quot;}, /* Arabic (Transparent ASMO); Arabic (DOS) */
 439     {737, &quot;ibm737&quot;}, /* OEM Greek (formerly 437G); Greek (DOS) */
 440     {775, &quot;ibm775&quot;}, /* OEM Baltic; Baltic (DOS) */
 441     {850, &quot;ibm850&quot;}, /* OEM Multilingual Latin 1; Western European (DOS) */
 442     {852, &quot;ibm852&quot;}, /* OEM Latin 2; Central European (DOS) */
 443     {855, &quot;IBM855&quot;}, /* OEM Cyrillic (primarily Russian) */
 444     {857, &quot;ibm857&quot;}, /* OEM Turkish; Turkish (DOS) */
 445     {858, &quot;IBM00858&quot;}, /* OEM Multilingual Latin 1 + Euro symbol */
 446     {860, &quot;IBM860&quot;}, /* OEM Portuguese; Portuguese (DOS) */
 447     {861, &quot;ibm861&quot;}, /* OEM Icelandic; Icelandic (DOS) */
 448     {862, &quot;DOS-862&quot;}, /* OEM Hebrew; Hebrew (DOS) */
 449     {863, &quot;IBM863&quot;}, /* OEM French Canadian; French Canadian (DOS) */
 450     {864, &quot;IBM864&quot;}, /* OEM Arabic; Arabic (864) */
 451     {865, &quot;IBM865&quot;}, /* OEM Nordic; Nordic (DOS) */
 452     {866, &quot;cp866&quot;}, /* OEM Russian; Cyrillic (DOS) */
 453     {869, &quot;ibm869&quot;}, /* OEM Modern Greek; Greek, Modern (DOS) */
 454     {870, &quot;IBM870&quot;}, /* IBM EBCDIC Multilingual/ROECE (Latin 2); IBM EBCDIC Multilingual Latin 2 */
 455     {874, &quot;windows-874&quot;}, /* ANSI/OEM Thai (same as 28605, ISO 8859-15); Thai (Windows) */
 456     {875, &quot;cp875&quot;}, /* IBM EBCDIC Greek Modern */
 457     {932, &quot;shift_jis&quot;}, /* ANSI/OEM Japanese; Japanese (Shift-JIS) */
</pre>
<hr />
<pre>
 517     {20278, &quot;IBM278&quot;}, /* IBM EBCDIC Finland-Sweden */
 518     {20280, &quot;IBM280&quot;}, /* IBM EBCDIC Italy */
 519     {20284, &quot;IBM284&quot;}, /* IBM EBCDIC Latin America-Spain */
 520     {20285, &quot;IBM285&quot;}, /* IBM EBCDIC United Kingdom */
 521     {20290, &quot;IBM290&quot;}, /* IBM EBCDIC Japanese Katakana Extended */
 522     {20297, &quot;IBM297&quot;}, /* IBM EBCDIC France */
 523     {20420, &quot;IBM420&quot;}, /* IBM EBCDIC Arabic */
 524     {20423, &quot;IBM423&quot;}, /* IBM EBCDIC Greek */
 525     {20424, &quot;IBM424&quot;}, /* IBM EBCDIC Hebrew */
 526     {20833, &quot;x-EBCDIC-KoreanExtended&quot;}, /* IBM EBCDIC Korean Extended */
 527     {20838, &quot;IBM-Thai&quot;}, /* IBM EBCDIC Thai */
 528     {20866, &quot;koi8-r&quot;}, /* Russian (KOI8-R); Cyrillic (KOI8-R) */
 529     {20871, &quot;IBM871&quot;}, /* IBM EBCDIC Icelandic */
 530     {20880, &quot;IBM880&quot;}, /* IBM EBCDIC Cyrillic Russian */
 531     {20905, &quot;IBM905&quot;}, /* IBM EBCDIC Turkish */
 532     {20924, &quot;IBM00924&quot;}, /* IBM EBCDIC Latin 1/Open System (1047 + Euro symbol) */
 533     {20932, &quot;EUC-JP&quot;}, /* Japanese (JIS 0208-1990 and 0121-1990) */
 534     {20936, &quot;x-cp20936&quot;}, /* Simplified Chinese (GB2312); Chinese Simplified (GB2312-80) */
 535     {20949, &quot;x-cp20949&quot;}, /* Korean Wansung */
 536     {21025, &quot;cp1025&quot;}, /* IBM EBCDIC Cyrillic Serbian-Bulgarian */
<span class="line-modified"> 537     /* 21027    (deprecated) */</span>
 538     {21866, &quot;koi8-u&quot;}, /* Ukrainian (KOI8-U); Cyrillic (KOI8-U) */
 539     {28591, &quot;iso-8859-1&quot;}, /* ISO 8859-1 Latin 1; Western European (ISO) */
 540     {28591, &quot;iso8859-1&quot;}, /* ISO 8859-1 Latin 1; Western European (ISO) */
 541     {28591, &quot;iso_8859-1&quot;},
 542     {28591, &quot;iso_8859_1&quot;},
 543     {28592, &quot;iso-8859-2&quot;}, /* ISO 8859-2 Central European; Central European (ISO) */
 544     {28592, &quot;iso8859-2&quot;}, /* ISO 8859-2 Central European; Central European (ISO) */
 545     {28592, &quot;iso_8859-2&quot;},
 546     {28592, &quot;iso_8859_2&quot;},
 547     {28593, &quot;iso-8859-3&quot;}, /* ISO 8859-3 Latin 3 */
 548     {28593, &quot;iso8859-3&quot;}, /* ISO 8859-3 Latin 3 */
 549     {28593, &quot;iso_8859-3&quot;},
 550     {28593, &quot;iso_8859_3&quot;},
 551     {28594, &quot;iso-8859-4&quot;}, /* ISO 8859-4 Baltic */
 552     {28594, &quot;iso8859-4&quot;}, /* ISO 8859-4 Baltic */
 553     {28594, &quot;iso_8859-4&quot;},
 554     {28594, &quot;iso_8859_4&quot;},
 555     {28595, &quot;iso-8859-5&quot;}, /* ISO 8859-5 Cyrillic */
 556     {28595, &quot;iso8859-5&quot;}, /* ISO 8859-5 Cyrillic */
 557     {28595, &quot;iso_8859-5&quot;},
</pre>
<hr />
<pre>
 574     {28599, &quot;iso_8859_9&quot;},
 575     {28603, &quot;iso-8859-13&quot;}, /* ISO 8859-13 Estonian */
 576     {28603, &quot;iso8859-13&quot;}, /* ISO 8859-13 Estonian */
 577     {28603, &quot;iso_8859-13&quot;},
 578     {28603, &quot;iso_8859_13&quot;},
 579     {28605, &quot;iso-8859-15&quot;}, /* ISO 8859-15 Latin 9 */
 580     {28605, &quot;iso8859-15&quot;}, /* ISO 8859-15 Latin 9 */
 581     {28605, &quot;iso_8859-15&quot;},
 582     {28605, &quot;iso_8859_15&quot;},
 583     {29001, &quot;x-Europa&quot;}, /* Europa 3 */
 584     {38598, &quot;iso-8859-8-i&quot;}, /* ISO 8859-8 Hebrew; Hebrew (ISO-Logical) */
 585     {38598, &quot;iso8859-8-i&quot;}, /* ISO 8859-8 Hebrew; Hebrew (ISO-Logical) */
 586     {38598, &quot;iso_8859-8-i&quot;},
 587     {38598, &quot;iso_8859_8-i&quot;},
 588     {50220, &quot;iso-2022-jp&quot;}, /* ISO 2022 Japanese with no halfwidth Katakana; Japanese (JIS) */
 589     {50221, &quot;csISO2022JP&quot;}, /* ISO 2022 Japanese with halfwidth Katakana; Japanese (JIS-Allow 1 byte Kana) */
 590     {50222, &quot;iso-2022-jp&quot;}, /* ISO 2022 Japanese JIS X 0201-1989; Japanese (JIS-Allow 1 byte Kana - SO/SI) */
 591     {50225, &quot;iso-2022-kr&quot;}, /* ISO 2022 Korean */
 592     {50225, &quot;iso2022-kr&quot;}, /* ISO 2022 Korean */
 593     {50227, &quot;x-cp50227&quot;}, /* ISO 2022 Simplified Chinese; Chinese Simplified (ISO 2022) */
<span class="line-modified"> 594     /* 50229    ISO 2022 Traditional Chinese */</span>
<span class="line-modified"> 595     /* 50930    EBCDIC Japanese (Katakana) Extended */</span>
<span class="line-modified"> 596     /* 50931    EBCDIC US-Canada and Japanese */</span>
<span class="line-modified"> 597     /* 50933    EBCDIC Korean Extended and Korean */</span>
<span class="line-modified"> 598     /* 50935    EBCDIC Simplified Chinese Extended and Simplified Chinese */</span>
<span class="line-modified"> 599     /* 50936    EBCDIC Simplified Chinese */</span>
<span class="line-modified"> 600     /* 50937    EBCDIC US-Canada and Traditional Chinese */</span>
<span class="line-modified"> 601     /* 50939    EBCDIC Japanese (Latin) Extended and Japanese */</span>
 602     {51932, &quot;euc-jp&quot;}, /* EUC Japanese */
 603     {51936, &quot;EUC-CN&quot;}, /* EUC Simplified Chinese; Chinese Simplified (EUC) */
 604     {51949, &quot;euc-kr&quot;}, /* EUC Korean */
<span class="line-modified"> 605     /* 51950    EUC Traditional Chinese */</span>
 606     {52936, &quot;hz-gb-2312&quot;}, /* HZ-GB2312 Simplified Chinese; Chinese Simplified (HZ) */
 607     {54936, &quot;GB18030&quot;}, /* Windows XP and later: GB18030 Simplified Chinese (4 byte); Chinese Simplified (GB18030) */
 608     {57002, &quot;x-iscii-de&quot;}, /* ISCII Devanagari */
 609     {57003, &quot;x-iscii-be&quot;}, /* ISCII Bengali */
 610     {57004, &quot;x-iscii-ta&quot;}, /* ISCII Tamil */
 611     {57005, &quot;x-iscii-te&quot;}, /* ISCII Telugu */
 612     {57006, &quot;x-iscii-as&quot;}, /* ISCII Assamese */
 613     {57007, &quot;x-iscii-or&quot;}, /* ISCII Oriya */
 614     {57008, &quot;x-iscii-ka&quot;}, /* ISCII Kannada */
 615     {57009, &quot;x-iscii-ma&quot;}, /* ISCII Malayalam */
 616     {57010, &quot;x-iscii-gu&quot;}, /* ISCII Gujarati */
 617     {57011, &quot;x-iscii-pa&quot;}, /* ISCII Punjabi */
 618 
 619     {0, NULL}
 620 };
 621 
 622 /*
 623  * SJIS SHIFTJIS table              CP932 table
 624  * ---- --------------------------- --------------------------------
 625  *   5C U+00A5 YEN SIGN             U+005C REVERSE SOLIDUS
</pre>
<hr />
<pre>
 980     }
 981     else if (cv-&gt;codepage == 65001)
 982     {
 983         cv-&gt;mbtowc = kernel_mbtowc;
 984         cv-&gt;wctomb = kernel_wctomb;
 985         cv-&gt;mblen = utf8_mblen;
 986     }
 987     else if ((cv-&gt;codepage == 50220 || cv-&gt;codepage == 50221 || cv-&gt;codepage == 50222) &amp;&amp; load_mlang())
 988     {
 989         cv-&gt;mbtowc = iso2022jp_mbtowc;
 990         cv-&gt;wctomb = iso2022jp_wctomb;
 991         cv-&gt;flush = iso2022jp_flush;
 992     }
 993     else if (cv-&gt;codepage == 51932 &amp;&amp; load_mlang())
 994     {
 995         cv-&gt;mbtowc = mlang_mbtowc;
 996         cv-&gt;wctomb = mlang_wctomb;
 997         cv-&gt;mblen = eucjp_mblen;
 998     }
 999     else if (IsValidCodePage(cv-&gt;codepage)
<span class="line-modified">1000        &amp;&amp; GetCPInfo(cv-&gt;codepage, &amp;cpinfo) != 0)</span>
1001     {
1002         cv-&gt;mbtowc = kernel_mbtowc;
1003         cv-&gt;wctomb = kernel_wctomb;
1004         if (cpinfo.MaxCharSize == 1)
1005             cv-&gt;mblen = sbcs_mblen;
1006         else if (cpinfo.MaxCharSize == 2)
1007             cv-&gt;mblen = dbcs_mblen;
1008         else
<span class="line-modified">1009       cv-&gt;mblen = mbcs_mblen;</span>
1010     }
1011     else
1012     {
1013         /* not supported */
1014         free(name);
1015         errno = EINVAL;
1016         return FALSE;
1017     }
1018 
1019     if (use_compat)
1020     {
1021         switch (cv-&gt;codepage)
1022         {
1023         case 932: cv-&gt;compat = cp932_compat; break;
1024         case 20932: cv-&gt;compat = cp20932_compat; break;
1025         case 51932: cv-&gt;compat = cp51932_compat; break;
1026         case 50220: case 50221: case 50222: cv-&gt;compat = cp5022x_compat; break;
1027         }
1028     }
1029 
1030     free(name);
1031 
1032     return TRUE;
1033 }
1034 
1035 static int
1036 name_to_codepage(const char *name)
1037 {
1038     int i;
1039 
1040     if (*name == &#39;\0&#39; ||
<span class="line-modified">1041   strcmp(name, &quot;char&quot;) == 0)</span>
1042         return GetACP();
1043     else if (strcmp(name, &quot;wchar_t&quot;) == 0)
1044         return 1200;
1045     else if (_strnicmp(name, &quot;cp&quot;, 2) == 0)
1046         return atoi(name + 2); /* CP123 */
1047     else if (&#39;0&#39; &lt;= name[0] &amp;&amp; name[0] &lt;= &#39;9&#39;)
1048         return atoi(name);     /* 123 */
1049     else if (_strnicmp(name, &quot;xx&quot;, 2) == 0)
1050         return atoi(name + 2); /* XX123 for debug */
1051 
1052     for (i = 0; codepage_alias[i].name != NULL; ++i)
1053         if (_stricmp(name, codepage_alias[i].name) == 0)
1054             return codepage_alias[i].codepage;
1055     return -1;
1056 }
1057 
1058 /*
1059  * http://www.faqs.org/rfcs/rfc2781.html
1060  */
1061 static uint
</pre>
<hr />
<pre>
1081         wbuf[0] = 0xD800 | ((wc &gt;&gt; 10) &amp; 0x3FF);
1082         wbuf[1] = 0xDC00 | (wc &amp; 0x3FF);
1083         *wbufsize = 2;
1084     }
1085 }
1086 
1087 /*
1088  * Check if codepage is one of those for which the dwFlags parameter
1089  * to MultiByteToWideChar() must be zero. Return zero or
1090  * MB_ERR_INVALID_CHARS.  The docs in Platform SDK for for Windows
1091  * Server 2003 R2 claims that also codepage 65001 is one of these, but
1092  * that doesn&#39;t seem to be the case. The MSDN docs for MSVS2008 leave
1093  * out 65001 (UTF-8), and that indeed seems to be the case on XP, it
1094  * works fine to pass MB_ERR_INVALID_CHARS in dwFlags when converting
1095  * from UTF-8.
1096  */
1097 static int
1098 mbtowc_flags(int codepage)
1099 {
1100     return (codepage == 50220 || codepage == 50221 ||
<span class="line-modified">1101       codepage == 50222 || codepage == 50225 ||</span>
<span class="line-modified">1102       codepage == 50227 || codepage == 50229 ||</span>
<span class="line-modified">1103       codepage == 52936 || codepage == 54936 ||</span>
<span class="line-modified">1104       (codepage &gt;= 57002 &amp;&amp; codepage &lt;= 57011) ||</span>
<span class="line-modified">1105       codepage == 65000 || codepage == 42) ? 0 : MB_ERR_INVALID_CHARS;</span>
1106 }
1107 
1108 /*
1109  * Check if codepage is one those for which the lpUsedDefaultChar
1110  * parameter to WideCharToMultiByte() must be NULL.  The docs in
1111  * Platform SDK for Windows Server 2003 R2 claims that this is the
1112  * list below, while the MSDN docs for MSVS2008 claim that it is only
1113  * for 65000 (UTF-7) and 65001 (UTF-8). This time the earlier Platform
1114  * SDK seems to be correct, at least for XP.
1115  */
1116 static int
1117 must_use_null_useddefaultchar(int codepage)
1118 {
1119     return (codepage == 65000 || codepage == 65001 ||
1120             codepage == 50220 || codepage == 50221 ||
1121             codepage == 50222 || codepage == 50225 ||
1122             codepage == 50227 || codepage == 50229 ||
1123             codepage == 52936 || codepage == 54936 ||
1124             (codepage &gt;= 57002 &amp;&amp; codepage &lt;= 57011) ||
1125             codepage == 42);
</pre>
<hr />
<pre>
1297 sbcs_mblen(csconv_t *cv UNUSED, const uchar *buf UNUSED, int bufsize UNUSED)
1298 {
1299     return 1;
1300 }
1301 
1302 static int
1303 dbcs_mblen(csconv_t *cv, const uchar *buf, int bufsize)
1304 {
1305     int len = IsDBCSLeadByteEx(cv-&gt;codepage, buf[0]) ? 2 : 1;
1306     if (bufsize &lt; len)
1307         return seterror(EINVAL);
1308     return len;
1309 }
1310 
1311 static int
1312 mbcs_mblen(csconv_t *cv, const uchar *buf, int bufsize)
1313 {
1314     int len = 0;
1315 
1316     if (cv-&gt;codepage == 54936) {
<span class="line-modified">1317   if (buf[0] &lt;= 0x7F) len = 1;</span>
<span class="line-modified">1318   else if (buf[0] &gt;= 0x81 &amp;&amp; buf[0] &lt;= 0xFE &amp;&amp;</span>
<span class="line-modified">1319      bufsize &gt;= 2 &amp;&amp;</span>
<span class="line-modified">1320      ((buf[1] &gt;= 0x40 &amp;&amp; buf[1] &lt;= 0x7E) ||</span>
<span class="line-modified">1321       (buf[1] &gt;= 0x80 &amp;&amp; buf[1] &lt;= 0xFE))) len = 2;</span>
<span class="line-modified">1322   else if (buf[0] &gt;= 0x81 &amp;&amp; buf[0] &lt;= 0xFE &amp;&amp;</span>
<span class="line-modified">1323      bufsize &gt;= 4 &amp;&amp;</span>
<span class="line-modified">1324      buf[1] &gt;= 0x30 &amp;&amp; buf[1] &lt;= 0x39) len = 4;</span>
<span class="line-modified">1325   else</span>
<span class="line-modified">1326       return seterror(EINVAL);</span>
<span class="line-modified">1327   return len;</span>
1328     }
1329     else
<span class="line-modified">1330   return seterror(EINVAL);</span>
1331 }
1332 
1333 static int
1334 utf8_mblen(csconv_t *cv UNUSED, const uchar *buf, int bufsize)
1335 {
1336     int len = 0;
1337 
1338     if (buf[0] &lt; 0x80) len = 1;
1339     else if ((buf[0] &amp; 0xE0) == 0xC0) len = 2;
1340     else if ((buf[0] &amp; 0xF0) == 0xE0) len = 3;
1341     else if ((buf[0] &amp; 0xF8) == 0xF0) len = 4;
1342     else if ((buf[0] &amp; 0xFC) == 0xF8) len = 5;
1343     else if ((buf[0] &amp; 0xFE) == 0xFC) len = 6;
1344 
1345     if (len == 0)
1346         return seterror(EILSEQ);
1347     else if (bufsize &lt; len)
1348         return seterror(EINVAL);
1349     return len;
1350 }
</pre>
</td>
</tr>
</table>
<center><a href="libcharset/localcharset.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../gmodule/gmodule-dl.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>