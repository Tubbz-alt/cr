<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/gst/gstbus.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gstbufferpool.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gstcaps.c.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/gst/gstbus.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 127,11 ***</span>
    GstPoll *poll;
    GPollFD pollfd;
  };
  
  #define gst_bus_parent_class parent_class
<span class="line-modified">! G_DEFINE_TYPE (GstBus, gst_bus, GST_TYPE_OBJECT);</span>
  
  static void
  gst_bus_set_property (GObject * object,
      guint prop_id, const GValue * value, GParamSpec * pspec)
  {
<span class="line-new-header">--- 127,11 ---</span>
    GstPoll *poll;
    GPollFD pollfd;
  };
  
  #define gst_bus_parent_class parent_class
<span class="line-modified">! G_DEFINE_TYPE_WITH_PRIVATE (GstBus, gst_bus, GST_TYPE_OBJECT);</span>
  
  static void
  gst_bus_set_property (GObject * object,
      guint prop_id, const GValue * value, GParamSpec * pspec)
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 215,18 ***</span>
    gst_bus_signals[ASYNC_MESSAGE] =
        g_signal_new (&quot;message&quot;, G_TYPE_FROM_CLASS (klass),
        G_SIGNAL_RUN_LAST | G_SIGNAL_DETAILED,
        G_STRUCT_OFFSET (GstBusClass, message), NULL, NULL,
        g_cclosure_marshal_generic, G_TYPE_NONE, 1, GST_TYPE_MESSAGE);
<span class="line-removed">- </span>
<span class="line-removed">-   g_type_class_add_private (klass, sizeof (GstBusPrivate));</span>
  }
  
  static void
  gst_bus_init (GstBus * bus)
  {
<span class="line-modified">!   bus-&gt;priv = G_TYPE_INSTANCE_GET_PRIVATE (bus, GST_TYPE_BUS, GstBusPrivate);</span>
    bus-&gt;priv-&gt;enable_async = DEFAULT_ENABLE_ASYNC;
    g_mutex_init (&amp;bus-&gt;priv-&gt;queue_lock);
    bus-&gt;priv-&gt;queue = gst_atomic_queue_new (32);
  
    GST_DEBUG_OBJECT (bus, &quot;created&quot;);
<span class="line-new-header">--- 215,16 ---</span>
    gst_bus_signals[ASYNC_MESSAGE] =
        g_signal_new (&quot;message&quot;, G_TYPE_FROM_CLASS (klass),
        G_SIGNAL_RUN_LAST | G_SIGNAL_DETAILED,
        G_STRUCT_OFFSET (GstBusClass, message), NULL, NULL,
        g_cclosure_marshal_generic, G_TYPE_NONE, 1, GST_TYPE_MESSAGE);
  }
  
  static void
  gst_bus_init (GstBus * bus)
  {
<span class="line-modified">!   bus-&gt;priv = gst_bus_get_instance_private (bus);</span>
    bus-&gt;priv-&gt;enable_async = DEFAULT_ENABLE_ASYNC;
    g_mutex_init (&amp;bus-&gt;priv-&gt;queue_lock);
    bus-&gt;priv-&gt;queue = gst_atomic_queue_new (32);
  
    GST_DEBUG_OBJECT (bus, &quot;created&quot;);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 762,11 ***</span>
  }
  
  /**
   * gst_bus_get_pollfd:
   * @bus: A #GstBus
<span class="line-modified">!  * @fd: A GPollFD to fill</span>
   *
   * Gets the file descriptor from the bus which can be used to get notified about
   * messages being available with functions like g_poll(), and allows integration
   * into other event loops based on file descriptors.
   * Whenever a message is available, the POLLIN / %G_IO_IN event is set.
<span class="line-new-header">--- 760,11 ---</span>
  }
  
  /**
   * gst_bus_get_pollfd:
   * @bus: A #GstBus
<span class="line-modified">!  * @fd: (out): A GPollFD to fill</span>
   *
   * Gets the file descriptor from the bus which can be used to get notified about
   * messages being available with functions like g_poll(), and allows integration
   * into other event loops based on file descriptors.
   * Whenever a message is available, the POLLIN / %G_IO_IN event is set.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1044,30 ***</span>
   *
   */
  gboolean
  gst_bus_remove_watch (GstBus * bus)
  {
<span class="line-modified">!   GSource *watch_id;</span>
  
    g_return_val_if_fail (GST_IS_BUS (bus), FALSE);
  
    GST_OBJECT_LOCK (bus);
  
    if (bus-&gt;priv-&gt;signal_watch == NULL) {
      GST_ERROR_OBJECT (bus, &quot;no bus watch was present&quot;);
<span class="line-modified">!     goto no_watch;</span>
    }
  
<span class="line-modified">!   watch_id = bus-&gt;priv-&gt;signal_watch;</span>
  
    GST_OBJECT_UNLOCK (bus);
  
<span class="line-modified">!   g_source_destroy (watch_id);</span>
  
    return TRUE;
  
<span class="line-modified">! no_watch:</span>
    GST_OBJECT_UNLOCK (bus);
  
    return FALSE;
  }
  
<span class="line-new-header">--- 1042,40 ---</span>
   *
   */
  gboolean
  gst_bus_remove_watch (GstBus * bus)
  {
<span class="line-modified">!   GSource *source;</span>
  
    g_return_val_if_fail (GST_IS_BUS (bus), FALSE);
  
    GST_OBJECT_LOCK (bus);
  
    if (bus-&gt;priv-&gt;signal_watch == NULL) {
      GST_ERROR_OBJECT (bus, &quot;no bus watch was present&quot;);
<span class="line-modified">!     goto error;</span>
    }
  
<span class="line-modified">!   if (bus-&gt;priv-&gt;num_signal_watchers &gt; 0) {</span>
<span class="line-added">+     GST_ERROR_OBJECT (bus,</span>
<span class="line-added">+         &quot;trying to remove signal watch with gst_bus_remove_watch()&quot;);</span>
<span class="line-added">+     goto error;</span>
<span class="line-added">+   }</span>
<span class="line-added">+ </span>
<span class="line-added">+   source =</span>
<span class="line-added">+       bus-&gt;priv-&gt;signal_watch ? g_source_ref (bus-&gt;priv-&gt;signal_watch) : NULL;</span>
  
    GST_OBJECT_UNLOCK (bus);
  
<span class="line-modified">!   if (source) {</span>
<span class="line-added">+     g_source_destroy (source);</span>
<span class="line-added">+     g_source_unref (source);</span>
<span class="line-added">+   }</span>
  
    return TRUE;
  
<span class="line-modified">! error:</span>
    GST_OBJECT_UNLOCK (bus);
  
    return FALSE;
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1377,11 ***</span>
      goto done;
  
    /* this should not fail because the counter above takes care of it */
    g_assert (!bus-&gt;priv-&gt;signal_watch);
  
<span class="line-modified">!       gst_bus_add_watch_full_unlocked (bus, priority, gst_bus_async_signal_func,</span>
        NULL, NULL);
  
    if (G_UNLIKELY (!bus-&gt;priv-&gt;signal_watch))
      goto add_failed;
  
<span class="line-new-header">--- 1385,11 ---</span>
      goto done;
  
    /* this should not fail because the counter above takes care of it */
    g_assert (!bus-&gt;priv-&gt;signal_watch);
  
<span class="line-modified">!   gst_bus_add_watch_full_unlocked (bus, priority, gst_bus_async_signal_func,</span>
        NULL, NULL);
  
    if (G_UNLIKELY (!bus-&gt;priv-&gt;signal_watch))
      goto add_failed;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1453,17 ***</span>
      goto done;
  
    GST_DEBUG_OBJECT (bus, &quot;removing signal watch %u&quot;,
        g_source_get_id (bus-&gt;priv-&gt;signal_watch));
  
<span class="line-modified">!   source = bus-&gt;priv-&gt;signal_watch;</span>
  
  done:
    GST_OBJECT_UNLOCK (bus);
  
<span class="line-modified">!   if (source)</span>
      g_source_destroy (source);
  
    return;
  
    /* ERRORS */
  error:
<span class="line-new-header">--- 1461,20 ---</span>
      goto done;
  
    GST_DEBUG_OBJECT (bus, &quot;removing signal watch %u&quot;,
        g_source_get_id (bus-&gt;priv-&gt;signal_watch));
  
<span class="line-modified">!   source =</span>
<span class="line-added">+       bus-&gt;priv-&gt;signal_watch ? g_source_ref (bus-&gt;priv-&gt;signal_watch) : NULL;</span>
  
  done:
    GST_OBJECT_UNLOCK (bus);
  
<span class="line-modified">!   if (source) {</span>
      g_source_destroy (source);
<span class="line-added">+     g_source_unref (source);</span>
<span class="line-added">+   }</span>
  
    return;
  
    /* ERRORS */
  error:
</pre>
<center><a href="gstbufferpool.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gstcaps.c.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>