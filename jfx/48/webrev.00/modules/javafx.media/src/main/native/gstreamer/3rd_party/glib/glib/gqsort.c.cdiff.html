<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gqsort.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gprintfint.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gqsort.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gqsort.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 87,103 ***</span>
  
    switch (p-&gt;var)
      {
      case 0:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!     {</span>
<span class="line-modified">!       if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *(guint32 *) tmp = *(guint32 *) b1;</span>
<span class="line-modified">!           b1 += sizeof (guint32);</span>
<span class="line-modified">!           --n1;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *(guint32 *) tmp = *(guint32 *) b2;</span>
<span class="line-modified">!           b2 += sizeof (guint32);</span>
<span class="line-modified">!           --n2;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       tmp += sizeof (guint32);</span>
<span class="line-modified">!     }</span>
        break;
      case 1:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!     {</span>
<span class="line-modified">!       if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *(guint64 *) tmp = *(guint64 *) b1;</span>
<span class="line-modified">!           b1 += sizeof (guint64);</span>
<span class="line-modified">!           --n1;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *(guint64 *) tmp = *(guint64 *) b2;</span>
<span class="line-modified">!           b2 += sizeof (guint64);</span>
<span class="line-modified">!           --n2;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       tmp += sizeof (guint64);</span>
<span class="line-modified">!     }</span>
        break;
      case 2:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!     {</span>
<span class="line-modified">!       unsigned long *tmpl = (unsigned long *) tmp;</span>
<span class="line-modified">!       unsigned long *bl;</span>
  
<span class="line-modified">!       tmp += s;</span>
<span class="line-modified">!       if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           bl = (unsigned long *) b1;</span>
<span class="line-modified">!           b1 += s;</span>
<span class="line-modified">!           --n1;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           bl = (unsigned long *) b2;</span>
<span class="line-modified">!           b2 += s;</span>
<span class="line-modified">!           --n2;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       while (tmpl &lt; (unsigned long *) tmp)</span>
<span class="line-modified">!         *tmpl++ = *bl++;</span>
<span class="line-modified">!     }</span>
        break;
      case 3:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!     {</span>
<span class="line-modified">!       if ((*cmp) (*(const void **) b1, *(const void **) b2, arg) &lt;= 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *(void **) tmp = *(void **) b1;</span>
<span class="line-modified">!           b1 += sizeof (void *);</span>
<span class="line-modified">!           --n1;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           *(void **) tmp = *(void **) b2;</span>
<span class="line-modified">!           b2 += sizeof (void *);</span>
<span class="line-modified">!           --n2;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       tmp += sizeof (void *);</span>
<span class="line-modified">!     }</span>
        break;
      default:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!     {</span>
<span class="line-modified">!       if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           memcpy (tmp, b1, s);</span>
<span class="line-modified">!           tmp += s;</span>
<span class="line-modified">!           b1 += s;</span>
<span class="line-modified">!           --n1;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       else</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!           memcpy (tmp, b2, s);</span>
<span class="line-modified">!           tmp += s;</span>
<span class="line-modified">!           b2 += s;</span>
<span class="line-modified">!           --n2;</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!     }</span>
        break;
      }
  
    if (n1 &gt; 0)
      memcpy (tmp, b1, n1 * s);
<span class="line-new-header">--- 87,103 ---</span>
  
    switch (p-&gt;var)
      {
      case 0:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!   {</span>
<span class="line-modified">!     if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *(guint32 *) tmp = *(guint32 *) b1;</span>
<span class="line-modified">!         b1 += sizeof (guint32);</span>
<span class="line-modified">!         --n1;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *(guint32 *) tmp = *(guint32 *) b2;</span>
<span class="line-modified">!         b2 += sizeof (guint32);</span>
<span class="line-modified">!         --n2;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     tmp += sizeof (guint32);</span>
<span class="line-modified">!   }</span>
        break;
      case 1:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!   {</span>
<span class="line-modified">!     if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *(guint64 *) tmp = *(guint64 *) b1;</span>
<span class="line-modified">!         b1 += sizeof (guint64);</span>
<span class="line-modified">!         --n1;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *(guint64 *) tmp = *(guint64 *) b2;</span>
<span class="line-modified">!         b2 += sizeof (guint64);</span>
<span class="line-modified">!         --n2;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     tmp += sizeof (guint64);</span>
<span class="line-modified">!   }</span>
        break;
      case 2:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!   {</span>
<span class="line-modified">!     unsigned long *tmpl = (unsigned long *) tmp;</span>
<span class="line-modified">!     unsigned long *bl;</span>
  
<span class="line-modified">!     tmp += s;</span>
<span class="line-modified">!     if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         bl = (unsigned long *) b1;</span>
<span class="line-modified">!         b1 += s;</span>
<span class="line-modified">!         --n1;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         bl = (unsigned long *) b2;</span>
<span class="line-modified">!         b2 += s;</span>
<span class="line-modified">!         --n2;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     while (tmpl &lt; (unsigned long *) tmp)</span>
<span class="line-modified">!       *tmpl++ = *bl++;</span>
<span class="line-modified">!   }</span>
        break;
      case 3:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!   {</span>
<span class="line-modified">!     if ((*cmp) (*(const void **) b1, *(const void **) b2, arg) &lt;= 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *(void **) tmp = *(void **) b1;</span>
<span class="line-modified">!         b1 += sizeof (void *);</span>
<span class="line-modified">!         --n1;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         *(void **) tmp = *(void **) b2;</span>
<span class="line-modified">!         b2 += sizeof (void *);</span>
<span class="line-modified">!         --n2;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     tmp += sizeof (void *);</span>
<span class="line-modified">!   }</span>
        break;
      default:
        while (n1 &gt; 0 &amp;&amp; n2 &gt; 0)
<span class="line-modified">!   {</span>
<span class="line-modified">!     if ((*cmp) (b1, b2, arg) &lt;= 0)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         memcpy (tmp, b1, s);</span>
<span class="line-modified">!         tmp += s;</span>
<span class="line-modified">!         b1 += s;</span>
<span class="line-modified">!         --n1;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         memcpy (tmp, b2, s);</span>
<span class="line-modified">!         tmp += s;</span>
<span class="line-modified">!         b2 += s;</span>
<span class="line-modified">!         --n2;</span>
<span class="line-modified">!       }</span>
<span class="line-modified">!   }</span>
        break;
      }
  
    if (n1 &gt; 0)
      memcpy (tmp, b1, n1 * s);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 226,57 ***</span>
        void *tmp_storage = (void *) (tp + n);
        char *kp;
        size_t i;
  
        while ((void *) t &lt; tmp_storage)
<span class="line-modified">!     {</span>
<span class="line-modified">!       *t++ = ip;</span>
<span class="line-modified">!       ip += s;</span>
<span class="line-modified">!     }</span>
        p.s = sizeof (void *);
        p.var = 3;
        msort_with_tmp (&amp;p, p.t + n * sizeof (void *), n);
  
        /* tp[0] .. tp[n - 1] is now sorted, copy around entries of
<span class="line-modified">!      the original array.  Knuth vol. 3 (2nd ed.) exercise 5.2-10.  */</span>
        for (i = 0, ip = (char *) b; i &lt; n; i++, ip += s)
<span class="line-modified">!     if ((kp = tp[i]) != ip)</span>
<span class="line-modified">!       {</span>
<span class="line-modified">!         size_t j = i;</span>
<span class="line-modified">!         char *jp = ip;</span>
<span class="line-modified">!         memcpy (tmp_storage, ip, s);</span>
  
<span class="line-modified">!         do</span>
<span class="line-modified">!           {</span>
<span class="line-modified">!         size_t k = (kp - (char *) b) / s;</span>
<span class="line-modified">!         tp[j] = jp;</span>
<span class="line-modified">!         memcpy (jp, kp, s);</span>
<span class="line-modified">!         j = k;</span>
<span class="line-modified">!         jp = kp;</span>
<span class="line-modified">!         kp = tp[k];</span>
<span class="line-modified">!           }</span>
<span class="line-modified">!         while (kp != ip);</span>
  
<span class="line-modified">!         tp[j] = jp;</span>
<span class="line-modified">!         memcpy (jp, tmp_storage, s);</span>
<span class="line-modified">!       }</span>
      }
    else
      {
        if ((s &amp; (sizeof (guint32) - 1)) == 0
<span class="line-modified">!       &amp;&amp; ((char *) b - (char *) 0) % ALIGNOF_GUINT32 == 0)</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       if (s == sizeof (guint32))</span>
<span class="line-modified">!         p.var = 0;</span>
<span class="line-modified">!       else if (s == sizeof (guint64)</span>
<span class="line-modified">!            &amp;&amp; ((char *) b - (char *) 0) % ALIGNOF_GUINT64 == 0)</span>
<span class="line-modified">!         p.var = 1;</span>
<span class="line-modified">!       else if ((s &amp; (sizeof (unsigned long) - 1)) == 0</span>
<span class="line-modified">!            &amp;&amp; ((char *) b - (char *) 0)</span>
<span class="line-modified">!               % ALIGNOF_UNSIGNED_LONG == 0)</span>
<span class="line-modified">!         p.var = 2;</span>
<span class="line-modified">!     }</span>
        msort_with_tmp (&amp;p, b, n);
      }
    g_free (tmp);
  }
  
<span class="line-new-header">--- 226,57 ---</span>
        void *tmp_storage = (void *) (tp + n);
        char *kp;
        size_t i;
  
        while ((void *) t &lt; tmp_storage)
<span class="line-modified">!   {</span>
<span class="line-modified">!     *t++ = ip;</span>
<span class="line-modified">!     ip += s;</span>
<span class="line-modified">!   }</span>
        p.s = sizeof (void *);
        p.var = 3;
        msort_with_tmp (&amp;p, p.t + n * sizeof (void *), n);
  
        /* tp[0] .. tp[n - 1] is now sorted, copy around entries of
<span class="line-modified">!    the original array.  Knuth vol. 3 (2nd ed.) exercise 5.2-10.  */</span>
        for (i = 0, ip = (char *) b; i &lt; n; i++, ip += s)
<span class="line-modified">!   if ((kp = tp[i]) != ip)</span>
<span class="line-modified">!     {</span>
<span class="line-modified">!       size_t j = i;</span>
<span class="line-modified">!       char *jp = ip;</span>
<span class="line-modified">!       memcpy (tmp_storage, ip, s);</span>
  
<span class="line-modified">!       do</span>
<span class="line-modified">!         {</span>
<span class="line-modified">!     size_t k = (kp - (char *) b) / s;</span>
<span class="line-modified">!     tp[j] = jp;</span>
<span class="line-modified">!     memcpy (jp, kp, s);</span>
<span class="line-modified">!     j = k;</span>
<span class="line-modified">!     jp = kp;</span>
<span class="line-modified">!     kp = tp[k];</span>
<span class="line-modified">!         }</span>
<span class="line-modified">!       while (kp != ip);</span>
  
<span class="line-modified">!       tp[j] = jp;</span>
<span class="line-modified">!       memcpy (jp, tmp_storage, s);</span>
<span class="line-modified">!     }</span>
      }
    else
      {
        if ((s &amp; (sizeof (guint32) - 1)) == 0
<span class="line-modified">!     &amp;&amp; ((char *) b - (char *) 0) % ALIGNOF_GUINT32 == 0)</span>
<span class="line-modified">!   {</span>
<span class="line-modified">!     if (s == sizeof (guint32))</span>
<span class="line-modified">!       p.var = 0;</span>
<span class="line-modified">!     else if (s == sizeof (guint64)</span>
<span class="line-modified">!        &amp;&amp; ((char *) b - (char *) 0) % ALIGNOF_GUINT64 == 0)</span>
<span class="line-modified">!       p.var = 1;</span>
<span class="line-modified">!     else if ((s &amp; (sizeof (unsigned long) - 1)) == 0</span>
<span class="line-modified">!        &amp;&amp; ((char *) b - (char *) 0)</span>
<span class="line-modified">!           % ALIGNOF_UNSIGNED_LONG == 0)</span>
<span class="line-modified">!       p.var = 2;</span>
<span class="line-modified">!   }</span>
        msort_with_tmp (&amp;p, b, n);
      }
    g_free (tmp);
  }
  
</pre>
<center><a href="gprintfint.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gqsort.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>