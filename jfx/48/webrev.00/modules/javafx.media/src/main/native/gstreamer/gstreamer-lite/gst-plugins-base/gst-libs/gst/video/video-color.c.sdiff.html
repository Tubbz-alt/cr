<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/video-color.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="video-chroma.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="video-color.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/video-color.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 46   }
 47 
 48   return (GstDebugCategory *) cat_gonce;
 49 }
 50 #else
 51 #define ensure_debug_category() /* NOOP */
 52 #endif /* GST_DISABLE_GST_DEBUG */
 53 
 54 typedef struct
 55 {
 56   const gchar *name;
 57   GstVideoColorimetry color;
 58 } ColorimetryInfo;
 59 
 60 #define MAKE_COLORIMETRY(n,r,m,t,p) { GST_VIDEO_COLORIMETRY_ ##n, \
 61   { GST_VIDEO_COLOR_RANGE ##r, GST_VIDEO_COLOR_MATRIX_ ##m, \
 62   GST_VIDEO_TRANSFER_ ##t, GST_VIDEO_COLOR_PRIMARIES_ ##p } }
 63 
 64 #define GST_VIDEO_COLORIMETRY_NONAME  NULL
 65 
<span class="line-removed"> 66 #define DEFAULT_YUV_SD  0</span>
<span class="line-removed"> 67 #define DEFAULT_YUV_HD  1</span>
<span class="line-removed"> 68 #define DEFAULT_RGB     3</span>
<span class="line-removed"> 69 #define DEFAULT_YUV_UHD 4</span>
<span class="line-removed"> 70 #define DEFAULT_GRAY    5</span>
<span class="line-removed"> 71 #define DEFAULT_UNKNOWN 6</span>
<span class="line-removed"> 72 </span>
 73 static const ColorimetryInfo colorimetry[] = {
 74   MAKE_COLORIMETRY (BT601, _16_235, BT601, BT709, SMPTE170M),
 75   MAKE_COLORIMETRY (BT709, _16_235, BT709, BT709, BT709),
 76   MAKE_COLORIMETRY (SMPTE240M, _16_235, SMPTE240M, SMPTE240M, SMPTE240M),
 77   MAKE_COLORIMETRY (SRGB, _0_255, RGB, SRGB, BT709),
 78   MAKE_COLORIMETRY (BT2020, _16_235, BT2020, BT2020_12, BT2020),
 79   MAKE_COLORIMETRY (NONAME, _0_255, BT601, UNKNOWN, UNKNOWN),
<span class="line-modified"> 80   MAKE_COLORIMETRY (NONAME, _UNKNOWN, UNKNOWN, UNKNOWN, UNKNOWN),</span>
 81 };
 82 


 83 static const ColorimetryInfo *
 84 gst_video_get_colorimetry (const gchar * s)
 85 {
 86   gint i;
 87 
 88   for (i = 0; colorimetry[i].name; i++) {
 89     if (g_str_equal (colorimetry[i].name, s))
 90       return &amp;colorimetry[i];
 91   }
 92   return NULL;
 93 }
 94 
 95 #define CI_IS_EQUAL(ci,i) (((ci)-&gt;range == (i)-&gt;range) &amp;&amp; \
 96                         ((ci)-&gt;matrix == (i)-&gt;matrix) &amp;&amp; \
 97                         ((ci)-&gt;transfer == (i)-&gt;transfer) &amp;&amp; \
 98                         ((ci)-&gt;primaries == (i)-&gt;primaries))
 99 
100 #define IS_EQUAL(ci,i) CI_IS_EQUAL(&amp;(ci)-&gt;color, (i))
101 
102 #define IS_UNKNOWN(ci) (IS_EQUAL (&amp;colorimetry[DEFAULT_UNKNOWN], ci))
103 
104 /**
105  * gst_video_colorimetry_from_string:
106  * @cinfo: a #GstVideoColorimetry
107  * @color: a colorimetry string
108  *
109  * Parse the colorimetry string and update @cinfo with the parsed
110  * values.
111  *
112  * Returns: %TRUE if @color points to valid colorimetry info.
113  */
114 gboolean
115 gst_video_colorimetry_from_string (GstVideoColorimetry * cinfo,
116     const gchar * color)
117 {
118   const ColorimetryInfo *ci;
119   gboolean res = FALSE;
120 
<span class="line-modified">121   if ((ci = gst_video_get_colorimetry (color))) {</span>



122     *cinfo = ci-&gt;color;
123     res = TRUE;
124   } else {
125     gint r, m, t, p;
126 
127     if (sscanf (color, &quot;%d:%d:%d:%d&quot;, &amp;r, &amp;m, &amp;t, &amp;p) == 4) {
128       cinfo-&gt;range = r;
129       cinfo-&gt;matrix = m;
130       cinfo-&gt;transfer = t;
131       cinfo-&gt;primaries = p;
132       res = TRUE;
133     }
134   }
135   return res;
136 }
137 
138 /**
139  * gst_video_colorimetry_to_string:
140  * @cinfo: a #GstVideoColorimetry
141  *
</pre>
<hr />
<pre>
252  * @other: another #GstVideoColorimetry
253  *
254  * Compare the 2 colorimetry sets for equality
255  *
256  * Returns: %TRUE if @cinfo and @other are equal.
257  *
258  * Since: 1.6
259  */
260 gboolean
261 gst_video_colorimetry_is_equal (const GstVideoColorimetry * cinfo,
262     const GstVideoColorimetry * other)
263 {
264   g_return_val_if_fail (cinfo != NULL, FALSE);
265   g_return_val_if_fail (other != NULL, FALSE);
266 
267   return CI_IS_EQUAL (cinfo, other);
268 }
269 
270 #define WP_C    0.31006, 0.31616
271 #define WP_D65  0.31271, 0.32902


272 
273 static const GstVideoColorPrimariesInfo color_primaries[] = {
274   {GST_VIDEO_COLOR_PRIMARIES_UNKNOWN, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
275   {GST_VIDEO_COLOR_PRIMARIES_BT709, WP_D65, 0.64, 0.33, 0.30, 0.60, 0.15, 0.06},
276   {GST_VIDEO_COLOR_PRIMARIES_BT470M, WP_C, 0.67, 0.33, 0.21, 0.71, 0.14, 0.08},
277   {GST_VIDEO_COLOR_PRIMARIES_BT470BG, WP_D65, 0.64, 0.33, 0.29, 0.60, 0.15,
278       0.06},
279   {GST_VIDEO_COLOR_PRIMARIES_SMPTE170M, WP_D65, 0.63, 0.34, 0.31, 0.595, 0.155,
280       0.07},
281   {GST_VIDEO_COLOR_PRIMARIES_SMPTE240M, WP_D65, 0.63, 0.34, 0.31, 0.595, 0.155,
282       0.07},
283   {GST_VIDEO_COLOR_PRIMARIES_FILM, WP_C, 0.681, 0.319, 0.243, 0.692, 0.145,
284       0.049},
285   {GST_VIDEO_COLOR_PRIMARIES_BT2020, WP_D65, 0.708, 0.292, 0.170, 0.797, 0.131,
286       0.046},
287   {GST_VIDEO_COLOR_PRIMARIES_ADOBERGB, WP_D65, 0.64, 0.33, 0.21, 0.71, 0.15,
<span class="line-modified">288       0.06}</span>








289 };
290 
291 /**
292  * gst_video_color_primaries_get_info:
293  * @primaries: a #GstVideoColorPrimaries
294  *
295  * Get information about the chromaticity coordinates of @primaries.
296  *
297  * Returns: a #GstVideoColorPrimariesInfo for @primaries.
298  *
299  * Since: 1.6
300  */
301 const GstVideoColorPrimariesInfo *
302 gst_video_color_primaries_get_info (GstVideoColorPrimaries primaries)
303 {
304   g_return_val_if_fail ((gint) primaries &lt;
305       G_N_ELEMENTS (color_primaries), NULL);
306 
307   return &amp;color_primaries[primaries];
308 }
</pre>
</td>
<td>
<hr />
<pre>
 46   }
 47 
 48   return (GstDebugCategory *) cat_gonce;
 49 }
 50 #else
 51 #define ensure_debug_category() /* NOOP */
 52 #endif /* GST_DISABLE_GST_DEBUG */
 53 
 54 typedef struct
 55 {
 56   const gchar *name;
 57   GstVideoColorimetry color;
 58 } ColorimetryInfo;
 59 
 60 #define MAKE_COLORIMETRY(n,r,m,t,p) { GST_VIDEO_COLORIMETRY_ ##n, \
 61   { GST_VIDEO_COLOR_RANGE ##r, GST_VIDEO_COLOR_MATRIX_ ##m, \
 62   GST_VIDEO_TRANSFER_ ##t, GST_VIDEO_COLOR_PRIMARIES_ ##p } }
 63 
 64 #define GST_VIDEO_COLORIMETRY_NONAME  NULL
 65 







 66 static const ColorimetryInfo colorimetry[] = {
 67   MAKE_COLORIMETRY (BT601, _16_235, BT601, BT709, SMPTE170M),
 68   MAKE_COLORIMETRY (BT709, _16_235, BT709, BT709, BT709),
 69   MAKE_COLORIMETRY (SMPTE240M, _16_235, SMPTE240M, SMPTE240M, SMPTE240M),
 70   MAKE_COLORIMETRY (SRGB, _0_255, RGB, SRGB, BT709),
 71   MAKE_COLORIMETRY (BT2020, _16_235, BT2020, BT2020_12, BT2020),
 72   MAKE_COLORIMETRY (NONAME, _0_255, BT601, UNKNOWN, UNKNOWN),
<span class="line-modified"> 73   MAKE_COLORIMETRY (NONAME, _UNKNOWN, UNKNOWN, UNKNOWN, UNKNOWN),       /* Keep last! */</span>
 74 };
 75 
<span class="line-added"> 76 #define DEFAULT_UNKNOWN (G_N_ELEMENTS(colorimetry)-1)</span>
<span class="line-added"> 77 </span>
 78 static const ColorimetryInfo *
 79 gst_video_get_colorimetry (const gchar * s)
 80 {
 81   gint i;
 82 
 83   for (i = 0; colorimetry[i].name; i++) {
 84     if (g_str_equal (colorimetry[i].name, s))
 85       return &amp;colorimetry[i];
 86   }
 87   return NULL;
 88 }
 89 
 90 #define CI_IS_EQUAL(ci,i) (((ci)-&gt;range == (i)-&gt;range) &amp;&amp; \
 91                         ((ci)-&gt;matrix == (i)-&gt;matrix) &amp;&amp; \
 92                         ((ci)-&gt;transfer == (i)-&gt;transfer) &amp;&amp; \
 93                         ((ci)-&gt;primaries == (i)-&gt;primaries))
 94 
 95 #define IS_EQUAL(ci,i) CI_IS_EQUAL(&amp;(ci)-&gt;color, (i))
 96 
 97 #define IS_UNKNOWN(ci) (IS_EQUAL (&amp;colorimetry[DEFAULT_UNKNOWN], ci))
 98 
 99 /**
100  * gst_video_colorimetry_from_string:
101  * @cinfo: a #GstVideoColorimetry
102  * @color: a colorimetry string
103  *
104  * Parse the colorimetry string and update @cinfo with the parsed
105  * values.
106  *
107  * Returns: %TRUE if @color points to valid colorimetry info.
108  */
109 gboolean
110 gst_video_colorimetry_from_string (GstVideoColorimetry * cinfo,
111     const gchar * color)
112 {
113   const ColorimetryInfo *ci;
114   gboolean res = FALSE;
115 
<span class="line-modified">116   if (!color) {</span>
<span class="line-added">117     *cinfo = colorimetry[DEFAULT_UNKNOWN].color;</span>
<span class="line-added">118     res = TRUE;</span>
<span class="line-added">119   } else if ((ci = gst_video_get_colorimetry (color))) {</span>
120     *cinfo = ci-&gt;color;
121     res = TRUE;
122   } else {
123     gint r, m, t, p;
124 
125     if (sscanf (color, &quot;%d:%d:%d:%d&quot;, &amp;r, &amp;m, &amp;t, &amp;p) == 4) {
126       cinfo-&gt;range = r;
127       cinfo-&gt;matrix = m;
128       cinfo-&gt;transfer = t;
129       cinfo-&gt;primaries = p;
130       res = TRUE;
131     }
132   }
133   return res;
134 }
135 
136 /**
137  * gst_video_colorimetry_to_string:
138  * @cinfo: a #GstVideoColorimetry
139  *
</pre>
<hr />
<pre>
250  * @other: another #GstVideoColorimetry
251  *
252  * Compare the 2 colorimetry sets for equality
253  *
254  * Returns: %TRUE if @cinfo and @other are equal.
255  *
256  * Since: 1.6
257  */
258 gboolean
259 gst_video_colorimetry_is_equal (const GstVideoColorimetry * cinfo,
260     const GstVideoColorimetry * other)
261 {
262   g_return_val_if_fail (cinfo != NULL, FALSE);
263   g_return_val_if_fail (other != NULL, FALSE);
264 
265   return CI_IS_EQUAL (cinfo, other);
266 }
267 
268 #define WP_C    0.31006, 0.31616
269 #define WP_D65  0.31271, 0.32902
<span class="line-added">270 #define WP_CENTRE (1/3), (1/3)</span>
<span class="line-added">271 #define WP_WHITE 0.314, 0.351</span>
272 
273 static const GstVideoColorPrimariesInfo color_primaries[] = {
274   {GST_VIDEO_COLOR_PRIMARIES_UNKNOWN, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
275   {GST_VIDEO_COLOR_PRIMARIES_BT709, WP_D65, 0.64, 0.33, 0.30, 0.60, 0.15, 0.06},
276   {GST_VIDEO_COLOR_PRIMARIES_BT470M, WP_C, 0.67, 0.33, 0.21, 0.71, 0.14, 0.08},
277   {GST_VIDEO_COLOR_PRIMARIES_BT470BG, WP_D65, 0.64, 0.33, 0.29, 0.60, 0.15,
278       0.06},
279   {GST_VIDEO_COLOR_PRIMARIES_SMPTE170M, WP_D65, 0.63, 0.34, 0.31, 0.595, 0.155,
280       0.07},
281   {GST_VIDEO_COLOR_PRIMARIES_SMPTE240M, WP_D65, 0.63, 0.34, 0.31, 0.595, 0.155,
282       0.07},
283   {GST_VIDEO_COLOR_PRIMARIES_FILM, WP_C, 0.681, 0.319, 0.243, 0.692, 0.145,
284       0.049},
285   {GST_VIDEO_COLOR_PRIMARIES_BT2020, WP_D65, 0.708, 0.292, 0.170, 0.797, 0.131,
286       0.046},
287   {GST_VIDEO_COLOR_PRIMARIES_ADOBERGB, WP_D65, 0.64, 0.33, 0.21, 0.71, 0.15,
<span class="line-modified">288       0.06},</span>
<span class="line-added">289   {GST_VIDEO_COLOR_PRIMARIES_SMPTEST428, WP_CENTRE, 1.0, 0.0, 0.0, 1.0, 0.0,</span>
<span class="line-added">290       0.0},</span>
<span class="line-added">291   {GST_VIDEO_COLOR_PRIMARIES_SMPTERP431, WP_WHITE, 0.68, 0.32, 0.265, 0.69,</span>
<span class="line-added">292       0.15, 0.06},</span>
<span class="line-added">293   {GST_VIDEO_COLOR_PRIMARIES_SMPTEEG432, WP_D65, 0.68, 0.32, 0.265, 0.69, 0.15,</span>
<span class="line-added">294       0.06},</span>
<span class="line-added">295   {GST_VIDEO_COLOR_PRIMARIES_EBU3213, WP_D65, 0.63, 0.34, 0.295, 0.605, 0.155,</span>
<span class="line-added">296       0.077},</span>
297 };
298 
299 /**
300  * gst_video_color_primaries_get_info:
301  * @primaries: a #GstVideoColorPrimaries
302  *
303  * Get information about the chromaticity coordinates of @primaries.
304  *
305  * Returns: a #GstVideoColorPrimariesInfo for @primaries.
306  *
307  * Since: 1.6
308  */
309 const GstVideoColorPrimariesInfo *
310 gst_video_color_primaries_get_info (GstVideoColorPrimaries primaries)
311 {
312   g_return_val_if_fail ((gint) primaries &lt;
313       G_N_ELEMENTS (color_primaries), NULL);
314 
315   return &amp;color_primaries[primaries];
316 }
</pre>
</td>
</tr>
</table>
<center><a href="video-chroma.c.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="video-color.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>