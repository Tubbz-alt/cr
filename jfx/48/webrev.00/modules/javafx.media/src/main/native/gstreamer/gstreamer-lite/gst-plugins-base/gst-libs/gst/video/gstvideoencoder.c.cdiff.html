<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/gstvideoencoder.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gstvideodecoder.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="gstvideoencoder.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/gstvideoencoder.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 109,14 ***</span>
  #include &lt;string.h&gt;
  
  GST_DEBUG_CATEGORY (videoencoder_debug);
  #define GST_CAT_DEFAULT videoencoder_debug
  
<span class="line-removed">- #define GST_VIDEO_ENCODER_GET_PRIVATE(obj)  \</span>
<span class="line-removed">-     (G_TYPE_INSTANCE_GET_PRIVATE ((obj), GST_TYPE_VIDEO_ENCODER, \</span>
<span class="line-removed">-         GstVideoEncoderPrivate))</span>
<span class="line-removed">- </span>
  /* properties */
  
  #define DEFAULT_QOS                 FALSE
  
  enum
<span class="line-new-header">--- 109,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 209,10 ***</span>
<span class="line-new-header">--- 205,12 ---</span>
  
    return evt;
  }
  
  static GstElementClass *parent_class = NULL;
<span class="line-added">+ static gint private_offset = 0;</span>
<span class="line-added">+ </span>
  static void gst_video_encoder_class_init (GstVideoEncoderClass * klass);
  static void gst_video_encoder_init (GstVideoEncoder * enc,
      GstVideoEncoderClass * klass);
  
  static void gst_video_encoder_finalize (GObject * object);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 285,19 ***</span>
<span class="line-new-header">--- 283,27 ---</span>
      };
  #endif // GSTREAMER_LITE
  
      _type = g_type_register_static (GST_TYPE_ELEMENT,
          &quot;GstVideoEncoder&quot;, &amp;info, G_TYPE_FLAG_ABSTRACT);
<span class="line-added">+     private_offset =</span>
<span class="line-added">+         g_type_add_instance_private (_type, sizeof (GstVideoEncoderPrivate));</span>
  #ifndef GSTREAMER_LITE
      g_type_add_interface_static (_type, GST_TYPE_PRESET,
          &amp;preset_interface_info);
  #endif // GSTREAMER_LITE
      g_once_init_leave (&amp;type, _type);
    }
    return type;
  }
  
<span class="line-added">+ static inline GstVideoEncoderPrivate *</span>
<span class="line-added">+ gst_video_encoder_get_instance_private (GstVideoEncoder * self)</span>
<span class="line-added">+ {</span>
<span class="line-added">+   return (G_STRUCT_MEMBER_P (self, private_offset));</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  static void
  gst_video_encoder_set_property (GObject * object, guint prop_id,
      const GValue * value, GParamSpec * pspec)
  {
    GstVideoEncoder *sink = GST_VIDEO_ENCODER (object);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 340,11 ***</span>
    GST_DEBUG_CATEGORY_INIT (videoencoder_debug, &quot;videoencoder&quot;, 0,
        &quot;Base Video Encoder&quot;);
  
    parent_class = g_type_class_peek_parent (klass);
  
<span class="line-modified">!   g_type_class_add_private (klass, sizeof (GstVideoEncoderPrivate));</span>
  
    gobject_class-&gt;set_property = gst_video_encoder_set_property;
    gobject_class-&gt;get_property = gst_video_encoder_get_property;
    gobject_class-&gt;finalize = gst_video_encoder_finalize;
  
<span class="line-new-header">--- 346,12 ---</span>
    GST_DEBUG_CATEGORY_INIT (videoencoder_debug, &quot;videoencoder&quot;, 0,
        &quot;Base Video Encoder&quot;);
  
    parent_class = g_type_class_peek_parent (klass);
  
<span class="line-modified">!   if (private_offset != 0)</span>
<span class="line-added">+     g_type_class_adjust_private_offset (klass, &amp;private_offset);</span>
  
    gobject_class-&gt;set_property = gst_video_encoder_set_property;
    gobject_class-&gt;get_property = gst_video_encoder_get_property;
    gobject_class-&gt;finalize = gst_video_encoder_finalize;
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 493,11 ***</span>
    GstPadTemplate *pad_template;
    GstPad *pad;
  
    GST_DEBUG_OBJECT (encoder, &quot;gst_video_encoder_init&quot;);
  
<span class="line-modified">!   priv = encoder-&gt;priv = GST_VIDEO_ENCODER_GET_PRIVATE (encoder);</span>
  
    pad_template =
        gst_element_class_get_pad_template (GST_ELEMENT_CLASS (klass), &quot;sink&quot;);
    g_return_if_fail (pad_template != NULL);
  
<span class="line-new-header">--- 500,11 ---</span>
    GstPadTemplate *pad_template;
    GstPad *pad;
  
    GST_DEBUG_OBJECT (encoder, &quot;gst_video_encoder_init&quot;);
  
<span class="line-modified">!   priv = encoder-&gt;priv = gst_video_encoder_get_instance_private (encoder);</span>
  
    pad_template =
        gst_element_class_get_pad_template (GST_ELEMENT_CLASS (klass), &quot;sink&quot;);
    g_return_if_fail (pad_template != NULL);
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 941,10 ***</span>
<span class="line-new-header">--- 948,13 ---</span>
          break;
        }
  
        if (encoder-&gt;priv-&gt;time_adjustment != GST_CLOCK_TIME_NONE) {
          segment.start += encoder-&gt;priv-&gt;time_adjustment;
<span class="line-added">+         if (GST_CLOCK_TIME_IS_VALID (segment.position)) {</span>
<span class="line-added">+           segment.position += encoder-&gt;priv-&gt;time_adjustment;</span>
<span class="line-added">+         }</span>
          if (GST_CLOCK_TIME_IS_VALID (segment.stop)) {
            segment.stop += encoder-&gt;priv-&gt;time_adjustment;
          }
        }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2289,11 ***</span>
<span class="line-new-header">--- 2299,13 ---</span>
          GST_LOG_OBJECT (encoder, &quot;marking discont&quot;);
          GST_BUFFER_FLAG_SET (tmpbuf, GST_BUFFER_FLAG_DISCONT);
          discont = FALSE;
        }
  
<span class="line-added">+       GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);</span>
        gst_pad_push (encoder-&gt;srcpad, gst_buffer_ref (tmpbuf));
<span class="line-added">+       GST_VIDEO_ENCODER_STREAM_LOCK (encoder);</span>
      }
      priv-&gt;new_headers = FALSE;
    }
  
    if (G_UNLIKELY (discont)) {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2327,12 ***</span>
     * to the frame
     */
    gst_video_encoder_release_frame (encoder, frame);
    frame = NULL;
  
<span class="line-modified">!   if (ret == GST_FLOW_OK)</span>
      ret = gst_pad_push (encoder-&gt;srcpad, buffer);
  
  done:
    /* handed out */
    if (frame)
      gst_video_encoder_release_frame (encoder, frame);
<span class="line-new-header">--- 2339,15 ---</span>
     * to the frame
     */
    gst_video_encoder_release_frame (encoder, frame);
    frame = NULL;
  
<span class="line-modified">!   if (ret == GST_FLOW_OK) {</span>
<span class="line-added">+     GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);</span>
      ret = gst_pad_push (encoder-&gt;srcpad, buffer);
<span class="line-added">+     GST_VIDEO_ENCODER_STREAM_LOCK (encoder);</span>
<span class="line-added">+   }</span>
  
  done:
    /* handed out */
    if (frame)
      gst_video_encoder_release_frame (encoder, frame);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2498,11 ***</span>
    return (GstVideoCodecFrame *) frame;
  }
  
  /**
   * gst_video_encoder_get_frame:
<span class="line-modified">!  * @encoder: a #GstVideoEnccoder</span>
   * @frame_number: system_frame_number of a frame
   *
   * Get a pending unfinished #GstVideoCodecFrame
   *
   * Returns: (transfer full): pending unfinished #GstVideoCodecFrame identified by @frame_number.
<span class="line-new-header">--- 2513,11 ---</span>
    return (GstVideoCodecFrame *) frame;
  }
  
  /**
   * gst_video_encoder_get_frame:
<span class="line-modified">!  * @encoder: a #GstVideoEncoder</span>
   * @frame_number: system_frame_number of a frame
   *
   * Get a pending unfinished #GstVideoCodecFrame
   *
   * Returns: (transfer full): pending unfinished #GstVideoCodecFrame identified by @frame_number.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2597,11 ***</span>
   * gst_video_encoder_get_allocator:
   * @encoder: a #GstVideoEncoder
   * @allocator: (out) (allow-none) (transfer full): the #GstAllocator
   * used
   * @params: (out) (allow-none) (transfer full): the
<span class="line-modified">!  * #GstAllocatorParams of @allocator</span>
   *
   * Lets #GstVideoEncoder sub-classes to know the memory @allocator
   * used by the base class and its @params.
   *
   * Unref the @allocator after use it.
<span class="line-new-header">--- 2612,11 ---</span>
   * gst_video_encoder_get_allocator:
   * @encoder: a #GstVideoEncoder
   * @allocator: (out) (allow-none) (transfer full): the #GstAllocator
   * used
   * @params: (out) (allow-none) (transfer full): the
<span class="line-modified">!  * #GstAllocationParams of @allocator</span>
   *
   * Lets #GstVideoEncoder sub-classes to know the memory @allocator
   * used by the base class and its @params.
   *
   * Unref the @allocator after use it.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2628,11 ***</span>
   * Request minimal value for PTS passed to handle_frame.
   *
   * For streams with reordered frames this can be used to ensure that there
   * is enough time to accomodate first DTS, which may be less than first PTS
   *
<span class="line-modified">!  * Since 1.6</span>
   */
  void
  gst_video_encoder_set_min_pts (GstVideoEncoder * encoder, GstClockTime min_pts)
  {
    g_return_if_fail (GST_IS_VIDEO_ENCODER (encoder));
<span class="line-new-header">--- 2643,11 ---</span>
   * Request minimal value for PTS passed to handle_frame.
   *
   * For streams with reordered frames this can be used to ensure that there
   * is enough time to accomodate first DTS, which may be less than first PTS
   *
<span class="line-modified">!  * Since: 1.6</span>
   */
  void
  gst_video_encoder_set_min_pts (GstVideoEncoder * encoder, GstClockTime min_pts)
  {
    g_return_if_fail (GST_IS_VIDEO_ENCODER (encoder));
</pre>
<center><a href="gstvideodecoder.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="gstvideoencoder.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>