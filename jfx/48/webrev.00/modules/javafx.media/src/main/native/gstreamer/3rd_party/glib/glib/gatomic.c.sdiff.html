<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gatomic.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gasyncqueue.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gatomic.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/3rd_party/glib/glib/gatomic.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright ï¿½ 2011 Ryan Lortie</span>
  3  *
  4  * This library is free software; you can redistribute it and/or
  5  * modify it under the terms of the GNU Lesser General Public
  6  * License as published by the Free Software Foundation; either
  7  * version 2.1 of the License, or (at your option) any later version.
  8  *
  9  * This library is distributed in the hope that it will be useful, but
 10  * WITHOUT ANY WARRANTY; without even the implied warranty of
 11  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 12  * Lesser General Public License for more details.
 13  *
 14  * You should have received a copy of the GNU Lesser General Public
 15  * License along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 16  *
 17  * Author: Ryan Lortie &lt;desrt@desrt.ca&gt;
 18  */
 19 
 20 #include &quot;config.h&quot;
 21 
 22 #include &quot;gatomic.h&quot;
</pre>
<hr />
<pre>
 73  * with other (hardware) atomic APIs.
 74  *
 75  * If this macro is not defined, the atomic operations may be
 76  * emulated using a mutex.  In that case, the GLib atomic operations are
 77  * only atomic relative to themselves and within a single process.
 78  **/
 79 
 80 /* NOTE CAREFULLY:
 81  *
 82  * This file is the lowest-level part of GLib.
 83  *
 84  * Other lowlevel parts of GLib (threads, slice allocator, g_malloc,
 85  * messages, etc) call into these functions and macros to get work done.
 86  *
 87  * As such, these functions can not call back into any part of GLib
 88  * without risking recursion.
 89  */
 90 
 91 #ifdef G_ATOMIC_LOCK_FREE
 92 
<span class="line-modified"> 93 /* if G_ATOMIC_LOCK_FREE was defined by ./configure then we MUST</span>
 94  * implement the atomic operations in a lock-free manner.
 95  */
 96 
 97 #if defined (__GCC_HAVE_SYNC_COMPARE_AND_SWAP_4)
 98 
 99 #if defined(__ATOMIC_SEQ_CST) &amp;&amp; !defined(__clang__)
100 /* The implementation used in this code path in gatomic.h assumes
101  * 4-byte int */
102 G_STATIC_ASSERT (sizeof (gint) == 4);
103 
104 /* The implementations in gatomic.h assume 4- or 8-byte pointers */
105 G_STATIC_ASSERT (sizeof (void *) == 4 || sizeof (void *) == 8);
106 #endif
107 
108 /**
109  * g_atomic_int_get:
110  * @atomic: a pointer to a #gint or #guint
111  *
112  * Gets the current value of @atomic.
113  *
</pre>
<hr />
<pre>
652 {
653 #if GLIB_SIZEOF_VOID_P == 8
654   return InterlockedOr64 (atomic, val);
655 #else
656   return InterlockedOr (atomic, val);
657 #endif
658 }
659 
660 gsize
661 (g_atomic_pointer_xor) (volatile void *atomic,
662                         gsize          val)
663 {
664 #if GLIB_SIZEOF_VOID_P == 8
665   return InterlockedXor64 (atomic, val);
666 #else
667   return InterlockedXor (atomic, val);
668 #endif
669 }
670 #else
671 
<span class="line-modified">672 /* This error occurs when ./configure decided that we should be capable</span>
673  * of lock-free atomics but we find at compile-time that we are not.
674  */
675 #error G_ATOMIC_LOCK_FREE defined, but incapable of lock-free atomics.
676 
677 #endif /* defined (__GCC_HAVE_SYNC_COMPARE_AND_SWAP_4) */
678 
679 #else /* G_ATOMIC_LOCK_FREE */
680 
681 /* We are not permitted to call into any GLib functions from here, so we
682  * can not use GMutex.
683  *
684  * Fortunately, we already take care of the Windows case above, and all
685  * non-Windows platforms on which glib runs have pthreads.  Use those.
686  */
687 #include &lt;pthread.h&gt;
688 
689 static pthread_mutex_t g_atomic_lock = PTHREAD_MUTEX_INITIALIZER;
690 
691 gint
692 (g_atomic_int_get) (const volatile gint *atomic)
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (C) 2011 Ryan Lortie</span>
  3  *
  4  * This library is free software; you can redistribute it and/or
  5  * modify it under the terms of the GNU Lesser General Public
  6  * License as published by the Free Software Foundation; either
  7  * version 2.1 of the License, or (at your option) any later version.
  8  *
  9  * This library is distributed in the hope that it will be useful, but
 10  * WITHOUT ANY WARRANTY; without even the implied warranty of
 11  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 12  * Lesser General Public License for more details.
 13  *
 14  * You should have received a copy of the GNU Lesser General Public
 15  * License along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 16  *
 17  * Author: Ryan Lortie &lt;desrt@desrt.ca&gt;
 18  */
 19 
 20 #include &quot;config.h&quot;
 21 
 22 #include &quot;gatomic.h&quot;
</pre>
<hr />
<pre>
 73  * with other (hardware) atomic APIs.
 74  *
 75  * If this macro is not defined, the atomic operations may be
 76  * emulated using a mutex.  In that case, the GLib atomic operations are
 77  * only atomic relative to themselves and within a single process.
 78  **/
 79 
 80 /* NOTE CAREFULLY:
 81  *
 82  * This file is the lowest-level part of GLib.
 83  *
 84  * Other lowlevel parts of GLib (threads, slice allocator, g_malloc,
 85  * messages, etc) call into these functions and macros to get work done.
 86  *
 87  * As such, these functions can not call back into any part of GLib
 88  * without risking recursion.
 89  */
 90 
 91 #ifdef G_ATOMIC_LOCK_FREE
 92 
<span class="line-modified"> 93 /* if G_ATOMIC_LOCK_FREE was defined by `meson configure` then we MUST</span>
 94  * implement the atomic operations in a lock-free manner.
 95  */
 96 
 97 #if defined (__GCC_HAVE_SYNC_COMPARE_AND_SWAP_4)
 98 
 99 #if defined(__ATOMIC_SEQ_CST) &amp;&amp; !defined(__clang__)
100 /* The implementation used in this code path in gatomic.h assumes
101  * 4-byte int */
102 G_STATIC_ASSERT (sizeof (gint) == 4);
103 
104 /* The implementations in gatomic.h assume 4- or 8-byte pointers */
105 G_STATIC_ASSERT (sizeof (void *) == 4 || sizeof (void *) == 8);
106 #endif
107 
108 /**
109  * g_atomic_int_get:
110  * @atomic: a pointer to a #gint or #guint
111  *
112  * Gets the current value of @atomic.
113  *
</pre>
<hr />
<pre>
652 {
653 #if GLIB_SIZEOF_VOID_P == 8
654   return InterlockedOr64 (atomic, val);
655 #else
656   return InterlockedOr (atomic, val);
657 #endif
658 }
659 
660 gsize
661 (g_atomic_pointer_xor) (volatile void *atomic,
662                         gsize          val)
663 {
664 #if GLIB_SIZEOF_VOID_P == 8
665   return InterlockedXor64 (atomic, val);
666 #else
667   return InterlockedXor (atomic, val);
668 #endif
669 }
670 #else
671 
<span class="line-modified">672 /* This error occurs when `meson configure` decided that we should be capable</span>
673  * of lock-free atomics but we find at compile-time that we are not.
674  */
675 #error G_ATOMIC_LOCK_FREE defined, but incapable of lock-free atomics.
676 
677 #endif /* defined (__GCC_HAVE_SYNC_COMPARE_AND_SWAP_4) */
678 
679 #else /* G_ATOMIC_LOCK_FREE */
680 
681 /* We are not permitted to call into any GLib functions from here, so we
682  * can not use GMutex.
683  *
684  * Fortunately, we already take care of the Windows case above, and all
685  * non-Windows platforms on which glib runs have pthreads.  Use those.
686  */
687 #include &lt;pthread.h&gt;
688 
689 static pthread_mutex_t g_atomic_lock = PTHREAD_MUTEX_INITIALIZER;
690 
691 gint
692 (g_atomic_int_get) (const volatile gint *atomic)
</pre>
</td>
</tr>
</table>
<center><a href="gasyncqueue.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gatomic.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>