<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/gst/gstghostpad.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gstevent.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gstinfo.c.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/gst/gstghostpad.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /* GStreamer
  2  * Copyright (C) 1999,2000 Erik Walthinsen &lt;omega@cse.ogi.edu&gt;
  3  *                    2000 Wim Taymans &lt;wtay@chello.be&gt;
  4  *                    2005 Andy Wingo &lt;wingo@pobox.com&gt;
<span class="line-modified">  5  *            2006 Edward Hervey &lt;bilboed@bilboed.com&gt;</span>
  6  *
  7  * gstghostpad.c: Proxy pads
  8  *
  9  * This library is free software; you can redistribute it and/or
 10  * modify it under the terms of the GNU Library General Public
 11  * License as published by the Free Software Foundation; either
 12  * version 2 of the License, or (at your option) any later version.
 13  *
 14  * This library is distributed in the hope that it will be useful,
 15  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 16  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 17  * Library General Public License for more details.
 18  *
 19  * You should have received a copy of the GNU Library General Public
 20  * License along with this library; if not, write to the
 21  * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,
 22  * Boston, MA 02110-1301, USA.
 23  */
 24 
 25 /**
</pre>
<hr />
<pre>
 52 #define GST_CAT_DEFAULT GST_CAT_PADS
 53 
 54 #define GST_PROXY_PAD_CAST(obj)         ((GstProxyPad *)obj)
 55 #define GST_PROXY_PAD_PRIVATE(obj)      (GST_PROXY_PAD_CAST (obj)-&gt;priv)
 56 #define GST_PROXY_PAD_TARGET(pad)       (GST_PAD_PEER (GST_PROXY_PAD_INTERNAL (pad)))
 57 #define GST_PROXY_PAD_INTERNAL(pad)     (GST_PROXY_PAD_PRIVATE (pad)-&gt;internal)
 58 
 59 #define GST_PROXY_PAD_ACQUIRE_INTERNAL(pad, internal, retval)           \
 60   internal =                                                            \
 61       GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD_CAST (pad))); \
 62   if (internal == NULL)                                                 \
 63     return retval;
 64 
 65 #define GST_PROXY_PAD_RELEASE_INTERNAL(internal) gst_object_unref (internal);
 66 
 67 struct _GstProxyPadPrivate
 68 {
 69   GstPad *internal;
 70 };
 71 
<span class="line-modified"> 72 G_DEFINE_TYPE (GstProxyPad, gst_proxy_pad, GST_TYPE_PAD);</span>
 73 
 74 static GstPad *gst_proxy_pad_get_target (GstPad * pad);
 75 
 76 /**
 77  * gst_proxy_pad_iterate_internal_links_default:
 78  * @pad: the #GstPad to get the internal links of.
 79  * @parent: (allow-none): the parent of @pad or %NULL
 80  *
 81  * Invoke the default iterate internal links function of the proxy pad.
 82  *
 83  * Returns: (nullable): a #GstIterator of #GstPad, or %NULL if @pad
 84  * has no parent. Unref each returned pad with gst_object_unref().
 85  */
 86 GstIterator *
 87 gst_proxy_pad_iterate_internal_links_default (GstPad * pad, GstObject * parent)
 88 {
 89   GstIterator *res = NULL;
 90   GstPad *internal;
 91   GValue v = { 0, };
 92 
</pre>
<hr />
<pre>
214  */
215 GstProxyPad *
216 gst_proxy_pad_get_internal (GstProxyPad * pad)
217 {
218   GstPad *internal;
219 
220   g_return_val_if_fail (GST_IS_PROXY_PAD (pad), NULL);
221 
222   GST_OBJECT_LOCK (pad);
223   internal = GST_PROXY_PAD_INTERNAL (pad);
224   if (internal)
225     gst_object_ref (internal);
226   GST_OBJECT_UNLOCK (pad);
227 
228   return GST_PROXY_PAD_CAST (internal);
229 }
230 
231 static void
232 gst_proxy_pad_class_init (GstProxyPadClass * klass)
233 {
<span class="line-removed">234   g_type_class_add_private (klass, sizeof (GstProxyPadPrivate));</span>
<span class="line-removed">235 </span>
236   /* Register common function pointer descriptions */
237   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_iterate_internal_links_default);
238   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_chain_default);
239   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_chain_list_default);
240   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_getrange_default);
241 }
242 
243 static void
244 gst_proxy_pad_init (GstProxyPad * ppad)
245 {
246   GstPad *pad = (GstPad *) ppad;
247 
<span class="line-modified">248   GST_PROXY_PAD_PRIVATE (ppad) = G_TYPE_INSTANCE_GET_PRIVATE (ppad,</span>
<span class="line-removed">249       GST_TYPE_PROXY_PAD, GstProxyPadPrivate);</span>
250 
251   gst_pad_set_iterate_internal_links_function (pad,
252       gst_proxy_pad_iterate_internal_links_default);
253 
254   GST_PAD_SET_PROXY_CAPS (pad);
255   GST_PAD_SET_PROXY_SCHEDULING (pad);
256   GST_PAD_SET_PROXY_ALLOCATION (pad);
257 }
258 
259 
260 /***********************************************************************
261  * Ghost pads, implemented as a pair of proxy pads (sort of)
262  */
263 
264 
265 #define GST_GHOST_PAD_PRIVATE(obj)  (GST_GHOST_PAD_CAST (obj)-&gt;priv)
266 
267 struct _GstGhostPadPrivate
268 {
269   /* with PROXY_LOCK */
270   gboolean constructed;
271 };
272 
<span class="line-modified">273 G_DEFINE_TYPE (GstGhostPad, gst_ghost_pad, GST_TYPE_PROXY_PAD);</span>
274 
275 static void gst_ghost_pad_dispose (GObject * object);
276 
277 static gboolean
278 gst_ghost_pad_internal_activate_push_default (GstPad * pad, GstObject * parent,
279     gboolean active)
280 {
281   gboolean ret;
282   GstPad *other;
283 
284   GST_LOG_OBJECT (pad, &quot;%sactivate push on %s:%s, we&#39;re ok&quot;,
285       (active ? &quot;&quot; : &quot;de&quot;), GST_DEBUG_PAD_NAME (pad));
286 
287   /* in both cases (SRC and SINK) we activate just the internal pad. The targets
288    * will be activated later (or already in case of a ghost sinkpad). */
289   GST_PROXY_PAD_ACQUIRE_INTERNAL (pad, other, FALSE);
290   ret = gst_pad_activate_mode (other, GST_PAD_MODE_PUSH, active);
291   GST_PROXY_PAD_RELEASE_INTERNAL (other);
292 
293   return ret;
</pre>
<hr />
<pre>
444   switch (mode) {
445     case GST_PAD_MODE_PULL:
446       res = gst_ghost_pad_activate_pull_default (pad, parent, active);
447       break;
448     case GST_PAD_MODE_PUSH:
449       res = gst_ghost_pad_activate_push_default (pad, parent, active);
450       break;
451     default:
452       GST_LOG_OBJECT (pad, &quot;unknown activation mode %d&quot;, mode);
453       res = FALSE;
454       break;
455   }
456   return res;
457 }
458 
459 static void
460 gst_ghost_pad_class_init (GstGhostPadClass * klass)
461 {
462   GObjectClass *gobject_class = (GObjectClass *) klass;
463 
<span class="line-removed">464   g_type_class_add_private (klass, sizeof (GstGhostPadPrivate));</span>
<span class="line-removed">465 </span>
466   gobject_class-&gt;dispose = gst_ghost_pad_dispose;
467 
468   GST_DEBUG_REGISTER_FUNCPTR (gst_ghost_pad_activate_pull_default);
469   GST_DEBUG_REGISTER_FUNCPTR (gst_ghost_pad_activate_push_default);
470 }
471 
472 static void
473 gst_ghost_pad_init (GstGhostPad * pad)
474 {
<span class="line-modified">475   GST_GHOST_PAD_PRIVATE (pad) = G_TYPE_INSTANCE_GET_PRIVATE (pad,</span>
<span class="line-removed">476       GST_TYPE_GHOST_PAD, GstGhostPadPrivate);</span>
477 
478   gst_pad_set_activatemode_function (GST_PAD_CAST (pad),
479       gst_ghost_pad_activate_mode_default);
480 }
481 
482 static void
483 gst_ghost_pad_dispose (GObject * object)
484 {
485   GstPad *pad;
486   GstPad *internal;
487   GstPad *peer;
488 
489   pad = GST_PAD (object);
490 
491   GST_DEBUG_OBJECT (pad, &quot;dispose&quot;);
492 
493   gst_ghost_pad_set_target (GST_GHOST_PAD (pad), NULL);
494 
495   /* Unlink here so that gst_pad_dispose doesn&#39;t. That would lead to a call to
496    * gst_ghost_pad_unlink_default when the ghost pad is in an inconsistent state */
497   peer = gst_pad_get_peer (pad);
498   if (peer) {
499     if (GST_PAD_IS_SRC (pad))
500       gst_pad_unlink (pad, peer);
501     else
502       gst_pad_unlink (peer, pad);
503 
504     gst_object_unref (peer);
505   }
506 
507   GST_OBJECT_LOCK (pad);
508   internal = GST_PROXY_PAD_INTERNAL (pad);
509   if (internal) {
<span class="line-modified">510   gst_pad_set_activatemode_function (internal, NULL);</span>
511 
512     GST_PROXY_PAD_INTERNAL (pad) = NULL;
513     GST_PROXY_PAD_INTERNAL (internal) = NULL;
514 
<span class="line-modified">515   /* disposes of the internal pad, since the ghostpad is the only possible object</span>
<span class="line-modified">516    * that has a refcount on the internal pad. */</span>
<span class="line-modified">517   gst_object_unparent (GST_OBJECT_CAST (internal));</span>
518   }
519 
520   GST_OBJECT_UNLOCK (pad);
521 
522   G_OBJECT_CLASS (gst_ghost_pad_parent_class)-&gt;dispose (object);
523 }
524 
525 /**
526  * gst_ghost_pad_construct:
527  * @gpad: the newly allocated ghost pad
528  *
529  * Finish initialization of a newly allocated ghost pad.
530  *
531  * This function is most useful in language bindings and when subclassing
532  * #GstGhostPad; plugin and application developers normally will not call this
533  * function. Call this function directly after a call to g_object_new
534  * (GST_TYPE_GHOST_PAD, &quot;direction&quot;, @dir, ..., NULL).
535  *
536  * Returns: %TRUE if the construction succeeds, %FALSE otherwise.
537  */
</pre>
</td>
<td>
<hr />
<pre>
  1 /* GStreamer
  2  * Copyright (C) 1999,2000 Erik Walthinsen &lt;omega@cse.ogi.edu&gt;
  3  *                    2000 Wim Taymans &lt;wtay@chello.be&gt;
  4  *                    2005 Andy Wingo &lt;wingo@pobox.com&gt;
<span class="line-modified">  5  *          2006 Edward Hervey &lt;bilboed@bilboed.com&gt;</span>
  6  *
  7  * gstghostpad.c: Proxy pads
  8  *
  9  * This library is free software; you can redistribute it and/or
 10  * modify it under the terms of the GNU Library General Public
 11  * License as published by the Free Software Foundation; either
 12  * version 2 of the License, or (at your option) any later version.
 13  *
 14  * This library is distributed in the hope that it will be useful,
 15  * but WITHOUT ANY WARRANTY; without even the implied warranty of
 16  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 17  * Library General Public License for more details.
 18  *
 19  * You should have received a copy of the GNU Library General Public
 20  * License along with this library; if not, write to the
 21  * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,
 22  * Boston, MA 02110-1301, USA.
 23  */
 24 
 25 /**
</pre>
<hr />
<pre>
 52 #define GST_CAT_DEFAULT GST_CAT_PADS
 53 
 54 #define GST_PROXY_PAD_CAST(obj)         ((GstProxyPad *)obj)
 55 #define GST_PROXY_PAD_PRIVATE(obj)      (GST_PROXY_PAD_CAST (obj)-&gt;priv)
 56 #define GST_PROXY_PAD_TARGET(pad)       (GST_PAD_PEER (GST_PROXY_PAD_INTERNAL (pad)))
 57 #define GST_PROXY_PAD_INTERNAL(pad)     (GST_PROXY_PAD_PRIVATE (pad)-&gt;internal)
 58 
 59 #define GST_PROXY_PAD_ACQUIRE_INTERNAL(pad, internal, retval)           \
 60   internal =                                                            \
 61       GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD_CAST (pad))); \
 62   if (internal == NULL)                                                 \
 63     return retval;
 64 
 65 #define GST_PROXY_PAD_RELEASE_INTERNAL(internal) gst_object_unref (internal);
 66 
 67 struct _GstProxyPadPrivate
 68 {
 69   GstPad *internal;
 70 };
 71 
<span class="line-modified"> 72 G_DEFINE_TYPE_WITH_PRIVATE (GstProxyPad, gst_proxy_pad, GST_TYPE_PAD);</span>
 73 
 74 static GstPad *gst_proxy_pad_get_target (GstPad * pad);
 75 
 76 /**
 77  * gst_proxy_pad_iterate_internal_links_default:
 78  * @pad: the #GstPad to get the internal links of.
 79  * @parent: (allow-none): the parent of @pad or %NULL
 80  *
 81  * Invoke the default iterate internal links function of the proxy pad.
 82  *
 83  * Returns: (nullable): a #GstIterator of #GstPad, or %NULL if @pad
 84  * has no parent. Unref each returned pad with gst_object_unref().
 85  */
 86 GstIterator *
 87 gst_proxy_pad_iterate_internal_links_default (GstPad * pad, GstObject * parent)
 88 {
 89   GstIterator *res = NULL;
 90   GstPad *internal;
 91   GValue v = { 0, };
 92 
</pre>
<hr />
<pre>
214  */
215 GstProxyPad *
216 gst_proxy_pad_get_internal (GstProxyPad * pad)
217 {
218   GstPad *internal;
219 
220   g_return_val_if_fail (GST_IS_PROXY_PAD (pad), NULL);
221 
222   GST_OBJECT_LOCK (pad);
223   internal = GST_PROXY_PAD_INTERNAL (pad);
224   if (internal)
225     gst_object_ref (internal);
226   GST_OBJECT_UNLOCK (pad);
227 
228   return GST_PROXY_PAD_CAST (internal);
229 }
230 
231 static void
232 gst_proxy_pad_class_init (GstProxyPadClass * klass)
233 {


234   /* Register common function pointer descriptions */
235   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_iterate_internal_links_default);
236   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_chain_default);
237   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_chain_list_default);
238   GST_DEBUG_REGISTER_FUNCPTR (gst_proxy_pad_getrange_default);
239 }
240 
241 static void
242 gst_proxy_pad_init (GstProxyPad * ppad)
243 {
244   GstPad *pad = (GstPad *) ppad;
245 
<span class="line-modified">246   GST_PROXY_PAD_PRIVATE (ppad) = gst_proxy_pad_get_instance_private (ppad);</span>

247 
248   gst_pad_set_iterate_internal_links_function (pad,
249       gst_proxy_pad_iterate_internal_links_default);
250 
251   GST_PAD_SET_PROXY_CAPS (pad);
252   GST_PAD_SET_PROXY_SCHEDULING (pad);
253   GST_PAD_SET_PROXY_ALLOCATION (pad);
254 }
255 
256 
257 /***********************************************************************
258  * Ghost pads, implemented as a pair of proxy pads (sort of)
259  */
260 
261 
262 #define GST_GHOST_PAD_PRIVATE(obj)  (GST_GHOST_PAD_CAST (obj)-&gt;priv)
263 
264 struct _GstGhostPadPrivate
265 {
266   /* with PROXY_LOCK */
267   gboolean constructed;
268 };
269 
<span class="line-modified">270 G_DEFINE_TYPE_WITH_PRIVATE (GstGhostPad, gst_ghost_pad, GST_TYPE_PROXY_PAD);</span>
271 
272 static void gst_ghost_pad_dispose (GObject * object);
273 
274 static gboolean
275 gst_ghost_pad_internal_activate_push_default (GstPad * pad, GstObject * parent,
276     gboolean active)
277 {
278   gboolean ret;
279   GstPad *other;
280 
281   GST_LOG_OBJECT (pad, &quot;%sactivate push on %s:%s, we&#39;re ok&quot;,
282       (active ? &quot;&quot; : &quot;de&quot;), GST_DEBUG_PAD_NAME (pad));
283 
284   /* in both cases (SRC and SINK) we activate just the internal pad. The targets
285    * will be activated later (or already in case of a ghost sinkpad). */
286   GST_PROXY_PAD_ACQUIRE_INTERNAL (pad, other, FALSE);
287   ret = gst_pad_activate_mode (other, GST_PAD_MODE_PUSH, active);
288   GST_PROXY_PAD_RELEASE_INTERNAL (other);
289 
290   return ret;
</pre>
<hr />
<pre>
441   switch (mode) {
442     case GST_PAD_MODE_PULL:
443       res = gst_ghost_pad_activate_pull_default (pad, parent, active);
444       break;
445     case GST_PAD_MODE_PUSH:
446       res = gst_ghost_pad_activate_push_default (pad, parent, active);
447       break;
448     default:
449       GST_LOG_OBJECT (pad, &quot;unknown activation mode %d&quot;, mode);
450       res = FALSE;
451       break;
452   }
453   return res;
454 }
455 
456 static void
457 gst_ghost_pad_class_init (GstGhostPadClass * klass)
458 {
459   GObjectClass *gobject_class = (GObjectClass *) klass;
460 


461   gobject_class-&gt;dispose = gst_ghost_pad_dispose;
462 
463   GST_DEBUG_REGISTER_FUNCPTR (gst_ghost_pad_activate_pull_default);
464   GST_DEBUG_REGISTER_FUNCPTR (gst_ghost_pad_activate_push_default);
465 }
466 
467 static void
468 gst_ghost_pad_init (GstGhostPad * pad)
469 {
<span class="line-modified">470   GST_GHOST_PAD_PRIVATE (pad) = gst_ghost_pad_get_instance_private (pad);</span>

471 
472   gst_pad_set_activatemode_function (GST_PAD_CAST (pad),
473       gst_ghost_pad_activate_mode_default);
474 }
475 
476 static void
477 gst_ghost_pad_dispose (GObject * object)
478 {
479   GstPad *pad;
480   GstPad *internal;
481   GstPad *peer;
482 
483   pad = GST_PAD (object);
484 
485   GST_DEBUG_OBJECT (pad, &quot;dispose&quot;);
486 
487   gst_ghost_pad_set_target (GST_GHOST_PAD (pad), NULL);
488 
489   /* Unlink here so that gst_pad_dispose doesn&#39;t. That would lead to a call to
490    * gst_ghost_pad_unlink_default when the ghost pad is in an inconsistent state */
491   peer = gst_pad_get_peer (pad);
492   if (peer) {
493     if (GST_PAD_IS_SRC (pad))
494       gst_pad_unlink (pad, peer);
495     else
496       gst_pad_unlink (peer, pad);
497 
498     gst_object_unref (peer);
499   }
500 
501   GST_OBJECT_LOCK (pad);
502   internal = GST_PROXY_PAD_INTERNAL (pad);
503   if (internal) {
<span class="line-modified">504     gst_pad_set_activatemode_function (internal, NULL);</span>
505 
506     GST_PROXY_PAD_INTERNAL (pad) = NULL;
507     GST_PROXY_PAD_INTERNAL (internal) = NULL;
508 
<span class="line-modified">509     /* disposes of the internal pad, since the ghostpad is the only possible object</span>
<span class="line-modified">510      * that has a refcount on the internal pad. */</span>
<span class="line-modified">511     gst_object_unparent (GST_OBJECT_CAST (internal));</span>
512   }
513 
514   GST_OBJECT_UNLOCK (pad);
515 
516   G_OBJECT_CLASS (gst_ghost_pad_parent_class)-&gt;dispose (object);
517 }
518 
519 /**
520  * gst_ghost_pad_construct:
521  * @gpad: the newly allocated ghost pad
522  *
523  * Finish initialization of a newly allocated ghost pad.
524  *
525  * This function is most useful in language bindings and when subclassing
526  * #GstGhostPad; plugin and application developers normally will not call this
527  * function. Call this function directly after a call to g_object_new
528  * (GST_TYPE_GHOST_PAD, &quot;direction&quot;, @dir, ..., NULL).
529  *
530  * Returns: %TRUE if the construction succeeds, %FALSE otherwise.
531  */
</pre>
</td>
</tr>
</table>
<center><a href="gstevent.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gstinfo.c.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>