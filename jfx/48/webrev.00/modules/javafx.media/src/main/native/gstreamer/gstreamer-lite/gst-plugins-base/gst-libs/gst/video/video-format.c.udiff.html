<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/video-format.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="video-event.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="video-format.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gst-plugins-base/gst-libs/gst/video/video-format.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -140,17 +140,17 @@</span>
          dy[i * 2 + 1] = s[i * 8 + 5];
          du[i] = s[i * 8 + 2];
          dv[i] = s[i * 8 + 3];
        }
      }
<span class="udiff-line-modified-removed">-   if (width &amp; 1) {</span>
<span class="udiff-line-modified-removed">-     gint i = width - 1;</span>
<span class="udiff-line-modified-added">+     if (width &amp; 1) {</span>
<span class="udiff-line-modified-added">+       gint i = width - 1;</span>
  
        dy[i] = s[i * 4 + 1];
        du[i &gt;&gt; 1] = s[i * 4 + 2];
        dv[i &gt;&gt; 1] = s[i * 4 + 3];
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+     }</span>
    } else
      video_orc_pack_Y (dy, s, width);
  }
  
  #define PACK_YUY2 GST_VIDEO_FORMAT_AYUV, unpack_YUY2, 1, pack_YUY2
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -786,10 +786,173 @@</span>
      GST_WRITE_UINT16_LE (d + i * 4 + 4, s[i * 4 + 3]);
      GST_WRITE_UINT16_LE (d + i * 4 + 6, s[i * 4 + 1]);
    }
  }
  
<span class="udiff-line-added">+ #define PACK_Y210 GST_VIDEO_FORMAT_AYUV64, unpack_Y210, 1, pack_Y210</span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ unpack_Y210 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], gint x, gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   int i;</span>
<span class="udiff-line-added">+   const guint8 *restrict s = GET_LINE (y);</span>
<span class="udiff-line-added">+   guint16 *restrict d = dest;</span>
<span class="udiff-line-added">+   guint Y0, Y1, U, V;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   s += GST_ROUND_DOWN_2 (x) * 4;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   if (x &amp; 1) {</span>
<span class="udiff-line-added">+     Y1 = GST_READ_UINT16_LE (s + 4);</span>
<span class="udiff-line-added">+     U = GST_READ_UINT16_LE (s + 2);</span>
<span class="udiff-line-added">+     V = GST_READ_UINT16_LE (s + 6);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (!(flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)) {</span>
<span class="udiff-line-added">+       Y1 |= (Y1 &gt;&gt; 10);</span>
<span class="udiff-line-added">+       U |= (U &gt;&gt; 10);</span>
<span class="udiff-line-added">+       V |= (V &gt;&gt; 10);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     d[0] = 0xffff;</span>
<span class="udiff-line-added">+     d[1] = Y1;</span>
<span class="udiff-line-added">+     d[2] = U;</span>
<span class="udiff-line-added">+     d[3] = V;</span>
<span class="udiff-line-added">+     s += 8;</span>
<span class="udiff-line-added">+     d += 4;</span>
<span class="udiff-line-added">+     width--;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width / 2; i++) {</span>
<span class="udiff-line-added">+     Y0 = GST_READ_UINT16_LE (s + i * 8 + 0);</span>
<span class="udiff-line-added">+     U = GST_READ_UINT16_LE (s + i * 8 + 2);</span>
<span class="udiff-line-added">+     V = GST_READ_UINT16_LE (s + i * 8 + 6);</span>
<span class="udiff-line-added">+     Y1 = GST_READ_UINT16_LE (s + i * 8 + 4);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (!(flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)) {</span>
<span class="udiff-line-added">+       Y0 |= (Y0 &gt;&gt; 10);</span>
<span class="udiff-line-added">+       U |= (U &gt;&gt; 10);</span>
<span class="udiff-line-added">+       V |= (V &gt;&gt; 10);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     d[i * 8 + 0] = 0xffff;</span>
<span class="udiff-line-added">+     d[i * 8 + 1] = Y0;</span>
<span class="udiff-line-added">+     d[i * 8 + 2] = U;</span>
<span class="udiff-line-added">+     d[i * 8 + 3] = V;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     d[i * 8 + 4] = 0xffff;</span>
<span class="udiff-line-added">+     d[i * 8 + 5] = Y1;</span>
<span class="udiff-line-added">+     d[i * 8 + 6] = U;</span>
<span class="udiff-line-added">+     d[i * 8 + 7] = V;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   if (width &amp; 1) {</span>
<span class="udiff-line-added">+     i = width - 1;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     Y0 = GST_READ_UINT16_LE (s + i * 4 + 0);</span>
<span class="udiff-line-added">+     U = GST_READ_UINT16_LE (s + i * 4 + 2);</span>
<span class="udiff-line-added">+     V = GST_READ_UINT16_LE (s + i * 4 + 6);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (!(flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)) {</span>
<span class="udiff-line-added">+       Y0 |= (Y0 &gt;&gt; 10);</span>
<span class="udiff-line-added">+       U |= (U &gt;&gt; 10);</span>
<span class="udiff-line-added">+       V |= (V &gt;&gt; 10);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     d[i * 4 + 0] = 0xffff;</span>
<span class="udiff-line-added">+     d[i * 4 + 1] = Y0;</span>
<span class="udiff-line-added">+     d[i * 4 + 2] = U;</span>
<span class="udiff-line-added">+     d[i * 4 + 3] = V;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ pack_Y210 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,</span>
<span class="udiff-line-added">+     gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   int i;</span>
<span class="udiff-line-added">+   guint16 Y0, Y1, U, V;</span>
<span class="udiff-line-added">+   guint8 *restrict d = GET_LINE (y);</span>
<span class="udiff-line-added">+   const guint16 *restrict s = src;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width; i += 2) {</span>
<span class="udiff-line-added">+     Y0 = s[i * 4 + 1] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     U = s[i * 4 + 2] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     V = s[i * 4 + 3] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     if (i == width - 1)</span>
<span class="udiff-line-added">+       Y1 = s[i * 4 + 1] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     else</span>
<span class="udiff-line-added">+       Y1 = s[(i + 1) * 4 + 1] &amp; 0xffc0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     GST_WRITE_UINT16_LE (d + i * 4 + 0, Y0);</span>
<span class="udiff-line-added">+     GST_WRITE_UINT16_LE (d + i * 4 + 2, U);</span>
<span class="udiff-line-added">+     GST_WRITE_UINT16_LE (d + i * 4 + 4, Y1);</span>
<span class="udiff-line-added">+     GST_WRITE_UINT16_LE (d + i * 4 + 6, V);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #define PACK_Y410 GST_VIDEO_FORMAT_AYUV64, unpack_Y410, 1, pack_Y410</span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ unpack_Y410 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], gint x, gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   int i;</span>
<span class="udiff-line-added">+   const guint8 *restrict s = GET_LINE (y);</span>
<span class="udiff-line-added">+   guint16 *restrict d = dest;</span>
<span class="udiff-line-added">+   guint32 AVYU;</span>
<span class="udiff-line-added">+   guint16 A, Y, U, V;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   s += x * 4;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width; i++) {</span>
<span class="udiff-line-added">+     AVYU = GST_READ_UINT32_LE (s + 4 * i);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     U = ((AVYU &gt;&gt; 0) &amp; 0x3ff) &lt;&lt; 6;</span>
<span class="udiff-line-added">+     Y = ((AVYU &gt;&gt; 10) &amp; 0x3ff) &lt;&lt; 6;</span>
<span class="udiff-line-added">+     V = ((AVYU &gt;&gt; 20) &amp; 0x3ff) &lt;&lt; 6;</span>
<span class="udiff-line-added">+     A = ((AVYU &gt;&gt; 30) &amp; 0x03) &lt;&lt; 14;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (!(flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)) {</span>
<span class="udiff-line-added">+       U |= (U &gt;&gt; 10);</span>
<span class="udiff-line-added">+       Y |= (Y &gt;&gt; 10);</span>
<span class="udiff-line-added">+       V |= (V &gt;&gt; 10);</span>
<span class="udiff-line-added">+       A |= (A &gt;&gt; 10);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     d[4 * i + 0] = A;</span>
<span class="udiff-line-added">+     d[4 * i + 1] = Y;</span>
<span class="udiff-line-added">+     d[4 * i + 2] = U;</span>
<span class="udiff-line-added">+     d[4 * i + 3] = V;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ pack_Y410 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,</span>
<span class="udiff-line-added">+     gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   int i;</span>
<span class="udiff-line-added">+   guint32 *restrict d = GET_LINE (y);</span>
<span class="udiff-line-added">+   const guint16 *restrict s = src;</span>
<span class="udiff-line-added">+   guint32 AVYU;</span>
<span class="udiff-line-added">+   guint16 A, Y, U, V;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width; i++) {</span>
<span class="udiff-line-added">+     A = s[4 * i] &amp; 0xc000;</span>
<span class="udiff-line-added">+     Y = s[4 * i + 1] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     U = s[4 * i + 2] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     V = s[4 * i + 3] &amp; 0xffc0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     AVYU = (U &gt;&gt; 6) | (Y &lt;&lt; 4) | (V &lt;&lt; 14) | (A &lt;&lt; 16);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     GST_WRITE_UINT32_LE (d + i, AVYU);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  #define PACK_Y41B GST_VIDEO_FORMAT_AYUV, unpack_Y41B, 1, pack_Y41B
  static void
  unpack_Y41B (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], gint x, gint y, gint width)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1178,11 +1341,11 @@</span>
  
    if (flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)
      video_orc_unpack_RGB16_trunc (dest, s + x, width);
    else
      video_orc_unpack_RGB16 (dest, s + x, width);
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  static void
  pack_RGB16 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1193,11 +1356,11 @@</span>
  #if G_BYTE_ORDER == G_LITTLE_ENDIAN
    video_orc_pack_RGB16_le (d, src, width);
  #else
    video_orc_pack_RGB16_be (d, src, width);
  #endif
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  #define PACK_BGR16 GST_VIDEO_FORMAT_ARGB, unpack_BGR16, 1, pack_BGR16
  static void
  unpack_BGR16 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1207,11 +1370,11 @@</span>
  
    if (flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)
      video_orc_unpack_BGR16_trunc (dest, s + x, width);
    else
      video_orc_unpack_BGR16 (dest, s + x, width);
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  static void
  pack_BGR16 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1222,11 +1385,11 @@</span>
  #if G_BYTE_ORDER == G_LITTLE_ENDIAN
    video_orc_pack_BGR16_le (d, src, width);
  #else
    video_orc_pack_BGR16_be (d, src, width);
  #endif
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  #define PACK_RGB15 GST_VIDEO_FORMAT_ARGB, unpack_RGB15, 1, pack_RGB15
  static void
  unpack_RGB15 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1243,11 +1406,11 @@</span>
    if (flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)
      video_orc_unpack_RGB15_be_trunc (dest, s + x, width);
    else
      video_orc_unpack_RGB15_be (dest, s + x, width);
  #endif
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  static void
  pack_RGB15 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1258,11 +1421,11 @@</span>
  #if G_BYTE_ORDER == G_LITTLE_ENDIAN
    video_orc_pack_RGB15_le (d, src, width);
  #else
    video_orc_pack_RGB15_be (d, src, width);
  #endif
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  #define PACK_BGR15 GST_VIDEO_FORMAT_ARGB, unpack_BGR15, 1, pack_BGR15
  static void
  unpack_BGR15 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1279,11 +1442,11 @@</span>
    if (flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)
      video_orc_unpack_BGR15_be_trunc (dest, s + x, width);
    else
      video_orc_unpack_BGR15_be (dest, s + x, width);
  #endif
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  static void
  pack_BGR15 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1294,11 +1457,11 @@</span>
  #if G_BYTE_ORDER == G_LITTLE_ENDIAN
    video_orc_pack_BGR15_le (d, src, width);
  #else
    video_orc_pack_BGR15_be (d, src, width);
  #endif
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+ }</span>
  
  #define PACK_BGRA GST_VIDEO_FORMAT_ARGB, unpack_BGRA, 1, pack_BGRA
  static void
  unpack_BGRA (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1531,17 +1694,17 @@</span>
          dy[i * 2 + 1] = s[i * 8 + 5];
          duv[i * 2 + 0] = s[i * 8 + 2];
          duv[i * 2 + 1] = s[i * 8 + 3];
        }
      }
<span class="udiff-line-modified-removed">-   if (width &amp; 1) {</span>
<span class="udiff-line-modified-removed">-     gint i = width - 1;</span>
<span class="udiff-line-modified-added">+     if (width &amp; 1) {</span>
<span class="udiff-line-modified-added">+       gint i = width - 1;</span>
  
        dy[i] = s[i * 4 + 1];
        duv[i + 0] = s[i * 4 + 2];
        duv[i + 1] = s[i * 4 + 3];
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+     }</span>
    } else
      video_orc_pack_Y (dy, s, width);
  }
  
  #define PACK_NV21 GST_VIDEO_FORMAT_AYUV, unpack_NV21, 1, pack_NV21
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1615,17 +1778,17 @@</span>
          dy[i * 2 + 1] = s[i * 8 + 5];
          duv[i * 2 + 0] = s[i * 8 + 3];
          duv[i * 2 + 1] = s[i * 8 + 2];
        }
      }
<span class="udiff-line-modified-removed">-   if (width &amp; 1) {</span>
<span class="udiff-line-modified-removed">-     gint i = width - 1;</span>
<span class="udiff-line-modified-added">+     if (width &amp; 1) {</span>
<span class="udiff-line-modified-added">+       gint i = width - 1;</span>
  
        dy[i] = s[i * 4 + 1];
        duv[i + 0] = s[i * 4 + 3];
        duv[i + 1] = s[i * 4 + 2];
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+     }</span>
    } else
      video_orc_pack_Y (dy, s, width);
  }
  
  #define PACK_NV16 GST_VIDEO_FORMAT_AYUV, unpack_NV16, 1, pack_NV16
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1916,11 +2079,11 @@</span>
      d[1] = *sy++;
      d[2] = *su++;
      d[3] = *sv++;
      width--;
      d += 4;
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-added">+   }</span>
    video_orc_unpack_A420 (d, sy, su, sv, sa, width);
  }
  
  static void
  pack_A420 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1948,18 +2111,18 @@</span>
          du[i] = s[i * 8 + 2];
          dv[i] = s[i * 8 + 3];
        }
      }
  
<span class="udiff-line-modified-removed">-   if (width &amp; 1) {</span>
<span class="udiff-line-modified-removed">-     gint i = width - 1;</span>
<span class="udiff-line-modified-added">+     if (width &amp; 1) {</span>
<span class="udiff-line-modified-added">+       gint i = width - 1;</span>
  
        da[i] = s[i * 4 + 0];
        dy[i] = s[i * 4 + 1];
        du[i &gt;&gt; 1] = s[i * 4 + 2];
        dv[i &gt;&gt; 1] = s[i * 4 + 3];
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+     }</span>
    } else
      video_orc_pack_AY (dy, da, s, width);
  }
  
  #define PACK_RGB8P GST_VIDEO_FORMAT_ARGB, unpack_RGB8P, 1, pack_RGB8P
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2960,13 +3123,13 @@</span>
  
      if (x &amp; 1) {
        x = 0;
        su++;
        sv++;
<span class="udiff-line-added">+     }</span>
    }
  }
<span class="udiff-line-removed">- }</span>
  
  static void
  pack_I420_10LE (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2979,35 +3142,35 @@</span>
    guint16 *restrict dv = GET_V_LINE (uv);
    guint16 Y0, Y1, U, V;
    const guint16 *restrict s = src;
  
    if (IS_CHROMA_LINE_420 (y, flags)) {
<span class="udiff-line-modified-removed">-   for (i = 0; i &lt; width - 1; i += 2) {</span>
<span class="udiff-line-modified-removed">-     Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     Y1 = s[i * 4 + 5] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     V = s[i * 4 + 3] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+     for (i = 0; i &lt; width - 1; i += 2) {</span>
<span class="udiff-line-modified-added">+       Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       Y1 = s[i * 4 + 5] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       V = s[i * 4 + 3] &gt;&gt; 6;</span>
  
        GST_WRITE_UINT16_LE (dy + i + 0, Y0);
        GST_WRITE_UINT16_LE (dy + i + 1, Y1);
        GST_WRITE_UINT16_LE (du + (i &gt;&gt; 1), U);
        GST_WRITE_UINT16_LE (dv + (i &gt;&gt; 1), V);
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-removed">-   if (i == width - 1) {</span>
<span class="udiff-line-modified-removed">-     Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     V = s[i * 4 + 3] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+     if (i == width - 1) {</span>
<span class="udiff-line-modified-added">+       Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       V = s[i * 4 + 3] &gt;&gt; 6;</span>
  
        GST_WRITE_UINT16_LE (dy + i, Y0);
        GST_WRITE_UINT16_LE (du + (i &gt;&gt; 1), U);
        GST_WRITE_UINT16_LE (dv + (i &gt;&gt; 1), V);
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+     }</span>
    } else {
      for (i = 0; i &lt; width; i++) {
        Y0 = s[i * 4 + 1] &gt;&gt; 6;
        GST_WRITE_UINT16_LE (dy + i, Y0);
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-added">+     }</span>
    }
  }
  
  #define PACK_I420_10BE GST_VIDEO_FORMAT_AYUV64, unpack_I420_10BE, 1, pack_I420_10BE
  static void
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3044,13 +3207,13 @@</span>
  
      if (x &amp; 1) {
        x = 0;
        su++;
        sv++;
<span class="udiff-line-added">+     }</span>
    }
  }
<span class="udiff-line-removed">- }</span>
  
  static void
  pack_I420_10BE (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3063,35 +3226,35 @@</span>
    guint16 *restrict dv = GET_V_LINE (uv);
    guint16 Y0, Y1, U, V;
    const guint16 *restrict s = src;
  
    if (IS_CHROMA_LINE_420 (y, flags)) {
<span class="udiff-line-modified-removed">-   for (i = 0; i &lt; width - 1; i += 2) {</span>
<span class="udiff-line-modified-removed">-     Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     Y1 = s[i * 4 + 5] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     V = s[i * 4 + 3] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+     for (i = 0; i &lt; width - 1; i += 2) {</span>
<span class="udiff-line-modified-added">+       Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       Y1 = s[i * 4 + 5] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       V = s[i * 4 + 3] &gt;&gt; 6;</span>
  
        GST_WRITE_UINT16_BE (dy + i + 0, Y0);
        GST_WRITE_UINT16_BE (dy + i + 1, Y1);
        GST_WRITE_UINT16_BE (du + (i &gt;&gt; 1), U);
        GST_WRITE_UINT16_BE (dv + (i &gt;&gt; 1), V);
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-removed">-   if (i == width - 1) {</span>
<span class="udiff-line-modified-removed">-     Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-removed">-     V = s[i * 4 + 3] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+     if (i == width - 1) {</span>
<span class="udiff-line-modified-added">+       Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       U = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-modified-added">+       V = s[i * 4 + 3] &gt;&gt; 6;</span>
  
        GST_WRITE_UINT16_BE (dy + i, Y0);
        GST_WRITE_UINT16_BE (du + (i &gt;&gt; 1), U);
        GST_WRITE_UINT16_BE (dv + (i &gt;&gt; 1), V);
<span class="udiff-line-modified-removed">-   }</span>
<span class="udiff-line-modified-added">+     }</span>
    } else {
      for (i = 0; i &lt; width; i++) {
        Y0 = s[i * 4 + 1] &gt;&gt; 6;
        GST_WRITE_UINT16_BE (dy + i, Y0);
<span class="udiff-line-modified-removed">- }</span>
<span class="udiff-line-modified-added">+     }</span>
    }
  }
  
  #define PACK_I422_10LE GST_VIDEO_FORMAT_AYUV64, unpack_I422_10LE, 1, pack_I422_10LE
  static void
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3127,13 +3290,13 @@</span>
  
      if (x &amp; 1) {
        x = 0;
        su++;
        sv++;
<span class="udiff-line-added">+     }</span>
    }
  }
<span class="udiff-line-removed">- }</span>
  
  static void
  pack_I422_10LE (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3202,13 +3365,13 @@</span>
  
      if (x &amp; 1) {
        x = 0;
        su++;
        sv++;
<span class="udiff-line-added">+     }</span>
    }
  }
<span class="udiff-line-removed">- }</span>
  
  static void
  pack_I422_10BE (const GstVideoFormatInfo * info, GstVideoPackFlags flags,
      const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],
      const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4929,10 +5092,257 @@</span>
      if (num_comps &lt; 3)
        GST_WRITE_UINT32_LE (duv + i, UV);
    }
  }
  
<span class="udiff-line-added">+ #define PACK_NV12_10LE40 GST_VIDEO_FORMAT_AYUV64, unpack_NV12_10LE40, 1, pack_NV12_10LE40</span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ unpack_NV12_10LE40 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], gint x, gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   gint i;</span>
<span class="udiff-line-added">+   gint uv = GET_UV_420 (y, flags);</span>
<span class="udiff-line-added">+   guint16 *restrict d = dest;</span>
<span class="udiff-line-added">+   const guint8 *restrict sy = GET_PLANE_LINE (0, y);</span>
<span class="udiff-line-added">+   const guint8 *restrict suv = GET_PLANE_LINE (1, uv);</span>
<span class="udiff-line-added">+   guint16 Y0 = 0, Y1 = 0, Yn = 0, Un = 0, Vn = 0;</span>
<span class="udiff-line-added">+   guint32 UV = 0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width; i++) {</span>
<span class="udiff-line-added">+     gboolean update_c = FALSE;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     switch (i &amp; 3) {</span>
<span class="udiff-line-added">+       case 0:</span>
<span class="udiff-line-added">+         Y0 = GST_READ_UINT16_LE (sy);</span>
<span class="udiff-line-added">+         Yn = Y0 &amp; 0x3ff;</span>
<span class="udiff-line-added">+         sy += 2;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         UV = GST_READ_UINT32_LE (suv);</span>
<span class="udiff-line-added">+         Un = UV &amp; 0x3ff;</span>
<span class="udiff-line-added">+         Vn = (UV &gt;&gt; 10) &amp; 0x3ff;</span>
<span class="udiff-line-added">+         suv += 4;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Yn &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         Un &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         Vn &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         update_c = TRUE;</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+       case 1:</span>
<span class="udiff-line-added">+         Y1 = GST_READ_UINT16_LE (sy);</span>
<span class="udiff-line-added">+         Yn = (Y0 &gt;&gt; 10) | ((Y1 &amp; 0xf) &lt;&lt; 6);</span>
<span class="udiff-line-added">+         sy += 2;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Yn &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+       case 2:</span>
<span class="udiff-line-added">+         Yn = (Y1 &gt;&gt; 4) &amp; 0x3ff;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Un = (UV &gt;&gt; 20) &amp; 0x3ff;</span>
<span class="udiff-line-added">+         Vn = (UV &gt;&gt; 30);</span>
<span class="udiff-line-added">+         UV = GST_READ_UINT8 (suv);</span>
<span class="udiff-line-added">+         Vn |= (UV &lt;&lt; 2);</span>
<span class="udiff-line-added">+         suv++;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Yn &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         Un &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         Vn &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         update_c = TRUE;</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+       case 3:</span>
<span class="udiff-line-added">+         Y0 = GST_READ_UINT8 (sy);</span>
<span class="udiff-line-added">+         Yn = (Y1 &gt;&gt; 14) | (Y0 &lt;&lt; 2);</span>
<span class="udiff-line-added">+         sy++;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         Yn &lt;&lt;= 6;</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (!(flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)) {</span>
<span class="udiff-line-added">+       Yn |= Yn &gt;&gt; 10;</span>
<span class="udiff-line-added">+       if (update_c) {</span>
<span class="udiff-line-added">+         Un |= Un &gt;&gt; 10;</span>
<span class="udiff-line-added">+         Vn |= Vn &gt;&gt; 10;</span>
<span class="udiff-line-added">+       }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     d[i * 4 + 0] = 0xffff;</span>
<span class="udiff-line-added">+     d[i * 4 + 1] = Yn;</span>
<span class="udiff-line-added">+     d[i * 4 + 2] = Un;</span>
<span class="udiff-line-added">+     d[i * 4 + 3] = Vn;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ pack_NV12_10LE40 (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,</span>
<span class="udiff-line-added">+     gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   gint i;</span>
<span class="udiff-line-added">+   gint uv = GET_UV_420 (y, flags);</span>
<span class="udiff-line-added">+   guint8 *restrict dy = GET_PLANE_LINE (0, y);</span>
<span class="udiff-line-added">+   guint8 *restrict duv = GET_PLANE_LINE (1, uv);</span>
<span class="udiff-line-added">+   guint16 Y0 = 0, Y1 = 0, Y2 = 0, Y3 = 0, U0, V0 = 0, U1 = 0, V1 = 0;</span>
<span class="udiff-line-added">+   const guint16 *restrict s = src;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width; i++) {</span>
<span class="udiff-line-added">+     switch (i &amp; 3) {</span>
<span class="udiff-line-added">+       case 0:</span>
<span class="udiff-line-added">+         Y0 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-added">+         GST_WRITE_UINT8 (dy, Y0 &amp; 0xff);</span>
<span class="udiff-line-added">+         dy++;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (IS_CHROMA_LINE_420 (y, flags)) {</span>
<span class="udiff-line-added">+           U0 = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-added">+           V0 = s[i * 4 + 3] &gt;&gt; 6;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+           GST_WRITE_UINT8 (duv, U0 &amp; 0xff);</span>
<span class="udiff-line-added">+           duv++;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+           GST_WRITE_UINT8 (duv, (U0 &gt;&gt; 8) | ((V0 &amp; 0x3f) &lt;&lt; 2));</span>
<span class="udiff-line-added">+           duv++;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+       case 1:</span>
<span class="udiff-line-added">+         Y1 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-added">+         GST_WRITE_UINT8 (dy, (Y0 &gt;&gt; 8) | ((Y1 &amp; 0x3f) &lt;&lt; 2));</span>
<span class="udiff-line-added">+         dy++;</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+       case 2:</span>
<span class="udiff-line-added">+         Y2 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-added">+         GST_WRITE_UINT8 (dy, (Y1 &gt;&gt; 6) | ((Y2 &amp; 0xf) &lt;&lt; 4));</span>
<span class="udiff-line-added">+         dy++;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (IS_CHROMA_LINE_420 (y, flags)) {</span>
<span class="udiff-line-added">+           U1 = s[i * 4 + 2] &gt;&gt; 6;</span>
<span class="udiff-line-added">+           V1 = s[i * 4 + 3] &gt;&gt; 6;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+           GST_WRITE_UINT8 (duv, (V0 &gt;&gt; 6) | ((U1 &amp; 0xf) &lt;&lt; 4));</span>
<span class="udiff-line-added">+           duv++;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+           GST_WRITE_UINT8 (duv, (U1 &gt;&gt; 4) | ((V1 &amp; 0x3) &lt;&lt; 6));</span>
<span class="udiff-line-added">+           duv++;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+           GST_WRITE_UINT8 (duv, V1 &gt;&gt; 2);</span>
<span class="udiff-line-added">+           duv++;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+       case 3:</span>
<span class="udiff-line-added">+         Y3 = s[i * 4 + 1] &gt;&gt; 6;</span>
<span class="udiff-line-added">+         GST_WRITE_UINT8 (dy, (Y2 &gt;&gt; 4) | ((Y3 &amp; 0x3) &lt;&lt; 6));</span>
<span class="udiff-line-added">+         dy++;</span>
<span class="udiff-line-added">+         GST_WRITE_UINT8 (dy, (Y3 &gt;&gt; 2));</span>
<span class="udiff-line-added">+         dy++;</span>
<span class="udiff-line-added">+         break;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   switch (width &amp; 3) {</span>
<span class="udiff-line-added">+     case 0:</span>
<span class="udiff-line-added">+       break;</span>
<span class="udiff-line-added">+     case 1:</span>
<span class="udiff-line-added">+       GST_WRITE_UINT8 (dy, Y0 &gt;&gt; 8);</span>
<span class="udiff-line-added">+       if (IS_CHROMA_LINE_420 (y, flags))</span>
<span class="udiff-line-added">+         GST_WRITE_UINT8 (duv, V0 &gt;&gt; 6);</span>
<span class="udiff-line-added">+       break;</span>
<span class="udiff-line-added">+     case 2:</span>
<span class="udiff-line-added">+       GST_WRITE_UINT8 (dy, Y1 &gt;&gt; 6);</span>
<span class="udiff-line-added">+       if (IS_CHROMA_LINE_420 (y, flags))</span>
<span class="udiff-line-added">+         GST_WRITE_UINT8 (duv, V0 &gt;&gt; 6);</span>
<span class="udiff-line-added">+       break;</span>
<span class="udiff-line-added">+     case 3:</span>
<span class="udiff-line-added">+       GST_WRITE_UINT8 (dy, Y2 &gt;&gt; 4);</span>
<span class="udiff-line-added">+       break;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #define PACK_VUYA GST_VIDEO_FORMAT_AYUV, unpack_VUYA, 1, pack_VUYA</span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ unpack_VUYA (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], gint x, gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   const guint8 *restrict s = GET_LINE (y);</span>
<span class="udiff-line-added">+   guint8 *restrict d = dest;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   s += x * 4;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   video_orc_unpack_VUYA (d, s, width);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ pack_VUYA (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,</span>
<span class="udiff-line-added">+     gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   const guint8 *restrict s = src;</span>
<span class="udiff-line-added">+   guint8 *restrict d = GET_LINE (y);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   video_orc_pack_VUYA (d, s, width);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #define PACK_BGR10A2_LE GST_VIDEO_FORMAT_ARGB64, unpack_bgr10a2_le, 1, pack_bgr10a2_le</span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ unpack_bgr10a2_le (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     gpointer dest, const gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], gint x, gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   int i;</span>
<span class="udiff-line-added">+   const guint8 *restrict s = GET_LINE (y);</span>
<span class="udiff-line-added">+   guint16 *restrict d = dest;</span>
<span class="udiff-line-added">+   guint32 ARGB;</span>
<span class="udiff-line-added">+   guint16 A, R, G, B;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   s += x * 4;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width; i++) {</span>
<span class="udiff-line-added">+     ARGB = GST_READ_UINT32_LE (s + 4 * i);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     B = ((ARGB &gt;&gt; 0) &amp; 0x3ff) &lt;&lt; 6;</span>
<span class="udiff-line-added">+     G = ((ARGB &gt;&gt; 10) &amp; 0x3ff) &lt;&lt; 6;</span>
<span class="udiff-line-added">+     R = ((ARGB &gt;&gt; 20) &amp; 0x3ff) &lt;&lt; 6;</span>
<span class="udiff-line-added">+     A = ((ARGB &gt;&gt; 30) &amp; 0x03) &lt;&lt; 14;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (!(flags &amp; GST_VIDEO_PACK_FLAG_TRUNCATE_RANGE)) {</span>
<span class="udiff-line-added">+       B |= (B &gt;&gt; 10);</span>
<span class="udiff-line-added">+       G |= (G &gt;&gt; 10);</span>
<span class="udiff-line-added">+       R |= (R &gt;&gt; 10);</span>
<span class="udiff-line-added">+       A |= (A &gt;&gt; 10);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     d[4 * i + 0] = A;</span>
<span class="udiff-line-added">+     d[4 * i + 1] = R;</span>
<span class="udiff-line-added">+     d[4 * i + 2] = G;</span>
<span class="udiff-line-added">+     d[4 * i + 3] = B;</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ static void</span>
<span class="udiff-line-added">+ pack_bgr10a2_le (const GstVideoFormatInfo * info, GstVideoPackFlags flags,</span>
<span class="udiff-line-added">+     const gpointer src, gint sstride, gpointer data[GST_VIDEO_MAX_PLANES],</span>
<span class="udiff-line-added">+     const gint stride[GST_VIDEO_MAX_PLANES], GstVideoChromaSite chroma_site,</span>
<span class="udiff-line-added">+     gint y, gint width)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+   int i;</span>
<span class="udiff-line-added">+   guint32 *restrict d = GET_LINE (y);</span>
<span class="udiff-line-added">+   const guint16 *restrict s = src;</span>
<span class="udiff-line-added">+   guint32 ARGB;</span>
<span class="udiff-line-added">+   guint16 A, R, G, B;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+   for (i = 0; i &lt; width; i++) {</span>
<span class="udiff-line-added">+     A = s[4 * i] &amp; 0xc000;</span>
<span class="udiff-line-added">+     R = s[4 * i + 1] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     G = s[4 * i + 2] &amp; 0xffc0;</span>
<span class="udiff-line-added">+     B = s[4 * i + 3] &amp; 0xffc0;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ARGB = (B &gt;&gt; 6) | (G &lt;&lt; 4) | (R &lt;&lt; 14) | (A &lt;&lt; 16);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     GST_WRITE_UINT32_LE (d + i, ARGB);</span>
<span class="udiff-line-added">+   }</span>
<span class="udiff-line-added">+ }</span>
  
  typedef struct
  {
    guint32 fourcc;
    GstVideoFormatInfo info;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4947,10 +5357,11 @@</span>
  #define DPTH8880         8, 4, { 0, 0, 0, 0 }, { 8, 8, 8, 0 }
  #define DPTH10           10, 1, { 0, 0, 0, 0 }, { 10, 0, 0, 0 }
  #define DPTH10_10_10     10, 3, { 0, 0, 0, 0 }, { 10, 10, 10, 0 }
  #define DPTH10_10_10_10  10, 4, { 0, 0, 0, 0 }, { 10, 10, 10, 10 }
  #define DPTH10_10_10_HI  16, 3, { 6, 6, 6, 0 }, { 10, 10, 10, 0 }
<span class="udiff-line-added">+ #define DPTH10_10_10_2   10, 4, { 0, 0, 0, 0 }, { 10, 10, 10, 2}</span>
  #define DPTH12_12_12     12, 3, { 0, 0, 0, 0 }, { 12, 12, 12, 0 }
  #define DPTH12_12_12_12  12, 4, { 0, 0, 0, 0 }, { 12, 12, 12, 12 }
  #define DPTH16           16, 1, { 0, 0, 0, 0 }, { 16, 0, 0, 0 }
  #define DPTH16_16_16     16, 3, { 0, 0, 0, 0 }, { 16, 16, 16, 0 }
  #define DPTH16_16_16_16  16, 4, { 0, 0, 0, 0 }, { 16, 16, 16, 16 }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5217,22 +5628,21 @@</span>
        DPTH888, PSTR333, PLANE0, OFFS102, SUB444, PACK_IYU2),
    MAKE_YUV_FORMAT (VYUY, &quot;raw video&quot;, GST_MAKE_FOURCC (&#39;V&#39;, &#39;Y&#39;, &#39;U&#39;, &#39;Y&#39;),
        DPTH888, PSTR244, PLANE0, OFFS102, SUB422, PACK_VYUY),
    MAKE_RGBA_FORMAT (GBRA, &quot;raw video&quot;, DPTH8888, PSTR1111, PLANE2013,
        OFFS0, SUB4444, PACK_GBRA),
<span class="udiff-line-modified-removed">-   MAKE_RGBA_FORMAT (GBRA_10BE, &quot;raw video&quot;, DPTH10_10_10_10, PSTR222, PLANE2013,</span>
<span class="udiff-line-modified-removed">-       OFFS0, SUB4444, PACK_GBRA_10BE),</span>
<span class="udiff-line-modified-removed">-   MAKE_RGBA_LE_FORMAT (GBRA_10LE, &quot;raw video&quot;, DPTH10_10_10_10, PSTR222,</span>
<span class="udiff-line-modified-removed">-       PLANE2013,</span>
<span class="udiff-line-removed">-       OFFS0, SUB4444, PACK_GBRA_10LE),</span>
<span class="udiff-line-modified-added">+   MAKE_RGBA_FORMAT (GBRA_10BE, &quot;raw video&quot;, DPTH10_10_10_10, PSTR2222,</span>
<span class="udiff-line-modified-added">+       PLANE2013, OFFS0, SUB4444, PACK_GBRA_10BE),</span>
<span class="udiff-line-modified-added">+   MAKE_RGBA_LE_FORMAT (GBRA_10LE, &quot;raw video&quot;, DPTH10_10_10_10, PSTR2222,</span>
<span class="udiff-line-modified-added">+       PLANE2013, OFFS0, SUB4444, PACK_GBRA_10LE),</span>
    MAKE_RGB_FORMAT (GBR_12BE, &quot;raw video&quot;, DPTH12_12_12, PSTR222, PLANE201,
        OFFS0, SUB444, PACK_GBR_12BE),
    MAKE_RGB_LE_FORMAT (GBR_12LE, &quot;raw video&quot;, DPTH12_12_12, PSTR222, PLANE201,
        OFFS0, SUB444, PACK_GBR_12LE),
<span class="udiff-line-modified-removed">-   MAKE_RGBA_FORMAT (GBRA_12BE, &quot;raw video&quot;, DPTH12_12_12_12, PSTR222, PLANE2013,</span>
<span class="udiff-line-modified-removed">-       OFFS0, SUB4444, PACK_GBRA_12BE),</span>
<span class="udiff-line-modified-removed">-   MAKE_RGBA_LE_PACK_FORMAT (GBRA_12LE, &quot;raw video&quot;, DPTH12_12_12_12, PSTR222,</span>
<span class="udiff-line-modified-added">+   MAKE_RGBA_FORMAT (GBRA_12BE, &quot;raw video&quot;, DPTH12_12_12_12, PSTR2222,</span>
<span class="udiff-line-modified-added">+       PLANE2013, OFFS0, SUB4444, PACK_GBRA_12BE),</span>
<span class="udiff-line-modified-added">+   MAKE_RGBA_LE_PACK_FORMAT (GBRA_12LE, &quot;raw video&quot;, DPTH12_12_12_12, PSTR2222,</span>
        PLANE2013, OFFS0, SUB4444, PACK_GBRA_12LE),
    MAKE_YUV_FORMAT (I420_12BE, &quot;raw video&quot;, 0x00000000, DPTH12_12_12,
        PSTR222, PLANE012, OFFS0, SUB420, PACK_I420_12BE),
    MAKE_YUV_LE_FORMAT (I420_12LE, &quot;raw video&quot;, 0x00000000, DPTH12_12_12,
        PSTR222, PLANE012, OFFS0, SUB420, PACK_I420_12LE),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5250,10 +5660,22 @@</span>
        GST_MAKE_FOURCC (&#39;X&#39;, &#39;V&#39;, &#39;1&#39;, &#39;5&#39;), DPTH10_10_10, PSTR0, PLANE011,
        OFFS001, SUB420, PACK_NV12_10LE32),
    MAKE_YUV_C_LE_FORMAT (NV16_10LE32, &quot;raw video&quot;,
        GST_MAKE_FOURCC (&#39;X&#39;, &#39;V&#39;, &#39;2&#39;, &#39;0&#39;), DPTH10_10_10, PSTR0, PLANE011,
        OFFS001, SUB422, PACK_NV16_10LE32),
<span class="udiff-line-added">+   MAKE_YUV_C_LE_FORMAT (NV12_10LE40, &quot;raw video&quot;,</span>
<span class="udiff-line-added">+       GST_MAKE_FOURCC (&#39;R&#39;, &#39;K&#39;, &#39;2&#39;, &#39;0&#39;), DPTH10_10_10, PSTR0, PLANE011,</span>
<span class="udiff-line-added">+       OFFS0, SUB420, PACK_NV12_10LE40),</span>
<span class="udiff-line-added">+   MAKE_YUV_FORMAT (Y210, &quot;raw video&quot;, GST_MAKE_FOURCC (&#39;Y&#39;, &#39;2&#39;, &#39;1&#39;, &#39;0&#39;),</span>
<span class="udiff-line-added">+       DPTH10_10_10, PSTR488, PLANE0, OFFS0, SUB422, PACK_Y210),</span>
<span class="udiff-line-added">+   MAKE_YUV_FORMAT (Y410, &quot;raw video&quot;, GST_MAKE_FOURCC (&#39;Y&#39;, &#39;4&#39;, &#39;1&#39;, &#39;0&#39;),</span>
<span class="udiff-line-added">+       DPTH10_10_10_2, PSTR0, PLANE0, OFFS0, SUB4444, PACK_Y410),</span>
<span class="udiff-line-added">+   MAKE_YUVA_PACK_FORMAT (VUYA, &quot;raw video&quot;, GST_MAKE_FOURCC (&#39;V&#39;, &#39;U&#39;, &#39;Y&#39;,</span>
<span class="udiff-line-added">+           &#39;A&#39;), DPTH8888, PSTR4444, PLANE0, OFFS2103, SUB4444, PACK_VUYA),</span>
<span class="udiff-line-added">+   MAKE_RGBA_LE_PACK_FORMAT (BGR10A2_LE, &quot;raw video&quot;, DPTH10_10_10_2, PSTR4444,</span>
<span class="udiff-line-added">+       PLANE0,</span>
<span class="udiff-line-added">+       OFFS0, SUB4444, PACK_BGR10A2_LE),</span>
  };
  
  static GstVideoFormat
  gst_video_format_from_rgb32_masks (int red_mask, int green_mask, int blue_mask)
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5368,11 +5790,12 @@</span>
      guint red_mask, guint green_mask, guint blue_mask, guint alpha_mask)
  {
    GstVideoFormat format;
  
    /* our caps system handles 24/32bpp RGB as big-endian. */
<span class="udiff-line-modified-removed">-   if ((bpp == 24 || bpp == 32) &amp;&amp; endianness == G_LITTLE_ENDIAN) {</span>
<span class="udiff-line-modified-added">+   if ((bpp == 24 || bpp == 32) &amp;&amp; endianness == G_LITTLE_ENDIAN &amp;&amp;</span>
<span class="udiff-line-added">+       alpha_mask != 0xc0000000) {</span>
      red_mask = GUINT32_TO_BE (red_mask);
      green_mask = GUINT32_TO_BE (green_mask);
      blue_mask = GUINT32_TO_BE (blue_mask);
      alpha_mask = GUINT32_TO_BE (alpha_mask);
      endianness = G_BIG_ENDIAN;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5381,11 +5804,14 @@</span>
        green_mask &gt;&gt;= 8;
        blue_mask &gt;&gt;= 8;
      }
    }
  
<span class="udiff-line-modified-removed">-   if (depth == 30 &amp;&amp; bpp == 32) {</span>
<span class="udiff-line-modified-added">+   if (depth == 32 &amp;&amp; bpp == 32 &amp;&amp; alpha_mask == 0xc0000000 &amp;&amp;</span>
<span class="udiff-line-added">+       endianness == G_LITTLE_ENDIAN) {</span>
<span class="udiff-line-added">+     format = GST_VIDEO_FORMAT_BGR10A2_LE;</span>
<span class="udiff-line-added">+   } else if (depth == 30 &amp;&amp; bpp == 32) {</span>
      format = GST_VIDEO_FORMAT_r210;
    } else if (depth == 24 &amp;&amp; bpp == 32) {
      format = gst_video_format_from_rgb32_masks (red_mask, green_mask,
          blue_mask);
    } else if (depth == 32 &amp;&amp; bpp == 32 &amp;&amp; alpha_mask) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5450,10 +5876,12 @@</span>
        return GST_VIDEO_FORMAT_Y444;
      case GST_MAKE_FOURCC (&#39;v&#39;, &#39;2&#39;, &#39;1&#39;, &#39;0&#39;):
        return GST_VIDEO_FORMAT_v210;
      case GST_MAKE_FOURCC (&#39;v&#39;, &#39;2&#39;, &#39;1&#39;, &#39;6&#39;):
        return GST_VIDEO_FORMAT_v216;
<span class="udiff-line-added">+     case GST_MAKE_FOURCC (&#39;Y&#39;, &#39;2&#39;, &#39;1&#39;, &#39;0&#39;):</span>
<span class="udiff-line-added">+       return GST_VIDEO_FORMAT_Y210;</span>
      case GST_MAKE_FOURCC (&#39;N&#39;, &#39;V&#39;, &#39;1&#39;, &#39;2&#39;):
        return GST_VIDEO_FORMAT_NV12;
      case GST_MAKE_FOURCC (&#39;N&#39;, &#39;V&#39;, &#39;2&#39;, &#39;1&#39;):
        return GST_VIDEO_FORMAT_NV21;
      case GST_MAKE_FOURCC (&#39;N&#39;, &#39;V&#39;, &#39;1&#39;, &#39;6&#39;):
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5488,10 +5916,19 @@</span>
        return GST_VIDEO_FORMAT_GRAY10_LE32;
      case GST_MAKE_FOURCC (&#39;X&#39;, &#39;V&#39;, &#39;1&#39;, &#39;5&#39;):
        return GST_VIDEO_FORMAT_NV12_10LE32;
      case GST_MAKE_FOURCC (&#39;X&#39;, &#39;V&#39;, &#39;2&#39;, &#39;0&#39;):
        return GST_VIDEO_FORMAT_NV16_10LE32;
<span class="udiff-line-added">+     case GST_MAKE_FOURCC (&#39;R&#39;, &#39;K&#39;, &#39;2&#39;, &#39;0&#39;):</span>
<span class="udiff-line-added">+       return GST_VIDEO_FORMAT_NV12_10LE40;</span>
<span class="udiff-line-added">+     case GST_MAKE_FOURCC (&#39;Y&#39;, &#39;4&#39;, &#39;1&#39;, &#39;0&#39;):</span>
<span class="udiff-line-added">+       return GST_VIDEO_FORMAT_Y410;</span>
<span class="udiff-line-added">+     case GST_MAKE_FOURCC (&#39;V&#39;, &#39;U&#39;, &#39;Y&#39;, &#39;A&#39;):</span>
<span class="udiff-line-added">+       return GST_VIDEO_FORMAT_VUYA;</span>
<span class="udiff-line-added">+     case GST_MAKE_FOURCC (&#39;A&#39;, &#39;R&#39;, &#39;3&#39;, &#39;0&#39;):</span>
<span class="udiff-line-added">+       return GST_VIDEO_FORMAT_BGR10A2_LE;</span>
<span class="udiff-line-added">+ </span>
      default:
        return GST_VIDEO_FORMAT_UNKNOWN;
    }
  }
  
</pre>
<center><a href="video-event.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="video-format.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>