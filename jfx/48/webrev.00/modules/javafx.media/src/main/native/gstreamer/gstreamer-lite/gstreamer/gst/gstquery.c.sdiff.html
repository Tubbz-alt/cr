<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/gst/gstquery.c</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="gstquark.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gstquery.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.media/src/main/native/gstreamer/gstreamer-lite/gstreamer/gst/gstquery.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  88 static GstQueryQuarks query_quarks[] = {
  89   {GST_QUERY_UNKNOWN, &quot;unknown&quot;, 0},
  90   {GST_QUERY_POSITION, &quot;position&quot;, 0},
  91   {GST_QUERY_DURATION, &quot;duration&quot;, 0},
  92   {GST_QUERY_LATENCY, &quot;latency&quot;, 0},
  93   {GST_QUERY_JITTER, &quot;jitter&quot;, 0},
  94   {GST_QUERY_RATE, &quot;rate&quot;, 0},
  95   {GST_QUERY_SEEKING, &quot;seeking&quot;, 0},
  96   {GST_QUERY_SEGMENT, &quot;segment&quot;, 0},
  97   {GST_QUERY_CONVERT, &quot;convert&quot;, 0},
  98   {GST_QUERY_FORMATS, &quot;formats&quot;, 0},
  99   {GST_QUERY_BUFFERING, &quot;buffering&quot;, 0},
 100   {GST_QUERY_CUSTOM, &quot;custom&quot;, 0},
 101   {GST_QUERY_URI, &quot;uri&quot;, 0},
 102   {GST_QUERY_ALLOCATION, &quot;allocation&quot;, 0},
 103   {GST_QUERY_SCHEDULING, &quot;scheduling&quot;, 0},
 104   {GST_QUERY_ACCEPT_CAPS, &quot;accept-caps&quot;, 0},
 105   {GST_QUERY_CAPS, &quot;caps&quot;, 0},
 106   {GST_QUERY_DRAIN, &quot;drain&quot;, 0},
 107   {GST_QUERY_CONTEXT, &quot;context&quot;, 0},

 108 
 109   {0, NULL, 0}
 110 };
 111 
 112 GST_DEFINE_MINI_OBJECT_TYPE (GstQuery, gst_query);
 113 
 114 void
 115 _priv_gst_query_initialize (void)
 116 {
 117   gint i;
 118 
 119   _gst_query_type = gst_query_get_type ();
 120 
 121   GST_DEBUG_CATEGORY_INIT (gst_query_debug, &quot;query&quot;, 0, &quot;query system&quot;);
 122 
 123   for (i = 0; query_quarks[i].name; i++) {
 124     query_quarks[i].quark = g_quark_from_static_string (query_quarks[i].name);
 125   }
 126 }
 127 
</pre>
<hr />
<pre>
 178 {
 179   GstQueryTypeFlags ret;
 180 
 181   ret = type &amp; ((1 &lt;&lt; GST_QUERY_NUM_SHIFT) - 1);
 182 
 183   return ret;
 184 }
 185 
 186 static void
 187 _gst_query_free (GstQuery * query)
 188 {
 189   GstStructure *s;
 190 
 191   g_return_if_fail (query != NULL);
 192 
 193   s = GST_QUERY_STRUCTURE (query);
 194   if (s) {
 195     gst_structure_set_parent_refcount (s, NULL);
 196     gst_structure_free (s);
 197   }



 198 
 199   g_slice_free1 (sizeof (GstQueryImpl), query);
 200 }
 201 
 202 static GstQuery *
 203 _gst_query_copy (GstQuery * query)
 204 {
 205   GstQuery *copy;
 206   GstStructure *s;
 207 
 208   s = GST_QUERY_STRUCTURE (query);
 209   if (s) {
 210     s = gst_structure_copy (s);
 211   }
 212   copy = gst_query_new_custom (query-&gt;type, s);
 213 
 214   return copy;
 215 }
 216 
 217 /**
</pre>
<hr />
<pre>
 727  * Returns: (transfer none): the #GstStructure of the query. The structure is
 728  *     still owned by the query and will therefore be freed when the query
 729  *     is unreffed.
 730  */
 731 GstStructure *
 732 gst_query_writable_structure (GstQuery * query)
 733 {
 734   GstStructure *structure;
 735 
 736   g_return_val_if_fail (GST_IS_QUERY (query), NULL);
 737   g_return_val_if_fail (gst_query_is_writable (query), NULL);
 738 
 739   structure = GST_QUERY_STRUCTURE (query);
 740 
 741   if (structure == NULL) {
 742     structure =
 743         gst_structure_new_id_empty (gst_query_type_to_quark (GST_QUERY_TYPE
 744             (query)));
 745     gst_structure_set_parent_refcount (structure, &amp;query-&gt;mini_object.refcount);
 746     GST_QUERY_STRUCTURE (query) = structure;
<span class="line-modified"> 747 }</span>
 748   return structure;
 749 }
 750 
 751 /**
 752  * gst_query_new_seeking:
 753  * @format: the default #GstFormat for the new query
 754  *
 755  * Constructs a new query object for querying seeking properties of
 756  * the stream.
 757  *
 758  * Free-function: gst_query_unref()
 759  *
 760  * Returns: (transfer full): a new #GstQuery
 761  */
 762 GstQuery *
 763 gst_query_new_seeking (GstFormat format)
 764 {
 765   GstQuery *query;
 766   GstStructure *structure;
 767 
</pre>
<hr />
<pre>
2634  *
2635  * Since: 1.2
2636  */
2637 gboolean
2638 gst_query_parse_context_type (GstQuery * query, const gchar ** context_type)
2639 {
2640   GstStructure *structure;
2641   const GValue *value;
2642 
2643   g_return_val_if_fail (GST_QUERY_TYPE (query) == GST_QUERY_CONTEXT, FALSE);
2644 
2645   structure = GST_QUERY_STRUCTURE (query);
2646 
2647   if (context_type) {
2648     value = gst_structure_id_get_value (structure, GST_QUARK (CONTEXT_TYPE));
2649     *context_type = g_value_get_string (value);
2650   }
2651 
2652   return TRUE;
2653 }








































































</pre>
</td>
<td>
<hr />
<pre>
  88 static GstQueryQuarks query_quarks[] = {
  89   {GST_QUERY_UNKNOWN, &quot;unknown&quot;, 0},
  90   {GST_QUERY_POSITION, &quot;position&quot;, 0},
  91   {GST_QUERY_DURATION, &quot;duration&quot;, 0},
  92   {GST_QUERY_LATENCY, &quot;latency&quot;, 0},
  93   {GST_QUERY_JITTER, &quot;jitter&quot;, 0},
  94   {GST_QUERY_RATE, &quot;rate&quot;, 0},
  95   {GST_QUERY_SEEKING, &quot;seeking&quot;, 0},
  96   {GST_QUERY_SEGMENT, &quot;segment&quot;, 0},
  97   {GST_QUERY_CONVERT, &quot;convert&quot;, 0},
  98   {GST_QUERY_FORMATS, &quot;formats&quot;, 0},
  99   {GST_QUERY_BUFFERING, &quot;buffering&quot;, 0},
 100   {GST_QUERY_CUSTOM, &quot;custom&quot;, 0},
 101   {GST_QUERY_URI, &quot;uri&quot;, 0},
 102   {GST_QUERY_ALLOCATION, &quot;allocation&quot;, 0},
 103   {GST_QUERY_SCHEDULING, &quot;scheduling&quot;, 0},
 104   {GST_QUERY_ACCEPT_CAPS, &quot;accept-caps&quot;, 0},
 105   {GST_QUERY_CAPS, &quot;caps&quot;, 0},
 106   {GST_QUERY_DRAIN, &quot;drain&quot;, 0},
 107   {GST_QUERY_CONTEXT, &quot;context&quot;, 0},
<span class="line-added"> 108   {GST_QUERY_BITRATE, &quot;bitrate&quot;, 0},</span>
 109 
 110   {0, NULL, 0}
 111 };
 112 
 113 GST_DEFINE_MINI_OBJECT_TYPE (GstQuery, gst_query);
 114 
 115 void
 116 _priv_gst_query_initialize (void)
 117 {
 118   gint i;
 119 
 120   _gst_query_type = gst_query_get_type ();
 121 
 122   GST_DEBUG_CATEGORY_INIT (gst_query_debug, &quot;query&quot;, 0, &quot;query system&quot;);
 123 
 124   for (i = 0; query_quarks[i].name; i++) {
 125     query_quarks[i].quark = g_quark_from_static_string (query_quarks[i].name);
 126   }
 127 }
 128 
</pre>
<hr />
<pre>
 179 {
 180   GstQueryTypeFlags ret;
 181 
 182   ret = type &amp; ((1 &lt;&lt; GST_QUERY_NUM_SHIFT) - 1);
 183 
 184   return ret;
 185 }
 186 
 187 static void
 188 _gst_query_free (GstQuery * query)
 189 {
 190   GstStructure *s;
 191 
 192   g_return_if_fail (query != NULL);
 193 
 194   s = GST_QUERY_STRUCTURE (query);
 195   if (s) {
 196     gst_structure_set_parent_refcount (s, NULL);
 197     gst_structure_free (s);
 198   }
<span class="line-added"> 199 #ifdef USE_POISONING</span>
<span class="line-added"> 200   memset (query, 0xff, sizeof (GstQueryImpl));</span>
<span class="line-added"> 201 #endif</span>
 202 
 203   g_slice_free1 (sizeof (GstQueryImpl), query);
 204 }
 205 
 206 static GstQuery *
 207 _gst_query_copy (GstQuery * query)
 208 {
 209   GstQuery *copy;
 210   GstStructure *s;
 211 
 212   s = GST_QUERY_STRUCTURE (query);
 213   if (s) {
 214     s = gst_structure_copy (s);
 215   }
 216   copy = gst_query_new_custom (query-&gt;type, s);
 217 
 218   return copy;
 219 }
 220 
 221 /**
</pre>
<hr />
<pre>
 731  * Returns: (transfer none): the #GstStructure of the query. The structure is
 732  *     still owned by the query and will therefore be freed when the query
 733  *     is unreffed.
 734  */
 735 GstStructure *
 736 gst_query_writable_structure (GstQuery * query)
 737 {
 738   GstStructure *structure;
 739 
 740   g_return_val_if_fail (GST_IS_QUERY (query), NULL);
 741   g_return_val_if_fail (gst_query_is_writable (query), NULL);
 742 
 743   structure = GST_QUERY_STRUCTURE (query);
 744 
 745   if (structure == NULL) {
 746     structure =
 747         gst_structure_new_id_empty (gst_query_type_to_quark (GST_QUERY_TYPE
 748             (query)));
 749     gst_structure_set_parent_refcount (structure, &amp;query-&gt;mini_object.refcount);
 750     GST_QUERY_STRUCTURE (query) = structure;
<span class="line-modified"> 751   }</span>
 752   return structure;
 753 }
 754 
 755 /**
 756  * gst_query_new_seeking:
 757  * @format: the default #GstFormat for the new query
 758  *
 759  * Constructs a new query object for querying seeking properties of
 760  * the stream.
 761  *
 762  * Free-function: gst_query_unref()
 763  *
 764  * Returns: (transfer full): a new #GstQuery
 765  */
 766 GstQuery *
 767 gst_query_new_seeking (GstFormat format)
 768 {
 769   GstQuery *query;
 770   GstStructure *structure;
 771 
</pre>
<hr />
<pre>
2638  *
2639  * Since: 1.2
2640  */
2641 gboolean
2642 gst_query_parse_context_type (GstQuery * query, const gchar ** context_type)
2643 {
2644   GstStructure *structure;
2645   const GValue *value;
2646 
2647   g_return_val_if_fail (GST_QUERY_TYPE (query) == GST_QUERY_CONTEXT, FALSE);
2648 
2649   structure = GST_QUERY_STRUCTURE (query);
2650 
2651   if (context_type) {
2652     value = gst_structure_id_get_value (structure, GST_QUARK (CONTEXT_TYPE));
2653     *context_type = g_value_get_string (value);
2654   }
2655 
2656   return TRUE;
2657 }
<span class="line-added">2658 </span>
<span class="line-added">2659 /**</span>
<span class="line-added">2660  * gst_query_new_bitrate:</span>
<span class="line-added">2661  *</span>
<span class="line-added">2662  * Constructs a new query object for querying the bitrate.</span>
<span class="line-added">2663  *</span>
<span class="line-added">2664  * Free-function: gst_query_unref()</span>
<span class="line-added">2665  *</span>
<span class="line-added">2666  * Returns: (transfer full): a new #GstQuery</span>
<span class="line-added">2667  *</span>
<span class="line-added">2668  * Since: 1.16</span>
<span class="line-added">2669  */</span>
<span class="line-added">2670 GstQuery *</span>
<span class="line-added">2671 gst_query_new_bitrate (void)</span>
<span class="line-added">2672 {</span>
<span class="line-added">2673   GstQuery *query;</span>
<span class="line-added">2674   GstStructure *structure;</span>
<span class="line-added">2675 </span>
<span class="line-added">2676   structure = gst_structure_new_id_empty (GST_QUARK (QUERY_BITRATE));</span>
<span class="line-added">2677   query = gst_query_new_custom (GST_QUERY_BITRATE, structure);</span>
<span class="line-added">2678 </span>
<span class="line-added">2679   return query;</span>
<span class="line-added">2680 }</span>
<span class="line-added">2681 </span>
<span class="line-added">2682 /**</span>
<span class="line-added">2683  * gst_query_set_bitrate:</span>
<span class="line-added">2684  * @query: a GST_QUERY_BITRATE type #GstQuery</span>
<span class="line-added">2685  * @nominal_bitrate: the nominal bitrate in bits per second</span>
<span class="line-added">2686  *</span>
<span class="line-added">2687  * Set the results of a bitrate query.  The nominal bitrate is the average</span>
<span class="line-added">2688  * bitrate expected over the length of the stream as advertised in file</span>
<span class="line-added">2689  * headers (or similar).</span>
<span class="line-added">2690  *</span>
<span class="line-added">2691  * Since: 1.16</span>
<span class="line-added">2692  */</span>
<span class="line-added">2693 void</span>
<span class="line-added">2694 gst_query_set_bitrate (GstQuery * query, guint nominal_bitrate)</span>
<span class="line-added">2695 {</span>
<span class="line-added">2696   GstStructure *s;</span>
<span class="line-added">2697 </span>
<span class="line-added">2698   g_return_if_fail (GST_QUERY_TYPE (query) == GST_QUERY_BITRATE);</span>
<span class="line-added">2699 </span>
<span class="line-added">2700   s = GST_QUERY_STRUCTURE (query);</span>
<span class="line-added">2701 </span>
<span class="line-added">2702   gst_structure_id_set (s,</span>
<span class="line-added">2703       GST_QUARK (NOMINAL_BITRATE), G_TYPE_UINT, nominal_bitrate, NULL);</span>
<span class="line-added">2704 }</span>
<span class="line-added">2705 </span>
<span class="line-added">2706 /**</span>
<span class="line-added">2707  * gst_query_parse_bitrate:</span>
<span class="line-added">2708  * @query: a GST_QUERY_BITRATE type #GstQuery</span>
<span class="line-added">2709  * @nominal_bitrate: (out) (allow-none): The resulting bitrate in bits per second</span>
<span class="line-added">2710  *</span>
<span class="line-added">2711  * Get the results of a bitrate query. See also gst_query_set_bitrate().</span>
<span class="line-added">2712  *</span>
<span class="line-added">2713  * Since: 1.16</span>
<span class="line-added">2714  */</span>
<span class="line-added">2715 void</span>
<span class="line-added">2716 gst_query_parse_bitrate (GstQuery * query, guint * nominal_bitrate)</span>
<span class="line-added">2717 {</span>
<span class="line-added">2718   GstStructure *structure;</span>
<span class="line-added">2719   const GValue *value;</span>
<span class="line-added">2720 </span>
<span class="line-added">2721   g_return_if_fail (GST_QUERY_TYPE (query) == GST_QUERY_BITRATE);</span>
<span class="line-added">2722 </span>
<span class="line-added">2723   structure = GST_QUERY_STRUCTURE (query);</span>
<span class="line-added">2724 </span>
<span class="line-added">2725   if (nominal_bitrate) {</span>
<span class="line-added">2726     value = gst_structure_id_get_value (structure, GST_QUARK (NOMINAL_BITRATE));</span>
<span class="line-added">2727     *nominal_bitrate = g_value_get_uint (value);</span>
<span class="line-added">2728   }</span>
<span class="line-added">2729 }</span>
</pre>
</td>
</tr>
</table>
<center><a href="gstquark.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="gstquery.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>