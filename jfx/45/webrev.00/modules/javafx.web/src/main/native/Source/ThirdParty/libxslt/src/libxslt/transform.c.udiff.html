<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/ThirdParty/libxslt/src/libxslt/transform.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="templates.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="variables.c.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/libxslt/src/libxslt/transform.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -230,10 +230,12 @@</span>
          ctxt-&gt;vars = ctxt-&gt;varsTab[ctxt-&gt;varsNr - 1];
      else
          ctxt-&gt;vars = NULL;
  }
  
<span class="udiff-line-added">+ #ifdef WITH_PROFILER</span>
<span class="udiff-line-added">+ </span>
  /**
   * profPush:
   * @ctxt: the transformation context
   * @value:  the profiling value to push on the stack
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -338,10 +340,12 @@</span>
          templ-&gt;templCountTab[templ-&gt;templNr] = 1;
          templ-&gt;templNr++;
      }
  }
  
<span class="udiff-line-added">+ #endif /* WITH_PROFILER */</span>
<span class="udiff-line-added">+ </span>
  /**
   * xsltPreCompEval:
   * @ctxt: transform context
   * @node: context node
   * @comp: precompiled expression
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1088,10 +1092,12 @@</span>
          copy-&gt;content = cur-&gt;content;
      else {
          if ((copy-&gt;content = xmlStrdup(cur-&gt;content)) == NULL)
          return NULL;
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ctxt-&gt;lasttext = NULL;</span>
      } else {
          /*
       * normal processing. keep counters to extend the text node
       * in xsltAddTextString if needed.
       */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2203,10 +2209,11 @@</span>
  
      ctxt-&gt;currentTemplateRule = oldCurTempRule;
      }
  }
  
<span class="udiff-line-added">+ #ifdef WITH_DEBUGGER</span>
  static xmlNodePtr
  xsltDebuggerStartSequenceConstructor(xsltTransformContextPtr ctxt,
                       xmlNodePtr contextNode,
                       xmlNodePtr list,
                       xsltTemplatePtr templ,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2238,10 +2245,11 @@</span>
              debugedNode = ctxt-&gt;inst;
          }
      }
      return(debugedNode);
  }
<span class="udiff-line-added">+ #endif /* WITH_DEBUGGER */</span>
  
  /**
   * xsltLocalVariablePush:
   * @ctxt: the transformation context
   * @variable: variable to be pushed to the variable stack
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2409,10 +2417,21 @@</span>
      /*
      * Process the sequence constructor.
      */
      cur = list;
      while (cur != NULL) {
<span class="udiff-line-added">+         if (ctxt-&gt;opLimit != 0) {</span>
<span class="udiff-line-added">+             if (ctxt-&gt;opCount &gt;= ctxt-&gt;opLimit) {</span>
<span class="udiff-line-added">+         xsltTransformError(ctxt, NULL, cur,</span>
<span class="udiff-line-added">+             &quot;xsltApplySequenceConstructor: &quot;</span>
<span class="udiff-line-added">+                     &quot;Operation limit exceeded\n&quot;);</span>
<span class="udiff-line-added">+             ctxt-&gt;state = XSLT_STATE_STOPPED;</span>
<span class="udiff-line-added">+                 goto error;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+             ctxt-&gt;opCount += 1;</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
          ctxt-&gt;inst = cur;
  
  #ifdef WITH_DEBUGGER
          switch (ctxt-&gt;debugStatus) {
              case XSLT_DEBUG_RUN_RESTART:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2865,10 +2884,11 @@</span>
                      cur-&gt;name));
  #endif
                  /*
                   * Search if there are fallbacks
                   */
<span class="udiff-line-added">+                 ctxt-&gt;insert = insert;</span>
                  child = cur-&gt;children;
                  while (child != NULL) {
                      if ((IS_XSLT_ELEM(child)) &amp;&amp;
                          (IS_XSLT_NAME(child, &quot;fallback&quot;)))
              {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2876,10 +2896,11 @@</span>
                          xsltApplySequenceConstructor(ctxt, contextNode,
                  child-&gt;children, NULL);
                      }
                      child = child-&gt;next;
                  }
<span class="udiff-line-added">+                 ctxt-&gt;insert = oldInsert;</span>
  
                  if (!found) {
                      xsltTransformError(ctxt, NULL, cur,
              &quot;xsltApplySequenceConstructor: failed to find extension %s\n&quot;,
              cur-&gt;name);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3084,14 +3105,16 @@</span>
                xmlNodePtr list,
                xsltTemplatePtr templ,
                xsltStackElemPtr withParams)
  {
      int oldVarsBase = 0;
<span class="udiff-line-removed">-     long start = 0;</span>
      xmlNodePtr cur;
      xsltStackElemPtr tmpParam = NULL;
      xmlDocPtr oldUserFragmentTop;
<span class="udiff-line-added">+ #ifdef WITH_PROFILER</span>
<span class="udiff-line-added">+     long start = 0;</span>
<span class="udiff-line-added">+ #endif</span>
  
  #ifdef XSLT_REFACTORED
      xsltStyleItemParamPtr iparam;
  #else
      xsltStylePreCompPtr iparam;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3142,16 +3165,20 @@</span>
      */
      oldVarsBase = ctxt-&gt;varsBase;
      ctxt-&gt;varsBase = ctxt-&gt;varsNr;
  
      ctxt-&gt;node = contextNode;
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #ifdef WITH_PROFILER</span>
      if (ctxt-&gt;profile) {
      templ-&gt;nbCalls++;
      start = xsltTimestamp();
      profPush(ctxt, 0);
      profCallgraphAdd(templ, ctxt-&gt;templ);
      }
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
      /*
      * Push the xsl:template declaration onto the stack.
      */
      templPush(ctxt, templ);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3255,10 +3282,12 @@</span>
  
      /*
      * Pop the xsl:template declaration from the stack.
      */
      templPop(ctxt);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #ifdef WITH_PROFILER</span>
      if (ctxt-&gt;profile) {
      long spent, child, total, end;
  
      end = xsltTimestamp();
      child = profPop(ctxt);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3275,10 +3304,11 @@</span>
  
      templ-&gt;time += spent;
      if (ctxt-&gt;profNr &gt; 0)
          ctxt-&gt;profTab[ctxt-&gt;profNr - 1] += total;
      }
<span class="udiff-line-added">+ #endif</span>
  
  #ifdef WITH_DEBUGGER
      if ((ctxt-&gt;debugStatus != XSLT_DEBUG_NONE) &amp;&amp; (addCallResult)) {
          xslDropCall();
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3432,11 +3462,11 @@</span>
           * Trying to handle bug #59212
           * The value of the &quot;select&quot; attribute is an
           * XPath expression.
           * (see http://xml.apache.org/xalan-j/extensionslib.html#redirect)
           */
<span class="udiff-line-modified-removed">-         cmp = xmlXPathCompile(URL);</span>
<span class="udiff-line-modified-added">+         cmp = xmlXPathCtxtCompile(ctxt-&gt;xpathCtxt, URL);</span>
                  val = xsltEvalXPathString(ctxt, cmp);
          xmlXPathFreeCompExpr(cmp);
          xmlFree(URL);
          URL = val;
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4996,11 +5026,11 @@</span>
                  (xmlStrEqual(val, (xmlChar *) &quot;strip&quot;))) {
                  delNode = cur;
                  break;
              }
              }
<span class="udiff-line-modified-removed">-             /* no break on purpose */</span>
<span class="udiff-line-modified-added">+             /* Intentional fall-through */</span>
          case XML_ELEMENT_NODE:
          case XML_DOCUMENT_NODE:
          case XML_HTML_DOCUMENT_NODE:
          case XML_CDATA_SECTION_NODE:
          case XML_PI_NODE:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5896,12 +5926,20 @@</span>
          return (NULL);
  
      ctxt-&gt;initialContextDoc = doc;
      ctxt-&gt;initialContextNode = (xmlNodePtr) doc;
  
<span class="udiff-line-modified-removed">-     if (profile != NULL)</span>
<span class="udiff-line-modified-added">+     if (profile != NULL) {</span>
<span class="udiff-line-added">+ #ifdef WITH_PROFILER</span>
          ctxt-&gt;profile = 1;
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+         xsltTransformError(ctxt, NULL, (xmlNodePtr) doc,</span>
<span class="udiff-line-added">+                 &quot;xsltApplyStylesheetInternal: &quot;</span>
<span class="udiff-line-added">+                 &quot;libxslt compiled without profiler\n&quot;);</span>
<span class="udiff-line-added">+         goto error;</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     }</span>
  
      if (output != NULL)
          ctxt-&gt;outputFile = output;
      else
          ctxt-&gt;outputFile = NULL;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6010,20 +6048,26 @@</span>
      res-&gt;charset = XML_CHAR_ENCODING_UTF8;
      if (encoding != NULL)
          res-&gt;encoding = xmlStrdup(encoding);
      variables = style-&gt;variables;
  
<span class="udiff-line-added">+     ctxt-&gt;node = (xmlNodePtr) doc;</span>
<span class="udiff-line-added">+     ctxt-&gt;output = res;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ctxt-&gt;xpathCtxt-&gt;contextSize = 1;</span>
<span class="udiff-line-added">+     ctxt-&gt;xpathCtxt-&gt;proximityPosition = 1;</span>
<span class="udiff-line-added">+     ctxt-&gt;xpathCtxt-&gt;node = NULL; /* TODO: Set the context node here? */</span>
<span class="udiff-line-added">+ </span>
      /*
       * Start the evaluation, evaluate the params, the stylesheets globals
       * and start by processing the top node.
       */
      if (xsltNeedElemSpaceHandling(ctxt))
      xsltApplyStripSpaces(ctxt, xmlDocGetRootElement(doc));
      /*
      * Evaluate global params and user-provided params.
      */
<span class="udiff-line-removed">-     ctxt-&gt;node = (xmlNodePtr) doc;</span>
      if (ctxt-&gt;globalVars == NULL)
      ctxt-&gt;globalVars = xmlHashCreate(20);
      if (params != NULL) {
          xsltEvalUserParams(ctxt, params);
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6034,18 +6078,13 @@</span>
      xsltEvalGlobalVariables(ctxt);
  
      /* Clean up any unused RVTs. */
      xsltReleaseLocalRVTs(ctxt, NULL);
  
<span class="udiff-line-removed">-     ctxt-&gt;node = (xmlNodePtr) doc;</span>
<span class="udiff-line-removed">-     ctxt-&gt;output = res;</span>
      ctxt-&gt;insert = (xmlNodePtr) res;
      ctxt-&gt;varsBase = ctxt-&gt;varsNr - 1;
  
<span class="udiff-line-removed">-     ctxt-&gt;xpathCtxt-&gt;contextSize = 1;</span>
<span class="udiff-line-removed">-     ctxt-&gt;xpathCtxt-&gt;proximityPosition = 1;</span>
<span class="udiff-line-removed">-     ctxt-&gt;xpathCtxt-&gt;node = NULL; /* TODO: Set the context node here? */</span>
      /*
      * Start processing the source tree -----------------------------------
      */
      xsltProcessOneNode(ctxt, ctxt-&gt;node, NULL);
      /*
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6171,13 +6210,16 @@</span>
          }
          }
          }
      }
      xmlXPathFreeNodeSet(ctxt-&gt;nodeList);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ #ifdef WITH_PROFILER</span>
      if (profile != NULL) {
          xsltSaveProfiling(ctxt, profile);
      }
<span class="udiff-line-added">+ #endif</span>
  
      /*
       * Be pedantic.
       */
      if ((ctxt != NULL) &amp;&amp; (ctxt-&gt;state != XSLT_STATE_OK)) {
</pre>
<center><a href="templates.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="variables.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>