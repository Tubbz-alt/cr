<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/ThirdParty/libxslt/src/libxslt/xslt.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="variables.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="xsltInternals.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/libxslt/src/libxslt/xslt.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 590,14 ***</span>
          xmlFree(tmp);
      }
      }
      if (cctxt-&gt;tmpList != NULL)
      xsltPointerListFree(cctxt-&gt;tmpList);
<span class="line-removed">- #ifdef XSLT_REFACTORED_XPATHCOMP</span>
<span class="line-removed">-     if (cctxt-&gt;xpathCtxt != NULL)</span>
<span class="line-removed">-     xmlXPathFreeContext(cctxt-&gt;xpathCtxt);</span>
<span class="line-removed">- #endif</span>
      if (cctxt-&gt;nsAliases != NULL)
      xsltFreeNsAliasList(cctxt-&gt;nsAliases);
  
      if (cctxt-&gt;ivars)
      xsltCompilerVarInfoFree(cctxt);
<span class="line-new-header">--- 590,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 629,19 ***</span>
      ret-&gt;errSeverity = XSLT_ERROR_SEVERITY_ERROR;
      ret-&gt;tmpList = xsltPointerListCreate(20);
      if (ret-&gt;tmpList == NULL) {
      goto internal_err;
      }
<span class="line-removed">- #ifdef XSLT_REFACTORED_XPATHCOMP</span>
<span class="line-removed">-     /*</span>
<span class="line-removed">-     * Create the XPath compilation context in order</span>
<span class="line-removed">-     * to speed up precompilation of XPath expressions.</span>
<span class="line-removed">-     */</span>
<span class="line-removed">-     ret-&gt;xpathCtxt = xmlXPathNewContext(NULL);</span>
<span class="line-removed">-     if (ret-&gt;xpathCtxt == NULL)</span>
<span class="line-removed">-     goto internal_err;</span>
<span class="line-removed">- #endif</span>
  
      return(ret);
  
  internal_err:
      xsltCompilationCtxtFree(ret);
<span class="line-new-header">--- 625,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 759,28 ***</span>
  }
  
  #endif
  
  /**
<span class="line-modified">!  * xsltNewStylesheet:</span>
   *
   * Create a new XSLT Stylesheet
   *
   * Returns the newly allocated xsltStylesheetPtr or NULL in case of error
   */
<span class="line-modified">! xsltStylesheetPtr</span>
<span class="line-modified">! xsltNewStylesheet(void) {</span>
      xsltStylesheetPtr ret = NULL;
  
      ret = (xsltStylesheetPtr) xmlMalloc(sizeof(xsltStylesheet));
      if (ret == NULL) {
      xsltTransformError(NULL, NULL, NULL,
          &quot;xsltNewStylesheet : malloc failed\n&quot;);
      goto internal_err;
      }
      memset(ret, 0, sizeof(xsltStylesheet));
  
      ret-&gt;omitXmlDeclaration = -1;
      ret-&gt;standalone = -1;
      ret-&gt;decimalFormat = xsltNewDecimalFormat(NULL, NULL);
      ret-&gt;indent = -1;
      ret-&gt;errors = 0;
<span class="line-new-header">--- 746,30 ---</span>
  }
  
  #endif
  
  /**
<span class="line-modified">!  * xsltNewStylesheetInternal:</span>
<span class="line-added">+  * @parent:  the parent stylesheet or NULL</span>
   *
   * Create a new XSLT Stylesheet
   *
   * Returns the newly allocated xsltStylesheetPtr or NULL in case of error
   */
<span class="line-modified">! static xsltStylesheetPtr</span>
<span class="line-modified">! xsltNewStylesheetInternal(xsltStylesheetPtr parent) {</span>
      xsltStylesheetPtr ret = NULL;
  
      ret = (xsltStylesheetPtr) xmlMalloc(sizeof(xsltStylesheet));
      if (ret == NULL) {
      xsltTransformError(NULL, NULL, NULL,
          &quot;xsltNewStylesheet : malloc failed\n&quot;);
      goto internal_err;
      }
      memset(ret, 0, sizeof(xsltStylesheet));
  
<span class="line-added">+     ret-&gt;parent = parent;</span>
      ret-&gt;omitXmlDeclaration = -1;
      ret-&gt;standalone = -1;
      ret-&gt;decimalFormat = xsltNewDecimalFormat(NULL, NULL);
      ret-&gt;indent = -1;
      ret-&gt;errors = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 797,20 ***</span>
<span class="line-new-header">--- 786,47 ---</span>
  #ifdef WITH_XSLT_DEBUG
      xsltGenericDebug(xsltGenericDebugContext,
      &quot;creating dictionary for stylesheet\n&quot;);
  #endif
  
<span class="line-added">+     if (parent == NULL) {</span>
<span class="line-added">+         ret-&gt;principal = ret;</span>
<span class="line-added">+ </span>
<span class="line-added">+         ret-&gt;xpathCtxt = xmlXPathNewContext(NULL);</span>
<span class="line-added">+         if (ret-&gt;xpathCtxt == NULL) {</span>
<span class="line-added">+             xsltTransformError(NULL, NULL, NULL,</span>
<span class="line-added">+                     &quot;xsltNewStylesheet: xmlXPathNewContext failed\n&quot;);</span>
<span class="line-added">+             goto internal_err;</span>
<span class="line-added">+         }</span>
<span class="line-added">+         if (xmlXPathContextSetCache(ret-&gt;xpathCtxt, 1, -1, 0) == -1)</span>
<span class="line-added">+             goto internal_err;</span>
<span class="line-added">+     } else {</span>
<span class="line-added">+         ret-&gt;principal = parent-&gt;principal;</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
      xsltInit();
  
      return(ret);
  
  internal_err:
      if (ret != NULL)
      xsltFreeStylesheet(ret);
      return(NULL);
  }
  
<span class="line-added">+ /**</span>
<span class="line-added">+  * xsltNewStylesheet:</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Create a new XSLT Stylesheet</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Returns the newly allocated xsltStylesheetPtr or NULL in case of error</span>
<span class="line-added">+  */</span>
<span class="line-added">+ xsltStylesheetPtr</span>
<span class="line-added">+ xsltNewStylesheet(void) {</span>
<span class="line-added">+     return xsltNewStylesheetInternal(NULL);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  /**
   * xsltAllocateExtra:
   * @style:  an XSLT stylesheet
   *
   * Allocate an extra runtime information slot statically while compiling
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1063,10 ***</span>
<span class="line-new-header">--- 1079,13 ---</span>
      xsltGenericDebug(xsltGenericDebugContext,
                       &quot;freeing dictionary from stylesheet\n&quot;);
  #endif
      xmlDictFree(style-&gt;dict);
  
<span class="line-added">+     if (style-&gt;xpathCtxt != NULL)</span>
<span class="line-added">+     xmlXPathFreeContext(style-&gt;xpathCtxt);</span>
<span class="line-added">+ </span>
      memset(style, -1, sizeof(xsltStylesheet));
      xmlFree(style);
  }
  
  /************************************************************************
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1347,12 ***</span>
              /*
              * TODO: We&#39;ll report additionally an error
              *  via the stylesheet&#39;s error handling.
              */
              xsltTransformError(NULL, style, cur,
<span class="line-modified">!                 &quot;Attribute &#39;cdata-section-elements&#39;: The value &quot;</span>
<span class="line-modified">!                 &quot;&#39;%s&#39; is not a valid QName.\n&quot;, element);</span>
              style-&gt;errors++;
              } else {
              xmlNsPtr ns;
  
              /*
<span class="line-new-header">--- 1366,12 ---</span>
              /*
              * TODO: We&#39;ll report additionally an error
              *  via the stylesheet&#39;s error handling.
              */
              xsltTransformError(NULL, style, cur,
<span class="line-modified">!                 &quot;Attribute &#39;cdata-section-elements&#39;: &quot;</span>
<span class="line-modified">!                 &quot;Not a valid QName.\n&quot;);</span>
              style-&gt;errors++;
              } else {
              xmlNsPtr ns;
  
              /*
</pre>
<hr />
<pre>
<span class="line-old-header">*** 5477,11 ***</span>
  
  #ifdef XSLT_REFACTORED
  
  /**
   * xsltIncludeComp:
<span class="line-modified">!  * @cctxt: the compilation contenxt</span>
   * @node:  the xsl:include node
   *
   * Process the xslt include node on the source node
   */
  static xsltStyleItemIncludePtr
<span class="line-new-header">--- 5496,11 ---</span>
  
  #ifdef XSLT_REFACTORED
  
  /**
   * xsltIncludeComp:
<span class="line-modified">!  * @cctxt: the compilation context</span>
   * @node:  the xsl:include node
   *
   * Process the xslt include node on the source node
   */
  static xsltStyleItemIncludePtr
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6530,168 ***</span>
      xsltStylesheetPtr retStyle;
  
      if (doc == NULL)
      return(NULL);
  
<span class="line-modified">!     retStyle = xsltNewStylesheet();</span>
      if (retStyle == NULL)
      return(NULL);
<span class="line-modified">!     /*</span>
<span class="line-modified">!     * Set the importing stylesheet module; also used to detect recursion.</span>
<span class="line-modified">!     */</span>
<span class="line-modified">!     retStyle-&gt;parent = parentStyle;</span>
      /*
      * Adjust the string dict.
      */
      if (doc-&gt;dict != NULL) {
<span class="line-modified">!         xmlDictFree(retStyle-&gt;dict);</span>
<span class="line-modified">!     retStyle-&gt;dict = doc-&gt;dict;</span>
  #ifdef WITH_XSLT_DEBUG
          xsltGenericDebug(xsltGenericDebugContext,
          &quot;reusing dictionary from %s for stylesheet\n&quot;,
          doc-&gt;URL);
  #endif
<span class="line-modified">!     xmlDictReference(retStyle-&gt;dict);</span>
      }
  
      /*
      * TODO: Eliminate xsltGatherNamespaces(); we must not restrict
      *  the stylesheet to containt distinct namespace prefixes.
      */
<span class="line-modified">!     xsltGatherNamespaces(retStyle);</span>
  
  #ifdef XSLT_REFACTORED
      {
      xsltCompilerCtxtPtr cctxt;
      xsltStylesheetPtr oldCurSheet;
  
<span class="line-modified">!     if (parentStyle == NULL) {</span>
          xsltPrincipalStylesheetDataPtr principalData;
          /*
<span class="line-removed">-         * Principal stylesheet</span>
<span class="line-removed">-         * --------------------</span>
<span class="line-removed">-         */</span>
<span class="line-removed">-         retStyle-&gt;principal = retStyle;</span>
<span class="line-removed">-         /*</span>
          * Create extra data for the principal stylesheet.
          */
          principalData = xsltNewPrincipalStylesheetData();
          if (principalData == NULL) {
<span class="line-modified">!         xsltFreeStylesheet(retStyle);</span>
<span class="line-removed">-         return(NULL);</span>
          }
<span class="line-modified">!         retStyle-&gt;principalData = principalData;</span>
          /*
          * Create the compilation context
          * ------------------------------
          * (only once; for the principal stylesheet).
          * This is currently the only function where the
          * compilation context is created.
          */
<span class="line-modified">!         cctxt = xsltCompilationCtxtCreate(retStyle);</span>
          if (cctxt == NULL) {
<span class="line-modified">!         xsltFreeStylesheet(retStyle);</span>
<span class="line-removed">-         return(NULL);</span>
          }
<span class="line-modified">!         retStyle-&gt;compCtxt = (void *) cctxt;</span>
<span class="line-modified">!         cctxt-&gt;style = retStyle;</span>
<span class="line-modified">!         cctxt-&gt;dict = retStyle-&gt;dict;</span>
          cctxt-&gt;psData = principalData;
          /*
          * Push initial dummy node info.
          */
          cctxt-&gt;depth = -1;
          xsltCompilerNodePush(cctxt, (xmlNodePtr) doc);
      } else {
          /*
          * Imported stylesheet.
          */
<span class="line-modified">!         retStyle-&gt;principal = parentStyle-&gt;principal;</span>
<span class="line-modified">!         cctxt = parentStyle-&gt;compCtxt;</span>
<span class="line-removed">-         retStyle-&gt;compCtxt = cctxt;</span>
      }
      /*
      * Save the old and set the current stylesheet structure in the
      * compilation context.
      */
      oldCurSheet = cctxt-&gt;style;
<span class="line-modified">!     cctxt-&gt;style = retStyle;</span>
  
<span class="line-modified">!     retStyle-&gt;doc = doc;</span>
<span class="line-modified">!     xsltParseStylesheetProcess(retStyle, doc);</span>
  
      cctxt-&gt;style = oldCurSheet;
<span class="line-modified">!     if (parentStyle == NULL) {</span>
          /*
          * Pop the initial dummy node info.
          */
          xsltCompilerNodePop(cctxt, (xmlNodePtr) doc);
      } else {
          /*
          * Clear the compilation context of imported
          * stylesheets.
          * TODO: really?
          */
<span class="line-modified">!         /* retStyle-&gt;compCtxt = NULL; */</span>
      }
<span class="line-modified">!     /*</span>
<span class="line-removed">-     * Free the stylesheet if there were errors.</span>
<span class="line-removed">-     */</span>
<span class="line-removed">-     if (retStyle != NULL) {</span>
<span class="line-removed">-         if (retStyle-&gt;errors != 0) {</span>
  #ifdef XSLT_REFACTORED_XSLT_NSCOMP
<span class="line-modified">!         /*</span>
<span class="line-modified">!         * Restore all changes made to namespace URIs of ns-decls.</span>
<span class="line-modified">!         */</span>
<span class="line-modified">!         if (cctxt-&gt;psData-&gt;nsMap)</span>
<span class="line-modified">!             xsltRestoreDocumentNamespaces(cctxt-&gt;psData-&gt;nsMap, doc);</span>
<span class="line-modified">! #endif</span>
<span class="line-removed">-         /*</span>
<span class="line-removed">-         * Detach the doc from the stylesheet; otherwise the doc</span>
<span class="line-removed">-         * will be freed in xsltFreeStylesheet().</span>
<span class="line-removed">-         */</span>
<span class="line-removed">-         retStyle-&gt;doc = NULL;</span>
<span class="line-removed">-         /*</span>
<span class="line-removed">-         * Cleanup the doc if its the main stylesheet.</span>
<span class="line-removed">-         */</span>
<span class="line-removed">-         if (parentStyle == NULL) {</span>
<span class="line-removed">-             xsltCleanupStylesheetTree(doc, xmlDocGetRootElement(doc));</span>
<span class="line-removed">-             if (retStyle-&gt;compCtxt != NULL) {</span>
<span class="line-removed">-             xsltCompilationCtxtFree(retStyle-&gt;compCtxt);</span>
<span class="line-removed">-             retStyle-&gt;compCtxt = NULL;</span>
<span class="line-removed">-             }</span>
          }
  
<span class="line-modified">!         xsltFreeStylesheet(retStyle);</span>
<span class="line-modified">!         retStyle = NULL;</span>
          }
      }
<span class="line-removed">-     }</span>
  
  #else /* XSLT_REFACTORED */
      /*
      * Old behaviour.
      */
<span class="line-modified">!     retStyle-&gt;doc = doc;</span>
<span class="line-modified">!     if (xsltParseStylesheetProcess(retStyle, doc) == NULL) {</span>
<span class="line-modified">!         retStyle-&gt;doc = NULL;</span>
<span class="line-modified">!         xsltFreeStylesheet(retStyle);</span>
<span class="line-removed">-         retStyle = NULL;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     if (retStyle != NULL) {</span>
<span class="line-removed">-     if (retStyle-&gt;errors != 0) {</span>
<span class="line-removed">-         retStyle-&gt;doc = NULL;</span>
<span class="line-removed">-         if (parentStyle == NULL)</span>
<span class="line-removed">-         xsltCleanupStylesheetTree(doc,</span>
<span class="line-removed">-             xmlDocGetRootElement(doc));</span>
<span class="line-removed">-         xsltFreeStylesheet(retStyle);</span>
<span class="line-removed">-         retStyle = NULL;</span>
<span class="line-removed">-     }</span>
      }
  #endif /* else of XSLT_REFACTORED */
  
<span class="line-modified">!     return(retStyle);</span>
  }
  
  /**
   * xsltParseStylesheetDoc:
   * @doc:  and xmlDoc parsed XML
<span class="line-new-header">--- 6549,168 ---</span>
      xsltStylesheetPtr retStyle;
  
      if (doc == NULL)
      return(NULL);
  
<span class="line-modified">!     retStyle = xsltNewStylesheetInternal(parentStyle);</span>
      if (retStyle == NULL)
      return(NULL);
<span class="line-modified">! </span>
<span class="line-modified">!     if (xsltParseStylesheetUser(retStyle, doc) != 0) {</span>
<span class="line-modified">!         xsltFreeStylesheet(retStyle);</span>
<span class="line-modified">!         return(NULL);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     return(retStyle);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ /**</span>
<span class="line-added">+  * xsltParseStylesheetUser:</span>
<span class="line-added">+  * @style: pointer to the stylesheet</span>
<span class="line-added">+  * @doc:  an xmlDoc parsed XML</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Parse an XSLT stylesheet with a user-provided stylesheet struct.</span>
<span class="line-added">+  *</span>
<span class="line-added">+  * Returns 0 if successful, -1 in case of error.</span>
<span class="line-added">+  */</span>
<span class="line-added">+ int</span>
<span class="line-added">+ xsltParseStylesheetUser(xsltStylesheetPtr style, xmlDocPtr doc) {</span>
<span class="line-added">+     if ((style == NULL) || (doc == NULL))</span>
<span class="line-added">+     return(-1);</span>
<span class="line-added">+ </span>
      /*
      * Adjust the string dict.
      */
      if (doc-&gt;dict != NULL) {
<span class="line-modified">!         xmlDictFree(style-&gt;dict);</span>
<span class="line-modified">!     style-&gt;dict = doc-&gt;dict;</span>
  #ifdef WITH_XSLT_DEBUG
          xsltGenericDebug(xsltGenericDebugContext,
          &quot;reusing dictionary from %s for stylesheet\n&quot;,
          doc-&gt;URL);
  #endif
<span class="line-modified">!     xmlDictReference(style-&gt;dict);</span>
      }
  
      /*
      * TODO: Eliminate xsltGatherNamespaces(); we must not restrict
      *  the stylesheet to containt distinct namespace prefixes.
      */
<span class="line-modified">!     xsltGatherNamespaces(style);</span>
  
  #ifdef XSLT_REFACTORED
      {
      xsltCompilerCtxtPtr cctxt;
      xsltStylesheetPtr oldCurSheet;
  
<span class="line-modified">!     if (style-&gt;parent == NULL) {</span>
          xsltPrincipalStylesheetDataPtr principalData;
          /*
          * Create extra data for the principal stylesheet.
          */
          principalData = xsltNewPrincipalStylesheetData();
          if (principalData == NULL) {
<span class="line-modified">!         return(-1);</span>
          }
<span class="line-modified">!         style-&gt;principalData = principalData;</span>
          /*
          * Create the compilation context
          * ------------------------------
          * (only once; for the principal stylesheet).
          * This is currently the only function where the
          * compilation context is created.
          */
<span class="line-modified">!         cctxt = xsltCompilationCtxtCreate(style);</span>
          if (cctxt == NULL) {
<span class="line-modified">!         return(-1);</span>
          }
<span class="line-modified">!         style-&gt;compCtxt = (void *) cctxt;</span>
<span class="line-modified">!         cctxt-&gt;style = style;</span>
<span class="line-modified">!         cctxt-&gt;dict = style-&gt;dict;</span>
          cctxt-&gt;psData = principalData;
          /*
          * Push initial dummy node info.
          */
          cctxt-&gt;depth = -1;
          xsltCompilerNodePush(cctxt, (xmlNodePtr) doc);
      } else {
          /*
          * Imported stylesheet.
          */
<span class="line-modified">!         cctxt = style-&gt;parent-&gt;compCtxt;</span>
<span class="line-modified">!         style-&gt;compCtxt = cctxt;</span>
      }
      /*
      * Save the old and set the current stylesheet structure in the
      * compilation context.
      */
      oldCurSheet = cctxt-&gt;style;
<span class="line-modified">!     cctxt-&gt;style = style;</span>
  
<span class="line-modified">!     style-&gt;doc = doc;</span>
<span class="line-modified">!     xsltParseStylesheetProcess(style, doc);</span>
  
      cctxt-&gt;style = oldCurSheet;
<span class="line-modified">!     if (style-&gt;parent == NULL) {</span>
          /*
          * Pop the initial dummy node info.
          */
          xsltCompilerNodePop(cctxt, (xmlNodePtr) doc);
      } else {
          /*
          * Clear the compilation context of imported
          * stylesheets.
          * TODO: really?
          */
<span class="line-modified">!         /* style-&gt;compCtxt = NULL; */</span>
      }
<span class="line-modified">! </span>
  #ifdef XSLT_REFACTORED_XSLT_NSCOMP
<span class="line-modified">!         if (style-&gt;errors != 0) {</span>
<span class="line-modified">!             /*</span>
<span class="line-modified">!             * Restore all changes made to namespace URIs of ns-decls.</span>
<span class="line-modified">!             */</span>
<span class="line-modified">!             if (cctxt-&gt;psData-&gt;nsMap)</span>
<span class="line-modified">!                 xsltRestoreDocumentNamespaces(cctxt-&gt;psData-&gt;nsMap, doc);</span>
          }
<span class="line-added">+ #endif</span>
  
<span class="line-modified">!         if (style-&gt;parent == NULL) {</span>
<span class="line-modified">!             xsltCompilationCtxtFree(style-&gt;compCtxt);</span>
<span class="line-added">+             style-&gt;compCtxt = NULL;</span>
          }
      }
  
  #else /* XSLT_REFACTORED */
      /*
      * Old behaviour.
      */
<span class="line-modified">!     style-&gt;doc = doc;</span>
<span class="line-modified">!     if (xsltParseStylesheetProcess(style, doc) == NULL) {</span>
<span class="line-modified">!         style-&gt;doc = NULL;</span>
<span class="line-modified">!         return(-1);</span>
      }
  #endif /* else of XSLT_REFACTORED */
  
<span class="line-modified">!     if (style-&gt;errors != 0) {</span>
<span class="line-added">+         /*</span>
<span class="line-added">+         * Detach the doc from the stylesheet; otherwise the doc</span>
<span class="line-added">+         * will be freed in xsltFreeStylesheet().</span>
<span class="line-added">+         */</span>
<span class="line-added">+         style-&gt;doc = NULL;</span>
<span class="line-added">+         /*</span>
<span class="line-added">+         * Cleanup the doc if its the main stylesheet.</span>
<span class="line-added">+         */</span>
<span class="line-added">+         if (style-&gt;parent == NULL)</span>
<span class="line-added">+             xsltCleanupStylesheetTree(doc, xmlDocGetRootElement(doc));</span>
<span class="line-added">+         return(-1);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (style-&gt;parent == NULL)</span>
<span class="line-added">+         xsltResolveStylesheetAttributeSet(style);</span>
<span class="line-added">+ </span>
<span class="line-added">+     return(0);</span>
  }
  
  /**
   * xsltParseStylesheetDoc:
   * @doc:  and xmlDoc parsed XML
</pre>
<hr />
<pre>
<span class="line-old-header">*** 6705,31 ***</span>
   * Returns a new XSLT stylesheet structure.
   */
  
  xsltStylesheetPtr
  xsltParseStylesheetDoc(xmlDocPtr doc) {
<span class="line-removed">-     xsltStylesheetPtr ret;</span>
<span class="line-removed">- </span>
      xsltInitGlobals();
  
<span class="line-modified">!     ret = xsltParseStylesheetImportedDoc(doc, NULL);</span>
<span class="line-removed">-     if (ret == NULL)</span>
<span class="line-removed">-     return(NULL);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     xsltResolveStylesheetAttributeSet(ret);</span>
<span class="line-removed">- #ifdef XSLT_REFACTORED</span>
<span class="line-removed">-     /*</span>
<span class="line-removed">-     * Free the compilation context.</span>
<span class="line-removed">-     * TODO: Check if it&#39;s better to move this cleanup to</span>
<span class="line-removed">-     *   xsltParseStylesheetImportedDoc().</span>
<span class="line-removed">-     */</span>
<span class="line-removed">-     if (ret-&gt;compCtxt != NULL) {</span>
<span class="line-removed">-     xsltCompilationCtxtFree(XSLT_CCTXT(ret));</span>
<span class="line-removed">-     ret-&gt;compCtxt = NULL;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">-     return(ret);</span>
  }
  
  /**
   * xsltParseStylesheetFile:
   * @filename:  the filename/URL to the stylesheet
<span class="line-new-header">--- 6724,13 ---</span>
   * Returns a new XSLT stylesheet structure.
   */
  
  xsltStylesheetPtr
  xsltParseStylesheetDoc(xmlDocPtr doc) {
      xsltInitGlobals();
  
<span class="line-modified">!     return(xsltParseStylesheetImportedDoc(doc, NULL));</span>
  }
  
  /**
   * xsltParseStylesheetFile:
   * @filename:  the filename/URL to the stylesheet
</pre>
<center><a href="variables.c.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="xsltInternals.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>