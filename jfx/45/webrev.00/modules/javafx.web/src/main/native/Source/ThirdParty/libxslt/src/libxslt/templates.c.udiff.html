<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/ThirdParty/libxslt/src/libxslt/templates.c</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="security.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="transform.c.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/libxslt/src/libxslt/templates.c</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -330,11 +330,11 @@</span>
              while (nsList[i] != NULL)
                  i++;
              nsNr = i;
              }
          }
<span class="udiff-line-modified-removed">-         comp = xmlXPathCompile(expr);</span>
<span class="udiff-line-modified-added">+         comp = xmlXPathCtxtCompile(ctxt-&gt;xpathCtxt, expr);</span>
                  val = xsltEvalXPathStringNs(ctxt, comp, nsNr, nsList);
          xmlXPathFreeCompExpr(comp);
          xmlFree(expr);
          if (val != NULL) {
              ret = xmlStrcat(ret, val);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -643,33 +643,53 @@</span>
   */
  xmlAttrPtr
  xsltAttrListTemplateProcess(xsltTransformContextPtr ctxt,
                          xmlNodePtr target, xmlAttrPtr attrs)
  {
<span class="udiff-line-modified-removed">-     xmlAttrPtr attr, copy, last;</span>
<span class="udiff-line-modified-added">+     xmlAttrPtr attr, copy, last = NULL;</span>
      xmlNodePtr oldInsert, text;
      xmlNsPtr origNs = NULL, copyNs = NULL;
      const xmlChar *value;
      xmlChar *valueAVT;
<span class="udiff-line-added">+     int hasAttr = 0;</span>
  
      if ((ctxt == NULL) || (target == NULL) || (attrs == NULL) ||
          (target-&gt;type != XML_ELEMENT_NODE))
      return(NULL);
  
      oldInsert = ctxt-&gt;insert;
      ctxt-&gt;insert = target;
  
      /*
<span class="udiff-line-modified-removed">-     * Instantiate LRE-attributes.</span>
<span class="udiff-line-modified-added">+     * Apply attribute-sets.</span>
      */
<span class="udiff-line-modified-removed">-     if (target-&gt;properties) {</span>
<span class="udiff-line-modified-removed">-     last = target-&gt;properties;</span>
<span class="udiff-line-modified-removed">-     while (last-&gt;next != NULL)</span>
<span class="udiff-line-modified-removed">-         last = last-&gt;next;</span>
<span class="udiff-line-modified-removed">-     } else {</span>
<span class="udiff-line-modified-removed">-     last = NULL;</span>
<span class="udiff-line-modified-added">+     attr = attrs;</span>
<span class="udiff-line-modified-added">+     do {</span>
<span class="udiff-line-modified-added">+ #ifdef XSLT_REFACTORED</span>
<span class="udiff-line-modified-added">+     if ((attr-&gt;psvi == xsltXSLTAttrMarker) &amp;&amp;</span>
<span class="udiff-line-modified-added">+         xmlStrEqual(attr-&gt;name, (const xmlChar *)&quot;use-attribute-sets&quot;))</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-added">+         xsltApplyAttributeSet(ctxt, ctxt-&gt;node, (xmlNodePtr) attr, NULL);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+     if ((attr-&gt;ns != NULL) &amp;&amp;</span>
<span class="udiff-line-added">+         xmlStrEqual(attr-&gt;name, (const xmlChar *)&quot;use-attribute-sets&quot;) &amp;&amp;</span>
<span class="udiff-line-added">+         xmlStrEqual(attr-&gt;ns-&gt;href, XSLT_NAMESPACE))</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         xsltApplyAttributeSet(ctxt, ctxt-&gt;node, (xmlNodePtr) attr, NULL);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     attr = attr-&gt;next;</span>
<span class="udiff-line-added">+     } while (attr != NULL);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (target-&gt;properties != NULL) {</span>
<span class="udiff-line-added">+         hasAttr = 1;</span>
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     /*</span>
<span class="udiff-line-added">+     * Instantiate LRE-attributes.</span>
<span class="udiff-line-added">+     */</span>
      attr = attrs;
      do {
      /*
      * Skip XSLT attributes.
      */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -701,39 +721,11 @@</span>
          value = xmlDictLookup(ctxt-&gt;dict, BAD_CAST &quot;&quot;, 0);
      } else
          value = xmlDictLookup(ctxt-&gt;dict, BAD_CAST &quot;&quot;, 0);
  
      /*
<span class="udiff-line-modified-removed">-     * Create a new attribute.</span>
<span class="udiff-line-removed">-     */</span>
<span class="udiff-line-removed">-     copy = xmlNewDocProp(target-&gt;doc, attr-&gt;name, NULL);</span>
<span class="udiff-line-removed">-     if (copy == NULL) {</span>
<span class="udiff-line-removed">-         if (attr-&gt;ns) {</span>
<span class="udiff-line-removed">-         xsltTransformError(ctxt, NULL, attr-&gt;parent,</span>
<span class="udiff-line-removed">-             &quot;Internal error: Failed to create attribute &#39;{%s}%s&#39;.\n&quot;,</span>
<span class="udiff-line-removed">-             attr-&gt;ns-&gt;href, attr-&gt;name);</span>
<span class="udiff-line-removed">-         } else {</span>
<span class="udiff-line-removed">-         xsltTransformError(ctxt, NULL, attr-&gt;parent,</span>
<span class="udiff-line-removed">-             &quot;Internal error: Failed to create attribute &#39;%s&#39;.\n&quot;,</span>
<span class="udiff-line-removed">-             attr-&gt;name);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-         goto error;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     /*</span>
<span class="udiff-line-removed">-     * Attach it to the target element.</span>
<span class="udiff-line-removed">-     */</span>
<span class="udiff-line-removed">-     copy-&gt;parent = target;</span>
<span class="udiff-line-removed">-     if (last == NULL) {</span>
<span class="udiff-line-removed">-         target-&gt;properties = copy;</span>
<span class="udiff-line-removed">-         last = copy;</span>
<span class="udiff-line-removed">-     } else {</span>
<span class="udiff-line-removed">-         last-&gt;next = copy;</span>
<span class="udiff-line-removed">-         copy-&gt;prev = last;</span>
<span class="udiff-line-removed">-         last = copy;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     /*</span>
<span class="udiff-line-removed">-     * Set the namespace. Avoid lookups of same namespaces.</span>
<span class="udiff-line-modified-added">+     * Get the namespace. Avoid lookups of same namespaces.</span>
      */
      if (attr-&gt;ns != origNs) {
          origNs = attr-&gt;ns;
          if (attr-&gt;ns != NULL) {
  #ifdef XSLT_REFACTORED
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -746,11 +738,51 @@</span>
          if (copyNs == NULL)
              goto error;
          } else
          copyNs = NULL;
      }
<span class="udiff-line-modified-removed">-     copy-&gt;ns = copyNs;</span>
<span class="udiff-line-modified-added">+     /*</span>
<span class="udiff-line-added">+     * Create a new attribute.</span>
<span class="udiff-line-added">+     */</span>
<span class="udiff-line-added">+         if (hasAttr) {</span>
<span class="udiff-line-added">+         copy = xmlSetNsProp(target, copyNs, attr-&gt;name, NULL);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             /*</span>
<span class="udiff-line-added">+             * Avoid checking for duplicate attributes if there aren&#39;t</span>
<span class="udiff-line-added">+             * any attribute sets.</span>
<span class="udiff-line-added">+             */</span>
<span class="udiff-line-added">+         copy = xmlNewDocProp(target-&gt;doc, attr-&gt;name, NULL);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (copy != NULL) {</span>
<span class="udiff-line-added">+                 copy-&gt;ns = copyNs;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 /*</span>
<span class="udiff-line-added">+                 * Attach it to the target element.</span>
<span class="udiff-line-added">+                 */</span>
<span class="udiff-line-added">+                 copy-&gt;parent = target;</span>
<span class="udiff-line-added">+                 if (last == NULL) {</span>
<span class="udiff-line-added">+                     target-&gt;properties = copy;</span>
<span class="udiff-line-added">+                     last = copy;</span>
<span class="udiff-line-added">+                 } else {</span>
<span class="udiff-line-added">+                     last-&gt;next = copy;</span>
<span class="udiff-line-added">+                     copy-&gt;prev = last;</span>
<span class="udiff-line-added">+                     last = copy;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     if (copy == NULL) {</span>
<span class="udiff-line-added">+         if (attr-&gt;ns) {</span>
<span class="udiff-line-added">+         xsltTransformError(ctxt, NULL, attr-&gt;parent,</span>
<span class="udiff-line-added">+             &quot;Internal error: Failed to create attribute &#39;{%s}%s&#39;.\n&quot;,</span>
<span class="udiff-line-added">+             attr-&gt;ns-&gt;href, attr-&gt;name);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+         xsltTransformError(ctxt, NULL, attr-&gt;parent,</span>
<span class="udiff-line-added">+             &quot;Internal error: Failed to create attribute &#39;%s&#39;.\n&quot;,</span>
<span class="udiff-line-added">+             attr-&gt;name);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+         goto error;</span>
<span class="udiff-line-added">+     }</span>
  
      /*
      * Set the value.
      */
      text = xmlNewText(NULL);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -801,34 +833,10 @@</span>
  
  next_attribute:
      attr = attr-&gt;next;
      } while (attr != NULL);
  
<span class="udiff-line-removed">-     /*</span>
<span class="udiff-line-removed">-     * Apply attribute-sets.</span>
<span class="udiff-line-removed">-     * The creation of such attributes will not overwrite any existing</span>
<span class="udiff-line-removed">-     * attribute.</span>
<span class="udiff-line-removed">-     */</span>
<span class="udiff-line-removed">-     attr = attrs;</span>
<span class="udiff-line-removed">-     do {</span>
<span class="udiff-line-removed">- #ifdef XSLT_REFACTORED</span>
<span class="udiff-line-removed">-     if ((attr-&gt;psvi == xsltXSLTAttrMarker) &amp;&amp;</span>
<span class="udiff-line-removed">-         xmlStrEqual(attr-&gt;name, (const xmlChar *)&quot;use-attribute-sets&quot;))</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         xsltApplyAttributeSet(ctxt, ctxt-&gt;node, (xmlNodePtr) attr, NULL);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- #else</span>
<span class="udiff-line-removed">-     if ((attr-&gt;ns != NULL) &amp;&amp;</span>
<span class="udiff-line-removed">-         xmlStrEqual(attr-&gt;name, (const xmlChar *)&quot;use-attribute-sets&quot;) &amp;&amp;</span>
<span class="udiff-line-removed">-         xmlStrEqual(attr-&gt;ns-&gt;href, XSLT_NAMESPACE))</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-         xsltApplyAttributeSet(ctxt, ctxt-&gt;node, (xmlNodePtr) attr, NULL);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     attr = attr-&gt;next;</span>
<span class="udiff-line-removed">-     } while (attr != NULL);</span>
<span class="udiff-line-removed">- </span>
      ctxt-&gt;insert = oldInsert;
      return(target-&gt;properties);
  
  error:
      ctxt-&gt;insert = oldInsert;
</pre>
<center><a href="security.c.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="transform.c.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>