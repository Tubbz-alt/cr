<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff tests/system/src/test/java/test/robot/javafx/scene/dialog/DialogWithOwnerSizingTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../../../../../modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>tests/system/src/test/java/test/robot/javafx/scene/dialog/DialogWithOwnerSizingTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package test.robot.javafx.scene.dialog;
 27 
 28 import javafx.application.Application;
 29 import javafx.application.Platform;
 30 import javafx.scene.Scene;
 31 import javafx.scene.control.Button;
 32 import javafx.scene.control.ButtonType;
 33 import javafx.scene.control.Dialog;
<span class="line-removed"> 34 import javafx.scene.control.DialogEvent;</span>
 35 import javafx.scene.robot.Robot;
 36 import javafx.stage.Stage;
 37 import javafx.stage.StageStyle;
 38 import javafx.stage.WindowEvent;
 39 import javafx.scene.input.MouseButton;
 40 
 41 import org.junit.AfterClass;
 42 import org.junit.Assert;
 43 import org.junit.BeforeClass;
 44 import org.junit.Test;
 45 import test.util.Util;
 46 
 47 import java.util.concurrent.CountDownLatch;
 48 import java.util.concurrent.TimeUnit;
 49 
<span class="line-modified"> 50 //see JDK8193502</span>
 51 public class DialogWithOwnerSizingTest {
 52     static Robot robot;
 53     static Button button;
 54     static Stage stage;
 55     static Scene scene;
 56     static Dialog&lt;ButtonType&gt; dialog;
 57     static Dialog&lt;ButtonType&gt; dialog2;
 58     static CountDownLatch startupLatch;
 59     static CountDownLatch dialogShownLatch;
 60     static CountDownLatch dialogHideLatch;
 61 
 62     @Test(timeout = 15000)
 63     public void dialogWithOwnerSizingTest() throws Exception {
 64         Thread.sleep(500);
 65         clickButton();
 66         Thread.sleep(500);
<span class="line-removed"> 67         Assert.assertEquals(dialog.getDialogPane().getWidth(), dialog2.getDialogPane().getWidth(), 0.0);</span>
<span class="line-removed"> 68         Assert.assertEquals(dialog.getDialogPane().getHeight(), dialog2.getDialogPane().getHeight(), 0.0);</span>
<span class="line-removed"> 69         hide();</span>
<span class="line-removed"> 70     }</span>
 71 







 72 
 73     private void clickButton() throws Exception {
 74         dialogShownLatch = new CountDownLatch(2);
 75         mouseClick(button.getLayoutX() + button.getWidth() / 2, button.getLayoutY() + button.getHeight() / 2);
 76 
<span class="line-removed"> 77         Thread.sleep(400);</span>
 78         waitForLatch(dialogShownLatch, 10, &quot;Failed to show Dialog&quot;);
 79     }
 80 
 81     private void hide() throws Exception {
 82         dialogHideLatch = new CountDownLatch(2);
 83         Platform.runLater(() -&gt; {
 84             dialog.close();
 85             dialog2.close();
 86         });
<span class="line-removed"> 87         Thread.sleep(600);</span>
 88         waitForLatch(dialogHideLatch, 10, &quot;Failed to hide Dialog&quot;);
 89     }
 90 
 91     @BeforeClass
 92     public static void initFX() throws Exception {
 93         startupLatch = new CountDownLatch(1);
 94         new Thread(() -&gt; Application.launch(SizingTestApp.class, (String[]) null)).start();
 95         waitForLatch(startupLatch, 15, &quot;FX runtime failed to start.&quot;);
 96     }
 97 
 98     @AfterClass
 99     public static void exit() {
100         Platform.runLater(() -&gt; stage.hide());
101         Platform.exit();
102     }
103 
104     private void mouseClick(double x, double y) {
105         Util.runAndWait(() -&gt; {
106             robot.mouseMove((int) (scene.getWindow().getX() + scene.getX() + x),
107                     (int) (scene.getWindow().getY() + scene.getY() + y));
108             robot.mousePress(MouseButton.PRIMARY);
109             robot.mouseRelease(MouseButton.PRIMARY);
110         });
111     }
112 
113     public static class SizingTestApp extends Application {
114         @Override
115         public void start(Stage primaryStage) {
116             robot = new Robot();
117             stage = primaryStage;

118 
119             button = new Button(&quot;Open Dialogs&quot;);
120 
121             scene = new Scene(button, 200, 200);
122             stage.setScene(scene);
123 
124             stage.initStyle(StageStyle.UNDECORATED);
125             stage.setOnShown(e -&gt; Platform.runLater(startupLatch::countDown));
126 
127             dialog = getTestDialog(true);
128             dialog2 = getTestDialog(false);
129 
130             button.setOnAction(evt -&gt; {
131                 dialog.show();
132                 dialog2.show();
133             });
134 
135             stage.show();
136         }
137 
</pre>
</td>
<td>
<hr />
<pre>
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package test.robot.javafx.scene.dialog;
 27 
 28 import javafx.application.Application;
 29 import javafx.application.Platform;
 30 import javafx.scene.Scene;
 31 import javafx.scene.control.Button;
 32 import javafx.scene.control.ButtonType;
 33 import javafx.scene.control.Dialog;

 34 import javafx.scene.robot.Robot;
 35 import javafx.stage.Stage;
 36 import javafx.stage.StageStyle;
 37 import javafx.stage.WindowEvent;
 38 import javafx.scene.input.MouseButton;
 39 
 40 import org.junit.AfterClass;
 41 import org.junit.Assert;
 42 import org.junit.BeforeClass;
 43 import org.junit.Test;
 44 import test.util.Util;
 45 
 46 import java.util.concurrent.CountDownLatch;
 47 import java.util.concurrent.TimeUnit;
 48 
<span class="line-modified"> 49 //see JDK-8193502</span>
 50 public class DialogWithOwnerSizingTest {
 51     static Robot robot;
 52     static Button button;
 53     static Stage stage;
 54     static Scene scene;
 55     static Dialog&lt;ButtonType&gt; dialog;
 56     static Dialog&lt;ButtonType&gt; dialog2;
 57     static CountDownLatch startupLatch;
 58     static CountDownLatch dialogShownLatch;
 59     static CountDownLatch dialogHideLatch;
 60 
 61     @Test(timeout = 15000)
 62     public void dialogWithOwnerSizingTest() throws Exception {
 63         Thread.sleep(500);
 64         clickButton();
 65         Thread.sleep(500);




 66 
<span class="line-added"> 67         try {</span>
<span class="line-added"> 68             Assert.assertEquals(dialog2.getDialogPane().getWidth(), dialog.getDialogPane().getWidth(), 2.0);</span>
<span class="line-added"> 69             Assert.assertEquals(dialog2.getDialogPane().getHeight(), dialog.getDialogPane().getHeight(), 2.0);</span>
<span class="line-added"> 70         } finally {</span>
<span class="line-added"> 71             hide();</span>
<span class="line-added"> 72         }</span>
<span class="line-added"> 73     }</span>
 74 
 75     private void clickButton() throws Exception {
 76         dialogShownLatch = new CountDownLatch(2);
 77         mouseClick(button.getLayoutX() + button.getWidth() / 2, button.getLayoutY() + button.getHeight() / 2);
 78 

 79         waitForLatch(dialogShownLatch, 10, &quot;Failed to show Dialog&quot;);
 80     }
 81 
 82     private void hide() throws Exception {
 83         dialogHideLatch = new CountDownLatch(2);
 84         Platform.runLater(() -&gt; {
 85             dialog.close();
 86             dialog2.close();
 87         });

 88         waitForLatch(dialogHideLatch, 10, &quot;Failed to hide Dialog&quot;);
 89     }
 90 
 91     @BeforeClass
 92     public static void initFX() throws Exception {
 93         startupLatch = new CountDownLatch(1);
 94         new Thread(() -&gt; Application.launch(SizingTestApp.class, (String[]) null)).start();
 95         waitForLatch(startupLatch, 15, &quot;FX runtime failed to start.&quot;);
 96     }
 97 
 98     @AfterClass
 99     public static void exit() {
100         Platform.runLater(() -&gt; stage.hide());
101         Platform.exit();
102     }
103 
104     private void mouseClick(double x, double y) {
105         Util.runAndWait(() -&gt; {
106             robot.mouseMove((int) (scene.getWindow().getX() + scene.getX() + x),
107                     (int) (scene.getWindow().getY() + scene.getY() + y));
108             robot.mousePress(MouseButton.PRIMARY);
109             robot.mouseRelease(MouseButton.PRIMARY);
110         });
111     }
112 
113     public static class SizingTestApp extends Application {
114         @Override
115         public void start(Stage primaryStage) {
116             robot = new Robot();
117             stage = primaryStage;
<span class="line-added">118             stage.setAlwaysOnTop(true);</span>
119 
120             button = new Button(&quot;Open Dialogs&quot;);
121 
122             scene = new Scene(button, 200, 200);
123             stage.setScene(scene);
124 
125             stage.initStyle(StageStyle.UNDECORATED);
126             stage.setOnShown(e -&gt; Platform.runLater(startupLatch::countDown));
127 
128             dialog = getTestDialog(true);
129             dialog2 = getTestDialog(false);
130 
131             button.setOnAction(evt -&gt; {
132                 dialog.show();
133                 dialog2.show();
134             });
135 
136             stage.show();
137         }
138 
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../../../../../modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>