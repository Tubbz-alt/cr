<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1033             updateWindowConstraints = true;
1034             if (!frame_extents_initialized &amp;&amp; !is_null_extents()) {
1035                 frame_extents_initialized = true;
1036                 set_bounds(0, 0, false, false,
1037                     requested_bounds.width, requested_bounds.height,
1038                     requested_bounds.client_width, requested_bounds.client_height
1039                 );
1040             }
1041         }
1042     } else {
1043         x = event-&gt;x;
1044         y = event-&gt;y;
1045         w = event-&gt;width;
1046         h = event-&gt;height;
1047     }
1048 
1049     if (size_assigned &amp;&amp; w &lt;= 1 &amp;&amp; h &lt;= 1 &amp;&amp; (geometry.final_width.value &gt; 1 ||
1050                                              geometry.final_height.value &gt; 1)) {
1051         // skip artifact
1052         return;









1053     }
1054 
<span class="line-removed">1055     geometry.final_width.value = w;</span>
<span class="line-removed">1056     geometry.final_width.type = BOUNDSTYPE_CONTENT;</span>
<span class="line-removed">1057     geometry.final_height.value = h;</span>
<span class="line-removed">1058     geometry.final_height.type = BOUNDSTYPE_CONTENT;</span>
1059     geometry_set_window_x(&amp;geometry, x);
1060     geometry_set_window_y(&amp;geometry, y);
1061 
1062     if (jview) {
1063         mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize,
1064                 event-&gt;width,
1065                 event-&gt;height);
1066         CHECK_JNI_EXCEPTION(mainEnv)
1067         mainEnv-&gt;CallVoidMethod(jview, jViewNotifyView,
1068                 com_sun_glass_events_ViewEvent_MOVE);
1069         CHECK_JNI_EXCEPTION(mainEnv)






1070     }
1071     if (jwindow) {
1072         mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyResize,
1073                 (is_maximized)
1074                     ? com_sun_glass_events_WindowEvent_MAXIMIZE
1075                     : com_sun_glass_events_WindowEvent_RESIZE,
1076                 geometry.current_width,
1077                 geometry.current_height);
1078         CHECK_JNI_EXCEPTION(mainEnv)
1079 
1080         mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyMove, x, y);
1081         CHECK_JNI_EXCEPTION(mainEnv)
1082     }
1083 
1084     glong to_screen = getScreenPtrForLocation(x, y);
1085     if (to_screen != -1) {
1086         if (to_screen != screen) {
1087             if (jwindow) {
1088                 //notify screen changed
1089                 jobject jScreen = createJavaScreen(mainEnv, to_screen);
</pre>
<hr />
<pre>
1264     }
1265 
1266     if (windowChangesMask &amp; (CWWidth | CWHeight)) {
1267         gint newWidth, newHeight;
1268         gtk_window_get_size(GTK_WINDOW(gtk_widget), &amp;newWidth, &amp;newHeight);
1269 
1270         if (windowChangesMask &amp; CWWidth) {
1271             newWidth = windowChanges-&gt;width;
1272         }
1273         if (windowChangesMask &amp; CWHeight) {
1274             newHeight = windowChanges-&gt;height;
1275         }
1276 
1277         if (!resizable.value) {
1278             GdkGeometry geom;
1279             GdkWindowHints hints = (GdkWindowHints)(GDK_HINT_MIN_SIZE | GDK_HINT_MAX_SIZE);
1280             geom.min_width = geom.max_width = newWidth;
1281             geom.min_height = geom.max_height = newHeight;
1282             gtk_window_set_geometry_hints(GTK_WINDOW(gtk_widget), NULL, &amp;geom, hints);
1283         }
<span class="line-removed">1284         gtk_window_resize(GTK_WINDOW(gtk_widget), newWidth, newHeight);</span>
1285 
<span class="line-modified">1286         //JDK-8193502: Moved here from WindowContextBase::set_view because set_view is called</span>
<span class="line-removed">1287         //first and the size is not set yet. This also guarantees that the size will be correct</span>
<span class="line-removed">1288         //see: gtk_window_get_size doc for more context.</span>
<span class="line-removed">1289         if (jview) {</span>
<span class="line-removed">1290             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize, newWidth, newHeight);</span>
<span class="line-removed">1291             CHECK_JNI_EXCEPTION(mainEnv);</span>
<span class="line-removed">1292         }</span>
1293     }
1294 }
1295 
1296 void WindowContextTop::applyShapeMask(void* data, uint width, uint height)
1297 {
1298     if (frame_type != TRANSPARENT) {
1299         return;
1300     }
1301 
1302     glass_window_apply_shape_mask(gtk_widget_get_window(gtk_widget), data, width, height);
1303 }
1304 
1305 void WindowContextTop::ensure_window_size() {
1306     gint w, h;
1307 #ifdef GLASS_GTK3
1308     gdk_window_get_geometry(gdk_window, NULL, NULL, &amp;w, &amp;h);
1309 #else
1310     gdk_window_get_geometry(gdk_window, NULL, NULL, &amp;w, &amp;h, NULL);
1311 #endif
1312     if (size_assigned &amp;&amp; (geometry.final_width.value != w
</pre>
</td>
<td>
<hr />
<pre>
1033             updateWindowConstraints = true;
1034             if (!frame_extents_initialized &amp;&amp; !is_null_extents()) {
1035                 frame_extents_initialized = true;
1036                 set_bounds(0, 0, false, false,
1037                     requested_bounds.width, requested_bounds.height,
1038                     requested_bounds.client_width, requested_bounds.client_height
1039                 );
1040             }
1041         }
1042     } else {
1043         x = event-&gt;x;
1044         y = event-&gt;y;
1045         w = event-&gt;width;
1046         h = event-&gt;height;
1047     }
1048 
1049     if (size_assigned &amp;&amp; w &lt;= 1 &amp;&amp; h &lt;= 1 &amp;&amp; (geometry.final_width.value &gt; 1 ||
1050                                              geometry.final_height.value &gt; 1)) {
1051         // skip artifact
1052         return;
<span class="line-added">1053 </span>
<span class="line-added">1054     }</span>
<span class="line-added">1055 </span>
<span class="line-added">1056     //JDK-8232811: update the geometry only after window pops to avoid conflicting events while updating sizes</span>
<span class="line-added">1057     if (map_received) {</span>
<span class="line-added">1058         geometry.final_width.value = w;</span>
<span class="line-added">1059         geometry.final_width.type = BOUNDSTYPE_CONTENT;</span>
<span class="line-added">1060         geometry.final_height.value = h;</span>
<span class="line-added">1061         geometry.final_height.type = BOUNDSTYPE_CONTENT;</span>
1062     }
1063 




1064     geometry_set_window_x(&amp;geometry, x);
1065     geometry_set_window_y(&amp;geometry, y);
1066 
1067     if (jview) {
1068         mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize,
1069                 event-&gt;width,
1070                 event-&gt;height);
1071         CHECK_JNI_EXCEPTION(mainEnv)
1072         mainEnv-&gt;CallVoidMethod(jview, jViewNotifyView,
1073                 com_sun_glass_events_ViewEvent_MOVE);
1074         CHECK_JNI_EXCEPTION(mainEnv)
<span class="line-added">1075 </span>
<span class="line-added">1076         //JDK-8193502: Moved here from WindowContextBase::set_view because set_view is called</span>
<span class="line-added">1077         //first and the size is not set yet. This also guarantees that the size will be correct</span>
<span class="line-added">1078         //see: gtk_window_get_size doc for more context.</span>
<span class="line-added">1079         mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize, w, h);</span>
<span class="line-added">1080         CHECK_JNI_EXCEPTION(mainEnv);</span>
1081     }
1082     if (jwindow) {
1083         mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyResize,
1084                 (is_maximized)
1085                     ? com_sun_glass_events_WindowEvent_MAXIMIZE
1086                     : com_sun_glass_events_WindowEvent_RESIZE,
1087                 geometry.current_width,
1088                 geometry.current_height);
1089         CHECK_JNI_EXCEPTION(mainEnv)
1090 
1091         mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyMove, x, y);
1092         CHECK_JNI_EXCEPTION(mainEnv)
1093     }
1094 
1095     glong to_screen = getScreenPtrForLocation(x, y);
1096     if (to_screen != -1) {
1097         if (to_screen != screen) {
1098             if (jwindow) {
1099                 //notify screen changed
1100                 jobject jScreen = createJavaScreen(mainEnv, to_screen);
</pre>
<hr />
<pre>
1275     }
1276 
1277     if (windowChangesMask &amp; (CWWidth | CWHeight)) {
1278         gint newWidth, newHeight;
1279         gtk_window_get_size(GTK_WINDOW(gtk_widget), &amp;newWidth, &amp;newHeight);
1280 
1281         if (windowChangesMask &amp; CWWidth) {
1282             newWidth = windowChanges-&gt;width;
1283         }
1284         if (windowChangesMask &amp; CWHeight) {
1285             newHeight = windowChanges-&gt;height;
1286         }
1287 
1288         if (!resizable.value) {
1289             GdkGeometry geom;
1290             GdkWindowHints hints = (GdkWindowHints)(GDK_HINT_MIN_SIZE | GDK_HINT_MAX_SIZE);
1291             geom.min_width = geom.max_width = newWidth;
1292             geom.min_height = geom.max_height = newHeight;
1293             gtk_window_set_geometry_hints(GTK_WINDOW(gtk_widget), NULL, &amp;geom, hints);
1294         }

1295 
<span class="line-modified">1296         gtk_window_resize(GTK_WINDOW(gtk_widget), newWidth, newHeight);</span>






1297     }
1298 }
1299 
1300 void WindowContextTop::applyShapeMask(void* data, uint width, uint height)
1301 {
1302     if (frame_type != TRANSPARENT) {
1303         return;
1304     }
1305 
1306     glass_window_apply_shape_mask(gtk_widget_get_window(gtk_widget), data, width, height);
1307 }
1308 
1309 void WindowContextTop::ensure_window_size() {
1310     gint w, h;
1311 #ifdef GLASS_GTK3
1312     gdk_window_get_geometry(gdk_window, NULL, NULL, &amp;w, &amp;h);
1313 #else
1314     gdk_window_get_geometry(gdk_window, NULL, NULL, &amp;w, &amp;h, NULL);
1315 #endif
1316     if (size_assigned &amp;&amp; (geometry.final_width.value != w
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>