<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/test/java/test/com/sun/webkit/network/CookieManagerTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../javafx/scene/web/CallbackTest.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/test/java/test/com/sun/webkit/network/CookieManagerTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
390     /**
391      * Tests if put() correctly handles overwrites.
392      */
393     @Test
394     public void testPutOverwrite() {
395         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;, &quot;baz=qux&quot;);
396         assertEquals(&quot;foo=bar; baz=qux&quot;, get(&quot;http://example.org/&quot;));
397 
398         sleep(10);
399 
400         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;);
401         assertEquals(&quot;foo=bar; baz=qux&quot;, get(&quot;http://example.org/&quot;));
402 
403         put(&quot;http://example.org/&quot;, &quot;foo=discard; Max-Age=0&quot;);
404         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;);
405         assertEquals(&quot;baz=qux; foo=bar&quot;, get(&quot;http://example.org/&quot;));
406     }
407 
408     /**
409      * Tests if put() correctly overwrites expired cookie.
<span class="line-removed">410      * This test is disabled because it takes considerable amount of time</span>
<span class="line-removed">411      * to run.</span>
412      */
<span class="line-removed">413     @Ignore</span>
414     @Test
415     public void testPutOverwriteExpired() {
416         put(&quot;http://example.org/&quot;, &quot;foo=bar; Max-Age=1; HttpOnly&quot;);
417         assertEquals(&quot;&quot;, get(&quot;javascript://example.org/&quot;));
418 
419         put(&quot;javascript://example.org/&quot;, &quot;foo=bar&quot;);
420         assertEquals(&quot;&quot;, get(&quot;javascript://example.org/&quot;));
421 
422         sleep(1200);
423 
424         put(&quot;javascript://example.org/&quot;, &quot;foo=bar&quot;);
425         assertEquals(&quot;foo=bar&quot;, get(&quot;javascript://example.org/&quot;));
426     }
427 
428     /**
429      * Tests if put() correctly handles duplicates within a single request.
430      */
431     @Test
432     public void testPutDuplicates() {
433         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;, &quot;foo=baz&quot;);
</pre>
<hr />
<pre>
480      * Tests if put() correctly purges individual domains.
481      */
482     @Test
483     public void testPutPurgeDomain3() {
484         for (int i = 0; i &lt; 50; i++) {
485             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d&quot;, i));
486         }
487         assertEquals(gen(0, 50), toSet(get(&quot;http://example.org/&quot;)));
488 
489         sleep(10);
490 
491         for (int i = 50; i &lt; 100; i++) {
492             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d&quot;, i));
493         }
494         assertEquals(gen(50, 100), toSet(get(&quot;http://example.org/&quot;)));
495     }
496 
497     /**
498      * Tests if put() correctly purges individual domains
499      * and takes into account cookie expiry.
<span class="line-removed">500      * This test is disabled because it takes considerable amount of time</span>
<span class="line-removed">501      * to run.</span>
502      */
<span class="line-removed">503     @Ignore</span>
504     @Test
505     public void testPutPurgeDomainAfterExpiry() {
506         for (int i = 0; i &lt; 25; i++) {
507             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d&quot;, i));
508         }
509         for (int i = 25; i &lt; 50; i++) {
510             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d; Max-Age=1&quot;, i));
511         }
512         assertEquals(gen(0, 50), toSet(get(&quot;http://example.org/&quot;)));
513 
514         sleep(1200);
515 
516         put(&quot;http://example.org/&quot;, &quot;foo50=bar50&quot;);
517         Set&lt;String&gt; expected = gen(0, 25);
518         expected.add(&quot;foo50=bar50&quot;);
519         assertEquals(expected, toSet(get(&quot;http://example.org/&quot;)));
520     }
521 
522     private static Set&lt;String&gt; gen(int from, int to) {
523         Set&lt;String&gt; set = new LinkedHashSet&lt;String&gt;(to - from);
</pre>
<hr />
<pre>
530     /**
531      * Tests if put() correctly purges cookies globally.
532      */
533     @Test
534     public void testPutPurgeCookiesGlobally1() {
535         String urip = &quot;http://example%d.org/&quot;;
536         for (int i = 0; i &lt; 10000; i++) {
537             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
538         }
539         int count = 0;
540         for (int i = 0; i &lt; 10000; i++) {
541             if (get(fmt(urip, i)).length() &gt; 0) {
542                 count++;
543             }
544         }
545         assertEquals(3994, count);
546     }
547 
548     /**
549      * Tests if put() correctly purges cookies globally.
<span class="line-removed">550      * This test is disabled because it takes considerable amount of time</span>
<span class="line-removed">551      * to run.</span>
552      */
<span class="line-removed">553     @Ignore</span>
554     @Test
555     public void testPutPurgeCookiesGlobally2() {
556         String urip = &quot;http://example%d.org/&quot;;
557         for (int i = 0; i &lt; 1001; i++) {
558             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
559         }
560         for (int i = 0; i &lt; 1001; i++) {
561             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
562         }
563         for (int i = 1001; i &lt; 5001; i++) {
564             assertEquals(&quot;&quot;, get(fmt(urip, i)));
565         }
566 
567         sleep(10);
568 
569         for (int i = 1001; i &lt; 5001; i++) {
570             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
571         }
572         for (int i = 0; i &lt; 1001; i++) {
573             assertEquals(&quot;&quot;, get(fmt(urip, i)));
574         }
575         for (int i = 1001; i &lt; 5001; i++) {
576             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
577         }
578     }
579 
580     /**
581      * Tests if put() correctly purges cookies globally.
<span class="line-removed">582      * This test is disabled because it takes considerable amount of time</span>
<span class="line-removed">583      * to run.</span>
584      */
<span class="line-removed">585     @Ignore</span>
586     @Test
587     public void testPutPurgeCookiesGlobally3() {
588         String urip = &quot;http://example%d.org/&quot;;
589         for (int i = 0; i &lt; 2002; i++) {
590             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
591         }
592         for (int i = 0; i &lt; 2002; i++) {
593             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
594         }
595         for (int i = 2002; i &lt; 6002; i++) {
596             assertEquals(&quot;&quot;, get(fmt(urip, i)));
597         }
598 
599         sleep(10);
600 
601         for (int i = 2002; i &lt; 6002; i++) {
602             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
603         }
604         for (int i = 0; i &lt; 2002; i++) {
605             assertEquals(&quot;&quot;, get(fmt(urip, i)));
606         }
607         for (int i = 2002; i &lt; 6002; i++) {
608             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
609         }
610     }
611 
612     /**
613      * Tests if put() correctly purges cookies globally and takes
614      * into account cookie expiry.
<span class="line-removed">615      * This test is disabled because it takes considerable amount of time</span>
<span class="line-removed">616      * to run.</span>
617      */
<span class="line-removed">618     @Ignore</span>
619     @Test
620     public void testPutPurgeCookiesGloballyAfterExpiry() {
621         String urip = &quot;http://example%d.org/&quot;;
622         for (int i = 0; i &lt; 2000; i++) {
623             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
624         }
625         for (int i = 2000; i &lt; 4000; i++) {
626             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d; Max-Age=1&quot;, i));
627         }
628         for (int i = 0; i &lt; 4000; i++) {
629             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
630         }
631 
632         sleep(1200);
633 
634         for (int i = 4000; i &lt; 4001; i++) {
635             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
636         }
637         for (int i = 0; i &lt; 2000; i++) {
638             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
</pre>
</td>
<td>
<hr />
<pre>
390     /**
391      * Tests if put() correctly handles overwrites.
392      */
393     @Test
394     public void testPutOverwrite() {
395         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;, &quot;baz=qux&quot;);
396         assertEquals(&quot;foo=bar; baz=qux&quot;, get(&quot;http://example.org/&quot;));
397 
398         sleep(10);
399 
400         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;);
401         assertEquals(&quot;foo=bar; baz=qux&quot;, get(&quot;http://example.org/&quot;));
402 
403         put(&quot;http://example.org/&quot;, &quot;foo=discard; Max-Age=0&quot;);
404         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;);
405         assertEquals(&quot;baz=qux; foo=bar&quot;, get(&quot;http://example.org/&quot;));
406     }
407 
408     /**
409      * Tests if put() correctly overwrites expired cookie.


410      */

411     @Test
412     public void testPutOverwriteExpired() {
413         put(&quot;http://example.org/&quot;, &quot;foo=bar; Max-Age=1; HttpOnly&quot;);
414         assertEquals(&quot;&quot;, get(&quot;javascript://example.org/&quot;));
415 
416         put(&quot;javascript://example.org/&quot;, &quot;foo=bar&quot;);
417         assertEquals(&quot;&quot;, get(&quot;javascript://example.org/&quot;));
418 
419         sleep(1200);
420 
421         put(&quot;javascript://example.org/&quot;, &quot;foo=bar&quot;);
422         assertEquals(&quot;foo=bar&quot;, get(&quot;javascript://example.org/&quot;));
423     }
424 
425     /**
426      * Tests if put() correctly handles duplicates within a single request.
427      */
428     @Test
429     public void testPutDuplicates() {
430         put(&quot;http://example.org/&quot;, &quot;foo=bar&quot;, &quot;foo=baz&quot;);
</pre>
<hr />
<pre>
477      * Tests if put() correctly purges individual domains.
478      */
479     @Test
480     public void testPutPurgeDomain3() {
481         for (int i = 0; i &lt; 50; i++) {
482             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d&quot;, i));
483         }
484         assertEquals(gen(0, 50), toSet(get(&quot;http://example.org/&quot;)));
485 
486         sleep(10);
487 
488         for (int i = 50; i &lt; 100; i++) {
489             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d&quot;, i));
490         }
491         assertEquals(gen(50, 100), toSet(get(&quot;http://example.org/&quot;)));
492     }
493 
494     /**
495      * Tests if put() correctly purges individual domains
496      * and takes into account cookie expiry.


497      */

498     @Test
499     public void testPutPurgeDomainAfterExpiry() {
500         for (int i = 0; i &lt; 25; i++) {
501             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d&quot;, i));
502         }
503         for (int i = 25; i &lt; 50; i++) {
504             put(&quot;http://example.org/&quot;, fmt(&quot;foo%1$d=bar%1$d; Max-Age=1&quot;, i));
505         }
506         assertEquals(gen(0, 50), toSet(get(&quot;http://example.org/&quot;)));
507 
508         sleep(1200);
509 
510         put(&quot;http://example.org/&quot;, &quot;foo50=bar50&quot;);
511         Set&lt;String&gt; expected = gen(0, 25);
512         expected.add(&quot;foo50=bar50&quot;);
513         assertEquals(expected, toSet(get(&quot;http://example.org/&quot;)));
514     }
515 
516     private static Set&lt;String&gt; gen(int from, int to) {
517         Set&lt;String&gt; set = new LinkedHashSet&lt;String&gt;(to - from);
</pre>
<hr />
<pre>
524     /**
525      * Tests if put() correctly purges cookies globally.
526      */
527     @Test
528     public void testPutPurgeCookiesGlobally1() {
529         String urip = &quot;http://example%d.org/&quot;;
530         for (int i = 0; i &lt; 10000; i++) {
531             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
532         }
533         int count = 0;
534         for (int i = 0; i &lt; 10000; i++) {
535             if (get(fmt(urip, i)).length() &gt; 0) {
536                 count++;
537             }
538         }
539         assertEquals(3994, count);
540     }
541 
542     /**
543      * Tests if put() correctly purges cookies globally.


544      */

545     @Test
546     public void testPutPurgeCookiesGlobally2() {
547         String urip = &quot;http://example%d.org/&quot;;
548         for (int i = 0; i &lt; 1001; i++) {
549             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
550         }
551         for (int i = 0; i &lt; 1001; i++) {
552             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
553         }
554         for (int i = 1001; i &lt; 5001; i++) {
555             assertEquals(&quot;&quot;, get(fmt(urip, i)));
556         }
557 
558         sleep(10);
559 
560         for (int i = 1001; i &lt; 5001; i++) {
561             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
562         }
563         for (int i = 0; i &lt; 1001; i++) {
564             assertEquals(&quot;&quot;, get(fmt(urip, i)));
565         }
566         for (int i = 1001; i &lt; 5001; i++) {
567             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
568         }
569     }
570 
571     /**
572      * Tests if put() correctly purges cookies globally.


573      */

574     @Test
575     public void testPutPurgeCookiesGlobally3() {
576         String urip = &quot;http://example%d.org/&quot;;
577         for (int i = 0; i &lt; 2002; i++) {
578             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
579         }
580         for (int i = 0; i &lt; 2002; i++) {
581             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
582         }
583         for (int i = 2002; i &lt; 6002; i++) {
584             assertEquals(&quot;&quot;, get(fmt(urip, i)));
585         }
586 
587         sleep(10);
588 
589         for (int i = 2002; i &lt; 6002; i++) {
590             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
591         }
592         for (int i = 0; i &lt; 2002; i++) {
593             assertEquals(&quot;&quot;, get(fmt(urip, i)));
594         }
595         for (int i = 2002; i &lt; 6002; i++) {
596             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
597         }
598     }
599 
600     /**
601      * Tests if put() correctly purges cookies globally and takes
602      * into account cookie expiry.


603      */

604     @Test
605     public void testPutPurgeCookiesGloballyAfterExpiry() {
606         String urip = &quot;http://example%d.org/&quot;;
607         for (int i = 0; i &lt; 2000; i++) {
608             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
609         }
610         for (int i = 2000; i &lt; 4000; i++) {
611             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d; Max-Age=1&quot;, i));
612         }
613         for (int i = 0; i &lt; 4000; i++) {
614             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
615         }
616 
617         sleep(1200);
618 
619         for (int i = 4000; i &lt; 4001; i++) {
620             put(fmt(urip, i), fmt(&quot;foo%1$d=bar%1$d&quot;, i));
621         }
622         for (int i = 0; i &lt; 2000; i++) {
623             assertEquals(fmt(&quot;foo%1$d=bar%1$d&quot;, i), get(fmt(urip, i)));
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../javafx/scene/web/CallbackTest.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>