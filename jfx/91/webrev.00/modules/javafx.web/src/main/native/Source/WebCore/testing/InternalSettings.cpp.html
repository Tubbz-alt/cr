<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/testing/InternalSettings.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (C) 2012 Google Inc. All rights reserved.
   3  * Copyright (C) 2013 Apple Inc. All rights reserved.
   4  *
   5  * Redistribution and use in source and binary forms, with or without
   6  * modification, are permitted provided that the following conditions
   7  * are met:
   8  *
   9  * 1.  Redistributions of source code must retain the above copyright
  10  *     notice, this list of conditions and the following disclaimer.
  11  * 2.  Redistributions in binary form must reproduce the above copyright
  12  *     notice, this list of conditions and the following disclaimer in the
  13  *     documentation and/or other materials provided with the distribution.
  14  *
  15  * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS &quot;AS IS&quot; AND ANY
  16  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
  17  * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  18  * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
  19  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  20  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  21  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  22  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  24  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  25  */
  26 
  27 #include &quot;config.h&quot;
  28 #include &quot;InternalSettings.h&quot;
  29 
  30 #include &quot;CaptionUserPreferences.h&quot;
  31 #include &quot;DeprecatedGlobalSettings.h&quot;
  32 #include &quot;Document.h&quot;
  33 #include &quot;FontCache.h&quot;
  34 #include &quot;Frame.h&quot;
  35 #include &quot;FrameView.h&quot;
  36 #include &quot;LocaleToScriptMapping.h&quot;
  37 #include &quot;Page.h&quot;
  38 #include &quot;PageGroup.h&quot;
  39 #include &quot;PlatformMediaSessionManager.h&quot;
  40 #include &quot;RenderTheme.h&quot;
  41 #include &quot;RuntimeEnabledFeatures.h&quot;
  42 #include &quot;Settings.h&quot;
  43 #include &quot;Supplementable.h&quot;
  44 #include &lt;wtf/Language.h&gt;
  45 
  46 #if ENABLE(INPUT_TYPE_COLOR)
  47 #include &quot;ColorChooser.h&quot;
  48 #endif
  49 
  50 #if USE(SOUP)
  51 #include &quot;SoupNetworkSession.h&quot;
  52 #endif
  53 
  54 #if PLATFORM(GTK)
  55 #include &lt;gtk/gtk.h&gt;
  56 #endif
  57 
  58 namespace WebCore {
  59 
  60 InternalSettings::Backup::Backup(Settings&amp; settings)
  61     : m_originalEditingBehavior(settings.editingBehaviorType())
  62 #if ENABLE(TEXT_AUTOSIZING)
  63     , m_originalTextAutosizingEnabled(settings.textAutosizingEnabled())
  64     , m_originalTextAutosizingWindowSizeOverride(settings.textAutosizingWindowSizeOverride())
  65     , m_originalTextAutosizingUsesIdempotentMode(settings.textAutosizingUsesIdempotentMode())
  66 #endif
  67     , m_originalMediaTypeOverride(settings.mediaTypeOverride())
  68     , m_originalCanvasUsesAcceleratedDrawing(settings.canvasUsesAcceleratedDrawing())
  69     , m_originalMockScrollbarsEnabled(DeprecatedGlobalSettings::mockScrollbarsEnabled())
  70     , m_imagesEnabled(settings.areImagesEnabled())
  71     , m_preferMIMETypeForImages(settings.preferMIMETypeForImages())
  72     , m_minimumDOMTimerInterval(settings.minimumDOMTimerInterval())
  73 #if ENABLE(VIDEO_TRACK)
  74     , m_shouldDisplaySubtitles(settings.shouldDisplaySubtitles())
  75     , m_shouldDisplayCaptions(settings.shouldDisplayCaptions())
  76     , m_shouldDisplayTextDescriptions(settings.shouldDisplayTextDescriptions())
  77 #endif
  78     , m_defaultVideoPosterURL(settings.defaultVideoPosterURL())
  79     , m_forcePendingWebGLPolicy(settings.isForcePendingWebGLPolicy())
  80     , m_originalTimeWithoutMouseMovementBeforeHidingControls(settings.timeWithoutMouseMovementBeforeHidingControls())
  81     , m_useLegacyBackgroundSizeShorthandBehavior(settings.useLegacyBackgroundSizeShorthandBehavior())
  82     , m_autoscrollForDragAndDropEnabled(settings.autoscrollForDragAndDropEnabled())
  83     , m_quickTimePluginReplacementEnabled(settings.quickTimePluginReplacementEnabled())
  84     , m_youTubeFlashPluginReplacementEnabled(settings.youTubeFlashPluginReplacementEnabled())
  85     , m_shouldConvertPositionStyleOnCopy(settings.shouldConvertPositionStyleOnCopy())
  86     , m_fontFallbackPrefersPictographs(settings.fontFallbackPrefersPictographs())
  87     , m_shouldIgnoreFontLoadCompletions(settings.shouldIgnoreFontLoadCompletions())
  88     , m_backgroundShouldExtendBeyondPage(settings.backgroundShouldExtendBeyondPage())
  89     , m_storageBlockingPolicy(settings.storageBlockingPolicy())
  90     , m_scrollingTreeIncludesFrames(settings.scrollingTreeIncludesFrames())
  91 #if ENABLE(TOUCH_EVENTS)
  92     , m_touchEventEmulationEnabled(settings.isTouchEventEmulationEnabled())
  93 #endif
  94 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
  95     , m_allowsAirPlayForMediaPlayback(settings.allowsAirPlayForMediaPlayback())
  96 #endif
  97     , m_allowsInlineMediaPlayback(settings.allowsInlineMediaPlayback())
  98     , m_allowsInlineMediaPlaybackAfterFullscreen(settings.allowsInlineMediaPlaybackAfterFullscreen())
  99     , m_inlineMediaPlaybackRequiresPlaysInlineAttribute(settings.inlineMediaPlaybackRequiresPlaysInlineAttribute())
 100     , m_deferredCSSParserEnabled(settings.deferredCSSParserEnabled())
 101     , m_inputEventsEnabled(settings.inputEventsEnabled())
 102     , m_incompleteImageBorderEnabled(settings.incompleteImageBorderEnabled())
 103     , m_shouldDispatchSyntheticMouseEventsWhenModifyingSelection(settings.shouldDispatchSyntheticMouseEventsWhenModifyingSelection())
 104     , m_shouldDispatchSyntheticMouseOutAfterSyntheticClick(settings.shouldDispatchSyntheticMouseOutAfterSyntheticClick())
 105     , m_shouldDeactivateAudioSession(PlatformMediaSessionManager::shouldDeactivateAudioSession())
 106     , m_animatedImageDebugCanvasDrawingEnabled(settings.animatedImageDebugCanvasDrawingEnabled())
 107     , m_userInterfaceDirectionPolicy(settings.userInterfaceDirectionPolicy())
 108     , m_systemLayoutDirection(settings.systemLayoutDirection())
 109     , m_pdfImageCachingPolicy(settings.pdfImageCachingPolicy())
 110     , m_forcedColorsAreInvertedAccessibilityValue(settings.forcedColorsAreInvertedAccessibilityValue())
 111     , m_forcedDisplayIsMonochromeAccessibilityValue(settings.forcedDisplayIsMonochromeAccessibilityValue())
 112     , m_forcedPrefersReducedMotionAccessibilityValue(settings.forcedPrefersReducedMotionAccessibilityValue())
 113     , m_fontLoadTimingOverride(settings.fontLoadTimingOverride())
 114     , m_frameFlattening(settings.frameFlattening())
 115 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 116     , m_indexedDBWorkersEnabled(RuntimeEnabledFeatures::sharedFeatures().indexedDBWorkersEnabled())
 117 #endif
 118 #if ENABLE(WEBGL2)
 119     , m_webGL2Enabled(RuntimeEnabledFeatures::sharedFeatures().webGL2Enabled())
 120 #endif
 121     , m_webVREnabled(RuntimeEnabledFeatures::sharedFeatures().webVREnabled())
 122 #if ENABLE(MEDIA_STREAM)
 123     , m_setScreenCaptureEnabled(RuntimeEnabledFeatures::sharedFeatures().screenCaptureEnabled())
 124 #endif
 125     , m_shouldMockBoldSystemFontForAccessibility(RenderTheme::singleton().shouldMockBoldSystemFontForAccessibility())
 126 #if USE(AUDIO_SESSION)
 127     , m_shouldManageAudioSessionCategory(DeprecatedGlobalSettings::shouldManageAudioSessionCategory())
 128 #endif
 129     , m_customPasteboardDataEnabled(RuntimeEnabledFeatures::sharedFeatures().customPasteboardDataEnabled())
 130 {
 131 }
 132 
 133 void InternalSettings::Backup::restoreTo(Settings&amp; settings)
 134 {
 135     settings.setEditingBehaviorType(m_originalEditingBehavior);
 136 
 137     for (const auto&amp; standardFont : m_standardFontFamilies)
 138         settings.setStandardFontFamily(standardFont.value, static_cast&lt;UScriptCode&gt;(standardFont.key));
 139     m_standardFontFamilies.clear();
 140 
 141     for (const auto&amp; fixedFont : m_fixedFontFamilies)
 142         settings.setFixedFontFamily(fixedFont.value, static_cast&lt;UScriptCode&gt;(fixedFont.key));
 143     m_fixedFontFamilies.clear();
 144 
 145     for (const auto&amp; serifFont : m_serifFontFamilies)
 146         settings.setSerifFontFamily(serifFont.value, static_cast&lt;UScriptCode&gt;(serifFont.key));
 147     m_serifFontFamilies.clear();
 148 
 149     for (const auto&amp; sansSerifFont : m_sansSerifFontFamilies)
 150         settings.setSansSerifFontFamily(sansSerifFont.value, static_cast&lt;UScriptCode&gt;(sansSerifFont.key));
 151     m_sansSerifFontFamilies.clear();
 152 
 153     for (const auto&amp; cursiveFont : m_cursiveFontFamilies)
 154         settings.setCursiveFontFamily(cursiveFont.value, static_cast&lt;UScriptCode&gt;(cursiveFont.key));
 155     m_cursiveFontFamilies.clear();
 156 
 157     for (const auto&amp; fantasyFont : m_fantasyFontFamilies)
 158         settings.setFantasyFontFamily(fantasyFont.value, static_cast&lt;UScriptCode&gt;(fantasyFont.key));
 159     m_fantasyFontFamilies.clear();
 160 
 161     for (const auto&amp; pictographFont : m_pictographFontFamilies)
 162         settings.setPictographFontFamily(pictographFont.value, static_cast&lt;UScriptCode&gt;(pictographFont.key));
 163     m_pictographFontFamilies.clear();
 164 
 165 #if ENABLE(TEXT_AUTOSIZING)
 166     settings.setTextAutosizingEnabled(m_originalTextAutosizingEnabled);
 167     settings.setTextAutosizingWindowSizeOverride(m_originalTextAutosizingWindowSizeOverride);
 168     settings.setTextAutosizingUsesIdempotentMode(m_originalTextAutosizingUsesIdempotentMode);
 169 #endif
 170     settings.setMediaTypeOverride(m_originalMediaTypeOverride);
 171     settings.setCanvasUsesAcceleratedDrawing(m_originalCanvasUsesAcceleratedDrawing);
 172     settings.setImagesEnabled(m_imagesEnabled);
 173     settings.setPreferMIMETypeForImages(m_preferMIMETypeForImages);
 174     settings.setMinimumDOMTimerInterval(m_minimumDOMTimerInterval);
 175 #if ENABLE(VIDEO_TRACK)
 176     settings.setShouldDisplaySubtitles(m_shouldDisplaySubtitles);
 177     settings.setShouldDisplayCaptions(m_shouldDisplayCaptions);
 178     settings.setShouldDisplayTextDescriptions(m_shouldDisplayTextDescriptions);
 179 #endif
 180     settings.setDefaultVideoPosterURL(m_defaultVideoPosterURL);
 181     settings.setForcePendingWebGLPolicy(m_forcePendingWebGLPolicy);
 182     settings.setTimeWithoutMouseMovementBeforeHidingControls(m_originalTimeWithoutMouseMovementBeforeHidingControls);
 183     settings.setUseLegacyBackgroundSizeShorthandBehavior(m_useLegacyBackgroundSizeShorthandBehavior);
 184     settings.setAutoscrollForDragAndDropEnabled(m_autoscrollForDragAndDropEnabled);
 185     settings.setShouldConvertPositionStyleOnCopy(m_shouldConvertPositionStyleOnCopy);
 186     settings.setFontFallbackPrefersPictographs(m_fontFallbackPrefersPictographs);
 187     settings.setShouldIgnoreFontLoadCompletions(m_shouldIgnoreFontLoadCompletions);
 188     settings.setBackgroundShouldExtendBeyondPage(m_backgroundShouldExtendBeyondPage);
 189     settings.setStorageBlockingPolicy(m_storageBlockingPolicy);
 190     settings.setScrollingTreeIncludesFrames(m_scrollingTreeIncludesFrames);
 191 #if ENABLE(TOUCH_EVENTS)
 192     settings.setTouchEventEmulationEnabled(m_touchEventEmulationEnabled);
 193 #endif
 194     settings.setAllowsInlineMediaPlayback(m_allowsInlineMediaPlayback);
 195     settings.setAllowsInlineMediaPlaybackAfterFullscreen(m_allowsInlineMediaPlaybackAfterFullscreen);
 196     settings.setInlineMediaPlaybackRequiresPlaysInlineAttribute(m_inlineMediaPlaybackRequiresPlaysInlineAttribute);
 197     settings.setQuickTimePluginReplacementEnabled(m_quickTimePluginReplacementEnabled);
 198     settings.setYouTubeFlashPluginReplacementEnabled(m_youTubeFlashPluginReplacementEnabled);
 199     settings.setDeferredCSSParserEnabled(m_deferredCSSParserEnabled);
 200     settings.setInputEventsEnabled(m_inputEventsEnabled);
 201     settings.setUserInterfaceDirectionPolicy(m_userInterfaceDirectionPolicy);
 202     settings.setSystemLayoutDirection(m_systemLayoutDirection);
 203     settings.setPdfImageCachingPolicy(m_pdfImageCachingPolicy);
 204     settings.setForcedColorsAreInvertedAccessibilityValue(m_forcedColorsAreInvertedAccessibilityValue);
 205     settings.setForcedDisplayIsMonochromeAccessibilityValue(m_forcedDisplayIsMonochromeAccessibilityValue);
 206     settings.setForcedPrefersReducedMotionAccessibilityValue(m_forcedPrefersReducedMotionAccessibilityValue);
 207     settings.setFontLoadTimingOverride(m_fontLoadTimingOverride);
 208     DeprecatedGlobalSettings::setAllowsAnySSLCertificate(false);
 209     RenderTheme::singleton().setShouldMockBoldSystemFontForAccessibility(m_shouldMockBoldSystemFontForAccessibility);
 210     FontCache::singleton().setShouldMockBoldSystemFontForAccessibility(m_shouldMockBoldSystemFontForAccessibility);
 211     settings.setFrameFlattening(m_frameFlattening);
 212     settings.setIncompleteImageBorderEnabled(m_incompleteImageBorderEnabled);
 213     settings.setShouldDispatchSyntheticMouseEventsWhenModifyingSelection(m_shouldDispatchSyntheticMouseEventsWhenModifyingSelection);
 214     settings.setShouldDispatchSyntheticMouseOutAfterSyntheticClick(m_shouldDispatchSyntheticMouseOutAfterSyntheticClick);
 215     PlatformMediaSessionManager::setShouldDeactivateAudioSession(m_shouldDeactivateAudioSession);
 216     settings.setAnimatedImageDebugCanvasDrawingEnabled(m_animatedImageDebugCanvasDrawingEnabled);
 217 
 218 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 219     RuntimeEnabledFeatures::sharedFeatures().setIndexedDBWorkersEnabled(m_indexedDBWorkersEnabled);
 220 #endif
 221 #if ENABLE(WEBGL2)
 222     RuntimeEnabledFeatures::sharedFeatures().setWebGL2Enabled(m_webGL2Enabled);
 223 #endif
 224     RuntimeEnabledFeatures::sharedFeatures().setWebVREnabled(m_webVREnabled);
 225 #if ENABLE(MEDIA_STREAM)
 226     RuntimeEnabledFeatures::sharedFeatures().setScreenCaptureEnabled(m_setScreenCaptureEnabled);
 227 #endif
 228     RuntimeEnabledFeatures::sharedFeatures().setCustomPasteboardDataEnabled(m_customPasteboardDataEnabled);
 229 
 230 #if USE(AUDIO_SESSION)
 231     DeprecatedGlobalSettings::setShouldManageAudioSessionCategory(m_shouldManageAudioSessionCategory);
 232 #endif
 233 }
 234 
 235 class InternalSettingsWrapper : public Supplement&lt;Page&gt; {
 236     WTF_MAKE_FAST_ALLOCATED;
 237 public:
 238     explicit InternalSettingsWrapper(Page* page)
 239         : m_internalSettings(InternalSettings::create(page)) { }
 240     virtual ~InternalSettingsWrapper() { m_internalSettings-&gt;hostDestroyed(); }
 241 #if !ASSERT_DISABLED
 242     bool isRefCountedWrapper() const override { return true; }
 243 #endif
 244     InternalSettings* internalSettings() const { return m_internalSettings.get(); }
 245 
 246 private:
 247     RefPtr&lt;InternalSettings&gt; m_internalSettings;
 248 };
 249 
 250 const char* InternalSettings::supplementName()
 251 {
 252     return &quot;InternalSettings&quot;;
 253 }
 254 
 255 InternalSettings* InternalSettings::from(Page* page)
 256 {
 257     if (!Supplement&lt;Page&gt;::from(page, supplementName()))
 258         Supplement&lt;Page&gt;::provideTo(page, supplementName(), makeUnique&lt;InternalSettingsWrapper&gt;(page));
 259     return static_cast&lt;InternalSettingsWrapper*&gt;(Supplement&lt;Page&gt;::from(page, supplementName()))-&gt;internalSettings();
 260 }
 261 
 262 void InternalSettings::hostDestroyed()
 263 {
 264     m_page = nullptr;
 265 }
 266 
 267 InternalSettings::InternalSettings(Page* page)
 268     : InternalSettingsGenerated(page)
 269     , m_page(page)
 270     , m_backup(page-&gt;settings())
 271 {
 272 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 273     setAllowsAirPlayForMediaPlayback(false);
 274 #endif
 275 #if ENABLE(MEDIA_STREAM)
 276     setMediaCaptureRequiresSecureConnection(false);
 277 #endif
 278 }
 279 
 280 Ref&lt;InternalSettings&gt; InternalSettings::create(Page* page)
 281 {
 282     return adoptRef(*new InternalSettings(page));
 283 }
 284 
 285 void InternalSettings::resetToConsistentState()
 286 {
 287     m_page-&gt;setPageScaleFactor(1, { 0, 0 });
 288     m_page-&gt;mainFrame().setPageAndTextZoomFactors(1, 1);
 289     m_page-&gt;setCanStartMedia(true);
 290     setUseDarkAppearanceInternal(false);
 291 
 292     settings().setForcePendingWebGLPolicy(false);
 293 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 294     settings().setAllowsAirPlayForMediaPlayback(false);
 295 #endif
 296 #if ENABLE(MEDIA_STREAM)
 297     setMediaCaptureRequiresSecureConnection(false);
 298 #endif
 299 
 300     m_backup.restoreTo(settings());
 301     m_backup = Backup { settings() };
 302 
 303     InternalSettingsGenerated::resetToConsistentState();
 304 }
 305 
 306 Settings&amp; InternalSettings::settings() const
 307 {
 308     ASSERT(m_page);
 309     return m_page-&gt;settings();
 310 }
 311 
 312 ExceptionOr&lt;void&gt; InternalSettings::setTouchEventEmulationEnabled(bool enabled)
 313 {
 314     if (!m_page)
 315         return Exception { InvalidAccessError };
 316 #if ENABLE(TOUCH_EVENTS)
 317     settings().setTouchEventEmulationEnabled(enabled);
 318 #else
 319     UNUSED_PARAM(enabled);
 320 #endif
 321     return { };
 322 }
 323 
 324 ExceptionOr&lt;void&gt; InternalSettings::setStandardFontFamily(const String&amp; family, const String&amp; script)
 325 {
 326     if (!m_page)
 327         return Exception { InvalidAccessError };
 328     UScriptCode code = scriptNameToCode(script);
 329     if (code == USCRIPT_INVALID_CODE)
 330         return { };
 331     m_backup.m_standardFontFamilies.add(code, settings().standardFontFamily(code));
 332     settings().setStandardFontFamily(family, code);
 333     return { };
 334 }
 335 
 336 ExceptionOr&lt;void&gt; InternalSettings::setSerifFontFamily(const String&amp; family, const String&amp; script)
 337 {
 338     if (!m_page)
 339         return Exception { InvalidAccessError };
 340     UScriptCode code = scriptNameToCode(script);
 341     if (code == USCRIPT_INVALID_CODE)
 342         return { };
 343     m_backup.m_serifFontFamilies.add(code, settings().serifFontFamily(code));
 344     settings().setSerifFontFamily(family, code);
 345     return { };
 346 }
 347 
 348 ExceptionOr&lt;void&gt; InternalSettings::setSansSerifFontFamily(const String&amp; family, const String&amp; script)
 349 {
 350     if (!m_page)
 351         return Exception { InvalidAccessError };
 352     UScriptCode code = scriptNameToCode(script);
 353     if (code == USCRIPT_INVALID_CODE)
 354         return { };
 355     m_backup.m_sansSerifFontFamilies.add(code, settings().sansSerifFontFamily(code));
 356     settings().setSansSerifFontFamily(family, code);
 357     return { };
 358 }
 359 
 360 ExceptionOr&lt;void&gt; InternalSettings::setFixedFontFamily(const String&amp; family, const String&amp; script)
 361 {
 362     if (!m_page)
 363         return Exception { InvalidAccessError };
 364     UScriptCode code = scriptNameToCode(script);
 365     if (code == USCRIPT_INVALID_CODE)
 366         return { };
 367     m_backup.m_fixedFontFamilies.add(code, settings().fixedFontFamily(code));
 368     settings().setFixedFontFamily(family, code);
 369     return { };
 370 }
 371 
 372 ExceptionOr&lt;void&gt; InternalSettings::setCursiveFontFamily(const String&amp; family, const String&amp; script)
 373 {
 374     if (!m_page)
 375         return Exception { InvalidAccessError };
 376     UScriptCode code = scriptNameToCode(script);
 377     if (code == USCRIPT_INVALID_CODE)
 378         return { };
 379     m_backup.m_cursiveFontFamilies.add(code, settings().cursiveFontFamily(code));
 380     settings().setCursiveFontFamily(family, code);
 381     return { };
 382 }
 383 
 384 ExceptionOr&lt;void&gt; InternalSettings::setFantasyFontFamily(const String&amp; family, const String&amp; script)
 385 {
 386     if (!m_page)
 387         return Exception { InvalidAccessError };
 388     UScriptCode code = scriptNameToCode(script);
 389     if (code == USCRIPT_INVALID_CODE)
 390         return { };
 391     m_backup.m_fantasyFontFamilies.add(code, settings().fantasyFontFamily(code));
 392     settings().setFantasyFontFamily(family, code);
 393     return { };
 394 }
 395 
 396 ExceptionOr&lt;void&gt; InternalSettings::setPictographFontFamily(const String&amp; family, const String&amp; script)
 397 {
 398     if (!m_page)
 399         return Exception { InvalidAccessError };
 400     UScriptCode code = scriptNameToCode(script);
 401     if (code == USCRIPT_INVALID_CODE)
 402         return { };
 403     m_backup.m_pictographFontFamilies.add(code, settings().pictographFontFamily(code));
 404     settings().setPictographFontFamily(family, code);
 405     return { };
 406 }
 407 
 408 ExceptionOr&lt;void&gt; InternalSettings::setTextAutosizingEnabled(bool enabled)
 409 {
 410     if (!m_page)
 411         return Exception { InvalidAccessError };
 412 #if ENABLE(TEXT_AUTOSIZING)
 413     settings().setTextAutosizingEnabled(enabled);
 414 #else
 415     UNUSED_PARAM(enabled);
 416 #endif
 417     return { };
 418 }
 419 
 420 ExceptionOr&lt;void&gt; InternalSettings::setTextAutosizingWindowSizeOverride(int width, int height)
 421 {
 422     if (!m_page)
 423         return Exception { InvalidAccessError };
 424 #if ENABLE(TEXT_AUTOSIZING)
 425     settings().setTextAutosizingWindowSizeOverride(IntSize(width, height));
 426 #else
 427     UNUSED_PARAM(width);
 428     UNUSED_PARAM(height);
 429 #endif
 430     return { };
 431 }
 432 
 433 ExceptionOr&lt;void&gt; InternalSettings::setTextAutosizingUsesIdempotentMode(bool enabled)
 434 {
 435     if (!m_page)
 436         return Exception { InvalidAccessError };
 437 #if ENABLE(TEXT_AUTOSIZING)
 438     settings().setTextAutosizingUsesIdempotentMode(enabled);
 439 #else
 440     UNUSED_PARAM(enabled);
 441 #endif
 442     return { };
 443 }
 444 
 445 ExceptionOr&lt;void&gt; InternalSettings::setMediaTypeOverride(const String&amp; mediaType)
 446 {
 447     if (!m_page)
 448         return Exception { InvalidAccessError };
 449     settings().setMediaTypeOverride(mediaType);
 450     return { };
 451 }
 452 
 453 ExceptionOr&lt;void&gt; InternalSettings::setCanStartMedia(bool enabled)
 454 {
 455     if (!m_page)
 456         return Exception { InvalidAccessError };
 457     m_page-&gt;setCanStartMedia(enabled);
 458     return { };
 459 }
 460 
 461 ExceptionOr&lt;void&gt; InternalSettings::setAllowsAirPlayForMediaPlayback(bool allows)
 462 {
 463     if (!m_page)
 464         return Exception { InvalidAccessError };
 465 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 466     settings().setAllowsAirPlayForMediaPlayback(allows);
 467 #else
 468     UNUSED_PARAM(allows);
 469 #endif
 470     return { };
 471 }
 472 
 473 ExceptionOr&lt;void&gt; InternalSettings::setMediaCaptureRequiresSecureConnection(bool requires)
 474 {
 475     if (!m_page)
 476         return Exception { InvalidAccessError };
 477 #if ENABLE(MEDIA_STREAM)
 478     m_page-&gt;settings().setMediaCaptureRequiresSecureConnection(requires);
 479 #else
 480     UNUSED_PARAM(requires);
 481 #endif
 482     return { };
 483 }
 484 
 485 ExceptionOr&lt;void&gt; InternalSettings::setEditingBehavior(const String&amp; editingBehavior)
 486 {
 487     if (!m_page)
 488         return Exception { InvalidAccessError };
 489     if (equalLettersIgnoringASCIICase(editingBehavior, &quot;win&quot;))
 490         settings().setEditingBehaviorType(EditingWindowsBehavior);
 491     else if (equalLettersIgnoringASCIICase(editingBehavior, &quot;mac&quot;))
 492         settings().setEditingBehaviorType(EditingMacBehavior);
 493     else if (equalLettersIgnoringASCIICase(editingBehavior, &quot;unix&quot;))
 494         settings().setEditingBehaviorType(EditingUnixBehavior);
 495     else if (equalLettersIgnoringASCIICase(editingBehavior, &quot;ios&quot;))
 496         settings().setEditingBehaviorType(EditingIOSBehavior);
 497     else
 498         return Exception { SyntaxError };
 499     return { };
 500 }
 501 
 502 ExceptionOr&lt;void&gt; InternalSettings::setShouldDisplayTrackKind(const String&amp; kind, bool enabled)
 503 {
 504     if (!m_page)
 505         return Exception { InvalidAccessError };
 506 #if ENABLE(VIDEO_TRACK)
 507     auto&amp; captionPreferences = m_page-&gt;group().captionPreferences();
 508     if (equalLettersIgnoringASCIICase(kind, &quot;subtitles&quot;))
 509         captionPreferences.setUserPrefersSubtitles(enabled);
 510     else if (equalLettersIgnoringASCIICase(kind, &quot;captions&quot;))
 511         captionPreferences.setUserPrefersCaptions(enabled);
 512     else if (equalLettersIgnoringASCIICase(kind, &quot;textdescriptions&quot;))
 513         captionPreferences.setUserPrefersTextDescriptions(enabled);
 514     else
 515         return Exception { SyntaxError };
 516 #else
 517     UNUSED_PARAM(kind);
 518     UNUSED_PARAM(enabled);
 519 #endif
 520     return { };
 521 }
 522 
 523 ExceptionOr&lt;bool&gt; InternalSettings::shouldDisplayTrackKind(const String&amp; kind)
 524 {
 525     if (!m_page)
 526         return Exception { InvalidAccessError };
 527 #if ENABLE(VIDEO_TRACK)
 528     auto&amp; captionPreferences = m_page-&gt;group().captionPreferences();
 529     if (equalLettersIgnoringASCIICase(kind, &quot;subtitles&quot;))
 530         return captionPreferences.userPrefersSubtitles();
 531     if (equalLettersIgnoringASCIICase(kind, &quot;captions&quot;))
 532         return captionPreferences.userPrefersCaptions();
 533     if (equalLettersIgnoringASCIICase(kind, &quot;textdescriptions&quot;))
 534         return captionPreferences.userPrefersTextDescriptions();
 535 
 536     return Exception { SyntaxError };
 537 #else
 538     UNUSED_PARAM(kind);
 539     return false;
 540 #endif
 541 }
 542 
 543 void InternalSettings::setUseDarkAppearanceInternal(bool useDarkAppearance)
 544 {
 545 #if PLATFORM(GTK)
 546     // GTK doesn&#39;t allow to change the theme from the web process, but tests need to do it, so
 547     // we do it here only for tests.
 548     if (auto* settings = gtk_settings_get_default()) {
 549         gboolean preferDarkTheme;
 550         g_object_get(settings, &quot;gtk-application-prefer-dark-theme&quot;, &amp;preferDarkTheme, nullptr);
 551         if (preferDarkTheme != useDarkAppearance)
 552             g_object_set(settings, &quot;gtk-application-prefer-dark-theme&quot;, useDarkAppearance, nullptr);
 553     }
 554 #endif
 555     ASSERT(m_page);
 556     m_page-&gt;effectiveAppearanceDidChange(useDarkAppearance, m_page-&gt;useElevatedUserInterfaceLevel());
 557 }
 558 
 559 ExceptionOr&lt;void&gt; InternalSettings::setUseDarkAppearance(bool useDarkAppearance)
 560 {
 561     if (!m_page)
 562         return Exception { InvalidAccessError };
 563     setUseDarkAppearanceInternal(useDarkAppearance);
 564     return { };
 565 }
 566 
 567 ExceptionOr&lt;void&gt; InternalSettings::setStorageBlockingPolicy(const String&amp; mode)
 568 {
 569     if (!m_page)
 570         return Exception { InvalidAccessError };
 571     if (mode == &quot;AllowAll&quot;)
 572         settings().setStorageBlockingPolicy(SecurityOrigin::AllowAllStorage);
 573     else if (mode == &quot;BlockThirdParty&quot;)
 574         settings().setStorageBlockingPolicy(SecurityOrigin::BlockThirdPartyStorage);
 575     else if (mode == &quot;BlockAll&quot;)
 576         settings().setStorageBlockingPolicy(SecurityOrigin::BlockAllStorage);
 577     else
 578         return Exception { SyntaxError };
 579     return { };
 580 }
 581 
 582 ExceptionOr&lt;void&gt; InternalSettings::setPreferMIMETypeForImages(bool preferMIMETypeForImages)
 583 {
 584     if (!m_page)
 585         return Exception { InvalidAccessError };
 586     settings().setPreferMIMETypeForImages(preferMIMETypeForImages);
 587     return { };
 588 }
 589 
 590 ExceptionOr&lt;void&gt; InternalSettings::setImagesEnabled(bool enabled)
 591 {
 592     if (!m_page)
 593         return Exception { InvalidAccessError };
 594     settings().setImagesEnabled(enabled);
 595     return { };
 596 }
 597 
 598 ExceptionOr&lt;void&gt; InternalSettings::setPDFImageCachingPolicy(const String&amp; policy)
 599 {
 600     if (!m_page)
 601         return Exception { InvalidAccessError };
 602     if (equalLettersIgnoringASCIICase(policy, &quot;disabled&quot;))
 603         settings().setPdfImageCachingPolicy(PDFImageCachingDisabled);
 604     else if (equalLettersIgnoringASCIICase(policy, &quot;belowmemorylimit&quot;))
 605         settings().setPdfImageCachingPolicy(PDFImageCachingBelowMemoryLimit);
 606     else if (equalLettersIgnoringASCIICase(policy, &quot;clipboundsonly&quot;))
 607         settings().setPdfImageCachingPolicy(PDFImageCachingClipBoundsOnly);
 608     else if (equalLettersIgnoringASCIICase(policy, &quot;enabled&quot;))
 609         settings().setPdfImageCachingPolicy(PDFImageCachingEnabled);
 610     else
 611         return Exception { SyntaxError };
 612     return { };
 613 }
 614 
 615 ExceptionOr&lt;void&gt; InternalSettings::setMinimumTimerInterval(double intervalInSeconds)
 616 {
 617     if (!m_page)
 618         return Exception { InvalidAccessError };
 619     settings().setMinimumDOMTimerInterval(Seconds { intervalInSeconds });
 620     return { };
 621 }
 622 
 623 ExceptionOr&lt;void&gt; InternalSettings::setDefaultVideoPosterURL(const String&amp; url)
 624 {
 625     if (!m_page)
 626         return Exception { InvalidAccessError };
 627     settings().setDefaultVideoPosterURL(url);
 628     return { };
 629 }
 630 
 631 ExceptionOr&lt;void&gt; InternalSettings::setForcePendingWebGLPolicy(bool forced)
 632 {
 633     if (!m_page)
 634         return Exception { InvalidAccessError };
 635     settings().setForcePendingWebGLPolicy(forced);
 636     return { };
 637 }
 638 
 639 ExceptionOr&lt;void&gt; InternalSettings::setTimeWithoutMouseMovementBeforeHidingControls(double time)
 640 {
 641     if (!m_page)
 642         return Exception { InvalidAccessError };
 643     settings().setTimeWithoutMouseMovementBeforeHidingControls(Seconds { time });
 644     return { };
 645 }
 646 
 647 ExceptionOr&lt;void&gt; InternalSettings::setUseLegacyBackgroundSizeShorthandBehavior(bool enabled)
 648 {
 649     if (!m_page)
 650         return Exception { InvalidAccessError };
 651     settings().setUseLegacyBackgroundSizeShorthandBehavior(enabled);
 652     return { };
 653 }
 654 
 655 ExceptionOr&lt;void&gt; InternalSettings::setAutoscrollForDragAndDropEnabled(bool enabled)
 656 {
 657     if (!m_page)
 658         return Exception { InvalidAccessError };
 659     settings().setAutoscrollForDragAndDropEnabled(enabled);
 660     return { };
 661 }
 662 
 663 ExceptionOr&lt;void&gt; InternalSettings::setFontFallbackPrefersPictographs(bool preferPictographs)
 664 {
 665     if (!m_page)
 666         return Exception { InvalidAccessError };
 667     settings().setFontFallbackPrefersPictographs(preferPictographs);
 668     return { };
 669 }
 670 
 671 ExceptionOr&lt;void&gt; InternalSettings::setFontLoadTimingOverride(const FontLoadTimingOverride&amp; fontLoadTimingOverride)
 672 {
 673     if (!m_page)
 674         return Exception { InvalidAccessError };
 675     auto policy = Settings::FontLoadTimingOverride::None;
 676     switch (fontLoadTimingOverride) {
 677     case FontLoadTimingOverride::Block:
 678         policy = Settings::FontLoadTimingOverride::Block;
 679         break;
 680     case FontLoadTimingOverride::Swap:
 681         policy = Settings::FontLoadTimingOverride::Swap;
 682         break;
 683     case FontLoadTimingOverride::Failure:
 684         policy = Settings::FontLoadTimingOverride::Failure;
 685         break;
 686     }
 687     settings().setFontLoadTimingOverride(policy);
 688     return { };
 689 }
 690 
 691 ExceptionOr&lt;void&gt; InternalSettings::setShouldIgnoreFontLoadCompletions(bool ignore)
 692 {
 693     if (!m_page)
 694         return Exception { InvalidAccessError };
 695     settings().setShouldIgnoreFontLoadCompletions(ignore);
 696     return { };
 697 }
 698 
 699 ExceptionOr&lt;void&gt; InternalSettings::setQuickTimePluginReplacementEnabled(bool enabled)
 700 {
 701     if (!m_page)
 702         return Exception { InvalidAccessError };
 703     settings().setQuickTimePluginReplacementEnabled(enabled);
 704     return { };
 705 }
 706 
 707 ExceptionOr&lt;void&gt; InternalSettings::setYouTubeFlashPluginReplacementEnabled(bool enabled)
 708 {
 709     if (!m_page)
 710         return Exception { InvalidAccessError };
 711     settings().setYouTubeFlashPluginReplacementEnabled(enabled);
 712     return { };
 713 }
 714 
 715 ExceptionOr&lt;void&gt; InternalSettings::setBackgroundShouldExtendBeyondPage(bool hasExtendedBackground)
 716 {
 717     if (!m_page)
 718         return Exception { InvalidAccessError };
 719     settings().setBackgroundShouldExtendBeyondPage(hasExtendedBackground);
 720     return { };
 721 }
 722 
 723 ExceptionOr&lt;void&gt; InternalSettings::setShouldConvertPositionStyleOnCopy(bool convert)
 724 {
 725     if (!m_page)
 726         return Exception { InvalidAccessError };
 727     settings().setShouldConvertPositionStyleOnCopy(convert);
 728     return { };
 729 }
 730 
 731 ExceptionOr&lt;void&gt; InternalSettings::setScrollingTreeIncludesFrames(bool enabled)
 732 {
 733     if (!m_page)
 734         return Exception { InvalidAccessError };
 735     settings().setScrollingTreeIncludesFrames(enabled);
 736     return { };
 737 }
 738 
 739 ExceptionOr&lt;void&gt; InternalSettings::setAllowUnclampedScrollPosition(bool allowUnclamped)
 740 {
 741     if (!m_page || !m_page-&gt;mainFrame().view())
 742         return Exception { InvalidAccessError };
 743 
 744     m_page-&gt;mainFrame().view()-&gt;setAllowsUnclampedScrollPositionForTesting(allowUnclamped);
 745     return { };
 746 }
 747 
 748 ExceptionOr&lt;void&gt; InternalSettings::setAllowsInlineMediaPlayback(bool allows)
 749 {
 750     if (!m_page)
 751         return Exception { InvalidAccessError };
 752     settings().setAllowsInlineMediaPlayback(allows);
 753     return { };
 754 }
 755 
 756 ExceptionOr&lt;void&gt; InternalSettings::setAllowsInlineMediaPlaybackAfterFullscreen(bool allows)
 757 {
 758     if (!m_page)
 759         return Exception { InvalidAccessError };
 760     settings().setAllowsInlineMediaPlaybackAfterFullscreen(allows);
 761     return { };
 762 }
 763 
 764 ExceptionOr&lt;void&gt; InternalSettings::setInlineMediaPlaybackRequiresPlaysInlineAttribute(bool requires)
 765 {
 766     if (!m_page)
 767         return Exception { InvalidAccessError };
 768     settings().setInlineMediaPlaybackRequiresPlaysInlineAttribute(requires);
 769     return { };
 770 }
 771 
 772 ExceptionOr&lt;void&gt; InternalSettings::setShouldMockBoldSystemFontForAccessibility(bool requires)
 773 {
 774     if (!m_page)
 775         return Exception { InvalidAccessError };
 776     RenderTheme::singleton().setShouldMockBoldSystemFontForAccessibility(requires);
 777     FontCache::singleton().setShouldMockBoldSystemFontForAccessibility(requires);
 778     return { };
 779 }
 780 
 781 ExceptionOr&lt;void&gt; InternalSettings::setAnimatedImageDebugCanvasDrawingEnabled(bool ignore)
 782 {
 783     if (!m_page)
 784         return Exception { InvalidAccessError };
 785     settings().setAnimatedImageDebugCanvasDrawingEnabled(ignore);
 786     return { };
 787 }
 788 
 789 void InternalSettings::setIndexedDBWorkersEnabled(bool enabled)
 790 {
 791 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 792     RuntimeEnabledFeatures::sharedFeatures().setIndexedDBWorkersEnabled(enabled);
 793 #else
 794     UNUSED_PARAM(enabled);
 795 #endif
 796 }
 797 
 798 void InternalSettings::setWebGL2Enabled(bool enabled)
 799 {
 800 #if ENABLE(WEBGL2)
 801     RuntimeEnabledFeatures::sharedFeatures().setWebGL2Enabled(enabled);
 802 #else
 803     UNUSED_PARAM(enabled);
 804 #endif
 805 }
 806 
 807 void InternalSettings::setWebGPUEnabled(bool enabled)
 808 {
 809 #if ENABLE(WEBGPU)
 810     RuntimeEnabledFeatures::sharedFeatures().setWebGPUEnabled(enabled);
 811 #else
 812     UNUSED_PARAM(enabled);
 813 #endif
 814 }
 815 
 816 void InternalSettings::setWebVREnabled(bool enabled)
 817 {
 818     RuntimeEnabledFeatures::sharedFeatures().setWebVREnabled(enabled);
 819 }
 820 
 821 void InternalSettings::setScreenCaptureEnabled(bool enabled)
 822 {
 823 #if ENABLE(MEDIA_STREAM)
 824     RuntimeEnabledFeatures::sharedFeatures().setScreenCaptureEnabled(enabled);
 825 #else
 826     UNUSED_PARAM(enabled);
 827 #endif
 828 }
 829 
 830 ExceptionOr&lt;String&gt; InternalSettings::userInterfaceDirectionPolicy()
 831 {
 832     if (!m_page)
 833         return Exception { InvalidAccessError };
 834     switch (settings().userInterfaceDirectionPolicy()) {
 835     case UserInterfaceDirectionPolicy::Content:
 836         return &quot;Content&quot;_str;
 837     case UserInterfaceDirectionPolicy::System:
 838         return &quot;View&quot;_str;
 839     }
 840     ASSERT_NOT_REACHED();
 841     return Exception { InvalidAccessError };
 842 }
 843 
 844 ExceptionOr&lt;void&gt; InternalSettings::setUserInterfaceDirectionPolicy(const String&amp; policy)
 845 {
 846     if (!m_page)
 847         return Exception { InvalidAccessError };
 848     if (equalLettersIgnoringASCIICase(policy, &quot;content&quot;)) {
 849         settings().setUserInterfaceDirectionPolicy(UserInterfaceDirectionPolicy::Content);
 850         return { };
 851     }
 852     if (equalLettersIgnoringASCIICase(policy, &quot;view&quot;)) {
 853         settings().setUserInterfaceDirectionPolicy(UserInterfaceDirectionPolicy::System);
 854         return { };
 855     }
 856     return Exception { InvalidAccessError };
 857 }
 858 
 859 ExceptionOr&lt;String&gt; InternalSettings::systemLayoutDirection()
 860 {
 861     if (!m_page)
 862         return Exception { InvalidAccessError };
 863     switch (settings().systemLayoutDirection()) {
 864     case TextDirection::LTR:
 865         return &quot;LTR&quot;_str;
 866     case TextDirection::RTL:
 867         return &quot;RTL&quot;_str;
 868     }
 869     ASSERT_NOT_REACHED();
 870     return Exception { InvalidAccessError };
 871 }
 872 
 873 ExceptionOr&lt;void&gt; InternalSettings::setSystemLayoutDirection(const String&amp; direction)
 874 {
 875     if (!m_page)
 876         return Exception { InvalidAccessError };
 877     if (equalLettersIgnoringASCIICase(direction, &quot;ltr&quot;)) {
 878         settings().setSystemLayoutDirection(TextDirection::LTR);
 879         return { };
 880     }
 881     if (equalLettersIgnoringASCIICase(direction, &quot;rtl&quot;)) {
 882         settings().setSystemLayoutDirection(TextDirection::RTL);
 883         return { };
 884     }
 885     return Exception { InvalidAccessError };
 886 }
 887 
 888 ExceptionOr&lt;void&gt; InternalSettings::setFrameFlattening(FrameFlatteningValue frameFlattening)
 889 {
 890     if (!m_page)
 891         return Exception { InvalidAccessError };
 892     settings().setFrameFlattening(frameFlattening);
 893     return { };
 894 }
 895 
 896 void InternalSettings::setAllowsAnySSLCertificate(bool allowsAnyCertificate)
 897 {
 898     DeprecatedGlobalSettings::setAllowsAnySSLCertificate(allowsAnyCertificate);
 899 #if USE(SOUP)
 900     SoupNetworkSession::setShouldIgnoreTLSErrors(allowsAnyCertificate);
 901 #endif
 902 }
 903 
 904 ExceptionOr&lt;bool&gt; InternalSettings::deferredCSSParserEnabled()
 905 {
 906     if (!m_page)
 907         return Exception { InvalidAccessError };
 908     return settings().deferredCSSParserEnabled();
 909 }
 910 
 911 ExceptionOr&lt;void&gt; InternalSettings::setDeferredCSSParserEnabled(bool enabled)
 912 {
 913     if (!m_page)
 914         return Exception { InvalidAccessError };
 915     settings().setDeferredCSSParserEnabled(enabled);
 916     return { };
 917 }
 918 
 919 ExceptionOr&lt;void&gt; InternalSettings::setShouldManageAudioSessionCategory(bool should)
 920 {
 921 #if USE(AUDIO_SESSION)
 922     DeprecatedGlobalSettings::setShouldManageAudioSessionCategory(should);
 923     return { };
 924 #else
 925     UNUSED_PARAM(should);
 926     return Exception { InvalidAccessError };
 927 #endif
 928 }
 929 
 930 ExceptionOr&lt;void&gt; InternalSettings::setCustomPasteboardDataEnabled(bool enabled)
 931 {
 932     RuntimeEnabledFeatures::sharedFeatures().setCustomPasteboardDataEnabled(enabled);
 933     return { };
 934 }
 935 
 936 ExceptionOr&lt;void&gt; InternalSettings::setIncompleteImageBorderEnabled(bool enabled)
 937 {
 938     if (!m_page)
 939         return Exception { InvalidAccessError };
 940     settings().setIncompleteImageBorderEnabled(enabled);
 941     return { };
 942 }
 943 
 944 ExceptionOr&lt;void&gt; InternalSettings::setShouldDispatchSyntheticMouseEventsWhenModifyingSelection(bool shouldDispatch)
 945 {
 946     if (!m_page)
 947         return Exception { InvalidAccessError };
 948     settings().setShouldDispatchSyntheticMouseEventsWhenModifyingSelection(shouldDispatch);
 949     return { };
 950 }
 951 
 952 ExceptionOr&lt;void&gt; InternalSettings::setShouldDispatchSyntheticMouseOutAfterSyntheticClick(bool shouldDispatch)
 953 {
 954     if (!m_page)
 955         return Exception { InvalidAccessError };
 956     settings().setShouldDispatchSyntheticMouseOutAfterSyntheticClick(shouldDispatch);
 957     return { };
 958 }
 959 
 960 static InternalSettings::ForcedAccessibilityValue settingsToInternalSettingsValue(Settings::ForcedAccessibilityValue value)
 961 {
 962     switch (value) {
 963     case Settings::ForcedAccessibilityValue::System:
 964         return InternalSettings::ForcedAccessibilityValue::System;
 965     case Settings::ForcedAccessibilityValue::On:
 966         return InternalSettings::ForcedAccessibilityValue::On;
 967     case Settings::ForcedAccessibilityValue::Off:
 968         return InternalSettings::ForcedAccessibilityValue::Off;
 969     }
 970 
 971     ASSERT_NOT_REACHED();
 972     return InternalSettings::ForcedAccessibilityValue::Off;
 973 }
 974 
 975 static Settings::ForcedAccessibilityValue internalSettingsToSettingsValue(InternalSettings::ForcedAccessibilityValue value)
 976 {
 977     switch (value) {
 978     case InternalSettings::ForcedAccessibilityValue::System:
 979         return Settings::ForcedAccessibilityValue::System;
 980     case InternalSettings::ForcedAccessibilityValue::On:
 981         return Settings::ForcedAccessibilityValue::On;
 982     case InternalSettings::ForcedAccessibilityValue::Off:
 983         return Settings::ForcedAccessibilityValue::Off;
 984     }
 985 
 986     ASSERT_NOT_REACHED();
 987     return Settings::ForcedAccessibilityValue::Off;
 988 }
 989 
 990 InternalSettings::ForcedAccessibilityValue InternalSettings::forcedColorsAreInvertedAccessibilityValue() const
 991 {
 992     return settingsToInternalSettingsValue(settings().forcedColorsAreInvertedAccessibilityValue());
 993 }
 994 
 995 void InternalSettings::setForcedColorsAreInvertedAccessibilityValue(InternalSettings::ForcedAccessibilityValue value)
 996 {
 997     settings().setForcedColorsAreInvertedAccessibilityValue(internalSettingsToSettingsValue(value));
 998 }
 999 
1000 InternalSettings::ForcedAccessibilityValue InternalSettings::forcedDisplayIsMonochromeAccessibilityValue() const
1001 {
1002     return settingsToInternalSettingsValue(settings().forcedDisplayIsMonochromeAccessibilityValue());
1003 }
1004 
1005 void InternalSettings::setForcedDisplayIsMonochromeAccessibilityValue(InternalSettings::ForcedAccessibilityValue value)
1006 {
1007     settings().setForcedDisplayIsMonochromeAccessibilityValue(internalSettingsToSettingsValue(value));
1008 }
1009 
1010 InternalSettings::ForcedAccessibilityValue InternalSettings::forcedPrefersReducedMotionAccessibilityValue() const
1011 {
1012     return settingsToInternalSettingsValue(settings().forcedPrefersReducedMotionAccessibilityValue());
1013 }
1014 
1015 void InternalSettings::setForcedPrefersReducedMotionAccessibilityValue(InternalSettings::ForcedAccessibilityValue value)
1016 {
1017     settings().setForcedPrefersReducedMotionAccessibilityValue(internalSettingsToSettingsValue(value));
1018 }
1019 
1020 bool InternalSettings::webAnimationsCSSIntegrationEnabled()
1021 {
1022     return RuntimeEnabledFeatures::sharedFeatures().webAnimationsCSSIntegrationEnabled();
1023 }
1024 
1025 void InternalSettings::setShouldDeactivateAudioSession(bool should)
1026 {
1027     PlatformMediaSessionManager::setShouldDeactivateAudioSession(should);
1028 }
1029 
1030 // If you add to this class, make sure that you update the Backup class for test reproducability!
1031 
1032 }
    </pre>
  </body>
</html>