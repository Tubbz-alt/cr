<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.graphics/src/main/java/javafx/scene/Scene.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../tests/system/src/test/java/test/javafx/scene/Snapshot2Test.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/java/javafx/scene/Scene.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
1283     static WritableImage doSnapshot(Scene scene,
1284             double x, double y, double w, double h,
1285             Node root, BaseTransform transform, boolean depthBuffer,
1286             Paint fill, Camera camera, WritableImage wimg) {
1287 
1288         int xMin = (int)Math.floor(x);
1289         int yMin = (int)Math.floor(y);
1290         int xMax = (int)Math.ceil(x + w);
1291         int yMax = (int)Math.ceil(y + h);
1292         int width = Math.max(xMax - xMin, 1);
1293         int height = Math.max(yMax - yMin, 1);
1294         if (wimg == null) {
1295             wimg = new WritableImage(width, height);
1296         } else {
1297             width = (int)wimg.getWidth();
1298             height = (int)wimg.getHeight();
1299         }
1300 
1301         int maxTextureSize = PrismSettings.maxTextureSize;
1302         if (height &gt; maxTextureSize || width &gt; maxTextureSize) {
<span class="line-modified">1303             // The requested size for the screenshot is to big to fit a single texture,</span>
1304             // so we need to take several snapshot tiles and merge them into single image (fixes JDK-8088198)
<span class="line-modified">1305             int verticalTileNb = (int) Math.ceil(height / (double) maxTextureSize);</span>
<span class="line-modified">1306             int horizontalTileNb = (int) Math.ceil(width / (double) maxTextureSize);</span>
<span class="line-modified">1307             for (int i = 0; i &lt; horizontalTileNb; i++) {</span>
<span class="line-modified">1308                 for (int j = 0; j &lt; verticalTileNb; j++) {</span>
<span class="line-modified">1309                     int xOffset = i * maxTextureSize;</span>

1310                     int yOffset = j * maxTextureSize;
<span class="line-removed">1311                     int tileWidth = Math.min(maxTextureSize, width - xOffset);</span>
1312                     int tileHeight = Math.min(maxTextureSize, height - yOffset);
1313                     WritableImage tile = doSnapshotTile(scene, xMin + xOffset, yMin + yOffset, tileWidth, tileHeight, root, transform, depthBuffer, fill, camera, null);
1314                     wimg.getPixelWriter().setPixels(xOffset, yOffset, tileWidth, tileHeight, tile.getPixelReader(), 0, 0);
1315                 }
1316             }
1317         } else {
1318             // The requested size for the screenshot fits max texture size,
1319             // so we can directly return the one generated tile and avoid the extra pixel copy.
1320             wimg = doSnapshotTile(scene, xMin, yMin, width, height, root, transform, depthBuffer, fill, camera, wimg);
1321         }
1322 
1323         // if this scene belongs to some stage
1324         // we need to mark the entire scene as dirty
1325         // because dirty logic is buggy
1326         if (scene != null &amp;&amp; scene.peer != null) {
1327             scene.setNeedsRepaint();
1328         }
1329 
1330         return wimg;
1331     }
</pre>
</td>
<td>
<hr />
<pre>
1283     static WritableImage doSnapshot(Scene scene,
1284             double x, double y, double w, double h,
1285             Node root, BaseTransform transform, boolean depthBuffer,
1286             Paint fill, Camera camera, WritableImage wimg) {
1287 
1288         int xMin = (int)Math.floor(x);
1289         int yMin = (int)Math.floor(y);
1290         int xMax = (int)Math.ceil(x + w);
1291         int yMax = (int)Math.ceil(y + h);
1292         int width = Math.max(xMax - xMin, 1);
1293         int height = Math.max(yMax - yMin, 1);
1294         if (wimg == null) {
1295             wimg = new WritableImage(width, height);
1296         } else {
1297             width = (int)wimg.getWidth();
1298             height = (int)wimg.getHeight();
1299         }
1300 
1301         int maxTextureSize = PrismSettings.maxTextureSize;
1302         if (height &gt; maxTextureSize || width &gt; maxTextureSize) {
<span class="line-modified">1303             // The requested size for the screenshot is too big to fit a single texture,</span>
1304             // so we need to take several snapshot tiles and merge them into single image (fixes JDK-8088198)
<span class="line-modified">1305             int numVerticalTiles = (int) Math.ceil(height / (double) maxTextureSize);</span>
<span class="line-modified">1306             int numHorizontalTiles = (int) Math.ceil(width / (double) maxTextureSize);</span>
<span class="line-modified">1307             for (int i = 0; i &lt; numHorizontalTiles; i++) {</span>
<span class="line-modified">1308                 int xOffset = i * maxTextureSize;</span>
<span class="line-modified">1309                 int tileWidth = Math.min(maxTextureSize, width - xOffset);</span>
<span class="line-added">1310                 for (int j = 0; j &lt; numVerticalTiles; j++) {</span>
1311                     int yOffset = j * maxTextureSize;

1312                     int tileHeight = Math.min(maxTextureSize, height - yOffset);
1313                     WritableImage tile = doSnapshotTile(scene, xMin + xOffset, yMin + yOffset, tileWidth, tileHeight, root, transform, depthBuffer, fill, camera, null);
1314                     wimg.getPixelWriter().setPixels(xOffset, yOffset, tileWidth, tileHeight, tile.getPixelReader(), 0, 0);
1315                 }
1316             }
1317         } else {
1318             // The requested size for the screenshot fits max texture size,
1319             // so we can directly return the one generated tile and avoid the extra pixel copy.
1320             wimg = doSnapshotTile(scene, xMin, yMin, width, height, root, transform, depthBuffer, fill, camera, wimg);
1321         }
1322 
1323         // if this scene belongs to some stage
1324         // we need to mark the entire scene as dirty
1325         // because dirty logic is buggy
1326         if (scene != null &amp;&amp; scene.peer != null) {
1327             scene.setNeedsRepaint();
1328         }
1329 
1330         return wimg;
1331     }
</pre>
</td>
</tr>
</table>
<center>&lt; prev <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../tests/system/src/test/java/test/javafx/scene/Snapshot2Test.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>