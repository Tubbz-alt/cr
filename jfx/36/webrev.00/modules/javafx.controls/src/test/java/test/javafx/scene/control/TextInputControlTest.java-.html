<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.controls/src/test/java/test/javafx/scene/control/TextInputControlTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control;
  27 
  28 import javafx.beans.InvalidationListener;
  29 import javafx.beans.Observable;
  30 import javafx.beans.property.BooleanProperty;
  31 import javafx.beans.property.SimpleBooleanProperty;
  32 import javafx.beans.property.SimpleStringProperty;
  33 import javafx.beans.property.StringProperty;
  34 import javafx.beans.value.ChangeListener;
  35 import javafx.beans.value.ObservableValue;
  36 import javafx.css.CssMetaData;
  37 import javafx.css.StyleableProperty;
  38 import javafx.event.EventHandler;
  39 import javafx.scene.Scene;
  40 import javafx.scene.input.KeyCode;
  41 import javafx.scene.input.KeyEvent;
  42 import javafx.scene.input.Clipboard;
  43 import javafx.scene.input.ClipboardContent;
  44 import javafx.scene.text.Font;
  45 import javafx.scene.layout.StackPane;
  46 import javafx.stage.Stage;
  47 import java.util.Arrays;
  48 import java.util.Collection;
  49 import javafx.scene.control.IndexRange;
  50 import javafx.scene.control.PasswordField;
  51 import javafx.scene.control.TextArea;
  52 import javafx.scene.control.TextField;
  53 import javafx.scene.control.TextInputControl;
  54 import com.sun.javafx.tk.Toolkit;
  55 import org.junit.Before;
  56 import org.junit.Ignore;
  57 import org.junit.Test;
  58 import org.junit.runner.RunWith;
  59 import org.junit.runners.Parameterized;
  60 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  61 import test.com.sun.javafx.pgstub.StubToolkit;
  62 import static org.junit.Assert.assertEquals;
  63 import static org.junit.Assert.assertFalse;
  64 import static org.junit.Assert.assertNull;
  65 import static org.junit.Assert.assertTrue;
  66 import static org.junit.Assert.fail;
  67 /**
  68  */
  69 @RunWith(Parameterized.class)
  70 public class TextInputControlTest {
  71     @SuppressWarnings(&quot;rawtypes&quot;)
  72     @Parameterized.Parameters public static Collection implementations() {
  73         return Arrays.asList(new Object[][]{
  74                 {TextField.class},
  75                 {PasswordField.class},
  76                 {TextArea.class}
  77         });
  78     }
  79 
  80     private TextInputControl textInput;
  81     private Class type;
  82 
  83     public TextInputControlTest(Class type) {
  84         this.type = type;
  85     }
  86 
  87     @Before public void setup() throws Exception {
  88         textInput = (TextInputControl) type.newInstance();
  89     }
  90 
  91     /******************************************************
  92      * Test the default states                            *
  93      *****************************************************/
  94 
  95     @Test public void textDefaultsToEmptyString() {
  96         assertEquals(&quot;&quot;, textInput.getText());
  97     }
  98 
  99     @Test public void editableDefaultsToTrue() {
 100         assertTrue(textInput.isEditable());
 101     }
 102 
 103     @Test public void anchorDefaultsToZero() {
 104         assertEquals(0, textInput.getAnchor());
 105     }
 106 
 107     @Test public void caretPositionDefaultsToZero() {
 108         assertEquals(0, textInput.getCaretPosition());
 109     }
 110 
 111     @Test public void lengthDefaultsToZero() {
 112         assertEquals(0, textInput.getLength());
 113     }
 114 
 115     @Test public void selectedTextDefaultsToEmptyString() {
 116         assertEquals(&quot;&quot;, textInput.getSelectedText());
 117     }
 118 
 119     @Test public void selectionDefaultsToEmpty() {
 120         assertEquals(0, textInput.getSelection().getLength());
 121     }
 122 
 123     @Test public void selectionStartDefaultsToZero() {
 124         assertEquals(0, textInput.getSelection().getStart());
 125     }
 126 
 127     @Test public void selectionEndDefaultsToZero() {
 128         assertEquals(0, textInput.getSelection().getEnd());
 129     }
 130 
 131     /*********************************************************************
 132      * Tests for CSS                                                     *
 133      ********************************************************************/
 134 
 135     @Test public void fontSetFromCSS() {
 136         textInput.setStyle(&quot;-fx-font: 24 Helvetica&quot;);
 137         Scene s = new Scene(textInput);
 138         textInput.applyCss();
 139         assertEquals(Font.font(&quot;Helvetica&quot;, 24), textInput.getFont());
 140     }
 141 
 142     /******************************************************
 143      * Test for text                                      *
 144      *****************************************************/
 145 
 146     @Test public void settingTextUpdatesTheText() {
 147         textInput.setText(&quot;This is a test&quot;);
 148         assertEquals(&quot;This is a test&quot;, textInput.getText());
 149         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 150     }
 151 
 152     @Test public void textCanBeNull() {
 153         textInput.setText(null);
 154         assertNull(textInput.getText());
 155     }
 156 
 157     @Test public void textCanBeSwitchedBetweenNullAndAValue() {
 158         textInput.setText(null);
 159         textInput.setText(&quot;Test&quot;);
 160         assertEquals(&quot;Test&quot;, textInput.getText());
 161     }
 162 
 163     @Test public void textCanBeSwitchedFromAValueToNull() {
 164         textInput.setText(&quot;Test&quot;);
 165         textInput.setText(null);
 166         assertNull(textInput.getText());
 167     }
 168 
 169     @Test public void textIsNullThenBoundThenUnboundAndShouldReturnTheValueWhenBound() {
 170         textInput.setText(null);
 171         StringProperty other = new SimpleStringProperty(&quot;Peppers&quot;);
 172         textInput.textProperty().bind(other);
 173         textInput.textProperty().unbind();
 174         assertEquals(&quot;Peppers&quot;, textInput.getText());
 175     }
 176 
 177     @Test public void textHasValueThenIsBoundToNullShouldReturnNullFromGet() {
 178         textInput.setText(&quot;Value&quot;);
 179         StringProperty other = new SimpleStringProperty(null);
 180         textInput.textProperty().bind(other);
 181         assertNull(textInput.getText());
 182     }
 183 
 184     @Test public void textHasValueThenIsBoundToNullAndUnboundShouldReturnNullFromGet() {
 185         textInput.setText(&quot;Value&quot;);
 186         StringProperty other = new SimpleStringProperty(null);
 187         textInput.textProperty().bind(other);
 188         textInput.textProperty().unbind();
 189         assertNull(textInput.getText());
 190     }
 191 
 192     @Test public void textHasValueThenIsBoundToNullAndUnboundThenSetShouldReturnNewValueFromGet() {
 193         textInput.setText(&quot;Value&quot;);
 194         StringProperty other = new SimpleStringProperty(null);
 195         textInput.textProperty().bind(other);
 196         textInput.textProperty().unbind();
 197         textInput.setText(&quot;New Value&quot;);
 198         assertEquals(&quot;New Value&quot;, textInput.getText());
 199     }
 200 
 201     @Test public void textCanBeBound() {
 202         StringProperty other = new SimpleStringProperty(&quot;Apples&quot;);
 203         textInput.textProperty().bind(other);
 204         assertEquals(&quot;Apples&quot;, textInput.getText());
 205         other.set(&quot;Oranges&quot;);
 206         assertEquals(&quot;Oranges&quot;, textInput.getText());
 207     }
 208 
 209     @Ignore(&quot;getCssMetaData will return null for textProperty&quot;)
 210     @Test public void impl_cssSettable_ReturnsFalseForTextAlways() {
 211         CssMetaData styleable = ((StyleableProperty)textInput.textProperty()).getCssMetaData();
 212         assertTrue(styleable.isSettable(textInput));
 213         StringProperty other = new SimpleStringProperty(&quot;Apples&quot;);
 214         textInput.textProperty().bind(other);
 215         assertFalse(styleable.isSettable(textInput));
 216     }
 217 
 218     @Test public void cannotSpecifyTextViaCSS() {
 219         try {
 220             CssMetaData styleable = ((StyleableProperty)textInput.textProperty()).getCssMetaData();
 221             assertNull(styleable);
 222         } catch (ClassCastException ignored) {
 223             // pass!
 224         } catch (Exception e) {
 225             org.junit.Assert.fail(e.toString());
 226         }
 227     }
 228 
 229     @Test public void settingTextNotifiesOfChange() {
 230         final boolean[] passed = new boolean[] { false };
 231         textInput.textProperty().addListener((observable, oldValue, newValue) -&gt; {
 232             passed[0] = true;
 233         });
 234         textInput.setText(&quot;Apples&quot;);
 235         assertTrue(passed[0]);
 236     }
 237 
 238     // Test for JDK-8212102
 239     @Test public void testControlCharacters() {
 240         try {
 241             String cc = &quot;\r\n\n&quot;;
 242             String str = &quot;123456&quot;;
 243 
 244             textInput.setText(cc);
 245 
 246             textInput.setText(str);
 247             textInput.replaceText(0, 6, cc);
 248 
 249             textInput.setText(str);
 250             textInput.replaceText(new IndexRange(0, 6), cc);
 251 
 252             textInput.setText(str);
 253             textInput.selectAll();
 254             textInput.replaceSelection(cc);
 255 
 256             textInput.setText(str);
 257             textInput.selectRange(0, 6);
 258             textInput.replaceSelection(cc);
 259 
 260         } catch (Exception e) {
 261             fail(&quot;Control characters(\\r\\n) caused Exception: &quot; + e);
 262         }
 263     }
 264 
 265     @Test public void controlCharactersAreOmitted_setText_getText() {
 266         String s = &quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;;
 267         textInput.setText(s);
 268         assertEquals(&quot;This is a test&quot;, textInput.getText());
 269     }
 270 
 271     @Test public void controlCharactersAreOmitted_setText_textProperty_get() {
 272         String s = &quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;;
 273         textInput.setText(s);
 274         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 275     }
 276 
 277     @Test public void controlCharactersAreOmitted_bound_getText() {
 278         StringProperty other = new SimpleStringProperty(&quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;);
 279         textInput.textProperty().bind(other);
 280         assertEquals(&quot;This is a test&quot;, textInput.getText());
 281         other.set(&quot;Bro&quot; + &#39;\5&#39; + &quot;ken&quot;);
 282         assertEquals(&quot;Broken&quot;, textInput.getText());
 283     }
 284 
 285     @Test public void controlCharactersAreOmitted_bound_textProperty_get() {
 286         StringProperty other = new SimpleStringProperty(&quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;);
 287         textInput.textProperty().bind(other);
 288         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 289         other.set(&quot;Bro&quot; + &#39;\5&#39; + &quot;ken&quot;);
 290         assertEquals(&quot;Broken&quot;, textInput.textProperty().get());
 291     }
 292 
 293     // selection is changed when text is changed??
 294     // anchor and caret position updated when selection is changed due to text change??
 295     // selected text is updated when selection changes due to a text change??
 296     // length is updated when text changes
 297 
 298     /******************************************************
 299      * Test for editable                                  *
 300      *****************************************************/
 301 
 302     @Test public void settingEditableValueShouldWork() {
 303         textInput.setEditable(false);
 304         assertFalse(textInput.isEditable());
 305     }
 306 
 307     @Test public void settingEditableAndThenCreatingAModelAndReadingTheValueStillWorks() {
 308         textInput.setEditable(false);
 309         assertFalse(textInput.editableProperty().get());
 310     }
 311 
 312     @Test public void editableCanBeBound() {
 313         BooleanProperty other = new SimpleBooleanProperty(false);
 314         textInput.editableProperty().bind(other);
 315         assertFalse(textInput.isEditable());
 316         other.set(true);
 317         assertTrue(textInput.isEditable());
 318     }
 319 
 320     @Ignore(&quot;getCssMetaData will return null for editableProperty&quot;)
 321     @Test public void impl_cssSettable_ReturnsFalseForEditableAlways() {
 322         CssMetaData styleable = ((StyleableProperty)textInput.editableProperty()).getCssMetaData();
 323         assertTrue(styleable.isSettable(textInput));
 324         StringProperty other = new SimpleStringProperty(&quot;Apples&quot;);
 325         textInput.textProperty().bind(other);
 326         assertFalse(styleable.isSettable(textInput));
 327     }
 328 
 329     @Test public void cannotSpecifyEditableViaCSS() {
 330         try {
 331             CssMetaData styleable = ((StyleableProperty)textInput.editableProperty()).getCssMetaData();
 332             assertNull(styleable);
 333         } catch (ClassCastException ignored) {
 334             // pass!
 335         } catch (Exception e) {
 336             org.junit.Assert.fail(e.toString());
 337         }
 338     }
 339 
 340     @Test public void settingEditableNotifiesOfChange() {
 341         final boolean[] passed = new boolean[] { false };
 342         textInput.editableProperty().addListener((observable, oldValue, newValue) -&gt; {
 343             passed[0] = true;
 344         });
 345         textInput.setEditable(false);
 346         assertTrue(passed[0]);
 347     }
 348 
 349     /******************************************************
 350      * Test for anchor                                    *
 351      *****************************************************/
 352 
 353     @Test public void anchorIsSetWhenSelectionChanges() {
 354         textInput.setText(&quot;The quick brown fox&quot;);
 355         textInput.selectRange(4, 9);
 356         assertEquals(4, textInput.getAnchor());
 357     }
 358 
 359     @Test public void anchorIsSetWhenSelectionChanges2() {
 360         textInput.setText(&quot;The quick brown fox&quot;);
 361         textInput.selectRange(9, 4);
 362         assertEquals(9, textInput.getAnchor());
 363     }
 364 
 365     // updated when text changes
 366     @Test public void anchorIsSetToCaretPositionWhenTextChanges() {
 367         textInput.setText(&quot;The quick brown fox&quot;);
 368         textInput.selectRange(4, 9);
 369         textInput.setText(&quot;Gone&quot;);
 370         assertEquals(textInput.getCaretPosition(), textInput.getAnchor());
 371     }
 372 
 373     /******************************************************
 374      * Test for caretPosition                             *
 375      *****************************************************/
 376 
 377     @Test public void caretPositionIsSetWhenSelectionChanges() {
 378         textInput.setText(&quot;The quick brown fox&quot;);
 379         textInput.selectRange(4, 9);
 380         assertEquals(9, textInput.getCaretPosition());
 381     }
 382 
 383     @Test public void caretPositionIsSetWhenSelectionChanges2() {
 384         textInput.setText(&quot;The quick brown fox&quot;);
 385         textInput.selectRange(9, 4);
 386         assertEquals(4, textInput.getCaretPosition());
 387     }
 388 
 389     @Test
 390     public void caretAndAnchorPositionAfterSettingText() {
 391         textInput.setText(&quot;The quick brown fox&quot;);
 392         assertEquals(0, textInput.getCaretPosition());
 393         assertEquals(0, textInput.getAnchor());
 394     }
 395 
 396     // Test for JDK-8178417
 397     @Test public void caretPositionUndo() {
 398         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
 399         StackPane root = new StackPane();
 400         Scene scene = new Scene(root);
 401         Stage stage = new Stage();
 402         String text = &quot;01234&quot;;
 403 
 404         textInput.setText(text);
 405         stage.setScene(scene);
 406         root.getChildren().removeAll();
 407         root.getChildren().add(textInput);
 408         stage.show();
 409         tk.firePulse();
 410 
 411         KeyEventFirer keyboard = new KeyEventFirer(textInput);
 412         keyboard.doKeyPress(KeyCode.HOME);
 413 
 414         for(int i = 1; i &lt; text.length() + 1; ++i) {
 415             keyboard.doKeyPress(KeyCode.RIGHT);
 416             tk.firePulse();
 417         }
 418         for(int i = 1; i &lt; text.length() + 1; ++i) {
 419             textInput.undo();
 420         }
 421         assertEquals(text.length(), textInput.getCaretPosition());
 422         root.getChildren().removeAll();
 423         stage.hide();
 424         tk.firePulse();
 425     }
 426 
 427     /******************************************************
 428      * Test for length                                    *
 429      *****************************************************/
 430 
 431     // TODO null text results in 0 length
 432 
 433     @Test public void emptyTextResultsInZeroLength() {
 434         textInput.setText(&quot;Hello&quot;);
 435         textInput.setText(&quot;&quot;);
 436         assertEquals(0, textInput.getLength());
 437     }
 438 
 439     @Test public void lengthMatchesStringLength() {
 440         final String string = &quot;Hello&quot;;
 441         textInput.setText(string);
 442         assertEquals(string.length(), textInput.getLength());
 443     }
 444 
 445     @Test public void lengthChangeNotificationWhenTextIsUpdatedToNonEmptyResult() {
 446         final boolean[] passed = new boolean[] { false };
 447         textInput.lengthProperty().addListener((observable, oldValue, newValue) -&gt; {
 448             passed[0] = true;
 449         });
 450         textInput.setText(&quot;Hello&quot;);
 451         assertTrue(passed[0]);
 452     }
 453 
 454     @Ignore(&quot;The notification here doesn&#39;t happen because the invalid flag is set after the first set,&quot; +
 455             &quot;however setting a change listener *must* clear that, but doesn&#39;t. I copied the code for this &quot; +
 456             &quot;straight from the beans package, so there may be a bug there.&quot;)
 457     @Test public void lengthChangeNotificationWhenTextIsSetToEmptyResult() {
 458         textInput.setText(&quot;Goodbye&quot;);
 459         final boolean[] passed = new boolean[] { false };
 460         textInput.lengthProperty().addListener((observable, oldValue, newValue) -&gt; {
 461             passed[0] = true;
 462         });
 463         textInput.setText(&quot;&quot;);
 464         assertTrue(passed[0]);
 465     }
 466 
 467     /******************************************************
 468      * Test for maximumLength                             *
 469      *****************************************************/
 470 
 471     // set maximum length to less than current length
 472 
 473     /******************************************************
 474      * Test for selected text                             *
 475      *****************************************************/
 476 
 477     // TODO test null text and some random range
 478 
 479     @Test public void selectedTextMatchesTextAndSelection() {
 480         textInput.setText(&quot;The quick brown fox&quot;);
 481         textInput.selectRange(0, 3);
 482         assertEquals(&quot;The&quot;, textInput.getSelectedText());
 483     }
 484 
 485     @Test public void selectedTextMatchesTextAndSelection2() {
 486         textInput.setText(&quot;The quick brown fox&quot;);
 487         textInput.selectRange(4, 9);
 488         assertEquals(&quot;quick&quot;, textInput.getSelectedText());
 489     }
 490 
 491     @Test public void selectedTextMatchesTextAndSelection3() {
 492         textInput.setText(&quot;The quick brown fox&quot;);
 493         textInput.selectRange(10, 19);
 494         assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 495     }
 496 
 497     @Test public void selectedTextIsClearedWhenTextChanges() {
 498         textInput.setText(&quot;The quick brown fox&quot;);
 499         textInput.selectRange(4, 9);
 500         textInput.setText(&quot;&quot;);
 501         assertEquals(&quot;&quot;, textInput.getSelectedText());
 502     }
 503 
 504     @Test public void selectedTextWorksWhenSelectionExceedsPossibleRange() {
 505         textInput.setText(&quot;The quick brown fox&quot;);
 506         textInput.selectRange(10, 180);
 507         assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 508     }
 509 
 510     @Test public void selectedTextWorksWhenSelectionExceedsPossibleRange2() {
 511         textInput.setText(&quot;The quick brown fox&quot;);
 512         textInput.selectRange(100, 180);
 513         assertEquals(&quot;&quot;, textInput.getSelectedText());
 514     }
 515 
 516 //    @Test public void selectedTextWorksWhenSelectionIsBound() {
 517 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(4, 9));
 518 //        textInput.setText(&quot;The quick brown fox&quot;);
 519 //        textInput.selectionProperty().bind(other);
 520 //        assertEquals(&quot;quick&quot;, textInput.getSelectedText());
 521 //        other.set(new IndexRange(10, 19));
 522 //        assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 523 //    }
 524 
 525     @Test public void selectedTextWorksWhenTextIsBound() {
 526         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 527         textInput.textProperty().bind(other);
 528         textInput.selectRange(0, 5);
 529         assertEquals(&quot;There&quot;, textInput.getSelectedText());
 530         other.set(&quot;Cleared!&quot;);
 531         assertEquals(&quot;&quot;, textInput.getSelectedText());
 532     }
 533 
 534     @Test public void selectedTextChangeEvents() {
 535         final boolean[] passed = new boolean[] { false };
 536         textInput.setText(&quot;The quick brown fox&quot;);
 537         textInput.selectedTextProperty().addListener(observable -&gt; {
 538             passed[0] = true;
 539         });
 540         textInput.selectRange(0, 3);
 541         assertTrue(passed[0]);
 542     }
 543 
 544     @Test public void selectedTextChangeEvents2() {
 545         final boolean[] passed = new boolean[] { false };
 546         textInput.setText(&quot;The quick brown fox&quot;);
 547         textInput.selectRange(0, 3);
 548         textInput.selectedTextProperty().addListener(observable -&gt; {
 549             passed[0] = true;
 550         });
 551         textInput.selectRange(10, 180);
 552         assertTrue(passed[0]);
 553     }
 554 
 555     @Test public void selectedTextChangeEvents3() {
 556         final boolean[] passed = new boolean[] { false };
 557         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 558         textInput.textProperty().bind(other);
 559         textInput.selectRange(0, 5);
 560         textInput.selectedTextProperty().addListener(observable -&gt; {
 561             passed[0] = true;
 562         });
 563         other.set(&quot;Cleared!&quot;);
 564         assertTrue(passed[0]);
 565     }
 566 
 567     /******************************************************
 568      * Test for selection                                 *
 569      *****************************************************/
 570 
 571     @Test public void selectionIsClearedWhenTextChanges() {
 572         textInput.setText(&quot;The quick brown fox&quot;);
 573         textInput.selectRange(4, 9);
 574         textInput.setText(&quot;&quot;);
 575         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 576     }
 577 
 578     @Test public void selectionCannotBeSetToBeOutOfRange() {
 579         textInput.setText(&quot;The quick brown fox&quot;);
 580         textInput.selectRange(4, 99);
 581         assertEquals(new IndexRange(4, 19), textInput.getSelection());
 582     }
 583 
 584     @Test public void selectionCannotBeSetToBeOutOfRange2() {
 585         textInput.setText(&quot;The quick brown fox&quot;);
 586         textInput.selectRange(44, 99);
 587         assertEquals(new IndexRange(19, 19), textInput.getSelection());
 588     }
 589 
 590 //    @Test public void selectionCanBeBound() {
 591 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(4, 9));
 592 //        textInput.selectionProperty().bind(other);
 593 //        assertEquals(new IndexRange(4, 9), textInput.getSelection());
 594 //        other.set(new IndexRange(10, 19));
 595 //        assertEquals(new IndexRange(10, 19), textInput.getSelection());
 596 //    }
 597 
 598     @Test public void selectionChangeEventsHappen() {
 599         final boolean[] passed = new boolean[] { false };
 600         textInput.selectionProperty().addListener(observable -&gt; {
 601             passed[0] = true;
 602         });
 603         textInput.selectRange(0, 3);
 604         assertTrue(passed[0]);
 605     }
 606 
 607 //    @Test public void selectionChangeEventsHappenWhenBound() {
 608 //        final boolean[] passed = new boolean[] { false };
 609 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(0, 5));
 610 //        textInput.selectionProperty().addListener(new InvalidationListener() {
 611 //            @Override public void invalidated(Observable observable) {
 612 //                passed[0] = true;
 613 //            }
 614 //        });
 615 //        textInput.selectionProperty().bind(other);
 616 //        assertTrue(passed[0]);
 617 //    }
 618 
 619 //    @Test public void selectionChangeEventsHappenWhenBound2() {
 620 //        final boolean[] passed = new boolean[] { false };
 621 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(0, 5));
 622 //        textInput.selectionProperty().bind(other);
 623 //        textInput.selectionProperty().addListener(new InvalidationListener() {
 624 //            @Override public void invalidated(Observable observable) {
 625 //                passed[0] = true;
 626 //            }
 627 //        });
 628 //        assertFalse(passed[0]);
 629 //        other.set(new IndexRange(1, 2));
 630 //        assertTrue(passed[0]);
 631 //    }
 632 
 633     @Test public void selectionChangeEventsHappenWhenTextIsChanged() {
 634         final boolean[] passed = new boolean[] { false };
 635         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 636         textInput.textProperty().bind(other);
 637         textInput.selectRange(0, 5);
 638         textInput.selectionProperty().addListener(observable -&gt; {
 639             passed[0] = true;
 640         });
 641         other.set(&quot;Cleared!&quot;);
 642         assertTrue(passed[0]);
 643     }
 644 
 645     @Ignore
 646     @Test public void selectionCanBeNull() {
 647 
 648     }
 649 
 650     /******************************************************
 651      * Test for cut/copy/paste                            *
 652      *****************************************************/
 653 
 654     @Test public void cutRemovesSelection() {
 655         // Skip for PasswordField
 656         if (textInput instanceof PasswordField) return;
 657         textInput.setText(&quot;The quick brown fox&quot;);
 658         textInput.selectRange(4, 9);
 659         textInput.cut();
 660         assertEquals(&quot;The  brown fox&quot;, textInput.getText());
 661     }
 662 
 663     @Test public void pasteReplacesSelection() {
 664         textInput.setText(&quot;The quick brown fox&quot;);
 665         textInput.selectRange(4, 9);
 666         copy(&quot;slow&quot;);
 667         textInput.paste();
 668         assertEquals(&quot;The slow brown fox&quot;, textInput.getText());
 669     }
 670 
 671     @Test public void pasteIllegalCharacters() {
 672         textInput.setText(&quot;The quick brown fox&quot;);
 673         textInput.selectRange(19, 19);
 674         copy(&quot;&quot; + &#39;\0&#39;);
 675         textInput.paste();
 676         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
 677     }
 678 
 679     @Test public void pasteIllegalCharactersCaretNotAtZero() {
 680         textInput.setText(&quot;The quick brown fox&quot;);
 681         textInput.selectRange(4, 4);
 682         copy(&quot;slow&quot; + &#39;\0&#39;);
 683         textInput.paste();
 684         assertEquals(8, textInput.getCaretPosition());
 685         assertEquals(8, textInput.getAnchor());
 686     }
 687 
 688     @Test public void pasteIllegalCharactersSelection() {
 689         textInput.setText(&quot;The quick brown fox&quot;);
 690         textInput.selectRange(4, 9);
 691         copy(&quot;slow&quot; + &#39;\0&#39;);
 692         textInput.paste();
 693         assertEquals(&quot;The slow brown fox&quot;, textInput.getText());
 694     }
 695 
 696     @Test public void pasteIllegalCharactersIntoSelectionPositionsCaretCorrectly() {
 697         textInput.setText(&quot;The quick brown fox&quot;);
 698         textInput.selectRange(4, 9);
 699         copy(&quot;slow&quot; + &#39;\0&#39;);
 700         textInput.paste();
 701         assertEquals(8, textInput.getCaretPosition());
 702         assertEquals(8, textInput.getAnchor());
 703     }
 704 
 705     /******************************************************
 706      * Test for manipulating selection via methods        *
 707      *****************************************************/
 708 
 709     // cut ends up removing the selection, and setting anchor / caretPosition to match index
 710     @Test public void cutRemovesSelectionAndResetsAnchorAndCaretPositionToIndex() {
 711         // Skip for PasswordField
 712         if (textInput instanceof PasswordField) return;
 713         textInput.setText(&quot;The quick brown fox&quot;);
 714         textInput.selectRange(4, 9);
 715         textInput.cut();
 716         assertEquals(4, textInput.getAnchor());
 717         assertEquals(4, textInput.getCaretPosition());
 718         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 719         assertEquals(&quot;&quot;, textInput.getSelectedText());
 720     }
 721 
 722     @Test public void pasteWithEmptySelection() {
 723         textInput.setText(&quot;quick brown fox&quot;);
 724         textInput.selectRange(0,0);
 725         copy(&quot;The &quot;);
 726         textInput.paste();
 727         assertEquals(4, textInput.getAnchor());
 728         assertEquals(4, textInput.getCaretPosition());
 729         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 730         assertEquals(&quot;&quot;, textInput.getSelectedText());
 731     }
 732 
 733     @Test public void pasteWithSelection() {
 734         textInput.setText(&quot;The quick brown fox&quot;);
 735         textInput.selectRange(4, 9);
 736         copy(&quot;slow&quot;);
 737         textInput.paste();
 738         assertEquals(8, textInput.getAnchor());
 739         assertEquals(8, textInput.getCaretPosition());
 740         assertEquals(new IndexRange(8, 8), textInput.getSelection());
 741         assertEquals(&quot;&quot;, textInput.getSelectedText());
 742     }
 743 
 744     @Test public void pasteAll() {
 745         textInput.setText(&quot;The quick brown fox&quot;);
 746         textInput.selectAll();
 747         copy(&quot;Gone&quot;);
 748         textInput.paste();
 749         assertEquals(4, textInput.getAnchor());
 750         assertEquals(4, textInput.getCaretPosition());
 751         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 752         assertEquals(&quot;&quot;, textInput.getSelectedText());
 753     }
 754 
 755     @Test public void selectBackwardHasNoEffectWhenCaretPositionIsAlreadyZero() {
 756         textInput.setText(&quot;The quick brown fox&quot;);
 757         textInput.selectRange(3, 0);
 758         textInput.selectBackward();
 759         assertEquals(0, textInput.getCaretPosition());
 760         assertEquals(new IndexRange(0, 3), textInput.getSelection());
 761     }
 762 
 763     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionRightOfAnchor() {
 764         textInput.setText(&quot;The quick brown fox&quot;);
 765         textInput.selectRange(0, 3);
 766         textInput.selectBackward();
 767         assertEquals(2, textInput.getCaretPosition());
 768         assertEquals(new IndexRange(0, 2), textInput.getSelection());
 769     }
 770 
 771     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionEqualsAnchor() {
 772         textInput.setText(&quot;The quick brown fox&quot;);
 773         textInput.selectRange(3, 3);
 774         textInput.selectBackward();
 775         assertEquals(2, textInput.getCaretPosition());
 776         assertEquals(new IndexRange(2, 3), textInput.getSelection());
 777     }
 778 
 779     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionLeftOfAnchor() {
 780         textInput.setText(&quot;The quick brown fox&quot;);
 781         textInput.selectRange(6, 3);
 782         textInput.selectBackward();
 783         assertEquals(2, textInput.getCaretPosition());
 784         assertEquals(new IndexRange(2, 6), textInput.getSelection());
 785     }
 786 
 787     @Test public void selectForwardHasNoEffectWhenCaretPositionIsAtLength() {
 788         textInput.setText(&quot;The quick brown fox&quot;);
 789         textInput.selectRange(3, 19);
 790         textInput.selectForward();
 791         assertEquals(19, textInput.getCaretPosition());
 792         assertEquals(new IndexRange(3, 19), textInput.getSelection());
 793     }
 794 
 795     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionRightOfAnchor() {
 796         textInput.setText(&quot;The quick brown fox&quot;);
 797         textInput.selectRange(0, 3);
 798         textInput.selectForward();
 799         assertEquals(4, textInput.getCaretPosition());
 800         assertEquals(new IndexRange(0, 4), textInput.getSelection());
 801     }
 802 
 803     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionEqualsAnchor() {
 804         textInput.setText(&quot;The quick brown fox&quot;);
 805         textInput.selectRange(3, 3);
 806         textInput.selectForward();
 807         assertEquals(4, textInput.getCaretPosition());
 808         assertEquals(new IndexRange(3, 4), textInput.getSelection());
 809     }
 810 
 811     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionLeftOfAnchor() {
 812         textInput.setText(&quot;The quick brown fox&quot;);
 813         textInput.selectRange(6, 3);
 814         textInput.selectForward();
 815         assertEquals(4, textInput.getCaretPosition());
 816         assertEquals(new IndexRange(4, 6), textInput.getSelection());
 817     }
 818 
 819     @Test public void previousWordWithNoText() {
 820         textInput.previousWord();
 821         assertEquals(0, textInput.getCaretPosition());
 822         assertEquals(0, textInput.getAnchor());
 823         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 824     }
 825 
 826     @Test public void previousWordWithSelection_caretPositionBeforeAnchor() {
 827         textInput.setText(&quot;The quick brown fox&quot;);
 828         textInput.selectRange(15, 10);
 829         textInput.previousWord();
 830         assertEquals(4, textInput.getCaretPosition());
 831         assertEquals(4, textInput.getAnchor());
 832         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 833     }
 834 
 835     @Test public void previousWordWithSelection_caretPositionBeforeAnchor2() {
 836         textInput.setText(&quot;The quick brown fox&quot;);
 837         textInput.selectRange(12, 6);
 838         textInput.previousWord();
 839         assertEquals(4, textInput.getCaretPosition());
 840         assertEquals(4, textInput.getAnchor());
 841         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 842     }
 843 
 844     @Test public void previousWordWithSelection_caretPositionAfterAnchor() {
 845         textInput.setText(&quot;The quick brown fox&quot;);
 846         textInput.selectRange(10, 15);
 847         textInput.previousWord();
 848         assertEquals(10, textInput.getCaretPosition());
 849         assertEquals(10, textInput.getAnchor());
 850         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 851     }
 852 
 853     @Test public void previousWordWithSelection_caretPositionAfterAnchor2() {
 854         textInput.setText(&quot;The quick brown fox&quot;);
 855         textInput.selectRange(6, 12);
 856         textInput.previousWord();
 857         assertEquals(10, textInput.getCaretPosition());
 858         assertEquals(10, textInput.getAnchor());
 859         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 860     }
 861 
 862     @Test public void previousWord_caretWithinAWord() {
 863         textInput.setText(&quot;The quick brown fox&quot;);
 864         textInput.positionCaret(12);
 865         textInput.previousWord();
 866         assertEquals(10, textInput.getCaretPosition());
 867         assertEquals(10, textInput.getAnchor());
 868         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 869     }
 870 
 871     @Test public void previousWord_caretAfterWord() {
 872         textInput.setText(&quot;The quick brown fox&quot;);
 873         textInput.positionCaret(15);
 874         textInput.previousWord();
 875         assertEquals(10, textInput.getCaretPosition());
 876         assertEquals(10, textInput.getAnchor());
 877         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 878     }
 879 
 880     @Test public void previousWord_caretBeforeWord() {
 881         textInput.setText(&quot;The quick brown fox&quot;);
 882         textInput.positionCaret(10);
 883         textInput.previousWord();
 884         assertEquals(4, textInput.getCaretPosition());
 885         assertEquals(4, textInput.getAnchor());
 886         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 887     }
 888 
 889     @Test public void previousWord_caretWithinWhitespace() {
 890         textInput.setText(&quot;The quick  brown fox&quot;);
 891         textInput.positionCaret(10);
 892         textInput.previousWord();
 893         assertEquals(4, textInput.getCaretPosition());
 894         assertEquals(4, textInput.getAnchor());
 895         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 896     }
 897 
 898     @Test public void previousWord_multipleWhitespaceInARow() {
 899         textInput.setText(&quot;The quick  brown fox&quot;);
 900         textInput.positionCaret(11);
 901         textInput.previousWord();
 902         assertEquals(4, textInput.getCaretPosition());
 903         assertEquals(4, textInput.getAnchor());
 904         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 905     }
 906 
 907     @Test public void previousWord_withANumber() {
 908         textInput.setText(&quot;There are 5 cards in the hand&quot;);
 909         textInput.positionCaret(12);
 910         textInput.previousWord();
 911         assertEquals(10, textInput.getCaretPosition());
 912         assertEquals(10, textInput.getAnchor());
 913         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 914     }
 915 
 916     @Test public void previousWord_withALongNumber() {
 917         textInput.setText(&quot;There are 52 cards in the deck&quot;);
 918         textInput.positionCaret(13);
 919         textInput.previousWord();
 920         assertEquals(10, textInput.getCaretPosition());
 921         assertEquals(10, textInput.getAnchor());
 922         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 923     }
 924 
 925     @Test public void nextWordWithNoText() {
 926         textInput.nextWord();
 927         assertEquals(0, textInput.getCaretPosition());
 928         assertEquals(0, textInput.getAnchor());
 929         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 930     }
 931 
 932     @Test public void nextWordWithSelection_caretPositionBeforeAnchor() {
 933         textInput.setText(&quot;The quick brown fox&quot;);
 934         textInput.selectRange(9, 4);
 935         textInput.nextWord();
 936         assertEquals(10, textInput.getCaretPosition());
 937         assertEquals(10, textInput.getAnchor());
 938         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 939     }
 940 
 941     @Test public void nextWordWithSelection_caretPositionBeforeAnchor2() {
 942         textInput.setText(&quot;The quick brown fox&quot;);
 943         textInput.selectRange(9, 2);
 944         textInput.nextWord();
 945         assertEquals(4, textInput.getCaretPosition());
 946         assertEquals(4, textInput.getAnchor());
 947         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 948     }
 949 
 950     @Test public void nextWordWithSelection_caretPositionAfterAnchor() {
 951         textInput.setText(&quot;The quick brown fox&quot;);
 952         textInput.selectRange(4, 9);
 953         textInput.nextWord();
 954         assertEquals(10, textInput.getCaretPosition());
 955         assertEquals(10, textInput.getAnchor());
 956         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 957     }
 958 
 959     @Test public void nextWordWithSelection_caretPositionAfterAnchor2() {
 960         textInput.setText(&quot;The quick brown fox&quot;);
 961         textInput.selectRange(5, 11);
 962         textInput.nextWord();
 963         assertEquals(16, textInput.getCaretPosition());
 964         assertEquals(16, textInput.getAnchor());
 965         assertEquals(new IndexRange(16, 16), textInput.getSelection());
 966     }
 967 
 968     @Test public void nextWord_caretWithinAWord() {
 969         textInput.setText(&quot;The quick brown fox&quot;);
 970         textInput.positionCaret(6);
 971         textInput.nextWord();
 972         assertEquals(10, textInput.getCaretPosition());
 973         assertEquals(10, textInput.getAnchor());
 974         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 975     }
 976 
 977     @Test public void nextWord_caretAfterWord() {
 978         textInput.setText(&quot;The quick brown fox&quot;);
 979         textInput.positionCaret(9);
 980         textInput.nextWord();
 981         assertEquals(10, textInput.getCaretPosition());
 982         assertEquals(10, textInput.getAnchor());
 983         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 984     }
 985 
 986     @Test public void nextWord_caretBeforeWord() {
 987         textInput.setText(&quot;The quick brown fox&quot;);
 988         textInput.positionCaret(4);
 989         textInput.nextWord();
 990         assertEquals(10, textInput.getCaretPosition());
 991         assertEquals(10, textInput.getAnchor());
 992         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 993     }
 994 
 995     @Test public void nextWord_caretWithinWhitespace() {
 996         textInput.setText(&quot;The quick  brown fox&quot;);
 997         textInput.positionCaret(10);
 998         textInput.nextWord();
 999         assertEquals(11, textInput.getCaretPosition());
1000         assertEquals(11, textInput.getAnchor());
1001         assertEquals(new IndexRange(11, 11), textInput.getSelection());
1002     }
1003 
1004     @Test public void nextWord_multipleWhitespaceInARow() {
1005         textInput.setText(&quot;The quick  brown fox&quot;);
1006         textInput.positionCaret(9);
1007         textInput.nextWord();
1008         assertEquals(11, textInput.getCaretPosition());
1009         assertEquals(11, textInput.getAnchor());
1010         assertEquals(new IndexRange(11, 11), textInput.getSelection());
1011     }
1012 
1013     @Test public void nextWord_toTheEnd() {
1014         textInput.setText(&quot;The quick brown fox&quot;);
1015         textInput.positionCaret(16);
1016         textInput.nextWord();
1017         assertEquals(19, textInput.getCaretPosition());
1018         assertEquals(19, textInput.getAnchor());
1019         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1020     }
1021 
1022     @Test public void nextWord_withANumber() {
1023         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1024         textInput.positionCaret(6);
1025         textInput.nextWord();
1026         assertEquals(10, textInput.getCaretPosition());
1027         assertEquals(10, textInput.getAnchor());
1028         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1029     }
1030 
1031     @Test public void nextWord_withALongNumber() {
1032         textInput.setText(&quot;There are 52 cards in the deck&quot;);
1033         textInput.positionCaret(10);
1034         textInput.nextWord();
1035         assertEquals(13, textInput.getCaretPosition());
1036         assertEquals(13, textInput.getAnchor());
1037         assertEquals(new IndexRange(13, 13), textInput.getSelection());
1038     }
1039 
1040     @Test public void endOfNextWordWithNoText() {
1041         textInput.endOfNextWord();
1042         assertEquals(0, textInput.getCaretPosition());
1043         assertEquals(0, textInput.getAnchor());
1044         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1045     }
1046 
1047     @Test public void endOfNextWordWithSelection_caretPositionBeforeAnchor() {
1048         textInput.setText(&quot;The quick brown fox&quot;);
1049         textInput.selectRange(9, 4);
1050         textInput.endOfNextWord();
1051         assertEquals(9, textInput.getCaretPosition());
1052         assertEquals(9, textInput.getAnchor());
1053         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1054     }
1055 
1056     @Test public void endOfNextWordWithSelection_caretPositionBeforeAnchor2() {
1057         textInput.setText(&quot;The quick brown fox&quot;);
1058         textInput.selectRange(9, 2);
1059         textInput.endOfNextWord();
1060         assertEquals(3, textInput.getCaretPosition());
1061         assertEquals(3, textInput.getAnchor());
1062         assertEquals(new IndexRange(3, 3), textInput.getSelection());
1063     }
1064 
1065     @Test public void endOfNextWordWithSelection_caretPositionAfterAnchor() {
1066         textInput.setText(&quot;The quick brown fox&quot;);
1067         textInput.selectRange(4, 9);
1068         textInput.endOfNextWord();
1069         assertEquals(15, textInput.getCaretPosition());
1070         assertEquals(15, textInput.getAnchor());
1071         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1072     }
1073 
1074     @Test public void endOfNextWordWithSelection_caretPositionAfterAnchor2() {
1075         textInput.setText(&quot;The quick brown fox&quot;);
1076         textInput.selectRange(5, 11);
1077         textInput.endOfNextWord();
1078         assertEquals(15, textInput.getCaretPosition());
1079         assertEquals(15, textInput.getAnchor());
1080         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1081     }
1082 
1083     @Test public void endOfNextWord_caretWithinAWord() {
1084         textInput.setText(&quot;The quick brown fox&quot;);
1085         textInput.positionCaret(6);
1086         textInput.endOfNextWord();
1087         assertEquals(9, textInput.getCaretPosition());
1088         assertEquals(9, textInput.getAnchor());
1089         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1090     }
1091 
1092     @Test public void endOfNextWord_caretAfterWord() {
1093         textInput.setText(&quot;The quick brown fox&quot;);
1094         textInput.positionCaret(9);
1095         textInput.endOfNextWord();
1096         assertEquals(15, textInput.getCaretPosition());
1097         assertEquals(15, textInput.getAnchor());
1098         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1099     }
1100 
1101     @Test public void endOfNextWord_caretBeforeWord() {
1102         textInput.setText(&quot;The quick brown fox&quot;);
1103         textInput.positionCaret(4);
1104         textInput.endOfNextWord();
1105         assertEquals(9, textInput.getCaretPosition());
1106         assertEquals(9, textInput.getAnchor());
1107         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1108     }
1109 
1110     @Test public void endOfNextWord_caretWithinWhitespace() {
1111         textInput.setText(&quot;The quick  brown fox&quot;);
1112         textInput.positionCaret(10);
1113         textInput.endOfNextWord();
1114         assertEquals(16, textInput.getCaretPosition());
1115         assertEquals(16, textInput.getAnchor());
1116         assertEquals(new IndexRange(16, 16), textInput.getSelection());
1117     }
1118 
1119     @Test public void endOfNextWord_multipleWhitespaceInARow() {
1120         textInput.setText(&quot;The quick  brown fox&quot;);
1121         textInput.positionCaret(9);
1122         textInput.endOfNextWord();
1123         assertEquals(16, textInput.getCaretPosition());
1124         assertEquals(16, textInput.getAnchor());
1125         assertEquals(new IndexRange(16, 16), textInput.getSelection());
1126     }
1127 
1128     @Test public void endOfNextWord_withANumber() {
1129         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1130         textInput.positionCaret(6);
1131         textInput.endOfNextWord();
1132         assertEquals(9, textInput.getCaretPosition());
1133         assertEquals(9, textInput.getAnchor());
1134         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1135     }
1136 
1137     @Test public void endOfNextWord_withANumber_CaretOnANumber() {
1138         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1139         textInput.positionCaret(10);
1140         textInput.endOfNextWord();
1141         assertEquals(11, textInput.getCaretPosition());
1142         assertEquals(11, textInput.getAnchor());
1143         assertEquals(new IndexRange(11, 11), textInput.getSelection());
1144     }
1145 
1146     @Test public void endOfNextWord_withALongNumber_CaretOnANumber() {
1147         textInput.setText(&quot;There are 52 cards in the deck&quot;);
1148         textInput.positionCaret(10);
1149         textInput.endOfNextWord();
1150         assertEquals(12, textInput.getCaretPosition());
1151         assertEquals(12, textInput.getAnchor());
1152         assertEquals(new IndexRange(12, 12), textInput.getSelection());
1153     }
1154 
1155     @Test public void selectPreviousWordWithNoText() {
1156         textInput.selectPreviousWord();
1157         assertEquals(0, textInput.getCaretPosition());
1158         assertEquals(0, textInput.getAnchor());
1159         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1160     }
1161 
1162     @Test public void selectPreviousWordWithSelection_caretPositionBeforeAnchor() {
1163         textInput.setText(&quot;The quick brown fox&quot;);
1164         textInput.selectRange(15, 10);
1165         textInput.selectPreviousWord();
1166         assertEquals(4, textInput.getCaretPosition());
1167         assertEquals(15, textInput.getAnchor());
1168         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1169     }
1170 
1171     @Test public void selectPreviousWordWithSelection_caretPositionAfterAnchor() {
1172         textInput.setText(&quot;The quick brown fox&quot;);
1173         textInput.selectRange(10, 15);
1174         textInput.selectPreviousWord();
1175         assertEquals(10, textInput.getCaretPosition());
1176         assertEquals(10, textInput.getAnchor());
1177         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1178     }
1179 
1180     @Test public void selectPreviousWordWithSelection_caretPositionAfterAnchor2() {
1181         textInput.setText(&quot;The quick brown fox&quot;);
1182         textInput.selectRange(11, 15);
1183         textInput.selectPreviousWord();
1184         assertEquals(10, textInput.getCaretPosition());
1185         assertEquals(11, textInput.getAnchor());
1186         assertEquals(new IndexRange(10, 11), textInput.getSelection());
1187     }
1188 
1189     @Test public void selectPreviousWord_caretWithinAWord() {
1190         textInput.setText(&quot;The quick brown fox&quot;);
1191         textInput.positionCaret(12);
1192         textInput.selectPreviousWord();
1193         assertEquals(10, textInput.getCaretPosition());
1194         assertEquals(12, textInput.getAnchor());
1195         assertEquals(new IndexRange(10, 12), textInput.getSelection());
1196     }
1197 
1198     @Test public void selectPreviousWord_caretAfterWord() {
1199         textInput.setText(&quot;The quick brown fox&quot;);
1200         textInput.positionCaret(15);
1201         textInput.selectPreviousWord();
1202         assertEquals(10, textInput.getCaretPosition());
1203         assertEquals(15, textInput.getAnchor());
1204         assertEquals(new IndexRange(10, 15), textInput.getSelection());
1205     }
1206 
1207     @Test public void selectPreviousWord_caretBeforeWord() {
1208         textInput.setText(&quot;The quick brown fox&quot;);
1209         textInput.positionCaret(10);
1210         textInput.selectPreviousWord();
1211         assertEquals(4, textInput.getCaretPosition());
1212         assertEquals(10, textInput.getAnchor());
1213         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1214     }
1215 
1216     @Test public void selectPreviousWord_caretWithinWhitespace() {
1217         textInput.setText(&quot;The quick  brown fox&quot;);
1218         textInput.positionCaret(10);
1219         textInput.selectPreviousWord();
1220         assertEquals(4, textInput.getCaretPosition());
1221         assertEquals(10, textInput.getAnchor());
1222         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1223     }
1224 
1225     @Test public void selectPreviousWord_multipleWhitespaceInARow() {
1226         textInput.setText(&quot;The quick  brown fox&quot;);
1227         textInput.positionCaret(11);
1228         textInput.selectPreviousWord();
1229         assertEquals(4, textInput.getCaretPosition());
1230         assertEquals(11, textInput.getAnchor());
1231         assertEquals(new IndexRange(4, 11), textInput.getSelection());
1232     }
1233 
1234     @Test public void selectNextWordWithNoText() {
1235         textInput.selectNextWord();
1236         assertEquals(0, textInput.getCaretPosition());
1237         assertEquals(0, textInput.getAnchor());
1238         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1239     }
1240 
1241     @Test public void selectNextWordWithSelection_caretPositionBeforeAnchor() {
1242         textInput.setText(&quot;The quick brown fox&quot;);
1243         textInput.selectRange(9, 4);
1244         textInput.selectNextWord();
1245         assertEquals(10, textInput.getCaretPosition());
1246         assertEquals(9, textInput.getAnchor());
1247         assertEquals(new IndexRange(9, 10), textInput.getSelection());
1248     }
1249 
1250     @Test public void selectNextWordWithSelection_caretPositionBeforeAnchor2() {
1251         textInput.setText(&quot;The quick brown fox&quot;);
1252         textInput.selectRange(9, 2);
1253         textInput.selectNextWord();
1254         assertEquals(4, textInput.getCaretPosition());
1255         assertEquals(9, textInput.getAnchor());
1256         assertEquals(new IndexRange(4, 9), textInput.getSelection());
1257     }
1258 
1259     @Test public void selectNextWordWithSelection_caretPositionAfterAnchor() {
1260         textInput.setText(&quot;The quick brown fox&quot;);
1261         textInput.selectRange(4, 9);
1262         textInput.selectNextWord();
1263         assertEquals(10, textInput.getCaretPosition());
1264         assertEquals(4, textInput.getAnchor());
1265         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1266     }
1267 
1268     @Test public void selectNextWordWithSelection_caretPositionAfterAnchor2() {
1269         textInput.setText(&quot;The quick brown fox&quot;);
1270         textInput.selectRange(5, 11);
1271         textInput.selectNextWord();
1272         assertEquals(16, textInput.getCaretPosition());
1273         assertEquals(5, textInput.getAnchor());
1274         assertEquals(new IndexRange(5, 16), textInput.getSelection());
1275     }
1276 
1277     @Test public void selectNextWord_caretWithinAWord() {
1278         textInput.setText(&quot;The quick brown fox&quot;);
1279         textInput.positionCaret(6);
1280         textInput.selectNextWord();
1281         assertEquals(10, textInput.getCaretPosition());
1282         assertEquals(6, textInput.getAnchor());
1283         assertEquals(new IndexRange(6, 10), textInput.getSelection());
1284     }
1285 
1286     @Test public void selectNextWord_caretAfterWord() {
1287         textInput.setText(&quot;The quick brown fox&quot;);
1288         textInput.positionCaret(9);
1289         textInput.selectNextWord();
1290         assertEquals(10, textInput.getCaretPosition());
1291         assertEquals(9, textInput.getAnchor());
1292         assertEquals(new IndexRange(9, 10), textInput.getSelection());
1293     }
1294 
1295     @Test public void selectNextWord_caretBeforeWord() {
1296         textInput.setText(&quot;The quick brown fox&quot;);
1297         textInput.positionCaret(4);
1298         textInput.selectNextWord();
1299         assertEquals(10, textInput.getCaretPosition());
1300         assertEquals(4, textInput.getAnchor());
1301         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1302     }
1303 
1304     @Test public void selectNextWord_caretWithinWhitespace() {
1305         textInput.setText(&quot;The quick  brown fox&quot;);
1306         textInput.positionCaret(10);
1307         textInput.selectNextWord();
1308         assertEquals(11, textInput.getCaretPosition());
1309         assertEquals(10, textInput.getAnchor());
1310         assertEquals(new IndexRange(10, 11), textInput.getSelection());
1311     }
1312 
1313     @Test public void selectNextWord_multipleWhitespaceInARow() {
1314         textInput.setText(&quot;The quick  brown fox&quot;);
1315         textInput.positionCaret(9);
1316         textInput.selectNextWord();
1317         assertEquals(11, textInput.getCaretPosition());
1318         assertEquals(9, textInput.getAnchor());
1319         assertEquals(new IndexRange(9, 11), textInput.getSelection());
1320     }
1321 
1322     @Test public void selectNextWord_toTheEnd() {
1323         textInput.setText(&quot;The quick brown fox&quot;);
1324         textInput.positionCaret(16);
1325         textInput.selectNextWord();
1326         assertEquals(19, textInput.getCaretPosition());
1327         assertEquals(16, textInput.getAnchor());
1328         assertEquals(new IndexRange(16, 19), textInput.getSelection());
1329     }
1330 
1331     @Test public void selectEndOfNextWordWithNoText() {
1332         textInput.selectEndOfNextWord();
1333         assertEquals(0, textInput.getCaretPosition());
1334         assertEquals(0, textInput.getAnchor());
1335         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1336     }
1337 
1338     @Test public void selectEndOfNextWordWithSelection_caretPositionBeforeAnchor() {
1339         textInput.setText(&quot;The quick brown fox&quot;);
1340         textInput.selectRange(9, 4);
1341         textInput.selectEndOfNextWord();
1342         assertEquals(9, textInput.getCaretPosition());
1343         assertEquals(9, textInput.getAnchor());
1344         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1345     }
1346 
1347     @Test public void selectEndOfNextWordWithSelection_caretPositionBeforeAnchor2() {
1348         textInput.setText(&quot;The quick brown fox&quot;);
1349         textInput.selectRange(9, 2);
1350         textInput.selectEndOfNextWord();
1351         assertEquals(3, textInput.getCaretPosition());
1352         assertEquals(9, textInput.getAnchor());
1353         assertEquals(new IndexRange(3, 9), textInput.getSelection());
1354     }
1355 
1356     @Test public void selectEndOfNextWordWithSelection_caretPositionAfterAnchor() {
1357         textInput.setText(&quot;The quick brown fox&quot;);
1358         textInput.selectRange(4, 9);
1359         textInput.selectEndOfNextWord();
1360         assertEquals(15, textInput.getCaretPosition());
1361         assertEquals(4, textInput.getAnchor());
1362         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1363     }
1364 
1365     @Test public void selectEndOfNextWordWithSelection_caretPositionAfterAnchor2() {
1366         textInput.setText(&quot;The quick brown fox&quot;);
1367         textInput.selectRange(5, 11);
1368         textInput.selectEndOfNextWord();
1369         assertEquals(15, textInput.getCaretPosition());
1370         assertEquals(5, textInput.getAnchor());
1371         assertEquals(new IndexRange(5, 15), textInput.getSelection());
1372     }
1373 
1374     @Test public void selectEndOfNextWord_caretWithinAWord() {
1375         textInput.setText(&quot;The quick brown fox&quot;);
1376         textInput.positionCaret(6);
1377         textInput.selectEndOfNextWord();
1378         assertEquals(9, textInput.getCaretPosition());
1379         assertEquals(6, textInput.getAnchor());
1380         assertEquals(new IndexRange(6, 9), textInput.getSelection());
1381     }
1382 
1383     @Test public void selectEndOfNextWord_caretAfterWord() {
1384         textInput.setText(&quot;The quick brown fox&quot;);
1385         textInput.positionCaret(9);
1386         textInput.selectEndOfNextWord();
1387         assertEquals(15, textInput.getCaretPosition());
1388         assertEquals(9, textInput.getAnchor());
1389         assertEquals(new IndexRange(9, 15), textInput.getSelection());
1390     }
1391 
1392     @Test public void selectEndOfNextWord_caretBeforeWord() {
1393         textInput.setText(&quot;The quick brown fox&quot;);
1394         textInput.positionCaret(4);
1395         textInput.selectEndOfNextWord();
1396         assertEquals(9, textInput.getCaretPosition());
1397         assertEquals(4, textInput.getAnchor());
1398         assertEquals(new IndexRange(4, 9), textInput.getSelection());
1399     }
1400 
1401     @Test public void selectEndOfNextWord_caretWithinWhitespace() {
1402         textInput.setText(&quot;The quick  brown fox&quot;);
1403         textInput.positionCaret(10);
1404         textInput.selectEndOfNextWord();
1405         assertEquals(16, textInput.getCaretPosition());
1406         assertEquals(10, textInput.getAnchor());
1407         assertEquals(new IndexRange(10, 16), textInput.getSelection());
1408     }
1409 
1410     @Test public void selectEndOfNextWord_multipleWhitespaceInARow() {
1411         textInput.setText(&quot;The quick  brown fox&quot;);
1412         textInput.positionCaret(9);
1413         textInput.selectEndOfNextWord();
1414         assertEquals(16, textInput.getCaretPosition());
1415         assertEquals(9, textInput.getAnchor());
1416         assertEquals(new IndexRange(9, 16), textInput.getSelection());
1417     }
1418 
1419     @Test public void selectAllWithNoText() {
1420         textInput.setText(&quot;&quot;);
1421         textInput.selectAll();
1422         assertEquals(0, textInput.getCaretPosition());
1423         assertEquals(0, textInput.getAnchor());
1424         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1425     }
1426 
1427     @Test public void selectAllWithText_caretPositionIsAlwaysAtTheEnd() {
1428         textInput.setText(&quot;The quick brown fox&quot;);
1429         textInput.selectAll();
1430         assertEquals(19, textInput.getCaretPosition());
1431         assertEquals(0, textInput.getAnchor());
1432         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1433     }
1434 
1435     @Test public void homeClearsSelection() {
1436         textInput.setText(&quot;The quick brown fox&quot;);
1437         textInput.selectRange(4, 9);
1438         textInput.home();
1439         assertEquals(0, textInput.getCaretPosition());
1440         assertEquals(0, textInput.getAnchor());
1441         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1442     }
1443 
1444     @Test public void endClearsSelection() {
1445         textInput.setText(&quot;The quick brown fox&quot;);
1446         textInput.selectRange(4, 9);
1447         textInput.end();
1448         assertEquals(19, textInput.getCaretPosition());
1449         assertEquals(19, textInput.getAnchor());
1450         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1451     }
1452 
1453     @Test public void selectHomeHasNoEffectWhenCaretPositionIsAtZero() {
1454         textInput.setText(&quot;The quick brown fox&quot;);
1455         textInput.selectRange(3, 0);
1456         textInput.selectHome();
1457         assertEquals(0, textInput.getCaretPosition());
1458         assertEquals(3, textInput.getAnchor());
1459         assertEquals(new IndexRange(0, 3), textInput.getSelection());
1460     }
1461 
1462     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionRightOfAnchor() {
1463         textInput.setText(&quot;The quick brown fox&quot;);
1464         textInput.selectRange(4, 9);
1465         textInput.selectHome();
1466         assertEquals(0, textInput.getCaretPosition());
1467         assertEquals(4, textInput.getAnchor());
1468         assertEquals(new IndexRange(0, 4), textInput.getSelection());
1469     }
1470 
1471     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionEqualsAnchor() {
1472         textInput.setText(&quot;The quick brown fox&quot;);
1473         textInput.selectRange(3, 3);
1474         textInput.selectHome();
1475         assertEquals(0, textInput.getCaretPosition());
1476         assertEquals(3, textInput.getAnchor());
1477         assertEquals(new IndexRange(0, 3), textInput.getSelection());
1478     }
1479 
1480     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionLeftOfAnchor() {
1481         textInput.setText(&quot;The quick brown fox&quot;);
1482         textInput.selectRange(6, 3);
1483         textInput.selectHome();
1484         assertEquals(0, textInput.getCaretPosition());
1485         assertEquals(6, textInput.getAnchor());
1486         assertEquals(new IndexRange(0, 6), textInput.getSelection());
1487     }
1488 
1489     @Test public void selectEndHasNoEffectWhenCaretPositionIsAtLength() {
1490         textInput.setText(&quot;The quick brown fox&quot;);
1491         textInput.selectRange(3, 19);
1492         textInput.selectEnd();
1493         assertEquals(19, textInput.getCaretPosition());
1494         assertEquals(3, textInput.getAnchor());
1495         assertEquals(new IndexRange(3, 19), textInput.getSelection());
1496     }
1497 
1498     @Test public void selectEndMovesCaretPositionToLength_CaretPositionRightOfAnchor() {
1499         textInput.setText(&quot;The quick brown fox&quot;);
1500         textInput.selectRange(0, 3);
1501         textInput.selectEnd();
1502         assertEquals(19, textInput.getCaretPosition());
1503         assertEquals(0, textInput.getAnchor());
1504         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1505     }
1506 
1507     @Test public void selectEndMovesCaretPositionToLength_CaretPositionEqualsAnchor() {
1508         textInput.setText(&quot;The quick brown fox&quot;);
1509         textInput.selectRange(3, 3);
1510         textInput.selectEnd();
1511         assertEquals(19, textInput.getCaretPosition());
1512         assertEquals(3, textInput.getAnchor());
1513         assertEquals(new IndexRange(3, 19), textInput.getSelection());
1514     }
1515 
1516     @Test public void selectEndMovesCaretPositionToLength_CaretPositionLeftOfAnchor() {
1517         textInput.setText(&quot;The quick brown fox&quot;);
1518         textInput.selectRange(6, 3);
1519         textInput.selectEnd();
1520         assertEquals(19, textInput.getCaretPosition());
1521         assertEquals(6, textInput.getAnchor());
1522         assertEquals(new IndexRange(6, 19), textInput.getSelection());
1523     }
1524 
1525     @Test public void deletePreviousCharDeletesOnlySelectedText_anchorLessThanCaretPosition() {
1526         textInput.setText(&quot;The quick brown fox&quot;);
1527         textInput.selectRange(4, 10);
1528         textInput.deletePreviousChar();
1529         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1530         assertEquals(4, textInput.getCaretPosition());
1531         assertEquals(4, textInput.getAnchor());
1532         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1533     }
1534 
1535     @Test public void deletePreviousCharDeletesOnlySelectedText_caretPositionLessThanAnchor() {
1536         textInput.setText(&quot;The quick brown fox&quot;);
1537         textInput.selectRange(10, 4);
1538         textInput.deletePreviousChar();
1539         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1540         assertEquals(4, textInput.getCaretPosition());
1541         assertEquals(4, textInput.getAnchor());
1542         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1543     }
1544 
1545     @Test public void deletePreviousCharDeletesPreviousCharWhenCaretPositionEqualsAnchor() {
1546         textInput.setText(&quot;The quick brown fox&quot;);
1547         textInput.selectRange(10, 10);
1548         textInput.deletePreviousChar();
1549         assertEquals(&quot;The quickbrown fox&quot;, textInput.getText());
1550         assertEquals(9, textInput.getCaretPosition());
1551         assertEquals(9, textInput.getAnchor());
1552         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1553     }
1554 
1555     @Test public void deletePreviousCharDoesNothingWhenSelectionIs0_0() {
1556         textInput.setText(&quot;The quick brown fox&quot;);
1557         textInput.selectRange(0, 0);
1558         textInput.deletePreviousChar();
1559         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
1560         assertEquals(0, textInput.getCaretPosition());
1561         assertEquals(0, textInput.getAnchor());
1562         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1563     }
1564 
1565     @Test public void deleteNextCharDeletesOnlySelectedText_anchorLessThanCaretPosition() {
1566         textInput.setText(&quot;The quick brown fox&quot;);
1567         textInput.selectRange(4, 10);
1568         textInput.deleteNextChar();
1569         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1570         assertEquals(4, textInput.getCaretPosition());
1571         assertEquals(4, textInput.getAnchor());
1572         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1573     }
1574 
1575     @Test public void deleteNextCharDeletesOnlySelectedText_caretPositionLessThanAnchor() {
1576         textInput.setText(&quot;The quick brown fox&quot;);
1577         textInput.selectRange(10, 4);
1578         textInput.deleteNextChar();
1579         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1580         assertEquals(4, textInput.getCaretPosition());
1581         assertEquals(4, textInput.getAnchor());
1582         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1583     }
1584 
1585     @Test public void deleteNextCharDeletesNextCharWhenCaretPositionEqualsAnchor() {
1586         textInput.setText(&quot;The quick brown fox&quot;);
1587         textInput.selectRange(10, 10);
1588         textInput.deleteNextChar();
1589         assertEquals(&quot;The quick rown fox&quot;, textInput.getText());
1590         assertEquals(10, textInput.getCaretPosition());
1591         assertEquals(10, textInput.getAnchor());
1592         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1593     }
1594 
1595     @Test public void deleteNextCharDoesNothingWhenSelectionIsEmptyAtEnd() {
1596         textInput.setText(&quot;The quick brown fox&quot;);
1597         textInput.selectRange(19, 19);
1598         textInput.deleteNextChar();
1599         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
1600         assertEquals(19, textInput.getCaretPosition());
1601         assertEquals(19, textInput.getAnchor());
1602         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1603     }
1604 
1605     @Test public void forwardSkipsSelection() {
1606         textInput.setText(&quot;The quick brown fox&quot;);
1607         textInput.selectRange(4, 9);
1608         textInput.forward();
1609         assertEquals(9, textInput.getCaretPosition());
1610         assertEquals(9, textInput.getAnchor());
1611         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1612     }
1613 
1614     @Test public void forwardSkipsSelection2() {
1615         textInput.setText(&quot;The quick brown fox&quot;);
1616         textInput.selectRange(9, 4);
1617         textInput.forward();
1618         assertEquals(9, textInput.getCaretPosition());
1619         assertEquals(9, textInput.getAnchor());
1620         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1621     }
1622 
1623     @Test public void forwardMovesForwardWhenNotAtEnd() {
1624         textInput.setText(&quot;The quick brown fox&quot;);
1625         textInput.selectRange(0, 0);
1626         textInput.forward();
1627         assertEquals(1, textInput.getCaretPosition());
1628         assertEquals(1, textInput.getAnchor());
1629         assertEquals(new IndexRange(1, 1), textInput.getSelection());
1630     }
1631 
1632     @Test public void forwardDoesNothingWhenAtEnd() {
1633         textInput.setText(&quot;The quick brown fox&quot;);
1634         textInput.selectRange(19, 19);
1635         textInput.forward();
1636         assertEquals(19, textInput.getCaretPosition());
1637         assertEquals(19, textInput.getAnchor());
1638         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1639     }
1640 
1641     @Test public void backwardSkipsSelection() {
1642         textInput.setText(&quot;The quick brown fox&quot;);
1643         textInput.selectRange(4, 9);
1644         textInput.backward();
1645         assertEquals(4, textInput.getCaretPosition());
1646         assertEquals(4, textInput.getAnchor());
1647         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1648     }
1649 
1650     @Test public void backwardSkipsSelection2() {
1651         textInput.setText(&quot;The quick brown fox&quot;);
1652         textInput.selectRange(9, 4);
1653         textInput.backward();
1654         assertEquals(4, textInput.getCaretPosition());
1655         assertEquals(4, textInput.getAnchor());
1656         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1657     }
1658 
1659     @Test public void backwardMovesBackwardWhenNotAtStart() {
1660         textInput.setText(&quot;The quick brown fox&quot;);
1661         textInput.positionCaret(14);
1662         textInput.backward();
1663         assertEquals(13, textInput.getCaretPosition());
1664         assertEquals(13, textInput.getAnchor());
1665         assertEquals(new IndexRange(13, 13), textInput.getSelection());
1666     }
1667 
1668     @Test public void backwardDoesNothingWhenAtStart() {
1669         textInput.setText(&quot;The quick brown fox&quot;);
1670         textInput.selectRange(0, 0);
1671         textInput.backward();
1672         assertEquals(0, textInput.getCaretPosition());
1673         assertEquals(0, textInput.getAnchor());
1674         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1675     }
1676 
1677     @Test public void positionCaretAtStart() {
1678         textInput.setText(&quot;The quick brown fox&quot;);
1679         textInput.positionCaret(0);
1680         assertEquals(0, textInput.getCaretPosition());
1681         assertEquals(0, textInput.getAnchor());
1682         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1683     }
1684 
1685     @Test public void positionCaretInMiddle() {
1686         textInput.setText(&quot;The quick brown fox&quot;);
1687         textInput.positionCaret(10);
1688         assertEquals(10, textInput.getCaretPosition());
1689         assertEquals(10, textInput.getAnchor());
1690         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1691     }
1692 
1693     @Test public void positionCaretAtEnd() {
1694         textInput.setText(&quot;The quick brown fox&quot;);
1695         textInput.positionCaret(19);
1696         assertEquals(19, textInput.getCaretPosition());
1697         assertEquals(19, textInput.getAnchor());
1698         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1699     }
1700 
1701     @Test public void positionCaretBeyondStartClamps() {
1702         textInput.setText(&quot;The quick brown fox&quot;);
1703         textInput.positionCaret(-10);
1704         assertEquals(0, textInput.getCaretPosition());
1705         assertEquals(0, textInput.getAnchor());
1706         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1707     }
1708 
1709     @Test public void positionCaretBeyondEndClamps() {
1710         textInput.setText(&quot;The quick brown fox&quot;);
1711         textInput.positionCaret(1000);
1712         assertEquals(19, textInput.getCaretPosition());
1713         assertEquals(19, textInput.getAnchor());
1714         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1715     }
1716 
1717     @Test public void selectPositionCaretWhenAnchorAndCaretAreBothZero() {
1718         textInput.setText(&quot;The quick brown fox&quot;);
1719         textInput.selectRange(0, 0);
1720         textInput.selectPositionCaret(10);
1721         assertEquals(10, textInput.getCaretPosition());
1722         assertEquals(0, textInput.getAnchor());
1723         assertEquals(new IndexRange(0, 10), textInput.getSelection());
1724     }
1725 
1726     @Test public void selectPositionCaret_anchorLessThanCaretPosition() {
1727         textInput.setText(&quot;The quick brown fox&quot;);
1728         textInput.selectRange(4, 10);
1729         textInput.selectPositionCaret(1);
1730         assertEquals(1, textInput.getCaretPosition());
1731         assertEquals(4, textInput.getAnchor());
1732         assertEquals(new IndexRange(1, 4), textInput.getSelection());
1733     }
1734 
1735     @Test public void selectPositionCaret_anchorLessThanCaretPosition2() {
1736         textInput.setText(&quot;The quick brown fox&quot;);
1737         textInput.selectRange(4, 10);
1738         textInput.selectPositionCaret(15);
1739         assertEquals(15, textInput.getCaretPosition());
1740         assertEquals(4, textInput.getAnchor());
1741         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1742     }
1743 
1744     @Test public void selectPositionCaret_anchorLessThanCaretPosition3() {
1745         textInput.setText(&quot;The quick brown fox&quot;);
1746         textInput.selectRange(4, 10);
1747         textInput.selectPositionCaret(4);
1748         assertEquals(4, textInput.getCaretPosition());
1749         assertEquals(4, textInput.getAnchor());
1750         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1751     }
1752 
1753     @Test public void selectPositionCaret_caretPositionLessThanAnchor() {
1754         textInput.setText(&quot;The quick brown fox&quot;);
1755         textInput.selectRange(10, 4);
1756         textInput.selectPositionCaret(1);
1757         assertEquals(1, textInput.getCaretPosition());
1758         assertEquals(10, textInput.getAnchor());
1759         assertEquals(new IndexRange(1, 10), textInput.getSelection());
1760     }
1761 
1762     @Test public void selectPositionCaret_caretPositionLessThanAnchor2() {
1763         textInput.setText(&quot;The quick brown fox&quot;);
1764         textInput.selectRange(10, 4);
1765         textInput.selectPositionCaret(14);
1766         assertEquals(14, textInput.getCaretPosition());
1767         assertEquals(10, textInput.getAnchor());
1768         assertEquals(new IndexRange(10, 14), textInput.getSelection());
1769     }
1770 
1771     @Test public void selectPositionCaret_caretPositionLessThanAnchor3() {
1772         textInput.setText(&quot;The quick brown fox&quot;);
1773         textInput.selectRange(10, 4);
1774         textInput.selectPositionCaret(10);
1775         assertEquals(10, textInput.getCaretPosition());
1776         assertEquals(10, textInput.getAnchor());
1777         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1778     }
1779 
1780     @Test public void selectPositionCaretWhenCaretPositionEqualsAnchor() {
1781         textInput.setText(&quot;The quick brown fox&quot;);
1782         textInput.selectRange(10, 10);
1783         textInput.selectPositionCaret(4);
1784         assertEquals(4, textInput.getCaretPosition());
1785         assertEquals(10, textInput.getAnchor());
1786         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1787     }
1788 
1789     @Test public void selectPositionCaretWhenCaretPositionEqualsAnchor2() {
1790         textInput.setText(&quot;The quick brown fox&quot;);
1791         textInput.selectRange(10, 10);
1792         textInput.selectPositionCaret(14);
1793         assertEquals(14, textInput.getCaretPosition());
1794         assertEquals(10, textInput.getAnchor());
1795         assertEquals(new IndexRange(10, 14), textInput.getSelection());
1796     }
1797 
1798     @Test public void extendSelectionWithNoText() {
1799         textInput.extendSelection(0);
1800         assertEquals(0, textInput.getCaretPosition());
1801         assertEquals(0, textInput.getAnchor());
1802         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1803     }
1804 
1805     @Test public void extendSelectionWithOutOfRangePos() {
1806         textInput.setText(&quot;The quick brown fox&quot;);
1807         textInput.selectRange(0, 0);
1808         textInput.extendSelection(1000);
1809         assertEquals(19, textInput.getCaretPosition());
1810         assertEquals(0, textInput.getAnchor());
1811         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1812     }
1813 
1814     @Test public void extendSelectionWithOutOfRangePos2() {
1815         textInput.setText(&quot;The quick brown fox&quot;);
1816         textInput.positionCaret(4);
1817         textInput.extendSelection(-19);
1818         assertEquals(0, textInput.getCaretPosition());
1819         assertEquals(4, textInput.getAnchor());
1820         assertEquals(new IndexRange(0, 4), textInput.getSelection());
1821     }
1822 
1823     @Test public void test_rt26250_caret_issue_for_thai_characters() {
1824         // Thai string containing two characters, consisting of three
1825         // codepoints each.
1826         String thaiStr = &quot;\u0E17\u0E35\u0E48\u0E17\u0E35\u0E48&quot;;
1827         textInput.setText(thaiStr);
1828         textInput.positionCaret(0);
1829 
1830         // Step past one character
1831         textInput.forward();
1832         assertEquals(3, textInput.getCaretPosition());
1833 
1834         // Goto beginning
1835         textInput.backward();
1836         assertEquals(0, textInput.getCaretPosition());
1837 
1838         // Delete entire first character forwards
1839         textInput.deleteNextChar();
1840         assertEquals(&quot;\u0E17\u0E35\u0E48&quot;, textInput.getText());
1841 
1842         // Break up and delete remaining character backwards in three steps
1843         textInput.forward();
1844         textInput.deletePreviousChar();
1845         assertEquals(&quot;\u0E17\u0E35&quot;, textInput.getText());
1846         textInput.deletePreviousChar();
1847         assertEquals(&quot;\u0E17&quot;, textInput.getText());
1848         textInput.deletePreviousChar();
1849         assertEquals(&quot;&quot;, textInput.getText());
1850     }
1851 
1852     @Test public void test_rt40376_delete_next_when_text_is_null() {
1853         textInput.setText(null);
1854         textInput.deleteNextChar();
1855     }
1856 
1857     @Test public void test_jdk_8171229_replaceText() {
1858         textInput.setText(&quot;&quot;);
1859         assertEquals(&quot;&quot;, textInput.getText());
1860 
1861         textInput.replaceText(0, 0, &quot;a&quot;);
1862         assertEquals(&quot;a&quot;, textInput.getText());
1863 
1864         textInput.replaceText(1, 1, &quot;b&quot;);
1865         assertEquals(&quot;ab&quot;, textInput.getText());
1866 
1867         textInput.replaceText(2, 2, &quot;c&quot;);
1868         assertEquals(&quot;abc&quot;, textInput.getText());
1869 
1870         textInput.replaceText(3, 3, &quot;d&quot;);
1871         assertEquals(&quot;abcd&quot;, textInput.getText());
1872 
1873         textInput.replaceText(3, 4, &quot;efg&quot;);
1874         assertEquals(&quot;abcefg&quot;, textInput.getText());
1875 
1876         textInput.replaceText(3, 6, &quot;d&quot;);
1877         assertEquals(&quot;abcd&quot;, textInput.getText());
1878 
1879         textInput.replaceText(0, 4, &quot;&quot;);
1880         assertEquals(&quot;&quot;, textInput.getText());
1881 
1882         textInput.undo();
1883         assertEquals(&quot;abcd&quot;, textInput.getText());
1884 
1885         textInput.undo();
1886         assertEquals(&quot;abcefg&quot;, textInput.getText());
1887 
1888         textInput.undo();
1889         assertEquals(&quot;abcd&quot;, textInput.getText());
1890 
1891         textInput.undo();
1892         assertEquals(&quot;&quot;, textInput.getText());
1893     }
1894 
1895     // Test for JDK-8178418
1896     @Test public void UndoRedoSpaceSequence() {
1897         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1898         StackPane root = new StackPane();
1899         Scene scene = new Scene(root);
1900         Stage stage = new Stage();
1901         String text = &quot;123456789&quot;;
1902         String tempText = &quot;&quot;;
1903 
1904         textInput.setText(text);
1905         stage.setScene(scene);
1906         root.getChildren().removeAll();
1907         root.getChildren().add(textInput);
1908         stage.show();
1909         tk.firePulse();
1910 
1911         KeyEventFirer keyboard = new KeyEventFirer(textInput);
1912 
1913         // Test sequence of spaces
1914         keyboard.doKeyPress(KeyCode.HOME);
1915         tk.firePulse();
1916         for (int i = 0; i &lt; 10; ++i) {
1917             keyboard.doKeyTyped(KeyCode.SPACE);
1918             tk.firePulse();
1919             tempText += &quot; &quot;;
1920         }
1921         assertTrue(textInput.getText().equals(tempText + text));
1922 
1923         textInput.undo();
1924         assertTrue(textInput.getText().equals(text));
1925 
1926         textInput.redo();
1927         assertTrue(textInput.getText().equals(tempText + text));
1928 
1929         root.getChildren().removeAll();
1930         stage.hide();
1931         tk.firePulse();
1932     }
1933 
1934     // Test for JDK-8178418
1935     @Test public void UndoRedoReverseSpaceSequence() {
1936         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1937         StackPane root = new StackPane();
1938         Scene scene = new Scene(root);
1939         Stage stage = new Stage();
1940         String text = &quot;123456789&quot;;
1941         String tempText = &quot;&quot;;
1942 
1943         textInput.setText(text);
1944         stage.setScene(scene);
1945         root.getChildren().removeAll();
1946         root.getChildren().add(textInput);
1947         stage.show();
1948         tk.firePulse();
1949 
1950         KeyEventFirer keyboard = new KeyEventFirer(textInput);
1951         // Test reverse sequence of spaces
1952         keyboard.doKeyPress(KeyCode.HOME);
1953         tk.firePulse();
1954         for (int i = 0; i &lt; 10; ++i) {
1955             keyboard.doKeyTyped(KeyCode.SPACE);
1956             keyboard.doKeyPress(KeyCode.LEFT);
1957             tk.firePulse();
1958             tempText += &quot; &quot;;
1959             assertTrue(textInput.getText().equals(tempText + text));
1960         }
1961 
1962         for (int i = 0; i &lt; 10; ++i) {
1963             textInput.undo();
1964             tk.firePulse();
1965         }
1966         assertTrue(textInput.getText().equals(text));
1967 
1968         tempText = &quot;&quot;;
1969         for (int i = 0; i &lt; 10; ++i) {
1970             textInput.redo();
1971             tk.firePulse();
1972             tempText += &quot; &quot;;
1973             assertTrue(textInput.getText().equals(tempText + text));
1974         }
1975 
1976         root.getChildren().removeAll();
1977         stage.hide();
1978         tk.firePulse();
1979     }
1980 
1981     // Test for JDK-8178418
1982     @Test public void UndoRedoWords() {
1983         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1984         StackPane root = new StackPane();
1985         Scene scene = new Scene(root);
1986         Stage stage = new Stage();
1987         String text = &quot;123456789&quot;;
1988         String tempText = &quot;&quot;;
1989 
1990         textInput.setText(text);
1991         stage.setScene(scene);
1992         root.getChildren().removeAll();
1993         root.getChildren().add(textInput);
1994         stage.show();
1995         tk.firePulse();
1996 
1997         KeyEventFirer keyboard = new KeyEventFirer(textInput);
1998 
1999         // Test words separated by space
2000         keyboard.doKeyPress(KeyCode.HOME);
2001         tk.firePulse();
2002         for (int i = 0; i &lt; 10; ++i) {
2003             keyboard.doKeyTyped(KeyCode.SPACE);
2004             keyboard.doKeyTyped(KeyCode.A);
2005             keyboard.doKeyTyped(KeyCode.B);
2006             tk.firePulse();
2007             tempText += &quot; AB&quot;;
2008             assertTrue(textInput.getText().equals(tempText + text));
2009         }
2010 
2011         for (int i = 0; i &lt; 10; ++i) {
2012             textInput.undo();
2013             tk.firePulse();
2014         }
2015         assertTrue(textInput.getText().equals(text));
2016 
2017         tempText = &quot;&quot;;
2018         for (int i = 0; i &lt; 10; ++i) {
2019             textInput.redo();
2020             tk.firePulse();
2021             tempText += &quot; AB&quot;;
2022             assertTrue(textInput.getText().equals(tempText + text));
2023         }
2024 
2025         root.getChildren().removeAll();
2026         stage.hide();
2027         tk.firePulse();
2028     }
2029 
2030     // Test for JDK-8178418
2031     @Test public void UndoRedoTimestampBased() {
2032         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
2033         StackPane root = new StackPane();
2034         Scene scene = new Scene(root);
2035         Stage stage = new Stage();
2036         String text = &quot;123456789&quot;;
2037         String tempText = &quot;&quot;;
2038 
2039         textInput.setText(text);
2040         stage.setScene(scene);
2041         root.getChildren().removeAll();
2042         root.getChildren().add(textInput);
2043         stage.show();
2044         tk.firePulse();
2045 
2046         KeyEventFirer keyboard = new KeyEventFirer(textInput);
2047 
2048         // Test continuos sequence of characters.
2049         // In this case an undo-redo record is added after 2500 milliseconds.
2050         keyboard.doKeyPress(KeyCode.HOME);
2051         tk.firePulse();
2052 
2053         long startTime = System.currentTimeMillis();
2054         while (System.currentTimeMillis() - startTime &lt; 4000) {
2055 
2056             keyboard.doKeyTyped(KeyCode.A);
2057             tk.firePulse();
2058             tempText += &quot;A&quot;;
2059             assertTrue(textInput.getText().equals(tempText + text));
2060         }
2061 
2062         textInput.undo();
2063         assertFalse(textInput.getText().equals(text));
2064         textInput.undo();
2065         tk.firePulse();
2066         assertTrue(textInput.getText().equals(text));
2067 
2068         root.getChildren().removeAll();
2069         stage.hide();
2070         tk.firePulse();
2071     }
2072 
2073     // TODO tests for Content firing event notification properly
2074 
2075     // TODO tests for Content not allowing illegal characters
2076 
2077     private void copy(String string) {
2078         ClipboardContent content = new ClipboardContent();
2079         content.putString(string);
2080         Clipboard.getSystemClipboard().setContent(content);
2081     }
2082 }
    </pre>
  </body>
</html>