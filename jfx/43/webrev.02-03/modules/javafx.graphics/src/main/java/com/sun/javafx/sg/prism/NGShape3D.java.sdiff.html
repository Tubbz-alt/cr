<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.graphics/src/main/java/com/sun/javafx/sg/prism/NGShape3D.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="NGPointLight.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../javafx/scene/PointLight.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/java/com/sun/javafx/sg/prism/NGShape3D.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
100         }
101         meshView.setCullingMode(cullingMode);
102 
103         if (drawModeDirty) {
104             meshView.setWireframe(drawMode == DrawMode.LINE);
105             drawModeDirty = false;
106         }
107 
108         // Setup lights
109         int pointLightIdx = 0;
110         if (g.getLights() == null || g.getLights()[0] == null) {
111             // If no lights are in scene apply default light. Default light
112             // is a single white point light at camera eye position.
113             meshView.setAmbientLight(0.0f, 0.0f, 0.0f);
114             Vec3d cameraPos = g.getCameraNoClone().getPositionInWorld(null);
115             meshView.setPointLight(pointLightIdx++,
116                                    (float)cameraPos.x,
117                                    (float)cameraPos.y,
118                                    (float)cameraPos.z,
119                                    1.0f, 1.0f, 1.0f, 1.0f,
<span class="line-modified">120                                    (float) NGPointLight.getDefaultCa(),</span>
<span class="line-modified">121                                    (float) NGPointLight.getDefaultLa(),</span>
<span class="line-modified">122                                    (float) NGPointLight.getDefaultQa(),</span>
<span class="line-modified">123                                    (float) NGPointLight.getDefaultMaxRange());</span>
124         } else {
125             float ambientRed = 0.0f;
126             float ambientBlue = 0.0f;
127             float ambientGreen = 0.0f;
128 
129             for (int i = 0; i &lt; g.getLights().length; i++) {
130                 NGLightBase lightBase = g.getLights()[i];
131                 if (lightBase == null) {
132                     // The array of lights can have nulls
133                     break;
134                 } else if (lightBase.affects(this)) {
135                     float rL = lightBase.getColor().getRed();
136                     float gL = lightBase.getColor().getGreen();
137                     float bL = lightBase.getColor().getBlue();
138                     /* TODO: 3D
139                      * There is a limit on the number of point lights that can affect
140                      * a 3D shape. (Currently we simply select the first 3)
141                      * Thus it is important to select the most relevant lights.
142                      *
143                      * One such way would be to sort lights according to
144                      * intensity, which becomes especially relevant when lights
145                      * are attenuated. Only the most intense set of lights
146                      * would be set.
147                      * The approximate intesity a light will have on a given
148                      * shape, could be defined by:
149                      */
150 //                    // Where d is distance from point light
151 //                    float attenuationFactor = 1/(c + cL * d + cQ * d * d);
152 //                    float intensity = rL * 0.299f + gL * 0.587f + bL * 0.114f;
153 //                    intensity *= attenuationFactor;
154                     if (lightBase instanceof NGPointLight) {
155                         NGPointLight light = (NGPointLight)lightBase;
156                         if (rL != 0.0f || gL != 0.0f || bL != 0.0f) {
157                             Affine3D lightWT = light.getWorldTransform();
158                             meshView.setPointLight(pointLightIdx++,
159                                     (float)lightWT.getMxt(),
160                                     (float)lightWT.getMyt(),
161                                     (float)lightWT.getMzt(),
162                                     rL, gL, bL, 1.0f,
<span class="line-modified">163                                     (float) light.getCa(),</span>
<span class="line-modified">164                                     (float) light.getLa(),</span>
<span class="line-modified">165                                     (float) light.getQa(),</span>
<span class="line-modified">166                                     (float) light.getMaxRange());</span>
167                         }
168                     } else if (lightBase instanceof NGAmbientLight) {
169                         // Accumulate ambient lights
170                         ambientRed   += rL;
171                         ambientGreen += gL;
172                         ambientBlue  += bL;
173                     }
174                 }
175             }
176             ambientRed = saturate(ambientRed);
177             ambientGreen = saturate(ambientGreen);
178             ambientBlue = saturate(ambientBlue);
179             meshView.setAmbientLight(ambientRed, ambientGreen, ambientBlue);
180         }
181         // TODO: 3D Required for D3D implementation of lights, which is limited to 3
182         while (pointLightIdx &lt; 3) {
183                 // Reset any previously set lights
184                 meshView.setPointLight(pointLightIdx++,
185                         0, 0, 0, // x y z
186                         0, 0, 0, 0, // r g b w
</pre>
</td>
<td>
<hr />
<pre>
100         }
101         meshView.setCullingMode(cullingMode);
102 
103         if (drawModeDirty) {
104             meshView.setWireframe(drawMode == DrawMode.LINE);
105             drawModeDirty = false;
106         }
107 
108         // Setup lights
109         int pointLightIdx = 0;
110         if (g.getLights() == null || g.getLights()[0] == null) {
111             // If no lights are in scene apply default light. Default light
112             // is a single white point light at camera eye position.
113             meshView.setAmbientLight(0.0f, 0.0f, 0.0f);
114             Vec3d cameraPos = g.getCameraNoClone().getPositionInWorld(null);
115             meshView.setPointLight(pointLightIdx++,
116                                    (float)cameraPos.x,
117                                    (float)cameraPos.y,
118                                    (float)cameraPos.z,
119                                    1.0f, 1.0f, 1.0f, 1.0f,
<span class="line-modified">120                                    NGPointLight.getDefaultCa(),</span>
<span class="line-modified">121                                    NGPointLight.getDefaultLa(),</span>
<span class="line-modified">122                                    NGPointLight.getDefaultQa(),</span>
<span class="line-modified">123                                    NGPointLight.getDefaultMaxRange());</span>
124         } else {
125             float ambientRed = 0.0f;
126             float ambientBlue = 0.0f;
127             float ambientGreen = 0.0f;
128 
129             for (int i = 0; i &lt; g.getLights().length; i++) {
130                 NGLightBase lightBase = g.getLights()[i];
131                 if (lightBase == null) {
132                     // The array of lights can have nulls
133                     break;
134                 } else if (lightBase.affects(this)) {
135                     float rL = lightBase.getColor().getRed();
136                     float gL = lightBase.getColor().getGreen();
137                     float bL = lightBase.getColor().getBlue();
138                     /* TODO: 3D
139                      * There is a limit on the number of point lights that can affect
140                      * a 3D shape. (Currently we simply select the first 3)
141                      * Thus it is important to select the most relevant lights.
142                      *
143                      * One such way would be to sort lights according to
144                      * intensity, which becomes especially relevant when lights
145                      * are attenuated. Only the most intense set of lights
146                      * would be set.
147                      * The approximate intesity a light will have on a given
148                      * shape, could be defined by:
149                      */
150 //                    // Where d is distance from point light
151 //                    float attenuationFactor = 1/(c + cL * d + cQ * d * d);
152 //                    float intensity = rL * 0.299f + gL * 0.587f + bL * 0.114f;
153 //                    intensity *= attenuationFactor;
154                     if (lightBase instanceof NGPointLight) {
155                         NGPointLight light = (NGPointLight)lightBase;
156                         if (rL != 0.0f || gL != 0.0f || bL != 0.0f) {
157                             Affine3D lightWT = light.getWorldTransform();
158                             meshView.setPointLight(pointLightIdx++,
159                                     (float)lightWT.getMxt(),
160                                     (float)lightWT.getMyt(),
161                                     (float)lightWT.getMzt(),
162                                     rL, gL, bL, 1.0f,
<span class="line-modified">163                                     light.getCa(),</span>
<span class="line-modified">164                                     light.getLa(),</span>
<span class="line-modified">165                                     light.getQa(),</span>
<span class="line-modified">166                                     light.getMaxRange());</span>
167                         }
168                     } else if (lightBase instanceof NGAmbientLight) {
169                         // Accumulate ambient lights
170                         ambientRed   += rL;
171                         ambientGreen += gL;
172                         ambientBlue  += bL;
173                     }
174                 }
175             }
176             ambientRed = saturate(ambientRed);
177             ambientGreen = saturate(ambientGreen);
178             ambientBlue = saturate(ambientBlue);
179             meshView.setAmbientLight(ambientRed, ambientGreen, ambientBlue);
180         }
181         // TODO: 3D Required for D3D implementation of lights, which is limited to 3
182         while (pointLightIdx &lt; 3) {
183                 // Reset any previously set lights
184                 meshView.setPointLight(pointLightIdx++,
185                         0, 0, 0, // x y z
186                         0, 0, 0, 0, // r g b w
</pre>
</td>
</tr>
</table>
<center><a href="NGPointLight.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="../../../../../javafx/scene/PointLight.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>