<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center>&lt; prev <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_window.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -748,10 +748,11 @@</span>
              frame_type(_frame_type),
              window_type(type),
              owner(_owner),
              geometry(),
              map_received(false),
<span class="udiff-line-added">+             visible_received(false),</span>
              on_top(false),
              is_fullscreen(false)
  {
      jwindow = mainEnv-&gt;NewGlobalRef(_jwindow);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -822,26 +823,57 @@</span>
  // This function calculate the deltas between window and window + decoration (titleblar, borders).
  // Only useful if the window manager does not support the frame extents extension - in this case
  // it uses GDK calculation, that is primary based on _NET_FRAME_EXTENTS but will try harder
  // if that&#39;s not available.
  void WindowContextTop::calculate_adjustments() {
<span class="udiff-line-modified-removed">-     if (frame_type == TITLED &amp;&amp; !geometry.frame_extents_received) {</span>
<span class="udiff-line-modified-removed">-         GdkRectangle er;</span>
<span class="udiff-line-modified-removed">-         gdk_window_get_frame_extents(gdk_window, &amp;er);</span>
<span class="udiff-line-modified-added">+     if (frame_type != TITLED || geometry.frame_extents_received) {</span>
<span class="udiff-line-modified-added">+         return;</span>
<span class="udiff-line-modified-added">+     }</span>
  
<span class="udiff-line-modified-removed">-         int w, h;</span>
<span class="udiff-line-modified-removed">-         gtk_window_get_size(GTK_WINDOW(gtk_widget), &amp;w, &amp;h);</span>
<span class="udiff-line-modified-added">+     gint x, y;</span>
<span class="udiff-line-modified-added">+     gdk_window_get_origin(gdk_window, &amp;x, &amp;y);</span>
  
<span class="udiff-line-modified-removed">-         int px, py;</span>
<span class="udiff-line-modified-removed">-         gdk_window_get_origin(gdk_window, &amp;px, &amp;py);</span>
<span class="udiff-line-modified-added">+     gint rx, ry;</span>
<span class="udiff-line-modified-added">+     gdk_window_get_root_origin(gdk_window, &amp;rx, &amp;ry);</span>
  
<span class="udiff-line-modified-removed">-         geometry.adjust_w = (er.width - w &gt; 0) ? er.width - w : 0;</span>
<span class="udiff-line-modified-removed">-         geometry.adjust_h = (er.height - h &gt; 0) ? er.height - h : 0;</span>
<span class="udiff-line-modified-removed">-         geometry.view_x = (px - er.x &gt; 0) ? px - er.x : 0;</span>
<span class="udiff-line-modified-removed">-         geometry.view_y = (py - er.y &gt; 0) ? py - er.y : 0;</span>
<span class="udiff-line-modified-added">+     if (rx != x || ry != y) {</span>
<span class="udiff-line-modified-added">+         // probably..</span>
<span class="udiff-line-modified-added">+         geometry.adjust_w = (rx - x) * 2;</span>
<span class="udiff-line-modified-added">+         // guess that bottom size is the same as left and right</span>
<span class="udiff-line-added">+         geometry.adjust_h = (ry - y) + (rx - x);</span>
  
<span class="udiff-line-modified-removed">-         apply_geometry();</span>
<span class="udiff-line-modified-added">+         // those will be correct</span>
<span class="udiff-line-added">+         geometry.view_x = (rx - x);</span>
<span class="udiff-line-added">+         geometry.view_y = (ry - y);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         save_cached_extents();</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         CachedExtents c = (window_type == NORMAL) ? normal_extents : utility_extents;</span>
<span class="udiff-line-added">+         geometry.adjust_w = c.adjust_w;</span>
<span class="udiff-line-added">+         geometry.adjust_h = c.adjust_h;</span>
<span class="udiff-line-added">+         geometry.view_x = c.view_x;</span>
<span class="udiff-line-added">+         geometry.view_y = c.view_y;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     apply_geometry();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void WindowContextTop::save_cached_extents() {</span>
<span class="udiff-line-added">+     if (frame_type != TITLED) {</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (window_type == NORMAL) {</span>
<span class="udiff-line-added">+         normal_extents.adjust_w = geometry.adjust_w;</span>
<span class="udiff-line-added">+         normal_extents.adjust_h = geometry.adjust_h;</span>
<span class="udiff-line-added">+         normal_extents.view_x = geometry.view_x;</span>
<span class="udiff-line-added">+         normal_extents.view_y = geometry.view_y;</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         utility_extents.adjust_w = geometry.adjust_w;</span>
<span class="udiff-line-added">+         utility_extents.adjust_h = geometry.adjust_h;</span>
<span class="udiff-line-added">+         utility_extents.view_x = geometry.view_x;</span>
<span class="udiff-line-added">+         utility_extents.view_y = geometry.view_y;</span>
      }
  }
  
  void WindowContextTop::apply_geometry() {
      if (!map_received) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1012,10 +1044,12 @@</span>
                      geometry.adjust_w = left + right;
                      geometry.adjust_h = top + bottom;
                      geometry.view_x = left;
                      geometry.view_y = top;
  
<span class="udiff-line-added">+                     save_cached_extents();</span>
<span class="udiff-line-added">+ </span>
                      // set bounds again to set to correct window size that must
                      // be the total width and height accounting extents
                      set_bounds(0, 0,
                                 false, false,
                                 geometry.current_w, geometry.current_h,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1025,14 +1059,14 @@</span>
          }
      }
  }
  
  void WindowContextTop::process_configure() {
<span class="udiff-line-removed">-     gint x, y, w, h, gtk_w, gtk_h;</span>
<span class="udiff-line-removed">- </span>
      calculate_adjustments();
  
<span class="udiff-line-added">+     gint x, y, w, h, gtk_w, gtk_h;</span>
<span class="udiff-line-added">+ </span>
      gtk_window_get_position(GTK_WINDOW(gtk_widget), &amp;x, &amp;y);
      gtk_window_get_size(GTK_WINDOW(gtk_widget), &amp;gtk_w, &amp;gtk_h);
      w = gtk_w + geometry.adjust_w;
      h = gtk_h + geometry.adjust_h;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1072,10 +1106,15 @@</span>
      }
  }
  
  void WindowContextTop::set_visible(bool visible) {
      WindowContextBase::set_visible(visible);
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (visible) {</span>
<span class="udiff-line-added">+         visible_received = TRUE;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      //JDK-8220272 - fire event first because GDK_FOCUS_CHANGE is not always in order
      if (visible &amp;&amp; jwindow &amp;&amp; isEnabled()) {
          mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyFocus, com_sun_glass_events_WindowEvent_FOCUS_GAINED);
          CHECK_JNI_EXCEPTION(mainEnv);
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1098,11 +1137,11 @@</span>
          geometry.current_cw = newW;
          geometry.current_ch = newH;
          geometry.current_w = newW + geometry.adjust_w;
          geometry.current_h = newH + geometry.adjust_h;
  
<span class="udiff-line-modified-removed">-         if (map_received) {</span>
<span class="udiff-line-modified-added">+         if (visible_received) {</span>
              // update constraints if not resized by the user interface so it will
              // let gtk_window_resize succeed, because it&#39;s bound to geometry constraints
              apply_geometry();
              gtk_window_resize(GTK_WINDOW(gtk_widget), newW, newH);
          } else {
</pre>
<center>&lt; prev <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_window.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>