<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="GlassWindow.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -842,30 +842,58 @@</span>
          apply_geometry();
      }
  }
  
  void WindowContextTop::apply_geometry() {
<span class="udiff-line-added">+     if (!map_received) {</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      GdkGeometry gdk_geometry;
      gdk_geometry.win_gravity = GDK_GRAVITY_NORTH_WEST;
  
      if ((!geometry.resizable || !geometry.enabled) &amp;&amp; !(is_maximized || is_fullscreen)) {
<span class="udiff-line-modified-removed">-         gdk_geometry.min_width = geometry.current_w - geometry.adjust_w;</span>
<span class="udiff-line-modified-removed">-         gdk_geometry.min_height = geometry.current_h - geometry.adjust_h;</span>
<span class="udiff-line-modified-removed">-         gdk_geometry.max_width = geometry.current_w - geometry.adjust_w;</span>
<span class="udiff-line-modified-removed">-         gdk_geometry.max_height = geometry.current_h - geometry.adjust_h;</span>
<span class="udiff-line-modified-added">+         // no resizeable</span>
<span class="udiff-line-modified-added">+         int w = (geometry.current_w - geometry.adjust_w) &gt; 0</span>
<span class="udiff-line-modified-added">+                     ? geometry.current_w - geometry.adjust_w</span>
<span class="udiff-line-modified-added">+                     : geometry.current_cw;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         int h = (geometry.current_h - geometry.adjust_h) &gt; 0</span>
<span class="udiff-line-added">+                     ? geometry.current_h - geometry.adjust_h</span>
<span class="udiff-line-added">+                     : geometry.current_ch;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         gdk_geometry.min_width = gdk_geometry.max_width = w;</span>
<span class="udiff-line-added">+         gdk_geometry.min_height = gdk_geometry.max_height = h;</span>
      } else {
<span class="udiff-line-modified-removed">-         gdk_geometry.min_width = (geometry.minw &gt; 0) ? geometry.minw - geometry.adjust_w : 1;</span>
<span class="udiff-line-modified-removed">-         gdk_geometry.min_height = (geometry.minh &gt; 0) ? geometry.minh - geometry.adjust_h : 1;</span>
<span class="udiff-line-modified-removed">-         gdk_geometry.max_width = (geometry.maxw &gt; 0) ? geometry.maxw  - geometry.adjust_w : G_MAXINT;</span>
<span class="udiff-line-modified-removed">-         gdk_geometry.max_height = (geometry.maxh &gt; 0) ? geometry.maxh - geometry.adjust_h : G_MAXINT;</span>
<span class="udiff-line-modified-added">+         gdk_geometry.min_width = (geometry.minw - geometry.adjust_w) &gt; 0</span>
<span class="udiff-line-modified-added">+                                     ? geometry.minw - geometry.adjust_w : 1;</span>
<span class="udiff-line-modified-added">+         gdk_geometry.min_height = (geometry.minh -  geometry.adjust_h) &gt; 0</span>
<span class="udiff-line-modified-added">+                                     ? geometry.minh - geometry.adjust_h : 1;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         gdk_geometry.max_width = (geometry.maxw - geometry.adjust_w &gt; 0)</span>
<span class="udiff-line-added">+                                     ? geometry.maxw - geometry.adjust_w : G_MAXINT;</span>
<span class="udiff-line-added">+         gdk_geometry.max_height = (geometry.maxh - geometry.adjust_h&gt; 0)</span>
<span class="udiff-line-added">+                                     ? geometry.maxh - geometry.adjust_h : G_MAXINT;</span>
      }
  
<span class="udiff-line-modified-removed">-     gtk_window_set_geometry_hints(GTK_WINDOW(gtk_widget), gtk_widget, &amp;gdk_geometry,</span>
<span class="udiff-line-modified-added">+     gtk_window_set_geometry_hints(GTK_WINDOW(gtk_widget), NULL, &amp;gdk_geometry,</span>
          (GdkWindowHints) (GDK_HINT_MIN_SIZE | GDK_HINT_MAX_SIZE | GDK_HINT_WIN_GRAVITY));
  }
  
  void WindowContextTop::size_position_notify(bool size_changed, bool pos_changed) {
<span class="udiff-line-added">+     if (jview) {</span>
<span class="udiff-line-added">+         if (size_changed) {</span>
<span class="udiff-line-added">+             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize, geometry.current_cw, geometry.current_ch);</span>
<span class="udiff-line-added">+             CHECK_JNI_EXCEPTION(mainEnv);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         if (pos_changed) {</span>
<span class="udiff-line-added">+             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyView, com_sun_glass_events_ViewEvent_MOVE);</span>
<span class="udiff-line-added">+             CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      if (jwindow) {
              if (size_changed || is_maximized) {
              mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyResize,
                      (is_maximized)
                          ? com_sun_glass_events_WindowEvent_MAXIMIZE
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -877,22 +905,10 @@</span>
          if (pos_changed) {
              mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyMove, geometry.current_x, geometry.current_y);
              CHECK_JNI_EXCEPTION(mainEnv)
          }
      }
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (jview) {</span>
<span class="udiff-line-removed">-         if (size_changed) {</span>
<span class="udiff-line-removed">-             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize, geometry.current_cw, geometry.current_ch);</span>
<span class="udiff-line-removed">-             CHECK_JNI_EXCEPTION(mainEnv);</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if (pos_changed) {</span>
<span class="udiff-line-removed">-             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyView, com_sun_glass_events_ViewEvent_MOVE);</span>
<span class="udiff-line-removed">-             CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
  }
  
  void WindowContextTop::activate_window() {
      Display *display = GDK_DISPLAY_XDISPLAY (gdk_window_get_display (gdk_window));
      Atom navAtom = XInternAtom(display, &quot;_NET_ACTIVE_WINDOW&quot;, True);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1082,15 +1098,18 @@</span>
          geometry.current_cw = newW;
          geometry.current_ch = newH;
          geometry.current_w = newW + geometry.adjust_w;
          geometry.current_h = newH + geometry.adjust_h;
  
<span class="udiff-line-modified-removed">-         // update constraints if not resized by the user interface so it will</span>
<span class="udiff-line-modified-removed">-         // let gtk_window_resize succeed, because it&#39;s bound to geometry constraints</span>
<span class="udiff-line-modified-removed">-         apply_geometry();</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         gtk_window_resize(GTK_WINDOW(gtk_widget), newW, newH);</span>
<span class="udiff-line-modified-added">+         if (map_received) {</span>
<span class="udiff-line-modified-added">+             // update constraints if not resized by the user interface so it will</span>
<span class="udiff-line-modified-added">+             // let gtk_window_resize succeed, because it&#39;s bound to geometry constraints</span>
<span class="udiff-line-modified-added">+             apply_geometry();</span>
<span class="udiff-line-modified-added">+             gtk_window_resize(GTK_WINDOW(gtk_widget), newW, newH);</span>
<span class="udiff-line-added">+         } else {</span>
<span class="udiff-line-added">+             gtk_window_set_default_size(GTK_WINDOW(gtk_widget), newW, newH);</span>
<span class="udiff-line-added">+         }</span>
      }
  
      if (xSet || ySet) {
          int newX = (xSet) ? x : geometry.current_x;
          int newY = (ySet) ? y : geometry.current_y;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1106,10 +1125,11 @@</span>
      size_position_notify(size_changed, pos_changed);
  }
  
  void WindowContextTop::process_map() {
      map_received = true;
<span class="udiff-line-added">+     apply_geometry();</span>
  }
  
  void WindowContextTop::applyShapeMask(void* data, uint width, uint height) {
      if (frame_type != TRANSPARENT) {
          return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1195,13 +1215,11 @@</span>
      }
  
      geometry.minw = w;
      geometry.minh = h;
  
<span class="udiff-line-modified-removed">-     if (map_received) {</span>
<span class="udiff-line-removed">-         apply_geometry();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     apply_geometry();</span>
  }
  
  void WindowContextTop::set_maximum_size(int w, int h) {
      gboolean changed = geometry.maxw != w || geometry.maxh != h;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1210,13 +1228,11 @@</span>
      }
  
      geometry.maxw = w;
      geometry.maxh = h;
  
<span class="udiff-line-modified-removed">-     if (map_received) {</span>
<span class="udiff-line-removed">-         apply_geometry();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     apply_geometry();</span>
  }
  
  void WindowContextTop::set_icon(GdkPixbuf* pixbuf) {
      gtk_window_set_icon(GTK_WINDOW(gtk_widget), pixbuf);
  }
</pre>
<center><a href="GlassWindow.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>