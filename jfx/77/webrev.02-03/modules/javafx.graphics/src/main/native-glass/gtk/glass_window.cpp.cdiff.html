<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="GlassApplication.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_window.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 48,42 ***</span>
  #include &lt;algorithm&gt;
  
  #define MOUSE_BACK_BTN 8
  #define MOUSE_FORWARD_BTN 9
  
<span class="line-removed">- // EVENTS</span>
  static gboolean ctx_configure_callback(GtkWidget *widget, GdkEvent *event, gpointer user_data) {
<span class="line-modified">!     ((WindowContextBase*)user_data)-&gt;process_configure(NULL);</span>
      return FALSE;
  }
  
<span class="line-removed">- #ifdef GLASS_GTK3</span>
<span class="line-removed">- static gboolean ctx_draw_callback(GtkWidget *widget, cairo_t* cr, gpointer user_data) {</span>
<span class="line-removed">-     ((WindowContextBase*)user_data)-&gt;process_draw(cr);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return TRUE;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #else</span>
<span class="line-removed">- static gboolean ctx_expose_callback(GtkWidget *widget, GdkEvent* event, gpointer user_data) {</span>
<span class="line-removed">-     ((WindowContextBase*)user_data)-&gt;process_expose(&amp;event-&gt;expose);</span>
<span class="line-removed">-     return TRUE;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- </span>
<span class="line-removed">- //static gboolean ctx_damage_callback(GtkWidget *widget, GdkEvent* event, gpointer user_data) {</span>
<span class="line-removed">- //    GdkEventExpose* e = &amp;event-&gt;expose;</span>
<span class="line-removed">- //</span>
<span class="line-removed">- //#ifdef GLASS_GTK3</span>
<span class="line-removed">- //    gtk_widget_queue_draw_region(widget, e-&gt;region);</span>
<span class="line-removed">- //#else</span>
<span class="line-removed">- //    GdkWindow* gdk_win = gtk_widget_get_root_window(widget);</span>
<span class="line-removed">- //    gdk_window_invalidate_rect(gdk_win, &amp;e-&gt;area, FALSE);</span>
<span class="line-removed">- //    gdk_window_process_updates(gdk_win, FALSE);</span>
<span class="line-removed">- //#endif</span>
<span class="line-removed">- //    return TRUE;</span>
<span class="line-removed">- //}</span>
<span class="line-removed">- </span>
  static gboolean ctx_property_notify_callback(GtkWidget *widget, GdkEvent *event, gpointer user_data) {
      ((WindowContextBase*)user_data)-&gt;process_property_notify(&amp;event-&gt;property);
      return TRUE;
  }
  
<span class="line-new-header">--- 48,15 ---</span>
  #include &lt;algorithm&gt;
  
  #define MOUSE_BACK_BTN 8
  #define MOUSE_FORWARD_BTN 9
  
  static gboolean ctx_configure_callback(GtkWidget *widget, GdkEvent *event, gpointer user_data) {
<span class="line-modified">!     ((WindowContextBase*)user_data)-&gt;process_configure();</span>
      return FALSE;
  }
  
  static gboolean ctx_property_notify_callback(GtkWidget *widget, GdkEvent *event, gpointer user_data) {
      ((WindowContextBase*)user_data)-&gt;process_property_notify(&amp;event-&gt;property);
      return TRUE;
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 139,16 ***</span>
      ((WindowContextBase*)user_data)-&gt;process_screen_changed();
  }
  
  static void connect_signals(GtkWidget* gtk_widget, WindowContextBase* ctx) {
      g_signal_connect(gtk_widget, &quot;configure-event&quot;, G_CALLBACK(ctx_configure_callback), ctx);
<span class="line-removed">- //    g_signal_connect(gtk_widget, &quot;damage-event&quot;, G_CALLBACK(ctx_damage_callback), ctx);</span>
<span class="line-removed">- #ifdef GLASS_GTK3</span>
<span class="line-removed">-     g_signal_connect(gtk_widget, &quot;draw&quot;, G_CALLBACK(ctx_draw_callback), ctx);</span>
<span class="line-removed">- #else</span>
<span class="line-removed">-     g_signal_connect(gtk_widget, &quot;expose-event&quot;, G_CALLBACK(ctx_expose_callback), ctx);</span>
<span class="line-removed">- #endif</span>
      g_signal_connect(gtk_widget, &quot;property-notify-event&quot;, G_CALLBACK(ctx_property_notify_callback), ctx);
      g_signal_connect(gtk_widget, &quot;focus-in-event&quot;, G_CALLBACK(ctx_focus_change_callback), ctx);
      g_signal_connect(gtk_widget, &quot;focus-out-event&quot;, G_CALLBACK(ctx_focus_change_callback), ctx);
      g_signal_connect(gtk_widget, &quot;delete-event&quot;, G_CALLBACK(ctx_delete_callback), ctx);
      g_signal_connect(gtk_widget, &quot;window-state-event&quot;, G_CALLBACK(ctx_window_state_callback), ctx);
<span class="line-new-header">--- 112,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 342,29 ***</span>
          mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyClose);
          CHECK_JNI_EXCEPTION(mainEnv)
      }
  }
  
<span class="line-removed">- #ifdef GLASS_GTK3</span>
<span class="line-removed">- void WindowContextBase::process_draw(cairo_t* cr) {</span>
<span class="line-removed">-     if (jview) {</span>
<span class="line-removed">-         GdkRectangle r;</span>
<span class="line-removed">-         if (gdk_cairo_get_clip_rectangle (cr, &amp;r)) {</span>
<span class="line-removed">-             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyRepaint,r.x, r.y, r.width, r.height);</span>
<span class="line-removed">-             CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #else</span>
  void WindowContextBase::process_expose(GdkEventExpose* event) {
<span class="line-modified">!    if (jview) {</span>
          mainEnv-&gt;CallVoidMethod(jview, jViewNotifyRepaint, event-&gt;area.x, event-&gt;area.y,
                                   event-&gt;area.width, event-&gt;area.height);
          CHECK_JNI_EXCEPTION(mainEnv)
      }
  }
<span class="line-modified">! #endif</span>
  static inline jint gtk_button_number_to_mouse_button(guint button) {
      switch (button) {
          case 1:
              return com_sun_glass_events_MouseEvent_BUTTON_LEFT;
          case 2:
<span class="line-new-header">--- 309,18 ---</span>
          mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyClose);
          CHECK_JNI_EXCEPTION(mainEnv)
      }
  }
  
  void WindowContextBase::process_expose(GdkEventExpose* event) {
<span class="line-modified">!    if (jview &amp;&amp; is_visible()) {</span>
          mainEnv-&gt;CallVoidMethod(jview, jViewNotifyRepaint, event-&gt;area.x, event-&gt;area.y,
                                   event-&gt;area.width, event-&gt;area.height);
          CHECK_JNI_EXCEPTION(mainEnv)
      }
  }
<span class="line-modified">! </span>
  static inline jint gtk_button_number_to_mouse_button(guint button) {
      switch (button) {
          case 1:
              return com_sun_glass_events_MouseEvent_BUTTON_LEFT;
          case 2:
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1042,16 ***</span>
              }
          }
      }
  }
  
<span class="line-modified">! void WindowContextTop::process_configure(GdkEventConfigure* event) {</span>
      // this is to let java know about user changes on the window
      // if the window is not visible, there will be no changes
<span class="line-modified">!     if (!map_received &amp;&amp; !is_maximized) {</span>
<span class="line-modified">!         return;</span>
<span class="line-modified">!     }</span>
  
      gint x, y, w, h, gtk_w, gtk_h;
  
      calculate_adjustments();
  
<span class="line-new-header">--- 998,16 ---</span>
              }
          }
      }
  }
  
<span class="line-modified">! void WindowContextTop::process_configure() {</span>
      // this is to let java know about user changes on the window
      // if the window is not visible, there will be no changes
<span class="line-modified">! //    if (!map_received &amp;&amp; !is_maximized) {</span>
<span class="line-modified">! //        return;</span>
<span class="line-modified">! //    }</span>
  
      gint x, y, w, h, gtk_w, gtk_h;
  
      calculate_adjustments();
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1151,11 ***</span>
      }
  }
  
  void WindowContextTop::process_map() {
      map_received = true;
<span class="line-removed">- </span>
      geometry.resizable = geometry.resizable_on_map;
      set_enabled(geometry.enabled_on_map);
  
      apply_geometry();
  }
<span class="line-new-header">--- 1107,10 ---</span>
</pre>
<center><a href="GlassApplication.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_window.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>