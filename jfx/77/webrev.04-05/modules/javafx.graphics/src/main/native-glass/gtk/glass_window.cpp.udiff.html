<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="glass_dnd.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_window.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/main/native-glass/gtk/glass_window.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -861,29 +861,37 @@</span>
  
      gtk_window_set_geometry_hints(GTK_WINDOW(gtk_widget), gtk_widget, &amp;gdk_geometry,
          (GdkWindowHints) (GDK_HINT_MIN_SIZE | GDK_HINT_MAX_SIZE | GDK_HINT_WIN_GRAVITY));
  }
  
<span class="udiff-line-modified-removed">- void WindowContextTop::size_position_notify() {</span>
<span class="udiff-line-modified-added">+ void WindowContextTop::size_position_notify(bool size_changed, bool pos_changed) {</span>
      if (jwindow) {
<span class="udiff-line-modified-removed">-         mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyResize,</span>
<span class="udiff-line-modified-removed">-                 (is_maximized)</span>
<span class="udiff-line-modified-removed">-                     ? com_sun_glass_events_WindowEvent_MAXIMIZE</span>
<span class="udiff-line-modified-removed">-                     : com_sun_glass_events_WindowEvent_RESIZE,</span>
<span class="udiff-line-modified-removed">-                 geometry.current_w, geometry.current_h);</span>
<span class="udiff-line-modified-removed">-         CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-modified-added">+             if (size_changed || is_maximized) {</span>
<span class="udiff-line-modified-added">+             mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyResize,</span>
<span class="udiff-line-modified-added">+                     (is_maximized)</span>
<span class="udiff-line-modified-added">+                         ? com_sun_glass_events_WindowEvent_MAXIMIZE</span>
<span class="udiff-line-modified-added">+                         : com_sun_glass_events_WindowEvent_RESIZE,</span>
<span class="udiff-line-modified-added">+                     geometry.current_w, geometry.current_h);</span>
<span class="udiff-line-added">+             CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-added">+         }</span>
  
<span class="udiff-line-modified-removed">-         mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyMove, geometry.current_x, geometry.current_y);</span>
<span class="udiff-line-modified-removed">-         CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-modified-added">+         if (pos_changed) {</span>
<span class="udiff-line-modified-added">+             mainEnv-&gt;CallVoidMethod(jwindow, jWindowNotifyMove, geometry.current_x, geometry.current_y);</span>
<span class="udiff-line-added">+             CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-added">+         }</span>
      }
  
      if (jview) {
<span class="udiff-line-modified-removed">-         mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize, geometry.current_cw, geometry.current_ch);</span>
<span class="udiff-line-modified-removed">-         CHECK_JNI_EXCEPTION(mainEnv);</span>
<span class="udiff-line-modified-added">+         if (size_changed) {</span>
<span class="udiff-line-modified-added">+             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyResize, geometry.current_cw, geometry.current_ch);</span>
<span class="udiff-line-added">+             CHECK_JNI_EXCEPTION(mainEnv);</span>
<span class="udiff-line-added">+         }</span>
  
<span class="udiff-line-modified-removed">-         mainEnv-&gt;CallVoidMethod(jview, jViewNotifyView, com_sun_glass_events_ViewEvent_MOVE);</span>
<span class="udiff-line-modified-removed">-         CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-modified-added">+         if (pos_changed) {</span>
<span class="udiff-line-modified-added">+             mainEnv-&gt;CallVoidMethod(jview, jViewNotifyView, com_sun_glass_events_ViewEvent_MOVE);</span>
<span class="udiff-line-added">+             CHECK_JNI_EXCEPTION(mainEnv)</span>
<span class="udiff-line-added">+         }</span>
      }
  }
  
  void WindowContextTop::activate_window() {
      Display *display = GDK_DISPLAY_XDISPLAY (gdk_window_get_display (gdk_window));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1010,24 +1018,22 @@</span>
      gtk_window_get_position(GTK_WINDOW(gtk_widget), &amp;x, &amp;y);
      gtk_window_get_size(GTK_WINDOW(gtk_widget), &amp;gtk_w, &amp;gtk_h);
      w = gtk_w + geometry.adjust_w;
      h = gtk_h + geometry.adjust_h;
  
<span class="udiff-line-modified-removed">-     gboolean changed = geometry.current_x != x || geometry.current_y != y</span>
<span class="udiff-line-modified-removed">-                         || geometry.current_w != w || geometry.current_h != h</span>
<span class="udiff-line-modified-removed">-                         || geometry.current_cw != gtk_w || geometry.current_ch != gtk_h;</span>
<span class="udiff-line-modified-added">+     gboolean pos_changed = geometry.current_x != x || geometry.current_y != y;</span>
<span class="udiff-line-modified-added">+     gboolean size_changed = geometry.current_w != w || geometry.current_h != h</span>
<span class="udiff-line-modified-added">+                             || geometry.current_cw != gtk_w || geometry.current_ch != gtk_h;</span>
  
<span class="udiff-line-modified-removed">-     if (changed) {</span>
<span class="udiff-line-modified-removed">-         geometry.current_x = x;</span>
<span class="udiff-line-modified-removed">-         geometry.current_y = y;</span>
<span class="udiff-line-modified-removed">-         geometry.current_w = w;</span>
<span class="udiff-line-modified-removed">-         geometry.current_h = h;</span>
<span class="udiff-line-modified-removed">-         geometry.current_cw = gtk_w;</span>
<span class="udiff-line-removed">-         geometry.current_ch = gtk_h;</span>
<span class="udiff-line-modified-added">+     geometry.current_x = x;</span>
<span class="udiff-line-modified-added">+     geometry.current_y = y;</span>
<span class="udiff-line-modified-added">+     geometry.current_w = w;</span>
<span class="udiff-line-modified-added">+     geometry.current_h = h;</span>
<span class="udiff-line-modified-added">+     geometry.current_cw = gtk_w;</span>
<span class="udiff-line-modified-added">+     geometry.current_ch = gtk_h;</span>
  
<span class="udiff-line-modified-removed">-         size_position_notify();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     size_position_notify(size_changed, pos_changed);</span>
  }
  
  void WindowContextTop::process_screen_changed() {
      glong to_screen = getScreenPtrForLocation(geometry.current_x, geometry.current_y);
      if (to_screen != -1) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1065,13 +1071,15 @@</span>
      // newW / newH always content sizes compatible with GTK+
      // if window has no decoration, adjustments will be ZERO
      int newW = w &gt; 0 ? w - geometry.adjust_w : cw;
      int newH = h &gt; 0 ? h - geometry.adjust_h : ch;
  
<span class="udiff-line-modified-removed">-     gboolean changed = FALSE;</span>
<span class="udiff-line-modified-added">+     gboolean size_changed = FALSE;</span>
<span class="udiff-line-added">+     gboolean pos_changed = FALSE;</span>
<span class="udiff-line-added">+ </span>
      if (newW &gt; 0 &amp;&amp; newH &gt; 0) {
<span class="udiff-line-modified-removed">-         changed = TRUE;</span>
<span class="udiff-line-modified-added">+         size_changed = TRUE;</span>
  
          geometry.current_cw = newW;
          geometry.current_ch = newH;
          geometry.current_w = newW + geometry.adjust_w;
          geometry.current_h = newH + geometry.adjust_h;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1086,20 +1094,18 @@</span>
      if (xSet || ySet) {
          int newX = (xSet) ? x : geometry.current_x;
          int newY = (ySet) ? y : geometry.current_y;
  
          if (newX != geometry.current_x || newY != geometry.current_y) {
<span class="udiff-line-modified-removed">-             changed = TRUE;</span>
<span class="udiff-line-modified-added">+             pos_changed = TRUE;</span>
              geometry.current_x = newX;
              geometry.current_y = newY;
              gtk_window_move(GTK_WINDOW(gtk_widget), newX, newY);
          }
      }
  
<span class="udiff-line-modified-removed">-     if (changed) {</span>
<span class="udiff-line-removed">-         size_position_notify();</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     size_position_notify(size_changed, pos_changed);</span>
  }
  
  void WindowContextTop::process_map() {
      map_received = true;
  }
</pre>
<center><a href="glass_dnd.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="glass_window.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>