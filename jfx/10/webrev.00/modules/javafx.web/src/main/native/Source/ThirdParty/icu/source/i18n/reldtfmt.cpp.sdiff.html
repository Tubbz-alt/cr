<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/reldtfmt.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="reldatefmt.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="reldtfmt.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/reldtfmt.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
413 {
414     return fDateTimeFormatter-&gt;getDateFormatSymbols();
415 }
416 
417 // override the DateFormat implementation in order to
418 // lazily initialize relevant items
419 void
420 RelativeDateFormat::setContext(UDisplayContext value, UErrorCode&amp; status)
421 {
422     DateFormat::setContext(value, status);
423     if (U_SUCCESS(status)) {
424         if (!fCapitalizationInfoSet &amp;&amp;
425                 (value==UDISPCTX_CAPITALIZATION_FOR_UI_LIST_OR_MENU || value==UDISPCTX_CAPITALIZATION_FOR_STANDALONE)) {
426             initCapitalizationContextInfo(fLocale);
427             fCapitalizationInfoSet = TRUE;
428         }
429 #if !UCONFIG_NO_BREAK_ITERATION
430         if ( fCapitalizationBrkIter == NULL &amp;&amp; (value==UDISPCTX_CAPITALIZATION_FOR_BEGINNING_OF_SENTENCE ||
431                 (value==UDISPCTX_CAPITALIZATION_FOR_UI_LIST_OR_MENU &amp;&amp; fCapitalizationOfRelativeUnitsForUIListMenu) ||
432                 (value==UDISPCTX_CAPITALIZATION_FOR_STANDALONE &amp;&amp; fCapitalizationOfRelativeUnitsForStandAlone)) ) {
<span class="line-modified">433             UErrorCode status = U_ZERO_ERROR;</span>
434             fCapitalizationBrkIter = BreakIterator::createSentenceInstance(fLocale, status);
435             if (U_FAILURE(status)) {
436                 delete fCapitalizationBrkIter;
437                 fCapitalizationBrkIter = NULL;
438             }
439         }
440 #endif
441     }
442 }
443 
444 void
445 RelativeDateFormat::initCapitalizationContextInfo(const Locale&amp; thelocale)
446 {
447 #if !UCONFIG_NO_BREAK_ITERATION
448     const char * localeID = (thelocale != NULL)? thelocale.getBaseName(): NULL;
449     UErrorCode status = U_ZERO_ERROR;
450     LocalUResourceBundlePointer rb(ures_open(NULL, localeID, &amp;status));
451     ures_getByKeyWithFallback(rb.getAlias(),
452                               &quot;contextTransforms/relative&quot;,
453                                rb.getAlias(), &amp;status);
454     if (U_SUCCESS(status) &amp;&amp; rb != NULL) {
455         int32_t len = 0;
456         const int32_t * intVector = ures_getIntVector(rb.getAlias(),
457                                                       &amp;len, &amp;status);
458         if (U_SUCCESS(status) &amp;&amp; intVector != NULL &amp;&amp; len &gt;= 2) {
<span class="line-modified">459             fCapitalizationOfRelativeUnitsForUIListMenu = intVector[0];</span>
<span class="line-modified">460             fCapitalizationOfRelativeUnitsForStandAlone = intVector[1];</span>
461         }
462     }
463 #endif
464 }
465 
466 namespace {
467 
468 /**
469  * Sink for getting data from fields/day/relative data.
470  * For loading relative day names, e.g., &quot;yesterday&quot;, &quot;today&quot;.
471  */
472 
473 struct RelDateFmtDataSink : public ResourceSink {
474   URelativeString *fDatesPtr;
475   int32_t fDatesLen;
476 
477   RelDateFmtDataSink(URelativeString* fDates, int32_t len) : fDatesPtr(fDates), fDatesLen(len) {
478     for (int32_t i = 0; i &lt; fDatesLen; ++i) {
479       fDatesPtr[i].offset = 0;
480       fDatesPtr[i].string = NULL;
</pre>
</td>
<td>
<hr />
<pre>
413 {
414     return fDateTimeFormatter-&gt;getDateFormatSymbols();
415 }
416 
417 // override the DateFormat implementation in order to
418 // lazily initialize relevant items
419 void
420 RelativeDateFormat::setContext(UDisplayContext value, UErrorCode&amp; status)
421 {
422     DateFormat::setContext(value, status);
423     if (U_SUCCESS(status)) {
424         if (!fCapitalizationInfoSet &amp;&amp;
425                 (value==UDISPCTX_CAPITALIZATION_FOR_UI_LIST_OR_MENU || value==UDISPCTX_CAPITALIZATION_FOR_STANDALONE)) {
426             initCapitalizationContextInfo(fLocale);
427             fCapitalizationInfoSet = TRUE;
428         }
429 #if !UCONFIG_NO_BREAK_ITERATION
430         if ( fCapitalizationBrkIter == NULL &amp;&amp; (value==UDISPCTX_CAPITALIZATION_FOR_BEGINNING_OF_SENTENCE ||
431                 (value==UDISPCTX_CAPITALIZATION_FOR_UI_LIST_OR_MENU &amp;&amp; fCapitalizationOfRelativeUnitsForUIListMenu) ||
432                 (value==UDISPCTX_CAPITALIZATION_FOR_STANDALONE &amp;&amp; fCapitalizationOfRelativeUnitsForStandAlone)) ) {
<span class="line-modified">433             status = U_ZERO_ERROR;</span>
434             fCapitalizationBrkIter = BreakIterator::createSentenceInstance(fLocale, status);
435             if (U_FAILURE(status)) {
436                 delete fCapitalizationBrkIter;
437                 fCapitalizationBrkIter = NULL;
438             }
439         }
440 #endif
441     }
442 }
443 
444 void
445 RelativeDateFormat::initCapitalizationContextInfo(const Locale&amp; thelocale)
446 {
447 #if !UCONFIG_NO_BREAK_ITERATION
448     const char * localeID = (thelocale != NULL)? thelocale.getBaseName(): NULL;
449     UErrorCode status = U_ZERO_ERROR;
450     LocalUResourceBundlePointer rb(ures_open(NULL, localeID, &amp;status));
451     ures_getByKeyWithFallback(rb.getAlias(),
452                               &quot;contextTransforms/relative&quot;,
453                                rb.getAlias(), &amp;status);
454     if (U_SUCCESS(status) &amp;&amp; rb != NULL) {
455         int32_t len = 0;
456         const int32_t * intVector = ures_getIntVector(rb.getAlias(),
457                                                       &amp;len, &amp;status);
458         if (U_SUCCESS(status) &amp;&amp; intVector != NULL &amp;&amp; len &gt;= 2) {
<span class="line-modified">459             fCapitalizationOfRelativeUnitsForUIListMenu = static_cast&lt;UBool&gt;(intVector[0]);</span>
<span class="line-modified">460             fCapitalizationOfRelativeUnitsForStandAlone = static_cast&lt;UBool&gt;(intVector[1]);</span>
461         }
462     }
463 #endif
464 }
465 
466 namespace {
467 
468 /**
469  * Sink for getting data from fields/day/relative data.
470  * For loading relative day names, e.g., &quot;yesterday&quot;, &quot;today&quot;.
471  */
472 
473 struct RelDateFmtDataSink : public ResourceSink {
474   URelativeString *fDatesPtr;
475   int32_t fDatesLen;
476 
477   RelDateFmtDataSink(URelativeString* fDates, int32_t len) : fDatesPtr(fDates), fDatesLen(len) {
478     for (int32_t i = 0; i &lt; fDatesLen; ++i) {
479       fDatesPtr[i].offset = 0;
480       fDatesPtr[i].string = NULL;
</pre>
</td>
</tr>
</table>
<center><a href="reldatefmt.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="reldtfmt.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>