<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/unicode/stringtriebuilder.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="stringoptions.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="ubidi.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/unicode/stringtriebuilder.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9 *   encoding:   UTF-8
 10 *   tab size:   8 (not used)
 11 *   indentation:4
 12 *
 13 *   created on: 2010dec24
 14 *   created by: Markus W. Scherer
 15 */
 16 
 17 #ifndef __STRINGTRIEBUILDER_H__
 18 #define __STRINGTRIEBUILDER_H__
 19 
 20 #include &quot;unicode/utypes.h&quot;
 21 #include &quot;unicode/uobject.h&quot;
 22 
 23 /**
 24  * \file
 25  * \brief C++ API: Builder API for trie builders
 26  */
 27 
 28 // Forward declaration.

 29 struct UHashtable;
 30 typedef struct UHashtable UHashtable;

 31 
 32 /**
 33  * Build options for BytesTrieBuilder and CharsTrieBuilder.
 34  * @stable ICU 4.8
 35  */
 36 enum UStringTrieBuildOption {
 37     /**
 38      * Builds a trie quickly.
 39      * @stable ICU 4.8
 40      */
 41     USTRINGTRIE_BUILD_FAST,
 42     /**
 43      * Builds a trie more slowly, attempting to generate
 44      * a shorter but equivalent serialization.
 45      * This build option also uses more memory.
 46      *
 47      * This option can be effective when many integer values are the same
 48      * and string/byte sequence suffixes can be shared.
 49      * Runtime speed is not expected to improve.
 50      * @stable ICU 4.8
 51      */
 52     USTRINGTRIE_BUILD_SMALL
 53 };
 54 
 55 U_NAMESPACE_BEGIN
 56 
 57 /**
 58  * Base class for string trie builder classes.
 59  *
 60  * This class is not intended for public subclassing.
 61  * @stable ICU 4.8
 62  */
 63 class U_COMMON_API StringTrieBuilder : public UObject {
 64 public:
 65 #ifndef U_HIDE_INTERNAL_API
 66     /** @internal */
<span class="line-modified"> 67     static UBool hashNode(const void *node);</span>
 68     /** @internal */
 69     static UBool equalNodes(const void *left, const void *right);
 70 #endif  /* U_HIDE_INTERNAL_API */
 71 
 72 protected:
 73     // Do not enclose the protected default constructor with #ifndef U_HIDE_INTERNAL_API
 74     // or else the compiler will create a public default constructor.
 75     /** @internal */
 76     StringTrieBuilder();
 77     /** @internal */
 78     virtual ~StringTrieBuilder();
 79 
 80 #ifndef U_HIDE_INTERNAL_API
 81     /** @internal */
 82     void createCompactBuilder(int32_t sizeGuess, UErrorCode &amp;errorCode);
 83     /** @internal */
 84     void deleteCompactBuilder();
 85 
 86     /** @internal */
 87     void build(UStringTrieBuildOption buildOption, int32_t elementsLength, UErrorCode &amp;errorCode);
</pre>
<hr />
<pre>
171      * registerNode() and registerFinalValue() take ownership of their input nodes,
172      * and only return owned nodes.
173      * If they see a failure UErrorCode, they will delete the input node.
174      * If they get a NULL pointer, they will record a U_MEMORY_ALLOCATION_ERROR.
175      * If there is a failure, they return NULL.
176      *
177      * NULL Node pointers can be safely passed into other Nodes because
178      * they call the static Node::hashCode() which checks for a NULL pointer first.
179      *
180      * Therefore, as long as builder functions register a new node,
181      * they need to check for failures only before explicitly dereferencing
182      * a Node pointer, or before setting a new UErrorCode.
183      */
184 
185     // Hash set of nodes, maps from nodes to integer 1.
186     /** @internal */
187     UHashtable *nodes;
188 
189     // Do not conditionalize the following with #ifndef U_HIDE_INTERNAL_API,
190     // it is needed for layout of other objects.
<span class="line-modified">191     /** @internal */</span>



192     class Node : public UObject {
193     public:
194         Node(int32_t initialHash) : hash(initialHash), offset(0) {}
195         inline int32_t hashCode() const { return hash; }
196         // Handles node==NULL.
197         static inline int32_t hashCode(const Node *node) { return node==NULL ? 0 : node-&gt;hashCode(); }
198         // Base class operator==() compares the actual class types.
199         virtual UBool operator==(const Node &amp;other) const;
200         inline UBool operator!=(const Node &amp;other) const { return !operator==(other); }
201         /**
202          * Traverses the Node graph and numbers branch edges, with rightmost edges first.
203          * This is to avoid writing a duplicate node twice.
204          *
205          * Branch nodes in this trie data structure are not symmetric.
206          * Most branch edges &quot;jump&quot; to other nodes but the rightmost branch edges
207          * just continue without a jump.
208          * Therefore, write() must write the rightmost branch edge last
209          * (trie units are written backwards), and must write it at that point even if
210          * it is a duplicate of a node previously written elsewhere.
211          *
</pre>
<hr />
<pre>
374     protected:
375         char16_t unit;
376         Node *lessThan;
377         Node *greaterOrEqual;
378     };
379 
380     // Branch head node, for writing the actual node lead unit.
381     /** @internal */
382     class BranchHeadNode : public ValueNode {
383     public:
384         BranchHeadNode(int32_t len, Node *subNode)
385                 : ValueNode((0x666666u*37u+len)*37u+hashCode(subNode)),
386                   length(len), next(subNode) {}
387         virtual UBool operator==(const Node &amp;other) const;
388         virtual int32_t markRightEdgesFirst(int32_t edgeNumber);
389         virtual void write(StringTrieBuilder &amp;builder);
390     protected:
391         int32_t length;
392         Node *next;  // A branch sub-node.
393     };

394 #endif  /* U_HIDE_INTERNAL_API */

395 
396     /** @internal */
397     virtual Node *createLinearMatchNode(int32_t i, int32_t unitIndex, int32_t length,
398                                         Node *nextNode) const = 0;
399 
400     /** @internal */
401     virtual int32_t write(int32_t unit) = 0;
402     /** @internal */
403     virtual int32_t writeElementUnits(int32_t i, int32_t unitIndex, int32_t length) = 0;
404     /** @internal */
405     virtual int32_t writeValueAndFinal(int32_t i, UBool isFinal) = 0;
406     /** @internal */
407     virtual int32_t writeValueAndType(UBool hasValue, int32_t value, int32_t node) = 0;
408     /** @internal */
409     virtual int32_t writeDeltaTo(int32_t jumpTarget) = 0;
410 };
411 
412 U_NAMESPACE_END
413 
414 #endif  // __STRINGTRIEBUILDER_H__
</pre>
</td>
<td>
<hr />
<pre>
  9 *   encoding:   UTF-8
 10 *   tab size:   8 (not used)
 11 *   indentation:4
 12 *
 13 *   created on: 2010dec24
 14 *   created by: Markus W. Scherer
 15 */
 16 
 17 #ifndef __STRINGTRIEBUILDER_H__
 18 #define __STRINGTRIEBUILDER_H__
 19 
 20 #include &quot;unicode/utypes.h&quot;
 21 #include &quot;unicode/uobject.h&quot;
 22 
 23 /**
 24  * \file
 25  * \brief C++ API: Builder API for trie builders
 26  */
 27 
 28 // Forward declaration.
<span class="line-added"> 29 /// \cond</span>
 30 struct UHashtable;
 31 typedef struct UHashtable UHashtable;
<span class="line-added"> 32 /// \endcond</span>
 33 
 34 /**
 35  * Build options for BytesTrieBuilder and CharsTrieBuilder.
 36  * @stable ICU 4.8
 37  */
 38 enum UStringTrieBuildOption {
 39     /**
 40      * Builds a trie quickly.
 41      * @stable ICU 4.8
 42      */
 43     USTRINGTRIE_BUILD_FAST,
 44     /**
 45      * Builds a trie more slowly, attempting to generate
 46      * a shorter but equivalent serialization.
 47      * This build option also uses more memory.
 48      *
 49      * This option can be effective when many integer values are the same
 50      * and string/byte sequence suffixes can be shared.
 51      * Runtime speed is not expected to improve.
 52      * @stable ICU 4.8
 53      */
 54     USTRINGTRIE_BUILD_SMALL
 55 };
 56 
 57 U_NAMESPACE_BEGIN
 58 
 59 /**
 60  * Base class for string trie builder classes.
 61  *
 62  * This class is not intended for public subclassing.
 63  * @stable ICU 4.8
 64  */
 65 class U_COMMON_API StringTrieBuilder : public UObject {
 66 public:
 67 #ifndef U_HIDE_INTERNAL_API
 68     /** @internal */
<span class="line-modified"> 69     static int32_t hashNode(const void *node);</span>
 70     /** @internal */
 71     static UBool equalNodes(const void *left, const void *right);
 72 #endif  /* U_HIDE_INTERNAL_API */
 73 
 74 protected:
 75     // Do not enclose the protected default constructor with #ifndef U_HIDE_INTERNAL_API
 76     // or else the compiler will create a public default constructor.
 77     /** @internal */
 78     StringTrieBuilder();
 79     /** @internal */
 80     virtual ~StringTrieBuilder();
 81 
 82 #ifndef U_HIDE_INTERNAL_API
 83     /** @internal */
 84     void createCompactBuilder(int32_t sizeGuess, UErrorCode &amp;errorCode);
 85     /** @internal */
 86     void deleteCompactBuilder();
 87 
 88     /** @internal */
 89     void build(UStringTrieBuildOption buildOption, int32_t elementsLength, UErrorCode &amp;errorCode);
</pre>
<hr />
<pre>
173      * registerNode() and registerFinalValue() take ownership of their input nodes,
174      * and only return owned nodes.
175      * If they see a failure UErrorCode, they will delete the input node.
176      * If they get a NULL pointer, they will record a U_MEMORY_ALLOCATION_ERROR.
177      * If there is a failure, they return NULL.
178      *
179      * NULL Node pointers can be safely passed into other Nodes because
180      * they call the static Node::hashCode() which checks for a NULL pointer first.
181      *
182      * Therefore, as long as builder functions register a new node,
183      * they need to check for failures only before explicitly dereferencing
184      * a Node pointer, or before setting a new UErrorCode.
185      */
186 
187     // Hash set of nodes, maps from nodes to integer 1.
188     /** @internal */
189     UHashtable *nodes;
190 
191     // Do not conditionalize the following with #ifndef U_HIDE_INTERNAL_API,
192     // it is needed for layout of other objects.
<span class="line-modified">193     /**</span>
<span class="line-added">194      * @internal</span>
<span class="line-added">195      * \cond</span>
<span class="line-added">196      */</span>
197     class Node : public UObject {
198     public:
199         Node(int32_t initialHash) : hash(initialHash), offset(0) {}
200         inline int32_t hashCode() const { return hash; }
201         // Handles node==NULL.
202         static inline int32_t hashCode(const Node *node) { return node==NULL ? 0 : node-&gt;hashCode(); }
203         // Base class operator==() compares the actual class types.
204         virtual UBool operator==(const Node &amp;other) const;
205         inline UBool operator!=(const Node &amp;other) const { return !operator==(other); }
206         /**
207          * Traverses the Node graph and numbers branch edges, with rightmost edges first.
208          * This is to avoid writing a duplicate node twice.
209          *
210          * Branch nodes in this trie data structure are not symmetric.
211          * Most branch edges &quot;jump&quot; to other nodes but the rightmost branch edges
212          * just continue without a jump.
213          * Therefore, write() must write the rightmost branch edge last
214          * (trie units are written backwards), and must write it at that point even if
215          * it is a duplicate of a node previously written elsewhere.
216          *
</pre>
<hr />
<pre>
379     protected:
380         char16_t unit;
381         Node *lessThan;
382         Node *greaterOrEqual;
383     };
384 
385     // Branch head node, for writing the actual node lead unit.
386     /** @internal */
387     class BranchHeadNode : public ValueNode {
388     public:
389         BranchHeadNode(int32_t len, Node *subNode)
390                 : ValueNode((0x666666u*37u+len)*37u+hashCode(subNode)),
391                   length(len), next(subNode) {}
392         virtual UBool operator==(const Node &amp;other) const;
393         virtual int32_t markRightEdgesFirst(int32_t edgeNumber);
394         virtual void write(StringTrieBuilder &amp;builder);
395     protected:
396         int32_t length;
397         Node *next;  // A branch sub-node.
398     };
<span class="line-added">399 </span>
400 #endif  /* U_HIDE_INTERNAL_API */
<span class="line-added">401     /// \endcond</span>
402 
403     /** @internal */
404     virtual Node *createLinearMatchNode(int32_t i, int32_t unitIndex, int32_t length,
405                                         Node *nextNode) const = 0;
406 
407     /** @internal */
408     virtual int32_t write(int32_t unit) = 0;
409     /** @internal */
410     virtual int32_t writeElementUnits(int32_t i, int32_t unitIndex, int32_t length) = 0;
411     /** @internal */
412     virtual int32_t writeValueAndFinal(int32_t i, UBool isFinal) = 0;
413     /** @internal */
414     virtual int32_t writeValueAndType(UBool hasValue, int32_t value, int32_t node) = 0;
415     /** @internal */
416     virtual int32_t writeDeltaTo(int32_t jumpTarget) = 0;
417 };
418 
419 U_NAMESPACE_END
420 
421 #endif  // __STRINGTRIEBUILDER_H__
</pre>
</td>
</tr>
</table>
<center><a href="stringoptions.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="ubidi.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>