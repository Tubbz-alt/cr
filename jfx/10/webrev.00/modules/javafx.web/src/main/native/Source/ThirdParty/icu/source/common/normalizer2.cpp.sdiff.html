<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/normalizer2.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="norm2_nfc_data.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="normalizer2impl.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/normalizer2.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 17 */
 18 
 19 #include &quot;unicode/utypes.h&quot;
 20 
 21 #if !UCONFIG_NO_NORMALIZATION
 22 
 23 #include &quot;unicode/edits.h&quot;
 24 #include &quot;unicode/normalizer2.h&quot;
 25 #include &quot;unicode/stringoptions.h&quot;
 26 #include &quot;unicode/unistr.h&quot;
 27 #include &quot;unicode/unorm.h&quot;
 28 #include &quot;cstring.h&quot;
 29 #include &quot;mutex.h&quot;
 30 #include &quot;norm2allmodes.h&quot;
 31 #include &quot;normalizer2impl.h&quot;
 32 #include &quot;uassert.h&quot;
 33 #include &quot;ucln_cmn.h&quot;
 34 
 35 using icu::Normalizer2Impl;
 36 

 37 // NFC/NFD data machine-generated by gennorm2 --csource
 38 #define INCLUDED_FROM_NORMALIZER2_CPP
 39 #include &quot;norm2_nfc_data.h&quot;

 40 
 41 U_NAMESPACE_BEGIN
 42 
 43 // Public API dispatch via Normalizer2 subclasses -------------------------- ***
 44 
 45 Normalizer2::~Normalizer2() {}
 46 
 47 void
 48 Normalizer2::normalizeUTF8(uint32_t /*options*/, StringPiece src, ByteSink &amp;sink,
 49                            Edits *edits, UErrorCode &amp;errorCode) const {
 50     if (U_FAILURE(errorCode)) {
 51         return;
 52     }
 53     if (edits != nullptr) {
 54         errorCode = U_UNSUPPORTED_ERROR;
 55         return;
 56     }
 57     UnicodeString src16 = UnicodeString::fromUTF8(src);
 58     normalize(src16, errorCode).toUTF8(sink);
 59 }
</pre>
<hr />
<pre>
159     spanQuickCheckYes(const UnicodeString &amp;s, UErrorCode &amp;) const U_OVERRIDE {
160         return s.length();
161     }
162     virtual UBool hasBoundaryBefore(UChar32) const U_OVERRIDE { return TRUE; }
163     virtual UBool hasBoundaryAfter(UChar32) const U_OVERRIDE { return TRUE; }
164     virtual UBool isInert(UChar32) const U_OVERRIDE { return TRUE; }
165 };
166 
167 NoopNormalizer2::~NoopNormalizer2() {}
168 
169 Normalizer2WithImpl::~Normalizer2WithImpl() {}
170 
171 DecomposeNormalizer2::~DecomposeNormalizer2() {}
172 
173 ComposeNormalizer2::~ComposeNormalizer2() {}
174 
175 FCDNormalizer2::~FCDNormalizer2() {}
176 
177 // instance cache ---------------------------------------------------------- ***
178 






























179 Norm2AllModes::~Norm2AllModes() {
180     delete impl;
181 }
182 
183 Norm2AllModes *
184 Norm2AllModes::createInstance(Normalizer2Impl *impl, UErrorCode &amp;errorCode) {
185     if(U_FAILURE(errorCode)) {
186         delete impl;
187         return NULL;
188     }
189     Norm2AllModes *allModes=new Norm2AllModes(impl);
190     if(allModes==NULL) {
191         errorCode=U_MEMORY_ALLOCATION_ERROR;
192         delete impl;
193         return NULL;
194     }
195     return allModes;
196 }
197 

198 Norm2AllModes *
199 Norm2AllModes::createNFCInstance(UErrorCode &amp;errorCode) {
200     if(U_FAILURE(errorCode)) {
201         return NULL;
202     }
203     Normalizer2Impl *impl=new Normalizer2Impl;
204     if(impl==NULL) {
205         errorCode=U_MEMORY_ALLOCATION_ERROR;
206         return NULL;
207     }
208     impl-&gt;init(norm2_nfc_data_indexes, &amp;norm2_nfc_data_trie,
209                norm2_nfc_data_extraData, norm2_nfc_data_smallFCD);
210     return createInstance(impl, errorCode);
211 }
212 
<span class="line-removed">213 U_CDECL_BEGIN</span>
<span class="line-removed">214 static UBool U_CALLCONV uprv_normalizer2_cleanup();</span>
<span class="line-removed">215 U_CDECL_END</span>
<span class="line-removed">216 </span>
217 static Norm2AllModes *nfcSingleton;
<span class="line-removed">218 static Normalizer2   *noopSingleton;</span>
219 
220 static icu::UInitOnce nfcInitOnce = U_INITONCE_INITIALIZER;
<span class="line-removed">221 static icu::UInitOnce noopInitOnce = U_INITONCE_INITIALIZER;</span>
222 
<span class="line-removed">223 // UInitOnce singleton initialization functions</span>
224 static void U_CALLCONV initNFCSingleton(UErrorCode &amp;errorCode) {
225     nfcSingleton=Norm2AllModes::createNFCInstance(errorCode);
226     ucln_common_registerCleanup(UCLN_COMMON_NORMALIZER2, uprv_normalizer2_cleanup);
227 }
228 
<span class="line-removed">229 static void U_CALLCONV initNoopSingleton(UErrorCode &amp;errorCode) {</span>
<span class="line-removed">230     if(U_FAILURE(errorCode)) {</span>
<span class="line-removed">231         return;</span>
<span class="line-removed">232     }</span>
<span class="line-removed">233     noopSingleton=new NoopNormalizer2;</span>
<span class="line-removed">234     if(noopSingleton==NULL) {</span>
<span class="line-removed">235         errorCode=U_MEMORY_ALLOCATION_ERROR;</span>
<span class="line-removed">236         return;</span>
<span class="line-removed">237     }</span>
<span class="line-removed">238     ucln_common_registerCleanup(UCLN_COMMON_NORMALIZER2, uprv_normalizer2_cleanup);</span>
<span class="line-removed">239 }</span>
<span class="line-removed">240 </span>
<span class="line-removed">241 U_CDECL_BEGIN</span>
<span class="line-removed">242 </span>
<span class="line-removed">243 static UBool U_CALLCONV uprv_normalizer2_cleanup() {</span>
<span class="line-removed">244     delete nfcSingleton;</span>
<span class="line-removed">245     nfcSingleton = NULL;</span>
<span class="line-removed">246     delete noopSingleton;</span>
<span class="line-removed">247     noopSingleton = NULL;</span>
<span class="line-removed">248     nfcInitOnce.reset();</span>
<span class="line-removed">249     noopInitOnce.reset();</span>
<span class="line-removed">250     return TRUE;</span>
<span class="line-removed">251 }</span>
<span class="line-removed">252 </span>
<span class="line-removed">253 U_CDECL_END</span>
<span class="line-removed">254 </span>
255 const Norm2AllModes *
256 Norm2AllModes::getNFCInstance(UErrorCode &amp;errorCode) {
257     if(U_FAILURE(errorCode)) { return NULL; }
258     umtx_initOnce(nfcInitOnce, &amp;initNFCSingleton, errorCode);
259     return nfcSingleton;
260 }
261 
262 const Normalizer2 *
263 Normalizer2::getNFCInstance(UErrorCode &amp;errorCode) {
264     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
265     return allModes!=NULL ? &amp;allModes-&gt;comp : NULL;
266 }
267 
268 const Normalizer2 *
269 Normalizer2::getNFDInstance(UErrorCode &amp;errorCode) {
270     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
271     return allModes!=NULL ? &amp;allModes-&gt;decomp : NULL;
272 }
273 
274 const Normalizer2 *Normalizer2Factory::getFCDInstance(UErrorCode &amp;errorCode) {
275     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
276     return allModes!=NULL ? &amp;allModes-&gt;fcd : NULL;
277 }
278 
279 const Normalizer2 *Normalizer2Factory::getFCCInstance(UErrorCode &amp;errorCode) {
280     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
281     return allModes!=NULL ? &amp;allModes-&gt;fcc : NULL;
282 }
283 
<span class="line-removed">284 const Normalizer2 *Normalizer2Factory::getNoopInstance(UErrorCode &amp;errorCode) {</span>
<span class="line-removed">285     if(U_FAILURE(errorCode)) { return NULL; }</span>
<span class="line-removed">286     umtx_initOnce(noopInitOnce, &amp;initNoopSingleton, errorCode);</span>
<span class="line-removed">287     return noopSingleton;</span>
<span class="line-removed">288 }</span>
<span class="line-removed">289 </span>
290 const Normalizer2Impl *
291 Normalizer2Factory::getNFCImpl(UErrorCode &amp;errorCode) {
292     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
293     return allModes!=NULL ? allModes-&gt;impl : NULL;
294 }

295 
<span class="line-modified">296 const Normalizer2Impl *</span>
<span class="line-modified">297 Normalizer2Factory::getImpl(const Normalizer2 *norm2) {</span>
<span class="line-modified">298     return &amp;((Normalizer2WithImpl *)norm2)-&gt;impl;</span>









299 }
300 


301 U_NAMESPACE_END
302 
303 // C API ------------------------------------------------------------------- ***
304 
305 U_NAMESPACE_USE
306 
307 U_CAPI const UNormalizer2 * U_EXPORT2
308 unorm2_getNFCInstance(UErrorCode *pErrorCode) {
309     return (const UNormalizer2 *)Normalizer2::getNFCInstance(*pErrorCode);
310 }
311 
312 U_CAPI const UNormalizer2 * U_EXPORT2
313 unorm2_getNFDInstance(UErrorCode *pErrorCode) {
314     return (const UNormalizer2 *)Normalizer2::getNFDInstance(*pErrorCode);
315 }
316 
317 U_CAPI void U_EXPORT2
318 unorm2_close(UNormalizer2 *norm2) {
319     delete (Normalizer2 *)norm2;
320 }
</pre>
</td>
<td>
<hr />
<pre>
 17 */
 18 
 19 #include &quot;unicode/utypes.h&quot;
 20 
 21 #if !UCONFIG_NO_NORMALIZATION
 22 
 23 #include &quot;unicode/edits.h&quot;
 24 #include &quot;unicode/normalizer2.h&quot;
 25 #include &quot;unicode/stringoptions.h&quot;
 26 #include &quot;unicode/unistr.h&quot;
 27 #include &quot;unicode/unorm.h&quot;
 28 #include &quot;cstring.h&quot;
 29 #include &quot;mutex.h&quot;
 30 #include &quot;norm2allmodes.h&quot;
 31 #include &quot;normalizer2impl.h&quot;
 32 #include &quot;uassert.h&quot;
 33 #include &quot;ucln_cmn.h&quot;
 34 
 35 using icu::Normalizer2Impl;
 36 
<span class="line-added"> 37 #if NORM2_HARDCODE_NFC_DATA</span>
 38 // NFC/NFD data machine-generated by gennorm2 --csource
 39 #define INCLUDED_FROM_NORMALIZER2_CPP
 40 #include &quot;norm2_nfc_data.h&quot;
<span class="line-added"> 41 #endif</span>
 42 
 43 U_NAMESPACE_BEGIN
 44 
 45 // Public API dispatch via Normalizer2 subclasses -------------------------- ***
 46 
 47 Normalizer2::~Normalizer2() {}
 48 
 49 void
 50 Normalizer2::normalizeUTF8(uint32_t /*options*/, StringPiece src, ByteSink &amp;sink,
 51                            Edits *edits, UErrorCode &amp;errorCode) const {
 52     if (U_FAILURE(errorCode)) {
 53         return;
 54     }
 55     if (edits != nullptr) {
 56         errorCode = U_UNSUPPORTED_ERROR;
 57         return;
 58     }
 59     UnicodeString src16 = UnicodeString::fromUTF8(src);
 60     normalize(src16, errorCode).toUTF8(sink);
 61 }
</pre>
<hr />
<pre>
161     spanQuickCheckYes(const UnicodeString &amp;s, UErrorCode &amp;) const U_OVERRIDE {
162         return s.length();
163     }
164     virtual UBool hasBoundaryBefore(UChar32) const U_OVERRIDE { return TRUE; }
165     virtual UBool hasBoundaryAfter(UChar32) const U_OVERRIDE { return TRUE; }
166     virtual UBool isInert(UChar32) const U_OVERRIDE { return TRUE; }
167 };
168 
169 NoopNormalizer2::~NoopNormalizer2() {}
170 
171 Normalizer2WithImpl::~Normalizer2WithImpl() {}
172 
173 DecomposeNormalizer2::~DecomposeNormalizer2() {}
174 
175 ComposeNormalizer2::~ComposeNormalizer2() {}
176 
177 FCDNormalizer2::~FCDNormalizer2() {}
178 
179 // instance cache ---------------------------------------------------------- ***
180 
<span class="line-added">181 U_CDECL_BEGIN</span>
<span class="line-added">182 static UBool U_CALLCONV uprv_normalizer2_cleanup();</span>
<span class="line-added">183 U_CDECL_END</span>
<span class="line-added">184 </span>
<span class="line-added">185 static Normalizer2   *noopSingleton;</span>
<span class="line-added">186 static icu::UInitOnce noopInitOnce = U_INITONCE_INITIALIZER;</span>
<span class="line-added">187 </span>
<span class="line-added">188 static void U_CALLCONV initNoopSingleton(UErrorCode &amp;errorCode) {</span>
<span class="line-added">189     if(U_FAILURE(errorCode)) {</span>
<span class="line-added">190         return;</span>
<span class="line-added">191     }</span>
<span class="line-added">192     noopSingleton=new NoopNormalizer2;</span>
<span class="line-added">193     if(noopSingleton==NULL) {</span>
<span class="line-added">194         errorCode=U_MEMORY_ALLOCATION_ERROR;</span>
<span class="line-added">195         return;</span>
<span class="line-added">196     }</span>
<span class="line-added">197     ucln_common_registerCleanup(UCLN_COMMON_NORMALIZER2, uprv_normalizer2_cleanup);</span>
<span class="line-added">198 }</span>
<span class="line-added">199 </span>
<span class="line-added">200 const Normalizer2 *Normalizer2Factory::getNoopInstance(UErrorCode &amp;errorCode) {</span>
<span class="line-added">201     if(U_FAILURE(errorCode)) { return NULL; }</span>
<span class="line-added">202     umtx_initOnce(noopInitOnce, &amp;initNoopSingleton, errorCode);</span>
<span class="line-added">203     return noopSingleton;</span>
<span class="line-added">204 }</span>
<span class="line-added">205 </span>
<span class="line-added">206 const Normalizer2Impl *</span>
<span class="line-added">207 Normalizer2Factory::getImpl(const Normalizer2 *norm2) {</span>
<span class="line-added">208     return &amp;((Normalizer2WithImpl *)norm2)-&gt;impl;</span>
<span class="line-added">209 }</span>
<span class="line-added">210 </span>
211 Norm2AllModes::~Norm2AllModes() {
212     delete impl;
213 }
214 
215 Norm2AllModes *
216 Norm2AllModes::createInstance(Normalizer2Impl *impl, UErrorCode &amp;errorCode) {
217     if(U_FAILURE(errorCode)) {
218         delete impl;
219         return NULL;
220     }
221     Norm2AllModes *allModes=new Norm2AllModes(impl);
222     if(allModes==NULL) {
223         errorCode=U_MEMORY_ALLOCATION_ERROR;
224         delete impl;
225         return NULL;
226     }
227     return allModes;
228 }
229 
<span class="line-added">230 #if NORM2_HARDCODE_NFC_DATA</span>
231 Norm2AllModes *
232 Norm2AllModes::createNFCInstance(UErrorCode &amp;errorCode) {
233     if(U_FAILURE(errorCode)) {
234         return NULL;
235     }
236     Normalizer2Impl *impl=new Normalizer2Impl;
237     if(impl==NULL) {
238         errorCode=U_MEMORY_ALLOCATION_ERROR;
239         return NULL;
240     }
241     impl-&gt;init(norm2_nfc_data_indexes, &amp;norm2_nfc_data_trie,
242                norm2_nfc_data_extraData, norm2_nfc_data_smallFCD);
243     return createInstance(impl, errorCode);
244 }
245 




246 static Norm2AllModes *nfcSingleton;

247 
248 static icu::UInitOnce nfcInitOnce = U_INITONCE_INITIALIZER;

249 

250 static void U_CALLCONV initNFCSingleton(UErrorCode &amp;errorCode) {
251     nfcSingleton=Norm2AllModes::createNFCInstance(errorCode);
252     ucln_common_registerCleanup(UCLN_COMMON_NORMALIZER2, uprv_normalizer2_cleanup);
253 }
254 


























255 const Norm2AllModes *
256 Norm2AllModes::getNFCInstance(UErrorCode &amp;errorCode) {
257     if(U_FAILURE(errorCode)) { return NULL; }
258     umtx_initOnce(nfcInitOnce, &amp;initNFCSingleton, errorCode);
259     return nfcSingleton;
260 }
261 
262 const Normalizer2 *
263 Normalizer2::getNFCInstance(UErrorCode &amp;errorCode) {
264     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
265     return allModes!=NULL ? &amp;allModes-&gt;comp : NULL;
266 }
267 
268 const Normalizer2 *
269 Normalizer2::getNFDInstance(UErrorCode &amp;errorCode) {
270     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
271     return allModes!=NULL ? &amp;allModes-&gt;decomp : NULL;
272 }
273 
274 const Normalizer2 *Normalizer2Factory::getFCDInstance(UErrorCode &amp;errorCode) {
275     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
276     return allModes!=NULL ? &amp;allModes-&gt;fcd : NULL;
277 }
278 
279 const Normalizer2 *Normalizer2Factory::getFCCInstance(UErrorCode &amp;errorCode) {
280     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
281     return allModes!=NULL ? &amp;allModes-&gt;fcc : NULL;
282 }
283 






284 const Normalizer2Impl *
285 Normalizer2Factory::getNFCImpl(UErrorCode &amp;errorCode) {
286     const Norm2AllModes *allModes=Norm2AllModes::getNFCInstance(errorCode);
287     return allModes!=NULL ? allModes-&gt;impl : NULL;
288 }
<span class="line-added">289 #endif  // NORM2_HARDCODE_NFC_DATA</span>
290 
<span class="line-modified">291 U_CDECL_BEGIN</span>
<span class="line-modified">292 </span>
<span class="line-modified">293 static UBool U_CALLCONV uprv_normalizer2_cleanup() {</span>
<span class="line-added">294     delete noopSingleton;</span>
<span class="line-added">295     noopSingleton = NULL;</span>
<span class="line-added">296     noopInitOnce.reset();</span>
<span class="line-added">297 #if NORM2_HARDCODE_NFC_DATA</span>
<span class="line-added">298     delete nfcSingleton;</span>
<span class="line-added">299     nfcSingleton = NULL;</span>
<span class="line-added">300     nfcInitOnce.reset();</span>
<span class="line-added">301 #endif</span>
<span class="line-added">302     return TRUE;</span>
303 }
304 
<span class="line-added">305 U_CDECL_END</span>
<span class="line-added">306 </span>
307 U_NAMESPACE_END
308 
309 // C API ------------------------------------------------------------------- ***
310 
311 U_NAMESPACE_USE
312 
313 U_CAPI const UNormalizer2 * U_EXPORT2
314 unorm2_getNFCInstance(UErrorCode *pErrorCode) {
315     return (const UNormalizer2 *)Normalizer2::getNFCInstance(*pErrorCode);
316 }
317 
318 U_CAPI const UNormalizer2 * U_EXPORT2
319 unorm2_getNFDInstance(UErrorCode *pErrorCode) {
320     return (const UNormalizer2 *)Normalizer2::getNFDInstance(*pErrorCode);
321 }
322 
323 U_CAPI void U_EXPORT2
324 unorm2_close(UNormalizer2 *norm2) {
325     delete (Normalizer2 *)norm2;
326 }
</pre>
</td>
</tr>
</table>
<center><a href="norm2_nfc_data.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="normalizer2impl.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>