<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/translit.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="tmutfmt.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="transreg.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/translit.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 89,11 ***</span>
  static const char RB_RULE_BASED_IDS[] = &quot;RuleBasedTransliteratorIDs&quot;;
  
  /**
   * The mutex controlling access to registry object.
   */
<span class="line-modified">! static UMutex registryMutex = U_MUTEX_INITIALIZER;</span>
  
  /**
   * System transliterator registry; non-null when initialized.
   */
  static icu::TransliteratorRegistry* registry = 0;
<span class="line-new-header">--- 89,14 ---</span>
  static const char RB_RULE_BASED_IDS[] = &quot;RuleBasedTransliteratorIDs&quot;;
  
  /**
   * The mutex controlling access to registry object.
   */
<span class="line-modified">! static icu::UMutex *registryMutex() {</span>
<span class="line-added">+     static icu::UMutex m = U_MUTEX_INITIALIZER;</span>
<span class="line-added">+     return &amp;m;</span>
<span class="line-added">+ }</span>
  
  /**
   * System transliterator registry; non-null when initialized.
   */
  static icu::TransliteratorRegistry* registry = 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 976,15 ***</span>
      UParseError pe;
      UErrorCode ec = U_ZERO_ERROR;
      TransliteratorAlias* alias = 0;
      Transliterator* t = 0;
  
<span class="line-modified">!     umtx_lock(&amp;registryMutex);</span>
      if (HAVE_REGISTRY(ec)) {
          t = registry-&gt;get(id, alias, ec);
      }
<span class="line-modified">!     umtx_unlock(&amp;registryMutex);</span>
  
      if (U_FAILURE(ec)) {
          delete t;
          delete alias;
          return 0;
<span class="line-new-header">--- 979,15 ---</span>
      UParseError pe;
      UErrorCode ec = U_ZERO_ERROR;
      TransliteratorAlias* alias = 0;
      Transliterator* t = 0;
  
<span class="line-modified">!     umtx_lock(registryMutex());</span>
      if (HAVE_REGISTRY(ec)) {
          t = registry-&gt;get(id, alias, ec);
      }
<span class="line-modified">!     umtx_unlock(registryMutex());</span>
  
      if (U_FAILURE(ec)) {
          delete t;
          delete alias;
          return 0;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1008,15 ***</span>
              alias-&gt;parse(parser, pe, ec);
              delete alias;
              alias = 0;
  
              // Step 2. reget
<span class="line-modified">!             umtx_lock(&amp;registryMutex);</span>
              if (HAVE_REGISTRY(ec)) {
                  t = registry-&gt;reget(id, parser, alias, ec);
              }
<span class="line-modified">!             umtx_unlock(&amp;registryMutex);</span>
  
              // Step 3. Loop back around!
          } else {
              t = alias-&gt;create(pe, ec);
              delete alias;
<span class="line-new-header">--- 1011,15 ---</span>
              alias-&gt;parse(parser, pe, ec);
              delete alias;
              alias = 0;
  
              // Step 2. reget
<span class="line-modified">!             umtx_lock(registryMutex());</span>
              if (HAVE_REGISTRY(ec)) {
                  t = registry-&gt;reget(id, parser, alias, ec);
              }
<span class="line-modified">!             umtx_unlock(registryMutex());</span>
  
              // Step 3. Loop back around!
          } else {
              t = alias-&gt;create(pe, ec);
              delete alias;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1210,11 ***</span>
  
  // For public consumption
  void U_EXPORT2 Transliterator::registerFactory(const UnicodeString&amp; id,
                                       Transliterator::Factory factory,
                                       Transliterator::Token context) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _registerFactory(id, factory, context);
      }
  }
<span class="line-new-header">--- 1213,11 ---</span>
  
  // For public consumption
  void U_EXPORT2 Transliterator::registerFactory(const UnicodeString&amp; id,
                                       Transliterator::Factory factory,
                                       Transliterator::Token context) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _registerFactory(id, factory, context);
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1249,11 ***</span>
   * &lt;code&gt;Transliterator&lt;/code&gt; that defines &lt;tt&gt;clone()&lt;/tt&gt;
   * @see #getInstance
   * @see #unregister
   */
  void U_EXPORT2 Transliterator::registerInstance(Transliterator* adoptedPrototype) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _registerInstance(adoptedPrototype);
      }
  }
<span class="line-new-header">--- 1252,11 ---</span>
   * &lt;code&gt;Transliterator&lt;/code&gt; that defines &lt;tt&gt;clone()&lt;/tt&gt;
   * @see #getInstance
   * @see #unregister
   */
  void U_EXPORT2 Transliterator::registerInstance(Transliterator* adoptedPrototype) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _registerInstance(adoptedPrototype);
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1263,11 ***</span>
      registry-&gt;put(adoptedPrototype, TRUE, ec);
  }
  
  void U_EXPORT2 Transliterator::registerAlias(const UnicodeString&amp; aliasID,
                                               const UnicodeString&amp; realID) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _registerAlias(aliasID, realID);
      }
  }
<span class="line-new-header">--- 1266,11 ---</span>
      registry-&gt;put(adoptedPrototype, TRUE, ec);
  }
  
  void U_EXPORT2 Transliterator::registerAlias(const UnicodeString&amp; aliasID,
                                               const UnicodeString&amp; realID) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _registerAlias(aliasID, realID);
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1285,11 ***</span>
   * @param ID the ID of the transliterator or class
   * @see #registerInstance
  
   */
  void U_EXPORT2 Transliterator::unregister(const UnicodeString&amp; ID) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          registry-&gt;remove(ID);
      }
  }
<span class="line-new-header">--- 1288,11 ---</span>
   * @param ID the ID of the transliterator or class
   * @see #registerInstance
  
   */
  void U_EXPORT2 Transliterator::unregister(const UnicodeString&amp; ID) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          registry-&gt;remove(ID);
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1300,11 ***</span>
   * To retrieve the actual IDs, call getAvailableID(i) with
   * i from 0 to countAvailableIDs() - 1.
   */
  int32_t U_EXPORT2 Transliterator::countAvailableIDs(void) {
      int32_t retVal = 0;
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          retVal = registry-&gt;countAvailableIDs();
      }
      return retVal;
<span class="line-new-header">--- 1303,11 ---</span>
   * To retrieve the actual IDs, call getAvailableID(i) with
   * i from 0 to countAvailableIDs() - 1.
   */
  int32_t U_EXPORT2 Transliterator::countAvailableIDs(void) {
      int32_t retVal = 0;
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          retVal = registry-&gt;countAvailableIDs();
      }
      return retVal;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1316,79 ***</span>
   * and countAvailableIDs() - 1, inclusive.  If index is out of
   * range, the result of getAvailableID(0) is returned.
   */
  const UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableID(int32_t index) {
      const UnicodeString* result = NULL;
<span class="line-modified">!     umtx_lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          result = &amp;registry-&gt;getAvailableID(index);
      }
<span class="line-modified">!     umtx_unlock(&amp;registryMutex);</span>
      U_ASSERT(result != NULL); // fail if no registry
      return *result;
  }
  
  StringEnumeration* U_EXPORT2 Transliterator::getAvailableIDs(UErrorCode&amp; ec) {
      if (U_FAILURE(ec)) return NULL;
      StringEnumeration* result = NULL;
<span class="line-modified">!     umtx_lock(&amp;registryMutex);</span>
      if (HAVE_REGISTRY(ec)) {
          result = registry-&gt;getAvailableIDs();
      }
<span class="line-modified">!     umtx_unlock(&amp;registryMutex);</span>
      if (result == NULL) {
          ec = U_INTERNAL_TRANSLITERATOR_ERROR;
      }
      return result;
  }
  
  int32_t U_EXPORT2 Transliterator::countAvailableSources(void) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      return HAVE_REGISTRY(ec) ? _countAvailableSources() : 0;
  }
  
  UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableSource(int32_t index,
                                                    UnicodeString&amp; result) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _getAvailableSource(index, result);
      }
      return result;
  }
  
  int32_t U_EXPORT2 Transliterator::countAvailableTargets(const UnicodeString&amp; source) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      return HAVE_REGISTRY(ec) ? _countAvailableTargets(source) : 0;
  }
  
  UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableTarget(int32_t index,
                                                    const UnicodeString&amp; source,
                                                    UnicodeString&amp; result) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _getAvailableTarget(index, source, result);
      }
      return result;
  }
  
  int32_t U_EXPORT2 Transliterator::countAvailableVariants(const UnicodeString&amp; source,
                                                 const UnicodeString&amp; target) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      return HAVE_REGISTRY(ec) ? _countAvailableVariants(source, target) : 0;
  }
  
  UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableVariant(int32_t index,
                                                     const UnicodeString&amp; source,
                                                     const UnicodeString&amp; target,
                                                     UnicodeString&amp; result) {
<span class="line-modified">!     Mutex lock(&amp;registryMutex);</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _getAvailableVariant(index, source, target, result);
      }
      return result;
<span class="line-new-header">--- 1319,79 ---</span>
   * and countAvailableIDs() - 1, inclusive.  If index is out of
   * range, the result of getAvailableID(0) is returned.
   */
  const UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableID(int32_t index) {
      const UnicodeString* result = NULL;
<span class="line-modified">!     umtx_lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          result = &amp;registry-&gt;getAvailableID(index);
      }
<span class="line-modified">!     umtx_unlock(registryMutex());</span>
      U_ASSERT(result != NULL); // fail if no registry
      return *result;
  }
  
  StringEnumeration* U_EXPORT2 Transliterator::getAvailableIDs(UErrorCode&amp; ec) {
      if (U_FAILURE(ec)) return NULL;
      StringEnumeration* result = NULL;
<span class="line-modified">!     umtx_lock(registryMutex());</span>
      if (HAVE_REGISTRY(ec)) {
          result = registry-&gt;getAvailableIDs();
      }
<span class="line-modified">!     umtx_unlock(registryMutex());</span>
      if (result == NULL) {
          ec = U_INTERNAL_TRANSLITERATOR_ERROR;
      }
      return result;
  }
  
  int32_t U_EXPORT2 Transliterator::countAvailableSources(void) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      return HAVE_REGISTRY(ec) ? _countAvailableSources() : 0;
  }
  
  UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableSource(int32_t index,
                                                    UnicodeString&amp; result) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _getAvailableSource(index, result);
      }
      return result;
  }
  
  int32_t U_EXPORT2 Transliterator::countAvailableTargets(const UnicodeString&amp; source) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      return HAVE_REGISTRY(ec) ? _countAvailableTargets(source) : 0;
  }
  
  UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableTarget(int32_t index,
                                                    const UnicodeString&amp; source,
                                                    UnicodeString&amp; result) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _getAvailableTarget(index, source, result);
      }
      return result;
  }
  
  int32_t U_EXPORT2 Transliterator::countAvailableVariants(const UnicodeString&amp; source,
                                                 const UnicodeString&amp; target) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      return HAVE_REGISTRY(ec) ? _countAvailableVariants(source, target) : 0;
  }
  
  UnicodeString&amp; U_EXPORT2 Transliterator::getAvailableVariant(int32_t index,
                                                     const UnicodeString&amp; source,
                                                     const UnicodeString&amp; target,
                                                     UnicodeString&amp; result) {
<span class="line-modified">!     Mutex lock(registryMutex());</span>
      UErrorCode ec = U_ZERO_ERROR;
      if (HAVE_REGISTRY(ec)) {
          _getAvailableVariant(index, source, target, result);
      }
      return result;
</pre>
<center><a href="tmutfmt.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="transreg.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>