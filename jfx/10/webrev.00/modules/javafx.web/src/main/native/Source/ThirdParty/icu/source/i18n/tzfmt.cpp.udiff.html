<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/tzfmt.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="tridpars.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="tzgnames.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/tzfmt.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -145,11 +145,14 @@</span>
  static icu::UInitOnce gZoneIdTrieInitOnce = U_INITONCE_INITIALIZER;
  
  static TextTrieMap *gShortZoneIdTrie = NULL;
  static icu::UInitOnce gShortZoneIdTrieInitOnce = U_INITONCE_INITIALIZER;
  
<span class="udiff-line-modified-removed">- static UMutex gLock = U_MUTEX_INITIALIZER;</span>
<span class="udiff-line-modified-added">+ static UMutex *gLock() {</span>
<span class="udiff-line-added">+     static UMutex m = U_MUTEX_INITIALIZER;</span>
<span class="udiff-line-added">+     return &amp;m;</span>
<span class="udiff-line-added">+ }</span>
  
  U_CDECL_BEGIN
  /**
   * Cleanup callback func
   */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -265,11 +268,11 @@</span>
          return (width == 1 || width == 2);
      case MINUTE:
      case SECOND:
          return (width == 2);
      default:
<span class="udiff-line-modified-removed">-         U_ASSERT(FALSE);</span>
<span class="udiff-line-modified-added">+         UPRV_UNREACHABLE;</span>
      }
      return (width &gt; 0);
  }
  
  GMTOffsetField::FieldType
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -587,12 +590,11 @@</span>
      case UTZFMT_PAT_POSITIVE_HMS:
      case UTZFMT_PAT_NEGATIVE_HMS:
          required = FIELDS_HMS;
          break;
      default:
<span class="udiff-line-modified-removed">-         U_ASSERT(FALSE);</span>
<span class="udiff-line-removed">-         break;</span>
<span class="udiff-line-modified-added">+         UPRV_UNREACHABLE;</span>
      }
  
      UVector* patternItems = parseOffsetPattern(pattern, required, status);
      if (patternItems == NULL) {
          return;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1026,11 +1028,11 @@</span>
              case UTZFMT_STYLE_GENERIC_SHORT:
                  genericNameTypes = UTZGNM_SHORT | UTZGNM_LOCATION;
                  break;
  
              default:
<span class="udiff-line-modified-removed">-                 U_ASSERT(FALSE);</span>
<span class="udiff-line-modified-added">+                 UPRV_UNREACHABLE;</span>
              }
  
              int32_t len = 0;
              UTimeZoneFormatTimeType tt = UTZFMT_TIME_TYPE_UNKNOWN;
              const TimeZoneGenericNames *gnames = getTimeZoneGenericNames(status);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1381,37 +1383,37 @@</span>
  TimeZoneFormat::getTimeZoneGenericNames(UErrorCode&amp; status) const {
      if (U_FAILURE(status)) {
          return NULL;
      }
  
<span class="udiff-line-modified-removed">-     umtx_lock(&amp;gLock);</span>
<span class="udiff-line-modified-added">+     umtx_lock(gLock());</span>
      if (fTimeZoneGenericNames == NULL) {
          TimeZoneFormat *nonConstThis = const_cast&lt;TimeZoneFormat *&gt;(this);
          nonConstThis-&gt;fTimeZoneGenericNames = TimeZoneGenericNames::createInstance(fLocale, status);
      }
<span class="udiff-line-modified-removed">-     umtx_unlock(&amp;gLock);</span>
<span class="udiff-line-modified-added">+     umtx_unlock(gLock());</span>
  
      return fTimeZoneGenericNames;
  }
  
  const TZDBTimeZoneNames*
  TimeZoneFormat::getTZDBTimeZoneNames(UErrorCode&amp; status) const {
      if (U_FAILURE(status)) {
          return NULL;
      }
  
<span class="udiff-line-modified-removed">-     umtx_lock(&amp;gLock);</span>
<span class="udiff-line-modified-added">+     umtx_lock(gLock());</span>
      if (fTZDBTimeZoneNames == NULL) {
          TZDBTimeZoneNames *tzdbNames = new TZDBTimeZoneNames(fLocale);
          if (tzdbNames == NULL) {
              status = U_MEMORY_ALLOCATION_ERROR;
          } else {
              TimeZoneFormat *nonConstThis = const_cast&lt;TimeZoneFormat *&gt;(this);
              nonConstThis-&gt;fTZDBTimeZoneNames = tzdbNames;
          }
      }
<span class="udiff-line-modified-removed">-     umtx_unlock(&amp;gLock);</span>
<span class="udiff-line-modified-added">+     umtx_unlock(gLock());</span>
  
      return fTZDBTimeZoneNames;
  }
  
  UnicodeString&amp;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2646,16 +2648,16 @@</span>
      for (int32_t type = 0; type &lt; UTZFMT_PAT_COUNT; type++) {
          UBool afterH = FALSE;
          UVector *items = fGMTOffsetPatternItems[type];
          for (int32_t i = 0; i &lt; items-&gt;size(); i++) {
              const GMTOffsetField* item = (GMTOffsetField*)items-&gt;elementAt(i);
<span class="udiff-line-modified-removed">-             GMTOffsetField::FieldType type = item-&gt;getType();</span>
<span class="udiff-line-modified-removed">-             if (type != GMTOffsetField::TEXT) {</span>
<span class="udiff-line-modified-added">+             GMTOffsetField::FieldType fieldType = item-&gt;getType();</span>
<span class="udiff-line-modified-added">+             if (fieldType != GMTOffsetField::TEXT) {</span>
                  if (afterH) {
                      fAbuttingOffsetHoursAndMinutes = TRUE;
                      break;
<span class="udiff-line-modified-removed">-                 } else if (type == GMTOffsetField::HOUR) {</span>
<span class="udiff-line-modified-added">+                 } else if (fieldType == GMTOffsetField::HOUR) {</span>
                      afterH = TRUE;
                  }
              } else if (afterH) {
                  break;
              }
</pre>
<center><a href="tridpars.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="tzgnames.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>