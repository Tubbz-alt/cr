<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/number_modifiers.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 // Â© 2017 and later: Unicode, Inc. and others.
  2 // License &amp; terms of use: http://www.unicode.org/copyright.html
  3 
  4 #include &quot;unicode/utypes.h&quot;
  5 
  6 #if !UCONFIG_NO_FORMATTING
  7 #ifndef __NUMBER_MODIFIERS_H__
  8 #define __NUMBER_MODIFIERS_H__
  9 
 10 #include &lt;algorithm&gt;
 11 #include &lt;cstdint&gt;
 12 #include &quot;unicode/uniset.h&quot;
 13 #include &quot;unicode/simpleformatter.h&quot;
 14 #include &quot;standardplural.h&quot;
 15 #include &quot;number_stringbuilder.h&quot;
 16 #include &quot;number_types.h&quot;
 17 
 18 U_NAMESPACE_BEGIN namespace number {
 19 namespace impl {
 20 
 21 /**
 22  * The canonical implementation of {@link Modifier}, containing a prefix and suffix string.
 23  * TODO: This is not currently being used by real code and could be removed.
 24  */
 25 class U_I18N_API ConstantAffixModifier : public Modifier, public UObject {
 26   public:
 27     ConstantAffixModifier(const UnicodeString &amp;prefix, const UnicodeString &amp;suffix, Field field,
 28                           bool strong)
 29             : fPrefix(prefix), fSuffix(suffix), fField(field), fStrong(strong) {}
 30 
 31     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
 32                   UErrorCode &amp;status) const U_OVERRIDE;
 33 
<a name="1" id="anc1"></a><span class="line-modified"> 34     int32_t getPrefixLength(UErrorCode &amp;status) const U_OVERRIDE;</span>
 35 
<a name="2" id="anc2"></a><span class="line-modified"> 36     int32_t getCodePointCount(UErrorCode &amp;status) const U_OVERRIDE;</span>
 37 
 38     bool isStrong() const U_OVERRIDE;
 39 
<a name="3" id="anc3"></a>





 40   private:
 41     UnicodeString fPrefix;
 42     UnicodeString fSuffix;
 43     Field fField;
 44     bool fStrong;
 45 };
 46 
 47 /**
 48  * The second primary implementation of {@link Modifier}, this one consuming a {@link SimpleFormatter}
 49  * pattern.
 50  */
 51 class U_I18N_API SimpleModifier : public Modifier, public UMemory {
 52   public:
 53     SimpleModifier(const SimpleFormatter &amp;simpleFormatter, Field field, bool strong);
 54 
<a name="4" id="anc4"></a>


 55     // Default constructor for LongNameHandler.h
 56     SimpleModifier();
 57 
 58     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
 59                   UErrorCode &amp;status) const U_OVERRIDE;
 60 
<a name="5" id="anc5"></a><span class="line-modified"> 61     int32_t getPrefixLength(UErrorCode &amp;status) const U_OVERRIDE;</span>
 62 
<a name="6" id="anc6"></a><span class="line-modified"> 63     int32_t getCodePointCount(UErrorCode &amp;status) const U_OVERRIDE;</span>
 64 
 65     bool isStrong() const U_OVERRIDE;
 66 
<a name="7" id="anc7"></a>





 67     /**
 68      * TODO: This belongs in SimpleFormatterImpl. The only reason I haven&#39;t moved it there yet is because
<a name="8" id="anc8"></a><span class="line-modified"> 69      * DoubleSidedStringBuilder is an internal class and SimpleFormatterImpl feels like it should not depend on it.</span>
 70      *
 71      * &lt;p&gt;
 72      * Formats a value that is already stored inside the StringBuilder &lt;code&gt;result&lt;/code&gt; between the indices
 73      * &lt;code&gt;startIndex&lt;/code&gt; and &lt;code&gt;endIndex&lt;/code&gt; by inserting characters before the start index and after the
 74      * end index.
 75      *
 76      * &lt;p&gt;
 77      * This is well-defined only for patterns with exactly one argument.
 78      *
 79      * @param result
 80      *            The StringBuilder containing the value argument.
 81      * @param startIndex
 82      *            The left index of the value within the string builder.
 83      * @param endIndex
 84      *            The right index of the value within the string builder.
 85      * @return The number of characters (UTF-16 code points) that were added to the StringBuilder.
 86      */
 87     int32_t
<a name="9" id="anc9"></a><span class="line-modified"> 88     formatAsPrefixSuffix(NumberStringBuilder &amp;result, int32_t startIndex, int32_t endIndex, Field field,</span>
<span class="line-modified"> 89                          UErrorCode &amp;status) const;</span>
















 90 
 91   private:
 92     UnicodeString fCompiledPattern;
 93     Field fField;
<a name="10" id="anc10"></a><span class="line-modified"> 94     bool fStrong;</span>
<span class="line-modified"> 95     int32_t fPrefixLength;</span>
<span class="line-modified"> 96     int32_t fSuffixOffset;</span>
<span class="line-modified"> 97     int32_t fSuffixLength;</span>

 98 };
 99 
100 /**
101  * An implementation of {@link Modifier} that allows for multiple types of fields in the same modifier. Constructed
102  * based on the contents of two {@link NumberStringBuilder} instances (one for the prefix, one for the suffix).
103  */
104 class U_I18N_API ConstantMultiFieldModifier : public Modifier, public UMemory {
105   public:
<a name="11" id="anc11"></a>











106     ConstantMultiFieldModifier(
107             const NumberStringBuilder &amp;prefix,
108             const NumberStringBuilder &amp;suffix,
109             bool overwrite,
110             bool strong)
111       : fPrefix(prefix),
112         fSuffix(suffix),
113         fOverwrite(overwrite),
114         fStrong(strong) {}
115 
116     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
117                   UErrorCode &amp;status) const U_OVERRIDE;
118 
<a name="12" id="anc12"></a><span class="line-modified">119     int32_t getPrefixLength(UErrorCode &amp;status) const U_OVERRIDE;</span>
120 
<a name="13" id="anc13"></a><span class="line-modified">121     int32_t getCodePointCount(UErrorCode &amp;status) const U_OVERRIDE;</span>
122 
123     bool isStrong() const U_OVERRIDE;
124 
<a name="14" id="anc14"></a>





125   protected:
126     // NOTE: In Java, these are stored as array pointers. In C++, the NumberStringBuilder is stored by
127     // value and is treated internally as immutable.
128     NumberStringBuilder fPrefix;
129     NumberStringBuilder fSuffix;
130     bool fOverwrite;
131     bool fStrong;
<a name="15" id="anc15"></a>
132 };
133 
134 /** Identical to {@link ConstantMultiFieldModifier}, but supports currency spacing. */
135 class U_I18N_API CurrencySpacingEnabledModifier : public ConstantMultiFieldModifier {
136   public:
137     /** Safe code path */
138     CurrencySpacingEnabledModifier(
139             const NumberStringBuilder &amp;prefix,
140             const NumberStringBuilder &amp;suffix,
141             bool overwrite,
142             bool strong,
143             const DecimalFormatSymbols &amp;symbols,
144             UErrorCode &amp;status);
145 
146     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
147                   UErrorCode &amp;status) const U_OVERRIDE;
148 
149     /** Unsafe code path */
150     static int32_t
151     applyCurrencySpacing(NumberStringBuilder &amp;output, int32_t prefixStart, int32_t prefixLen,
152                          int32_t suffixStart, int32_t suffixLen, const DecimalFormatSymbols &amp;symbols,
153                          UErrorCode &amp;status);
154 
155   private:
156     UnicodeSet fAfterPrefixUnicodeSet;
157     UnicodeString fAfterPrefixInsert;
158     UnicodeSet fBeforeSuffixUnicodeSet;
159     UnicodeString fBeforeSuffixInsert;
160 
161     enum EAffix {
162         PREFIX, SUFFIX
163     };
164 
165     enum EPosition {
166         IN_CURRENCY, IN_NUMBER
167     };
168 
169     /** Unsafe code path */
170     static int32_t applyCurrencySpacingAffix(NumberStringBuilder &amp;output, int32_t index, EAffix affix,
171                                              const DecimalFormatSymbols &amp;symbols, UErrorCode &amp;status);
172 
173     static UnicodeSet
174     getUnicodeSet(const DecimalFormatSymbols &amp;symbols, EPosition position, EAffix affix,
175                   UErrorCode &amp;status);
176 
177     static UnicodeString
178     getInsertString(const DecimalFormatSymbols &amp;symbols, EAffix affix, UErrorCode &amp;status);
179 };
180 
181 /** A Modifier that does not do anything. */
182 class U_I18N_API EmptyModifier : public Modifier, public UMemory {
183   public:
184     explicit EmptyModifier(bool isStrong) : fStrong(isStrong) {}
185 
186     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
187                   UErrorCode &amp;status) const U_OVERRIDE {
188         (void)output;
189         (void)leftIndex;
190         (void)rightIndex;
191         (void)status;
192         return 0;
193     }
194 
<a name="16" id="anc16"></a><span class="line-modified">195     int32_t getPrefixLength(UErrorCode &amp;status) const U_OVERRIDE {</span>
<span class="line-removed">196         (void)status;</span>
197         return 0;
198     }
199 
<a name="17" id="anc17"></a><span class="line-modified">200     int32_t getCodePointCount(UErrorCode &amp;status) const U_OVERRIDE {</span>
<span class="line-removed">201         (void)status;</span>
202         return 0;
203     }
204 
205     bool isStrong() const U_OVERRIDE {
206         return fStrong;
207     }
208 
<a name="18" id="anc18"></a>












209   private:
210     bool fStrong;
211 };
212 
213 /**
<a name="19" id="anc19"></a><span class="line-modified">214  * A ParameterizedModifier by itself is NOT a Modifier. Rather, it wraps a data structure containing two or more</span>
<span class="line-removed">215  * Modifiers and returns the modifier appropriate for the current situation.</span>
216  */
<a name="20" id="anc20"></a><span class="line-modified">217 class U_I18N_API ParameterizedModifier : public UMemory {</span>
218   public:
<a name="21" id="anc21"></a><span class="line-modified">219     // NOTE: mods is zero-initialized (to nullptr)</span>
<span class="line-removed">220     ParameterizedModifier() : mods() {</span>
<span class="line-removed">221     }</span>
222 
<a name="22" id="anc22"></a><span class="line-modified">223     // No copying!</span>
<span class="line-removed">224     ParameterizedModifier(const ParameterizedModifier &amp;other) = delete;</span>
225 
<a name="23" id="anc23"></a><span class="line-modified">226     ~ParameterizedModifier() {</span>
<span class="line-removed">227         for (const Modifier *mod : mods) {</span>
<span class="line-removed">228             delete mod;</span>
<span class="line-removed">229         }</span>
<span class="line-removed">230     }</span>
231 
<a name="24" id="anc24"></a><span class="line-modified">232     void adoptPositiveNegativeModifiers(</span>
<span class="line-modified">233             const Modifier *positive, const Modifier *zero, const Modifier *negative) {</span>
<span class="line-removed">234         mods[2] = positive;</span>
<span class="line-removed">235         mods[1] = zero;</span>
<span class="line-removed">236         mods[0] = negative;</span>
<span class="line-removed">237     }</span>
238 
<a name="25" id="anc25"></a><span class="line-modified">239     /** The modifier is ADOPTED. */</span>
<span class="line-modified">240     void adoptSignPluralModifier(int8_t signum, StandardPlural::Form plural, const Modifier *mod) {</span>



241         mods[getModIndex(signum, plural)] = mod;
242     }
243 
<a name="26" id="anc26"></a>








244     /** Returns a reference to the modifier; no ownership change. */
<a name="27" id="anc27"></a><span class="line-modified">245     const Modifier *getModifier(int8_t signum) const {</span>
<span class="line-modified">246         return mods[signum + 1];</span>




247     }
248 
249     /** Returns a reference to the modifier; no ownership change. */
<a name="28" id="anc28"></a><span class="line-modified">250     const Modifier *getModifier(int8_t signum, StandardPlural::Form plural) const {</span>
<span class="line-modified">251         return mods[getModIndex(signum, plural)];</span>
252     }
253 
254   private:
<a name="29" id="anc29"></a><span class="line-modified">255     const Modifier *mods[3 * StandardPlural::COUNT];</span>

256 
257     inline static int32_t getModIndex(int8_t signum, StandardPlural::Form plural) {
<a name="30" id="anc30"></a>

258         return static_cast&lt;int32_t&gt;(plural) * 3 + (signum + 1);
259     }
260 };
261 
262 } // namespace impl
263 } // namespace number
264 U_NAMESPACE_END
265 
266 
267 #endif //__NUMBER_MODIFIERS_H__
268 
269 #endif /* #if !UCONFIG_NO_FORMATTING */
<a name="31" id="anc31"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="31" type="hidden" />
</body>
</html>