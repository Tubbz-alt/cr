<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/number_patternmodifier.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 // © 2017 and later: Unicode, Inc. and others.
  2 // License &amp; terms of use: http://www.unicode.org/copyright.html
  3 
  4 #include &quot;unicode/utypes.h&quot;
  5 
  6 #if !UCONFIG_NO_FORMATTING
  7 #ifndef __NUMBER_PATTERNMODIFIER_H__
  8 #define __NUMBER_PATTERNMODIFIER_H__
  9 
 10 #include &quot;standardplural.h&quot;
 11 #include &quot;unicode/numberformatter.h&quot;
 12 #include &quot;number_patternstring.h&quot;
 13 #include &quot;number_types.h&quot;
 14 #include &quot;number_modifiers.h&quot;
 15 #include &quot;number_utils.h&quot;
 16 #include &quot;number_currencysymbols.h&quot;
 17 
 18 U_NAMESPACE_BEGIN
 19 
 20 // Export an explicit template instantiation of the LocalPointer that is used as a
<a name="1" id="anc1"></a><span class="line-modified"> 21 // data member of AdoptingModifierStore.</span>
 22 // (When building DLLs for Windows this is required.)
 23 #if U_PF_WINDOWS &lt;= U_PLATFORM &amp;&amp; U_PLATFORM &lt;= U_PF_CYGWIN
<a name="2" id="anc2"></a><span class="line-added"> 24 #if defined(_MSC_VER)</span>
 25 // Ignore warning 4661 as LocalPointerBase does not use operator== or operator!=
<a name="3" id="anc3"></a><span class="line-modified"> 26 #pragma warning(push)</span>
<span class="line-modified"> 27 #pragma warning(disable : 4661)</span>
<span class="line-modified"> 28 #endif</span>
<span class="line-added"> 29 template class U_I18N_API LocalPointerBase&lt;number::impl::AdoptingModifierStore&gt;;</span>
<span class="line-added"> 30 template class U_I18N_API LocalPointer&lt;number::impl::AdoptingModifierStore&gt;;</span>
<span class="line-added"> 31 #if defined(_MSC_VER)</span>
<span class="line-added"> 32 #pragma warning(pop)</span>
<span class="line-added"> 33 #endif</span>
 34 #endif
 35 
 36 namespace number {
 37 namespace impl {
 38 
 39 // Forward declaration
 40 class MutablePatternModifier;
 41 
 42 // Exported as U_I18N_API because it is needed for the unit test PatternModifierTest
 43 class U_I18N_API ImmutablePatternModifier : public MicroPropsGenerator, public UMemory {
 44   public:
 45     ~ImmutablePatternModifier() U_OVERRIDE = default;
 46 
 47     void processQuantity(DecimalQuantity&amp;, MicroProps&amp; micros, UErrorCode&amp; status) const U_OVERRIDE;
 48 
<a name="4" id="anc4"></a><span class="line-modified"> 49     void applyToMicros(MicroProps&amp; micros, const DecimalQuantity&amp; quantity, UErrorCode&amp; status) const;</span>
 50 
 51     const Modifier* getModifier(int8_t signum, StandardPlural::Form plural) const;
 52 
 53   private:
<a name="5" id="anc5"></a><span class="line-modified"> 54     ImmutablePatternModifier(AdoptingModifierStore* pm, const PluralRules* rules,</span>
 55                              const MicroPropsGenerator* parent);
 56 
<a name="6" id="anc6"></a><span class="line-modified"> 57     const LocalPointer&lt;AdoptingModifierStore&gt; pm;</span>
 58     const PluralRules* rules;
 59     const MicroPropsGenerator* parent;
 60 
 61     friend class MutablePatternModifier;
 62 };
 63 
 64 /**
 65  * This class is a {@link Modifier} that wraps a decimal format pattern. It applies the pattern&#39;s affixes in
 66  * {@link Modifier#apply}.
 67  *
 68  * &lt;p&gt;
 69  * In addition to being a Modifier, this class contains the business logic for substituting the correct locale symbols
 70  * into the affixes of the decimal format pattern.
 71  *
 72  * &lt;p&gt;
 73  * In order to use this class, create a new instance and call the following four setters: {@link #setPatternInfo},
 74  * {@link #setPatternAttributes}, {@link #setSymbols}, and {@link #setNumberProperties}. After calling these four
 75  * setters, the instance will be ready for use as a Modifier.
 76  *
 77  * &lt;p&gt;
 78  * This is a MUTABLE, NON-THREAD-SAFE class designed for performance. Do NOT save references to this or attempt to use
 79  * it from multiple threads! Instead, you can obtain a safe, immutable decimal format pattern modifier by calling
 80  * {@link MutablePatternModifier#createImmutable}, in effect treating this instance as a builder for the immutable
 81  * variant.
 82  */
 83 class U_I18N_API MutablePatternModifier
 84         : public MicroPropsGenerator,
 85           public Modifier,
 86           public SymbolProvider,
 87           public UMemory {
 88   public:
 89 
 90     ~MutablePatternModifier() U_OVERRIDE = default;
 91 
 92     /**
 93      * @param isStrong
 94      *            Whether the modifier should be considered strong. For more information, see
 95      *            {@link Modifier#isStrong()}. Most of the time, decimal format pattern modifiers should be considered
 96      *            as non-strong.
 97      */
 98     explicit MutablePatternModifier(bool isStrong);
 99 
100     /**
101      * Sets a reference to the parsed decimal format pattern, usually obtained from
102      * {@link PatternStringParser#parseToPatternInfo(String)}, but any implementation of {@link AffixPatternProvider} is
103      * accepted.
<a name="7" id="anc7"></a><span class="line-added">104      *</span>
<span class="line-added">105      * @param field</span>
<span class="line-added">106      *            Which field to use for literal characters in the pattern.</span>
107      */
<a name="8" id="anc8"></a><span class="line-modified">108     void setPatternInfo(const AffixPatternProvider *patternInfo, Field field);</span>
109 
110     /**
111      * Sets attributes that imply changes to the literal interpretation of the pattern string affixes.
112      *
113      * @param signDisplay
114      *            Whether to force a plus sign on positive numbers.
115      * @param perMille
116      *            Whether to substitute the percent sign in the pattern with a permille sign.
117      */
118     void setPatternAttributes(UNumberSignDisplay signDisplay, bool perMille);
119 
120     /**
121      * Sets locale-specific details that affect the symbols substituted into the pattern string affixes.
122      *
123      * @param symbols
124      *            The desired instance of DecimalFormatSymbols.
125      * @param currencySymbols
126      *            The currency symbols to be used when substituting currency values into the affixes.
127      * @param unitWidth
128      *            The width used to render currencies.
129      * @param rules
130      *            Required if the triple currency sign, &quot;¤¤¤&quot;, appears in the pattern, which can be determined from the
131      *            convenience method {@link #needsPlurals()}.
132      */
133     void setSymbols(const DecimalFormatSymbols* symbols, const CurrencySymbols* currencySymbols,
134                     UNumberUnitWidth unitWidth, const PluralRules* rules);
135 
136     /**
137      * Sets attributes of the current number being processed.
138      *
139      * @param signum
140      *            -1 if negative; +1 if positive; or 0 if zero.
141      * @param plural
142      *            The plural form of the number, required only if the pattern contains the triple
143      *            currency sign, &quot;¤¤¤&quot; (and as indicated by {@link #needsPlurals()}).
144      */
145     void setNumberProperties(int8_t signum, StandardPlural::Form plural);
146 
147     /**
148      * Returns true if the pattern represented by this MurkyModifier requires a plural keyword in order to localize.
149      * This is currently true only if there is a currency long name placeholder in the pattern (&quot;¤¤¤&quot;).
150      */
151     bool needsPlurals() const;
152 
153     /**
154      * Creates a new quantity-dependent Modifier that behaves the same as the current instance, but which is immutable
155      * and can be saved for future use. The number properties in the current instance are mutated; all other properties
156      * are left untouched.
157      *
158      * &lt;p&gt;
159      * The resulting modifier cannot be used in a QuantityChain.
160      *
161      * &lt;p&gt;
162      * CREATES A NEW HEAP OBJECT; THE CALLER GETS OWNERSHIP.
163      *
164      * @return An immutable that supports both positive and negative numbers.
165      */
166     ImmutablePatternModifier *createImmutable(UErrorCode &amp;status);
167 
168     /**
169      * Creates a new quantity-dependent Modifier that behaves the same as the current instance, but which is immutable
170      * and can be saved for future use. The number properties in the current instance are mutated; all other properties
171      * are left untouched.
172      *
173      * &lt;p&gt;
174      * CREATES A NEW HEAP OBJECT; THE CALLER GETS OWNERSHIP.
175      *
176      * @param parent
177      *            The QuantityChain to which to chain this immutable.
178      * @return An immutable that supports both positive and negative numbers.
179      */
180     ImmutablePatternModifier *
181     createImmutableAndChain(const MicroPropsGenerator *parent, UErrorCode &amp;status);
182 
183     MicroPropsGenerator &amp;addToChain(const MicroPropsGenerator *parent);
184 
185     void processQuantity(DecimalQuantity &amp;, MicroProps &amp;micros, UErrorCode &amp;status) const U_OVERRIDE;
186 
187     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
188                   UErrorCode &amp;status) const U_OVERRIDE;
189 
<a name="9" id="anc9"></a><span class="line-modified">190     int32_t getPrefixLength() const U_OVERRIDE;</span>
191 
<a name="10" id="anc10"></a><span class="line-modified">192     int32_t getCodePointCount() const U_OVERRIDE;</span>
193 
194     bool isStrong() const U_OVERRIDE;
195 
<a name="11" id="anc11"></a><span class="line-added">196     bool containsField(UNumberFormatFields field) const U_OVERRIDE;</span>
<span class="line-added">197 </span>
<span class="line-added">198     void getParameters(Parameters&amp; output) const U_OVERRIDE;</span>
<span class="line-added">199 </span>
<span class="line-added">200     bool semanticallyEquivalent(const Modifier&amp; other) const U_OVERRIDE;</span>
<span class="line-added">201 </span>
202     /**
203      * Returns the string that substitutes a given symbol type in a pattern.
204      */
205     UnicodeString getSymbol(AffixPatternType type) const U_OVERRIDE;
206 
207     UnicodeString toUnicodeString() const;
208 
209   private:
210     // Modifier details (initialized in constructor)
211     const bool fStrong;
212 
213     // Pattern details (initialized in setPatternInfo and setPatternAttributes)
<a name="12" id="anc12"></a><span class="line-modified">214     const AffixPatternProvider *fPatternInfo;</span>
<span class="line-modified">215     Field fField;</span>
<span class="line-modified">216     UNumberSignDisplay fSignDisplay;</span>
<span class="line-added">217     bool fPerMilleReplacesPercent;</span>
218 
219     // Symbol details (initialized in setSymbols)
<a name="13" id="anc13"></a><span class="line-modified">220     const DecimalFormatSymbols *fSymbols;</span>
<span class="line-modified">221     UNumberUnitWidth fUnitWidth;</span>
<span class="line-modified">222     const CurrencySymbols *fCurrencySymbols;</span>
<span class="line-modified">223     const PluralRules *fRules;</span>
224 
225     // Number details (initialized in setNumberProperties)
<a name="14" id="anc14"></a><span class="line-modified">226     int8_t fSignum;</span>
<span class="line-modified">227     StandardPlural::Form fPlural;</span>
228 
229     // QuantityChain details (initialized in addToChain)
<a name="15" id="anc15"></a><span class="line-modified">230     const MicroPropsGenerator *fParent;</span>
231 
232     // Transient fields for rendering
233     UnicodeString currentAffix;
234 
235     /**
236      * Uses the current properties to create a single {@link ConstantMultiFieldModifier} with currency spacing support
237      * if required.
238      *
239      * &lt;p&gt;
240      * CREATES A NEW HEAP OBJECT; THE CALLER GETS OWNERSHIP.
241      *
242      * @param a
243      *            A working NumberStringBuilder object; passed from the outside to prevent the need to create many new
244      *            instances if this method is called in a loop.
245      * @param b
246      *            Another working NumberStringBuilder object.
247      * @return The constant modifier object.
248      */
249     ConstantMultiFieldModifier *createConstantModifier(UErrorCode &amp;status);
250 
251     int32_t insertPrefix(NumberStringBuilder &amp;sb, int position, UErrorCode &amp;status);
252 
253     int32_t insertSuffix(NumberStringBuilder &amp;sb, int position, UErrorCode &amp;status);
254 
255     void prepareAffix(bool isPrefix);
256 };
257 
258 
259 }  // namespace impl
260 }  // namespace number
261 U_NAMESPACE_END
262 
263 #endif //__NUMBER_PATTERNMODIFIER_H__
264 
265 #endif /* #if !UCONFIG_NO_FORMATTING */
<a name="16" id="anc16"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="16" type="hidden" />
</body>
</html>