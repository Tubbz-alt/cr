<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/astro.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="anytrans.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="brktrans.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/astro.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  48   if(df == NULL) {
  49     df = DateFormat::createDateTimeInstance(DateFormat::MEDIUM, DateFormat::MEDIUM, Locale::getUS());
  50     df-&gt;adoptTimeZone(TimeZone::getGMT()-&gt;clone());
  51   }
  52   UnicodeString str;
  53   df-&gt;format(d,str);
  54   u_austrncpy(gStrBuf,str.getTerminatedBuffer(),sizeof(gStrBuf)-1);
  55   return gStrBuf;
  56 }
  57 
  58 // must use double parens, i.e.:  U_DEBUG_ASTRO_MSG((&quot;four is: %d&quot;,4));
  59 #define U_DEBUG_ASTRO_MSG(x) {debug_astro_loc(__FILE__,__LINE__);debug_astro_msg x;}
  60 #else
  61 #define U_DEBUG_ASTRO_MSG(x)
  62 #endif
  63 
  64 static inline UBool isINVALID(double d) {
  65   return(uprv_isNaN(d));
  66 }
  67 
<span class="line-modified">  68 static UMutex ccLock = U_MUTEX_INITIALIZER;</span>



  69 
  70 U_CDECL_BEGIN
  71 static UBool calendar_astro_cleanup(void) {
  72   return TRUE;
  73 }
  74 U_CDECL_END
  75 
  76 U_NAMESPACE_BEGIN
  77 
  78 /**
  79  * The number of standard hours in one sidereal day.
  80  * Approximately 24.93.
  81  * @internal
  82  * @deprecated ICU 2.4. This class may be removed or modified.
  83  */
  84 #define SIDEREAL_DAY (23.93446960027)
  85 
  86 /**
  87  * The number of sidereal hours in one mean solar day.
  88  * Approximately 24.07.
</pre>
<hr />
<pre>
1532 
1533 void CalendarCache::createCache(CalendarCache** cache, UErrorCode&amp; status) {
1534     ucln_i18n_registerCleanup(UCLN_I18N_ASTRO_CALENDAR, calendar_astro_cleanup);
1535     if(cache == NULL) {
1536         status = U_MEMORY_ALLOCATION_ERROR;
1537     } else {
1538         *cache = new CalendarCache(32, status);
1539         if(U_FAILURE(status)) {
1540             delete *cache;
1541             *cache = NULL;
1542         }
1543     }
1544 }
1545 
1546 int32_t CalendarCache::get(CalendarCache** cache, int32_t key, UErrorCode &amp;status) {
1547     int32_t res;
1548 
1549     if(U_FAILURE(status)) {
1550         return 0;
1551     }
<span class="line-modified">1552     umtx_lock(&amp;ccLock);</span>
1553 
1554     if(*cache == NULL) {
1555         createCache(cache, status);
1556         if(U_FAILURE(status)) {
<span class="line-modified">1557             umtx_unlock(&amp;ccLock);</span>
1558             return 0;
1559         }
1560     }
1561 
1562     res = uhash_igeti((*cache)-&gt;fTable, key);
1563     U_DEBUG_ASTRO_MSG((&quot;%p: GET: [%d] == %d\n&quot;, (*cache)-&gt;fTable, key, res));
1564 
<span class="line-modified">1565     umtx_unlock(&amp;ccLock);</span>
1566     return res;
1567 }
1568 
1569 void CalendarCache::put(CalendarCache** cache, int32_t key, int32_t value, UErrorCode &amp;status) {
1570     if(U_FAILURE(status)) {
1571         return;
1572     }
<span class="line-modified">1573     umtx_lock(&amp;ccLock);</span>
1574 
1575     if(*cache == NULL) {
1576         createCache(cache, status);
1577         if(U_FAILURE(status)) {
<span class="line-modified">1578             umtx_unlock(&amp;ccLock);</span>
1579             return;
1580         }
1581     }
1582 
1583     uhash_iputi((*cache)-&gt;fTable, key, value, &amp;status);
1584     U_DEBUG_ASTRO_MSG((&quot;%p: PUT: [%d] := %d\n&quot;, (*cache)-&gt;fTable, key, value));
1585 
<span class="line-modified">1586     umtx_unlock(&amp;ccLock);</span>
1587 }
1588 
1589 CalendarCache::CalendarCache(int32_t size, UErrorCode &amp;status) {
1590     fTable = uhash_openSize(uhash_hashLong, uhash_compareLong, NULL, size, &amp;status);
1591     U_DEBUG_ASTRO_MSG((&quot;%p: Opening.\n&quot;, fTable));
1592 }
1593 
1594 CalendarCache::~CalendarCache() {
1595     if(fTable != NULL) {
1596         U_DEBUG_ASTRO_MSG((&quot;%p: Closing.\n&quot;, fTable));
1597         uhash_close(fTable);
1598     }
1599 }
1600 
1601 U_NAMESPACE_END
1602 
1603 #endif //  !UCONFIG_NO_FORMATTING
</pre>
</td>
<td>
<hr />
<pre>
  48   if(df == NULL) {
  49     df = DateFormat::createDateTimeInstance(DateFormat::MEDIUM, DateFormat::MEDIUM, Locale::getUS());
  50     df-&gt;adoptTimeZone(TimeZone::getGMT()-&gt;clone());
  51   }
  52   UnicodeString str;
  53   df-&gt;format(d,str);
  54   u_austrncpy(gStrBuf,str.getTerminatedBuffer(),sizeof(gStrBuf)-1);
  55   return gStrBuf;
  56 }
  57 
  58 // must use double parens, i.e.:  U_DEBUG_ASTRO_MSG((&quot;four is: %d&quot;,4));
  59 #define U_DEBUG_ASTRO_MSG(x) {debug_astro_loc(__FILE__,__LINE__);debug_astro_msg x;}
  60 #else
  61 #define U_DEBUG_ASTRO_MSG(x)
  62 #endif
  63 
  64 static inline UBool isINVALID(double d) {
  65   return(uprv_isNaN(d));
  66 }
  67 
<span class="line-modified">  68 static icu::UMutex *ccLock() {</span>
<span class="line-added">  69     static icu::UMutex m = U_MUTEX_INITIALIZER;</span>
<span class="line-added">  70     return &amp;m;</span>
<span class="line-added">  71 }</span>
  72 
  73 U_CDECL_BEGIN
  74 static UBool calendar_astro_cleanup(void) {
  75   return TRUE;
  76 }
  77 U_CDECL_END
  78 
  79 U_NAMESPACE_BEGIN
  80 
  81 /**
  82  * The number of standard hours in one sidereal day.
  83  * Approximately 24.93.
  84  * @internal
  85  * @deprecated ICU 2.4. This class may be removed or modified.
  86  */
  87 #define SIDEREAL_DAY (23.93446960027)
  88 
  89 /**
  90  * The number of sidereal hours in one mean solar day.
  91  * Approximately 24.07.
</pre>
<hr />
<pre>
1535 
1536 void CalendarCache::createCache(CalendarCache** cache, UErrorCode&amp; status) {
1537     ucln_i18n_registerCleanup(UCLN_I18N_ASTRO_CALENDAR, calendar_astro_cleanup);
1538     if(cache == NULL) {
1539         status = U_MEMORY_ALLOCATION_ERROR;
1540     } else {
1541         *cache = new CalendarCache(32, status);
1542         if(U_FAILURE(status)) {
1543             delete *cache;
1544             *cache = NULL;
1545         }
1546     }
1547 }
1548 
1549 int32_t CalendarCache::get(CalendarCache** cache, int32_t key, UErrorCode &amp;status) {
1550     int32_t res;
1551 
1552     if(U_FAILURE(status)) {
1553         return 0;
1554     }
<span class="line-modified">1555     umtx_lock(ccLock());</span>
1556 
1557     if(*cache == NULL) {
1558         createCache(cache, status);
1559         if(U_FAILURE(status)) {
<span class="line-modified">1560             umtx_unlock(ccLock());</span>
1561             return 0;
1562         }
1563     }
1564 
1565     res = uhash_igeti((*cache)-&gt;fTable, key);
1566     U_DEBUG_ASTRO_MSG((&quot;%p: GET: [%d] == %d\n&quot;, (*cache)-&gt;fTable, key, res));
1567 
<span class="line-modified">1568     umtx_unlock(ccLock());</span>
1569     return res;
1570 }
1571 
1572 void CalendarCache::put(CalendarCache** cache, int32_t key, int32_t value, UErrorCode &amp;status) {
1573     if(U_FAILURE(status)) {
1574         return;
1575     }
<span class="line-modified">1576     umtx_lock(ccLock());</span>
1577 
1578     if(*cache == NULL) {
1579         createCache(cache, status);
1580         if(U_FAILURE(status)) {
<span class="line-modified">1581             umtx_unlock(ccLock());</span>
1582             return;
1583         }
1584     }
1585 
1586     uhash_iputi((*cache)-&gt;fTable, key, value, &amp;status);
1587     U_DEBUG_ASTRO_MSG((&quot;%p: PUT: [%d] := %d\n&quot;, (*cache)-&gt;fTable, key, value));
1588 
<span class="line-modified">1589     umtx_unlock(ccLock());</span>
1590 }
1591 
1592 CalendarCache::CalendarCache(int32_t size, UErrorCode &amp;status) {
1593     fTable = uhash_openSize(uhash_hashLong, uhash_compareLong, NULL, size, &amp;status);
1594     U_DEBUG_ASTRO_MSG((&quot;%p: Opening.\n&quot;, fTable));
1595 }
1596 
1597 CalendarCache::~CalendarCache() {
1598     if(fTable != NULL) {
1599         U_DEBUG_ASTRO_MSG((&quot;%p: Closing.\n&quot;, fTable));
1600         uhash_close(fTable);
1601     }
1602 }
1603 
1604 U_NAMESPACE_END
1605 
1606 #endif //  !UCONFIG_NO_FORMATTING
</pre>
</td>
</tr>
</table>
<center><a href="anytrans.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="brktrans.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>