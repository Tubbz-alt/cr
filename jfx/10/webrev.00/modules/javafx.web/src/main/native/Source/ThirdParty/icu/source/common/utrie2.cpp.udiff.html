<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/utrie2.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="utrie.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="utrie2.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/utrie2.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -22,15 +22,14 @@</span>
  *   See utrie2.h for a comparison.
  *
  *   This file contains only the runtime and enumeration code, for read-only access.
  *   See utrie2_builder.c for the builder code.
  */
<span class="udiff-line-removed">- #ifdef UTRIE2_DEBUG</span>
<span class="udiff-line-removed">- #   include &lt;stdio.h&gt;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
  #include &quot;unicode/utypes.h&quot;
<span class="udiff-line-added">+ #ifdef UCPTRIE_DEBUG</span>
<span class="udiff-line-added">+ #include &quot;unicode/umutablecptrie.h&quot;</span>
<span class="udiff-line-added">+ #endif</span>
  #include &quot;unicode/utf.h&quot;
  #include &quot;unicode/utf8.h&quot;
  #include &quot;unicode/utf16.h&quot;
  #include &quot;cmemory.h&quot;
  #include &quot;utrie2.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -200,10 +199,13 @@</span>
      }
      uprv_memcpy(trie, &amp;tempTrie, sizeof(tempTrie));
      trie-&gt;memory=(uint32_t *)data;
      trie-&gt;length=actualLength;
      trie-&gt;isMemoryOwned=FALSE;
<span class="udiff-line-added">+ #ifdef UTRIE2_DEBUG</span>
<span class="udiff-line-added">+     trie-&gt;name=&quot;fromSerialized&quot;;</span>
<span class="udiff-line-added">+ #endif</span>
  
      /* set the pointers to its index and data arrays */
      p16=(const uint16_t *)(header+1);
      trie-&gt;index=p16;
      p16+=trie-&gt;indexLength;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -292,10 +294,13 @@</span>
      trie-&gt;dataNullOffset=(uint16_t)dataMove;
      trie-&gt;initialValue=initialValue;
      trie-&gt;errorValue=errorValue;
      trie-&gt;highStart=0;
      trie-&gt;highValueIndex=dataMove+UTRIE2_DATA_START_OFFSET;
<span class="udiff-line-added">+ #ifdef UTRIE2_DEBUG</span>
<span class="udiff-line-added">+     trie-&gt;name=&quot;dummy&quot;;</span>
<span class="udiff-line-added">+ #endif</span>
  
      /* set the header fields */
      header=(UTrie2Header *)trie-&gt;memory;
  
      header-&gt;signature=UTRIE2_SIG; /* &quot;Tri2&quot; */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -371,38 +376,19 @@</span>
          if(trie-&gt;isMemoryOwned) {
              uprv_free(trie-&gt;memory);
          }
          if(trie-&gt;newTrie!=NULL) {
              uprv_free(trie-&gt;newTrie-&gt;data);
<span class="udiff-line-added">+ #ifdef UCPTRIE_DEBUG</span>
<span class="udiff-line-added">+             umutablecptrie_close(trie-&gt;newTrie-&gt;t3);</span>
<span class="udiff-line-added">+ #endif</span>
              uprv_free(trie-&gt;newTrie);
          }
          uprv_free(trie);
      }
  }
<span class="udiff-line-removed">- U_CAPI int32_t U_EXPORT2</span>
<span class="udiff-line-removed">- utrie2_getVersion(const void *data, int32_t length, UBool anyEndianOk) {</span>
<span class="udiff-line-removed">-     uint32_t signature;</span>
<span class="udiff-line-removed">-     if(length&lt;16 || data==NULL || (U_POINTER_MASK_LSB(data, 3)!=0)) {</span>
<span class="udiff-line-removed">-         return 0;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     signature=*(const uint32_t *)data;</span>
<span class="udiff-line-removed">-     if(signature==UTRIE2_SIG) {</span>
<span class="udiff-line-removed">-         return 2;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if(anyEndianOk &amp;&amp; signature==UTRIE2_OE_SIG) {</span>
<span class="udiff-line-removed">-         return 2;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if(signature==UTRIE_SIG) {</span>
<span class="udiff-line-removed">-         return 1;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if(anyEndianOk &amp;&amp; signature==UTRIE_OE_SIG) {</span>
<span class="udiff-line-removed">-         return 1;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     return 0;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  U_CAPI UBool U_EXPORT2
  utrie2_isFrozen(const UTrie2 *trie) {
      return (UBool)(trie-&gt;newTrie==NULL);
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -428,100 +414,10 @@</span>
          *pErrorCode=U_BUFFER_OVERFLOW_ERROR;
      }
      return trie-&gt;length;
  }
  
<span class="udiff-line-removed">- U_CAPI int32_t U_EXPORT2</span>
<span class="udiff-line-removed">- utrie2_swap(const UDataSwapper *ds,</span>
<span class="udiff-line-removed">-             const void *inData, int32_t length, void *outData,</span>
<span class="udiff-line-removed">-             UErrorCode *pErrorCode) {</span>
<span class="udiff-line-removed">-     const UTrie2Header *inTrie;</span>
<span class="udiff-line-removed">-     UTrie2Header trie;</span>
<span class="udiff-line-removed">-     int32_t dataLength, size;</span>
<span class="udiff-line-removed">-     UTrie2ValueBits valueBits;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if(U_FAILURE(*pErrorCode)) {</span>
<span class="udiff-line-removed">-         return 0;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     if(ds==NULL || inData==NULL || (length&gt;=0 &amp;&amp; outData==NULL)) {</span>
<span class="udiff-line-removed">-         *pErrorCode=U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="udiff-line-removed">-         return 0;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     /* setup and swapping */</span>
<span class="udiff-line-removed">-     if(length&gt;=0 &amp;&amp; length&lt;(int32_t)sizeof(UTrie2Header)) {</span>
<span class="udiff-line-removed">-         *pErrorCode=U_INDEX_OUTOFBOUNDS_ERROR;</span>
<span class="udiff-line-removed">-         return 0;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     inTrie=(const UTrie2Header *)inData;</span>
<span class="udiff-line-removed">-     trie.signature=ds-&gt;readUInt32(inTrie-&gt;signature);</span>
<span class="udiff-line-removed">-     trie.options=ds-&gt;readUInt16(inTrie-&gt;options);</span>
<span class="udiff-line-removed">-     trie.indexLength=ds-&gt;readUInt16(inTrie-&gt;indexLength);</span>
<span class="udiff-line-removed">-     trie.shiftedDataLength=ds-&gt;readUInt16(inTrie-&gt;shiftedDataLength);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     valueBits=(UTrie2ValueBits)(trie.options&amp;UTRIE2_OPTIONS_VALUE_BITS_MASK);</span>
<span class="udiff-line-removed">-     dataLength=(int32_t)trie.shiftedDataLength&lt;&lt;UTRIE2_INDEX_SHIFT;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if( trie.signature!=UTRIE2_SIG ||</span>
<span class="udiff-line-removed">-         valueBits&lt;0 || UTRIE2_COUNT_VALUE_BITS&lt;=valueBits ||</span>
<span class="udiff-line-removed">-         trie.indexLength&lt;UTRIE2_INDEX_1_OFFSET ||</span>
<span class="udiff-line-removed">-         dataLength&lt;UTRIE2_DATA_START_OFFSET</span>
<span class="udiff-line-removed">-     ) {</span>
<span class="udiff-line-removed">-         *pErrorCode=U_INVALID_FORMAT_ERROR; /* not a UTrie */</span>
<span class="udiff-line-removed">-         return 0;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     size=sizeof(UTrie2Header)+trie.indexLength*2;</span>
<span class="udiff-line-removed">-     switch(valueBits) {</span>
<span class="udiff-line-removed">-     case UTRIE2_16_VALUE_BITS:</span>
<span class="udiff-line-removed">-         size+=dataLength*2;</span>
<span class="udiff-line-removed">-         break;</span>
<span class="udiff-line-removed">-     case UTRIE2_32_VALUE_BITS:</span>
<span class="udiff-line-removed">-         size+=dataLength*4;</span>
<span class="udiff-line-removed">-         break;</span>
<span class="udiff-line-removed">-     default:</span>
<span class="udiff-line-removed">-         *pErrorCode=U_INVALID_FORMAT_ERROR;</span>
<span class="udiff-line-removed">-         return 0;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if(length&gt;=0) {</span>
<span class="udiff-line-removed">-         UTrie2Header *outTrie;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         if(length&lt;size) {</span>
<span class="udiff-line-removed">-             *pErrorCode=U_INDEX_OUTOFBOUNDS_ERROR;</span>
<span class="udiff-line-removed">-             return 0;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         outTrie=(UTrie2Header *)outData;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         /* swap the header */</span>
<span class="udiff-line-removed">-         ds-&gt;swapArray32(ds, &amp;inTrie-&gt;signature, 4, &amp;outTrie-&gt;signature, pErrorCode);</span>
<span class="udiff-line-removed">-         ds-&gt;swapArray16(ds, &amp;inTrie-&gt;options, 12, &amp;outTrie-&gt;options, pErrorCode);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         /* swap the index and the data */</span>
<span class="udiff-line-removed">-         switch(valueBits) {</span>
<span class="udiff-line-removed">-         case UTRIE2_16_VALUE_BITS:</span>
<span class="udiff-line-removed">-             ds-&gt;swapArray16(ds, inTrie+1, (trie.indexLength+dataLength)*2, outTrie+1, pErrorCode);</span>
<span class="udiff-line-removed">-             break;</span>
<span class="udiff-line-removed">-         case UTRIE2_32_VALUE_BITS:</span>
<span class="udiff-line-removed">-             ds-&gt;swapArray16(ds, inTrie+1, trie.indexLength*2, outTrie+1, pErrorCode);</span>
<span class="udiff-line-removed">-             ds-&gt;swapArray32(ds, (const uint16_t *)(inTrie+1)+trie.indexLength, dataLength*4,</span>
<span class="udiff-line-removed">-                                      (uint16_t *)(outTrie+1)+trie.indexLength, pErrorCode);</span>
<span class="udiff-line-removed">-             break;</span>
<span class="udiff-line-removed">-         default:</span>
<span class="udiff-line-removed">-             *pErrorCode=U_INVALID_FORMAT_ERROR;</span>
<span class="udiff-line-removed">-             return 0;</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return size;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- // utrie2_swapAnyVersion() should be defined here but lives in utrie2_builder.c</span>
<span class="udiff-line-removed">- // to avoid a dependency from utrie2.cpp on utrie.c.</span>
<span class="udiff-line-removed">- </span>
  /* enumeration -------------------------------------------------------------- */
  
  #define MIN_VALUE(a, b) ((a)&lt;(b) ? (a) : (b))
  
  /* default UTrie2EnumValue() returns the input value itself */
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -744,22 +640,22 @@</span>
  
  uint16_t BackwardUTrie2StringIterator::previous16() {
      codePointLimit=codePointStart;
      if(start&gt;=codePointStart) {
          codePoint=U_SENTINEL;
<span class="udiff-line-modified-removed">-         return trie-&gt;errorValue;</span>
<span class="udiff-line-modified-added">+         return static_cast&lt;uint16_t&gt;(trie-&gt;errorValue);</span>
      }
      uint16_t result;
      UTRIE2_U16_PREV16(trie, start, codePointStart, codePoint, result);
      return result;
  }
  
  uint16_t ForwardUTrie2StringIterator::next16() {
      codePointStart=codePointLimit;
      if(codePointLimit==limit) {
          codePoint=U_SENTINEL;
<span class="udiff-line-modified-removed">-         return trie-&gt;errorValue;</span>
<span class="udiff-line-modified-added">+         return static_cast&lt;uint16_t&gt;(trie-&gt;errorValue);</span>
      }
      uint16_t result;
      UTRIE2_U16_NEXT16(trie, codePointLimit, limit, codePoint, result);
      return result;
  }
</pre>
<center><a href="utrie.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="utrie2.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>