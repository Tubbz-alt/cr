<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/currunit.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="currpinf.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="datefmt.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/currunit.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 // © 2016 and later: Unicode, Inc. and others.
  2 // License &amp; terms of use: http://www.unicode.org/copyright.html
  3 /*
  4 **********************************************************************
  5 * Copyright (c) 2004-2014, International Business Machines
  6 * Corporation and others.  All Rights Reserved.
  7 **********************************************************************
  8 * Author: Alan Liu
  9 * Created: April 26, 2004
 10 * Since: ICU 3.0
 11 **********************************************************************
 12 */
 13 #include &quot;unicode/utypes.h&quot;
 14 
 15 #if !UCONFIG_NO_FORMATTING
 16 
 17 #include &quot;unicode/currunit.h&quot;
 18 #include &quot;unicode/ustring.h&quot;
 19 #include &quot;cstring.h&quot;
 20 #include &quot;uinvchar.h&quot;

 21 
 22 static constexpr char16_t kDefaultCurrency[] = u&quot;XXX&quot;;

 23 
 24 U_NAMESPACE_BEGIN
 25 
 26 CurrencyUnit::CurrencyUnit(ConstChar16Ptr _isoCode, UErrorCode&amp; ec) {
 27     // The constructor always leaves the CurrencyUnit in a valid state (with a 3-character currency code).
 28     // Note: in ICU4J Currency.getInstance(), we check string length for 3, but in ICU4C we allow a
 29     // non-NUL-terminated string to be passed as an argument, so it is not possible to check length.


 30     const char16_t* isoCodeToUse;
<span class="line-modified"> 31     if (U_FAILURE(ec) || _isoCode == nullptr) {</span>
 32         isoCodeToUse = kDefaultCurrency;



 33     } else if (!uprv_isInvariantUString(_isoCode, 3)) {
 34         // TODO: Perform a more strict ASCII check like in ICU4J isAlpha3Code?
 35         isoCodeToUse = kDefaultCurrency;
 36         ec = U_INVARIANT_CONVERSION_ERROR;
 37     } else {
 38         isoCodeToUse = _isoCode;
 39     }
 40     // TODO: Perform uppercasing here like in ICU4J Currency.getInstance()?
 41     uprv_memcpy(isoCode, isoCodeToUse, sizeof(UChar) * 3);
 42     isoCode[3] = 0;
 43     char simpleIsoCode[4];
 44     u_UCharsToChars(isoCode, simpleIsoCode, 4);
 45     initCurrency(simpleIsoCode);
 46 }
 47 
























 48 CurrencyUnit::CurrencyUnit(const CurrencyUnit&amp; other) : MeasureUnit(other) {
 49     u_strcpy(isoCode, other.isoCode);
 50 }
 51 
 52 CurrencyUnit::CurrencyUnit(const MeasureUnit&amp; other, UErrorCode&amp; ec) : MeasureUnit(other) {
 53     // Make sure this is a currency.
 54     // OK to hard-code the string because we are comparing against another hard-coded string.
 55     if (uprv_strcmp(&quot;currency&quot;, getType()) != 0) {
 56         ec = U_ILLEGAL_ARGUMENT_ERROR;
 57         isoCode[0] = 0;
 58     } else {
 59         // Get the ISO Code from the subtype field.
 60         u_charsToUChars(getSubtype(), isoCode, 4);
 61         isoCode[3] = 0; // make 100% sure it is NUL-terminated
 62     }
 63 }
 64 
 65 CurrencyUnit::CurrencyUnit() : MeasureUnit() {
 66     u_strcpy(isoCode, kDefaultCurrency);
 67     char simpleIsoCode[4];
</pre>
</td>
<td>
<hr />
<pre>
  1 // © 2016 and later: Unicode, Inc. and others.
  2 // License &amp; terms of use: http://www.unicode.org/copyright.html
  3 /*
  4 **********************************************************************
  5 * Copyright (c) 2004-2014, International Business Machines
  6 * Corporation and others.  All Rights Reserved.
  7 **********************************************************************
  8 * Author: Alan Liu
  9 * Created: April 26, 2004
 10 * Since: ICU 3.0
 11 **********************************************************************
 12 */
 13 #include &quot;unicode/utypes.h&quot;
 14 
 15 #if !UCONFIG_NO_FORMATTING
 16 
 17 #include &quot;unicode/currunit.h&quot;
 18 #include &quot;unicode/ustring.h&quot;
 19 #include &quot;cstring.h&quot;
 20 #include &quot;uinvchar.h&quot;
<span class="line-added"> 21 #include &quot;charstr.h&quot;</span>
 22 
 23 static constexpr char16_t kDefaultCurrency[] = u&quot;XXX&quot;;
<span class="line-added"> 24 static constexpr char kDefaultCurrency8[] = &quot;XXX&quot;;</span>
 25 
 26 U_NAMESPACE_BEGIN
 27 
 28 CurrencyUnit::CurrencyUnit(ConstChar16Ptr _isoCode, UErrorCode&amp; ec) {
 29     // The constructor always leaves the CurrencyUnit in a valid state (with a 3-character currency code).
 30     // Note: in ICU4J Currency.getInstance(), we check string length for 3, but in ICU4C we allow a
 31     // non-NUL-terminated string to be passed as an argument, so it is not possible to check length.
<span class="line-added"> 32     // However, we allow a NUL-terminated empty string, which should have the same behavior as nullptr.</span>
<span class="line-added"> 33     // Consider NUL-terminated strings of length 1 or 2 as invalid.</span>
 34     const char16_t* isoCodeToUse;
<span class="line-modified"> 35     if (U_FAILURE(ec) || _isoCode == nullptr || _isoCode[0] == 0) {</span>
 36         isoCodeToUse = kDefaultCurrency;
<span class="line-added"> 37     } else if (_isoCode[1] == 0 || _isoCode[2] == 0) {</span>
<span class="line-added"> 38         isoCodeToUse = kDefaultCurrency;</span>
<span class="line-added"> 39         ec = U_ILLEGAL_ARGUMENT_ERROR;</span>
 40     } else if (!uprv_isInvariantUString(_isoCode, 3)) {
 41         // TODO: Perform a more strict ASCII check like in ICU4J isAlpha3Code?
 42         isoCodeToUse = kDefaultCurrency;
 43         ec = U_INVARIANT_CONVERSION_ERROR;
 44     } else {
 45         isoCodeToUse = _isoCode;
 46     }
 47     // TODO: Perform uppercasing here like in ICU4J Currency.getInstance()?
 48     uprv_memcpy(isoCode, isoCodeToUse, sizeof(UChar) * 3);
 49     isoCode[3] = 0;
 50     char simpleIsoCode[4];
 51     u_UCharsToChars(isoCode, simpleIsoCode, 4);
 52     initCurrency(simpleIsoCode);
 53 }
 54 
<span class="line-added"> 55 CurrencyUnit::CurrencyUnit(StringPiece _isoCode, UErrorCode&amp; ec) {</span>
<span class="line-added"> 56     // Note: unlike the old constructor, reject empty arguments with an error.</span>
<span class="line-added"> 57     char isoCodeBuffer[4];</span>
<span class="line-added"> 58     const char* isoCodeToUse;</span>
<span class="line-added"> 59     // uprv_memchr checks that the string contains no internal NULs</span>
<span class="line-added"> 60     if (_isoCode.length() != 3 || uprv_memchr(_isoCode.data(), 0, 3) != nullptr) {</span>
<span class="line-added"> 61         isoCodeToUse = kDefaultCurrency8;</span>
<span class="line-added"> 62         ec = U_ILLEGAL_ARGUMENT_ERROR;</span>
<span class="line-added"> 63     } else if (!uprv_isInvariantString(_isoCode.data(), 3)) {</span>
<span class="line-added"> 64         // TODO: Perform a more strict ASCII check like in ICU4J isAlpha3Code?</span>
<span class="line-added"> 65         isoCodeToUse = kDefaultCurrency8;</span>
<span class="line-added"> 66         ec = U_INVARIANT_CONVERSION_ERROR;</span>
<span class="line-added"> 67     } else {</span>
<span class="line-added"> 68         // Have to use isoCodeBuffer to ensure the string is NUL-terminated</span>
<span class="line-added"> 69         uprv_strncpy(isoCodeBuffer, _isoCode.data(), 3);</span>
<span class="line-added"> 70         isoCodeBuffer[3] = 0;</span>
<span class="line-added"> 71         isoCodeToUse = isoCodeBuffer;</span>
<span class="line-added"> 72     }</span>
<span class="line-added"> 73     // TODO: Perform uppercasing here like in ICU4J Currency.getInstance()?</span>
<span class="line-added"> 74     u_charsToUChars(isoCodeToUse, isoCode, 3);</span>
<span class="line-added"> 75     isoCode[3] = 0;</span>
<span class="line-added"> 76     initCurrency(isoCodeToUse);</span>
<span class="line-added"> 77 }</span>
<span class="line-added"> 78 </span>
 79 CurrencyUnit::CurrencyUnit(const CurrencyUnit&amp; other) : MeasureUnit(other) {
 80     u_strcpy(isoCode, other.isoCode);
 81 }
 82 
 83 CurrencyUnit::CurrencyUnit(const MeasureUnit&amp; other, UErrorCode&amp; ec) : MeasureUnit(other) {
 84     // Make sure this is a currency.
 85     // OK to hard-code the string because we are comparing against another hard-coded string.
 86     if (uprv_strcmp(&quot;currency&quot;, getType()) != 0) {
 87         ec = U_ILLEGAL_ARGUMENT_ERROR;
 88         isoCode[0] = 0;
 89     } else {
 90         // Get the ISO Code from the subtype field.
 91         u_charsToUChars(getSubtype(), isoCode, 4);
 92         isoCode[3] = 0; // make 100% sure it is NUL-terminated
 93     }
 94 }
 95 
 96 CurrencyUnit::CurrencyUnit() : MeasureUnit() {
 97     u_strcpy(isoCode, kDefaultCurrency);
 98     char simpleIsoCode[4];
</pre>
</td>
</tr>
</table>
<center><a href="currpinf.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="datefmt.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>