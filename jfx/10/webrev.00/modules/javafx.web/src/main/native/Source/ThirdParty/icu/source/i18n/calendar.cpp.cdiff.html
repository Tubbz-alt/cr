<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/calendar.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="brktrans.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="chnsecal.cpp.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/calendar.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 325,72 ***</span>
      }
      return calType;
  }
  
  static Calendar *createStandardCalendar(ECalType calType, const Locale &amp;loc, UErrorCode&amp; status) {
<span class="line-modified">!     Calendar *cal = NULL;</span>
  
      switch (calType) {
          case CALTYPE_GREGORIAN:
<span class="line-modified">!             cal = new GregorianCalendar(loc, status);</span>
              break;
          case CALTYPE_JAPANESE:
<span class="line-modified">!             cal = new JapaneseCalendar(loc, status);</span>
              break;
          case CALTYPE_BUDDHIST:
<span class="line-modified">!             cal = new BuddhistCalendar(loc, status);</span>
              break;
          case CALTYPE_ROC:
<span class="line-modified">!             cal = new TaiwanCalendar(loc, status);</span>
              break;
          case CALTYPE_PERSIAN:
<span class="line-modified">!             cal = new PersianCalendar(loc, status);</span>
              break;
          case CALTYPE_ISLAMIC_TBLA:
<span class="line-modified">!             cal = new IslamicCalendar(loc, status, IslamicCalendar::TBLA);</span>
              break;
          case CALTYPE_ISLAMIC_CIVIL:
<span class="line-modified">!             cal = new IslamicCalendar(loc, status, IslamicCalendar::CIVIL);</span>
              break;
          case CALTYPE_ISLAMIC_RGSA:
              // default any region specific not handled individually to islamic
          case CALTYPE_ISLAMIC:
<span class="line-modified">!             cal = new IslamicCalendar(loc, status, IslamicCalendar::ASTRONOMICAL);</span>
              break;
          case CALTYPE_ISLAMIC_UMALQURA:
<span class="line-modified">!             cal = new IslamicCalendar(loc, status, IslamicCalendar::UMALQURA);</span>
              break;
          case CALTYPE_HEBREW:
<span class="line-modified">!             cal = new HebrewCalendar(loc, status);</span>
              break;
          case CALTYPE_CHINESE:
<span class="line-modified">!             cal = new ChineseCalendar(loc, status);</span>
              break;
          case CALTYPE_INDIAN:
<span class="line-modified">!             cal = new IndianCalendar(loc, status);</span>
              break;
          case CALTYPE_COPTIC:
<span class="line-modified">!             cal = new CopticCalendar(loc, status);</span>
              break;
          case CALTYPE_ETHIOPIC:
<span class="line-modified">!             cal = new EthiopicCalendar(loc, status, EthiopicCalendar::AMETE_MIHRET_ERA);</span>
              break;
          case CALTYPE_ETHIOPIC_AMETE_ALEM:
<span class="line-modified">!             cal = new EthiopicCalendar(loc, status, EthiopicCalendar::AMETE_ALEM_ERA);</span>
              break;
          case CALTYPE_ISO8601:
<span class="line-modified">!             cal = new GregorianCalendar(loc, status);</span>
<span class="line-modified">!             cal-&gt;setFirstDayOfWeek(UCAL_MONDAY);</span>
<span class="line-modified">!             cal-&gt;setMinimalDaysInFirstWeek(4);</span>
              break;
          case CALTYPE_DANGI:
<span class="line-modified">!             cal = new DangiCalendar(loc, status);</span>
              break;
          default:
              status = U_UNSUPPORTED_ERROR;
      }
<span class="line-modified">!     return cal;</span>
  }
  
  
  #if !UCONFIG_NO_SERVICE
  
<span class="line-new-header">--- 325,77 ---</span>
      }
      return calType;
  }
  
  static Calendar *createStandardCalendar(ECalType calType, const Locale &amp;loc, UErrorCode&amp; status) {
<span class="line-modified">!     if (U_FAILURE(status)) {</span>
<span class="line-added">+         return nullptr;</span>
<span class="line-added">+     }</span>
<span class="line-added">+     LocalPointer&lt;Calendar&gt; cal;</span>
  
      switch (calType) {
          case CALTYPE_GREGORIAN:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new GregorianCalendar(loc, status), status);</span>
              break;
          case CALTYPE_JAPANESE:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new JapaneseCalendar(loc, status), status);</span>
              break;
          case CALTYPE_BUDDHIST:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new BuddhistCalendar(loc, status), status);</span>
              break;
          case CALTYPE_ROC:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new TaiwanCalendar(loc, status), status);</span>
              break;
          case CALTYPE_PERSIAN:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new PersianCalendar(loc, status), status);</span>
              break;
          case CALTYPE_ISLAMIC_TBLA:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new IslamicCalendar(loc, status, IslamicCalendar::TBLA), status);</span>
              break;
          case CALTYPE_ISLAMIC_CIVIL:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new IslamicCalendar(loc, status, IslamicCalendar::CIVIL), status);</span>
              break;
          case CALTYPE_ISLAMIC_RGSA:
              // default any region specific not handled individually to islamic
          case CALTYPE_ISLAMIC:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new IslamicCalendar(loc, status, IslamicCalendar::ASTRONOMICAL), status);</span>
              break;
          case CALTYPE_ISLAMIC_UMALQURA:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new IslamicCalendar(loc, status, IslamicCalendar::UMALQURA), status);</span>
              break;
          case CALTYPE_HEBREW:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new HebrewCalendar(loc, status), status);</span>
              break;
          case CALTYPE_CHINESE:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new ChineseCalendar(loc, status), status);</span>
              break;
          case CALTYPE_INDIAN:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new IndianCalendar(loc, status), status);</span>
              break;
          case CALTYPE_COPTIC:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new CopticCalendar(loc, status), status);</span>
              break;
          case CALTYPE_ETHIOPIC:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new EthiopicCalendar(loc, status, EthiopicCalendar::AMETE_MIHRET_ERA), status);</span>
              break;
          case CALTYPE_ETHIOPIC_AMETE_ALEM:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new EthiopicCalendar(loc, status, EthiopicCalendar::AMETE_ALEM_ERA), status);</span>
              break;
          case CALTYPE_ISO8601:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new GregorianCalendar(loc, status), status);</span>
<span class="line-modified">!             if (cal.isValid()) {</span>
<span class="line-modified">!                 cal-&gt;setFirstDayOfWeek(UCAL_MONDAY);</span>
<span class="line-added">+                 cal-&gt;setMinimalDaysInFirstWeek(4);</span>
<span class="line-added">+             }</span>
              break;
          case CALTYPE_DANGI:
<span class="line-modified">!             cal.adoptInsteadAndCheckErrorCode(new DangiCalendar(loc, status), status);</span>
              break;
          default:
              status = U_UNSUPPORTED_ERROR;
      }
<span class="line-modified">!     return cal.orphan();</span>
  }
  
  
  #if !UCONFIG_NO_SERVICE
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 534,10 ***</span>
<span class="line-new-header">--- 539,14 ---</span>
          Locale loc2;
          lkey.currentLocale(loc2);
          fprintf(stderr, &quot;CalSvc:handleDefault for currentLoc %s, canloc %s\n&quot;, (const char*)loc.getName(),  (const char*)loc2.getName());
  #endif
          Calendar *nc =  new GregorianCalendar(loc, status);
<span class="line-added">+         if (nc == nullptr) {</span>
<span class="line-added">+             status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="line-added">+             return nc;</span>
<span class="line-added">+         }</span>
  
  #ifdef U_DEBUG_CALSVC
          UErrorCode status2 = U_ZERO_ERROR;
          fprintf(stderr, &quot;New default calendar has tz=%d\n&quot;, ((Calendar*)nc)-&gt;get(UCAL_ZONE_OFFSET, status2));
  #endif
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1091,11 ***</span>
                                                          commonlyUsed, &amp;status);
      if (U_FAILURE(status)) {
          uenum_close(uenum);
          return NULL;
      }
<span class="line-modified">!     return new UStringEnumeration(uenum);</span>
  }
  
  // -------------------------------------
  
  UDate U_EXPORT2
<span class="line-new-header">--- 1100,15 ---</span>
                                                          commonlyUsed, &amp;status);
      if (U_FAILURE(status)) {
          uenum_close(uenum);
          return NULL;
      }
<span class="line-modified">!     UStringEnumeration* ustringenum = new UStringEnumeration(uenum);</span>
<span class="line-added">+     if (ustringenum == nullptr) {</span>
<span class="line-added">+         status = U_MEMORY_ALLOCATION_ERROR;</span>
<span class="line-added">+     }</span>
<span class="line-added">+     return ustringenum;</span>
  }
  
  // -------------------------------------
  
  UDate U_EXPORT2
</pre>
<hr />
<pre>
<span class="line-old-header">*** 3781,25 ***</span>
      // 1). If the locale has a language but no territory, use the territory as defined by
      //     the likely subtags.
      // 2). If the locale has a script designation then we ignore it,
      //     then remove it ( i.e. &quot;en_Latn_US&quot; becomes &quot;en_US&quot; )
  
<span class="line-removed">-     char minLocaleID[ULOC_FULLNAME_CAPACITY] = { 0 };</span>
      UErrorCode myStatus = U_ZERO_ERROR;
  
<span class="line-modified">!     uloc_minimizeSubtags(desiredLocale.getName(),minLocaleID,ULOC_FULLNAME_CAPACITY,&amp;myStatus);</span>
<span class="line-modified">!     Locale min = Locale::createFromName(minLocaleID);</span>
      Locale useLocale;
      if ( uprv_strlen(desiredLocale.getCountry()) == 0 ||
           (uprv_strlen(desiredLocale.getScript()) &gt; 0 &amp;&amp; uprv_strlen(min.getScript()) == 0) ) {
<span class="line-removed">-         char maxLocaleID[ULOC_FULLNAME_CAPACITY] = { 0 };</span>
          myStatus = U_ZERO_ERROR;
<span class="line-modified">!         uloc_addLikelySubtags(desiredLocale.getName(),maxLocaleID,ULOC_FULLNAME_CAPACITY,&amp;myStatus);</span>
<span class="line-modified">!         Locale max = Locale::createFromName(maxLocaleID);</span>
          useLocale = Locale(max.getLanguage(),max.getCountry());
      } else {
<span class="line-modified">!         useLocale = Locale(desiredLocale);</span>
      }
  
      /* The code here is somewhat of a hack, since week data and weekend data aren&#39;t really tied to
         a specific calendar, they aren&#39;t truly locale data.  But this is the only place where valid and
         actual locale can be set, so we take a shot at it here by loading a representative resource
<span class="line-new-header">--- 3794,23 ---</span>
      // 1). If the locale has a language but no territory, use the territory as defined by
      //     the likely subtags.
      // 2). If the locale has a script designation then we ignore it,
      //     then remove it ( i.e. &quot;en_Latn_US&quot; becomes &quot;en_US&quot; )
  
      UErrorCode myStatus = U_ZERO_ERROR;
  
<span class="line-modified">!     Locale min(desiredLocale);</span>
<span class="line-modified">!     min.minimizeSubtags(myStatus);</span>
      Locale useLocale;
      if ( uprv_strlen(desiredLocale.getCountry()) == 0 ||
           (uprv_strlen(desiredLocale.getScript()) &gt; 0 &amp;&amp; uprv_strlen(min.getScript()) == 0) ) {
          myStatus = U_ZERO_ERROR;
<span class="line-modified">!         Locale max(desiredLocale);</span>
<span class="line-modified">!         max.addLikelySubtags(myStatus);</span>
          useLocale = Locale(max.getLanguage(),max.getCountry());
      } else {
<span class="line-modified">!         useLocale = desiredLocale;</span>
      }
  
      /* The code here is somewhat of a hack, since week data and weekend data aren&#39;t really tied to
         a specific calendar, they aren&#39;t truly locale data.  But this is the only place where valid and
         actual locale can be set, so we take a shot at it here by loading a representative resource
</pre>
<center><a href="brktrans.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="chnsecal.cpp.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>