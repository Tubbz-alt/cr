<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/unames.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="umutex.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="unicode/brkiter.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/unames.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 464,11 ***</span>
      for (cp = code, i = ndigits; (cp || i &gt; 0) &amp;&amp; bufferLength; cp &gt;&gt;= 4, bufferLength--) {
          uint8_t v = (uint8_t)(cp &amp; 0xf);
          buffer[--i] = (v &lt; 10 ? &#39;0&#39; + v : &#39;A&#39; + v - 10);
      }
      buffer += ndigits;
<span class="line-modified">!     length += ndigits;</span>
      WRITE_CHAR(buffer, bufferLength, length, &#39;&gt;&#39;);
  
      return length;
  }
  
<span class="line-new-header">--- 464,11 ---</span>
      for (cp = code, i = ndigits; (cp || i &gt; 0) &amp;&amp; bufferLength; cp &gt;&gt;= 4, bufferLength--) {
          uint8_t v = (uint8_t)(cp &amp; 0xf);
          buffer[--i] = (v &lt; 10 ? &#39;0&#39; + v : &#39;A&#39; + v - 10);
      }
      buffer += ndigits;
<span class="line-modified">!     length += static_cast&lt;uint16_t&gt;(ndigits);</span>
      WRITE_CHAR(buffer, bufferLength, length, &#39;&gt;&#39;);
  
      return length;
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1524,11 ***</span>
      AlgorithmicRange *algRange;
      uint32_t *p;
      uint32_t i;
      UChar32 cp = 0;
      char c0;
<span class="line-modified">!     UChar32 error = 0xffff;     /* Undefined, but use this for backwards compatibility. */</span>
  
      if(pErrorCode==NULL || U_FAILURE(*pErrorCode)) {
          return error;
      }
  
<span class="line-new-header">--- 1524,11 ---</span>
      AlgorithmicRange *algRange;
      uint32_t *p;
      uint32_t i;
      UChar32 cp = 0;
      char c0;
<span class="line-modified">!     static constexpr UChar32 error = 0xffff;     /* Undefined, but use this for backwards compatibility. */</span>
  
      if(pErrorCode==NULL || U_FAILURE(*pErrorCode)) {
          return error;
      }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1558,43 ***</span>
      }
      // i==strlen(name)==strlen(lower)==strlen(upper)
  
      /* try extended names first */
      if (lower[0] == &#39;&lt;&#39;) {
<span class="line-modified">!         if (nameChoice == U_EXTENDED_CHAR_NAME) {</span>
              // Parse a string like &quot;&lt;category-HHHH&gt;&quot; where HHHH is a hex code point.
<span class="line-modified">!             if (lower[--i] == &#39;&gt;&#39; &amp;&amp; i &gt;= 3 &amp;&amp; lower[--i] != &#39;-&#39;) {</span>
<span class="line-modified">!                 while (i &gt;= 3 &amp;&amp; lower[--i] != &#39;-&#39;) {}</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 if (i &gt;= 2 &amp;&amp; lower[i] == &#39;-&#39;) {</span>
<span class="line-modified">!                     uint32_t cIdx;</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     lower[i] = 0;</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     for (++i; lower[i] != &#39;&gt;&#39;; ++i) {</span>
<span class="line-modified">!                         if (lower[i] &gt;= &#39;0&#39; &amp;&amp; lower[i] &lt;= &#39;9&#39;) {</span>
<span class="line-modified">!                             cp = (cp &lt;&lt; 4) + lower[i] - &#39;0&#39;;</span>
<span class="line-modified">!                         } else if (lower[i] &gt;= &#39;a&#39; &amp;&amp; lower[i] &lt;= &#39;f&#39;) {</span>
<span class="line-modified">!                             cp = (cp &lt;&lt; 4) + lower[i] - &#39;a&#39; + 10;</span>
<span class="line-modified">!                         } else {</span>
<span class="line-modified">!                             *pErrorCode = U_ILLEGAL_CHAR_FOUND;</span>
<span class="line-modified">!                             return error;</span>
<span class="line-modified">!                         }</span>
                      }
  
<span class="line-modified">!                     /* Now validate the category name.</span>
<span class="line-modified">!                        We could use a binary search, or a trie, if</span>
<span class="line-modified">!                        we really wanted to. */</span>
<span class="line-modified">! </span>
<span class="line-modified">!                     for (lower[i] = 0, cIdx = 0; cIdx &lt; UPRV_LENGTHOF(charCatNames); ++cIdx) {</span>
  
<span class="line-modified">!                         if (!uprv_strcmp(lower + 1, charCatNames[cIdx])) {</span>
<span class="line-modified">!                             if (getCharCat(cp) == cIdx) {</span>
<span class="line-modified">!                                 return cp;</span>
<span class="line-removed">-                             }</span>
<span class="line-removed">-                             break;</span>
                          }
                      }
                  }
              }
          }
  
<span class="line-new-header">--- 1558,49 ---</span>
      }
      // i==strlen(name)==strlen(lower)==strlen(upper)
  
      /* try extended names first */
      if (lower[0] == &#39;&lt;&#39;) {
<span class="line-modified">!         if (nameChoice == U_EXTENDED_CHAR_NAME &amp;&amp; lower[--i] == &#39;&gt;&#39;) {</span>
              // Parse a string like &quot;&lt;category-HHHH&gt;&quot; where HHHH is a hex code point.
<span class="line-modified">!             uint32_t limit = i;</span>
<span class="line-modified">!             while (i &gt;= 3 &amp;&amp; lower[--i] != &#39;-&#39;) {}</span>
<span class="line-modified">! </span>
<span class="line-modified">!             // There should be 1 to 8 hex digits.</span>
<span class="line-modified">!             int32_t hexLength = limit - (i + 1);</span>
<span class="line-modified">!             if (i &gt;= 2 &amp;&amp; lower[i] == &#39;-&#39; &amp;&amp; 1 &lt;= hexLength &amp;&amp; hexLength &lt;= 8) {</span>
<span class="line-modified">!                 uint32_t cIdx;</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 lower[i] = 0;</span>
<span class="line-modified">! </span>
<span class="line-modified">!                 for (++i; i &lt; limit; ++i) {</span>
<span class="line-modified">!                     if (lower[i] &gt;= &#39;0&#39; &amp;&amp; lower[i] &lt;= &#39;9&#39;) {</span>
<span class="line-modified">!                         cp = (cp &lt;&lt; 4) + lower[i] - &#39;0&#39;;</span>
<span class="line-modified">!                     } else if (lower[i] &gt;= &#39;a&#39; &amp;&amp; lower[i] &lt;= &#39;f&#39;) {</span>
<span class="line-modified">!                         cp = (cp &lt;&lt; 4) + lower[i] - &#39;a&#39; + 10;</span>
<span class="line-modified">!                     } else {</span>
<span class="line-modified">!                         *pErrorCode = U_ILLEGAL_CHAR_FOUND;</span>
<span class="line-added">+                         return error;</span>
                      }
<span class="line-added">+                     // Prevent signed-integer overflow and out-of-range code points.</span>
<span class="line-added">+                     if (cp &gt; UCHAR_MAX_VALUE) {</span>
<span class="line-added">+                         *pErrorCode = U_ILLEGAL_CHAR_FOUND;</span>
<span class="line-added">+                         return error;</span>
<span class="line-added">+                     }</span>
<span class="line-added">+                 }</span>
  
<span class="line-modified">!                 /* Now validate the category name.</span>
<span class="line-modified">!                    We could use a binary search, or a trie, if</span>
<span class="line-modified">!                    we really wanted to. */</span>
<span class="line-modified">!                 uint8_t cat = getCharCat(cp);</span>
<span class="line-modified">!                 for (lower[i] = 0, cIdx = 0; cIdx &lt; UPRV_LENGTHOF(charCatNames); ++cIdx) {</span>
  
<span class="line-modified">!                     if (!uprv_strcmp(lower + 1, charCatNames[cIdx])) {</span>
<span class="line-modified">!                         if (cat == cIdx) {</span>
<span class="line-modified">!                             return cp;</span>
                          }
<span class="line-added">+                         break;</span>
                      }
                  }
              }
          }
  
</pre>
<center><a href="umutex.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="unicode/brkiter.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>