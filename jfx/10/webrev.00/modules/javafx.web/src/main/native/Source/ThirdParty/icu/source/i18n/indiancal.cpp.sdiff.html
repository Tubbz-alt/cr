<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/indiancal.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="i18n_uwp.vcxproj.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="indiancal.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/indiancal.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
330    internalSet(UCAL_YEAR, IndianYear);
331    internalSet(UCAL_MONTH, IndianMonth);
332    internalSet(UCAL_DAY_OF_MONTH, IndianDayOfMonth);
333    internalSet(UCAL_DAY_OF_YEAR, yday + 1); // yday is 0-based
334 }
335 
336 UBool
337 IndianCalendar::inDaylightTime(UErrorCode&amp; status) const
338 {
339     // copied from GregorianCalendar
340     if (U_FAILURE(status) || !getTimeZone().useDaylightTime()) {
341         return FALSE;
342     }
343 
344     // Force an update of the state of the Calendar.
345     ((IndianCalendar*)this)-&gt;complete(status); // cast away const
346 
347     return (UBool)(U_SUCCESS(status) ? (internalGet(UCAL_DST_OFFSET) != 0) : FALSE);
348 }
349 
<span class="line-removed">350 // default century</span>
<span class="line-removed">351 const UDate     IndianCalendar::fgSystemDefaultCentury          = DBL_MIN;</span>
<span class="line-removed">352 const int32_t   IndianCalendar::fgSystemDefaultCenturyYear      = -1;</span>
353 
<span class="line-modified">354 UDate           IndianCalendar::fgSystemDefaultCenturyStart     = DBL_MIN;</span>
<span class="line-modified">355 int32_t         IndianCalendar::fgSystemDefaultCenturyStartYear = -1;</span>






356 
357 
358 UBool IndianCalendar::haveDefaultCentury() const
359 {
360     return TRUE;
361 }
362 
<span class="line-modified">363 UDate IndianCalendar::defaultCenturyStart() const</span>

364 {
<span class="line-modified">365     return internalGetDefaultCenturyStart();</span>
<span class="line-modified">366 }</span>


367 
<span class="line-modified">368 int32_t IndianCalendar::defaultCenturyStartYear() const</span>
<span class="line-modified">369 {</span>
<span class="line-modified">370     return internalGetDefaultCenturyStartYear();</span>
<span class="line-modified">371 }</span>
372 
<span class="line-modified">373 UDate</span>
<span class="line-modified">374 IndianCalendar::internalGetDefaultCenturyStart() const</span>
<span class="line-removed">375 {</span>
<span class="line-removed">376     // lazy-evaluate systemDefaultCenturyStart</span>
<span class="line-removed">377     UBool needsUpdate;</span>
<span class="line-removed">378     {</span>
<span class="line-removed">379         Mutex m;</span>
<span class="line-removed">380         needsUpdate = (fgSystemDefaultCenturyStart == fgSystemDefaultCentury);</span>
<span class="line-removed">381     }</span>
382 
<span class="line-modified">383     if (needsUpdate) {</span>
<span class="line-modified">384         initializeSystemDefaultCentury();</span>
385     }


386 
<span class="line-removed">387     // use defaultCenturyStart unless it&#39;s the flag value;</span>
<span class="line-removed">388     // then use systemDefaultCenturyStart</span>
389 
<span class="line-modified">390     return fgSystemDefaultCenturyStart;</span>





391 }
392 
393 int32_t
<span class="line-modified">394 IndianCalendar::internalGetDefaultCenturyStartYear() const</span>
395 {
396     // lazy-evaluate systemDefaultCenturyStartYear
<span class="line-modified">397     UBool needsUpdate;</span>
<span class="line-modified">398     {</span>
<span class="line-removed">399         Mutex m;</span>
<span class="line-removed">400 </span>
<span class="line-removed">401         needsUpdate = (fgSystemDefaultCenturyStart == fgSystemDefaultCentury);</span>
<span class="line-removed">402     }</span>
<span class="line-removed">403 </span>
<span class="line-removed">404     if (needsUpdate) {</span>
<span class="line-removed">405         initializeSystemDefaultCentury();</span>
<span class="line-removed">406     }</span>
<span class="line-removed">407 </span>
<span class="line-removed">408     // use defaultCenturyStart unless it&#39;s the flag value;</span>
<span class="line-removed">409     // then use systemDefaultCenturyStartYear</span>
<span class="line-removed">410 </span>
<span class="line-removed">411     return    fgSystemDefaultCenturyStartYear;</span>
412 }
413 
<span class="line-removed">414 void</span>
<span class="line-removed">415 IndianCalendar::initializeSystemDefaultCentury()</span>
<span class="line-removed">416 {</span>
<span class="line-removed">417     // initialize systemDefaultCentury and systemDefaultCenturyYear based</span>
<span class="line-removed">418     // on the current time.  They&#39;ll be set to 80 years before</span>
<span class="line-removed">419     // the current time.</span>
<span class="line-removed">420     // No point in locking as it should be idempotent.</span>
<span class="line-removed">421     if (fgSystemDefaultCenturyStart == fgSystemDefaultCentury) {</span>
<span class="line-removed">422         UErrorCode status = U_ZERO_ERROR;</span>
<span class="line-removed">423 </span>
<span class="line-removed">424         IndianCalendar calendar(Locale(&quot;@calendar=Indian&quot;),status);</span>
<span class="line-removed">425         if (U_SUCCESS(status)) {</span>
<span class="line-removed">426             calendar.setTime(Calendar::getNow(), status);</span>
<span class="line-removed">427             calendar.add(UCAL_YEAR, -80, status);</span>
<span class="line-removed">428 </span>
<span class="line-removed">429             UDate    newStart = calendar.getTime(status);</span>
<span class="line-removed">430             int32_t  newYear  = calendar.get(UCAL_YEAR, status);</span>
<span class="line-removed">431 </span>
<span class="line-removed">432             {</span>
<span class="line-removed">433                 Mutex m;</span>
<span class="line-removed">434 </span>
<span class="line-removed">435                 fgSystemDefaultCenturyStart = newStart;</span>
<span class="line-removed">436                 fgSystemDefaultCenturyStartYear = newYear;</span>
<span class="line-removed">437             }</span>
<span class="line-removed">438         }</span>
<span class="line-removed">439 </span>
<span class="line-removed">440         // We have no recourse upon failure unless we want to propagate the failure</span>
<span class="line-removed">441         // out.</span>
<span class="line-removed">442     }</span>
<span class="line-removed">443 }</span>
444 
445 UOBJECT_DEFINE_RTTI_IMPLEMENTATION(IndianCalendar)
446 
447 U_NAMESPACE_END
448 
449 #endif
450 
</pre>
</td>
<td>
<hr />
<pre>
330    internalSet(UCAL_YEAR, IndianYear);
331    internalSet(UCAL_MONTH, IndianMonth);
332    internalSet(UCAL_DAY_OF_MONTH, IndianDayOfMonth);
333    internalSet(UCAL_DAY_OF_YEAR, yday + 1); // yday is 0-based
334 }
335 
336 UBool
337 IndianCalendar::inDaylightTime(UErrorCode&amp; status) const
338 {
339     // copied from GregorianCalendar
340     if (U_FAILURE(status) || !getTimeZone().useDaylightTime()) {
341         return FALSE;
342     }
343 
344     // Force an update of the state of the Calendar.
345     ((IndianCalendar*)this)-&gt;complete(status); // cast away const
346 
347     return (UBool)(U_SUCCESS(status) ? (internalGet(UCAL_DST_OFFSET) != 0) : FALSE);
348 }
349 



350 
<span class="line-modified">351 /**</span>
<span class="line-modified">352  * The system maintains a static default century start date and Year.  They are</span>
<span class="line-added">353  * initialized the first time they are used.  Once the system default century date</span>
<span class="line-added">354  * and year are set, they do not change.</span>
<span class="line-added">355  */</span>
<span class="line-added">356 static UDate           gSystemDefaultCenturyStart       = DBL_MIN;</span>
<span class="line-added">357 static int32_t         gSystemDefaultCenturyStartYear   = -1;</span>
<span class="line-added">358 static icu::UInitOnce  gSystemDefaultCenturyInit        = U_INITONCE_INITIALIZER;</span>
359 
360 
361 UBool IndianCalendar::haveDefaultCentury() const
362 {
363     return TRUE;
364 }
365 
<span class="line-modified">366 static void U_CALLCONV</span>
<span class="line-added">367 initializeSystemDefaultCentury()</span>
368 {
<span class="line-modified">369     // initialize systemDefaultCentury and systemDefaultCenturyYear based</span>
<span class="line-modified">370     // on the current time.  They&#39;ll be set to 80 years before</span>
<span class="line-added">371     // the current time.</span>
<span class="line-added">372     UErrorCode status = U_ZERO_ERROR;</span>
373 
<span class="line-modified">374     IndianCalendar calendar ( Locale ( &quot;@calendar=Indian&quot; ), status);</span>
<span class="line-modified">375     if ( U_SUCCESS ( status ) ) {</span>
<span class="line-modified">376         calendar.setTime ( Calendar::getNow(), status );</span>
<span class="line-modified">377         calendar.add ( UCAL_YEAR, -80, status );</span>
378 
<span class="line-modified">379         UDate    newStart = calendar.getTime ( status );</span>
<span class="line-modified">380         int32_t  newYear  = calendar.get ( UCAL_YEAR, status );</span>







381 
<span class="line-modified">382         gSystemDefaultCenturyStart = newStart;</span>
<span class="line-modified">383         gSystemDefaultCenturyStartYear = newYear;</span>
384     }
<span class="line-added">385     // We have no recourse upon failure.</span>
<span class="line-added">386 }</span>
387 


388 
<span class="line-modified">389 UDate</span>
<span class="line-added">390 IndianCalendar::defaultCenturyStart() const</span>
<span class="line-added">391 {</span>
<span class="line-added">392     // lazy-evaluate systemDefaultCenturyStart</span>
<span class="line-added">393     umtx_initOnce(gSystemDefaultCenturyInit, &amp;initializeSystemDefaultCentury);</span>
<span class="line-added">394     return gSystemDefaultCenturyStart;</span>
395 }
396 
397 int32_t
<span class="line-modified">398 IndianCalendar::defaultCenturyStartYear() const</span>
399 {
400     // lazy-evaluate systemDefaultCenturyStartYear
<span class="line-modified">401     umtx_initOnce(gSystemDefaultCenturyInit, &amp;initializeSystemDefaultCentury);</span>
<span class="line-modified">402     return    gSystemDefaultCenturyStartYear;</span>













403 }
404 






























405 
406 UOBJECT_DEFINE_RTTI_IMPLEMENTATION(IndianCalendar)
407 
408 U_NAMESPACE_END
409 
410 #endif
411 
</pre>
</td>
</tr>
</table>
<center><a href="i18n_uwp.vcxproj.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="indiancal.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>