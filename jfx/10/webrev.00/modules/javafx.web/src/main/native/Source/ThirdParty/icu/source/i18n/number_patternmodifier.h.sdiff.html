<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/number_patternmodifier.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="number_patternmodifier.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="number_patternstring.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/number_patternmodifier.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 // © 2017 and later: Unicode, Inc. and others.
  2 // License &amp; terms of use: http://www.unicode.org/copyright.html
  3 
  4 #include &quot;unicode/utypes.h&quot;
  5 
  6 #if !UCONFIG_NO_FORMATTING
  7 #ifndef __NUMBER_PATTERNMODIFIER_H__
  8 #define __NUMBER_PATTERNMODIFIER_H__
  9 
 10 #include &quot;standardplural.h&quot;
 11 #include &quot;unicode/numberformatter.h&quot;
 12 #include &quot;number_patternstring.h&quot;
 13 #include &quot;number_types.h&quot;
 14 #include &quot;number_modifiers.h&quot;
 15 #include &quot;number_utils.h&quot;
 16 #include &quot;number_currencysymbols.h&quot;
 17 
 18 U_NAMESPACE_BEGIN
 19 
 20 // Export an explicit template instantiation of the LocalPointer that is used as a
<span class="line-modified"> 21 // data member of ParameterizedModifier.</span>
 22 // (When building DLLs for Windows this is required.)
 23 #if U_PF_WINDOWS &lt;= U_PLATFORM &amp;&amp; U_PLATFORM &lt;= U_PF_CYGWIN

 24 // Ignore warning 4661 as LocalPointerBase does not use operator== or operator!=
<span class="line-modified"> 25 #pragma warning(suppress: 4661)</span>
<span class="line-modified"> 26 template class U_I18N_API LocalPointerBase&lt;number::impl::ParameterizedModifier&gt;;</span>
<span class="line-modified"> 27 template class U_I18N_API LocalPointer&lt;number::impl::ParameterizedModifier&gt;;</span>





 28 #endif
 29 
 30 namespace number {
 31 namespace impl {
 32 
 33 // Forward declaration
 34 class MutablePatternModifier;
 35 
 36 // Exported as U_I18N_API because it is needed for the unit test PatternModifierTest
 37 class U_I18N_API ImmutablePatternModifier : public MicroPropsGenerator, public UMemory {
 38   public:
 39     ~ImmutablePatternModifier() U_OVERRIDE = default;
 40 
 41     void processQuantity(DecimalQuantity&amp;, MicroProps&amp; micros, UErrorCode&amp; status) const U_OVERRIDE;
 42 
<span class="line-modified"> 43     void applyToMicros(MicroProps&amp; micros, DecimalQuantity&amp; quantity) const;</span>
 44 
 45     const Modifier* getModifier(int8_t signum, StandardPlural::Form plural) const;
 46 
 47   private:
<span class="line-modified"> 48     ImmutablePatternModifier(ParameterizedModifier* pm, const PluralRules* rules,</span>
 49                              const MicroPropsGenerator* parent);
 50 
<span class="line-modified"> 51     const LocalPointer&lt;ParameterizedModifier&gt; pm;</span>
 52     const PluralRules* rules;
 53     const MicroPropsGenerator* parent;
 54 
 55     friend class MutablePatternModifier;
 56 };
 57 
 58 /**
 59  * This class is a {@link Modifier} that wraps a decimal format pattern. It applies the pattern&#39;s affixes in
 60  * {@link Modifier#apply}.
 61  *
 62  * &lt;p&gt;
 63  * In addition to being a Modifier, this class contains the business logic for substituting the correct locale symbols
 64  * into the affixes of the decimal format pattern.
 65  *
 66  * &lt;p&gt;
 67  * In order to use this class, create a new instance and call the following four setters: {@link #setPatternInfo},
 68  * {@link #setPatternAttributes}, {@link #setSymbols}, and {@link #setNumberProperties}. After calling these four
 69  * setters, the instance will be ready for use as a Modifier.
 70  *
 71  * &lt;p&gt;
</pre>
<hr />
<pre>
 78         : public MicroPropsGenerator,
 79           public Modifier,
 80           public SymbolProvider,
 81           public UMemory {
 82   public:
 83 
 84     ~MutablePatternModifier() U_OVERRIDE = default;
 85 
 86     /**
 87      * @param isStrong
 88      *            Whether the modifier should be considered strong. For more information, see
 89      *            {@link Modifier#isStrong()}. Most of the time, decimal format pattern modifiers should be considered
 90      *            as non-strong.
 91      */
 92     explicit MutablePatternModifier(bool isStrong);
 93 
 94     /**
 95      * Sets a reference to the parsed decimal format pattern, usually obtained from
 96      * {@link PatternStringParser#parseToPatternInfo(String)}, but any implementation of {@link AffixPatternProvider} is
 97      * accepted.



 98      */
<span class="line-modified"> 99     void setPatternInfo(const AffixPatternProvider *patternInfo);</span>
100 
101     /**
102      * Sets attributes that imply changes to the literal interpretation of the pattern string affixes.
103      *
104      * @param signDisplay
105      *            Whether to force a plus sign on positive numbers.
106      * @param perMille
107      *            Whether to substitute the percent sign in the pattern with a permille sign.
108      */
109     void setPatternAttributes(UNumberSignDisplay signDisplay, bool perMille);
110 
111     /**
112      * Sets locale-specific details that affect the symbols substituted into the pattern string affixes.
113      *
114      * @param symbols
115      *            The desired instance of DecimalFormatSymbols.
116      * @param currencySymbols
117      *            The currency symbols to be used when substituting currency values into the affixes.
118      * @param unitWidth
119      *            The width used to render currencies.
</pre>
<hr />
<pre>
161      * and can be saved for future use. The number properties in the current instance are mutated; all other properties
162      * are left untouched.
163      *
164      * &lt;p&gt;
165      * CREATES A NEW HEAP OBJECT; THE CALLER GETS OWNERSHIP.
166      *
167      * @param parent
168      *            The QuantityChain to which to chain this immutable.
169      * @return An immutable that supports both positive and negative numbers.
170      */
171     ImmutablePatternModifier *
172     createImmutableAndChain(const MicroPropsGenerator *parent, UErrorCode &amp;status);
173 
174     MicroPropsGenerator &amp;addToChain(const MicroPropsGenerator *parent);
175 
176     void processQuantity(DecimalQuantity &amp;, MicroProps &amp;micros, UErrorCode &amp;status) const U_OVERRIDE;
177 
178     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
179                   UErrorCode &amp;status) const U_OVERRIDE;
180 
<span class="line-modified">181     int32_t getPrefixLength(UErrorCode &amp;status) const U_OVERRIDE;</span>
182 
<span class="line-modified">183     int32_t getCodePointCount(UErrorCode &amp;status) const U_OVERRIDE;</span>
184 
185     bool isStrong() const U_OVERRIDE;
186 






187     /**
188      * Returns the string that substitutes a given symbol type in a pattern.
189      */
190     UnicodeString getSymbol(AffixPatternType type) const U_OVERRIDE;
191 
192     UnicodeString toUnicodeString() const;
193 
194   private:
195     // Modifier details (initialized in constructor)
196     const bool fStrong;
197 
198     // Pattern details (initialized in setPatternInfo and setPatternAttributes)
<span class="line-modified">199     const AffixPatternProvider *patternInfo;</span>
<span class="line-modified">200     UNumberSignDisplay signDisplay;</span>
<span class="line-modified">201     bool perMilleReplacesPercent;</span>

202 
203     // Symbol details (initialized in setSymbols)
<span class="line-modified">204     const DecimalFormatSymbols *symbols;</span>
<span class="line-modified">205     UNumberUnitWidth unitWidth;</span>
<span class="line-modified">206     const CurrencySymbols *currencySymbols;</span>
<span class="line-modified">207     const PluralRules *rules;</span>
208 
209     // Number details (initialized in setNumberProperties)
<span class="line-modified">210     int8_t signum;</span>
<span class="line-modified">211     StandardPlural::Form plural;</span>
212 
213     // QuantityChain details (initialized in addToChain)
<span class="line-modified">214     const MicroPropsGenerator *parent;</span>
215 
216     // Transient fields for rendering
217     UnicodeString currentAffix;
218 
219     /**
220      * Uses the current properties to create a single {@link ConstantMultiFieldModifier} with currency spacing support
221      * if required.
222      *
223      * &lt;p&gt;
224      * CREATES A NEW HEAP OBJECT; THE CALLER GETS OWNERSHIP.
225      *
226      * @param a
227      *            A working NumberStringBuilder object; passed from the outside to prevent the need to create many new
228      *            instances if this method is called in a loop.
229      * @param b
230      *            Another working NumberStringBuilder object.
231      * @return The constant modifier object.
232      */
233     ConstantMultiFieldModifier *createConstantModifier(UErrorCode &amp;status);
234 
</pre>
</td>
<td>
<hr />
<pre>
  1 // © 2017 and later: Unicode, Inc. and others.
  2 // License &amp; terms of use: http://www.unicode.org/copyright.html
  3 
  4 #include &quot;unicode/utypes.h&quot;
  5 
  6 #if !UCONFIG_NO_FORMATTING
  7 #ifndef __NUMBER_PATTERNMODIFIER_H__
  8 #define __NUMBER_PATTERNMODIFIER_H__
  9 
 10 #include &quot;standardplural.h&quot;
 11 #include &quot;unicode/numberformatter.h&quot;
 12 #include &quot;number_patternstring.h&quot;
 13 #include &quot;number_types.h&quot;
 14 #include &quot;number_modifiers.h&quot;
 15 #include &quot;number_utils.h&quot;
 16 #include &quot;number_currencysymbols.h&quot;
 17 
 18 U_NAMESPACE_BEGIN
 19 
 20 // Export an explicit template instantiation of the LocalPointer that is used as a
<span class="line-modified"> 21 // data member of AdoptingModifierStore.</span>
 22 // (When building DLLs for Windows this is required.)
 23 #if U_PF_WINDOWS &lt;= U_PLATFORM &amp;&amp; U_PLATFORM &lt;= U_PF_CYGWIN
<span class="line-added"> 24 #if defined(_MSC_VER)</span>
 25 // Ignore warning 4661 as LocalPointerBase does not use operator== or operator!=
<span class="line-modified"> 26 #pragma warning(push)</span>
<span class="line-modified"> 27 #pragma warning(disable : 4661)</span>
<span class="line-modified"> 28 #endif</span>
<span class="line-added"> 29 template class U_I18N_API LocalPointerBase&lt;number::impl::AdoptingModifierStore&gt;;</span>
<span class="line-added"> 30 template class U_I18N_API LocalPointer&lt;number::impl::AdoptingModifierStore&gt;;</span>
<span class="line-added"> 31 #if defined(_MSC_VER)</span>
<span class="line-added"> 32 #pragma warning(pop)</span>
<span class="line-added"> 33 #endif</span>
 34 #endif
 35 
 36 namespace number {
 37 namespace impl {
 38 
 39 // Forward declaration
 40 class MutablePatternModifier;
 41 
 42 // Exported as U_I18N_API because it is needed for the unit test PatternModifierTest
 43 class U_I18N_API ImmutablePatternModifier : public MicroPropsGenerator, public UMemory {
 44   public:
 45     ~ImmutablePatternModifier() U_OVERRIDE = default;
 46 
 47     void processQuantity(DecimalQuantity&amp;, MicroProps&amp; micros, UErrorCode&amp; status) const U_OVERRIDE;
 48 
<span class="line-modified"> 49     void applyToMicros(MicroProps&amp; micros, const DecimalQuantity&amp; quantity, UErrorCode&amp; status) const;</span>
 50 
 51     const Modifier* getModifier(int8_t signum, StandardPlural::Form plural) const;
 52 
 53   private:
<span class="line-modified"> 54     ImmutablePatternModifier(AdoptingModifierStore* pm, const PluralRules* rules,</span>
 55                              const MicroPropsGenerator* parent);
 56 
<span class="line-modified"> 57     const LocalPointer&lt;AdoptingModifierStore&gt; pm;</span>
 58     const PluralRules* rules;
 59     const MicroPropsGenerator* parent;
 60 
 61     friend class MutablePatternModifier;
 62 };
 63 
 64 /**
 65  * This class is a {@link Modifier} that wraps a decimal format pattern. It applies the pattern&#39;s affixes in
 66  * {@link Modifier#apply}.
 67  *
 68  * &lt;p&gt;
 69  * In addition to being a Modifier, this class contains the business logic for substituting the correct locale symbols
 70  * into the affixes of the decimal format pattern.
 71  *
 72  * &lt;p&gt;
 73  * In order to use this class, create a new instance and call the following four setters: {@link #setPatternInfo},
 74  * {@link #setPatternAttributes}, {@link #setSymbols}, and {@link #setNumberProperties}. After calling these four
 75  * setters, the instance will be ready for use as a Modifier.
 76  *
 77  * &lt;p&gt;
</pre>
<hr />
<pre>
 84         : public MicroPropsGenerator,
 85           public Modifier,
 86           public SymbolProvider,
 87           public UMemory {
 88   public:
 89 
 90     ~MutablePatternModifier() U_OVERRIDE = default;
 91 
 92     /**
 93      * @param isStrong
 94      *            Whether the modifier should be considered strong. For more information, see
 95      *            {@link Modifier#isStrong()}. Most of the time, decimal format pattern modifiers should be considered
 96      *            as non-strong.
 97      */
 98     explicit MutablePatternModifier(bool isStrong);
 99 
100     /**
101      * Sets a reference to the parsed decimal format pattern, usually obtained from
102      * {@link PatternStringParser#parseToPatternInfo(String)}, but any implementation of {@link AffixPatternProvider} is
103      * accepted.
<span class="line-added">104      *</span>
<span class="line-added">105      * @param field</span>
<span class="line-added">106      *            Which field to use for literal characters in the pattern.</span>
107      */
<span class="line-modified">108     void setPatternInfo(const AffixPatternProvider *patternInfo, Field field);</span>
109 
110     /**
111      * Sets attributes that imply changes to the literal interpretation of the pattern string affixes.
112      *
113      * @param signDisplay
114      *            Whether to force a plus sign on positive numbers.
115      * @param perMille
116      *            Whether to substitute the percent sign in the pattern with a permille sign.
117      */
118     void setPatternAttributes(UNumberSignDisplay signDisplay, bool perMille);
119 
120     /**
121      * Sets locale-specific details that affect the symbols substituted into the pattern string affixes.
122      *
123      * @param symbols
124      *            The desired instance of DecimalFormatSymbols.
125      * @param currencySymbols
126      *            The currency symbols to be used when substituting currency values into the affixes.
127      * @param unitWidth
128      *            The width used to render currencies.
</pre>
<hr />
<pre>
170      * and can be saved for future use. The number properties in the current instance are mutated; all other properties
171      * are left untouched.
172      *
173      * &lt;p&gt;
174      * CREATES A NEW HEAP OBJECT; THE CALLER GETS OWNERSHIP.
175      *
176      * @param parent
177      *            The QuantityChain to which to chain this immutable.
178      * @return An immutable that supports both positive and negative numbers.
179      */
180     ImmutablePatternModifier *
181     createImmutableAndChain(const MicroPropsGenerator *parent, UErrorCode &amp;status);
182 
183     MicroPropsGenerator &amp;addToChain(const MicroPropsGenerator *parent);
184 
185     void processQuantity(DecimalQuantity &amp;, MicroProps &amp;micros, UErrorCode &amp;status) const U_OVERRIDE;
186 
187     int32_t apply(NumberStringBuilder &amp;output, int32_t leftIndex, int32_t rightIndex,
188                   UErrorCode &amp;status) const U_OVERRIDE;
189 
<span class="line-modified">190     int32_t getPrefixLength() const U_OVERRIDE;</span>
191 
<span class="line-modified">192     int32_t getCodePointCount() const U_OVERRIDE;</span>
193 
194     bool isStrong() const U_OVERRIDE;
195 
<span class="line-added">196     bool containsField(UNumberFormatFields field) const U_OVERRIDE;</span>
<span class="line-added">197 </span>
<span class="line-added">198     void getParameters(Parameters&amp; output) const U_OVERRIDE;</span>
<span class="line-added">199 </span>
<span class="line-added">200     bool semanticallyEquivalent(const Modifier&amp; other) const U_OVERRIDE;</span>
<span class="line-added">201 </span>
202     /**
203      * Returns the string that substitutes a given symbol type in a pattern.
204      */
205     UnicodeString getSymbol(AffixPatternType type) const U_OVERRIDE;
206 
207     UnicodeString toUnicodeString() const;
208 
209   private:
210     // Modifier details (initialized in constructor)
211     const bool fStrong;
212 
213     // Pattern details (initialized in setPatternInfo and setPatternAttributes)
<span class="line-modified">214     const AffixPatternProvider *fPatternInfo;</span>
<span class="line-modified">215     Field fField;</span>
<span class="line-modified">216     UNumberSignDisplay fSignDisplay;</span>
<span class="line-added">217     bool fPerMilleReplacesPercent;</span>
218 
219     // Symbol details (initialized in setSymbols)
<span class="line-modified">220     const DecimalFormatSymbols *fSymbols;</span>
<span class="line-modified">221     UNumberUnitWidth fUnitWidth;</span>
<span class="line-modified">222     const CurrencySymbols *fCurrencySymbols;</span>
<span class="line-modified">223     const PluralRules *fRules;</span>
224 
225     // Number details (initialized in setNumberProperties)
<span class="line-modified">226     int8_t fSignum;</span>
<span class="line-modified">227     StandardPlural::Form fPlural;</span>
228 
229     // QuantityChain details (initialized in addToChain)
<span class="line-modified">230     const MicroPropsGenerator *fParent;</span>
231 
232     // Transient fields for rendering
233     UnicodeString currentAffix;
234 
235     /**
236      * Uses the current properties to create a single {@link ConstantMultiFieldModifier} with currency spacing support
237      * if required.
238      *
239      * &lt;p&gt;
240      * CREATES A NEW HEAP OBJECT; THE CALLER GETS OWNERSHIP.
241      *
242      * @param a
243      *            A working NumberStringBuilder object; passed from the outside to prevent the need to create many new
244      *            instances if this method is called in a loop.
245      * @param b
246      *            Another working NumberStringBuilder object.
247      * @return The constant modifier object.
248      */
249     ConstantMultiFieldModifier *createConstantModifier(UErrorCode &amp;status);
250 
</pre>
</td>
</tr>
</table>
<center><a href="number_patternmodifier.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="number_patternstring.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>