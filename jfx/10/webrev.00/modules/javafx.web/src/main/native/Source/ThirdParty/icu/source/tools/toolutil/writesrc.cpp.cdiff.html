<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/tools/toolutil/writesrc.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="unewdata.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="writesrc.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/tools/toolutil/writesrc.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 20,17 ***</span>
  
  #include &lt;stdio.h&gt;
  #include &lt;time.h&gt;
  #include &quot;unicode/utypes.h&quot;
  #include &quot;unicode/putil.h&quot;
  #include &quot;utrie2.h&quot;
  #include &quot;cstring.h&quot;
  #include &quot;writesrc.h&quot;
  
  static FILE *
  usrc_createWithHeader(const char *path, const char *filename,
<span class="line-modified">!                       const char *generator, const char *header) {</span>
      char buffer[1024];
      const char *p;
      char *q;
      FILE *f;
      char c;
<span class="line-new-header">--- 20,18 ---</span>
  
  #include &lt;stdio.h&gt;
  #include &lt;time.h&gt;
  #include &quot;unicode/utypes.h&quot;
  #include &quot;unicode/putil.h&quot;
<span class="line-added">+ #include &quot;unicode/ucptrie.h&quot;</span>
  #include &quot;utrie2.h&quot;
  #include &quot;cstring.h&quot;
  #include &quot;writesrc.h&quot;
  
  static FILE *
  usrc_createWithHeader(const char *path, const char *filename,
<span class="line-modified">!                       const char *header, const char *generator) {</span>
      char buffer[1024];
      const char *p;
      char *q;
      FILE *f;
      char c;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 69,24 ***</span>
      }
      return f;
  }
  
  U_CAPI FILE * U_EXPORT2
<span class="line-modified">! usrc_create(const char *path, const char *filename, const char *generator) {</span>
<span class="line-modified">!     // TODO: Add parameter for the first year this file was generated, not before 2016.</span>
<span class="line-modified">!     static const char *header=</span>
<span class="line-modified">!         &quot;// © 2016 and later: Unicode, Inc. and others.\n&quot;</span>
<span class="line-modified">!         &quot;// License &amp; terms of use: http://www.unicode.org/copyright.html\n&quot;</span>
<span class="line-modified">!         &quot;//\n&quot;</span>
<span class="line-modified">!         &quot;// Copyright (C) 1999-2016, International Business Machines\n&quot;</span>
<span class="line-modified">!         &quot;// Corporation and others.  All Rights Reserved.\n&quot;</span>
<span class="line-modified">!         &quot;//\n&quot;</span>
<span class="line-modified">!         &quot;// file name: %s\n&quot;</span>
<span class="line-modified">!         &quot;//\n&quot;</span>
<span class="line-modified">!         &quot;// machine-generated by: %s\n&quot;</span>
<span class="line-modified">!         &quot;\n\n&quot;;</span>
<span class="line-modified">!     return usrc_createWithHeader(path, filename, generator, header);</span>
  }
  
  U_CAPI FILE * U_EXPORT2
  usrc_createTextData(const char *path, const char *filename, const char *generator) {
      // TODO: Add parameter for the first year this file was generated, not before 2016.
<span class="line-new-header">--- 70,38 ---</span>
      }
      return f;
  }
  
  U_CAPI FILE * U_EXPORT2
<span class="line-modified">! usrc_create(const char *path, const char *filename, int32_t copyrightYear, const char *generator) {</span>
<span class="line-modified">!     const char *header;</span>
<span class="line-modified">!     char buffer[200];</span>
<span class="line-modified">!     if(copyrightYear&lt;=2016) {</span>
<span class="line-modified">!         header=</span>
<span class="line-modified">!             &quot;// © 2016 and later: Unicode, Inc. and others.\n&quot;</span>
<span class="line-modified">!             &quot;// License &amp; terms of use: http://www.unicode.org/copyright.html\n&quot;</span>
<span class="line-modified">!             &quot;//\n&quot;</span>
<span class="line-modified">!             &quot;// Copyright (C) 1999-2016, International Business Machines\n&quot;</span>
<span class="line-modified">!             &quot;// Corporation and others.  All Rights Reserved.\n&quot;</span>
<span class="line-modified">!             &quot;//\n&quot;</span>
<span class="line-modified">!             &quot;// file name: %s\n&quot;</span>
<span class="line-modified">!             &quot;//\n&quot;</span>
<span class="line-modified">!             &quot;// machine-generated by: %s\n&quot;</span>
<span class="line-added">+             &quot;\n\n&quot;;</span>
<span class="line-added">+     } else {</span>
<span class="line-added">+         sprintf(buffer,</span>
<span class="line-added">+                 &quot;// © %d and later: Unicode, Inc. and others.\n&quot;</span>
<span class="line-added">+                 &quot;// License &amp; terms of use: http://www.unicode.org/copyright.html\n&quot;</span>
<span class="line-added">+                 &quot;//\n&quot;</span>
<span class="line-added">+                 &quot;// file name: %%s\n&quot;</span>
<span class="line-added">+                 &quot;//\n&quot;</span>
<span class="line-added">+                 &quot;// machine-generated by: %%s\n&quot;</span>
<span class="line-added">+                 &quot;\n\n&quot;,</span>
<span class="line-added">+                 (int)copyrightYear);</span>
<span class="line-added">+         header=buffer;</span>
<span class="line-added">+     }</span>
<span class="line-added">+     return usrc_createWithHeader(path, filename, header, generator);</span>
  }
  
  U_CAPI FILE * U_EXPORT2
  usrc_createTextData(const char *path, const char *filename, const char *generator) {
      // TODO: Add parameter for the first year this file was generated, not before 2016.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 98,11 ***</span>
          &quot;#\n&quot;
          &quot;# file name: %s\n&quot;
          &quot;#\n&quot;
          &quot;# machine-generated by: %s\n&quot;
          &quot;\n\n&quot;;
<span class="line-modified">!     return usrc_createWithHeader(path, filename, generator, header);</span>
  }
  
  U_CAPI void U_EXPORT2
  usrc_writeArray(FILE *f,
                  const char *prefix,
<span class="line-new-header">--- 113,11 ---</span>
          &quot;#\n&quot;
          &quot;# file name: %s\n&quot;
          &quot;#\n&quot;
          &quot;# machine-generated by: %s\n&quot;
          &quot;\n\n&quot;;
<span class="line-modified">!     return usrc_createWithHeader(path, filename, header, generator);</span>
  }
  
  U_CAPI void U_EXPORT2
  usrc_writeArray(FILE *f,
                  const char *prefix,
</pre>
<hr />
<pre>
<span class="line-old-header">*** 226,10 ***</span>
<span class="line-new-header">--- 241,72 ---</span>
      if(postfix!=NULL) {
          fputs(postfix, f);
      }
  }
  
<span class="line-added">+ U_CAPI void U_EXPORT2</span>
<span class="line-added">+ usrc_writeUCPTrieArrays(FILE *f,</span>
<span class="line-added">+                         const char *indexPrefix, const char *dataPrefix,</span>
<span class="line-added">+                         const UCPTrie *pTrie,</span>
<span class="line-added">+                         const char *postfix) {</span>
<span class="line-added">+     usrc_writeArray(f, indexPrefix, pTrie-&gt;index, 16, pTrie-&gt;indexLength, postfix);</span>
<span class="line-added">+     int32_t width=</span>
<span class="line-added">+         pTrie-&gt;valueWidth==UCPTRIE_VALUE_BITS_16 ? 16 :</span>
<span class="line-added">+         pTrie-&gt;valueWidth==UCPTRIE_VALUE_BITS_32 ? 32 :</span>
<span class="line-added">+         pTrie-&gt;valueWidth==UCPTRIE_VALUE_BITS_8 ? 8 : 0;</span>
<span class="line-added">+     usrc_writeArray(f, dataPrefix, pTrie-&gt;data.ptr0, width, pTrie-&gt;dataLength, postfix);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ U_CAPI void U_EXPORT2</span>
<span class="line-added">+ usrc_writeUCPTrieStruct(FILE *f,</span>
<span class="line-added">+                         const char *prefix,</span>
<span class="line-added">+                         const UCPTrie *pTrie,</span>
<span class="line-added">+                         const char *indexName, const char *dataName,</span>
<span class="line-added">+                         const char *postfix) {</span>
<span class="line-added">+     if(prefix!=NULL) {</span>
<span class="line-added">+         fputs(prefix, f);</span>
<span class="line-added">+     }</span>
<span class="line-added">+     fprintf(</span>
<span class="line-added">+         f,</span>
<span class="line-added">+         &quot;    %s,\n&quot;             // index</span>
<span class="line-added">+         &quot;    { %s },\n&quot;,        // data (union)</span>
<span class="line-added">+         indexName,</span>
<span class="line-added">+         dataName);</span>
<span class="line-added">+     fprintf(</span>
<span class="line-added">+         f,</span>
<span class="line-added">+         &quot;    %ld, %ld,\n&quot;       // indexLength, dataLength</span>
<span class="line-added">+         &quot;    0x%lx, 0x%x,\n&quot;    // highStart, shifted12HighStart</span>
<span class="line-added">+         &quot;    %d, %d,\n&quot;         // type, valueWidth</span>
<span class="line-added">+         &quot;    0, 0,\n&quot;           // reserved32, reserved16</span>
<span class="line-added">+         &quot;    0x%x, 0x%lx,\n&quot;    // index3NullOffset, dataNullOffset</span>
<span class="line-added">+         &quot;    0x%lx,\n&quot;,         // nullValue</span>
<span class="line-added">+         (long)pTrie-&gt;indexLength, (long)pTrie-&gt;dataLength,</span>
<span class="line-added">+         (long)pTrie-&gt;highStart, pTrie-&gt;shifted12HighStart,</span>
<span class="line-added">+         pTrie-&gt;type, pTrie-&gt;valueWidth,</span>
<span class="line-added">+         pTrie-&gt;index3NullOffset, (long)pTrie-&gt;dataNullOffset,</span>
<span class="line-added">+         (long)pTrie-&gt;nullValue);</span>
<span class="line-added">+     if(postfix!=NULL) {</span>
<span class="line-added">+         fputs(postfix, f);</span>
<span class="line-added">+     }</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ U_CAPI void U_EXPORT2</span>
<span class="line-added">+ usrc_writeUCPTrie(FILE *f, const char *name, const UCPTrie *pTrie) {</span>
<span class="line-added">+     int32_t width=</span>
<span class="line-added">+         pTrie-&gt;valueWidth==UCPTRIE_VALUE_BITS_16 ? 16 :</span>
<span class="line-added">+         pTrie-&gt;valueWidth==UCPTRIE_VALUE_BITS_32 ? 32 :</span>
<span class="line-added">+         pTrie-&gt;valueWidth==UCPTRIE_VALUE_BITS_8 ? 8 : 0;</span>
<span class="line-added">+     char line[100], line2[100], line3[100];</span>
<span class="line-added">+     sprintf(line, &quot;static const uint16_t %s_trieIndex[%%ld]={\n&quot;, name);</span>
<span class="line-added">+     sprintf(line2, &quot;static const uint%d_t %s_trieData[%%ld]={\n&quot;, (int)width, name);</span>
<span class="line-added">+     usrc_writeUCPTrieArrays(f, line, line2, pTrie, &quot;\n};\n\n&quot;);</span>
<span class="line-added">+     sprintf(line, &quot;static const UCPTrie %s_trie={\n&quot;, name);</span>
<span class="line-added">+     sprintf(line2, &quot;%s_trieIndex&quot;, name);</span>
<span class="line-added">+     sprintf(line3, &quot;%s_trieData&quot;, name);</span>
<span class="line-added">+     usrc_writeUCPTrieStruct(f, line, pTrie, line2, line3, &quot;};\n\n&quot;);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  U_CAPI void U_EXPORT2
  usrc_writeArrayOfMostlyInvChars(FILE *f,
                                  const char *prefix,
                                  const char *p, int32_t length,
                                  const char *postfix) {
</pre>
<center><a href="unewdata.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../index.html" target="_top">index</a> <a href="writesrc.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>