<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/fphdlimp.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="fmtable.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="fphdlimp.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/i18n/fphdlimp.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 21 
 22 FieldPositionHandler::~FieldPositionHandler() {
 23 }
 24 
 25 void FieldPositionHandler::setShift(int32_t delta) {
 26   fShift = delta;
 27 }
 28 
 29 
 30 // utility subclass FieldPositionOnlyHandler
 31 
 32 FieldPositionOnlyHandler::FieldPositionOnlyHandler(FieldPosition&amp; _pos)
 33   : pos(_pos) {
 34 }
 35 
 36 FieldPositionOnlyHandler::~FieldPositionOnlyHandler() {
 37 }
 38 
 39 void
 40 FieldPositionOnlyHandler::addAttribute(int32_t id, int32_t start, int32_t limit) {
<span class="line-modified"> 41   if (pos.getField() == id) {</span>

 42     pos.setBeginIndex(start + fShift);
 43     pos.setEndIndex(limit + fShift);
 44   }
 45 }
 46 
 47 void
 48 FieldPositionOnlyHandler::shiftLast(int32_t delta) {
 49   if (delta != 0 &amp;&amp; pos.getField() != FieldPosition::DONT_CARE &amp;&amp; pos.getBeginIndex() != -1) {
 50     pos.setBeginIndex(delta + pos.getBeginIndex());
 51     pos.setEndIndex(delta + pos.getEndIndex());
 52   }
 53 }
 54 
 55 UBool
 56 FieldPositionOnlyHandler::isRecording(void) const {
 57   return pos.getField() != FieldPosition::DONT_CARE;
 58 }
 59 




 60 
 61 // utility subclass FieldPositionIteratorHandler
 62 
 63 FieldPositionIteratorHandler::FieldPositionIteratorHandler(FieldPositionIterator* posIter,
 64                                                            UErrorCode&amp; _status)
<span class="line-modified"> 65     : iter(posIter), vec(NULL), status(_status) {</span>
 66   if (iter &amp;&amp; U_SUCCESS(status)) {
 67     vec = new UVector32(status);
 68   }
 69 }
 70 






 71 FieldPositionIteratorHandler::~FieldPositionIteratorHandler() {
 72   // setData adopts the vec regardless of status, so it&#39;s safe to null it
 73   if (iter) {
 74     iter-&gt;setData(vec, status);
 75   }
 76   // if iter is null, we never allocated vec, so no need to free it
 77   vec = NULL;
 78 }
 79 
 80 void
 81 FieldPositionIteratorHandler::addAttribute(int32_t id, int32_t start, int32_t limit) {
<span class="line-modified"> 82   if (iter &amp;&amp; U_SUCCESS(status) &amp;&amp; start &lt; limit) {</span>
 83     int32_t size = vec-&gt;size();

 84     vec-&gt;addElement(id, status);
 85     vec-&gt;addElement(start + fShift, status);
 86     vec-&gt;addElement(limit + fShift, status);
 87     if (!U_SUCCESS(status)) {
 88       vec-&gt;setSize(size);
 89     }
 90   }
 91 }
 92 
 93 void
 94 FieldPositionIteratorHandler::shiftLast(int32_t delta) {
 95   if (U_SUCCESS(status) &amp;&amp; delta != 0) {
 96     int32_t i = vec-&gt;size();
 97     if (i &gt; 0) {
 98       --i;
 99       vec-&gt;setElementAt(delta + vec-&gt;elementAti(i), i);
100       --i;
101       vec-&gt;setElementAt(delta + vec-&gt;elementAti(i), i);
102     }
103   }
</pre>
</td>
<td>
<hr />
<pre>
 21 
 22 FieldPositionHandler::~FieldPositionHandler() {
 23 }
 24 
 25 void FieldPositionHandler::setShift(int32_t delta) {
 26   fShift = delta;
 27 }
 28 
 29 
 30 // utility subclass FieldPositionOnlyHandler
 31 
 32 FieldPositionOnlyHandler::FieldPositionOnlyHandler(FieldPosition&amp; _pos)
 33   : pos(_pos) {
 34 }
 35 
 36 FieldPositionOnlyHandler::~FieldPositionOnlyHandler() {
 37 }
 38 
 39 void
 40 FieldPositionOnlyHandler::addAttribute(int32_t id, int32_t start, int32_t limit) {
<span class="line-modified"> 41   if (pos.getField() == id &amp;&amp; (!acceptFirstOnly || !seenFirst)) {</span>
<span class="line-added"> 42     seenFirst = TRUE;</span>
 43     pos.setBeginIndex(start + fShift);
 44     pos.setEndIndex(limit + fShift);
 45   }
 46 }
 47 
 48 void
 49 FieldPositionOnlyHandler::shiftLast(int32_t delta) {
 50   if (delta != 0 &amp;&amp; pos.getField() != FieldPosition::DONT_CARE &amp;&amp; pos.getBeginIndex() != -1) {
 51     pos.setBeginIndex(delta + pos.getBeginIndex());
 52     pos.setEndIndex(delta + pos.getEndIndex());
 53   }
 54 }
 55 
 56 UBool
 57 FieldPositionOnlyHandler::isRecording(void) const {
 58   return pos.getField() != FieldPosition::DONT_CARE;
 59 }
 60 
<span class="line-added"> 61 void FieldPositionOnlyHandler::setAcceptFirstOnly(UBool acceptFirstOnly) {</span>
<span class="line-added"> 62   this-&gt;acceptFirstOnly = acceptFirstOnly;</span>
<span class="line-added"> 63 }</span>
<span class="line-added"> 64 </span>
 65 
 66 // utility subclass FieldPositionIteratorHandler
 67 
 68 FieldPositionIteratorHandler::FieldPositionIteratorHandler(FieldPositionIterator* posIter,
 69                                                            UErrorCode&amp; _status)
<span class="line-modified"> 70     : iter(posIter), vec(NULL), status(_status), fCategory(UFIELD_CATEGORY_UNDEFINED) {</span>
 71   if (iter &amp;&amp; U_SUCCESS(status)) {
 72     vec = new UVector32(status);
 73   }
 74 }
 75 
<span class="line-added"> 76 FieldPositionIteratorHandler::FieldPositionIteratorHandler(</span>
<span class="line-added"> 77     UVector32* vec,</span>
<span class="line-added"> 78     UErrorCode&amp; status)</span>
<span class="line-added"> 79     : iter(nullptr), vec(vec), status(status), fCategory(UFIELD_CATEGORY_UNDEFINED) {</span>
<span class="line-added"> 80 }</span>
<span class="line-added"> 81 </span>
 82 FieldPositionIteratorHandler::~FieldPositionIteratorHandler() {
 83   // setData adopts the vec regardless of status, so it&#39;s safe to null it
 84   if (iter) {
 85     iter-&gt;setData(vec, status);
 86   }
 87   // if iter is null, we never allocated vec, so no need to free it
 88   vec = NULL;
 89 }
 90 
 91 void
 92 FieldPositionIteratorHandler::addAttribute(int32_t id, int32_t start, int32_t limit) {
<span class="line-modified"> 93   if (vec &amp;&amp; U_SUCCESS(status) &amp;&amp; start &lt; limit) {</span>
 94     int32_t size = vec-&gt;size();
<span class="line-added"> 95     vec-&gt;addElement(fCategory, status);</span>
 96     vec-&gt;addElement(id, status);
 97     vec-&gt;addElement(start + fShift, status);
 98     vec-&gt;addElement(limit + fShift, status);
 99     if (!U_SUCCESS(status)) {
100       vec-&gt;setSize(size);
101     }
102   }
103 }
104 
105 void
106 FieldPositionIteratorHandler::shiftLast(int32_t delta) {
107   if (U_SUCCESS(status) &amp;&amp; delta != 0) {
108     int32_t i = vec-&gt;size();
109     if (i &gt; 0) {
110       --i;
111       vec-&gt;setElementAt(delta + vec-&gt;elementAti(i), i);
112       --i;
113       vec-&gt;setElementAt(delta + vec-&gt;elementAti(i), i);
114     }
115   }
</pre>
</td>
</tr>
</table>
<center><a href="fmtable.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="fphdlimp.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>