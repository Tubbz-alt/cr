<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/servls.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="serv.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="servnotf.cpp.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/ThirdParty/icu/source/common/servls.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  9  *******************************************************************************
 10  */
 11 #include &quot;unicode/utypes.h&quot;
 12 
 13 #if !UCONFIG_NO_SERVICE
 14 
 15 #include &quot;unicode/resbund.h&quot;
 16 #include &quot;uresimp.h&quot;
 17 #include &quot;cmemory.h&quot;
 18 #include &quot;servloc.h&quot;
 19 #include &quot;ustrfmt.h&quot;
 20 #include &quot;charstr.h&quot;
 21 #include &quot;uassert.h&quot;
 22 
 23 #define UNDERSCORE_CHAR ((UChar)0x005f)
 24 #define AT_SIGN_CHAR    ((UChar)64)
 25 #define PERIOD_CHAR     ((UChar)46)
 26 
 27 U_NAMESPACE_BEGIN
 28 
<span class="line-removed"> 29 static UMutex llock = U_MUTEX_INITIALIZER;</span>
 30 ICULocaleService::ICULocaleService()
 31   : fallbackLocale(Locale::getDefault())
 32 {
 33 }
 34 
 35 ICULocaleService::ICULocaleService(const UnicodeString&amp; dname)
 36   : ICUService(dname)
 37   , fallbackLocale(Locale::getDefault())
 38 {
 39 }
 40 
 41 ICULocaleService::~ICULocaleService()
 42 {
 43 }
 44 
 45 UObject*
 46 ICULocaleService::get(const Locale&amp; locale, UErrorCode&amp; status) const
 47 {
 48     return get(locale, LocaleKey::KIND_ANY, NULL, status);
 49 }
</pre>
<hr />
<pre>
247 public:
248     static UClassID U_EXPORT2 getStaticClassID(void);
249     virtual UClassID getDynamicClassID(void) const;
250 };
251 
252 ServiceEnumeration::~ServiceEnumeration() {}
253 
254 UOBJECT_DEFINE_RTTI_IMPLEMENTATION(ServiceEnumeration)
255 
256 StringEnumeration*
257 ICULocaleService::getAvailableLocales(void) const
258 {
259     return ServiceEnumeration::create(this);
260 }
261 
262 const UnicodeString&amp;
263 ICULocaleService::validateFallbackLocale() const
264 {
265     const Locale&amp;     loc    = Locale::getDefault();
266     ICULocaleService* ncThis = (ICULocaleService*)this;

267     {
268         Mutex mutex(&amp;llock);
269         if (loc != fallbackLocale) {
270             ncThis-&gt;fallbackLocale = loc;
271             LocaleUtility::initNameFromLocale(loc, ncThis-&gt;fallbackLocaleName);
272             ncThis-&gt;clearServiceCache();
273         }
274     }
275     return fallbackLocaleName;
276 }
277 
278 ICUServiceKey*
279 ICULocaleService::createKey(const UnicodeString* id, UErrorCode&amp; status) const
280 {
281     return LocaleKey::createWithCanonicalFallback(id, &amp;validateFallbackLocale(), status);
282 }
283 
284 ICUServiceKey*
285 ICULocaleService::createKey(const UnicodeString* id, int32_t kind, UErrorCode&amp; status) const
286 {
</pre>
</td>
<td>
<hr />
<pre>
  9  *******************************************************************************
 10  */
 11 #include &quot;unicode/utypes.h&quot;
 12 
 13 #if !UCONFIG_NO_SERVICE
 14 
 15 #include &quot;unicode/resbund.h&quot;
 16 #include &quot;uresimp.h&quot;
 17 #include &quot;cmemory.h&quot;
 18 #include &quot;servloc.h&quot;
 19 #include &quot;ustrfmt.h&quot;
 20 #include &quot;charstr.h&quot;
 21 #include &quot;uassert.h&quot;
 22 
 23 #define UNDERSCORE_CHAR ((UChar)0x005f)
 24 #define AT_SIGN_CHAR    ((UChar)64)
 25 #define PERIOD_CHAR     ((UChar)46)
 26 
 27 U_NAMESPACE_BEGIN
 28 

 29 ICULocaleService::ICULocaleService()
 30   : fallbackLocale(Locale::getDefault())
 31 {
 32 }
 33 
 34 ICULocaleService::ICULocaleService(const UnicodeString&amp; dname)
 35   : ICUService(dname)
 36   , fallbackLocale(Locale::getDefault())
 37 {
 38 }
 39 
 40 ICULocaleService::~ICULocaleService()
 41 {
 42 }
 43 
 44 UObject*
 45 ICULocaleService::get(const Locale&amp; locale, UErrorCode&amp; status) const
 46 {
 47     return get(locale, LocaleKey::KIND_ANY, NULL, status);
 48 }
</pre>
<hr />
<pre>
246 public:
247     static UClassID U_EXPORT2 getStaticClassID(void);
248     virtual UClassID getDynamicClassID(void) const;
249 };
250 
251 ServiceEnumeration::~ServiceEnumeration() {}
252 
253 UOBJECT_DEFINE_RTTI_IMPLEMENTATION(ServiceEnumeration)
254 
255 StringEnumeration*
256 ICULocaleService::getAvailableLocales(void) const
257 {
258     return ServiceEnumeration::create(this);
259 }
260 
261 const UnicodeString&amp;
262 ICULocaleService::validateFallbackLocale() const
263 {
264     const Locale&amp;     loc    = Locale::getDefault();
265     ICULocaleService* ncThis = (ICULocaleService*)this;
<span class="line-added">266     static UMutex llock = U_MUTEX_INITIALIZER;</span>
267     {
268         Mutex mutex(&amp;llock);
269         if (loc != fallbackLocale) {
270             ncThis-&gt;fallbackLocale = loc;
271             LocaleUtility::initNameFromLocale(loc, ncThis-&gt;fallbackLocaleName);
272             ncThis-&gt;clearServiceCache();
273         }
274     }
275     return fallbackLocaleName;
276 }
277 
278 ICUServiceKey*
279 ICULocaleService::createKey(const UnicodeString* id, UErrorCode&amp; status) const
280 {
281     return LocaleKey::createWithCanonicalFallback(id, &amp;validateFallbackLocale(), status);
282 }
283 
284 ICUServiceKey*
285 ICULocaleService::createKey(const UnicodeString* id, int32_t kind, UErrorCode&amp; status) const
286 {
</pre>
</td>
</tr>
</table>
<center><a href="serv.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="servnotf.cpp.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>