<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.graphics/src/test/java/test/javafx/css/CssMetaDataTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../concurrent/ServiceWithSecurityManagerTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Node_cssStateTransition_Test.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.graphics/src/test/java/test/javafx/css/CssMetaDataTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  63 import javafx.css.CssParserShim;
  64 import javafx.css.Declaration;
  65 import javafx.css.DeclarationShim;
  66 import javafx.css.FontCssMetaData;
  67 import javafx.css.ParsedValue;
  68 import javafx.css.PseudoClass;
  69 import javafx.css.Rule;
  70 import javafx.css.RuleShim;
  71 import javafx.css.Selector;
  72 import javafx.css.SelectorShim;
  73 import javafx.css.SimpleSelector;
  74 import javafx.css.SimpleSelectorShim;
  75 import javafx.css.Style;
  76 import javafx.css.StyleConverter;
  77 import javafx.css.StyleOrigin;
  78 import javafx.css.Styleable;
  79 import javafx.css.StyleableProperty;
  80 import javafx.css.Stylesheet;
  81 import javafx.css.StylesheetShim;
  82 import org.junit.Test;

  83 
  84 import static org.junit.Assert.*;
  85 
  86 enum TestEnum {
  87     LEFT,
  88     CENTER,
  89     RIGHT,
  90     JUSTIFY
  91 }
  92 
  93 public class CssMetaDataTest {
  94 
  95     public CssMetaDataTest() {
  96     }
  97 
  98     private static CssMetaData get(List&lt;CssMetaData&lt;? extends Styleable, ?&gt;&gt; list, String prop) {
  99         for (CssMetaData styleable : list) {
 100             if (prop.equals(styleable.getProperty())) return styleable;
 101         }
 102         return null;
</pre>
<hr />
<pre>
 243             pseudoClasses =
 244                     SimpleSelectorShim.getPseudoClassStates((SimpleSelector)selector);
 245         } else {
 246 
 247             pseudoClasses = new PseudoClassState();
 248             for (SimpleSelector sel : ((CompoundSelector)selector).getSelectors()) {
 249 
 250                 Set&lt;PseudoClass&gt; selectorPseudoClasses = SimpleSelectorShim.getPseudoClassStates(sel);
 251                 pseudoClasses.addAll(selectorPseudoClasses);
 252             }
 253         }
 254 
 255         return new CascadingStyle(
 256                 new Style(selector, declaration),
 257                 pseudoClasses,
 258                 0,
 259                 ord++
 260         );
 261     }
 262 
<span class="line-modified"> 263     @Test @org.junit.Ignore</span>

 264     public void testGetMatchingStyles() {
 265 
 266 
 267         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 268         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 269         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 270 
 271         final List&lt;Rule&gt; rules = stylesheet.getRules();
 272 
 273         //
 274         // .root { -fx-base: red; -fx-color: -fx-base; }
 275         //
 276         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 277         rootStyleClass.add(&quot;root&quot;);
 278 
 279         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 280 
 281         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 282         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 283 
</pre>
<hr />
<pre>
 348         Scene scene = new Scene(group);
 349         Stage stage = new Stage();
 350         stage.setScene(scene);
 351         stage.show();
 352 
 353         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 354         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 355 
 356         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 357         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 358         //        System.err.println(&quot;actuals: &quot; + actuals);
 359 
 360         assertEquals(expecteds.size(), actuals.size(), 0);
 361 
 362         for (Style style : expecteds) {
 363             if (!actuals.remove(style)) fail();
 364         }
 365         assertTrue(actuals.isEmpty());
 366     }
 367 
<span class="line-modified"> 368     @Test @org.junit.Ignore</span>

 369     public void testGetMatchingStylesWithInlineStyleOnParent() {
 370 
 371 
 372         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 373         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 374         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 375 
 376         final List&lt;Rule&gt; rules = stylesheet.getRules();
 377 
 378         //
 379         // .root { -fx-base: red; -fx-color: -fx-base; }
 380         //
 381         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 382         rootStyleClass.add(&quot;root&quot;);
 383 
 384         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 385 
 386         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 387         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 388 
</pre>
<hr />
<pre>
 471         stage.show();
 472 
 473         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 474         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 475 
 476         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 477         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 478         //        System.err.println(&quot;actuals: &quot; + actuals);
 479 
 480         assertEquals(expecteds.size(), actuals.size(), 0);
 481 
 482         // inline style should be first
 483         assertEquals(expecteds.get(0), actuals.get(0));
 484 
 485         for (Style style : expecteds) {
 486             if (!actuals.remove(style)) fail();
 487         }
 488         assertTrue(actuals.isEmpty());
 489     }
 490 
<span class="line-modified"> 491     @Test @org.junit.Ignore</span>

 492     public void testGetMatchingStylesWithInlineStyleOnLeaf() {
 493 
 494 
 495         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 496         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 497         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 498 
 499         final List&lt;Rule&gt; rules = stylesheet.getRules();
 500 
 501         //
 502         // .root { -fx-base: red; -fx-color: -fx-base; }
 503         //
 504         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 505         rootStyleClass.add(&quot;root&quot;);
 506 
 507         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 508 
 509         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 510         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 511 
</pre>
<hr />
<pre>
 594         stage.show();
 595 
 596         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 597         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 598 
 599         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 600         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 601         //        System.err.println(&quot;actuals: &quot; + actuals);
 602 
 603         assertEquals(expecteds.size(), actuals.size(), 0);
 604 
 605         // inline style should be first
 606         assertEquals(expecteds.get(0), actuals.get(0));
 607 
 608         for (Style style : expecteds) {
 609             if (!actuals.remove(style)) fail();
 610         }
 611         assertTrue(actuals.isEmpty());
 612     }
 613 
<span class="line-modified"> 614     @Test @org.junit.Ignore</span>

 615     public void testGetMatchingStylesWithInlineStyleOnRootAndLeaf() {
 616 
 617 
 618         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 619         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 620         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 621 
 622         final List&lt;Rule&gt; rules = stylesheet.getRules();
 623 
 624         //
 625         // .root { -fx-base: red; -fx-color: -fx-base; }
 626         //
 627         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 628         rootStyleClass.add(&quot;root&quot;);
 629 
 630         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 631 
 632         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 633         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 634 
</pre>
<hr />
<pre>
 721         stage.show();
 722 
 723         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 724         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 725 
 726         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 727         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 728         //        System.err.println(&quot;actuals: &quot; + actuals);
 729 
 730         assertEquals(expecteds.size(), actuals.size(), 0);
 731 
 732         // inline style should be first
 733         assertEquals(expecteds.get(0), actuals.get(0));
 734 
 735         for (Style style : expecteds) {
 736             if (!actuals.remove(style)) fail(style.toString());
 737         }
 738         assertTrue(actuals.isEmpty());
 739     }
 740 
<span class="line-modified"> 741     @Test @org.junit.Ignore</span>

 742     public void testGetMatchingStylesShouldNotReturnAncestorPropertyIfNotInherited() {
 743 
 744 
 745         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 746         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 747         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 748 
 749         final List&lt;Rule&gt; rules = stylesheet.getRules();
 750 
 751         //
 752         // .root { -fx-base: red; -fx-color: -fx-base; }
 753         //
 754         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 755         rootStyleClass.add(&quot;root&quot;);
 756 
 757         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 758 
 759         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 760         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 761 
</pre>
<hr />
<pre>
 829         Scene scene = new Scene(group);
 830         Stage stage = new Stage();
 831         stage.setScene(scene);
 832         stage.show();
 833 
 834         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 835         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 836 
 837         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 838         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 839         //        System.err.println(&quot;actuals: &quot; + actuals);
 840 
 841         assertEquals(expecteds.size(), actuals.size(), 0);
 842 
 843         for (Style style : expecteds) {
 844             if (!actuals.remove(style)) fail();
 845         }
 846         assertTrue(actuals.isEmpty());
 847     }
 848 
<span class="line-modified"> 849 </span>
<span class="line-modified"> 850     @Test @org.junit.Ignore</span>
 851     public void testGetMatchingStylesShouldNotReturnInlineAncestorPropertyIfNotInherited() {
 852 
 853         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 854         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 855         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
 856 
 857         final List&lt;Rule&gt; rules = stylesheet.getRules();
 858 
 859         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 860         rootStyleClass.add(&quot;root&quot;);
 861 
 862         List&lt;String&gt; rectStyleClass = new ArrayList&lt;String&gt;();
 863         rectStyleClass.add(&quot;rect&quot;);
 864 
 865         //
 866         // .root { -fx-base: red; -fx-color: -fx-base; }
 867         //
 868         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 869 
 870         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
</pre>
<hr />
<pre>
 935         group.getChildren().add(rectangle);
 936 
 937         Scene scene = new Scene(group);
 938         Stage stage = new Stage();
 939         stage.setScene(scene);
 940         stage.show();
 941 
 942         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 943         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 944 
 945         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 946         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 947         //        System.err.println(&quot;actuals: &quot; + actuals);
 948 
 949         for (Style style : expecteds) {
 950             actuals.remove(style);
 951         }
 952         assertTrue(actuals.toString(), actuals.isEmpty());
 953     }
 954 
<span class="line-modified"> 955     @Test @org.junit.Ignore</span>

 956     public void testGetMatchingStylesReturnsInheritedProperty() {
 957 
 958 
 959         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 960         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 961         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
 962 
 963         final List&lt;Rule&gt; rules = stylesheet.getRules();
 964 
 965         //
 966         // .root { -fx-base: red; -fx-color: -fx-base; }
 967         //
 968         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 969         rootStyleClass.add(&quot;root&quot;);
 970 
 971         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 972 
 973         ParsedValue&lt;Color,Color&gt; fxFontShouldInheritValue = new CssParserShim().parseExpr(&quot;-fx-font&quot;, &quot;12px system&quot;);
 974         Declaration fxFontShouldInherit = DeclarationShim.getDeclaration(&quot;-fx-font&quot;, fxFontShouldInheritValue, false);
 975 
</pre>
<hr />
<pre>
1016         Scene scene = new Scene(group);
1017         Stage stage = new Stage();
1018         stage.setScene(scene);
1019         stage.show();
1020 
1021         final CssMetaData FONT = get(text.getCssMetaData(), &quot;-fx-font&quot;);
1022         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FONT, text);
1023 
1024         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
1025         //        System.err.println(&quot;expecteds: &quot; + expecteds);
1026         //        System.err.println(&quot;actuals: &quot; + actuals);
1027 
1028         assertEquals(expecteds.size(), actuals.size(), 0);
1029 
1030         for (Style style : expecteds) {
1031             if (!actuals.remove(style)) fail();
1032         }
1033         assertTrue(actuals.isEmpty());
1034     }
1035 
<span class="line-modified">1036     @Test @org.junit.Ignore</span>

1037     public void testGetMatchingStylesReturnsSubProperty() {
1038 
1039         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
1040         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
1041         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
1042 
1043         final List&lt;Rule&gt; rules = stylesheet.getRules();
1044 
1045         //
1046         // .root { -fx-base: red; -fx-color: -fx-base; }
1047         //
1048         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
1049         rootStyleClass.add(&quot;root&quot;);
1050 
1051         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
1052 
1053         ParsedValue&lt;Color,Color&gt; fxFontShouldInheritValue = new CssParserShim().parseExpr(&quot;-fx-font&quot;, &quot;12px system&quot;);
1054         Declaration fxFontShouldInherit = DeclarationShim.getDeclaration(&quot;-fx-font&quot;, fxFontShouldInheritValue, false);
1055 
1056         List&lt;Selector&gt; selectors = new ArrayList&lt;Selector&gt;();
</pre>
<hr />
<pre>
1204                         if (cl != null) checkClass(cl);
1205                     } catch(ClassNotFoundException ex) {
1206                         System.err.println(ex.toString() + &quot; &quot; + clName);
1207                     }
1208                 }
1209             }
1210         }
1211     }
1212 
1213     private static void recursiveCheck(File directory, int pathLength) {
1214         if (directory.isDirectory()) {
1215             //            System.err.println(directory.getPath());
1216             checkDirectory(directory, pathLength);
1217 
1218             for (File subFile : directory.listFiles()) {
1219                 recursiveCheck(subFile, pathLength);
1220             }
1221         }
1222     }
1223 
<span class="line-modified">1224     @Test @org.junit.Ignore(&quot;tested CssMetaData#set method, which is deprecated&quot;)</span>

1225     public void testRT_21185() {
1226 
1227         Color c1 = new Color(.1,.2,.3,1.0);
1228         Color c2 = new Color(.1,.2,.3,1.0);
1229 
1230         Rectangle rect = new Rectangle();
1231         rect.setFill(c1);
1232 
1233         StyleableProperty fill = (StyleableProperty)rect.fillProperty();
1234         StyleOrigin origin = ((StyleableProperty)rect.fillProperty()).getStyleOrigin();
1235 
1236         // set should not change the value if the values are equal and origin is same
1237         assertEquals(c1, c2);
1238         fill.applyStyle(origin, c2);
1239 
1240         assertSame(c1,rect.getFill()); // instance should not change.
1241 
1242         // set should change the value if the values are not equal.
1243         c2 = new Color(.3,.2,.1,1.0);
1244         fill.applyStyle(origin, c2);
1245         assertSame(c2,rect.getFill());
1246 
1247         // set should change the value if the origin is not the same
1248         fill.applyStyle(StyleOrigin.INLINE, c2);
1249         origin = ((StyleableProperty)rect.fillProperty()).getStyleOrigin();
1250         assertSame(StyleOrigin.INLINE, origin);
1251 
1252         // set should change the value if one is null and the other is not.
1253         rect.setFill(null);
1254         fill.applyStyle(origin, c2);
1255         assertSame(c2, rect.getFill());
1256 
1257         // set should change the value if one is null and the other is not
1258         fill.applyStyle(origin, null);
1259         assertNull(rect.getFill());
1260 
1261     }
1262 
<span class="line-modified">1263 </span>
<span class="line-modified">1264     @Test  @org.junit.Ignore</span>
1265     public void testRT_24606() {
1266 
1267         final Stylesheet stylesheet = new CssParser().parse(
1268                 &quot;.root { -fx-base: red; }&quot; +
1269                         &quot;.group { -fx-color: -fx-base; }&quot; +
1270                         &quot;.text { -fx-fill: -fx-color; }&quot;
1271         );
1272         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
1273         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
1274 
1275         final Text text = new Text(&quot;HelloWorld&quot;);
1276         text.getStyleClass().add(&quot;text&quot;);
1277         text.setFill(Color.BLUE);
1278 
1279         final Group group = new Group();
1280         group.getStyleClass().add(&quot;group&quot;);
1281         group.getChildren().add(text);
1282 
1283         final Group root = new Group();
1284         root.getChildren().add(group);
</pre>
</td>
<td>
<hr />
<pre>
  63 import javafx.css.CssParserShim;
  64 import javafx.css.Declaration;
  65 import javafx.css.DeclarationShim;
  66 import javafx.css.FontCssMetaData;
  67 import javafx.css.ParsedValue;
  68 import javafx.css.PseudoClass;
  69 import javafx.css.Rule;
  70 import javafx.css.RuleShim;
  71 import javafx.css.Selector;
  72 import javafx.css.SelectorShim;
  73 import javafx.css.SimpleSelector;
  74 import javafx.css.SimpleSelectorShim;
  75 import javafx.css.Style;
  76 import javafx.css.StyleConverter;
  77 import javafx.css.StyleOrigin;
  78 import javafx.css.Styleable;
  79 import javafx.css.StyleableProperty;
  80 import javafx.css.Stylesheet;
  81 import javafx.css.StylesheetShim;
  82 import org.junit.Test;
<span class="line-added">  83 import org.junit.Ignore;</span>
  84 
  85 import static org.junit.Assert.*;
  86 
  87 enum TestEnum {
  88     LEFT,
  89     CENTER,
  90     RIGHT,
  91     JUSTIFY
  92 }
  93 
  94 public class CssMetaDataTest {
  95 
  96     public CssMetaDataTest() {
  97     }
  98 
  99     private static CssMetaData get(List&lt;CssMetaData&lt;? extends Styleable, ?&gt;&gt; list, String prop) {
 100         for (CssMetaData styleable : list) {
 101             if (prop.equals(styleable.getProperty())) return styleable;
 102         }
 103         return null;
</pre>
<hr />
<pre>
 244             pseudoClasses =
 245                     SimpleSelectorShim.getPseudoClassStates((SimpleSelector)selector);
 246         } else {
 247 
 248             pseudoClasses = new PseudoClassState();
 249             for (SimpleSelector sel : ((CompoundSelector)selector).getSelectors()) {
 250 
 251                 Set&lt;PseudoClass&gt; selectorPseudoClasses = SimpleSelectorShim.getPseudoClassStates(sel);
 252                 pseudoClasses.addAll(selectorPseudoClasses);
 253             }
 254         }
 255 
 256         return new CascadingStyle(
 257                 new Style(selector, declaration),
 258                 pseudoClasses,
 259                 0,
 260                 ord++
 261         );
 262     }
 263 
<span class="line-modified"> 264     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-added"> 265     @Test</span>
 266     public void testGetMatchingStyles() {
 267 
 268 
 269         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 270         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 271         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 272 
 273         final List&lt;Rule&gt; rules = stylesheet.getRules();
 274 
 275         //
 276         // .root { -fx-base: red; -fx-color: -fx-base; }
 277         //
 278         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 279         rootStyleClass.add(&quot;root&quot;);
 280 
 281         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 282 
 283         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 284         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 285 
</pre>
<hr />
<pre>
 350         Scene scene = new Scene(group);
 351         Stage stage = new Stage();
 352         stage.setScene(scene);
 353         stage.show();
 354 
 355         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 356         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 357 
 358         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 359         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 360         //        System.err.println(&quot;actuals: &quot; + actuals);
 361 
 362         assertEquals(expecteds.size(), actuals.size(), 0);
 363 
 364         for (Style style : expecteds) {
 365             if (!actuals.remove(style)) fail();
 366         }
 367         assertTrue(actuals.isEmpty());
 368     }
 369 
<span class="line-modified"> 370     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-added"> 371     @Test</span>
 372     public void testGetMatchingStylesWithInlineStyleOnParent() {
 373 
 374 
 375         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 376         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 377         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 378 
 379         final List&lt;Rule&gt; rules = stylesheet.getRules();
 380 
 381         //
 382         // .root { -fx-base: red; -fx-color: -fx-base; }
 383         //
 384         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 385         rootStyleClass.add(&quot;root&quot;);
 386 
 387         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 388 
 389         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 390         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 391 
</pre>
<hr />
<pre>
 474         stage.show();
 475 
 476         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 477         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 478 
 479         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 480         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 481         //        System.err.println(&quot;actuals: &quot; + actuals);
 482 
 483         assertEquals(expecteds.size(), actuals.size(), 0);
 484 
 485         // inline style should be first
 486         assertEquals(expecteds.get(0), actuals.get(0));
 487 
 488         for (Style style : expecteds) {
 489             if (!actuals.remove(style)) fail();
 490         }
 491         assertTrue(actuals.isEmpty());
 492     }
 493 
<span class="line-modified"> 494     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-added"> 495     @Test</span>
 496     public void testGetMatchingStylesWithInlineStyleOnLeaf() {
 497 
 498 
 499         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 500         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 501         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 502 
 503         final List&lt;Rule&gt; rules = stylesheet.getRules();
 504 
 505         //
 506         // .root { -fx-base: red; -fx-color: -fx-base; }
 507         //
 508         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 509         rootStyleClass.add(&quot;root&quot;);
 510 
 511         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 512 
 513         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 514         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 515 
</pre>
<hr />
<pre>
 598         stage.show();
 599 
 600         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 601         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 602 
 603         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 604         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 605         //        System.err.println(&quot;actuals: &quot; + actuals);
 606 
 607         assertEquals(expecteds.size(), actuals.size(), 0);
 608 
 609         // inline style should be first
 610         assertEquals(expecteds.get(0), actuals.get(0));
 611 
 612         for (Style style : expecteds) {
 613             if (!actuals.remove(style)) fail();
 614         }
 615         assertTrue(actuals.isEmpty());
 616     }
 617 
<span class="line-modified"> 618     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-added"> 619     @Test</span>
 620     public void testGetMatchingStylesWithInlineStyleOnRootAndLeaf() {
 621 
 622 
 623         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 624         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 625         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 626 
 627         final List&lt;Rule&gt; rules = stylesheet.getRules();
 628 
 629         //
 630         // .root { -fx-base: red; -fx-color: -fx-base; }
 631         //
 632         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 633         rootStyleClass.add(&quot;root&quot;);
 634 
 635         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 636 
 637         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 638         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 639 
</pre>
<hr />
<pre>
 726         stage.show();
 727 
 728         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 729         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 730 
 731         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 732         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 733         //        System.err.println(&quot;actuals: &quot; + actuals);
 734 
 735         assertEquals(expecteds.size(), actuals.size(), 0);
 736 
 737         // inline style should be first
 738         assertEquals(expecteds.get(0), actuals.get(0));
 739 
 740         for (Style style : expecteds) {
 741             if (!actuals.remove(style)) fail(style.toString());
 742         }
 743         assertTrue(actuals.isEmpty());
 744     }
 745 
<span class="line-modified"> 746     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-added"> 747     @Test</span>
 748     public void testGetMatchingStylesShouldNotReturnAncestorPropertyIfNotInherited() {
 749 
 750 
 751         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 752         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 753         StyleManager.getInstance().getInstance().setDefaultUserAgentStylesheet(stylesheet);
 754 
 755         final List&lt;Rule&gt; rules = stylesheet.getRules();
 756 
 757         //
 758         // .root { -fx-base: red; -fx-color: -fx-base; }
 759         //
 760         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 761         rootStyleClass.add(&quot;root&quot;);
 762 
 763         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 764 
 765         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
 766         Declaration fxBase = DeclarationShim.getDeclaration(&quot;-fx-base&quot;, fxBaseValue, false);
 767 
</pre>
<hr />
<pre>
 835         Scene scene = new Scene(group);
 836         Stage stage = new Stage();
 837         stage.setScene(scene);
 838         stage.show();
 839 
 840         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 841         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 842 
 843         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 844         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 845         //        System.err.println(&quot;actuals: &quot; + actuals);
 846 
 847         assertEquals(expecteds.size(), actuals.size(), 0);
 848 
 849         for (Style style : expecteds) {
 850             if (!actuals.remove(style)) fail();
 851         }
 852         assertTrue(actuals.isEmpty());
 853     }
 854 
<span class="line-modified"> 855     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-modified"> 856     @Test</span>
 857     public void testGetMatchingStylesShouldNotReturnInlineAncestorPropertyIfNotInherited() {
 858 
 859         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 860         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 861         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
 862 
 863         final List&lt;Rule&gt; rules = stylesheet.getRules();
 864 
 865         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 866         rootStyleClass.add(&quot;root&quot;);
 867 
 868         List&lt;String&gt; rectStyleClass = new ArrayList&lt;String&gt;();
 869         rectStyleClass.add(&quot;rect&quot;);
 870 
 871         //
 872         // .root { -fx-base: red; -fx-color: -fx-base; }
 873         //
 874         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 875 
 876         ParsedValue fxBaseValue = new CssParserShim().parseExpr(&quot;-fx-base&quot;, &quot;red&quot;);
</pre>
<hr />
<pre>
 941         group.getChildren().add(rectangle);
 942 
 943         Scene scene = new Scene(group);
 944         Stage stage = new Stage();
 945         stage.setScene(scene);
 946         stage.show();
 947 
 948         final CssMetaData FILL = get(rectangle.getCssMetaData(), &quot;-fx-fill&quot;);
 949         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FILL, rectangle);
 950 
 951         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
 952         //        System.err.println(&quot;expecteds: &quot; + expecteds);
 953         //        System.err.println(&quot;actuals: &quot; + actuals);
 954 
 955         for (Style style : expecteds) {
 956             actuals.remove(style);
 957         }
 958         assertTrue(actuals.toString(), actuals.isEmpty());
 959     }
 960 
<span class="line-modified"> 961     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-added"> 962     @Test</span>
 963     public void testGetMatchingStylesReturnsInheritedProperty() {
 964 
 965 
 966         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
 967         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
 968         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
 969 
 970         final List&lt;Rule&gt; rules = stylesheet.getRules();
 971 
 972         //
 973         // .root { -fx-base: red; -fx-color: -fx-base; }
 974         //
 975         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
 976         rootStyleClass.add(&quot;root&quot;);
 977 
 978         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
 979 
 980         ParsedValue&lt;Color,Color&gt; fxFontShouldInheritValue = new CssParserShim().parseExpr(&quot;-fx-font&quot;, &quot;12px system&quot;);
 981         Declaration fxFontShouldInherit = DeclarationShim.getDeclaration(&quot;-fx-font&quot;, fxFontShouldInheritValue, false);
 982 
</pre>
<hr />
<pre>
1023         Scene scene = new Scene(group);
1024         Stage stage = new Stage();
1025         stage.setScene(scene);
1026         stage.show();
1027 
1028         final CssMetaData FONT = get(text.getCssMetaData(), &quot;-fx-font&quot;);
1029         final List&lt;Style&gt; actuals = NodeHelper.getMatchingStyles(FONT, text);
1030 
1031         //        System.err.println(&quot;matchingStyles: &quot; + matchingStyles);
1032         //        System.err.println(&quot;expecteds: &quot; + expecteds);
1033         //        System.err.println(&quot;actuals: &quot; + actuals);
1034 
1035         assertEquals(expecteds.size(), actuals.size(), 0);
1036 
1037         for (Style style : expecteds) {
1038             if (!actuals.remove(style)) fail();
1039         }
1040         assertTrue(actuals.isEmpty());
1041     }
1042 
<span class="line-modified">1043     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-added">1044     @Test</span>
1045     public void testGetMatchingStylesReturnsSubProperty() {
1046 
1047         final Stylesheet stylesheet = StylesheetShim.getStylesheet();
1048         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
1049         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
1050 
1051         final List&lt;Rule&gt; rules = stylesheet.getRules();
1052 
1053         //
1054         // .root { -fx-base: red; -fx-color: -fx-base; }
1055         //
1056         List&lt;String&gt; rootStyleClass = new ArrayList&lt;String&gt;();
1057         rootStyleClass.add(&quot;root&quot;);
1058 
1059         Selector root = SimpleSelectorShim.getSimpleSelector(&quot;*&quot;, rootStyleClass, null, null);
1060 
1061         ParsedValue&lt;Color,Color&gt; fxFontShouldInheritValue = new CssParserShim().parseExpr(&quot;-fx-font&quot;, &quot;12px system&quot;);
1062         Declaration fxFontShouldInherit = DeclarationShim.getDeclaration(&quot;-fx-font&quot;, fxFontShouldInheritValue, false);
1063 
1064         List&lt;Selector&gt; selectors = new ArrayList&lt;Selector&gt;();
</pre>
<hr />
<pre>
1212                         if (cl != null) checkClass(cl);
1213                     } catch(ClassNotFoundException ex) {
1214                         System.err.println(ex.toString() + &quot; &quot; + clName);
1215                     }
1216                 }
1217             }
1218         }
1219     }
1220 
1221     private static void recursiveCheck(File directory, int pathLength) {
1222         if (directory.isDirectory()) {
1223             //            System.err.println(directory.getPath());
1224             checkDirectory(directory, pathLength);
1225 
1226             for (File subFile : directory.listFiles()) {
1227                 recursiveCheck(subFile, pathLength);
1228             }
1229         }
1230     }
1231 
<span class="line-modified">1232     @Ignore(&quot;JDK-8234143&quot;) // Tested CssMetaData#set method, which is deprecated.</span>
<span class="line-added">1233     @Test</span>
1234     public void testRT_21185() {
1235 
1236         Color c1 = new Color(.1,.2,.3,1.0);
1237         Color c2 = new Color(.1,.2,.3,1.0);
1238 
1239         Rectangle rect = new Rectangle();
1240         rect.setFill(c1);
1241 
1242         StyleableProperty fill = (StyleableProperty)rect.fillProperty();
1243         StyleOrigin origin = ((StyleableProperty)rect.fillProperty()).getStyleOrigin();
1244 
1245         // set should not change the value if the values are equal and origin is same
1246         assertEquals(c1, c2);
1247         fill.applyStyle(origin, c2);
1248 
1249         assertSame(c1,rect.getFill()); // instance should not change.
1250 
1251         // set should change the value if the values are not equal.
1252         c2 = new Color(.3,.2,.1,1.0);
1253         fill.applyStyle(origin, c2);
1254         assertSame(c2,rect.getFill());
1255 
1256         // set should change the value if the origin is not the same
1257         fill.applyStyle(StyleOrigin.INLINE, c2);
1258         origin = ((StyleableProperty)rect.fillProperty()).getStyleOrigin();
1259         assertSame(StyleOrigin.INLINE, origin);
1260 
1261         // set should change the value if one is null and the other is not.
1262         rect.setFill(null);
1263         fill.applyStyle(origin, c2);
1264         assertSame(c2, rect.getFill());
1265 
1266         // set should change the value if one is null and the other is not
1267         fill.applyStyle(origin, null);
1268         assertNull(rect.getFill());
1269 
1270     }
1271 
<span class="line-modified">1272     @Ignore(&quot;JDK-8234142&quot;)</span>
<span class="line-modified">1273     @Test</span>
1274     public void testRT_24606() {
1275 
1276         final Stylesheet stylesheet = new CssParser().parse(
1277                 &quot;.root { -fx-base: red; }&quot; +
1278                         &quot;.group { -fx-color: -fx-base; }&quot; +
1279                         &quot;.text { -fx-fill: -fx-color; }&quot;
1280         );
1281         stylesheet.setOrigin(StyleOrigin.USER_AGENT);
1282         StyleManager.getInstance().setDefaultUserAgentStylesheet(stylesheet);
1283 
1284         final Text text = new Text(&quot;HelloWorld&quot;);
1285         text.getStyleClass().add(&quot;text&quot;);
1286         text.setFill(Color.BLUE);
1287 
1288         final Group group = new Group();
1289         group.getStyleClass().add(&quot;group&quot;);
1290         group.getChildren().add(text);
1291 
1292         final Group root = new Group();
1293         root.getChildren().add(group);
</pre>
</td>
</tr>
</table>
<center><a href="../concurrent/ServiceWithSecurityManagerTest.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="Node_cssStateTransition_Test.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>