<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.controls/src/test/java/test/com/sun/javafx/scene/control/infrastructure/KeyEventFirerTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="KeyEventFirer.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.controls/src/test/java/test/com/sun/javafx/scene/control/infrastructure/KeyEventFirerTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 29,91 ***</span>
  import java.util.List;
  
  import org.junit.After;
  import org.junit.Before;
  import org.junit.Test;
<span class="line-removed">- import org.junit.Ignore;</span>
  
  import static javafx.scene.input.KeyCode.*;
  import static javafx.scene.input.KeyEvent.*;
  import static org.junit.Assert.*;
  
  import javafx.scene.Node;
  import javafx.scene.Scene;
  import javafx.scene.control.Button;
<span class="line-removed">- import javafx.scene.control.ComboBox;</span>
  import javafx.scene.control.TextField;
  import javafx.scene.input.KeyEvent;
  import javafx.scene.layout.Pane;
  import javafx.scene.layout.VBox;
  import javafx.stage.Stage;
  
  /**
   * Test of enhanced KeyEventFirer.
<span class="line-removed">-  * &lt;p&gt;</span>
<span class="line-removed">-  *</span>
<span class="line-removed">-  * Most of these tests are meant to document how to use the KeyEventFirer and what</span>
<span class="line-removed">-  * happens if used incorrectly. The latter are ignored, because the build should pass.</span>
<span class="line-removed">-  *</span>
   */
  public class KeyEventFirerTest {
  
      private TextField textField;
      private Button button;
      private Pane root;
      private Stage stage;
      private Scene scene;
<span class="line-removed">-     private ComboBox&lt;String&gt; comboBox;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Verify failing test from bug report example.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     @Ignore</span>
<span class="line-removed">-     @Test</span>
<span class="line-removed">-     public void testFireComboEditorFailing() {</span>
<span class="line-removed">-         showAndFocus(comboBox);</span>
<span class="line-removed">-         List&lt;KeyEvent&gt; keys = new ArrayList&lt;&gt;();</span>
<span class="line-removed">-         comboBox.getEditor().addEventFilter(KEY_PRESSED, keys::add);</span>
<span class="line-removed">-         KeyEventFirer keyboard = new KeyEventFirer(comboBox.getEditor(), scene);</span>
<span class="line-removed">-         keyboard.doKeyPress(ENTER);</span>
<span class="line-removed">-         assertEquals(&quot;pressed ENTER filter on editor&quot;, 1, keys.size());</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * False-green from bug report example.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     @Ignore</span>
<span class="line-removed">-     @Test</span>
<span class="line-removed">-     public void testFireComboEditorFalseGreen() {</span>
<span class="line-removed">-         showAndFocus(comboBox);</span>
<span class="line-removed">-         List&lt;KeyEvent&gt; keys = new ArrayList&lt;&gt;();</span>
<span class="line-removed">-         comboBox.getEditor().addEventFilter(KEY_PRESSED, keys::add);</span>
<span class="line-removed">-         KeyEventFirer keyboard = new KeyEventFirer(comboBox.getEditor());</span>
<span class="line-removed">-         keyboard.doKeyPress(ENTER);</span>
<span class="line-removed">-         assertEquals(&quot;pressed ENTER filter on editor&quot;, 1, keys.size());</span>
<span class="line-removed">-         fail(&quot;false green by firing directly on target which is not focusOwner&quot;);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     /**</span>
<span class="line-removed">-      * Test that keyEvent is delivered to focused control and nowhere else.</span>
<span class="line-removed">-      * Here we fire directly onto the scene - and see a different outcome from</span>
<span class="line-removed">-      * using scene.process: the events are delivered to the scene only, not</span>
<span class="line-removed">-      * the focused node.</span>
<span class="line-removed">-      */</span>
<span class="line-removed">-     @Ignore</span>
<span class="line-removed">-     @Test</span>
<span class="line-removed">-     public void testFireSceneAsTarget() {</span>
<span class="line-removed">-         showAndFocus(button);</span>
<span class="line-removed">-         List&lt;KeyEvent&gt; buttonEvents = new ArrayList&lt;&gt;();</span>
<span class="line-removed">-         button.addEventHandler(KEY_PRESSED, buttonEvents::add);</span>
<span class="line-removed">-         List&lt;KeyEvent&gt; textFieldEvents = new ArrayList&lt;&gt;();</span>
<span class="line-removed">-         textField.addEventHandler(KEY_PRESSED, textFieldEvents::add);</span>
<span class="line-removed">-         KeyEventFirer firer = new KeyEventFirer(scene);</span>
<span class="line-removed">-         firer.doKeyPress(A);</span>
<span class="line-removed">-         assertEquals(&quot;button must have received the key&quot;, 1, buttonEvents.size());</span>
<span class="line-removed">-         assertEquals(&quot;textField must not have received the key&quot;, 0, textFieldEvents.size());</span>
<span class="line-removed">-     }</span>
  
      /**
       * Test that keyEvent is delivered to focused control and nowhere else.
       */
      @Test
<span class="line-new-header">--- 29,34 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 148,23 ***</span>
  
      /**
       * This simulates a false positive: even though not focused, the textField handlers
       * are notified when firing directly. That&#39;s possible, but typically not what we want to test!
       */
<span class="line-removed">-     @Ignore</span>
      @Test
      public void testFireTargetFalseGreen() {
          showAndFocus(button);
          List&lt;KeyEvent&gt; buttonEvents = new ArrayList&lt;&gt;();
          button.addEventHandler(KEY_PRESSED, buttonEvents::add);
          List&lt;KeyEvent&gt; textFieldEvents = new ArrayList&lt;&gt;();
          textField.addEventHandler(KEY_PRESSED, textFieldEvents::add);
<span class="line-modified">!         KeyEventFirer firer = new KeyEventFirer(textField);</span>
<span class="line-modified">!         firer.doKeyPress(A);</span>
<span class="line-modified">!         assertEquals(&quot;textField must have received the key&quot;, 1, textFieldEvents.size());</span>
<span class="line-modified">!         assertEquals(&quot;button must have received the key&quot;, 0, buttonEvents.size());</span>
<span class="line-modified">!         fail(&quot;false green by firing directly on target which is not focusOwner&quot;);</span>
      }
  
      @Test (expected= NullPointerException.class)
      public void testTwoParamConstructorNPE() {
          new KeyEventFirer(null, null);
<span class="line-new-header">--- 91,31 ---</span>
  
      /**
       * This simulates a false positive: even though not focused, the textField handlers
       * are notified when firing directly. That&#39;s possible, but typically not what we want to test!
       */
      @Test
      public void testFireTargetFalseGreen() {
          showAndFocus(button);
          List&lt;KeyEvent&gt; buttonEvents = new ArrayList&lt;&gt;();
          button.addEventHandler(KEY_PRESSED, buttonEvents::add);
          List&lt;KeyEvent&gt; textFieldEvents = new ArrayList&lt;&gt;();
          textField.addEventHandler(KEY_PRESSED, textFieldEvents::add);
<span class="line-modified">!         // firing on a node that is not focusOwner</span>
<span class="line-modified">!         KeyEventFirer incorrectFirer = new KeyEventFirer(textField);</span>
<span class="line-modified">!         incorrectFirer.doKeyPress(A);</span>
<span class="line-modified">!         int falseTextFieldNotification = textFieldEvents.size();</span>
<span class="line-modified">!         int falseButtonNotification = buttonEvents.size();</span>
<span class="line-added">+         assertEquals(&quot;false green - textField must have received the key&quot;, 1, textFieldEvents.size());</span>
<span class="line-added">+         assertEquals(&quot;false green - button must not have received the key&quot;, 0, buttonEvents.size());</span>
<span class="line-added">+         textFieldEvents.clear();</span>
<span class="line-added">+         buttonEvents.clear();</span>
<span class="line-added">+         // firing on the scene makes a difference</span>
<span class="line-added">+         KeyEventFirer correctFirer = new KeyEventFirer(null, scene);</span>
<span class="line-added">+         correctFirer.doKeyPress(A);</span>
<span class="line-added">+         assertNotEquals(falseTextFieldNotification, textFieldEvents.size());</span>
<span class="line-added">+         assertNotEquals(falseButtonNotification, buttonEvents.size());</span>
      }
  
      @Test (expected= NullPointerException.class)
      public void testTwoParamConstructorNPE() {
          new KeyEventFirer(null, null);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 179,11 ***</span>
       * Need all: stage.show, stage.requestFocus and control.requestFocus to
       * have consistent focused state on control (that is focusOwner and isFocused)
       */
      @Test
      public void testUIState() {
<span class="line-modified">!         assertEquals(List.of(button, textField, comboBox), root.getChildren());</span>
          stage.show();
          stage.requestFocus();
          button.requestFocus();
          assertEquals(button, scene.getFocusOwner());
          assertTrue(button.isFocused());
<span class="line-new-header">--- 130,11 ---</span>
       * Need all: stage.show, stage.requestFocus and control.requestFocus to
       * have consistent focused state on control (that is focusOwner and isFocused)
       */
      @Test
      public void testUIState() {
<span class="line-modified">!         assertEquals(List.of(button, textField), root.getChildren());</span>
          stage.show();
          stage.requestFocus();
          button.requestFocus();
          assertEquals(button, scene.getFocusOwner());
          assertTrue(button.isFocused());
</pre>
<hr />
<pre>
<span class="line-old-header">*** 199,24 ***</span>
          }
      }
  
      @Before
      public void setup() {
<span class="line-removed">-         // This step is not needed (Just to make sure StubToolkit is loaded into VM)</span>
<span class="line-removed">-         // @SuppressWarnings(&quot;unused&quot;)</span>
<span class="line-removed">-         // Toolkit tk = (StubToolkit)Toolkit.getToolkit();</span>
          root = new VBox();
          scene = new Scene(root);
          stage = new Stage();
          stage.setScene(scene);
          button = new Button(&quot;I&#39;m a button&quot;);
          textField = new TextField(&quot;some text&quot;);
<span class="line-modified">!         // to test the false-green example in the bug report</span>
<span class="line-removed">-         comboBox = new ComboBox&lt;&gt;();</span>
<span class="line-removed">-         comboBox.getItems().addAll(&quot;Test&quot;, &quot;hello&quot;, &quot;world&quot;);</span>
<span class="line-removed">-         comboBox.setEditable(true);</span>
<span class="line-removed">-         root.getChildren().addAll(button, textField, comboBox);</span>
      }
  
      @After
      public void cleanup() {
          if (stage != null) {
<span class="line-new-header">--- 150,17 ---</span>
          }
      }
  
      @Before
      public void setup() {
          root = new VBox();
          scene = new Scene(root);
          stage = new Stage();
          stage.setScene(scene);
          button = new Button(&quot;I&#39;m a button&quot;);
          textField = new TextField(&quot;some text&quot;);
<span class="line-modified">!         root.getChildren().addAll(button, textField);</span>
      }
  
      @After
      public void cleanup() {
          if (stage != null) {
</pre>
<center><a href="KeyEventFirer.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>